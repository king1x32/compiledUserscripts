// ==UserScript==
// @name                YouTube Codecs - Hardware Acceleration Only
// @namespace           http://tampermonkey.net/
// @version             0.0.2
// @author              CY Fung
// @match               https://www.youtube.com/*
// @match               https://www.youtube.com/embed/*
// @match               https://www.youtube-nocookie.com/embed/*
// @exclude             https://www.youtube.com/live_chat*
// @exclude             https://www.youtube.com/live_chat_replay*
// @exclude             /^https?://\S+\.(txt|png|jpg|jpeg|gif|xml|svg|manifest|log|ini)[^\/]*$/
// @icon                https://www.google.com/s2/favicons?sz=64&domain=youtube.com
// @grant               none
// @run-at              document-start
// @license             MIT
//
// @compatible          firefox Violentmonkey
// @compatible          firefox Tampermonkey
// @compatible          firefox FireMonkey
// @compatible          chrome Violentmonkey
// @compatible          chrome Tampermonkey
// @compatible          opera Violentmonkey
// @compatible          opera Tampermonkey
// @compatible          safari Stay
// @compatible          edge Violentmonkey
// @compatible          edge Tampermonkey
// @compatible          brave Violentmonkey
// @compatible          brave Tampermonkey
//
// @unwrap
// @allFrames           true
// @inject-into         page
// @downloadURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/YouTube20Codecs2020Hardware20Acceleration20Only.user.js
// @updateURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/YouTube20Codecs2020Hardware20Acceleration20Only.meta.js
// ==/UserScript==
!function(){"use strict";const a=(async()=>{})().constructor;if("function"!=typeof VideoEncoder||"function"!=typeof VideoEncoder.isConfigSupported)return void console.error("VideoEncoder.isConfigSupported is not supported");const v="__codecs_vvgZHhgVKfAlY0__";let c=!1,M=!1;const e="__codecs_qyg8YVnvXJZ9E5__",H=window[e]||(window[e]=(()=>{const a=localStorage[v];if(a)try{const v=JSON.parse(a),M=new Map(Object.entries(v));return c=!0,M}catch(a){}return new Map})()),t=async a=>{if(!a)return null;if(H.has(a))return H.get(a);H.set(a,null);const v={codec:a,hardwareAcceleration:"prefer-hardware",width:1920,height:1080,bitrate:12e6,bitrateMode:"variable",framerate:60,sampleRate:48e3,numberOfChannels:2};let c=!1;try{const a=await VideoDecoder.isConfigSupported(v),M=await AudioDecoder.isConfigSupported(v);!0!==a.supported&&!0!==M.supported||(c=!0)}catch(a){console.warn(a)}return H.set(a,c),c};c?console.log("[yt-codecs-hardware-acceleration-only] (init) load from cache"):a.all(["avc1.420034","hvc1.1.6.L123.00","vp8","vp09.02.51.10.01.09.16.09.00","vp09.02.51.10.01.09.99.99.00","vp09.02.50.10.01.09.16.09.00","vp09.02.50.10.01.09.99.99.00","vp09.02.41.10.01.09.16.09.00","vp09.02.41.10.01.09.99.99.00","vp09.02.40.10.01.09.16.09.00","vp09.02.40.10.01.09.99.99.00","vp09.02.31.10.01.09.16.09.00","vp09.02.31.10.01.09.99.09.00","vp09.02.30.10.01.09.16.09.00","vp09.02.30.10.01.09.99.09.00","vp09.02.21.10.01.09.16.09.00","vp09.02.21.10.01.09.99.09.00","vp09.02.11.10.01.09.16.09.00","vp09.02.11.10.01.09.99.09.00","vp09.02.10.10.01.09.16.09.00","vp09.02.10.10.01.09.99.09.00","mp4a.40.5","mp4a.40.2","opus","vp9","vp09.00.51.08.01.01.01.01.00","vp09.00.51.08","vp09.00.50.08","vp09.00.41.08","vp09.00.40.08","vp09.00.31.08","vp09.00.30.08","vp09.00.21.08","vp09.00.20.08","vp09.00.11.08","vp09.00.10.08","avc1.640028","avc1.4d401e","avc1.4d4015","avc1.4d400c","avc1.42001E","avc1.4d401f","avc1.64001F","avc1.4d4020","avc1.64002a","avc1.64002A","avc1.4D4020","avc1.4D401F","avc1.4D401E","avc1.4D4015","avc1.4D400C","avc1.4d002a","avc1.4d0028","avc1.6e0034","av01.0.00M.08","av01.0.01M.08","av01.0.02M.08","av01.0.03M.08","av01.0.04M.08","av01.0.05M.08","av01.0.06M.08","av01.0.07M.08","av01.0.08M.08","av01.0.09M.08","av01.0.12M.08","av01.0.13M.08","av01.0.14M.08","av01.0.15M.08","av01.0.16M.08","av01.0.17M.08","av01.0.18M.08","av01.0.19M.08","av01.0.00M.10","av01.0.01M.10","av01.0.02M.10","av01.0.03M.10","av01.0.04M.10","av01.0.05M.10","av01.0.06M.10","av01.0.07M.10","av01.0.08M.10","av01.0.09M.10","av01.0.12M.10","av01.0.13M.10","av01.0.14M.10","av01.0.15M.10","av01.0.16M.10","av01.0.17M.10","av01.0.18M.10","av01.0.19M.10","av01.0.00M.08","av01.0.00M.10","av01.0.00M.12","av01.0.00H.08","av01.0.00H.10","av01.0.00H.12","av01.0.01M.08","av01.0.01M.10","av01.0.01M.12","av01.0.01H.08","av01.0.01H.10","av01.0.01H.12","av01.0.02M.08","av01.0.02M.10","av01.0.02M.12","av01.0.02H.08","av01.0.02H.10","av01.0.02H.12","av01.0.03M.08","av01.0.03M.10","av01.0.03M.12","av01.0.03H.08","av01.0.03H.10","av01.0.03H.12","av01.0.04M.08","av01.0.04M.10","av01.0.04M.12","av01.0.04H.08","av01.0.04H.10","av01.0.04H.12","av01.0.05M.08","av01.0.05M.10","av01.0.05M.12","av01.0.05H.08","av01.0.05H.10","av01.0.05H.12","av01.0.06M.08","av01.0.06M.10","av01.0.06M.12","av01.0.06H.08","av01.0.06H.10","av01.0.06H.12","av01.0.07M.08","av01.0.07M.10","av01.0.07M.12","av01.0.07H.08","av01.0.07H.10","av01.0.07H.12","av01.0.08M.08","av01.0.08M.10","av01.0.08M.12","av01.0.08H.08","av01.0.08H.10","av01.0.08H.12","av01.0.09M.08","av01.0.09M.10","av01.0.09M.12","av01.0.09H.08","av01.0.09H.10","av01.0.09H.12","av01.0.10M.08","av01.0.10M.10","av01.0.10M.12","av01.0.10H.08","av01.0.10H.10","av01.0.10H.12","av01.0.11M.08","av01.0.11M.10","av01.0.11M.12","av01.0.11H.08","av01.0.11H.10","av01.0.11H.12","av01.0.12M.08","av01.0.12M.10","av01.0.12M.12","av01.0.12H.08","av01.0.12H.10","av01.0.12H.12","av01.0.13M.08","av01.0.13M.10","av01.0.13M.12","av01.0.13H.08","av01.0.13H.10","av01.0.13H.12","av01.0.14M.08","av01.0.14M.10","av01.0.14M.12","av01.0.14H.08","av01.0.14H.10","av01.0.14H.12","av01.0.15M.08","av01.0.15M.10","av01.0.15M.12","av01.0.15H.08","av01.0.15H.10","av01.0.15H.12","av01.0.16M.08","av01.0.16M.10","av01.0.16M.12","av01.0.16H.08","av01.0.16H.10","av01.0.16H.12","av01.0.17M.08","av01.0.17M.10","av01.0.17M.12","av01.0.17H.08","av01.0.17H.10","av01.0.17H.12","av01.0.18M.08","av01.0.18M.10","av01.0.18M.12","av01.0.18H.08","av01.0.18H.10","av01.0.18H.12","av01.0.19M.08","av01.0.19M.10","av01.0.19M.12","av01.0.19H.08","av01.0.19H.10","av01.0.19H.12","av01.0.20M.08","av01.0.20M.10","av01.0.20M.12","av01.0.20H.08","av01.0.20H.10","av01.0.20H.12","av01.0.21M.08","av01.0.21M.10","av01.0.21M.12","av01.0.21H.08","av01.0.21H.10","av01.0.21H.12","av01.0.22M.08","av01.0.22M.10","av01.0.22M.12","av01.0.22H.08","av01.0.22H.10","av01.0.22H.12","av01.0.23M.08","av01.0.23M.10","av01.0.23M.12","av01.0.23H.08","av01.0.23H.10","av01.0.23H.12","av01.0.31M.08","av01.0.31M.10","av01.0.31M.12","av01.0.31H.08","av01.0.31H.10","av01.0.31H.12","av01.1.00M.08","av01.1.00M.10","av01.1.00M.12","av01.1.00H.08","av01.1.00H.10","av01.1.00H.12","av01.1.01M.08","av01.1.01M.10","av01.1.01M.12","av01.1.01H.08","av01.1.01H.10","av01.1.01H.12","av01.1.02M.08","av01.1.02M.10","av01.1.02M.12","av01.1.02H.08","av01.1.02H.10","av01.1.02H.12","av01.1.03M.08","av01.1.03M.10","av01.1.03M.12","av01.1.03H.08","av01.1.03H.10","av01.1.03H.12","av01.1.04M.08","av01.1.04M.10","av01.1.04M.12","av01.1.04H.08","av01.1.04H.10","av01.1.04H.12","av01.1.05M.08","av01.1.05M.10","av01.1.05M.12","av01.1.05H.08","av01.1.05H.10","av01.1.05H.12","av01.1.06M.08","av01.1.06M.10","av01.1.06M.12","av01.1.06H.08","av01.1.06H.10","av01.1.06H.12","av01.1.07M.08","av01.1.07M.10","av01.1.07M.12","av01.1.07H.08","av01.1.07H.10","av01.1.07H.12","av01.1.08M.08","av01.1.08M.10","av01.1.08M.12","av01.1.08H.08","av01.1.08H.10","av01.1.08H.12","av01.1.09M.08","av01.1.09M.10","av01.1.09M.12","av01.1.09H.08","av01.1.09H.10","av01.1.09H.12","av01.1.10M.08","av01.1.10M.10","av01.1.10M.12","av01.1.10H.08","av01.1.10H.10","av01.1.10H.12","av01.1.11M.08","av01.1.11M.10","av01.1.11M.12","av01.1.11H.08","av01.1.11H.10","av01.1.11H.12","av01.1.12M.08","av01.1.12M.10","av01.1.12M.12","av01.1.12H.08","av01.1.12H.10","av01.1.12H.12","av01.1.13M.08","av01.1.13M.10","av01.1.13M.12","av01.1.13H.08","av01.1.13H.10","av01.1.13H.12","av01.1.14M.08","av01.1.14M.10","av01.1.14M.12","av01.1.14H.08","av01.1.14H.10","av01.1.14H.12","av01.1.15M.08","av01.1.15M.10","av01.1.15M.12","av01.1.15H.08","av01.1.15H.10","av01.1.15H.12","av01.1.16M.08","av01.1.16M.10","av01.1.16M.12","av01.1.16H.08","av01.1.16H.10","av01.1.16H.12","av01.1.17M.08","av01.1.17M.10","av01.1.17M.12","av01.1.17H.08","av01.1.17H.10","av01.1.17H.12","av01.1.18M.08","av01.1.18M.10","av01.1.18M.12","av01.1.18H.08","av01.1.18H.10","av01.1.18H.12","av01.1.19M.08","av01.1.19M.10","av01.1.19M.12","av01.1.19H.08","av01.1.19H.10","av01.1.19H.12","av01.1.20M.08","av01.1.20M.10","av01.1.20M.12","av01.1.20H.08","av01.1.20H.10","av01.1.20H.12","av01.1.21M.08","av01.1.21M.10","av01.1.21M.12","av01.1.21H.08","av01.1.21H.10","av01.1.21H.12","av01.1.22M.08","av01.1.22M.10","av01.1.22M.12","av01.1.22H.08","av01.1.22H.10","av01.1.22H.12","av01.1.23M.08","av01.1.23M.10","av01.1.23M.12","av01.1.23H.08","av01.1.23H.10","av01.1.23H.12","av01.1.31M.08","av01.1.31M.10","av01.1.31M.12","av01.1.31H.08","av01.1.31H.10","av01.1.31H.12","av01.2.00M.08","av01.2.00M.10","av01.2.00M.12","av01.2.00H.08","av01.2.00H.10","av01.2.00H.12","av01.2.01M.08","av01.2.01M.10","av01.2.01M.12","av01.2.01H.08","av01.2.01H.10","av01.2.01H.12","av01.2.02M.08","av01.2.02M.10","av01.2.02M.12","av01.2.02H.08","av01.2.02H.10","av01.2.02H.12","av01.2.03M.08","av01.2.03M.10","av01.2.03M.12","av01.2.03H.08","av01.2.03H.10","av01.2.03H.12","av01.2.04M.08","av01.2.04M.10","av01.2.04M.12","av01.2.04H.08","av01.2.04H.10","av01.2.04H.12","av01.2.05M.08","av01.2.05M.10","av01.2.05M.12","av01.2.05H.08","av01.2.05H.10","av01.2.05H.12","av01.2.06M.08","av01.2.06M.10","av01.2.06M.12","av01.2.06H.08","av01.2.06H.10","av01.2.06H.12","av01.2.07M.08","av01.2.07M.10","av01.2.07M.12","av01.2.07H.08","av01.2.07H.10","av01.2.07H.12","av01.2.08M.08","av01.2.08M.10","av01.2.08M.12","av01.2.08H.08","av01.2.08H.10","av01.2.08H.12","av01.2.09M.08","av01.2.09M.10","av01.2.09M.12","av01.2.09H.08","av01.2.09H.10","av01.2.09H.12","av01.2.10M.08","av01.2.10M.10","av01.2.10M.12","av01.2.10H.08","av01.2.10H.10","av01.2.10H.12","av01.2.11M.08","av01.2.11M.10","av01.2.11M.12","av01.2.11H.08","av01.2.11H.10","av01.2.11H.12","av01.2.12M.08","av01.2.12M.10","av01.2.12M.12","av01.2.12H.08","av01.2.12H.10","av01.2.12H.12","av01.2.13M.08","av01.2.13M.10","av01.2.13M.12","av01.2.13H.08","av01.2.13H.10","av01.2.13H.12","av01.2.14M.08","av01.2.14M.10","av01.2.14M.12","av01.2.14H.08","av01.2.14H.10","av01.2.14H.12","av01.2.15M.08","av01.2.15M.10","av01.2.15M.12","av01.2.15H.08","av01.2.15H.10","av01.2.15H.12","av01.2.16M.08","av01.2.16M.10","av01.2.16M.12","av01.2.16H.08","av01.2.16H.10","av01.2.16H.12","av01.2.17M.08","av01.2.17M.10","av01.2.17M.12","av01.2.17H.08","av01.2.17H.10","av01.2.17H.12","av01.2.18M.08","av01.2.18M.10","av01.2.18M.12","av01.2.18H.08","av01.2.18H.10","av01.2.18H.12","av01.2.19M.08","av01.2.19M.10","av01.2.19M.12","av01.2.19H.08","av01.2.19H.10","av01.2.19H.12","av01.2.20M.08","av01.2.20M.10","av01.2.20M.12","av01.2.20H.08","av01.2.20H.10","av01.2.20H.12","av01.2.21M.08","av01.2.21M.10","av01.2.21M.12","av01.2.21H.08","av01.2.21H.10","av01.2.21H.12","av01.2.22M.08","av01.2.22M.10","av01.2.22M.12","av01.2.22H.08","av01.2.22H.10","av01.2.22H.12","av01.2.23M.08","av01.2.23M.10","av01.2.23M.12","av01.2.23H.08","av01.2.23H.10","av01.2.23H.12","av01.2.31M.08","av01.2.31M.10","av01.2.31M.12","av01.2.31H.08","av01.2.31H.10","av01.2.31H.12","avc1.42000a","avc1.42000b","avc1.42000c","avc1.42000d","avc1.420014","avc1.420015","avc1.420016","avc1.42001e","avc1.42001f","avc1.420020","avc1.420028","avc1.420029","avc1.42002a","avc1.420032","avc1.420033","avc1.420034","avc1.42400a","avc1.42400b","avc1.42400c","avc1.42400d","avc1.424014","avc1.424015","avc1.424016","avc1.42401e","avc1.42401f","avc1.424020","avc1.424028","avc1.424029","avc1.42402a","avc1.424032","avc1.424033","avc1.424034","avc1.4d000a","avc1.4d000b","avc1.4d000c","avc1.4d000d","avc1.4d0014","avc1.4d0015","avc1.4d0016","avc1.4d001e","avc1.4d001f","avc1.4d0020","avc1.4d0028","avc1.4d0029","avc1.4d002a","avc1.4d0032","avc1.4d0033","avc1.4d0034","avc1.4d400a","avc1.4d400b","avc1.4d400c","avc1.4d400d","avc1.4d4014","avc1.4d4015","avc1.4d4016","avc1.4d401e","avc1.4d401f","avc1.4d4020","avc1.4d4028","avc1.4d4029","avc1.4d402a","avc1.4d4032","avc1.4d4033","avc1.4d4034","avc1.58000a","avc1.58000b","avc1.58000c","avc1.58000d","avc1.580014","avc1.580015","avc1.580016","avc1.58001e","avc1.58001f","avc1.580020","avc1.580028","avc1.580029","avc1.58002a","avc1.580032","avc1.580033","avc1.580034","avc1.64000a","avc1.64000b","avc1.64000c","avc1.64000d","avc1.640014","avc1.640015","avc1.640016","avc1.64001e","avc1.64001f","avc1.640020","avc1.640028","avc1.640029","avc1.64002a","avc1.640032","avc1.640033","avc1.640034","avc1.64080a","avc1.64080b","avc1.64080c","avc1.64080d","avc1.640814","avc1.640815","avc1.640816","avc1.64081e","avc1.64081f","avc1.640820","avc1.640828","avc1.640829","avc1.64082a","avc1.640832","avc1.640833","avc1.640834","avc1.6e000a","avc1.6e000b","avc1.6e000c","avc1.6e000d","avc1.6e0014","avc1.6e0015","avc1.6e0016","avc1.6e001e","avc1.6e001f","avc1.6e0020","avc1.6e0028","avc1.6e0029","avc1.6e002a","avc1.6e0032","avc1.6e0033","avc1.6e0034","avc1.6e100a","avc1.6e100b","avc1.6e100c","avc1.6e100d","avc1.6e1014","avc1.6e1015","avc1.6e1016","avc1.6e101e","avc1.6e101f","avc1.6e1020","avc1.6e1028","avc1.6e1029","avc1.6e102a","avc1.6e1032","avc1.6e1033","avc1.6e1034","avc1.7a000a","avc1.7a000b","avc1.7a000c","avc1.7a000d","avc1.7a0014","avc1.7a0015","avc1.7a0016","avc1.7a001e","avc1.7a001f","avc1.7a0020","avc1.7a0028","avc1.7a0029","avc1.7a002a","avc1.7a0032","avc1.7a0033","avc1.7a0034","avc1.7a100a","avc1.7a100b","avc1.7a100c","avc1.7a100d","avc1.7a1014","avc1.7a1015","avc1.7a1016","avc1.7a101e","avc1.7a101f","avc1.7a1020","avc1.7a1028","avc1.7a1029","avc1.7a102a","avc1.7a1032","avc1.7a1033","avc1.7a1034","avc1.f4000a","avc1.f4000b","avc1.f4000c","avc1.f4000d","avc1.f40014","avc1.f40015","avc1.f40016","avc1.f4001e","avc1.f4001f","avc1.f40020","avc1.f40028","avc1.f40029","avc1.f4002a","avc1.f40032","avc1.f40033","avc1.f40034","avc1.f4100a","avc1.f4100b","avc1.f4100c","avc1.f4100d","avc1.f41014","avc1.f41015","avc1.f41016","avc1.f4101e","avc1.f4101f","avc1.f41020","avc1.f41028","avc1.f41029","avc1.f4102a","avc1.f41032","avc1.f41033","avc1.f41034","avc1.2c000a","avc1.2c000b","avc1.2c000c","avc1.2c000d","avc1.2c0014","avc1.2c0015","avc1.2c0016","avc1.2c001e","avc1.2c001f","avc1.2c0020","avc1.2c0028","avc1.2c0029","avc1.2c002a","avc1.2c0032","avc1.2c0033","avc1.2c0034","av01.0.08H.10","hev1.1.6.L93.B0","hev1.2.4.L120.B0","avc1.4d400b","mp4v.20.3","avc1.42001E, mp4a.40.2","avc1.64001F, mp4a.40.2","vp9.2","av99.0.05M.08","ec-3","ac-3"].map(t)).then(()=>{try{localStorage[v]=JSON.stringify(Object.fromEntries(H.entries()))}catch(a){}console.log("[yt-codecs-hardware-acceleration-only] (init) check done")}).catch(console.warn);let o=null;try{o=navigator.mediaCapabilities.decodingInfo({type:"file",video:{contentType:"video/mp4; codecs=av01.0.05M.08.0.110.05.01.06.0",height:1080,width:1920,framerate:30,bitrate:2826848},audio:{contentType:"audio/webm; codecs=opus",channels:"2.1",samplerate:44100,bitrate:255236}})}catch(a){o=null}const r=a=>{a&&a.supported&&a.smooth?function(){try{Object.defineProperty(localStorage.constructor.prototype,"yt-player-av1-pref",{get(){return this===localStorage?"8192":this.getItem("yt-player-av1-pref")},set(a){return this.setItem("yt-player-av1-pref",a),!0},enumerable:!0,configurable:!0})}catch(a){}"8192"===localStorage["yt-player-av1-pref"]?M=!0:console.warn("Use YouTube AV1 is not supported in your browser.")}():console.warn("yt-codecs-hardware-acceleration-only","Your browser does not support AV1. You might conside to use the latest version of Google Chrome or Mozilla FireFox.")};(o||a.resolve(0)).catch(r).then(r),(()=>{function a(a,v){return function(c){let e,o;if(e=/codecs="([^"\r\n]*?)"/.exec(c)){const a=e[1],v=(a=>(30===a.length&&/^av01\.0\.\d\dM\.\d\d\b/.test(`${a}`)&&(a=a.substring(0,13)),H.get(a)))(a);if(!1===v)return"";void 0===v&&(t(a),console.warn("[yt-codecs-hardware-acceleration-only] new format",c))}return o=void 0!==c&&function(a){if("string"==typeof a&&a.startsWith("video/")&&M)if(a.includes("av01")){if(/codecs[\x20-\x7F]+\bav01\b/.test(a))return!0}else if(a.includes("av1")&&/codecs[\x20-\x7F]+\bav1\b/.test(a))return!0}(c),o=void 0===o?a.apply(this,arguments):v?o?"probably":"":o,o}}const v=(HTMLVideoElement||0).prototype;v&&"function"==typeof v.canPlayType&&(v.canPlayType=a(v.canPlayType,!0));const c=window.MediaSource;c&&"function"==typeof c.isTypeSupported&&(c.isTypeSupported=a(c.isTypeSupported))})()}();