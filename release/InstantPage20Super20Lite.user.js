// ==UserScript==
// @name              InstantPage Super Lite
// @namespace         Need4Speed
// @version           1.4.6
// @author            -
// @match             *://*/*
// @noframes
// @run-at            document-idle
// @grant             none
// @downloadURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/InstantPage20Super20Lite.user.js
// @updateURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/InstantPage20Super20Lite.meta.js
// ==/UserScript==
function t(t){l=performance.now();const e=t.target.closest("a");a(e)&&s(e.href,"high")}function e(t){if(performance.now()-l<1111)return;if(!("closest"in t.target))return;const e=t.target.closest("a");a(e)&&(e.addEventListener("mouseout",o,{passive:!0}),f=setTimeout(()=>{s(e.href,"high"),f=void 0},m))}function n(t){const e=t.target.closest("a");a(e)&&s(e.href,"high")}function o(t){t.relatedTarget&&t.target.closest("a")==t.relatedTarget.closest("a")||f&&(clearTimeout(f),f=void 0)}function i(t){if(performance.now()-l<1111)return;const e=t.target.closest("a");if(t.which>1||t.metaKey||t.ctrlKey)return;if(!e)return;e.addEventListener("click",function(t){1337!=t.detail&&t.preventDefault()},{capture:!0,passive:!1,once:!0});const n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1,detail:1337});e.dispatchEvent(n)}function a(t){if(!t.href.match(r)&&t&&t.href&&(!u||"instant"in t.dataset)){if(t.origin!=location.origin&&(!d&&!("instant"in t.dataset)||!h))return;if(["http:","https:"].includes(t.protocol)&&("http:"!=t.protocol||"https:"!=location.protocol)&&(c||!t.search||"instant"in t.dataset)&&!(t.hash&&t.pathname+t.search==location.pathname+location.search||"noInstant"in t.dataset))return!0}}function s(t,e="auto"){if(g.has(t))return;const n=document.createElement("link");n.rel="prefetch",n.href=t,n.fetchPriority=e,n.as="document",document.head.appendChild(n),g.add(t)}var r=new RegExp(/login|logout|register|signin|signup|signout|pay|create|edit|download|del|reset|submit|doubleclick|googleads|exit|unread/);let c,d,u,l,f,h=null,m=65,g=new Set;!function(){if(!document.createElement("link").relList.supports("prefetch"))return;const o="instantVaryAccept"in document.body.dataset||"Shopify"in window,r=navigator.userAgent.indexOf("Chrome/");if(r>-1&&(h=parseInt(navigator.userAgent.substring(r+7))),o&&h&&h<110)return;const l="instantMousedownShortcut"in document.body.dataset;c="instantAllowQueryString"in document.body.dataset,d="instantAllowExternalLinks"in document.body.dataset,u="instantWhitelist"in document.body.dataset;const f={capture:!0,passive:!0};let g=!1,p=!1,v=!1;if("instantIntensity"in document.body.dataset){const t=document.body.dataset.instantIntensity;if(t.startsWith("mousedown"))g=!0,"mousedown-only"==t&&(p=!0);else if(t.startsWith("viewport")){const e=navigator.connection&&navigator.connection.saveData,n=navigator.connection&&navigator.connection.effectiveType&&navigator.connection.effectiveType.includes("2g");e||n||("viewport"==t?document.documentElement.clientWidth*document.documentElement.clientHeight<45e4&&(v=!0):"viewport-all"==t&&(v=!0))}else{const e=parseInt(t);isNaN(e)||(m=e)}}if(p||document.addEventListener("touchstart",t,f),g?l||document.addEventListener("mousedown",n,f):document.addEventListener("mouseover",e,f),l&&document.addEventListener("mousedown",i,f),v){let t=window.requestIdleCallback;t||(t=t=>{t()}),t(function(){const t=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target;t.unobserve(n),s(n.href)}})});document.querySelectorAll("a").forEach(e=>{a(e)&&t.observe(e)})},{timeout:1500})}}();