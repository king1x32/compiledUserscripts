// ==UserScript==
// @name         Visited Links Enhanced - Size Optimized
// @namespace    com.userscript.visited-links-enhanced
// @version      0.6.9
// @author       Enhanced by AI Assistant ft. Hongmd
// @license      MIT
// @homepageURL  https://github.com/hongmd/userscript-improved
// @supportURL   https://github.com/hongmd/userscript-improved/issues
// @match        http://*/*
// @match        https://*/*
// @noframes
// @run-at       document-start
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_registerMenuCommand
// @copyright    2025, Enhanced by AI Assistant ft. Hongmd
// @downloadURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/Visited20Links20Enhanced2020Size20Optimized.user.js
// @updateURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/Visited20Links20Enhanced2020Size20Optimized.meta.js
// ==/UserScript==
!function(){"use strict";function e(){document.documentElement?i.I():setTimeout(e,50)}const t={REGEX:{COLOR_HEX:/^#([0-9a-f]{3}){1,2}$/i,COLOR_RGB:/^rgb\(\s*(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)\s*,\s*(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)\s*,\s*(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)\s*\)$/i,COLOR_RGBA:/^rgba\(\s*(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)\s*,\s*(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)\s*,\s*(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)\s*,\s*(?:1(?:\.0*)?|0(?:\.\d*)?)\s*\)$/i,COLOR_NAMED:/^(red|blue|green|yellow|black|white|gray|orange|purple|pink|brown)$/i,URL_DOMAIN:/^https?:\/\/([^\/\?#]+)/i},COLORS:[["#93c5fd","Pastel Blue"],["#fca5a5","Pastel Red"],["#86efac","Pastel Green"],["#fed7aa","Pastel Orange"],["#f97316","Vibrant Orange"],["#c4b5fd","Pastel Purple"],["#f9a8d4","Pastel Pink"],["#7dd3fc","Pastel Sky Blue"],["#bef264","Pastel Lime"],["#fde047","Pastel Yellow"],["#fb7185","Pastel Rose"],["#a78bfa","Pastel Violet"],["#34d399","Pastel Emerald"],["#dc2626","Bold Red"],["#2563eb","Bold Blue"],["#059669","Bold Green"],["#7c3aed","Bold Purple"],["#db2777","Bold Pink"],["#ea580c","Bold Orange"],["#0891b2","Bold Cyan"],["#65a30d","Bold Lime"],["#ca8a04","Bold Yellow"],["#be123c","Bold Rose"],["#000000","Black"],["#ffffff","White"],["#6b7280","Gray"],["#ef4444","Pure Red"],["#3b82f6","Pure Blue"],["#10b981","Pure Green"],["#8b5cf6","Pure Purple"],["#f59e0b","Pure Orange"],["#eab308","Pure Yellow"]],CFG:{KEYS:{C:"visited_color",N:"script_enabled"},DEF:{C:"#f97316",N:!0},ID:"visited-lite-enhanced-style",CSS:"a:visited,a:visited *{color:%C%!important}"}},n=e=>{if(!e||"string"!=typeof e)return!1;const n=e.trim();return!(n.length<3)&&(t.REGEX.COLOR_HEX.test(n)||t.REGEX.COLOR_RGB.test(n)||t.REGEX.COLOR_RGBA.test(n)||t.REGEX.COLOR_NAMED.test(n))},o={_c:new Map,_p:"visited_links_enhanced_",G:function(e){if(this._c.has(e))return this._c.get(e);const n=t.CFG.KEYS[e],o=t.CFG.DEF[e];let s=o;try{if("undefined"!=typeof GM_getValue)s=GM_getValue(n,o);else{const e=localStorage.getItem(this._p+n);s=e?JSON.parse(e):o}}catch(e){try{const e=localStorage.getItem(this._p+n);s=e?JSON.parse(e):o}catch{}}return this._c.set(e,s),s},S:function(e,n){this._c.set(e,n);const o=t.CFG.KEYS[e];try{if("undefined"!=typeof GM_setValue)return GM_setValue(o,n),!0}catch(e){}try{return localStorage.setItem(this._p+o,JSON.stringify(n)),!0}catch{}return!1}},s={_e:null,_l:"",I:function(){this.E()},E:function(){const e=document.getElementById(t.CFG.ID);return e&&e.remove(),this._e=Object.assign(document.createElement("style"),{id:t.CFG.ID,type:"text/css"}),(document.head??document.documentElement)?.appendChild?.(this._e),this._e},U:function(){const e=o.G("C");if(!n(e))return;const s=t.CFG.CSS.replace("%C%",e);this._l!==s&&(this._e?.isConnected||this.E(),this._e.textContent="\n        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }\n        @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }\n      \n"+s,this._l=s)},R:function(){this._e&&this._l&&(this._e.textContent="",this._l="")}},r={_co:null,I:function(){if("undefined"!=typeof GM_registerMenuCommand)try{GM_registerMenuCommand("🎨 Choose Color",this.CC.bind(this)),GM_registerMenuCommand("⚙️ Toggle Script",this.TS.bind(this))}catch{}},TS:function(){const e=!o.G("N");o.S("N",e),e?s.U():s.R();const t="Visited Links Enhanced: "+(e?"Enabled":"Disabled");this.showNotification(t)},CC:function(){const e=this.createColorGrid(),t=this.createColorModal(e);document.body.appendChild(t),t.style.display="flex",t.focus()},createColorGrid:function(){const e=document.createElement("div");return e.style.cssText="\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(75px, 1fr));\n        gap: 12px;\n        max-width: 650px;\n        margin: 25px auto;\n        padding: 0 10px;\n      ",t.COLORS.forEach(t=>{const n=document.createElement("div");n.style.cssText=`\n          width: 75px;\n          height: 75px;\n          background-color: ${t[0]};\n          border: 3px solid #e0e0e0;\n          border-radius: 12px;\n          cursor: pointer;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 11px;\n          font-weight: 600;\n          color: ${this.getContrastColor(t[0])};\n          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n          position: relative;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n        `,n.onmouseover=()=>{n.style.transform="scale(1.08) rotate(2deg)",n.style.boxShadow="0 8px 25px rgba(0,0,0,0.25)",n.style.borderColor="#007bff",n.style.zIndex="10"},n.onmouseout=()=>{n.style.transform="scale(1) rotate(0deg)",n.style.boxShadow="0 2px 8px rgba(0,0,0,0.1)",n.style.borderColor="#e0e0e0",n.style.zIndex="1"},n.onclick=()=>{o.S("C",t[0]),s.U(),this.showNotification(`Selected: ${t[1]} (${t[0]})`);const e=document.querySelector(".color-modal");e&&e.parentNode&&e.parentNode.removeChild(e)},n.title=`${t[1]} - Click to select`,e.appendChild(n)}),e},createColorModal:function(e){const r=document.createElement("div");r.className="color-modal",r.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100vw;\n        height: 100vh;\n        background: rgba(0, 0, 0, 0.75);\n        backdrop-filter: blur(8px);\n        display: none;\n        z-index: 10000;\n        align-items: center;\n        justify-content: center;\n        padding: 20px;\n        box-sizing: border-box;\n      ";const i=document.createElement("div");i.style.cssText="\n        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);\n        padding: 30px;\n        border-radius: 20px;\n        box-shadow: 0 20px 60px rgba(0,0,0,0.3);\n        max-width: 700px;\n        max-height: 85vh;\n        overflow-y: auto;\n        position: relative;\n        border: 1px solid rgba(255,255,255,0.2);\n      ";const a=document.createElement("h3");a.textContent="🎨 Choose Color for Visited Links",a.style.cssText="\n        margin: 0 0 25px 0;\n        color: #2c3e50;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        font-size: 24px;\n        font-weight: 600;\n        text-align: center;\n        text-shadow: 0 1px 2px rgba(0,0,0,0.1);\n      ";const d=document.createElement("div");d.style.cssText="\n        display: flex; justify-content: center; margin: 0 0 15px 0;\n      ";const l=document.createElement("button");l.textContent="Use Default Color",l.style.cssText="\n        padding: 10px 16px;\n        background: #f1f3f5;\n        color: #212529;\n        border: 1px solid #dee2e6;\n        border-radius: 8px;\n        cursor: pointer;\n        font-size: 14px;\n        font-weight: 600;\n      ",l.onclick=()=>{o.S("C",t.CFG.DEF.C),s.U(),this.showNotification(`Default color applied: ${t.CFG.DEF.C}`),r&&r.parentNode&&r.parentNode.removeChild(r)},d.appendChild(l);const c=document.createElement("button");c.innerHTML="×",c.style.cssText="\n        position: absolute;\n        top: 15px;\n        right: 20px;\n        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);\n        color: white;\n        border: none;\n        border-radius: 50%;\n        width: 35px;\n        height: 35px;\n        cursor: pointer;\n        font-size: 20px;\n        font-weight: bold;\n        line-height: 1;\n        transition: all 0.3s ease;\n        box-shadow: 0 4px 12px rgba(238, 90, 82, 0.3);\n      ",c.onmouseover=()=>{c.style.transform="scale(1.1)",c.style.boxShadow="0 6px 20px rgba(238, 90, 82, 0.4)"},c.onmouseout=()=>{c.style.transform="scale(1)",c.style.boxShadow="0 4px 12px rgba(238, 90, 82, 0.3)"},c.onclick=()=>{r&&r.parentNode&&r.parentNode.removeChild(r)};const p=document.createElement("div");p.style.cssText="\n        margin-top: 25px;\n        padding-top: 20px;\n        border-top: 2px solid #e9ecef;\n        text-align: center;\n        background: rgba(248, 249, 250, 0.5);\n        border-radius: 12px;\n        padding: 20px;\n      ";const u=document.createElement("div");u.textContent="Or enter a custom color code:",u.style.cssText="\n        margin-bottom: 15px;\n        color: #495057;\n        font-size: 16px;\n        font-weight: 500;\n      ";const f=document.createElement("div");f.style.cssText="\n        display: flex;\n        gap: 10px;\n        justify-content: center;\n        align-items: center;\n        flex-wrap: wrap;\n      ";const x=document.createElement("input");x.type="text",x.placeholder="#ff0000 or red",x.style.cssText="\n        padding: 12px 16px;\n        border: 2px solid #dee2e6;\n        border-radius: 8px;\n        width: 220px;\n        font-size: 16px;\n        transition: all 0.3s ease;\n        outline: none;\n      ",x.onfocus=()=>{x.style.borderColor="#007bff",x.style.boxShadow="0 0 0 3px rgba(0, 123, 255, 0.1)"},x.onblur=()=>{x.style.borderColor="#dee2e6",x.style.boxShadow="none"};const h=document.createElement("button");return h.textContent="Apply",h.style.cssText="\n        padding: 12px 24px;\n        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);\n        color: white;\n        border: none;\n        border-radius: 8px;\n        cursor: pointer;\n        font-size: 16px;\n        font-weight: 600;\n        transition: all 0.3s ease;\n        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);\n      ",h.onmouseover=()=>{h.style.transform="translateY(-2px)",h.style.boxShadow="0 6px 20px rgba(40, 167, 69, 0.4)"},h.onmouseout=()=>{h.style.transform="translateY(0)",h.style.boxShadow="0 4px 12px rgba(40, 167, 69, 0.3)"},h.onclick=()=>{const e=x.value.trim();e&&n(e)?(o.S("C",e),s.U(),this.showNotification(`Custom color applied: ${e}`),r&&r.parentNode&&r.parentNode.removeChild(r)):this.showError("Invalid color code! Please try again.")},f.appendChild(x),f.appendChild(h),p.appendChild(u),p.appendChild(f),i.appendChild(c),i.appendChild(a),i.appendChild(d),i.appendChild(e),i.appendChild(p),r.appendChild(i),r.onclick=e=>{e.target===r&&r.parentNode&&r.parentNode.removeChild(r)},r.onkeydown=e=>{"Escape"===e.key&&r.parentNode&&r.parentNode.removeChild(r)},r},getContrastColor:function(e){return(299*parseInt(e.slice(1,3),16)+587*parseInt(e.slice(3,5),16)+114*parseInt(e.slice(5,7),16))/1e3>128?"#000000":"#ffffff"},showNotification:function(e){const t=document.createElement("div");t.textContent="✅ "+e,t.style.cssText="\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);\n        color: white;\n        padding: 15px 20px;\n        border-radius: 10px;\n        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        font-size: 14px;\n        font-weight: 500;\n        z-index: 10001;\n        animation: slideIn 0.3s ease-out;\n      ",document.body.appendChild(t),setTimeout(()=>{t.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300)},3e3)},showError:function(e){const t=document.createElement("div");t.textContent="❌ "+e,t.style.cssText="\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);\n        color: white;\n        padding: 15px 20px;\n        border-radius: 10px;\n        box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        font-size: 14px;\n        font-weight: 500;\n        z-index: 10001;\n        animation: slideIn 0.3s ease-out;\n      ",document.body.appendChild(t),setTimeout(()=>{t.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300)},3e3)}},i={I:function(){s.I(),r.I(),this.CAS()},CAS:function(){o.G("N")?s.U():s.R()}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}();