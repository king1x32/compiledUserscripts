// ==UserScript==
// @name                Pixiv Previewer
// @namespace           https://github.com/Ocrosoft/PixivPreviewer
// @version             3.8.1
// @author              Ocrosoft
// @match               *://www.pixiv.net/*
// @grant               unsafeWindow
// @grant               GM.xmlHttpRequest
// @grant               GM_xmlhttpRequest
// @license             GPLv3
// @icon                https://t0.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&size=32&url=https://www.pixiv.net
// @icon64              https://t0.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&size=64&url=https://www.pixiv.net
// @require             https://update.greasyfork.org/scripts/515994/1478507/gh_2215_make_GM_xhr_more_parallel_again.js
// @require             https://openuserjs.org/src/libs/sizzle/GM_config.js
// @downloadURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/Pixiv20Previewer.user.js
// @updateURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/Pixiv20Previewer.meta.js
// ==/UserScript==
function e(e){this.op=e,this._URL=window.URL||window.webkitURL||window.MozURL||window.MSURL,this._Blob=window.Blob||window.WebKitBlob||window.MozBlob||window.MSBlob,this._BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,this._Uint8Array=window.Uint8Array||window.WebKitUint8Array||window.MozUint8Array||window.MSUint8Array,this._DataView=window.DataView||window.WebKitDataView||window.MozDataView||window.MSDataView,this._ArrayBuffer=window.ArrayBuffer||window.WebKitArrayBuffer||window.MozArrayBuffer||window.MSArrayBuffer,this._maxLoadAhead=0,this._URL||(this._debugLog("No URL support! Will use slower data: URLs."),this._maxLoadAhead=10),this._Blob||this._error("No Blob support"),this._Uint8Array||this._error("No Uint8Array support"),this._DataView||this._error("No DataView support"),this._ArrayBuffer||this._error("No ArrayBuffer support"),this._isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,this._loadingState=0,this._dead=!1,this._context=e.canvas.getContext("2d"),this._files={},this._frameCount=this.op.metadata.frames.length,this._debugLog("Frame count: "+this._frameCount),this._frame=0,this._loadFrame=0,this._frameImages=[],this._paused=!1,this._loadTimer=null,this._startLoad(),this.op.autoStart?this.play():this._paused=!0}function t(){let e=$("#pp-toolbar");return e.length>0?e.get(0):($("body").append('<div id="pp-toolbar" style="position:fixed;right:28px;bottom:160px;"></div>'),$("#pp-toolbar").get(0))}function n(){return $("._toolmenu").get(0)}function i(e){let t="c/540x540_70/img-master",n="_master";return e.replace(/c\/.*\/custom-thumb/,t).replace("_custom",n).replace(/c\/.*\/img-master/,t).replace("_square",n)}function r(e,t){$.each(e,function(e,n){let i=$(n),r={illustId:0,illustType:0,pageCount:1},o=i.find("a:first"),a=o.children("div:first").find("svg:first"),l=o.children("div:last").find("span:last");if(null==o)return void C.w("Can not found img or imageLink, skip this.");let s=o.attr("href");if(null==s)return void C.w("Invalid href, skip this.");let d=s.match(/artworks\/(\d+)/);if(!d)return void C.e("Get illustId failed, skip this list item!");r.illustId=d[1],a.length>0&&(r.illustType=2),l.length>0&&(r.pageCount=parseInt(l.text()));let p=i;t&&(p=t(i)),p.attr({illustId:r.illustId,illustType:r.illustType,pageCount:r.pageCount}),p.addClass("pp-control")})}function o(e){$.each(e,(e,t)=>{let n=(t=$(t)).find("img");if(0==n.length)return C.w("No img in the control element."),!0;let r=n.attr("src"),o=i(r);r!=o&&n.attr("src",o).css("object-fit","contain")})}function a(){let e=[];return $.each($("img"),(t,n)=>{let i=$(n),r=i;for(let t=0;t<3&&(r=r.parent(),0!=r.length);++t){if(""==r.attr("data-gtm-value"))continue;let t=r.attr("href");if(null!=t&&""!=t&&-1!=t.indexOf("/artwork"))for(let t=0;t<10&&(i=i.parent(),0!=i.length);++t){if("LI"==i.get(0).tagName){e.push(i);break}if(i.parent().length>0&&"UL"==i.parent().get(0).tagName){e.push(i);break}if(i.parent().parent().length>0&&"NAV"==i.parent().parent().get(0).tagName){e.push(i);break}if("DIV"==i.get(0).tagName&&"illust"==i.attr("type")){e.push(i);break}}}}),e}function l(e){e.preventDefault()}function s(){window.addEventListener(X,l,Q)}function d(){window.removeEventListener(X,l,Q)}function p(){C.d("gmcBuildFrame()");let e=$('<div id="gmc" class="hidden"></div>'),t=$('<div id="gmc-frame"></div>');return e.append(t),$("body").append(e),function(){C.d("gmcBuildStyle()");const e=document.createElement("style");e.textContent+='\n      /* Modal */\n\n      #gmc\n      {\n        display: inline-flex !important;\n        justify-content: center !important;\n        align-items: center !important;\n        position: fixed !important;\n        top: 0 !important;\n        left: 0 !important;\n        width: 100vw !important;\n        height: 100vh !important;\n        z-index: 9999;\n        background: none !important;\n\n        pointer-events: none;\n      }\n\n      #gmc.hidden\n      {\n        display: none !important;\n      }\n\n      #gmc-frame\n      {\n        font-family: -apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";\n        text-align: left;\n\n        inset: initial !important;\n        border: none !important;\n        max-height: initial !important;\n        max-width: initial !important;\n        opacity: 1 !important;\n        position: static !important;\n        z-index: initial !important;\n\n        width: 85% !important;\n        height: 75% !important;\n        overflow-y: auto !important;\n\n        border: none !important;\n        border-radius: 0.375rem !important;\n\n        pointer-events: auto;\n      }\n\n      #gmc-frame_wrapper\n      {\n        display: flow-root !important;\n        padding: 2rem !important;\n      }\n\n      /* Sections */\n\n      #gmc-frame #gmc-frame_section_0\n      {\n        width: 100%;\n        border-radius: 6px;\n        display: table;\n      }\n\n      #gmc-frame #gmc-frame_section_1,\n      #gmc-frame #gmc-frame_section_2,\n      #gmc-frame #gmc-frame_section_3,\n      #gmc-frame #gmc-frame_section_4\n      {\n        margin-top: 2rem;\n        width: 49%;\n        box-sizing: border-box;\n      }\n\n      #gmc-frame #gmc-frame_section_1\n      {\n        border-radius: 6px;\n        float: left;\n      }\n\n      #gmc-frame #gmc-frame_section_2\n      {\n        border-radius: 6px;\n        float: right;\n      }\n\n      #gmc-frame #gmc-frame_section_3\n      {\n        width: 49%;\n        margin-top: 2rem;\n        box-sizing: border-box;\n        border-radius: 6px;\n        float: left;\n      }\n\n      #gmc-frame #gmc-frame_section_4\n      {\n        display: inline-grid;\n        width: 49%;\n        margin-top: 2rem;\n        box-sizing: border-box;\n        border-radius: 6px;\n        float: right\n      }\n\n      #gmc-frame #gmc-frame_section_3 .config_var:not(:last-child),\n      #gmc-frame #gmc-frame_section_4 .config_var:not(:last-child)\n      {\n        padding-bottom: 1rem;\n      }\n\n      /* Fields */\n\n      #gmc-frame .config_header\n      {\n        font-size: 2em;\n        font-weight: 400;\n        line-height: 1.25;\n\n        padding-bottom: 0.3em;\n        margin-bottom: 16px;\n      }\n\n      #gmc-frame #gmc-frame_type_var\n      {\n        display: inline-flex;\n      }\n\n      #gmc-frame .section_header\n      {\n        font-size: 1.5em;\n        font-weight: 600;\n        line-height: 1.25;\n\n        margin-bottom: 16px;\n        padding: 1rem 1.5rem;\n      }\n\n      #gmc-frame .section_desc,\n      #gmc-frame h3\n      {\n        background: none;\n        border: none;\n        font-size: 1.25em;\n\n        margin-bottom: 16px;\n        font-weight: 600;\n        line-height: 1.25;\n        text-align: left;\n      }\n\n      #gmc-frame .config_var\n      {\n        padding: 0rem 1.5rem;\n        margin-bottom: 1rem;\n        display: flex;\n      }\n\n      #gmc-frame .config_var[id*=\'flipCreateInbox_var\'],\n      #gmc-frame .config_var[id*=\'flipIssuesPullRequests_var\']\n      {\n        display: flex;\n      }\n\n      #gmc-frame .field_label\n      {\n        font-weight: 600;\n        margin-right: 0.5rem;\n      }\n\n      #gmc-frame .field_label,\n      #gmc-frame .gmc-label\n      {\n        width: 15vw;\n      }\n\n      #gmc-frame .radio_label:not(:last-child)\n      {\n        margin-right: 4rem;\n      }\n\n      #gmc-frame .radio_label\n      {\n        line-height: 17px;\n      }\n\n      #gmc-frame .gmc-label\n      {\n        display: table-caption;\n        line-height: 17px;\n      }\n\n      #gmc-frame input[type="radio"]\n      {\n        appearance: none;\n        border-style: solid;\n        cursor: pointer;\n        height: 1rem;\n        place-content: center;\n        position: relative;\n        width: 1rem;\n        border-radius: 624rem;\n        transition: background-color 0s ease 0s, border-color 80ms cubic-bezier(0.33, 1, 0.68, 1) 0s;\n        margin-right: 0.5rem;\n        flex: none;\n      }\n\n      #gmc-frame input[type="checkbox"]\n      {\n        appearance: none;\n        border-style: solid;\n        border-width: 1px;\n        cursor: pointer;\n        place-content: center;\n        position: relative;\n        height: 17px;\n        width: 17px;\n        border-radius: 3px;\n        transition: background-color 0s ease 0s, border-color 80ms cubic-bezier(0.33, 1, 0.68, 1) 0s;\n      }\n\n      #gmc-frame #gmc-frame_field_type\n      {\n        display: flex;\n      }\n\n      #gmc-frame input[type="radio"]:checked\n      {\n        border-width: 0.25rem;\n      }\n\n      #gmc-frame input[type="radio"]:checked,\n      #gmc-frame .gmc-checkbox:checked\n      {\n        border-color: #2f81f7;\n      }\n\n      #gmc-frame .gmc-checkbox:checked\n      {\n        background-color: #2f81f7;\n      }\n\n      #gmc-frame .gmc-checkbox:checked::before\n      {\n        visibility: visible;\n        transition: visibility 0s linear 0s;\n      }\n\n      #gmc-frame .gmc-checkbox::before,\n      #gmc-frame .gmc-checkbox:indeterminate::before\n      {\n        animation: 80ms cubic-bezier(0.65, 0, 0.35, 1) 80ms 1 normal forwards running checkmarkIn;\n      }\n\n      #gmc-frame .gmc-checkbox::before\n      {\n        width: 1rem;\n        height: 1rem;\n        visibility: hidden;\n        content: "";\n        background-color: #FFFFFF;\n        clip-path: inset(0);\n        -webkit-mask-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iOSIgdmlld0JveD0iMCAwIDEyIDkiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTEuNzgwMyAwLjIxOTYyNUMxMS45MjEgMC4zNjA0MjcgMTIgMC41NTEzMDUgMTIgMC43NTAzMTNDMTIgMC45NDkzMjEgMTEuOTIxIDEuMTQwMTkgMTEuNzgwMyAxLjI4MUw0LjUxODYgOC41NDA0MkM0LjM3Nzc1IDguNjgxIDQuMTg2ODIgOC43NiAzLjk4Nzc0IDguNzZDMy43ODg2NyA4Ljc2IDMuNTk3NzMgOC42ODEgMy40NTY4OSA4LjU0MDQyTDAuMjAxNjIyIDUuMjg2MkMwLjA2ODkyNzcgNS4xNDM4MyAtMC4wMDMzMDkwNSA0Ljk1NTU1IDAuMDAwMTE2NDkzIDQuNzYwOThDMC4wMDM1NTIwNSA0LjU2NjQzIDAuMDgyMzg5NCA0LjM4MDgxIDAuMjIwMDMyIDQuMjQzMjFDMC4zNTc2NjUgNC4xMDU2MiAwLjU0MzM1NSA0LjAyNjgxIDAuNzM3OTcgNC4wMjMzOEMwLjkzMjU4NCA0LjAxOTk0IDEuMTIwOTMgNC4wOTIxNyAxLjI2MzM0IDQuMjI0ODJMMy45ODc3NCA2Ljk0ODM1TDEwLjcxODYgMC4yMTk2MjVDMTAuODU5NSAwLjA3ODk5MjMgMTEuMDUwNCAwIDExLjI0OTUgMEMxMS40NDg1IDAgMTEuNjM5NSAwLjA3ODk5MjMgMTEuNzgwMyAwLjIxOTYyNVoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo=");\n        -webkit-mask-size: 75%;\n        -webkit-mask-repeat: no-repeat;\n        -webkit-mask-position: center center;\n        display: block;\n      }\n\n      #gmc-frame .gmc-checkbox\n      {\n        appearance: none;\n        border-style: solid;\n        border-width: 1px;\n        cursor: pointer;\n\n        height: var(--base-size-16,16px);\n        margin: 0.125rem 0px 0px;\n        place-content: center;\n        position: relative;\n        width: var(--base-size-16,16px);\n        border-radius: 3px;\n        transition: background-color 0s ease 0s, border-color 80ms cubic-bezier(0.33, 1, 0.68, 1) 0s;\n      }\n\n      #gmc-frame input\n      {\n        color: fieldtext;\n        letter-spacing: normal;\n        word-spacing: normal;\n        text-transform: none;\n        text-indent: 0px;\n        text-shadow: none;\n        display: inline-block;\n        text-align: start;\n        appearance: auto;\n        -webkit-rtl-ordering: logical;\n      }\n\n      #gmc-frame .gmc-checkbox:checked\n      {\n        transition: background-color 0s ease 0s, border-color 80ms cubic-bezier(0.32, 0, 0.67, 0) 0ms;\n      }\n\n      #gmc-frame input[type="text"],\n      #gmc-frame textarea,\n      #gmc-frame select\n      {\n        padding: 5px 12px;\n        border-radius: 6px;\n      }\n\n      #gmc-frame input[type="text"]:focus,\n      #gmc-frame textarea:focus,\n      #gmc-frame select:focus\n      {\n        border-color: #2f81f7;\n        outline: 1px solid #2f81f7;\n      }\n\n      #gmc-frame svg\n      {\n        height: 17px;\n        width: 17px;\n        margin-left: 0.5rem;\n      }\n\n      #gmc small\n      {\n        font-size: x-small;\n        font-weight: 600;\n        margin-left: 3px;\n      }\n\n      /* Button bar */\n\n      #gmc-frame #gmc-frame_buttons_holder\n      {\n        position: fixed;\n        width: 85%;\n        text-align: right;\n\n        left: 50%;\n        bottom: 2%;\n        transform: translate(-50%, 0%);\n        padding: 1rem;\n\n        border-radius: 0.375rem;\n\n        display: flex;\n        align-items: center;\n      }\n\n      #gmc-frame #gmc-frame_buttons_holder .left-aligned\n      {\n        order: 1;\n        margin-right: auto;\n      }\n\n      #gmc-frame #gmc-frame_buttons_holder > *\n      {\n        order: 2;\n      }\n\n      #gmc-frame .saveclose_buttons\n      {\n        margin-left: 0.5rem;\n      }\n\n      #gmc-frame [type=button],\n      #gmc-frame .saveclose_buttons\n      {\n        position: relative;\n        display: inline-block;\n        padding: 5px 16px;\n        font-size: 14px;\n        font-weight: 500;\n        line-height: 20px;\n        white-space: nowrap;\n        vertical-align: middle;\n        cursor: pointer;\n        -webkit-user-select: none;\n        user-select: none;\n        border: 1px solid;\n        border-radius: 6px;\n        -webkit-appearance: none;\n        appearance: none;\n\n        font-family: -apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";\n      }\n\n      @keyframes fadeOut\n      {\n        from {\n          opacity: 1;\n        }\n        to {\n          opacity: 0;\n        }\n      }\n\n      #gmc-saved\n      {\n        display: none;\n        margin-right: 10px;\n        animation: fadeOut 0.75s ease 2s forwards;\n      }\n\n        #gmc-frame\n        {\n          background-color: #F6F8FA;\n          color: #1F2328;\n          box-shadow: 0 0 0 1px #D0D7DE, 0 16px 32px rgba(1,4,9,0.2) !important;\n        }\n\n        #gmc-frame .section_header_holder\n        {\n          background-color: #FFFFFF;\n          border: 1px solid #D0D7DE;\n        }\n\n        #gmc-frame_buttons_holder\n        {\n          background-color: #FFFFFF;\n          box-shadow: 0 0 0 1px #D0D7DE, 0 16px 32px rgba(1,4,9,0.2) !important;\n        }\n\n        #gmc-frame input[type="text"],\n        #gmc-frame textarea,\n        #gmc-frame select\n        {\n          border: 1px solid #D0D7DE;\n        }\n\n        #gmc-frame select\n        {\n          background-color: #F6F8FA;\n        }\n\n        #gmc-frame select:hover\n        {\n          background-color: #F3F4F6;\n          border-color: #1F232826;\n        }\n\n        #gmc-frame input[type="text"],\n        #gmc-frame textarea\n        {\n          background-color: #F6F8FA;\n          color: #1F2328;\n        }\n\n        #gmc-frame input[type="text"]:focus,\n        #gmc-frame textarea:focus\n        {\n          background-color: #FFFFFF;\n        }\n\n        #gmc-frame [type=button],\n        #gmc-frame .saveclose_buttons\n        {\n          background-color: #f6f8fa;\n          border-color: #1f232826;\n          box-shadow: 0 1px 0 rgba(31,35,40,0.04), inset 0 1px 0 rgba(255,255,255,0.25);\n          color: #24292f;\n        }\n\n        #gmc-frame [type=button]:hover,\n        #gmc-frame .saveclose_buttons:hover\n        {\n          background-color: #f3f4f6;\n          border-color: #1f232826;\n        }\n\n        #gmc-frame .gmc-checkbox\n        {\n          border-color: #6E7781;\n        }\n\n        #gmc-frame input[type="radio"]\n        {\n          color: #6E7781;\n        }\n\n        #gmc-frame svg\n        {\n          fill: #000000;\n        }\n\n        #gmc-frame .section_header\n        {\n          border-bottom: 1px solid #D0D7DE;\n        }\n\n        #gmc-frame #gmc-frame_section_3 .config_var:not(:last-child),\n        #gmc-frame #gmc-frame_section_4 .config_var:not(:last-child)\n        {\n          border-bottom: 1px solid #D0D7DE;\n        }\n\n        #gmc-frame #gmc-frame_saveBtn\n        {\n          background-color: #1F883D;\n          border-color: rgba(31, 35, 40, 0.15);\n          box-shadow: rgba(31, 35, 40, 0.1) 0px 1px 0px;\n          color: #FFFFFF;\n        }\n\n        #gmc-frame #gmc-frame_saveBtn:hover\n        {\n          background-color: rgb(26, 127, 55);\n        }\n\n        #gmc-frame #gmc-frame_section_4\n        {\n          border: 1px solid #FF818266;\n        }\n\n        #gmc-frame #gmc-frame_section_4 input\n        {\n          background-color: #F6F8FA;\n          border-color: #1F232826;\n          box-shadow: 0 1px 0 rgba(31,35,40,0.04), inset 0 1px 0 rgba(255,255,255,0.25);\n          color: #CF222E;\n        }\n\n        #gmc-frame #gmc-frame_section_4 input:hover\n        {\n          background-color: #A40E26;\n          border-color: #1F232826;\n          box-shadow: 0 1px 0 rgba(31,35,40,0.04);\n          color: #ffffff;\n        }\n\n        #gmc-saved\n        {\n          color: #1a7f37;\n        }\n\n        #gmc-saved svg path\n        {\n          fill: #1a7f37;\n        }\n\n        #gmc-frame .reset_holder {\n          display: none;\n        }\n\n        #gmc-frame_hideByTagList_var {\n            display: none !important;\n        }\n      ',document.head.appendChild(e)}(),t.get(0)}function c(){C.d("gmcInitialized()"),k.css.basic="",function(){let e=k.get("logLevel");"error"==e?C.setLogLevel(C.LogLevel.Error):"warning"==e?C.setLogLevel(C.LogLevel.Warning):"info"==e?C.setLogLevel(C.LogLevel.Info):"debug"==e&&C.setLogLevel(C.LogLevel.Verbose)}(),te=setInterval(_,1e3),setInterval(function(){if(location.href!=j){if(!O)return void(location.href=location.href);$(".pp-main").length>0&&$(".pp-main").remove(),j=location.href,clearInterval(te),clearInterval(ne),clearInterval(Y),Y=null,D=-1,te=setInterval(_,300)}},1e3)}function g(){C.d("gmcOpened()"),$("#gmc").removeClass("hidden"),$("#gmc-frame_saveBtn").text(F[B].setting_save),$("#gmc-frame_closeBtn").text(F[B].setting_close),function e(){C.d("updateCheckboxes()");const t=$('#gmc-frame input[type="checkbox"]');t.length>0?t.addClass("gmc-checkbox"):setTimeout(e,100)}()}function u(){C.d("gmcSaved()");let e,t=k.get("lang");"Auto"==t?e=P:"简体中文"==t?e=L:"English"==t?e=T:"Русский язык"==t?e=M:"日本語"==t&&(e=I),v("PixivPreviewLang",e),location.href=location.href}function h(){C.d("gmcClosed()")}function f(){function t(){function t(){let e=$(".pp-main");0!=e.length&&("none"==e.css("display")?(C.d("Show main."),i(),e.show(),S.previewFullScreen&&s()):(C.d("Hide main."),e.hide(),S.previewFullScreen&&d()))}function c(){let e=$(".pp-main");0!=e.length&&"none"==e.css("display")&&(C.d("Show main."),i(),e.show(),S.scrollLockWhenPreview&&s())}let g=J[D].GetProcessedPageElements();g.loadingComplete?(S.previewByKey&&($(document).unbind("keydown"),$(document).keydown(e=>{e.keyCode==S.previewKey&&t()})),$(g.controlElements).mouseenter(function(n){if(n.ctrlKey)return;let o=(new Date).getTime(),g=parseInt(S.previewDelay),u=$(this),h=u.attr("illustId"),f=u.attr("illustType"),m=u.attr("pageCount");if(null==h)return void C.e("Can not found illustId in this element's attrbutes.");if(null==f)return void C.e("Can not found illustType in this element's attrbutes.");if(null==m)return void C.e("Can not found pageCount in this element's attrbutes.");if(a=h,2==f&&!S.enableAnimePreview)return void C.d("Anime preview disabled.");z={x:n.pageX,y:n.pageY};let v=$(document.createElement("div")).addClass("pp-main").attr("illustId",h).css({position:"absolute","z-index":"999999",left:z.x+"px",top:z.y+"px","border-style":"solid","border-color":"#6495ed","border-width":"2px","border-radius":"20px",width:"48px",height:"48px","background-image":"url(https://pp-1252089172.cos.ap-chengdu.myqcloud.com/transparent.png)",display:"none","text-align":"center"});if($(".pp-main").remove(),$("body").append(v),S.previewFullScreen&&(v.css({background:"#ffffff80",position:"fixed"}),v.click(e=>{$(e.target).hasClass("pp-image")||t()})),!S.previewByKey){let e=g-((new Date).getTime()-o);e>0?setTimeout(c,e):c()}let b=$(new Image).addClass("pp-loading").attr("src",H).css({position:"absolute","border-radius":"20px",left:"0px",top:"0px"});v.append(b);let w=$(new Image).addClass("pp-image").css({height:"0px",width:"0px",display:"none","border-radius":"20px"});v.append(w);let x=$(new Image).addClass("pp-original").attr("src","https://source.pixiv.net/www/images/pixivcomic-favorite.png").css({position:"absolute",bottom:"5px",right:"5px",display:"none"});v.append(x),x.click(function(){window.open($(v).children("img")[1].src)});let _=$('<div class="pp-pageCount" style="display: flex;-webkit-box-align: center;align-items: center;box-sizing: border-box;margin-left: auto;height: 20px;color: rgb(255, 255, 255);font-size: 10px;line-height: 12px;font-weight: bold;flex: 0 0 auto;padding: 4px 6px;background: rgba(0, 0, 0, 0.32);border-radius: 10px;margin-top:5px;margin-right:5px;"><svg viewBox="0 0 9 10" width="9" height="10" style="stroke: none;line-height: 0;font-size: 0px;fill: currentcolor;"><path d="M8,3 C8.55228475,3 9,3.44771525 9,4 L9,9 C9,9.55228475 8.55228475,10 8,10 L3,10 C2.44771525,10 2,9.55228475 2,9 L6,9 C7.1045695,9 8,8.1045695 8,7 L8,3 Z M1,1 L6,1 C6.55228475,1 7,1.44771525 7,2 L7,7 C7,7.55228475 6.55228475,8 6,8 L1,8 C0.44771525,8 0,7.55228475 0,7 L0,2 C0,1.44771525 0.44771525,1 1,1 Z"></path></svg><span style="margin-left:2px;" class="pp-page">0/0</span></div>').css({position:"absolute",top:"0px",display:"none",right:"0px",display:"none"});v.append(_),$(".pp-main").mouseleave(function(){S.previewFullScreen||$(this).remove()});let y="";y=2==f?N.replace("#id#",h):"/ajax/illust/#id#/pages".replace("#id#",h),$.ajax(y,{method:"GET",success:function(t){if(C.d("Got artwork urls:"),C.d(t),!0!==t.error)if(h==a)if(2==f){let n=t.body.src,r=t.body.originalSrc,o=t.body.mime_type,c=t.body.frames;C.d("Process urls complete."),C.d(n),C.d(r),function(t,n,r,o,c,g){l=g,null==c&&(c=!1),S.original=c,S.previewFullScreen||$(".pp-image").mouseenter(function(){s()}).mouseleave(function(){d()}),p&&p.stop(),p=function(t){var n,i,r=document.createElement("canvas"),o={canvas:r,chunkSize:3e5,loop:!0,autoStart:!0,debug:!1};if(t)for(n in t)o[n]=t[n];return(i=new e(o)).canvas=r,i}({source:t,metadata:{mime_type:r,frames:o}}),$(p.canvas).mouseenter(function(){s()}).mouseleave(function(){d()}),$(p).on("frameLoaded",function(e,t){if(l!=a)return;if(0!=t)return;let n=$(".pp-image");n.after(p.canvas),n.remove();let r=$(p.canvas);r.addClass("pp-image"),$(".pp-loading").css("display","none");let o=e.currentTarget._frameImages[0].width,s=e.currentTarget._frameImages[0].height;r.attr({width:o,height:s}).css({"border-radius":"20px"}),r.attr({originWidth:o,originHeight:s}),i()})}(n,0,o,c,S.original,h)}else{let e=[],n=[];for(let i=0;i<t.body.length;i++)e.push(t.body[i].urls.regular),n.push(t.body[i].urls.original);C.d("Process urls complete."),C.d(e),C.d(n),r(e,0,n,S.original,h)}else C.d("Drop this preview request.");else C.e("Server responsed an error: "+t.message)},error:function(e){C.e("Request image urls failed!"),e&&C.d(e)}})}),$(g.controlElements).mouseleave(function(e){if(S.previewByKey)return;let t=$(this),n=t.attr("illustId"),i=(t.attr("illustType"),t.attr("pageCount"),$(e.relatedTarget)),r=!1;for(;i.hasClass("pp-main")&&i.attr("illustId")==n&&(r=!0),!(i.parent().length<1);)i=i.parent();r||($(".pp-main").remove(),S.scrollLockWhenPreview&&d())}),$(g.controlElements).mousemove(function(e){e.ctrlKey||4&e.buttons||(z.x=e.pageX,z.y=e.pageY,S.previewByKey&&"none"!=$(".pp-main").css("display")||i())}),S.scrollLockWhenPreview&&$(g.controlElements).bind("onwheel"in document.createElement("div")?"wheel":"mousewheel",function(e){$(".pp-image").trigger(e)}),J[D].HasAutoLoad&&null==Y&&(Y=setInterval(o,1e3),C.d("Auto load interval set.")),unsafeWindow.PreviewCallback=n,C.d("Callback function was inserted."),C.d(unsafeWindow.PreviewCallback),C.i("Preview enable succeed!")):C.e("Page not load, should not call Preview!")}function n(e,t){C.d("iframe callback, width: "+e+", height: "+t);let n=i();$(".pp-loading").hide(),$(".pp-iframe").css({width:n.width,height:n.height}).show()}function i(){let e=document.documentElement.clientWidth,t=document.documentElement.clientHeight,n=0,i=document.body.scrollTop+document.documentElement.scrollTop,r=0,o=0;$(".pp-main").find("canvas").length>0?(r=null==$(".pp-image").get(0)?0:$(".pp-image").get(0).width,o=null==$(".pp-image").get(0)?0:$(".pp-image").get(0).height):($(".pp-image").css({width:"",height:""}),r=null==$(".pp-image").get(0)?0:$(".pp-image").get(0).width,o=null==$(".pp-image").get(0)?0:$(".pp-image").get(0).height);let a=48,l=48;if(S.previewFullScreen)return a=e,l=o/r*a,l>t&&(l=t,a=l/o*r),l-=5,a-=5,$(".pp-image").css({height:l+"px",width:a+"px"}),$(".pp-main").css({left:"0px",top:"0px",width:e-5,height:t-5}),{width:a,height:l};let s=z.x>e/2;return r>0&&o>0&&(a=s?z.x-30:e-z.x-30,l=o/r*a,l>t&&(l=t,a=l/o*r),a-=5,l-=5,$(".pp-image").css({height:l+"px",width:a+"px"}),$(".pp-loading").css({left:a/2-24+"px",top:l/2-24+"px"})),i+l<=z.y&&(i=z.y-l-30),n=s?z.x-a-30:z.x+30,$(".pp-main").css({left:n+"px",top:i+"px",width:a,height:l}),{width:a,height:l}}function r(e,t,n,o,p){l=p,e&&0!==e.length?null==t||t<0||t>=e.length?C.e("Index("+t+") out of range, can not view images!"):(null!=n&&0!==n.length||(C.w("Original array is null, replace it with regular array."),n=e),n.length<e&&(C.w("Original array's length is less than regular array, replace it with regular array."),n=e),null==o&&(o=!1),n.length>1&&($(".pp-page").text(t+1+"/"+e.length),$(".pp-pageCount").show()),o?$(".pp-image").addClass("original"):$(".pp-image").removeClass("original"),S.original=o,$(".pp-original, .pp-pageCount").hide(),null!=$(".pp-image").attr("index")&&$(".pp-image").attr("pageCount")==e.length||($(".pp-image").attr("pageCount",e.length),$(".pp-image").on("click",function(t){let i=$(this),o=i.hasClass("original"),a=i.attr("index");if(a=null==a?0:parseInt(a),t.ctrlKey)o=!o,r(e,a,n,o,p);else if(t.shiftKey)window.open(n[a]);else{if(1==e.length)return;++a>=e.length&&(a=0),r(e,a,n,o,p);for(let t=a+1;t<e.length&&t<=a+3;t++)(new Image).src=o?n[t]:e[t]}}),$(".pp-image").bind("onwheel"in document.createElement("div")?"wheel":"mousewheel",function(t){let i=$(this),o=i.hasClass("original"),a=i.attr("index");if(a=null==a?0:parseInt(a),1==e.length)return!1;t.originalEvent.wheelDelta<0?++a>=e.length&&(a=0):--a<0&&(a=e.length-1),r(e,a,n,o,p);for(let t=a+1;t<e.length&&t<=a+3;t++)(new Image).src=o?n[t]:e[t];return!1}),S.previewFullScreen&&$(".pp-main").bind("onwheel"in document.createElement("div")?"wheel":"mousewheel",function(e){$(".pp-image").trigger(e)}),S.scrollLockWhenPreview||$(".pp-image").mouseenter(s),$(".pp-image").mouseleave(function(){d()}),$(".pp-image").on("load",function(){if(l!=a)return void C.i("(2)Drop this preview request.");let r=$(this),o=(i(),r.hasClass("original"));$(".pp-loading").css("display","none"),$(".pp-image").css("display",""),e.length>1&&$(".pp-pageCount").show(),o&&$(".pp-original").show();for(let i=t+1;i<e.length&&i<=t+3;i++)(new Image).src=o?n[i]:e[i]}).on("error",function(){C.e("Load image failed!")})),$(".pp-image").attr("src",o?n[t]:e[t]).attr("index",t)):C.e("Regular url array is null, can not view images!")}function o(){if(null==J[D].GetProcessedPageElements())return void C.e("Call ProcessPageElements first!");let e=J[D].GetProcessedPageElements(),n=J[D].ProcessPageElements();if(n.loadingComplete){if(e.controlElements.length!=n.controlElements.length||n.forceUpdate)return C.i("Page loaded "+(n.controlElements.length-e.controlElements.length)+" new work(s)."),x(n),function(){let e=J[D].GetProcessedPageElements();e.loadingComplete?($(e.controlElements).unbind("mouseenter").unbind("mouseleave").unbind("mousemove"),Y&&(clearInterval(Y),Y=null),C.i("Preview disable succeed!")):C.e("Page not load, should not call Preview!")}(),void t();if(e.controlElements.length>n.controlElements.length)return C.w("works become less?"),void(J[D].private.returnMap=e)}C.d("Page not change.")}let a="",l="";var p;t()}function m(){function e(){let e=$("section:first").find("ul:first");return 0==e.length?(C.e("Can not found novel list."),null):e}function t(){return location.search.substr(1).replace(/&?p=\d+/,"")}function n(e,i,r,a){function l(t,o){t&&t.body&&t.body.novel&&t.body.novel.data&&(p=p.concat(t.body.novel.data)),i==r-1?o(p):n(e,i+1,r,a).then(function(e){e&&e.length>0&&(p=p.concat(e)),o(p)})}null==a&&(a=r-i);let s=location.origin+"/ajax/search/novels/#key#?word=#key#&p=#page#".replace(/#key#/g,e).replace(/#page#/g,i),d=t();d.length>0&&(s+="&"+d),o(F[B].nsort_getWorks.replace("1%",a-r+i+1).replace("2%",a));let p=[];return new Promise(function(e){$.ajax({url:s,success:function(t){l(t,e)},error:function(){C.e("get novel page "+i+" failed!"),l(null,e)}})})}function i(){let t=e();null!=t?t.hide().before('<div id="loading" style="width:100%;text-align:center;"><img src="'+H+'" /><p id="progress" style="text-align: center;font-size: large;font-weight: bold;padding-top: 10px;">0%</p></div>'):C.e("Can not found novel section!")}function r(){let t=e();null!=t?($("#loading").remove(),t.show()):C.e("Can not found novel section!")}function o(e){$("#progress").text(e)}!function(){let a=function(){let e=location.pathname.match(/\/tags\/(.+)\/novels/);return e?e[1]:""}();if(0==a.length)return void C.e("Parse key word error.");let l=function(){let e=location.search.match(/p=(\d+)/);return e?parseInt(e[1]):1}();if("off"==$(".gtm-novel-searchpage-gs-toggle-button").attr("data-gtm-label"))return i(),$(".gtm-novel-searchpage-gs-toggle-button").parent().next().text(),$("#loading").find("#progress").text('由于启用了 "'+$(".gtm-novel-searchpage-gs-toggle-button").parent().next().text()+'"，无法进行排序。'),void setTimeout(()=>r(),3e3);i(),function(){let e=J[V].GetPageSelector();if(0==e.length)return void C.e("can not found page selector!");let t=e.find("a:first").clone().attr("aria-disabled","false").removeAttr("hidden").addClass("pp-prevPage"),n=e.find("a:last").clone().attr("aria-disabled","false").removeAttr("hidden").addClass("pp-nextPage"),i=e.find("a").eq(1).clone().removeAttr("href"),r=location.href,o=r.match(/[?&]p=(\d+)/),a=1;o?a=parseInt(o[1]):""==location.search?r+="?p=1":r+="&p=1",1==a&&t.attr("hidden","hidden"),e.empty();let l=a-S.novelPageCount;t.attr("href",r.replace("?p="+a,"?p="+l).replace("&p="+a,"&p="+l)),e.append(t);for(let t=0;t<9;++t){let n=i.clone().text("Previewer"[t]);e.append(n)}let s=a+S.novelPageCount;n.attr("href",r.replace("?p="+a,"?p="+s).replace("&p="+a,"&p="+s)),e.append(n)}(),$(document).keydown(function(e){if(1==S.pageByKey)if(39==e.keyCode){let e=$(".pp-nextPage");if(e.length<1||"hidden"==e.attr("hidden"))return;location.href=e.attr("href")}else if(37==e.keyCode){let e=$(".pp-prevPage");if(e.length<1||"hidden"==e.attr("hidden"))return;location.href=e.attr("href")}}),n(a,l,l+S.novelPageCount).then(function(n){!function(n){let i=e();if(null==i)return;let o=function(e){if(!e)return null;if(0==e.length)return C.e("Empty list, can not create template."),null;let t=e.children().eq(0).clone(!0),n=t.children().eq(0).children().eq(0);n.find("a:first").addClass("pns-link"),n.find("img:first").addClass("pns-img");let i=t.children().eq(0).children().eq(1).children().eq(0),r=i.children().eq(0);if(r.children().length>1)r.children().eq(0).addClass("pns-series");else{let e=$('<a class="pns-series" href="/novel/series/000000"></a>');e.css({display:"inline-block","white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden","max-width":"100%","line-height":"22px","font-size":"14px","text-decoration":"none"}),$("head").append("<style>.pns-series:visited{color:rgb(173,173,173)}</style>"),r.prepend(e)}r.children().eq(1).children().eq(0).addClass("pns-title").addClass("pns-link"),i.find(".gtm-novel-searchpage-result-user:first").addClass("pns-author-img"),i.find(".gtm-novel-searchpage-result-user:last").addClass("pns-author");let o=i.children().eq(2).children().eq(0),a=o.children().eq(2);if(a.find("span:first").addClass("pns-text-count"),a.find("span").length<2){let e=a.find(".pns-text-count");e.append('<span class="pns-bookmark-count"><span><div class="sc-eoqmwo-1 grSeZG"><span class="sc-14heosd-0 gbNjEj"><svg viewBox="0 0 12 12" size="12" class="sc-14heosd-1 YtZop"><path fill-rule="evenodd" clip-rule="evenodd" d="M9 0.75C10.6569 0.75 12 2.09315 12 3.75C12 7.71703 7.33709 10.7126 6.23256 11.3666C6.08717 11.4526 5.91283 11.4526 5.76744 11.3666C4.6629 10.7126 0 7.71703 0 3.75C0 2.09315 1.34315 0.75 3 0.75C4.1265 0.75 5.33911 1.60202 6 2.66823C6.66089 1.60202 7.8735 0.75 9 0.75Z"></path></svg></span><span class="sc-eoqmwo-2 dfUmJJ">2,441</span></div></span></span>'),a.find(".pns-bookmark-count").addClass(e.get(0).className)}else a.find("span:last").addClass("pns-bookmark-count").parent().addClass("pns-bookmark-div");o.children().eq(0).empty().addClass("pns-tag-list"),o.children().eq(1).children().eq(0).addClass("pns-desc");let l=i.children().eq(2).children().eq(1),s=l.find("svg");return s.attr("class",s.attr("class")+" pns-like"),l.find("path:first").css("color","rgb(31, 31, 31)"),l.find("path:last").css("fill","rgb(255, 255, 255)"),t}(i);if(null==o)return;let a=[];$.each(n,function(e,n){let i=function(e,n){if(null==e||null==n)return null;let i=e.find(".pns-link:first").attr("href").replace(/id=\d+/g,"id="+n.id);if(e.find(".pns-link").attr("href",i),e.find(".pns-img").attr("src",n.url),n.seriesId){let t=e.find(".pns-series").attr("href").replace(/\d+$/,n.seriesId);e.find(".pns-series").text(n.seriesTitle).attr("title",n.seriesTitle).attr("href",t)}else e.find(".pns-series").hide();e.find(".pns-title").text(n.title).attr("title",n.title),e.find(".pns-title").parent().attr("title",n.title);let r=e.find(".pns-author").attr("href").replace(/\d+$/,n.userId);e.find(".pns-author").text(n.userName).attr("href",r),e.find(".pns-author-img").attr("href",r).find("img").attr("src",n.profileImageUrl),e.find(".pns-text-count").text(n.textCount+"文字"),0==n.bookmarkCount?e.find(".pns-bookmark-div").hide():e.find(".pns-bookmark-count").text(n.bookmarkCount);let o=e.find(".pns-tag-list"),a=t();a.length>0&&(a="?"+a),$.each(n.tags,function(e,t){let n=$('<span"><a style="color: rgb(61, 118, 153);" href="/tags/'+encodeURIComponent(t)+"/novels"+a+'">'+t+"</a></span>");"R-18"!=t&&"R-18G"!=t||n.find("a").css({color:"rgb(255, 64, 96)","font-weight":"bold"}).text(t),o.append(n)}),e.find(".pns-desc").html(n.description).attr("title",e.find(".pns-desc").text());let l=e.find(".pns-like");return l.attr("novel-id",n.id),n.bookmarkData&&(l.attr("bookmark-id",n.bookmarkData.id),l.find("path:first").css("color","rgb(255, 64, 96)"),l.find("path:last").css("fill","rgb(255, 64, 96)")),l.click(function(){if($(this).attr("disable"))return;let e=$(this).attr("bookmark-id"),t=$(this).attr("novel-id");e?function(e,t){if(""==A)return C.e("No g_csrfToken, failed to add bookmark!"),void alert("获取 Token 失败，无法添加，请到详情页操作。");e.attr("disable","disable"),C.i("delete bookmark: "+t),$.ajax("/ajax/novels/bookmarks/delete",{method:"POST",headers:{"x-csrf-token":A},data:{del:1,book_id:t},success:function(t){C.d("delete novel bookmark result: "),C.d(t),t.error?C.e("Server returned an error: "+t.message):(C.i("delete novel bookmark success"),e.removeAttr("bookmark-id"),e.find("path:first").css("color","rgb(31, 31, 31)"),e.find("path:last").css("fill","rgb(255, 255, 255)"),e.removeAttr("disable"))},error:function(){e.removeAttr("disable")}})}($(this),e):function(e,t){if(""==A)return C.e("No g_csrfToken, failed to add bookmark!"),void alert("获取 Token 失败，无法添加，请到详情页操作。");e.attr("disable","disable"),C.i("add bookmark: "+t),$.ajax("/ajax/novels/bookmarks/add",{method:"POST",contentType:"application/json;charset=utf-8",headers:{"x-csrf-token":A},data:'{"novel_id":"'+t+'","restrict":0,"comment":"","tags":[]}',success:function(t){if(C.d("add novel bookmark result: "),C.d(t),t.error)return void C.e("Server returned an error: "+t.message);let n=t.body;C.i("Add novel bookmark success, bookmarkId is "+n),e.attr("bookmark-id",n),e.find("path:first").css("color","rgb(255, 64, 96)"),e.find("path:last").css("fill","rgb(255, 64, 96)"),e.removeAttr("disable")},error:function(){e.removeAttr("disable")}})}($(this),t),$(this).blur()}),S.linkBlank&&e.find("a").attr("target","_blank"),e}(o.clone(!0),n);null!=i&&a.push(i)}),i.empty(),$.each(a,function(e,t){$(t).css("display","block"),i.append(t)}),r()}(function(e){o(F[B].nsort_sorting),e.sort(function(e,t){let n=e.bookmarkCount,i=t.bookmarkCount;return n||(n=0),i||(i=0),n>i?-1:n<i?1:0});let t=[];return $.each(e,function(e,n){let i=n.bookmarkCount;return i||(i=0),i<S.novelFavFilter||!(!S.novelHideFavorite||!n.bookmarkData)||void t.push(n)}),t}(n))})}()}function v(e,t){localStorage.setItem(e,JSON.stringify(t))}function b(e){return localStorage.getItem(e)||null}function w(){$("#pp-bg").remove();let e=$('<div id="pp-bg"></div>').css({width:document.documentElement.clientWidth+"px",height:document.documentElement.clientHeight+"px",position:"fixed","z-index":999999,"background-color":"rgba(0,0,0,0.8)",left:"0px",top:"0px"});$("body").append(e);let t=F[B].upgrade_body;e.get(0).innerHTML='<img id="pps-close"src="https://pp-1252089172.cos.ap-chengdu.myqcloud.com/Close.png"style="position: absolute; right: 35px; top: 20px; width: 32px; height: 32px; cursor: pointer;"><div style="position: absolute;width: 40%;left: 30%;top: 25%;font-size: 25px; text-align: center; color: white;">'+F[B].install_title+'</div><br><div style="position:absolute;left:50%;top:30%;font-size:20px;color:white;transform:translate(-50%,0);height:50%;overflow:auto;">'+t+"</div>",$("#pps-close").click(function(){$("#pp-bg").remove()})}function x(e){if(S.linkBlank){let t=[];$.each(e.controlElements,function(e,n){"A"==n.tagName&&t.push(n)}),$.each($(e.controlElements).find("a"),function(e,n){t.push(n)});let n=[];$.each(t,(e,t)=>{let i=$(t).find("polyline");if(i.length>0&&-1!=i.get(0).className.baseVal.indexOf("WedgeIcon_arrow"))return!0;n.push(t)}),$.each(n,function(e,t){$(t).attr({target:"_blank",rel:"external"}),D!=R&&D!=q&&D!=K&&D!=G||t.addEventListener("click",function(e){e.stopPropagation()})})}}function _(){function e(e=!1){try{D==K?(J[D].Work(),S.enablePreview&&f()):D==W?S.enableSort||e?(O=!1,function(e){function t(e,n,i){return new Promise(function(r){null==i&&(i=0);let o=[];$.ajax("https://www.pixiv.net/ajax/user/"+e+"/following?offset="+i+"&limit=100&rest="+n,{async:!0,success:function(a){if(null==a||a.error)return C.e("Following response contains an error."),void r([]);0!=a.body.users.length?($.each(a.body.users,function(e,t){o.push(t.userId)}),t(e,n,i+100).then(function(e){r(o.concat(e))})):r([])},error:function(){C.e("Request following failed."),r([])}})})}(S.pageCount<1||S.favFilter<0)&&(S.pageCount=3,S.favFilter=0);let n=0,r="https://www.pixiv.net/ajax/search/",o=0,a=[],l=0;if(D!=W)return;let s=function(e){$("#progress").text(F[B].sort_getWorks.replace("%1",n+1).replace("%2",S.pageCount));let t=r.replace(/p=\d+/,"p="+o);if(-1!=location.href.indexOf("?")){let e=location.href.split("?")[1];e=e.replace(/^p=\d+/,""),e=e.replace(/&p=\d+/,""),t+="&"+e}-1==t.indexOf("order=")&&(t+="&order=date_d"),-1==t.indexOf("mode=")&&(t+="&mode=all"),-1==t.indexOf("s_mode=")&&(t+="&s_mode=s_tag_full"),C.i("getWorks url: "+t);let i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=function(){e(i)},i.onerror=function(){C.e("Request search page error!")},i.send(null)};if(0===o){let e=location.href;-1==e.indexOf("&p=")&&-1==e.indexOf("?p=")&&(C.w("Can not found page in url."),-1==e.indexOf("?")?(e+="?p=1",C.d('Add "?p=1": '+e)):(e+="&p=1",C.d('Add "&p=1": '+e)));let t=e.match(/\/tags\/([^/]*)\//),n="";if(!t)return void C.e("Can not found search key word!");C.i("Search key word: "+n),n=t[1];let i=e.match(/p=(\d*)/)[1];o=parseInt(i),C.i("Current page: "+o);let a=e.match(/tags\/.*\/(.*)[?$]/)[1];r+=a+"/",r+=n+"?word="+n+"&p="+o,C.i("Current url: "+r)}else C.e("???");let d=J[W].GetImageListContainer();$(d).hide().before('<div id="loading" style="width:100%;text-align:center;"><img src="'+H+'" /><p id="progress" style="text-align: center;font-size: large;font-weight: bold;padding-top: 10px;">0%</p></div>');{let e=J[W].GetPageSelector();if(null==e)return void C.e("Can not found page selector!");if($(e).find("a").length>2){let t=$(e).find("a").get(1),n=[],i="Previewer";for(let e=0;e<9;e++){let r=t.cloneNode(!0);$(r).find("span").text(i[e]),n.push(r)}for($(e).find("button").remove();$(e).find("a").length>2;)$(e).find("a:first").next().remove();for(let t=0;t<9;t++)$(e).find("a:last").before(n[t]);$(e).find("a").attr("href","javascript:;");let r=location.href;-1==r.indexOf("&p=")&&-1==r.indexOf("?p=")&&(-1==r.indexOf("?")?r+="?p=1":r+="&p=1");let a=r.replace(/p=\d+/,"p="+(o-S.pageCount>1?o-S.pageCount:1)),l=r.replace(/p=\d+/,"p="+(o+S.pageCount));C.i("Previous page url: "+a),C.i("Next page url: "+l);let s=$(e).find("a:first");s.before(s.clone()),s.remove();let d=$(e).find("a:last");d.before(d.clone()),d.remove(),$(e).find("a:first").attr("href",a).addClass("pp-prevPage"),$(e).find("a:last").attr("href",l).addClass("pp-nextPage")}let t=function(e){let i=!1;try{let t=JSON.parse(e.responseText);if(!t.hasOwnProperty("error"))return void C.e('Key "error" not found!');if(!1!==t.error)return void C.e("ajax error!");{let e;t.body.illustManga?e=t.body.illustManga.data:t.body.manga?e=t.body.manga.data:t.body.illust&&(e=t.body.illust.data),e.length>0?a=a.concat(e):i=!0}}catch(t){C.e("A invalid json string!"),C.i(e.responseText)}if(o++,n++,i&&(C.w("No artworks found, ignore "+(S.pageCount-n)+" pages."),o+=S.pageCount-n,n=S.pageCount),n==S.pageCount){C.i("Load complete, start to load bookmark count."),C.d(a);let e=[],t=new Set;for(let n=0;n<a.length;n++)a[n].id&&!t.has(a[n].id)?(e.push(a[n]),t.add(a[n].id)):C.w("ignore work: "+a[n].id);a=e,l=a.length,C.i("Clear ad container complete."),C.d(a),u(0)}else s(t)};s(t)}let p=0,c=0,g=0,u=function(e){if(e>=a.length)return void h();let t=a.length-e;t>U&&(t=U),g=e+t;let n=0;for(let i=0;i<t;i++){let r=e+i,o=a[r].id;fetch("https://www.pixiv.net/ajax/illust/"+o,{credentials:"omit"}).then(e=>e.json()).then(e=>{e&&!e.error?(a[r].bookmarkCount=e.body.bookmarkCount,a[r].likeCount=e.body.likeCount,a[r].viewCount=e.body.viewCount,C.d("IllustId: "+a[r].id+", bookmarkCount: "+a[r].bookmarkCount)):(C.e("Some error occured: "+(e&&e.message)),a[r].bookmarkCount=0)}).catch(e=>{C.e("Fetch failed for illustId "+o+": "+e),a[r].bookmarkCount=0,++c}).finally(()=>{let e=F[B].sort_getBookmarkCount.replace("%1",++p).replace("%2",a.length);c>0&&(e+=" ("+c+" failed)"),$("#loading").find("#progress").text(e),++n===t&&u(g)})}},h=function(n=0){(function(e=0){return new Promise(function(n){C.i("Start sort."),C.d(a);let i=F[B].sort_filtering.replace("%2",S.favFilter);i=i.replace("%1",S.hideFavorite?F[B].sort_filteringHideFavorite:""),$("#progress").text(i);let r=[],o=0,l=0,s=0,d=0;$(a).each(function(e,t){if((t.bookmarkCount?t.bookmarkCount:0)<S.favFilter)return o++,!0;if(S.hideFavorite&&t.bookmarkData)return o++,!0;if(1==S.aiFilter&&2==t.aiType)return l++,!0;if(S.aiOnly&&2!=t.aiType)return!0;if(S.hideByTag){let e=null;try{S.hideByTagRegex&&""!==S.hideByTagRegex.trim()&&(e=new RegExp(S.hideByTagRegex))}catch(e){C.w("Invalid hideByTagRegex: "+S.hideByTagRegex)}if(e&&e.test(t.tags))return s++,!0}if(S.hideCountLessThan>=0&&S.hideCountMoreThan>=0){let e=S.hideCountLessThan,n=S.hideCountMoreThan,i=1;if(t.pageCount&&(i=t.pageCount),e>0&&i<e)return d++,!0;if(n>0&&i>n)return d++,!0}r.push(t)}),C.i(o+" works were hide by bookmark count."),C.i(l+" works were hide by AI type."),C.i(s+" works were hide by tag."),C.i(d+" works were hide by page count."),a=r,new Promise(function(e){S.hideFollowed?new Promise(function(e){let n="";try{n=dataLayer[0].user_id}catch(t){return C.e("Get user id failed."),void e([])}$("#progress").text(F[B].sort_getPublicFollowing);let i=b("followingOfUid-"+n);null==i||"null"==i?t(n,"show").then(function(i){$("#progress").text(F[B].sort_getPrivateFollowing),t(n,"hide").then(function(t){let r=i.concat(t);v("followingOfUid-"+n,r),e(r)})}):e(JSON.parse(i))}).then(function(t){let n=[],i=0;$(a).each(function(e,r){let o=!1;for(let e=0;e<t.length;e++)if(t[e]==r.userId){o=!0;break}o?i++:n.push(r)}),a=n,C.i(i+" works were hide by followed user."),C.d(a),e()}):e()}).then(function(){a.sort(function(t,n){let i=0,r=0;return 0==e?(i=t.bookmarkCount,r=n.bookmarkCount):1==e?(i=t.likeCount,r=n.likeCount):2==e&&(i=t.viewCount,r=n.viewCount),i||(i=0),r||(r=0),i>r?-1:i<r?1:0}),C.i("Sort complete."),C.d(a),n()})})})(n).then(function(){let t=J[W].GetImageListContainer(),r=J[W].GetFirstImageElement();if($(r).find("[data-mouseover]").removeAttr("data-mouseover"),null==ee){ee=r.cloneNode(!0);let e=$(ee).find(".pp-control");if(null==e)return void C.w("Cannot found some elements!");let t=e.find("a:first"),n=t.find("img:first"),i=n.parent(),o=t.parent(),a=e.next();null!=n&&null!=i&&null!=t&&null!=o&&null!=a||C.e("Can not found some elements!");let l=$("<a></a>");0==a.children().length?a.append(l):l=a.children("a:first");let s=a.next(),d=s.find("a:first"),p=s.find("a:last"),c=p,g=$(s.find("img").get(0)),u=t.next().find("svg"),h=t.children("div:last"),f=h.clone();f.css({top:"auto",bottom:"0px",width:"65%"}),h.parent().append(f),n.addClass("ppImg"),t.addClass("ppImageLink"),l.addClass("ppTitleLink"),d.addClass("ppAuthorLinkProfileImage"),p.addClass("ppAuthorLink"),c.addClass("ppAuthorName"),g.addClass("ppAuthorImage"),u.attr("class",u.attr("class")+" ppBookmarkSvg"),h.addClass("ppAdditionTag"),f.addClass("ppBookmarkCount"),n.attr("src","");let m=n.next();0!=m.length&&"SVG"==m.get(0).tagName&&m.remove(),h.empty(),f.empty(),u.find("path:first").css("fill","rgb(31, 31, 31)"),u.find("path:last").css("fill","rgb(255, 255, 255)"),i.find("svg").remove(),S.linkBlank&&(t.attr("target","_blank"),l.attr("target","_blank"),d.attr("target","_blank"),p.attr("target","_blank"))}$(t).empty();for(let e=0;e<a.length;e++){let r=$(ee.cloneNode(!0)),o=a[e].url;if(S.fullSizeThumb&&(o=i(a[e].url)),r.find(".ppImg").attr("src",o).css("object-fit","contain"),r.find(".ppImageLink").attr("href","/artworks/"+a[e].id),r.find(".ppTitleLink").attr("href","/artworks/"+a[e].id).text(a[e].title),r.find(".ppAuthorLink, .ppAuthorLinkProfileImage").attr("href","/member.php?id="+a[e].userId).attr({userId:a[e].userId,profileImageUrl:a[e].profileImageUrl,userName:a[e].userName}),r.find(".ppAuthorName").text(a[e].userName),r.find(".ppAuthorImage").parent().attr("titile",a[e].userName),r.find(".ppAuthorImage").attr("src",a[e].profileImageUrl),r.find(".ppBookmarkSvg").attr("illustId",a[e].id),a[e].bookmarkData&&(r.find(".ppBookmarkSvg").find("path").css("fill","rgb(255, 64, 96)"),r.find(".ppBookmarkSvg").attr("bookmarkId",a[e].bookmarkData.id)),0!==a[e].xRestrict){let e='<div style="margin-top: 2px; margin-left: 2px;"><div style="color: rgb(255, 255, 255);font-weight: bold;font-size: 10px;line-height: 1;padding: 3px 6px;border-radius: 3px;background: rgb(255, 64, 96);">R-18</div></div>';r.find(".ppAdditionTag").append(e)}if(a[e].pageCount>1){let t='<div style="display: flex;-webkit-box-align: center;align-items: center;box-sizing: border-box;margin-left: auto;height: 20px;color: rgb(255, 255, 255);font-size: 10px;line-height: 12px;font-weight: bold;flex: 0 0 auto;padding: 4px 6px;background: rgba(0, 0, 0, 0.32);border-radius: 10px;"><svg viewBox="0 0 9 10" width="9" height="10" style="stroke: none;line-height: 0;font-size: 0px;fill: currentcolor;"><path d="M8,3 C8.55228475,3 9,3.44771525 9,4 L9,9 C9,9.55228475 8.55228475,10 8,10 L3,10 C2.44771525,10 2,9.55228475 2,9 L6,9 C7.1045695,9 8,8.1045695 8,7 L8,3 Z M1,1 L6,1 C6.55228475,1 7,1.44771525 7,2 L7,7 C7,7.55228475 6.55228475,8 6,8 L1,8 C0.44771525,8 0,7.55228475 0,7 L0,2 C0,1.44771525 0.44771525,1 1,1 Z"></path></svg><span style="margin-left: 2px;">'+a[e].pageCount+"</span></div>";r.find(".ppAdditionTag").append(t)}let l="";0==n?l="❤️"+a[e].bookmarkCount:1==n?l="👍"+a[e].likeCount:2==n&&(l="👀"+a[e].viewCount);let s='<div style="margin-bottom: 6px; margin-left: 2px;"><div style="color: rgb(7, 95, 166);font-weight: bold;font-size: 13px;line-height: 1;padding: 3px 6px;border-radius: 3px;background: rgb(204, 236, 255);">'+l+"</div></div>";if(r.find(".ppBookmarkCount").append(s),2==a[e].illustType){let e='<svg viewBox="0 0 24 24" style="width: 48px; height: 48px;stroke: none;fill: rgb(255, 255, 255);line-height: 0;font-size: 0px;vertical-align: middle;position:absolute;"><circle cx="12" cy="12" r="10" style="fill: rgb(0, 0, 0);fill-opacity: 0.4;"></circle><path d="M9,8.74841664 L9,15.2515834 C9,15.8038681 9.44771525,16.2515834 10,16.2515834 C10.1782928,16.2515834 10.3533435,16.2039156 10.5070201,16.1135176 L16.0347118,12.8619342 C16.510745,12.5819147 16.6696454,11.969013 16.3896259,11.4929799 C16.3034179,11.3464262 16.1812655,11.2242738 16.0347118,11.1380658 L10.5070201,7.88648243 C10.030987,7.60646294 9.41808527,7.76536339 9.13806578,8.24139652 C9.04766776,8.39507316 9,8.57012386 9,8.74841664 Z"></path></svg>';r.find(".ppImg").after(e)}$(t).append(r)}if($(".ppBookmarkSvg").parent().on("click",function(e){if(""==A)return C.e("No g_csrfToken, failed to add bookmark!"),void alert("获取 Token 失败，无法添加，请到详情页操作。");let t=0;e.ctrlKey&&(t=1);let n=$(this).children("svg:first"),i=n.attr("illustId"),r=n.attr("bookmarkId");null==r||""==r?(C.i("Add bookmark, illustId: "+i),$.ajax("/ajax/illusts/bookmarks/add",{method:"POST",contentType:"application/json;charset=utf-8",headers:{"x-csrf-token":A},data:'{"illust_id":"'+i+'","restrict":'+t+',"comment":"","tags":[]}',success:function(e){if(C.d("addBookmark result: "),C.d(e),e.error)return void C.e("Server returned an error: "+e.message);let t=e.body.last_bookmark_id;C.i("Add bookmark success, bookmarkId is "+t),n.attr("bookmarkId",t),n.find("path").css("fill","rgb(255, 64, 96)")}})):(C.i("Delete bookmark, bookmarkId: "+r),$.ajax("/rpc/index.php",{method:"POST",headers:{"x-csrf-token":A},data:{mode:"delete_illust_bookmark",bookmark_id:r},success:function(e){C.d("delete bookmark result: "),C.d(e),e.error?C.e("Server returned an error: "+e.message):(C.i("Delete bookmark success."),n.attr("bookmarkId",""),n.find("path:first").css("fill","rgb(31, 31, 31)"),n.find("path:last").css("fill","rgb(255, 255, 255)"))}})),n.parent().focus()}),$(".ppAuthorLink").on("mouseenter",function(){let e=$(this),t=!1;$.ajax("https://www.pixiv.net/ajax/user/"+e.attr("userId")+"?full=1",{method:"GET",async:!1,success:function(e){0==e.error&&e.body.isFollowed&&(t=!0)}}),$(".pp-authorDiv").remove();let n=$('<div class="pp-authorDiv"><div class="ppa-main" style="position: absolute; top: 0px; left: 0px; border-width: 1px; border-style: solid; z-index: 1; border-color: rgba(0, 0, 0, 0.08); border-radius: 8px;"><div class=""style="    width: 336px;    background-color: rgb(255, 255, 255);    padding-top: 24px;    flex-flow: column;"><div class=""style=" display: flex; align-items: center; flex-flow: column;"><a class="ppa-authorLink"><div role="img"size="64"class=""style=" display: inline-block; width: 64px; height: 64px; border-radius: 50%; overflow: hidden;"><img class="ppa-authorImage" width="64"height="64"style="object-fit: cover; object-position: center top;"></div></a><a class="ppa-authorLink"><div class="ppa-authorName" style=" line-height: 24px; font-size: 16px; font-weight: bold; margin: 4px 0px 0px;"></div></a><div class=""style=" margin: 12px 0px 24px;"><button type="button"class="ppa-follow"style=" padding: 9px 25px; line-height: 1; border: none; border-radius: 16px; font-weight: 700; background-color: #0096fa; color: #fff; cursor: pointer;"><span style="margin-right: 4px;"><svg viewBox="0 0 8 8"width="10"height="10"class=""style=" stroke: rgb(255, 255, 255); stroke-linecap: round; stroke-width: 2;"><line x1="1"y1="4"x2="7"y2="4"></line><line x1="4"y1="1"x2="4"y2="7"></line></svg></span>关注</button></div></div></div></div></div>');$("body").append(n);let i=function e(t){if(t.offsetParent){let n=e(t.offsetParent);return{offsetTop:t.offsetTop+n.offsetTop,offsetLeft:t.offsetLeft+n.offsetLeft}}return{offsetTop:t.offsetTop,offsetLeft:t.offsetLeft}}(this);n.find(".ppa-main").css({top:i.offsetTop-196+"px",left:i.offsetLeft-113+"px"}),n.find(".ppa-authorLink").attr("href","/member.php?id="+e.attr("userId")),n.find(".ppa-authorImage").attr("src",e.attr("profileImageUrl")),n.find(".ppa-authorName").text(e.attr("userName")),t&&(n.find(".ppa-follow").get(0).outerHTML='<button type="button" class="ppa-follow followed" data-click-action="click" data-click-label="follow" style="padding: 9px 25px;line-height: 1;border: none;border-radius: 16px;font-size: 14px;font-weight: 700;cursor: pointer;">关注中</button>'),n.find(".ppa-follow").attr("userId",e.attr("userId")),n.on("mouseleave",function(){$(this).remove()}).on("mouseenter",function(){$(this).addClass("mouseenter")}),n.find(".ppa-follow").on("click",function(){let e=$(this).attr("userId");$(this).hasClass("followed")?$.ajax("https://www.pixiv.net/rpc_group_setting.php",{method:"POST",headers:{"x-csrf-token":A},data:"mode=del&type=bookuser&id="+e,success:function(e){C.d("delete bookmark result: "),C.d(e),"bookuser"==e.type?$(".ppa-follow").get(0).outerHTML='<button type="button"class="ppa-follow"style=" padding: 9px 25px; line-height: 1; border: none; border-radius: 16px; font-weight: 700; background-color: #0096fa; color: #fff; cursor: pointer;"><span style="margin-right: 4px;"><svg viewBox="0 0 8 8"width="10"height="10"class=""style=" stroke: rgb(255, 255, 255); stroke-linecap: round; stroke-width: 2;"><line x1="1"y1="4"x2="7"y2="4"></line><line x1="4"y1="1"x2="4"y2="7"></line></svg></span>关注</button>':C.e("Delete follow failed!")}}):$.ajax("https://www.pixiv.net/bookmark_add.php",{method:"POST",headers:{"x-csrf-token":A},data:"mode=add&type=user&user_id="+e+"&tag=&restrict=0&format=json",success:function(e){C.d("addBookmark result: "),C.d(e),0===e.length?$(".ppa-follow").get(0).outerHTML='<button type="button" class="ppa-follow followed" data-click-action="click" data-click-label="follow" style="padding: 9px 25px;line-height: 1;border: none;border-radius: 16px;font-size: 14px;font-weight: 700;cursor: pointer;">关注中</button>':C.e("Follow failed!")}})})}).on("mouseleave",function(){setTimeout(function(){$(".pp-authorDiv").hasClass("mouseenter")||$(".pp-authorDiv").remove()},200)}),0===a.length&&($(t).show().get(0).outerHTML='<div class=""style="display: flex;align-items: center;justify-content: center; height: 408px;flex-flow: column;"><div class=""style="margin-bottom: 12px;color: rgba(0, 0, 0, 0.16);"><svg viewBox="0 0 16 16"size="72"style="fill: currentcolor;height: 72px;vertical-align: middle;"><path d="M8.25739 9.1716C7.46696 9.69512 6.51908 10 5.5 10C2.73858 10 0.5 7.76142 0.5 5C0.5 2.23858 2.73858 0 5.5 0C8.26142 0 10.5 2.23858 10.5 5C10.5 6.01908 10.1951 6.96696 9.67161 7.75739L11.7071 9.79288C12.0976 10.1834 12.0976 10.8166 11.7071 11.2071C11.3166 11.5976 10.6834 11.5976 10.2929 11.2071L8.25739 9.1716ZM8.5 5C8.5 6.65685 7.15685 8 5.5 8C3.84315 8 2.5 6.65685 2.5 5C2.5 3.34315 3.84315 2 5.5 2C7.15685 2 8.5 3.34315 8.5 5Z"transform="translate(2.25 2.25)"fill-rule="evenodd"clip-rule="evenodd"></path></svg></div><span class="sc-LzMCO fLDUzU">'+F[B].sort_noWork.replace("%1",l)+"</span></div>"),$("#loading").remove(),$(t).show(),0==$("#sortTypeButtons").length){let e=$('<div id="sortTypeButtons" style="display:inline-flex; margin-bottom: 10px;"></div>'),n=$('<div style="cursor: pointer; box-sizing: border-box;text-decoration: none;display: flex;-webkit-box-align: center;align-items: center;border-radius: 4px;height: 40px;padding-right: 24px;padding-left: 24px;color: var(--charcoal-text5);background-color: rgb(131, 126, 200);">'+F[B].sort_sortByBookmark+"</div>"),i=$('<div style="cursor: pointer; box-sizing: border-box;text-decoration: none;display: flex;-webkit-box-align: center;align-items: center;border-radius: 4px;height: 40px;padding-right: 24px;padding-left: 24px;color: var(--charcoal-text5);background-color: rgb(200, 126, 173); margin-left: 10px;">'+F[B].sort_sortByLike+"</div>"),r=$('<div style="cursor: pointer; box-sizing: border-box;text-decoration: none;display: flex;-webkit-box-align: center;align-items: center;border-radius: 4px;height: 40px;padding-right: 24px;padding-left: 24px;color: var(--charcoal-text5);background-color: rgb(130, 200, 126); margin-left:10px">'+F[B].sort_sortByView+"</div>");n.click(()=>h(0)),i.click(()=>h(1)),r.click(()=>h(2)),e.append(n),e.append(i),e.append(r),$(t).before(e)}J[W].ProcessPageElements(),$(document).keydown(function(e){if(1==S.pageByKey)if(39==e.keyCode){let e=$(".pp-nextPage");if(e.length<1||"hidden"==e.attr("hidden"))return;location.href=e.attr("href")}else if(37==e.keyCode){let e=$(".pp-prevPage");if(e.length<1||"hidden"==e.attr("hidden"))return;location.href=e.attr("href")}}),e&&e()})}}(function(){O=!0,S.enablePreview&&f()})):S.enablePreview&&f():D==V?(S.enableNovelSort||e)&&m():S.enablePreview&&f()}catch(e){C.e("Unknown error: "+e)}}for(let e=0;e<Z;e++)if(J[e].CheckUrl(location.href)){D=e;break}if(!(D>=0))return C.w("Unsupported page."),void clearInterval(te);C.i("Current page is "+J[D].PageTypeString);let t=J[D].GetToolBar();if(t){if(C.d(t),clearInterval(te),window.onresize=function(){if($("#pp-bg").length>0){let e=document.documentElement.clientWidth,t=document.documentElement.clientHeight;$("#pp-bg").css({width:e+"px",height:t+"px"})}},U=parseInt(k.get("maxXhr")),S=function(){let e=function(){let e=b("PixivPreview");if(e&&"null"!=e){let t=JSON.parse(e);if(t)return k.set("enablePreview",t.enablePreview),k.set("enableAnimePreview",t.enableAnimePreview),k.set("enableSort",t.enableSort),k.set("enableAnimeDownload",t.enableAnimeDownload),k.set("original",t.original),k.set("previewDelay",t.previewDelay),k.set("previewByKey",t.previewByKey),k.set("pageCount",t.pageCount),k.set("favFilter",t.favFilter),k.set("aiFilter",t.aiFilter),k.set("aiOnly",t.aiOnly),k.set("hideFavorite",t.hideFavorite),k.set("hideFollowed",t.hideFollowed),k.set("hideByTag",t.hideByTag),k.set("hideByTagRegex",t.hideByTagRegex),k.set("linkBlank",t.linkBlank),k.set("pageByKey",t.pageByKey),k.set("fullSizeThumb",t.fullSizeThumb),k.set("enableNovelSort",t.enableNovelSort),k.set("novelPageCount",t.novelPageCount),k.set("novelFavFilter",t.novelFavFilter),k.set("novelHideFavorite",t.novelHideFavorite),v("PixivPreviewLang",parseInt(t.lang)),v("PixivPreview",null),!0}return!1}(),t="PixivPreviewVersion",n=b(t),i=null;return n&&(i=JSON.parse(n)),e?(v(t,E),w()):null==i?(v(t,E),function(){$("#pp-bg").remove();let e=$('<div id="pp-bg"></div>').css({width:document.documentElement.clientWidth+"px",height:document.documentElement.clientHeight+"px",position:"fixed","z-index":999999,"background-color":"rgba(0,0,0,0.8)",left:"0px",top:"0px"});$("body").append(e),e.get(0).innerHTML='<img id="pps-close"src="https://pp-1252089172.cos.ap-chengdu.myqcloud.com/Close.png"style="position: absolute; right: 35px; top: 20px; width: 32px; height: 32px; cursor: pointer;"><div style="position: absolute;width: 40%;left: 30%;top: 25%;font-size: 25px; text-align: center; color: white;">'+F[B].install_title+"</div><br>"+F[B].install_body,$("#pps-close").click(function(){$("#pp-bg").remove()})}()):i!=E&&(v(t,E),w()),function(){let e=k.get("hideByTagList");if(null!=e&&""!=e){let t=e.replace(/,|，/g,"|");k.set("hideByTagRegex",t),k.set("hideByTagList",""),k.save()}return{enablePreview:k.get("enablePreview"),enableAnimePreview:k.get("enableAnimePreview"),enableSort:k.get("enableSort"),enableAnimeDownload:k.get("enableAnimeDownload"),original:k.get("original"),previewDelay:parseInt(k.get("previewDelay"))||200,previewByKey:k.get("previewByKey"),pageCount:parseInt(k.get("pageCount"))||3,favFilter:parseInt(k.get("favFilter"))||0,aiFilter:k.get("aiFilter"),aiOnly:k.get("aiOnly"),hideFavorite:k.get("hideFavorite"),hideFollowed:k.get("hideFollowed"),hideByTag:k.get("hideByTag"),hideByTagRegex:k.get("hideByTagRegex"),hideCountLessThan:parseInt(k.get("hideCountLessThan"))||0,hideCountMoreThan:parseInt(k.get("hideCountMoreThan"))||0,linkBlank:k.get("linkBlank"),pageByKey:k.get("pageByKey"),fullSizeThumb:k.get("fullSizeThumb"),enableNovelSort:k.get("enableNovelSort"),novelPageCount:parseInt(k.get("novelPageCount"))||3,novelFavFilter:parseInt(k.get("novelFavFilter"))||0,novelHideFavorite:k.get("novelHideFavorite"),previewFullScreen:k.get("previewFullScreen"),previewKey:17,scrollLockWhenPreview:k.get("scrollLockWhenPreview")}}()}(),0===$("#pp-sort").length&&!S?.enableSort){const n=document.createElement("div"),i=document.createElement("button");i.id="pp-sort",i.style.cssText="background-color: rgb(0, 0, 0); margin-top: 5px; opacity: 0.8; cursor: pointer; border: none; padding: 0px; border-radius: 24px; width: 48px; height: 48px;",i.innerHTML=`<span style="color: white;vertical-align: text-top;">${F[B].text_sort}</span>`,n.appendChild(i),t.appendChild(n),$(i).click(function(){this.disabled=!0,e(!0),setTimeout(()=>{this.disabled=!1},7e3)})}if(0===$("#pp-nextPage-fixed").length){const e=document.createElement("div");e.innerHTML="";const n=document.createElement("button");n.id="pp-nextPage-fixed",n.style.cssText="background-color: rgb(0, 0, 0); margin-top: 5px; opacity: 0.8; cursor: pointer; border: none; padding: 12px; border-radius: 24px; width: 48px; height: 48px;",n.innerHTML='<svg viewBox="0 0 120 120" width="24" height="24" stroke="white" fill="none" stroke-width="10" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(90deg);"> <polyline points="60,105 60,8"></polyline> <polyline points="10,57 60,8 110,57"></polyline> </svg>',e.appendChild(n),t.appendChild(e),$(n).click(function(){let e=null,t=$(".pp-nextPage");e=t.length>0&&"hidden"!==t.attr("hidden")?t.attr("href"):[...document.querySelectorAll("nav")].find(e=>[...e.children].filter(e=>"A"===e.tagName).every(e=>/\?p=\d+$/.test(e.href)))?.lastElementChild?.href??null,null!=e&&(location.href=e)})}if(0===$("#pp-settings").length){const e=document.createElement("div"),n=document.createElement("button");n.id="pp-settings",n.style.cssText="background-color: rgb(0, 0, 0); margin-top: 5px; opacity: 0.8; cursor: pointer; border: none; padding: 12px; border-radius: 24px; width: 48px; height: 48px;",n.innerHTML='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000" xml:space="preserve" style="fill: white;"><metadata> Svg Vector Icons : http://www.sfont.cn </metadata><g><path d="M377.5,500c0,67.7,54.8,122.5,122.5,122.5S622.5,567.7,622.5,500S567.7,377.5,500,377.5S377.5,432.3,377.5,500z"></path><path d="M990,546v-94.8L856.2,411c-8.9-35.8-23-69.4-41.6-100.2L879,186L812,119L689,185.2c-30.8-18.5-64.4-32.6-100.2-41.5L545.9,10h-94.8L411,143.8c-35.8,8.9-69.5,23-100.2,41.5L186.1,121l-67,66.9L185.2,311c-18.6,30.8-32.6,64.4-41.5,100.3L10,454v94.8L143.8,589c8.9,35.8,23,69.4,41.6,100.2L121,814l67,67l123-66.2c30.8,18.6,64.5,32.6,100.3,41.5L454,990h94.8L589,856.2c35.8-8.9,69.4-23,100.2-41.6L814,879l67-67l-66.2-123.1c18.6-30.7,32.6-64.4,41.5-100.2L990,546z M500,745c-135.3,0-245-109.7-245-245c0-135.3,109.7-245,245-245s245,109.7,245,245C745,635.3,635.3,745,500,745z"></path></g></svg>',e.appendChild(n),t.appendChild(e),$(n).click(function(){k.open()})}D!=W&&D!=V||$.get(location.href,function(e){let t=e.match(/token\\":\\"([a-z0-9]{32})/);null!=t&&t.length>0?(A=t[1],C.d("Got g_csrfToken: "+A)):C.e("Can not get g_csrfToken, so you can not add works to bookmark when sorting has enabled.")}),ne=setInterval(function(){let t=J[D].ProcessPageElements();t.loadingComplete&&(C.d("Process page comlete, sorting and prevewing begin."),C.d(t),clearInterval(ne),x(t),e())},500)}else C.w("Get toolbar failed.")}var y,k,C=new function(){this.prefix="",this.v=function(t){e<=this.LogLevel.Verbose&&console.log(this.prefix+t)},this.i=function(t){e<=this.LogLevel.Info&&console.info(this.prefix+t)},this.w=function(t){e<=this.LogLevel.Warning&&console.warn(this.prefix+t)},this.e=function(t){e<=this.LogLevel.Error&&console.error(this.prefix+t)},this.d=function(t){e<=this.LogLevel.Verbose&&console.log(t)},this.setLogLevel=function(t){e=t},this.LogLevel={Verbose:0,Info:1,Warning:2,Error:3};let e=this.LogLevel.Warning};"undefined"!=typeof GM_xmlhttpRequest?GM_xmlhttpRequest:GM.xmlHttpRequest,e.prototype={_trailerBytes:3e4,_failed:!1,_mkerr:function(e){var t=this;return function(){t._error(e)}},_error:function(e){throw this._failed=!0,Error("ZipImagePlayer error: "+e)},_debugLog:function(e){this.op.debug&&console.log(e)},_load:function(e,t,n){var i,r=this,o=new XMLHttpRequest;o.addEventListener("load",function(){r._dead||(r._debugLog("Load: "+e+" "+t+" status="+o.status),200==o.status?(r._debugLog("Range disabled or unsupported, complete load"),e=0,t=o.response.byteLength,r._len=t,r._buf=o.response,r._bytes=new r._Uint8Array(r._buf)):(206!=o.status&&r._error("Unexpected HTTP status "+o.status),o.response.byteLength!=t&&r._error("Unexpected length "+o.response.byteLength+" (expected "+t+")"),r._bytes.set(new r._Uint8Array(o.response),e)),n&&n.apply(r,[e,t]))},!1),o.addEventListener("error",this._mkerr("Fetch failed"),!1),o.open("GET",this.op.source),o.responseType="arraybuffer",null!=e&&null!=t&&(i=e+t,o.setRequestHeader("Range","bytes="+e+"-"+(i-1)),this._isSafari&&(o.setRequestHeader("Cache-control","no-cache"),o.setRequestHeader("If-None-Match",Math.random().toString()))),o.send()},_startLoad:function(){var e=this;this.op.source?$.ajax({url:this.op.source,type:"HEAD"}).done(function(t,n,i){var r,o;if(!e._dead){if(e._pHead=0,e._pNextHead=0,e._pFetch=0,!(r=parseInt(i.getResponseHeader("Content-Length"))))return e._debugLog("HEAD request failed: invalid file length."),e._debugLog("Falling back to full file mode."),void e._load(null,null,function(t,n){e._pTail=0,e._pHead=n,e._findCentralDirectory()});e._debugLog("Len: "+r),e._len=r,e._buf=new e._ArrayBuffer(r),e._bytes=new e._Uint8Array(e._buf),(o=r-e._trailerBytes)<0&&(o=0),e._pTail=r,e._load(o,r-o,function(t){e._pTail=t,e._findCentralDirectory()})}}).fail(this._mkerr("Length fetch failed")):this._loadNextFrame()},_findCentralDirectory:function(){var e,t,n,i=new this._DataView(this._buf,this._len-22,22);101010256!=i.getUint32(0,!0)&&this._error("End of Central Directory signature not found"),e=i.getUint16(10,!0),t=i.getUint32(12,!0),(n=i.getUint32(16,!0))<this._pTail?this._load(n,this._pTail-n,function(){this._pTail=n,this._readCentralDirectory(n,t,e)}):this._readCentralDirectory(n,t,e)},_readCentralDirectory:function(e,t,n){var i,r,o,a,l,s,d,p,c,g,u=new this._DataView(this._buf,e,t),h=0;for(i=0;i<n;i++){for(33639248!=u.getUint32(h,!0)&&this._error("Invalid Central Directory signature"),r=u.getUint16(h+10,!0),o=u.getUint32(h+24,!0),a=u.getUint16(h+28,!0),l=u.getUint16(h+30,!0),s=u.getUint16(h+32,!0),d=u.getUint32(h+42,!0),0!=r&&this._error("Unsupported compression method"),h+=46,p=new this._Uint8Array(this._buf,e+h,a),c="",g=0;g<a;g++)c+=String.fromCharCode(p[g]);h+=a+l+s,this._files[c]={off:d,len:o}}this._pHead>=this._pTail?(this._pHead=this._len,$(this).triggerHandler("loadProgress",[this._pHead/this._len]),this._loadNextFrame()):(this._loadNextChunk(),this._loadNextChunk())},_loadNextChunk:function(){var e,t;this._pFetch>=this._pTail||(e=this._pFetch,t=this.op.chunkSize,this._pFetch+t>this._pTail&&(t=this._pTail-this._pFetch),this._pFetch+=t,this._load(e,t,function(){e==this._pHead?(this._pNextHead?(this._pHead=this._pNextHead,this._pNextHead=0):this._pHead=e+t,this._pHead>=this._pTail&&(this._pHead=this._len),$(this).triggerHandler("loadProgress",[this._pHead/this._len]),this._loadTimer||this._loadNextFrame()):this._pNextHead=e+t,this._loadNextChunk()}))},_fileDataStart:function(e){var t=new DataView(this._buf,e,30);return e+30+t.getUint16(26,!0)+t.getUint16(28,!0)},_isFileAvailable:function(e){var t=this._files[e];return t||this._error("File "+e+" not found in ZIP"),!(this._pHead<t.off+30)&&this._pHead>=this._fileDataStart(t.off)+t.len},_loadNextFrame:function(){var e,t,n,i,r,o,a,l,s;if(!(this._dead||(e=this._loadFrame)>=this._frameCount)){if(t=this.op.metadata.frames[e],!this.op.source)return this._loadFrame+=1,void this._loadImage(e,t.file,!1);if(this._isFileAvailable(t.file))if(this._loadFrame+=1,i=(n=this._fileDataStart(this._files[t.file].off))+this._files[t.file].len,o=this.op.metadata.mime_type||"image/png",this._URL){this._buf.slice?a=this._buf.slice(n,i):(a=new this._ArrayBuffer(this._files[t.file].len),new this._Uint8Array(a).set(this._bytes.subarray(n,i)));try{l=new this._Blob([a],{type:o})}catch(e){this._debugLog("Blob constructor failed. Trying BlobBuilder... ("+e.message+")"),(s=new this._BlobBuilder).append(a),l=s.getBlob()}r=this._URL.createObjectURL(l),this._loadImage(e,r,!0)}else r="data:"+o+";base64,"+function(e,t,n){var i,r,o,a="",l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=new Uint8Array(e),d=n%3,p=t+n-d;for(o=t;o<p;o+=3)i=(258048&(r=s[o]<<16|s[o+1]<<8|s[o+2]))>>12,a+=l[(16515072&r)>>18]+l[i]+l[(4032&r)>>6]+l[63&r];return 1==d?(i=(3&(r=s[p]))<<4,a+=l[(252&r)>>2]+l[i]+"=="):2==d&&(i=(1008&(r=s[p]<<8|s[p+1]))>>4,a+=l[(64512&r)>>10]+l[i]+l[(15&r)<<2]+"="),a}(this._buf,n,i-n),this._loadImage(e,r,!1)}},_loadImage:function(e,t,n){var i=this,r=new Image,o=this.op.metadata.frames[e];r.addEventListener("load",function(){i._debugLog("Loaded "+o.file+" to frame "+e),n&&i._URL.revokeObjectURL(t),i._dead||(i._frameImages[e]=r,$(i).triggerHandler("frameLoaded",e),0==i._loadingState&&i._displayFrame.apply(i),e>=i._frameCount-1?(i._setLoadingState(2),i._buf=null,i._bytes=null):!i._maxLoadAhead||e-i._frame<i._maxLoadAhead?i._loadNextFrame():i._loadTimer||(i._loadTimer=setTimeout(function(){i._loadTimer=null,i._loadNextFrame()},200)))}),r.src=t},_setLoadingState:function(e){this._loadingState!=e&&(this._loadingState=e,$(this).triggerHandler("loadingStateChanged",[e]))},_displayFrame:function(){var e,t,n;if(!this._dead){if(e=this,t=this.op.metadata.frames[this._frame],this._debugLog("Displaying frame: "+this._frame+" "+t.file),!(n=this._frameImages[this._frame]))return this._debugLog("Image not available!"),void this._setLoadingState(0);2!=this._loadingState&&this._setLoadingState(1),this.op.autosize&&(this._context.canvas.width==n.width&&this._context.canvas.height==n.height||(this._context.canvas.width=n.width,this._context.canvas.height=n.height)),this._context.clearRect(0,0,this.op.canvas.width,this.op.canvas.height),this._context.drawImage(n,0,0),$(this).triggerHandler("frame",this._frame),this._paused||(this._timer=setTimeout(function(){e._timer=null,e._nextFrame.apply(e)},t.delay))}},_nextFrame:function(){if(this._frame>=this._frameCount-1){if(!this.op.loop)return void this.pause();this._frame=0}else this._frame+=1;this._displayFrame()},play:function(){this._dead||this._paused&&($(this).triggerHandler("play",[this._frame]),this._paused=!1,this._displayFrame())},pause:function(){this._dead||this._paused||(this._timer&&clearTimeout(this._timer),this._paused=!0,$(this).triggerHandler("pause",[this._frame]))},rewind:function(){this._dead||(this._frame=0,this._timer&&clearTimeout(this._timer),this._displayFrame())},stop:function(){this._debugLog("Stopped!"),this._dead=!0,this._timer&&clearTimeout(this._timer),this._loadTimer&&clearTimeout(this._loadTimer),this._frameImages=null,this._buf=null,this._bytes=null,$(this).triggerHandler("stop")},getCurrentFrame:function(){return this._frame},getLoadedFrames:function(){return this._frameImages.length},getFrameCount:function(){return this._frameCount},hasError:function(){return this._failed}},y=function(){function e(){try{let e=unsafeWindow;return e.jQuery&&!e.$&&(e.$=e.jQuery),$(),!0}catch(e){return!1}}function t(i,r){if(i>=n.length)return C.e("无法加载 JQuery，正在退出。"),void r(!1);let o=function(e){let t=-1!=location.href.indexOf("https://"),n=-1!=e.indexOf("https://");return t&&!n?e.replace("http://","https://"):!t&&n?e.replace("https://","http://"):e}(n[i]);C.i("尝试第 "+(i+1)+" 个 JQuery CDN："+o+"。");let a=function(e){let t=document.createElement("script");return t.src=e,document.head.appendChild(t),t}(o);setTimeout(function(){e()?(C.i("已加载 JQuery。"),r(!0)):(C.w("无法访问。"),a.remove(),t(i+1,r))},100)}let n=["http://code.jquery.com/jquery-2.1.4.min.js","https://ajax.aspnetcdn.com/ajax/jquery/jquery-2.1.4.min.js","https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js","https://cdn.staticfile.org/jquery/2.1.4/jquery.min.js","https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"];return new Promise(function(n){e()?(C.i("已加载 jQuery。"),n(!0)):(C.i("未发现 JQuery，尝试加载。"),t(0,n))})};let P=-1,L=0,T=1,M=2,I=3,F={};F[L]={install_title:"欢迎使用 PixivPreviewer",install_body:'<div style="position: absolute;left: 50%;top: 30%;font-size: 20px; color: white;transform:translate(-50%,0);"><p style="text-indent: 2em;">欢迎反馈问题和提出建议！ ☞<a style="color: green;" href="https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/feedback" target="_blank">反馈页面</a></p><br><p style="text-indent: 2em;">如果您是第一次使用，推荐到 ☞<a style="color: green;" href="https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer" target="_blank">详情页</a> 查看脚本介绍。</p></div>',upgrade_body:'<h3>新的设置菜单!</h3>&nbsp&nbsp<p style="text-indent: 2em;">感谢各位使用 Pixiv Previewer,本次更新调整了设置菜单的视觉效果,欢迎反馈问题和提出建议! ☞<a style="color: green;" href="https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/feedback" target="_blank">反馈页面</a></p>',setting_settingSection:"设置",setting_language:"语言",setting_preview:"预览",setting_animePreview:"动图预览",setting_sortSection:"排序",setting_sort:"排序（仅搜索页生效）",setting_anime:"动图下载（动图预览及详情页生效）",setting_origin:"预览时优先显示原图（慢）",setting_previewDelay:"延迟显示预览图（毫秒）",setting_previewByKey:"使用按键控制预览图展示（Ctrl）",setting_previewByKeyHelp:"开启后鼠标移动到图片上不再展示预览图，按下Ctrl键才展示，同时“延迟显示预览”设置项不生效。",setting_maxPage:"每次排序时统计的最大页数",setting_hideWork:"隐藏收藏数少于设定值的作品",setting_hideAiWork:"隐藏 AI 生成作品",setting_onlyAiWork:"只显示 AI 生成作品",setting_hideFav:"排序时隐藏已收藏的作品",setting_hideFollowed:"排序时隐藏已关注画师作品",setting_hideByTag:"排序时隐藏指定标签的作品",setting_hideByTagPlaceholder:'输入标签名，如 "tag1|tag2"，支持正则',setting_clearFollowingCache:"清除缓存",setting_clearFollowingCacheHelp:"关注画师信息会在本地保存一天，如果希望立即更新，请点击清除缓存",setting_followingCacheCleared:"已清除缓存，请刷新页面。",setting_blank:"使用新标签页打开作品详情页",setting_turnPage:"使用键盘←→进行翻页（排序后的搜索页）",setting_save:"保存设置",setting_reset:"重置脚本",setting_resetHint:"这会删除所有设置，相当于重新安装脚本，确定要重置吗？",setting_novelSort:"小说排序",setting_novelMaxPage:"小说排序时统计的最大页数",setting_novelHideWork:"隐藏收藏数少于设定值的作品",setting_novelHideFav:"排序时隐藏已收藏的作品",setting_previewFullScreen:"全屏预览",setting_scrollLockWhenPreview:"预览时阻止页面滚动",setting_logLevel:"日志等级",setting_novelSection:"小说排序",setting_close:"关闭",setting_maxXhr:"收藏数并发（推荐 64）",setting_hideByCountLessThan:"隐藏图片张数少于设定值的作品",setting_hideByCountMoreThan:"隐藏图片张数多于设定值的作品",sort_noWork:"没有可以显示的作品（隐藏了 %1 个作品）",sort_getWorks:"正在获取第%1/%2页作品",sort_getBookmarkCount:"获取收藏数：%1/%2",sort_getPublicFollowing:"获取公开关注画师",sort_getPrivateFollowing:"获取私有关注画师",sort_filtering:"过滤%1收藏量低于%2的作品",sort_filteringHideFavorite:"已收藏和",sort_fullSizeThumb:"全尺寸缩略图（搜索页、用户页）",sort_sortByBookmark:"按❤️排序",sort_sortByLike:"按👍排序",sort_sortByView:"按👀排序",nsort_getWorks:"正在获取第1%/2%页作品",nsort_sorting:"正在按收藏量排序",nsort_hideFav:"排序时隐藏已收藏的作品",nsort_hideFollowed:"排序时隐藏已关注作者作品",text_sort:"排序"},F[T]={install_title:"Welcome to PixivPreviewer",install_body:'<div style="position: absolute;left: 50%;top: 30%;font-size: 20px; color: white;transform:translate(-50%,0);"><p style="text-indent: 2em;">Feedback questions and suggestions are welcome! ☞<a style="color: green;" href="https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/feedback" target="_blank">Feedback Page</a></p><br><p style="text-indent: 2em;">If you are using it for the first time, it is recommended to go to the ☞<a style="color: green;" href="https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer" target="_blank">Details Page</a> to see the script introduction.</p></div>',upgrade_body:'<h3>New settings menu!</h3>&nbsp&nbsp<p style="text-indent: 2em;">Thanks to all Pixiv Previewer users, this update adjusts the visual effect of the settings menu, and feedback questions and suggestions are welcome! ☞<a style="color: green;" href="https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/feedback" target="_blank">Feedback Page</a></p>',setting_settingSection:"Settings",setting_language:"Language",setting_preview:"Preview",setting_animePreview:"Animation preview",setting_sortSection:"Sorting",setting_sort:"Sorting (Search page)",setting_anime:"Animation download (Preview and Artwork page)",setting_origin:"Display original image when preview (slow)",setting_previewDelay:"Delay of display preview image(Million seconds)",setting_previewByKey:"Use keys to control the preview image display (Ctrl)",setting_previewByKeyHelp:'After enabling it, move the mouse to the picture and no longer display the preview image. Press the Ctrl key to display it, and the "Delayed Display Preview" setting item does not take effect.',setting_maxPage:"Maximum number of pages counted per sort",setting_hideWork:"Hide works with bookmark count less than set value",setting_hideAiWork:"Hide AI works",setting_onlyAiWork:"Show only AI-generated works",setting_hideFav:"Hide favorites when sorting",setting_hideFollowed:"Hide artworks of followed artists when sorting",setting_hideByTag:"Hide artworks by tag",setting_hideByTagPlaceholder:'Input tag name, e.g. "tag1|tag2", regular expressions supported',setting_clearFollowingCache:"Clear Cache",setting_clearFollowingCacheHelp:"The folloing artists info. will be saved locally for one day, if you want to update immediately, please click this to clear cache",setting_followingCacheCleared:"Success, please refresh the page.",setting_blank:"Open works' details page in new tab",setting_turnPage:"Use ← → to turn pages (Search page)",setting_save:"Save",setting_reset:"Reset",setting_resetHint:"This will delete all settings and set it to default. Are you sure?",setting_novelSort:"Sorting (Novel)",setting_novelMaxPage:"Maximum number of pages counted for novel sorting",setting_novelHideWork:"Hide works with bookmark count less than set value",setting_novelHideFav:"Hide favorites when sorting",setting_previewFullScreen:"Full screen preview",setting_scrollLockWhenPreview:"Prevent page scrolling during preview",setting_logLevel:"Log Level",setting_novelSection:"Novel Sorting",setting_close:"Close",setting_maxXhr:"Bookmark count concurrency (recommended 64)",setting_hideByCountLessThan:"Hide works with image count less than set value",setting_hideByCountMoreThan:"Hide works with image count more than set value",sort_noWork:"No works to display (%1 works hideen)",sort_getWorks:"Getting artworks of page: %1 of %2",sort_getBookmarkCount:"Getting bookmark count of artworks：%1 of %2",sort_getPublicFollowing:"Getting public following list",sort_getPrivateFollowing:"Getting private following list",sort_filtering:"Filtering%1works with bookmark count less than %2",sort_filteringHideFavorite:" favorited works and ",sort_fullSizeThumb:"Display not cropped images.(Search page and User page only.)",sort_sortByBookmark:"Sort by ❤️",sort_sortByLike:"Sort by 👍",sort_sortByView:"Sort by 👀",nsort_getWorks:"Getting novels of page: 1% of 2%",nsort_sorting:"Sorting by bookmark cound",nsort_hideFav:"Hide favorites when sorting",nsort_hideFollowed:"Hide artworks of followed authors when sorting",text_sort:"sort"},F[M]={install_title:"Добро пожаловать в PixivPreviewer",install_body:'<div style="position: absolute;left: 50%;top: 30%;font-size: 20px; color: white;transform:translate(-50%,0);"><p style="text-indent: 2em;">Вопросы и предложения приветствуются! ☞<a style="color: green;" href="https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/feedback" target="_blank">Страница обратной связи</a></p><br><p style="text-indent: 2em;">Если вы используете это впервые, рекомендуется перейти к ☞<a style="color: green;" href="https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer" target="_blank">Странице подробностей</a>, чтобы посмотреть введение в скрипт.</p></div>',upgrade_body:'<h3>Новое меню настроек!</h3>&nbsp&nbsp<p style="text-indent: 2em;">Спасибо всем пользователям Pixiv Previewer, это обновление изменило визуальный эффект меню настроек, вопросы и предложения приветствуются! ☞<a style="color: green;" href="https://greasyfork.org/zh-CN/scripts/30766-pixiv-previewer/feedback" target="_blank">Страница обратной связи</a></p>',setting_settingSection:"Настройки",setting_language:"Язык",setting_preview:"Предпросмотр",setting_animePreview:"Анимация предпросмотра",setting_sortSection:"Сортировка",setting_sort:"Сортировка (Страница поиска)",setting_anime:"Анимация скачивания (Страницы предпросмотра и Artwork)",setting_origin:"При предпросмотре, показывать изображения с оригинальным качеством (медленно)",setting_previewDelay:"Задержка отображения предпросмотра изображения (Миллион секунд)",setting_previewByKey:"Использовать клавиши для управления отображением предпросмотра изображения (Ctrl)",setting_previewByKeyHelp:'После включения, перемещение мыши к изображению больше не отображает предпросмотр изображения. Нажмите клавишу Ctrl, чтобы отобразить его, и параметр "Задержка отображения предпросмотра" не будет действовать.',setting_maxPage:"Максимальное количество страниц, подсчитанных за сортировку",setting_hideWork:"Скрыть работы с количеством закладок меньше установленного значения",setting_hideAiWork:"Скрыть работы, созданные ИИ",setting_onlyAiWork:"Показывать только работы, созданные ИИ",setting_hideFav:"При сортировке, скрыть избранное",setting_hideFollowed:"При сортировке, скрыть работы художников на которых подписаны",setting_hideByTag:"При сортировке, скрыть работы с указанным тегом",setting_hideByTagPlaceholder:'Введите имя тега, например "tag1|tag2", поддерживается регулярное выражение',setting_clearFollowingCache:"Очистить кэш",setting_clearFollowingCacheHelp:"Следующая информация о художниках будет сохранена локально в течение одного дня, если вы хотите обновить её немедленно, нажмите на эту кнопку, чтобы очистить кэш",setting_followingCacheCleared:"Готово, обновите страницу.",setting_blank:"Открывать страницу с описанием работы на новой вкладке",setting_turnPage:"Использовать ← → для перелистывания страниц (Страница поиска)",setting_save:"Сохранить",setting_reset:"Сбросить",setting_resetHint:"Это удалит все настройки и установит их по умолчанию. Продолжить?",setting_novelSort:"Сортировка (Роман)",setting_novelMaxPage:"Максимальное количество страниц, подсчитанных за сортировку романа",setting_novelHideWork:"Скрыть работы с количеством закладок меньше установленного значения",setting_novelHideFav:"При сортировке, скрыть избранное",setting_previewFullScreen:"Предпросмотр в полноэкранном режиме",setting_scrollLockWhenPreview:"Блокировать прокрутку страницы при предпросмотре",setting_novelSection:"Сортировка (Роман)",setting_close:"Закрыть",setting_maxXhr:"Количество закладок (рекомендуется 64)",setting_hideByCountLessThan:"Скрыть работы с количеством изображений меньше установленного значения",setting_hideByCountMoreThan:"Скрыть работы с количеством изображений больше установленного значения",sort_noWork:"Нет работ для отображения (%1 works hidden)",sort_getWorks:"Получение иллюстраций страницы: %1 из %2",sort_getBookmarkCount:"Получение количества закладок artworks：%1 из %2",sort_getPublicFollowing:"Получение публичного списка подписок",sort_getPrivateFollowing:"Получение приватного списка подписок",sort_filtering:"Фильтрация %1 работ с количеством закладок меньше чем %2",sort_filteringHideFavorite:" избранные работы и ",sort_fullSizeThumb:"Показать неотредактированное изображение (Страницы поиска и Artwork)",sort_sortByBookmark:"Сортировать по ❤️",sort_sortByLike:"Сортировать по 👍",sort_sortByView:"Сортировать по 👀",nsort_getWorks:"Получение романов страницы: 1% из 2%",nsort_sorting:"Сортировка по количеству закладок",nsort_hideFav:"При сортировке, скрыть избранное",nsort_hideFollowed:"При сортировке, скрыть работы художников на которых подписаны",text_sort:"Сортировать"},F[I]={install_title:"Welcome to PixivPreviewer",install_body:'<div style="position: absolute;left: 50%;top: 30%;font-size: 20px; color: white;transform:translate(-50%,0);"><p style="text-indent: 2em;">ご意見や提案は大歓迎です! ☞<a style="color: green;" href="https://greasyfork.org/ja/scripts/30766-pixiv-previewer/feedback" target="_blank">フィードバックページ</a></p><br><p style="text-indent: 2em;">初めて使う場合は、☞<a style="color: green;" href="https://greasyfork.org/ja/scripts/30766-pixiv-previewer" target="_blank">詳細ページ</a> でスクリプトの紹介を見ることをお勧めします。</p></div>',upgrade_body:'<h3>新しい設定メニュー!</h3>&nbsp&nbsp<p style="text-indent: 2em;">Pixiv Previewerをご利用いただきありがとうございます。このアップデートでは、設定メニューのビジュアルエフェクトが調整されました。問題や提案をお待ちしております! ☞<a style="color: green;" href="https://greasyfork.org/ja/scripts/30766-pixiv-previewer/feedback" target="_blank">フィードバックページ</a></p>',setting_settingSection:"設定",setting_language:"言語",setting_preview:"プレビュー機能",setting_animePreview:"うごイラプレビュー",setting_sortSection:"ソート",setting_sort:"ソート",setting_anime:"うごイラダウンロード",setting_origin:"最大サイズの画像を表示する(遅くなる可能性がある)",setting_previewDelay:"カーソルを重ねてからプレビューするまでの遅延(ミリ秒)",setting_previewByKey:"キーでプレビュー画像の表示を制御する (Ctrl)",setting_previewByKeyHelp:'これを有効にすると、画像にマウスを移動してもプレビュー画像が表示されなくなります。Ctrlキーを押すと表示され、 "遅延表示プレビュー" の設定項目は無効になります。',setting_maxPage:"ソートするときに取得する最大ページ数",setting_hideWork:"一定以下のブクマーク数の作品を非表示にする",setting_hideAiWork:"AIの作品を非表示にする",setting_onlyAiWork:"AI生成作品のみ表示",setting_hideFav:"ブックマーク数をソート時に非表示にする",setting_hideFollowed:"ソート時にフォローしているアーティストの作品を非表示",setting_hideByTag:"ソート時に指定したタグの作品を非表示",setting_hideByTagPlaceholder:'タグ名を入力してください（例："tag1|tag2"、正規表現対応）',setting_clearFollowingCache:"キャッシュをクリア",setting_clearFollowingCacheHelp:"フォローしているアーティストの情報がローカルに1日保存されます。すぐに更新したい場合は、このキャッシュをクリアしてください。",setting_followingCacheCleared:"成功しました。ページを更新してください。",setting_blank:"作品の詳細ページを新しいタブで開く",setting_turnPage:"← → を使用してページをめくる（検索ページ）",setting_save:"Save",setting_reset:"Reset",setting_resetHint:"これにより、すべての設定が削除され、デフォルトに設定されます。よろしいですか？",setting_novelSort:"ソート（小説）",setting_novelMaxPage:"小説のソートのページ数の最大値",setting_novelHideWork:"設定値未満のブックマーク数の作品を非表示",setting_novelHideFav:"ソート時にお気に入りを非表示",setting_previewFullScreen:"全画面プレビュー",setting_scrollLockWhenPreview:"プレビュー時にページのスクロールをロックする",setting_novelSection:"ソート（小説）",setting_close:"閉じる",setting_maxXhr:"ブックマーク数の同時リクエスト数（推奨64）",setting_hideByCountLessThan:"画像数が設定値未満の作品を非表示",setting_hideByCountMoreThan:"画像数が設定値を超える作品を非表示",sort_noWork:"表示する作品がありません（%1 作品が非表示）",sort_getWorks:"ページの作品を取得中：%1 / %2",sort_getBookmarkCount:"作品のブックマーク数を取得中：%1 / %2",sort_getPublicFollowing:"公開フォロー一覧を取得中",sort_getPrivateFollowing:"非公開フォロー一覧を取得中",sort_filtering:"ブックマーク数が%2未満の作品%1件をフィルタリング",sort_filteringHideFavorite:" お気に入り登録済みの作品および  ",sort_fullSizeThumb:"トリミングされていない画像を表示（検索ページおよびユーザーページのみ）。",sort_sortByBookmark:"❤️ でソート",sort_sortByLike:"👍 でソート",sort_sortByView:"👀 でソート",nsort_getWorks:"小説のページを取得中：1% / 2%",nsort_sorting:"ブックマーク数で並べ替え",nsort_hideFav:"ソート時にお気に入りを非表示",nsort_hideFollowed:"ソート時にフォロー済み作者の作品を非表示",text_sort:"ソート"};let S,B=P,E="3.7.37",A="",D=-1,N="/ajax/illust/#id#/ugoira_meta",z={x:0,y:0},H="https://pp-1252089172.cos.ap-chengdu.myqcloud.com/loading.gif",j=location.href,U=64,O=!0,W=0,G=1,q=3,R=4,K=10,V=11,Z=13,J={};J[W]={PageTypeString:"SearchPage",CheckUrl:function(e){return/^https?:\/\/www.pixiv.net\/tags\/.*\/(artworks|illustrations|manga)/.test(e)||/^https?:\/\/www.pixiv.net\/en\/tags\/.*\/(artworks|illustrations|manga)/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]},t=$("section");C.d("Page has "+t.length+" <section>."),C.d(t);let n=-1,i=0;if(0==t.length)return C.e("No suitable <section>!"),e;$.each(t,(e,t)=>{$(t).find("aside").length>0?n=e:i=e}),C.v("premium: "+n),C.v("result: "+i);let o=$(t[i]).find("ul"),a=o.find("li").toArray();if(-1!=n){let e=$(t[n]).find("ul").find("li");a=a.concat(e.toArray())}if(-1!=n){let e=$(t[n]).find("aside");$.each(e.children(),(e,t)=>{"ul"!=t.tagName.toLowerCase()?t.remove():$(t).css("-webkit-mask","0")}),e.next().remove()}return r(a,e=>e.find("div:first>div:first")),e.controlElements=$(".pp-control"),this.private.pageSelector=o.next().get(0),null==this.private.pageSelector&&(this.private.pageSelector=o.parent().next().get(0)),e.loadingComplete=!0,this.private.imageListConrainer=o.get(0),C.d("Process page elements complete."),C.d(e),this.private.returnMap=e,e},GetProcessedPageElements:function(){return null==this.private.returnMap?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return t()},HasAutoLoad:!0,GetImageListContainer:function(){return this.private.imageListConrainer},GetFirstImageElement:function(){return $(this.private.imageListConrainer).find("li").get(0)},GetPageSelector:function(){return this.private.pageSelector},private:{imageListContainer:null,pageSelector:null,returnMap:null}},J[G]={PageTypeString:"BookMarkNewPage",CheckUrl:function(e){return/^https:\/\/www.pixiv.net\/bookmark_new_illust.php.*/.test(e)||/^https:\/\/www.pixiv.net\/bookmark_new_illust_r18.php.*/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]},t=$("section");if(C.d("Page has "+t.length+" <section>."),C.d(t),r(t.find("ul").find("li")),e.controlElements=$(".pp-control"),e.loadingComplete=!0,C.d("Process page elements complete."),C.d(e),this.private.returnMap=e,S.fullSizeThumb){if(!this.private.returnMap.loadingComplete)return;o(this.private.returnMap.controlElements)}return e},GetProcessedPageElements:function(){return null==this.private.returnMap?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return t()},HasAutoLoad:!0,private:{returnMap:null}},J[2]={PageTypeString:"DiscoveryPage",CheckUrl:function(e){return/^https?:\/\/www.pixiv.net\/discovery.*/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]},t=$(".gtm-illust-recommend-zone");return t.length>0?(C.d("Found container div."),C.d(t),r(t.find("ul").children("li")),e.controlElements=$(".pp-control"),e.loadingComplete=!0,C.d("Process page elements complete."),C.d(e),this.private.returnMap=e,e):(C.e("Can not found container div."),e)},GetProcessedPageElements:function(){return null==this.private.returnMap?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return t()},HasAutoLoad:!0,private:{returnMap:null}},J[q]={PageTypeString:"MemberPage/MemberIllustPage/MemberBookMark",CheckUrl:function(e){return/^https?:\/\/www.pixiv.net\/(en\/)?users\/\d+/.test(e)},ProcessPageElements:function(){!function(){const e=[{name:"Google",url:"https://www.google.com/search?q="},{name:"Bing",url:"https://www.bing.com/search?q="},{name:"Baidu",url:"https://www.baidu.com/s?wd="}];document.querySelectorAll("span[to]").forEach(t=>{const n=t.getAttribute("to");if("-----"===t.textContent.trim()&&n.startsWith("/artworks/")){const i=`pixiv "${n.slice(10)}"`,r=document.createElement("span");r.className=t.className,e.forEach((t,n)=>{const o=document.createElement("a");o.href=t.url+encodeURIComponent(i),o.textContent=t.name,o.target="_blank",r.appendChild(o),n<e.length-1&&r.appendChild(document.createTextNode(" | "))}),t.parentNode.replaceChild(r,t)}})}();let e={loadingComplete:!1,controlElements:[]},t=a();C.d(t);let n=$("section");if(C.d("Page has "+n.length+" <section>."),C.d(n),r(t),e.controlElements=$(".pp-control"),e.loadingComplete=!0,C.d("Process page elements complete."),C.d(e),this.private.returnMap=e,S.fullSizeThumb){if(!this.private.returnMap.loadingComplete)return;o(this.private.returnMap.controlElements)}return e},GetProcessedPageElements:function(){return null==this.private.returnMap?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return t()},HasAutoLoad:!0,private:{returnMap:null}},J[R]={PageTypeString:"HomePage",CheckUrl:function(e){return/https?:\/\/www.pixiv.net\/?$/.test(e)||/https?:\/\/www.pixiv.net\/en\/?$/.test(e)||/https?:\/\/www.pixiv.net\/illustration\/?$/.test(e)||/https?:\/\/www.pixiv.net\/manga\/?$/.test(e)||/https?:\/\/www.pixiv.net\/cate_r18\.php$/.test(e)||/https?:\/\/www.pixiv.net\/en\/cate_r18\.php$/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]};if(r(a()),e.controlElements=$(".pp-control"),e.loadingComplete=!0,C.d("Process page elements complete."),C.d(e),this.private.returnMap){let t=new Set;$.each(this.private.returnMap.controlElements,(e,n)=>{t.add($(n).attr("illustId"))}),$.each(e.controlElements,(n,i)=>{if(!t.has($(i).attr("illustId")))return e.forceUpdate=!0,!1})}if(this.private.returnMap=e,S.fullSizeThumb){if(!this.private.returnMap.loadingComplete)return;o(this.private.returnMap.controlElements)}return e},GetProcessedPageElements:function(){return null==this.private.returnMap?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return t()},HasAutoLoad:!0,private:{returnMap:null}},J[5]={PageTypeString:"RankingPage",CheckUrl:function(e){return/^https?:\/\/www.pixiv.net\/ranking.php.*/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]},t=$("._work");return C.d("Found .work, length: "+t.length),C.d(t),t.each(function(t,n){let i=$(n),r={illustId:0,illustType:0,pageCount:1},o=i.attr("href");if(null==o||""===o)return void C.w("Can not found illust id, skip this.");let a=o.match(/artworks\/(\d+)/);a?(r.illustId=a[1],i.hasClass("multiple")&&(r.pageCount=i.find(".page-count").find("span").text()),i.hasClass("ugoku-illust")&&(r.illustType=2),i.attr({illustId:r.illustId,illustType:r.illustType,pageCount:r.pageCount}),e.controlElements.push(n)):C.w("Can not found illust id, skip this.")}),e.loadingComplete=!0,C.d("Process page elements complete."),C.d(e),this.private.returnMap=e,e},GetProcessedPageElements:function(){return null==this.private.returnMap?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return n()},HasAutoLoad:!0,private:{returnMap:null}},J[6]={PageTypeString:"NewIllustPage",CheckUrl:function(e){return/^https?:\/\/www.pixiv.net\/new_illust.php.*/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]};if(r(a()),e.controlElements=$(".pp-control"),e.loadingComplete=!0,C.d("Process page elements complete."),C.d(e),this.private.returnMap=e,S.fullSizeThumb){if(!this.private.returnMap.loadingComplete)return;o(this.private.returnMap.controlElements)}return e},GetProcessedPageElements:function(){return null==this.private.returnMap?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return t()},HasAutoLoad:!0,private:{returnMap:null}},J[7]={PageTypeString:"R18Page",CheckUrl:function(e){return/^https?:\/\/www.pixiv.net\/cate_r18.php.*/.test(e)},ProcessPageElements:function(){},GetToolBar:function(){},HasAutoLoad:!1},J[8]={PageTypeString:"BookMarkPage",CheckUrl:function(e){return/^https:\/\/www.pixiv.net\/bookmark.php\/?$/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]},t=$(".image-item");return C.d("Found images, length: "+t.length),C.d(t),t.each(function(t,n){let i=$(n),r=i.find("._work");if(0===r.length)return void C.w("Can not found ._work, skip this.");let o={illustId:0,illustType:0,pageCount:1},a=r.attr("href");if(null==a||""===a)return void C.w("Can not found illust id, skip this.");let l=a.match(/artworks\/(\d+)/);if(!l)return void C.w("Can not found illust id, skip this.");o.illustId=l[1],r.hasClass("multiple")&&(o.pageCount=i.find(".page-count").find("span").text()),r.hasClass("ugoku-illust")&&(o.illustType=2);let s=i.children("a:first");s.attr({illustId:o.illustId,illustType:o.illustType,pageCount:o.pageCount}),e.controlElements.push(s.get(0))}),e.loadingComplete=!0,C.d("Process page elements complete."),C.d(e),this.private.returnMap=e,e},GetProcessedPageElements:function(){return null==this.private.returnMap?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return n()},HasAutoLoad:!1,private:{returnMap:null}},J[9]={PageTypeString:"StaccPage",CheckUrl:function(e){return/^https:\/\/www.pixiv.net\/stacc.*/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]},t=$("._work");return C.d("Found .work, length: "+t.length),C.d(t),t.each(function(t,n){let i=$(n),r={illustId:0,illustType:0,pageCount:1},o=i.attr("href");if(null==o||""===o)return void C.w("Can not found illust id, skip this.");let a=o.match(/illust_id=(\d+)/);a?(r.illustId=a[1],i.hasClass("multiple")&&(r.pageCount=i.find(".page-count").find("span").text()),i.hasClass("ugoku-illust")&&(r.illustType=2),i.attr({illustId:r.illustId,illustType:r.illustType,pageCount:r.pageCount}),e.controlElements.push(n)):C.w("Can not found illust id, skip this.")}),e.loadingComplete=!0,C.d("Process page elements complete."),C.d(e),this.private.returnMap=e,e},GetProcessedPageElements:function(){return null==this.private.returnMap?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return n()},HasAutoLoad:!0,private:{returnMap:null}},J[K]={PageTypeString:"ArtworkPage",CheckUrl:function(e){return/^https:\/\/www.pixiv.net\/artworks\/.*/.test(e)||/^https:\/\/www.pixiv.net\/en\/artworks\/.*/.test(e)},ProcessPageElements:function(){let e=$("main").find("figure").find("canvas");$("main").find("figure").find("canvas").length>0&&(this.private.needProcess=!0,e.addClass("pp-canvas"));let t={loadingComplete:!1,controlElements:[]};if(r(a()),t.controlElements=$(".pp-control"),t.loadingComplete=!0,C.d("Process page elements complete."),C.d(t),this.private.returnMap=t,S.fullSizeThumb){if(!this.private.returnMap.loadingComplete)return;o(this.private.returnMap.controlElements)}return t},GetProcessedPageElements:function(){return null==this.private.returnMap?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return t()},HasAutoLoad:!0,Work:function(){if(this.private.needProcess){$(".pp-canvas");let e=$('div[role="presentation"]:last').find("button");parseInt($("header").css("height")),parseInt($("header").css("padding-top")),parseInt($("header").css("padding-bottom")),parseInt($("header").css("margin-top")),parseInt($("header").css("margin-bottom")),parseInt($("header").css("border-bottom-width")),parseInt($("header").css("border-top-width")),function(e){if(!S.enableAnimeDownload)return;let t=e.clone().css({bottom:"50px",padding:0,width:"48px",height:"48px",opacity:"0.4",cursor:"pointer"});t.get(0).innerHTML='<svg viewBox="0 0 120 120" style="width: 40px; height: 40px; stroke-width: 10; stroke-linecap: round; stroke-linejoin: round; border-radius: 24px; background-color: black; stroke: limegreen; fill: none;" class="_3Fo0Hjg"><polyline points="60,30 60,90"></polyline><polyline points="30,60 60,90 90,60"></polyline></svg></button>',$(window).on("resize",function(){}),e.after(t),t.mouseover(function(){$(this).css("opacity","0.2")}).mouseleave(function(){$(this).css("opacity","0.4")}).click(function(){let e="",t=location.href.match(/artworks\/(\d+)/);t?(e=t[1],C.i("IllustId="+e),$.ajax(N.replace("#id#",e),{method:"GET",success:function(e){C.d(e),1!=e.error?window.open("_blank").location=e.body.originalSrc:C.e("Server response an error: "+e.message)},error:function(){C.e("Request zip file failed!")}})):C.e("Can not found illust id!")})}(e)}},private:{needProcess:!1,returnMap:null}},J[V]={PageTypeString:"NovelSearchPage",CheckUrl:function(e){return/^https:\/\/www.pixiv.net\/tags\/.*\/novels/.test(e)||/^https:\/\/www.pixiv.net\/en\/tags\/.*\/novels/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]};return $("section:first").find("ul:first").length>0&&(e.loadingComplete=!0),this.private.returnMap=e,e},GetProcessedPageElements:function(){return null==this.private.returnMap?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return t()},GetPageSelector:function(){return $("section:first").find("nav:first")},HasAutoLoad:!1,private:{returnMap:null}},J[12]={PageTypeString:"SearchTopPage",CheckUrl:function(e){return/^https?:\/\/www.pixiv.net(\/en)?\/tags\/[^/*]/.test(e)},ProcessPageElements:function(){let e={loadingComplete:!1,controlElements:[]},t=$("section");C.d("Page has "+t.length+" <section>."),C.d(t);let n=-1,i=0;if(0==t.length)return C.e("No suitable <section>!"),e;t.length>1&&(n=0,i=1),C.v("premium: "+n),C.v("result: "+i);let o=$(t[i]).find("ul"),a=o.find("li").toArray();if(-1!=n){let e=$(t[n]).find("ul").find("li");a=a.concat(e.toArray())}if(-1!=n){let e=$(t[n]).find("aside");$.each(e.children(),(e,t)=>{"ul"!=t.tagName.toLowerCase()?t.remove():$(t).css("-webkit-mask","0")}),e.next().remove()}return r(a),e.controlElements=$(".pp-control"),this.private.pageSelector=o.next().get(0),null==this.private.pageSelector&&(this.private.pageSelector=o.parent().next().get(0)),e.loadingComplete=!0,this.private.imageListConrainer=o.get(0),C.d("Process page elements complete."),C.d(e),this.private.returnMap=e,e},GetProcessedPageElements:function(){return null==this.private.returnMap?this.ProcessPageElements():this.private.returnMap},GetToolBar:function(){return t()},HasAutoLoad:!1,GetImageListContainer:function(){return this.private.imageListConrainer},GetFirstImageElement:function(){return $(this.private.imageListConrainer).find("li").get(0)},GetPageSelector:function(){return this.private.pageSelector},private:{imageListContainer:null,pageSelector:null,returnMap:null}};const Q={passive:!1},X="onwheel"in document.createElement("div")?"wheel":"mousewheel";let Y=null,ee=null,te=null,ne=null;!function e(){y().then(function(t){t?(function(){if(B=function(){let e=b("PixivPreview");if(e&&"null"!=e){let t=JSON.parse(e);if(t)return parseInt(t.lang)}let t=b("PixivPreviewLang");return null==t||"null"==t?P:parseInt(t)}(),B==P){let e=$("html").attr("lang");B=e&&-1!=e.indexOf("zh")?L:e&&-1!=e.indexOf("ja")?I:T}}(),C.d("gmcInit()"),k=new GM_config({id:"gmc-frame",title:"Pixiv Previewer",events:{init:c,open:g,save:u,close:h},frame:p(),fields:{lang:{label:F[B].setting_language,section:[F[B].setting_settingSection],type:"select",options:["Auto","简体中文","English","Русский язык","日本語"],default:"Auto"},fullSizeThumb:{label:F[B].sort_fullSizeThumb,type:"checkbox",default:!1},linkBlank:{label:F[B].setting_blank,type:"checkbox",default:!0},enableAnimeDownload:{label:F[B].setting_anime,type:"checkbox",default:!0},logLevel:{label:F[B].setting_logLevel,type:"select",options:["error","warning","info","debug"],default:"info"},clearSettings:{label:F[B].setting_reset,type:"button",click:()=>{confirm(F[B].setting_resetHint)||(v("gmc-frame",""),location.href=location.href)}},clearFollowedUserCache:{label:F[B].setting_clearFollowingCache,type:"button",click:()=>{v("followingOfUid-"+dataLayer[0].user_id,null)}},enablePreview:{label:F[B].setting_preview,section:[F[B].setting_preview],type:"checkbox",default:!0},enableAnimePreview:{label:F[B].setting_animePreview,type:"checkbox",default:!0},original:{label:F[B].setting_origin,type:"checkbox",default:!1},previewDelay:{label:F[B].setting_previewDelay,type:"text",default:200},previewByKey:{label:F[B].setting_previewByKey,type:"checkbox",default:!1},previewFullScreen:{label:F[B].setting_previewFullScreen,type:"checkbox",default:!1},scrollLockWhenPreview:{label:F[B].setting_scrollLockWhenPreview,type:"checkbox",default:!0},enableSort:{label:F[B].setting_sort,section:[F[B].setting_sortSection],type:"checkbox",default:!0},pageCount:{label:F[B].setting_maxPage,type:"text",default:3},favFilter:{label:F[B].setting_hideWork,type:"text",default:0},aiFilter:{label:F[B].setting_hideAiWork,type:"checkbox",default:!1},aiOnly:{label:F[B].setting_onlyAiWork,type:"checkbox",default:!1},hideFavorite:{label:F[B].setting_hideFav,type:"checkbox",default:!1},hideFollowed:{label:F[B].setting_hideFollowed,type:"checkbox",default:!1},hideByTag:{label:F[B].setting_hideByTag,type:"checkbox",default:!1},hideByTagList:{label:F[B].setting_hideByTagPlaceholder,type:"hidden",default:""},hideByTagRegex:{label:F[B].setting_hideByTagPlaceholder,type:"text",default:""},hideCountLessThan:{label:F[B].setting_hideByCountLessThan,type:"text",default:0},hideCountMoreThan:{label:F[B].setting_hideByCountMoreThan,type:"text",default:0},pageByKey:{label:F[B].setting_turnPage,type:"checkbox",default:!1},maxXhr:{label:F[B].setting_maxXhr,type:"text",default:64},enableNovelSort:{label:F[B].setting_novelSort,section:[F[B].setting_novelSection],type:"checkbox",default:!0},novelPageCount:{label:F[B].setting_novelMaxPage,type:"text",default:3},novelFavFilter:{label:F[B].setting_novelHideWork,type:"text",default:0},novelHideFavorite:{label:F[B].setting_novelHideFav,type:"checkbox",default:!1}}})):setTimeout(e,1e3)})}();