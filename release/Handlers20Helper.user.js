// ==UserScript==
// @name        Handlers Helper
// @include       *://*/*
// @grant       GM_getValue
// @grant       GM_setValue
// @grant       GM_deleteValue
// @grant       GM_addStyle
// @grant       GM_registerMenuCommand
// @version     3.7
// @author      -
// @namespace Violentmonkey Scripts
// @downloadURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/Handlers20Helper.user.js
// @updateURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/Handlers20Helper.meta.js
// ==/UserScript==
function e(e){function u(e){return btoa(e).replace(/\//g,"_").replace(/\+/g,"-").replace(/\=/g,"")}function m(e){window.open(e,"","fullscreen=no,toolbar=no,titlebar=no,menubar=no,location=no,width=400,height=640")}function d(e,t){var a,r,l="",s="",d=!1;for(i in console.log(e,t),n)-1==e.indexOf(n[i])&&-1==document.domain.indexOf(n[i])||("stream"==t&&(e=e.replace(/https?:/,"hls:")),d=!0);if(e.startsWith("http")||e.startsWith("hls"))l=e;else if(e.startsWith("mpv://"))return void(location.href=e);if(""==l&&(l=location.href),console.log(c),Object.keys(c).length>0){for(link in c)console.log(link,c[link]),c[link].style.boxSizing="unset",c[link].style.border="unset",s+=link+" ";s=s.trim(" "),console.log(s)}else s=l;c={},a="mpv://"+(r="pipe"==t?"mpvy":"iptv"==t?"list":"mpv"==t||"vid"==t?"play":t)+"/"+u(s)+"/?referer="+u(location.href),1==d&&(a+="?hls=1"),"stream"==r&&1==o&&function(e){var t=new URL(e);-1!=t.href.indexOf("www.youtube.com/watch")||-1!=t.href.indexOf("m.youtube.com/watch")?m("https://www.youtube.com/live_chat?is_popout=1&v="+t.search.split("v=")[1]):t.href.match("https://.*?.twitch.tv/.")?m("https://www.twitch.tv/popout"+t.pathname+"/chat?popout="):t.href.match("https://.*?.nimo.tv/.")&&m("https://www.nimo.tv/popout/chat/"+document.querySelector('a[href="'+t.pathname+'"] .nimo-player.n-as-full').id.replace("home-hot-",""))}(l),console.log(a),location.href=a}e.addEventListener("dragstart",function(o){var n,i;console.log("dragstart"),n=o.clientX,i=o.clientY,e.addEventListener("dragend",function e(o){var c=o.clientX,u=o.clientY,m=function(e,o,n,i){let a,r;return 0==n&&0==i||n-e>=-50&&n-e<=50&&i-o>=-50&&i-o<=50?5:(4==t?a=Math.abs(n-e)<Math.abs(i-o)?i>o?"8":"2":n>e?"6":"4":(r=(i-o)/(n-e),a=-.4142<=r&&r<.4142?n>e?"6":"4":2.4142<=r||r<-2.4142?i>o?"8":"2":.4142<=r&&r<2.4142?n>e?"9":"1":i>o?"7":"3"),a)}(n,i,c,u);console.log("Direction: "+m),console.log(n,i,c,u,m);const p=o.target.href||o.target.src;switch(+m){case 6:console.log("RIGHT: "+p),d(p,s);break;case 4:console.log("LEFT: "+p),d(p,l);break;case 2:console.log("UP: "+p),d(p,a);break;case 8:console.log("DOWN: "+p),d(p,r);break;case 1:console.log("List: "+p),d(p,"list")}console.log(m),this.removeEventListener("dragend",e)},!1)},!1)}var t,o,n,a,r,l,s,c,u,m,d;const p="Value: pipe ytdl stream mpv iptv";if(t=4,o=!1,n="cdn.animevui.com",a="pipe",r="ytdl",l="stream",s="mpv",a=GM_getValue("UP",a),r=GM_getValue("DOWN",r),l=GM_getValue("LEFT",l),s=GM_getValue("RIGHT",s),n=GM_getValue("hlsdomain",n),o=GM_getValue("livechat",o),t=GM_getValue("total_direction",t),GM_registerMenuCommand("↑: "+a.toString(),function(){var e=window.prompt(p,a);e&&(GM_setValue("UP",e),window.location.reload())}),GM_registerMenuCommand("↓: "+r.toString(),function(){var e=window.prompt(p,r);e&&(GM_setValue("DOWN",e),window.location.reload())}),GM_registerMenuCommand("←: "+l.toString(),function(){var e=window.prompt(p,l);e&&(GM_setValue("LEFT",e),window.location.reload())}),GM_registerMenuCommand("→: "+s.toString(),function(){var e=window.prompt(p,s);e&&(GM_setValue("RIGHT",e),window.location.reload())}),GM_registerMenuCommand("HLS Force",function(){var e=window.prompt("Example: 1.com,2.com,3.com,4.com",n);e&&GM_setValue("hlsdomain",e)}),GM_registerMenuCommand("Live Chat: "+o.toString(),function(){1==o?GM_setValue("livechat",!1):GM_setValue("livechat",!0),window.location.reload()}),GM_registerMenuCommand("Total Direction: "+t.toString(),function(){4==t?GM_setValue("total_direction",8):GM_setValue("total_direction",4),window.location.reload()}),console.log(a,r,l,s,n,o,t),n=n.split(","),c={},u=!1,m=!1,document.addEventListener("mousedown",function(e){var t=function(e,t){if(t=t.toLowerCase(),e.tagName.toLowerCase()==t)return e;for(;e&&e.parentNode;)if((e=e.parentNode).tagName&&e.tagName.toLowerCase()==t)return e;return"undefined"}(e.target,"A");"A"==t.nodeName&&(u=!0,document.addEventListener("mouseup",function e(){u=!1,this.removeEventListener("mouseup",e)}),document.addEventListener("contextmenu",function e(t){1==m&&(m=!1,t.preventDefault()),m=!1,this.removeEventListener("contextmenu",e)}),2===e.button&&setTimeout(function(){u&&(null==c[t.href]?(c[t.href]=e.target,e.target.style.boxSizing="border-box",e.target.style.border="solid yellow 4px"):(c[t.href].style.boxSizing="unset",c[t.href].style.border="unset",delete c[t.href]),console.log(c),u=!1,m=!0)},200))}),e(document),d=[],document.addEventListener("mouseover",function(t){t.target.shadowRoot&&0==d.includes(t.target)&&(console.log(d),d.push(t.target),e(t.target.shadowRoot))}),"www.youtube.com"==document.domain||"m.youtube.com"==document.domain){GM_getValue("hh_mobile","unset");let w=(location.host||"").charAt(0)||"";function h(e,t,o){GM_registerMenuCommand(e,function(){1==o?-1!=t.indexOf("m.youtube.com")?GM_setValue("hh_mobile",!0):-1!=t.indexOf("www.youtube.com")&&GM_setValue("hh_mobile",!1):GM_deleteValue("hh_mobile"),location.replace(t)})}"w"==w?(h("Switch to YouTube Mobile persistently","https://m.youtube.com/?persist_app=1&app=m",!0),h("Switch to YouTube Mobile temporarily","https://m.youtube.com/?persist_app=0&app=m",!1)):"m"==w&&(h("Switch to YouTube Dekstop persistently","http://www.youtube.com/?persist_app=1&app=desktop",!0),h("Switch to YouTube Dekstop temporarily","http://www.youtube.com/?persist_app=0&app=desktop",!1)),"m"==w&&GM_addStyle("ytm-rich-item-renderer {width: 33%!important;margin: 1px!important;padding: 0px!important;}")}