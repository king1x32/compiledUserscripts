// ==UserScript==
// @name         4chan Image Resizer
// @namespace    https://greasyfork.org/en/users/393416
// @version      2.5
// @author       greenronia
// @match        *://boards.4chan.org/*
// @match        *://boards.4channel.org/*
// @require      https://cdnjs.cloudflare.com/ajax/libs/spark-md5/3.0.0/spark-md5.js
// @require      https://unpkg.com/@daiyam/cropperjs@1.5.9-d2/dist/@daiyam/cropper.js
// @resource     cropper_css https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.9/cropper.css
// @grant        GM_getResourceText
// @grant        GM_addStyle
// @icon         https://i.imgur.com/hQp5BTf.png
// @downloadURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/4chan20Image20Resizer.user.js
// @updateURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/4chan20Image20Resizer.meta.js
// ==/UserScript==
function e(){if(JSON.parse(localStorage.getItem("downscale-settings")))var e=JSON.parse(localStorage.getItem("downscale-settings"));else e={enabled:!0,notify:!0,convert:!0,convertOutput:"image/png",jpegQuality:.92,shortcut:!0,cropOutput:"image/png",version:"2.4"},localStorage.setItem("downscale-settings",JSON.stringify(e));return e}function t(){if(JSON.parse(localStorage.getItem("downscale-presets")))var e=JSON.parse(localStorage.getItem("downscale-presets"));else e=[];return e}function n(){if(JSON.parse(localStorage.getItem("downscale-qclist")))var e=JSON.parse(localStorage.getItem("downscale-qclist"));else e=[];return e}function i(e){return!0===document.getElementById("imgResize").checked?(2!=e&&Ne&&console.log("[ImageResizer] Enabled"),!0):(2!=e&&Ne&&console.log("[ImageResizer] Disabled"),f(),h(),p(),g(),y(),v(),!1)}function o(){document.getElementById("errMsg").innerHTML=""}function l(e,n){var i=parseInt(document.getElementById("inWidth").value),l=parseInt(document.getElementById("inHeight").value),a=parseInt(document.getElementById("outWidth").value),s=parseInt(document.getElementById("outHeight").value),r=parseInt(document.getElementById("imgType").value);a<=0||s<=0?document.getElementById("errMsg").innerHTML="Invalid output dimensions":i<a||l<s?document.getElementById("errMsg").innerHTML="Cannot upscale images":function(e,n,i,l,a,s,r){var d,u,m,p=document.getElementById("imgType"),g=p.options[p.selectedIndex].text,h=n+":"+i+":"+l+":"+a+":"+s,y=t();if(y.length>0)for(d=[],u=y.length,m=0;m<u;m++)if(!e||m!==r){if(d[m]=y[m].split(":"),h==y[m])return void(document.getElementById("errMsg").innerHTML="Exact preset already exists");if(i==d[m][1]&&l==d[m][2]&&(n==d[m][0]||0==d[m][0]))return void(document.getElementById("errMsg").innerHTML="Preset with the same input dimensions for "+g+" format already exists")}o(),e?y[r]=h:y.push(h),localStorage.setItem("downscale-presets",JSON.stringify(y)),document.getElementById("ruleTable").tBodies.item(0).innerHTML="",c(),document.getElementById("ruleInput").remove(),document.getElementById("addRule").style.display="inline"}(e,r,i,l,a,s,n)}function a(){var e=document.getElementById("inWidth").value,t=document.getElementById("inHeight").value,n=(document.getElementById("outWidth").value,document.getElementById("outHeight").value);n>0&&(parseInt(t)>=parseInt(n)?(r("width",e,t,n),o()):document.getElementById("errMsg").innerHTML="Cannot upscale images")}function s(){var e=document.getElementById("inWidth").value,t=document.getElementById("inHeight").value,n=document.getElementById("outWidth").value;document.getElementById("outHeight").value,n>0&&(parseInt(e)>=parseInt(n)?(r("height",e,t,n),o()):document.getElementById("errMsg").innerHTML="Cannot upscale images")}function r(e,t,n,i){var o,l;"width"==e&&(o=i/n*t,document.getElementById("outWidth").value=Math.round(o)),"height"==e&&(l=i/t*n,document.getElementById("outHeight").value=Math.round(l))}function d(e,t,n,i){var o,l;"width"==e&&(o=n/t*i,document.getElementById("resHeight").value=Math.round(o)),"height"==e&&(l=t/n*i,document.getElementById("resWidth").value=Math.round(l))}function c(){var e,n,i,l=t(),a=(document.getElementById("imgResizeList"),document.getElementById("ruleTable"));if(l.length>0){e=[],n=l.length;for(let t=0;t<n;t++){switch(e[t]=l[t].split(":"),parseInt(e[t][0])){case 0:e[t][0]="PNG/JPEG";break;case 1:e[t][0]="PNG";break;case 2:e[t][0]="JPEG"}let n=document.createElement("a"),s=document.createElement("a");n.innerHTML="delete",s.innerHTML="edit",n.onclick=function(){document.getElementById("inputContainer")&&(document.getElementById("inputContainer").innerHTML=""),l.splice(n.parentElement.parentElement.sectionRowIndex,1),localStorage.setItem("downscale-presets",JSON.stringify(l)),a.tBodies.item(0).innerHTML="",c(),o(),document.getElementById("addRule").style.display="inline"},s.onclick=function(){u(!0,e[t],t),o()},(i=a.tBodies.item(0).insertRow(-1)).insertCell(0).innerHTML=e[t][0],i.insertCell(1).innerHTML="[ "+e[t][1]+" x "+e[t][2]+" ]",i.insertCell(2).innerHTML="&#8594;",i.insertCell(3).innerHTML="[ "+e[t][3]+" x "+e[t][4]+" ]",i.insertCell(4).appendChild(s),i.insertCell(5).appendChild(n)}}}function u(e,t,n){var i,r,d,c,u,m,p,g;if(document.getElementById("inputContainer")&&(document.getElementById("inputContainer").innerHTML=""),document.getElementById("addRule").style.display="none",i=document.getElementById("inputContainer"),r=document.createElement("div"),(d=document.createElement("button")).innerHTML="Cancel",d.style.margin="auto 0 0 10px",(c=document.createElement("button")).innerHTML="Save",r.id="ruleInput",r.innerHTML='<select id="imgType" name="imgType" title="Input Format"><option value="0">PNG/JPEG</option><option value="1">PNG</option><option value="2">JPEG</option></select>&ensp;<input type="number" id="inWidth" title="Input Width" size="3" min="0" value="0" onfocus="this.select();"></input> x <input type="number" id="inHeight" title="Input Height" size="3" min="0" value="0" onfocus="this.select();"></input> &ensp; &#8594; &ensp; <input type="number" id="outWidth" title="Output Width" size="3" min="0" value="0" onfocus="this.select();"></input> x <input type="number" id="outHeight" title="Output Height" size="3" min="0" value="0" onfocus="this.select();"></input><br>',i.appendChild(r),u=document.getElementById("inWidth"),m=document.getElementById("inHeight"),p=document.getElementById("outWidth"),g=document.getElementById("outHeight"),e){switch(t[0]){case"PNG/JPEG":document.getElementById("imgType").selectedIndex=0;break;case"PNG":document.getElementById("imgType").selectedIndex=1;break;case"JPEG":document.getElementById("imgType").selectedIndex=2}u.value=t[1],m.value=t[2],p.value=t[3],g.value=t[4]}p.addEventListener("input",s),g.addEventListener("input",a),u.onkeypress=function(){return g.value=0,p.value=0,L(event)},m.onkeypress=function(){return g.value=0,p.value=0,L(event)},p.onkeypress=function(){return L(event)},g.onkeypress=function(){return L(event)},r.appendChild(c),r.appendChild(d),d.onclick=function(){document.getElementById(r.id).remove(),document.getElementById("addRule").style.display="inline",o()},c.onclick=function(){e?l(!0,n):l(!1)}}function m(){var e,t,i=n(),o=(document.getElementById("QCList"),document.getElementById("QCTable")),l=i.length;if(l>0){e=[];for(let n=0;n<l;n++){e[n]=i[n].split(":");let l=document.createElement("a");l.innerHTML="delete",l.onclick=function(){i.splice(l.parentElement.parentElement.sectionRowIndex,1),localStorage.setItem("downscale-qclist",JSON.stringify(i)),o.tBodies.item(0).innerHTML="",m()},(t=o.tBodies.item(0).insertRow(-1)).insertCell(0).innerHTML=e[n][0],t.insertCell(1).innerHTML="[ "+e[n][1]+" x "+e[n][2]+" ]",t.insertCell(2).innerHTML=e[n][3],t.insertCell(3).innerHTML="&#8594;",t.insertCell(4).innerHTML=e[n][4],t.insertCell(5).innerHTML='<p title = "'+e[n][5]+'">'+e[n][5]+"</p>",t.insertCell(6).appendChild(l)}}}function p(){var e=document.getElementById("qcDiv");e&&e.remove()}function g(){var e=document.getElementById("remDiv");e&&e.remove()}function h(){var e=document.getElementById("cropDiv");e&&e.remove()}function y(){var e=document.getElementById("previewImg");e&&e.remove()}function f(){var e=document.getElementById("sm-hr");e&&e.remove()}function v(){var e=document.getElementById("manDiv");e&&e.remove()}function b(){var e=document.getElementById("imgResizeMenu");return window.getComputedStyle(e,null).getPropertyValue("border-bottom-color")}function E(e,t,n,i,o,l){var a,s,r,d=w(l,o),c=document.createElement("div");c.id="pvOverlay",(a=document.createElement("div")).id="pvHeader",a.className="dialog",a.classList.add("pvOpct"),a.innerHTML=d+"<br>("+k(t)+", "+Math.round(n)+"x"+Math.round(i)+")",(s=document.createElement("a")).className="close fa fa-times",s.style="float: right; cursor: pointer; margin-right: 20px; margin-top: -9px; transform: scale(1.5);",s.title="Close",s.onclick=function(){c.remove()},(r=document.createElement("img")).id="pvImg",r.classList.add("centerImg"),r.title="Click to close",r.src=e,r.onclick=function(){c.remove()},document.body.appendChild(c),c.appendChild(r),c.appendChild(a),a.appendChild(s),setTimeout(function(){a.classList.toggle("pvOpct")},2e3)}function I(e){var t,n,i,o;for(t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(t.length),o=0;o<t.length;o++)i[o]=t.charCodeAt(o);return new Blob([i],{type:n})}function C(e,t){var n="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download",t+".json"),document.body.appendChild(i),i.click(),i.remove()}function w(e,t){var n=e.split("/").pop();return t.split(".").slice(0,-1).join(".").concat("."+n)}function L(e){var t=(e=e||window.event).which?e.which:e.keyCode;return!(t>31&&(t<48||t>57))}function k(e,t){if(0==e)return"0 Bytes";var n=t||2,i=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,i)).toFixed(n))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i]}var M,B,T,H,S,z,x,R,N,O,P,Q,D,F,J,A,G,j,W,q,U,Y,K,V,_,$,Z,X,ee,te,ne,ie,oe,le,ae,se,re,de,ce,ue,me,pe,ge,he,ye,fe,ve,be,Ee,Ie,Ce,we,Le,ke,Me,Be,Te,He,Se,ze,xe,Re,Ne=!1;const Oe="2.5";Ne&&console.log("[ImageResizer] Initialized"),M=GM_getResourceText("cropper_css"),GM_addStyle(M),(B=document.createElement("style")).innerHTML=".centerImg { margin: 0; position: absolute; top: 50%; left: 50%; -ms-transform: translate(-50%, -50%); transform: translate(-50%, -50%); max-width: 100%; max-height: 100vh; height: auto; cursor: pointer; }\n.settingsOverlay { background: rgba(0,0,0,0.8); display: none; height: 100%; left: 0; position: fixed; top: 0; width: 100%; z-index: 777; } \n#pvOverlay { background: rgba(0,0,0,0.9); height: 100%; left: 0; position: fixed; top: 0; width: 100%; z-index: 777; text-align: center;} \n#pvHeader { position: fixed; height: 35px; width: 100%; opacity: 0; -webkit-transition: opacity 0.5s ease-in-out;}\n#pvHeader:hover { opacity: 0.8; -webkit-transition: none; }\n.pvOpct { opacity: 0.7 !important; } \n#imgResizeMenu { margin: 10% auto auto auto; width: 100%; width: 620px; padding: 2em; overflow: hidden; z-index: 8;}\n#imgResizeMenu h3 { text-align: center; }\n#imgResizeMenu a { cursor: pointer; }\n#imgResizeMenu label { text-decoration-line: underline; }\n#heplDiv summary { cursor: pointer; }\n.settingsOverlay input[type=number], #manInput input[type=number] { -moz-appearance: textfield; text-align: right; }\n.resizer-settings { padding-bottom: 10px }\n#errMsg { color: red; text-align: center; }\n#ruleTable { border-collapse: collapse; }\n#ruleTable td, th { padding: 8px; text-align: left; border-bottom: 1pt solid; }\n#QCTable { border-collapse: collapse; }\n#QCTable td, th { padding: 8px; text-align: center; border-bottom: 1pt solid; }\n#QCTable p { margin: auto; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n#inputContainer { text-align: center; padding-top: 1em; }\n#inputContainer button { margin-top: 20px; }\n.menuBtns { margin-left: 1em; }\n#sideMenu { position: absolute; display: none; padding: 5px 0px 5px 0px; width: 105px; margin-left: -110px; margin-top: -2px;}\n#manInput { position: absolute; padding: 10px 0px 10px 0px; width: 170px; margin-left: -175px; margin-top: -2px; text-align: center;}\n.sideMenuElement { background: inherit; display: block; cursor: pointer; padding: 2px 10px 2px 10px; text-align: left;}\n.downscale-menu-off { display: none; }\n.downscale-menu-on { display: block !important; }",(T=document.querySelector("script")).parentNode.insertBefore(B,T),e(),t(),n(),Oe.localeCompare(e().version,void 0,{numeric:!0,sensitivity:"base"})>=1&&((S=e()).version=Oe,S.convertOutput="image/png",localStorage.setItem("downscale-settings",JSON.stringify(S)),z=new CustomEvent("CreateNotification",{bubbles:!0,detail:{type:"info",content:"4chan Image Resizer updated to version "+Oe,lifetime:10}}),document.dispatchEvent(z)),document.addEventListener("QRDialogCreation",function(){var o,l,a,s,r=document.getElementById("imgResize");document.getElementById("sideMenuArrow")||((s=document.createElement("a")).id="sideMenuArrow",s.title="Side Menu",s.style.cursor="pointer",s.innerHTML="&#9664;",document.getElementById("autohide").parentNode.insertAdjacentElement("beforebegin",s),s.onclick=function(){a.classList.toggle("downscale-menu-on")},(a=document.createElement("div")).id="sideMenu",a.classList.add("dialog"),document.getElementById("qr").insertAdjacentElement("afterbegin",a),window.addEventListener("click",function(e){var t=document.getElementById("sideMenu");e.target.matches("#sideMenuArrow")||e.target.matches("#sideMenu")||e.target.matches("#imgResize")||e.target.matches("#quickConvert")||e.target.matches("#imgResizeLabel")||t.classList.contains("downscale-menu-on")&&t.classList.remove("downscale-menu-on")})),r||function(){var t,n=document.createElement("a"),i=document.createElement("label"),o=document.createElement("input");o.type="checkbox",o.id="imgResize",i.id="imgResizeLabel",o.title="Enable Image Resizer",o.style="margin-left: 0",n.classList.add("sideMenuElement"),n.classList.add("entry"),i.classList.add("sideMenuElement"),i.classList.add("entry"),(t=document.getElementById("sideMenu")).appendChild(i),i.appendChild(o),i.title="Enable Image Resizer",i.innerHTML+=" Enabled",n.title="Image Resizer Settings",n.innerHTML="Settings",t.appendChild(n),i.onmouseover=function(){this.classList.toggle("focused")},i.onmouseout=function(){this.classList.toggle("focused")},n.onmouseover=function(){this.classList.toggle("focused")},n.onmouseout=function(){this.classList.toggle("focused")},n.onclick=function(){document.getElementById("imgResizeOverlay").style.display="block"},document.getElementById("imgResize").checked=e().enabled}(),document.getElementById("imgResize").addEventListener("click",i),i(1),Ne&&console.log("[QRFile] Listening..."),document.addEventListener("QRFile",function(i){var a,s,r,u,C,M;Ne&&console.log("[QRFile] File served: "+i.detail),g();const B=i.detail,T=new FileReader;if("image/jpeg"==B.type||"image/png"==B.type||"image/webp"==B.type){function H(t,n,i,o,a){var s,r,d,c,u,m;Ne&&!o&&console.log("<FILTER END>"),y(),s=document.createElement("canvas"),(r=i.width)>(d=i.height)?r>t&&(d*=t/r,r=t):d>n&&(r*=n/d,d=n),s.width=r,s.height=d,s.getContext("2d").drawImage(i,0,0,r,d),u=I(c=o?s.toDataURL("image/jpeg",92):a&&"image/png"==e().convertOutput?s.toDataURL("image/png"):s.toDataURL("image/jpeg",parseFloat(e().jpegQuality))),l.disconnect(),Ne&&console.log("[classObserver] Stopping..."),S(u,i,r,d,o),(m=new Image).src=c,x(m),N(c,u.size,r,d,B.name,u.type)}function S(t,i,s,r,d){var u,y,f=w(t.type,B.name),b=new CustomEvent("QRSetFile",{bubbles:!0,detail:{file:t,name:f}});document.dispatchEvent(b),d&&function(e,t,i,o){var l,a=document.createElement("div");a.id="remDiv",(l=document.createElement("a")).id="rememberMD5",l.classList.add("sideMenuElement"),l.classList.add("entry"),l.innerHTML="Remember",l.style.fontWeight="bold",l.title="Always convert this image.",l.onmouseover=function(){this.classList.toggle("focused")},l.onmouseout=function(){this.classList.toggle("focused")},l.onclick=function(){!function(e,t,i,o){var l,a,s,r,d,c,u,p;g(),l=n(),a=t.type.split("/").pop().toUpperCase(),s=(s=t.name.split(".").slice(0,-1).join(".")).replace(/:/g,"_"),r=k(t.size),d=k(o),c=a+":"+e.width+":"+e.height+":"+r+":"+d+":"+s+":"+i,l.push(c),localStorage.setItem("downscale-qclist",JSON.stringify(l)),u=t.name+'\nAdded to the "Quick Convert List"',p=new CustomEvent("CreateNotification",{bubbles:!0,detail:{type:"info",content:u,lifetime:5}}),document.dispatchEvent(p),document.getElementById("QCTable").tBodies.item(0).innerHTML="",m()}(e,t,i,o)},document.getElementById("sideMenu").appendChild(a),a.appendChild(l)}(i,B,d,t.size),Ne&&console.log("[QRSetFile] File Sent"),Ne&&console.log("OUTPUT Dimesnions: "+Math.round(s)+"x"+Math.round(r)),Ne&&console.log("OUTPUT Filesize: "+k(t.size)),Ne&&console.log("OUTPUT Format: "+t.type),Ne&&"image/jpeg"==t.type&&console.log("JPEG Quality: "+e().jpegQuality),u="Original size: ("+k(B.size)+", "+i.width+"x"+i.height+") \n New size: ("+k(t.size)+", "+Math.round(s)+"x"+Math.round(r)+")",e().notify&&(y=new CustomEvent("CreateNotification",{bubbles:!0,detail:{type:"info",content:u,lifetime:5}}),document.dispatchEvent(y)),p(),h(),v(),l.observe(c,o),a=!0,Ne&&console.log("<FINISH>\n[classObserver] Restarting...")}function z(t,n,i,o,l){var a,s,r,d,c;Ne&&console.log("[fileSizeTester] Starting..."),a=document.createElement("canvas"),(s=o.width)>(r=o.height)?s>t&&(r*=t/s,s=t):r>n&&(s*=n/r,r=n),a.width=s,a.height=r,a.getContext("2d").drawImage(o,0,0,s,r),c=I(d="image/png"==i?a.toDataURL("image/png"):a.toDataURL("image/jpeg",parseFloat(e().jpegQuality))),l.innerHTML=k(c.size),c.size>4194304?(Ne&&console.log("[fileSizeTester] File size is over the limit: "+k(c.size)),l.style.color="red"):(Ne&&console.log("[fileSizeTester] File size OK: "+k(c.size)),l.style.color="inherit"),u=c,C=d,Ne&&console.log("[fileSizeTester] Done.")}function x(e){var t,n=document.createElement("div");n.id="cropDiv",(t=document.createElement("a")).id="crop",t.classList.add("sideMenuElement"),t.classList.add("entry"),t.innerHTML="Crop Image",t.onmouseover=function(){this.classList.toggle("focused")},t.onmouseout=function(){this.classList.toggle("focused")},t.addEventListener("click",function(){Ne&&console.log("[cropper] Starting..."),R(e)}),document.getElementById("sideMenu").appendChild(n),n.appendChild(t)}function R(t){var n,i,o,a,s,r=document.createElement("div");let d;r.id="pvOverlay",(n=document.createElement("div")).id="pvHeader",n.className="dialog",n.classList.add("pvOpct"),(i=document.createElement("a")).id="setCrop",i.style.cursor="pointer",i.innerHTML="Set Image",(o=document.createElement("a")).id="undoCrop",o.style.cursor="pointer",o.innerHTML="Undo",(a=document.createElement("a")).id="closeCrop",a.className="close fa fa-times",a.style="float: right; cursor: pointer; margin-right: 20px; margin-top: 7px; transform: scale(1.5);",a.title="Close",(s=document.createElement("img")).id="cropImg",s.classList.add("centerImg"),s.src=t.src,s.title="LMB: Set\nMMB: Close\nRMB: Undo\nShift+RMB: Context Menu",s.oncontextmenu=function(){return!1},document.body.appendChild(r),r.appendChild(s);const c=document.getElementById("cropImg");c.addEventListener("ready",function(){r.clientWidth>t.width&&r.clientHeight>t.height&&(d.zoomTo(1),Ne&&console.log("[cropper] Scaling image to 100%"));var c=!1;document.body.onkeydown=function(u){var m,p,g,h,f=u||window.event;if(f.target===this&&d&&!c){switch(f.keyCode){case 46:case 27:f.preventDefault(),d.destroy(),r.remove(),c=!0;break;case 8:f.preventDefault(),document.getElementById("undoCrop")?(document.getElementById("undoCrop").click(),c=!0):d.clear();break;case 32:case 13:f.preventDefault(),document.getElementById("setCrop")?(document.getElementById("setCrop").click(),c=!0):(m=d.getCroppedCanvas({imageSmoothingEnabled:!1,imageSmoothingQuality:"high"}),Ne&&console.log("[cropper] Output format: "+e().cropOutput),p=m.toDataURL(e().cropOutput,parseFloat(e().jpegQuality)),g=I(p),h=d.getData(!0),d.destroy(),s.src=p,s.addEventListener("mouseup",function(e){if("object"==typeof e)switch(e.button){case 0:v();break;case 1:d.destroy(),r.remove(),c=!0;break;case 2:e.shiftKey||(r.remove(),R(t))}}),r.appendChild(n),n.appendChild(a),n.innerHTML+="Cropped Image ("+k(g.size)+", "+h.width+"x"+h.height+")<br>",n.appendChild(i),n.innerHTML+=" | ",n.appendChild(o),setTimeout(function(){n.classList.toggle("pvOpct")},2e3),document.getElementById("closeCrop").onclick=function(){d.destroy(),r.remove(),c=!0},document.getElementById("setCrop").onclick=function(){v()},document.getElementById("undoCrop").onclick=function(){r.remove(),R(t)})}function v(){l.disconnect(),c=!0,Ne&&console.log("[classObserver] Stopping..."),r.remove(),y(),N(p,g.size,s.width,s.height,B.name,g.type),S(g,t,s.width,s.height)}}}}),d=new DaiyamCropper(c,{aspectRatio:NaN,background:!1,guides:!1,viewMode:1,autoCrop:!1,scalable:!1})}function N(e,t,n,i,o,l){var a,s=document.getElementById("previewImg");s?s.onclick=function(){E(e,t,n,i,o,l)}:((a=document.createElement("a")).id="previewImg",a.classList.add("sideMenuElement"),a.classList.add("entry"),a.innerHTML="Preview Image",a.onmouseover=function(){this.classList.toggle("focused")},a.onmouseout=function(){this.classList.toggle("focused")},a.onclick=function(){E(e,t,n,i,o,l)},document.getElementById("sideMenu").appendChild(a))}Ne&&console.log("Acceptable File type: "+B.type),document.getElementById("sm-hr")||((M=document.createElement("hr")).id="sm-hr",M.style.borderColor=b(),document.getElementById("sideMenu").appendChild(M)),a=!1,s=t(),r=n(),T.onload=function(){var t=new Image;t.src=T.result,t.onload=function(){var i=SparkMD5.hash(t.src);Ne&&console.log("<FILTER START>"),Ne&&(e().convert?console.log("[WebPConverter] Enabled"):console.log("[WebPConverter] Disabled")),Ne&&console.log("INPUT Dimensions: "+t.width+"x"+t.height),Ne&&console.log("INPUT File size: "+k(B.size)),n().length>0&&function(e,t){var n,i,o;for(Ne&&console.log("[quickConverter] Checking for a matching MD5: "+t),n=r.length,i=!1,o=0;o<n;o++)if(r[o].split(":").pop()==t){Ne&&console.log("[quickConverter] Match found."),i=!0,H(e.width,e.height,e);break}Ne&&(i||console.log("[quickConverter] No match found."))}(t,i),s.length>0&&!a&&function(e){var t,n,i,o,l,a;for(t=0,n=[],i=s.length,o=0;o<i;o++){if(n[o]=s[o].split(":"),Ne&&console.log("Looking for matching presets..."),0!=n[o][0]){switch(parseInt(n[o][0])){case 1:n[o][0]="image/png";break;case 2:n[o][0]="image/jpeg"}if(n[o][0]!=B.type)continue}if(n[o][1]==e.width&&n[o][2]==e.height){l=parseInt(n[o][3]),a=parseInt(n[o][4]),t++,Ne&&console.log("Preset '"+o+"' matched: "+n[o]);break}}0==t||t>1?Ne&&console.log("Image didn't match any presets."):H(l,a,e)}(t),e().convert&&!a&&function(t){var n,i;"image/webp"==B.type?(n=t.width,i=t.height,Ne&&console.log("[WebPConverter] Converting WebP to: "+e().convertOutput),H(n,i,t,void 0,!0)):Ne&&console.log("[WebPConverter] Image format isn't WebP.")}(t),a||(p(),v(),h(),function(e,t,n){var i,o=document.createElement("div");o.id="qcDiv",(i=document.createElement("a")).id="quickConvert",i.classList.add("sideMenuElement"),i.classList.add("entry"),i.innerHTML="Quick Convert",i.title="Convert image to JPEG format",i.onmouseover=function(){this.classList.toggle("focused")},i.onmouseout=function(){this.classList.toggle("focused")},i.addEventListener("click",function(){Ne&&console.log("[quickConverter] Manually calling Resizer..."),H(e.width,e.height,e,n)}),document.getElementById("sideMenu").appendChild(o),o.appendChild(i)}(t,0,i),function(e,t){var n,i=document.createElement("div");i.id="manDiv",(n=document.createElement("a")).id="manualResize",n.classList.add("sideMenuElement"),n.classList.add("entry"),n.innerHTML="Manual Resize",n.title="Manually resize image",n.onmouseover=function(){this.classList.toggle("focused")},n.onmouseout=function(){this.classList.toggle("focused")},n.addEventListener("click",function(){Ne&&console.log("[ManualResizer] Opened."),function(e,t){var n,i,o,a,s,r,c=document.createElement("div");c.id="manInput",c.classList.add("dialog"),document.getElementById("qr").insertAdjacentElement("afterbegin",c),c.innerHTML='<input type="number" id="resWidth" title="Output Width" size="3" min="0" onfocus="this.select();"></input> x <input type="number" id="resHeight" title="Output Height" size="3" min="0" onfocus="this.select();"></input> <select id="resFormat" name="resFormat" title="Output Format" style="color: #000"><option id="opt1" value="image/png">PNG</option><option id="opt2" value="image/jpeg">JPEG</option></select><div id="testContainer" style="padding-top: 10px"><button id="resTest">Test</button><span id="resFS" title="Original size: '+k(t.size)+'" style="padding-left: 10px">'+k(t.size)+'</span></div><hr id="rm-hr";><a id="resSet" style="cursor: pointer">Set File</a>',document.getElementById("rm-hr").style.borderColor=b(),n=document.getElementById("resWidth"),i=document.getElementById("resHeight"),o=document.getElementById("resFS"),a=document.getElementById("resFormat"),s=document.getElementById("resTest"),r=document.getElementById("resSet"),n.value=e.width,n.max=e.width,n.placeholder=e.width,i.value=e.height,i.max=e.height,i.placeholder=e.height,a.value=t.type,t.size>4194304&&(o.style.color="red"),n.onkeypress=function(){return L(event)},i.onkeypress=function(){return L(event)},n.oninput=function(){d("width",e.width,e.height,n.value),u=null},i.oninput=function(){d("height",e.width,e.height,i.value),u=null},a.oninput=function(){u=null},s.onclick=function(){(n.value>e.width||i.value>e.height)&&(n.value=e.width,i.value=e.height),z(n.value,i.value,a.value,e,o)},r.onclick=function(){n.value>e.width||i.value>e.height?alert("No upscaling. Do it yourself."):u?(Ne&&console.log("[ManualResizer] testBlob found."),l.disconnect(),Ne&&console.log("[classObserver] Stopping..."),y(),N(C,u.size,n.value,i.value,t.name,u.type),S(u,e,n.value,i.value)):(Ne&&console.log("[ManualResizer] testBlob is null, calling fileSizeTester..."),z(n.value,i.value,a.value,e,o),l.disconnect(),Ne&&console.log("[classObserver] Stopping..."),y(),N(C,u.size,n.value,i.value,t.name,u.type),S(u,e,n.value,i.value))},window.addEventListener("click",function e(t){var n=document.getElementById("manInput");t.target.matches("#manInput")||t.target.matches("#resWidth")||t.target.matches("#resHeight")||t.target.matches("#resFormat")||t.target.matches("#opt1")||t.target.matches("#opt2")||t.target.matches("#resTest")||t.target.matches("#resFS")||t.target.matches("#testContainer")||t.target.matches("#manualResize")||(n.remove(),Ne&&console.log("[ManualResizer] Closed."),window.removeEventListener("click",e))})}(e,t)}),document.getElementById("sideMenu").appendChild(i),i.appendChild(n)}(t,B),x(t),y(),N(t.src,B.size,t.width,t.height,B.name,B.type))}},u=null,C=null,T.readAsDataURL(B)}else f(),h(),p(),y(),v(),Ne&&console.log("[Error] Invalid FileType: "+B.type)},!1);const c=document.getElementById("file-n-submit");o={attributes:!0},l=new MutationObserver(function(){if(!0===document.getElementById("file-n-submit").classList.contains("has-file")&&!0===i(2))Ne&&console.log("<START>\n[classObserver] File detected."),Ne&&console.log("[QRGetFile] Requesting file..."),document.dispatchEvent(new CustomEvent("QRGetFile"));else{if(!1===i(2))return void(Ne&&console.log("[classObserver] ImageResizer is disabled"));f(),h(),p(),g(),y(),v(),Ne&&console.log("[classObserver] No file")}}),Ne&&console.log("[classObserver] Starting..."),l.observe(c,o)},!1),xe=document.createElement("span"),(Re=document.createElement("a")).id="imgResizeSettings",Re.className+="fa fa-cog",Re.style="cursor: pointer;",Re.title="Image Resizer Settings",document.getElementById("shortcut-settings").insertBefore(xe,parent.nextSibling),xe.appendChild(Re),(x=document.createElement("div")).id="imgResizeOverlay",x.classList.add("settingsOverlay"),document.body.appendChild(x),(R=document.createElement("div")).id="imgResizeMenu",R.classList.add("dialog"),x.appendChild(R),(N=document.createElement("a")).className+="close fa fa-times",N.style="float: right;",N.title="Close",R.insertAdjacentElement("afterbegin",N),(O=document.createElement("a")).innerHTML+="Settings",O.classList.add("menuBtns"),O.style="font-weight: bold;",O.onclick=function(){G.className="downscale-menu-on",j.className="downscale-menu-off",W.className="downscale-menu-off",q.className="downscale-menu-off",O.style="font-weight: bold;",P.style="",Q.style="",D.style=""},R.appendChild(O),(P=document.createElement("a")).innerHTML+="Presets",P.classList.add("menuBtns"),P.onclick=function(){G.className="downscale-menu-off",j.className="downscale-menu-on",W.className="downscale-menu-off",q.className="downscale-menu-off",O.style="",P.style="font-weight: bold;",Q.style="",D.style=""},R.appendChild(P),(Q=document.createElement("a")).innerHTML+="Quick Convert",Q.classList.add("menuBtns"),Q.onclick=function(){G.className="downscale-menu-off",j.className="downscale-menu-off",W.className="downscale-menu-on",q.className="downscale-menu-off",O.style="",P.style="",Q.style="font-weight: bold;",D.style=""},R.appendChild(Q),(D=document.createElement("a")).innerHTML+="About",D.classList.add("menuBtns"),D.onclick=function(){G.className="downscale-menu-off",j.className="downscale-menu-off",W.className="downscale-menu-off",q.className="downscale-menu-on",O.style="",P.style="",Q.style="",D.style="font-weight: bold;"},R.appendChild(D),(F=document.createElement("hr")).style.borderColor=b(),R.appendChild(F),(J=document.createElement("div")).id="imgResizeContent",R.appendChild(J),J.innerHTML="",(A=document.createElement("p")).id="errMsg",(G=document.createElement("div")).id="settingsDiv",G.classList.add("downscale-menu-on"),J.appendChild(G),(j=document.createElement("div")).id="presetsDiv",j.classList.add("downscale-menu-off"),j.style.textAlign="center",J.appendChild(j),(W=document.createElement("div")).id="QCListDiv",W.classList.add("downscale-menu-off"),J.appendChild(W),(q=document.createElement("div")).id="heplDiv",q.classList.add("downscale-menu-off"),J.appendChild(q),(U=document.createElement("h3")).innerHTML="Image Resizer Settings",G.appendChild(U),(Y=document.createElement("div")).classList.add("resizer-settings"),Y.innerHTML='<input type="checkbox" id="enableSet" title="" size="1"></input><label for="enableSet">Enable Resizer</label>:&ensp;Enable 4chan Image Resizer by default.',G.appendChild(Y),(K=document.getElementById("enableSet")).checked=e().enabled,K.oninput=function(){K.checked||(h(),p(),g(),y());var t=e();t.enabled=K.checked,document.getElementById("imgResize").checked=K.checked,localStorage.setItem("downscale-settings",JSON.stringify(t))},(V=document.createElement("div")).classList.add("resizer-settings"),V.innerHTML='<input type="checkbox" id="shortcutSet" title="" size="1"></input><label for="shortcutSet">Enable Shortcut</label>:&ensp;Enable "Quick Convert" shortcut. <kbd>Ctrl</kbd> + <kbd>Q</kbd> by default.',G.appendChild(V),(_=document.getElementById("shortcutSet")).checked=e().shortcut,_.oninput=function(){var t=e();t.shortcut=_.checked,localStorage.setItem("downscale-settings",JSON.stringify(t))},($=document.createElement("div")).classList.add("resizer-settings"),$.innerHTML='<input type="checkbox" id="displaySet" title="" size="1"></input><label for="displaySet">Display Notifications</label>:&ensp;Display a notification when an image is downscaled.',G.appendChild($),(Z=document.getElementById("displaySet")).checked=e().notify,Z.oninput=function(){var t=e();t.notify=Z.checked,localStorage.setItem("downscale-settings",JSON.stringify(t))},(X=document.createElement("div")).classList.add("resizer-settings"),X.innerHTML='<input type="checkbox" id="convertSet" title="" size="1"></input><label for="convertSet">Convert WebP to </label><select id="convertOut" name="cropOut"><option value="image/png">PNG</option><option value="image/jpeg">JPEG</option></select>:&ensp;Automatically convert WebP images to selected format.',G.appendChild(X),(ee=document.getElementById("convertSet")).checked=e().convert,(te=document.getElementById("convertOut")).value=e().convertOutput,ee.oninput=function(){var t=e();t.convert=ee.checked,t.convertOutput=te.value,localStorage.setItem("downscale-settings",JSON.stringify(t))},te.oninput=function(){var t=e();t.convert=ee.checked,t.convertOutput=te.value,localStorage.setItem("downscale-settings",JSON.stringify(t))},(ne=document.createElement("div")).classList.add("resizer-settings"),ne.innerHTML='<input type="text" id="imgQuality" title="JPEG Quality" size="2"></input><label for="imgQuality">JPEG Quality</label>:&ensp;A number between 1 and 100 indicating the output image quality.',G.appendChild(ne),(ie=document.getElementById("imgQuality")).value=100*e().jpegQuality,ie.oninput=function(){var t,n=document.getElementById("imgQuality");new RegExp(/^$|^[1-9][0-9]?$|^100$/).test(n.value)&&""!=n.value?(n.setCustomValidity(""),(t=e()).jpegQuality=n.value/100,localStorage.setItem("downscale-settings",JSON.stringify(t))):""==n.value?(n.setCustomValidity("Input a number between 1 and 100.\nCurrent set value: "+100*e().jpegQuality),n.reportValidity()):(n.setCustomValidity("Input a number between 1 and 100.\nCurrent set value: "+100*e().jpegQuality),n.reportValidity(),n.value=100*e().jpegQuality)},(oe=document.createElement("div")).classList.add("resizer-settings"),oe.innerHTML='<select id="cropOut" name="cropOut"><option value="image/png">PNG</option><option value="image/jpeg">JPEG</option></select>&ensp;<label for="cropOut">Crop Output</label>:&ensp;Set the desired output format for cropped images.',G.appendChild(oe),(le=document.getElementById("cropOut")).value=e().cropOutput,le.oninput=function(){var t=e();t.cropOutput=le.value,localStorage.setItem("downscale-settings",JSON.stringify(t))},(ae=document.createElement("div")).style.overflowY="auto",ae.style.maxHeight="220px",se=document.createElement("table"),re=document.createElement("thead"),de=document.createElement("tbody"),(ce=document.createElement("h3")).innerHTML="Presets",j.appendChild(ce),se.appendChild(re),se.appendChild(de),se.id="ruleTable",(ue=re.insertRow(0)).insertCell(0).outerHTML="<th>Format</th>",ue.insertCell(1).outerHTML="<th>Input</th>",ue.insertCell(2).outerHTML="<th></th>",ue.insertCell(3).outerHTML="<th>Output</th>",ue.insertCell(4).outerHTML="<th></th>",ue.insertCell(5).outerHTML="<th></th>",j.appendChild(ae),ae.appendChild(se),(me=document.createElement("div")).id="inputContainer",j.appendChild(me),(pe=document.createElement("button")).id="addRule",pe.innerHTML="New Preset",c(),j.appendChild(pe),j.appendChild(A),Re.onclick=function(){x.style.display="block"},N.onclick=function(){x.style.display="none"},window.addEventListener("click",function(e){e.target==x&&(x.style.display="none")}),pe.onclick=function(){u(!1)},(ge=document.createElement("div")).style="float: left;",(he=document.createElement("span")).innerHTML=" | ",ye=document.createElement("a"),fe=document.createElement("a"),ye.innerHTML="Import",fe.innerHTML="Export",ye.classList.add("menuBtns"),ge.innerHTML+='<input id="importPresetsFile-input" type="file" accept=".json" style="display: none;" />',ye.onclick=function(){document.getElementById("importPresetsFile-input").click()},fe.onclick=function(){C(t(),"4chan Image Resizer v2.5 Presets List - "+Date.now())},ge.appendChild(ye),ge.appendChild(he),ge.appendChild(fe),j.appendChild(ge),document.getElementById("importPresetsFile-input").addEventListener("change",function(){var e=new FileReader;e.onload=function(){var n,i,o=t(),l=0,a=0,s=JSON.parse(e.result);if(Array.isArray(s)){for(let e=0;e<s.length;e++){if(5!=(n=s[e].split(":")).length)return Ne&&console.log("[Error] Imported array does not match the required length (5)"),Ne&&console.log(n),void alert("Error: Array length mismatch.\nThis file is either outdated or invalid.");for(let e=0;e<o.length;e++)if(n[0]+":"+n[1]+":"+n[2]+":"+n[3]+":"+n[4]==o[e]){a++;break}0==a?o.push(s[e]):(l+=a,a=0)}localStorage.setItem("downscale-presets",JSON.stringify(o)),document.getElementById("ruleTable").tBodies.item(0).innerHTML="",c(),i=s.length-l,alert("Succesfully imported "+s.length+" entries.\nDuplicate entries skipped: "+l+"\nNew entries added: "+i)}else alert("Error: Invalid data type."),Ne&&console.log("[Error] Imported data object is not an array.")},e.readAsText(this.files[0])}),(ve=document.createElement("div")).style.overflowY="auto",ve.style.maxHeight="220px",be=document.createElement("table"),Ee=document.createElement("thead"),Ie=document.createElement("tbody"),(Ce=document.createElement("h3")).innerHTML="Quick Convert List",W.appendChild(Ce),W.innerHTML+="<p style='text-align: center;'>Images on this list will be automatically converted to JPEG with a quality setting of 92.</p>",be.appendChild(Ee),be.appendChild(Ie),be.id="QCTable",(we=Ee.insertRow(0)).insertCell(0).outerHTML="<th>Format</th>",we.insertCell(1).outerHTML="<th>Dimensions</th>",we.insertCell(2).outerHTML="<th>Original Size</th>",we.insertCell(3).outerHTML="<th></th>",we.insertCell(4).outerHTML="<th>New Size</th>",we.insertCell(5).outerHTML="<th>Filename</th>",we.insertCell(6).outerHTML="<th></th>",W.appendChild(ve),ve.appendChild(be),(Le=document.createElement("div")).style="padding-top: 1em;",(ke=document.createElement("span")).innerHTML=" | ",Me=document.createElement("a"),Be=document.createElement("a"),Me.innerHTML="Import",Be.innerHTML="Export",Me.classList.add("menuBtns"),Le.innerHTML+='<input id="importQCLFile-input" type="file" accept=".json" style="display: none;" />',Me.onclick=function(){document.getElementById("importQCLFile-input").click()},Be.onclick=function(){C(n(),"4chan Image Resizer v2.5 Quick Convert List - "+Date.now())},Le.appendChild(Me),Le.appendChild(ke),Le.appendChild(Be),W.appendChild(Le),document.getElementById("importQCLFile-input").addEventListener("change",function(){var e=new FileReader;e.onload=function(){var t,i,o,l=n(),a=0,s=0,r=JSON.parse(e.result);if(Array.isArray(r)){for(let e=0;e<r.length;e++){if(7!=(t=r[e].split(":")).length||32!=t[6].length)return Ne&&console.log("[Error] Imported array does not match the required length (7) or contains an invalid MD5 hash."),Ne&&console.log(t),void alert("Error: Array length mismatch.\nThis file is either outdated or invalid.");for(let e=0;e<l.length;e++)if(i=l[e].split(":"),t[6]==i[6]){s++;break}0==s?l.push(r[e]):(a+=s,s=0)}localStorage.setItem("downscale-qclist",JSON.stringify(l)),document.getElementById("QCTable").tBodies.item(0).innerHTML="",m(),o=r.length-a,alert("Succesfully imported "+r.length+" entries.\nDuplicate entries skipped: "+a+"\nNew entries added: "+o)}else alert("Error: Invalid data type."),Ne&&console.log("[Error] Imported data object is not an array.")},e.readAsText(this.files[0])}),Te=document.createElement("a"),He=[],Te.innerHTML="Delete All",Te.style="float: right; margin-right: 1em;",Te.onclick=function(){confirm('WARNING!\nAre you sure you want to DELETE ALL entries from the "Quick Convert List"?')&&(localStorage.setItem("downscale-qclist",JSON.stringify(He)),document.getElementById("QCTable").tBodies.item(0).innerHTML="")},Le.appendChild(Te),m(),(Se=document.createElement("h3")).innerHTML="About",q.appendChild(Se),(ze=document.createElement("div")).innerHTML='<strong>4chan Image Resizer</strong> automatically downscales images based on custom presets. Originally developed to downscale anime/vidya screenshots "on the fly". Now with image cropping and WebP conversion!<br><br><details><summary><strong>Presets</strong></summary><br>To automate image resizing, you have to create a preset by choosing an input image format and entering input and output dimensions (pixels). Then just add an image to a quick reply form. If it meets any of the created input requirements, the image will be automatically downscaled to your specified dimensions as a <strong>JPEG</strong>. <br><br><strong>Note</strong> that output dimensions are constrained by input dimensions <strong>aspect ratio</strong>. <br><strong>Also note</strong> that <strong>setting JPEG output quality to 100 will</strong> result in filesizes larger than that of the original image, without any noticable quality changes.</details><br><details><summary><strong>Quick Convert</strong></summary><br>Allows you to quickly convert images (PNG/JPEG/WebP) to JPEG fromat.<br>This is very useful when an image exceeds 4chan image size limit of <strong>4 MB</strong>.<br><br>It works well on super high resolution images (+3000px), sometimes drastically cutting the filesize without any noticeble quality loss. However, <strong>it is not recommended to use it on grayscale PNG images</strong>, i.e. manga pages, because most of the time <strong>it will result in larger than original filesizes</strong>.<br>Once you are satisfied with the <strong>"Quick Convert"</strong> results, you can click <strong>"Remember"</strong> on the side menu to add the image MD5 hash to the <strong>"Quick Convert List"</strong>, which then will always automatically convert the image for you in the future.<br><br>You can also use the default <kbd>Ctrl</kbd> + <kbd>Q</kbd> keyboard shortcut to perform <strong>"Quick Convert"</strong> faster. Press again to <strong>"Remember"</strong> the image.</details><br><details><summary><strong>Import/Export</strong></summary><br>Allows you to seperatly backup both, "Presets" and "Quick Convert" lists as .json files.<br><strong>Import</strong> works by merging list entries instead of overwriting them, <span style="text-decoration-line: line-through;">so you can export/import items between domains without any worry.</span></details><br><details><summary><strong>Image Cropping</strong></summary><br>A basic image cropping tool that uses <a href="https://github.com/daiyam/cropperjs/tree/daiyam" target="_blank">Daiyam/Cropper.js</a> library. You can change cropped image output format in the settings tab.<br><strong>PNG</strong> is lossless and preserves transperancy, but results in larger filesizes.<br><strong>JPEG</strong> is lossy, but results in smaller filesizes (the <strong>"JPEG Quality"</strong> setting also applies here).</details><br><details><summary><strong>Cropper Controls</strong></summary><br>While cropping:<ul><li>Double click <kbd>LMB</kbd> - switch between cropping and zooming.</li><li>Hold <kbd>Shift</kbd> while cropping - draw a fixed rectangle.</li><li><kbd>MWheel</kbd> - zoom in/out.</li><li><kbd>Backspace</kbd> - clear selection.</li><li><kbd>Enter</kbd> - confirm selection.</li><li><kbd>Esc</kbd> or <kbd>Delete</kbd> - close cropper.</li></ul>After selection:<br><ul><li><kbd>Enter</kbd> or <kbd>LMB</kbd> - set image to QR form.</li><li><kbd>Backspace</kbd> or <kbd>RMB</kbd> - undo selection.</li><li><kbd>MMB</kbd> - close cropper.</li><li><kbd>Shift</kbd> + <kbd>RMB</kbd> - open context menu.</li></ul></details><br><details><summary><strong>Custom Shortcuts</strong></summary><br>I am way too lazy to implement custom keybind functionality and the UI for it. But if you really want to change the default keybinds, you will have to edit the code directly.<br><br>To do that, you first have to open the code in your script manager (Tampermonkey, Violentmonkey, etc.).<br>If you want to change "<strong>Quick Convert</strong>" shortcut, hit Ctrl+F and search for "<strong>Quick Convert KEYBINDS</strong>".<br>If you want to change "<strong>Image Cropper</strong>" shortcuts, hit Ctrl+F and search for "<strong>Cropper KEYBINDS</strong>".<br>All you have to do now is change the <strong>keyCode</strong> values to the ones that represent your desired keys. You can easily find equivalent keyCode values for each keyboard key by <a href="https://www.google.com/search?q=keyCode+values" target="_blank">googling</a> them.</details><br><span style="font-weight:bold; color: red;">NEW</span><ul><li>Replaced the useless auto PNG conversion with auto WebP conversion.</li><li>Image  preview header now displays the correct file type after conversion.</li><li>Some minor UI adjustments.</li><br><br><div style="float: right;" >[ <a href="https://greasyfork.org/en/scripts/391758-4chan-image-resizer" target="_blank">version 2.5</a> ]</div>',q.appendChild(ze),H=!1,e().shortcut&&!H&&(document.addEventListener("keyup",function(t){var n=document.getElementById("quickConvert"),i=document.getElementById("rememberMD5");e().shortcut&&(t.ctrlKey&&81==t.keyCode&&n?n.click():t.ctrlKey&&81==t.keyCode&&i&&i.click())}),H=!0);