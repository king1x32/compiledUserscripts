// ==UserScript==
// @name        ðŸ† [#1 Chess Assistant] A.C.A.S (Advanced Chess Assistance System)
// @name:en     ðŸ† [#1 Chess Assistant] A.C.A.S (Advanced Chess Assistance System)
// @homepageURL https://psyyke.github.io/A.C.A.S
// @supportURL  https://github.com/Psyyke/A.C.A.S/tree/main#why-doesnt-it-work
// @match       https://psyyke.github.io/A.C.A.S/*
// @match       http://localhost/*
// @match       https://www.chess.com/*
// @match       https://lichess.org/*
// @match       https://playstrategy.org/*
// @match       https://www.pychess.org/*
// @match       https://chess.org/*
// @match       https://papergames.io/*
// @match       https://vole.wtf/kilobytes-gambit/
// @match       https://chess.coolmathgames.com/*
// @match       https://www.coolmathgames.com/0-chess/*
// @match       https://immortal.game/*
// @match       https://worldchess.com/*
// @match       http://chess.net/*
// @match       https://chess.net/*
// @match       https://www.freechess.club/*
// @match       https://*.chessclub.com/*
// @match       https://gameknot.com/*
// @match       https://chesstempo.com/*
// @match       https://www.redhotpawn.com/*
// @match       https://www.chessanytime.com/*
// @match       https://www.simplechess.com/*
// @match       https://chessworld.net/*
// @match       https://app.edchess.io/*
// @grant       GM_getValue
// @grant       GM_setValue
// @grant       GM_deleteValue
// @grant       GM_listValues
// @grant       GM_openInTab
// @grant       GM.getValue
// @grant       GM.setValue
// @grant       GM.deleteValue
// @grant       GM.listValues
// @grant       GM.openInTab
// @grant       GM_registerMenuCommand
// @grant       GM_setClipboard
// @grant       GM_notification
// @grant       unsafeWindow
// @run-at      document-start
// @require     https://update.greasyfork.org/scripts/534637/LegacyGMjs.js?acasv=2
// @require     https://update.greasyfork.org/scripts/470418/CommLinkjs.js?acasv=2
// @require     https://update.greasyfork.org/scripts/470417/UniversalBoardDrawerjs.js?acasv=1
// @icon        https://raw.githubusercontent.com/Psyyke/A.C.A.S/main/assets/images/grey-logo.png
// @version     2.3.2
// @namespace   HKR
// @author      HKR
// @license     GPL-3.0
// @downloadURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/F09F8F86205B120Chess20Cheat5D20ACAS2028Advanced20Chess20Assistance20System29.user.js
// @updateURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/F09F8F86205B120Chess20Cheat5D20ACAS2028Advanced20Chess20Assistance20System29.meta.js
// ==/UserScript==
(async()=>{function e(e){const t=window.location.protocol+"//",o=R;return t+(e||o?.prod||o?.path)+N}function t(t){const o=GM_getValue(V);return t||!o?e():(n=o).startsWith("http://")||n.startsWith("https://")?n:"http://"+n;var n}function o(e){return{set:(t,o)=>GM_setValue(I[e](t),{value:o,date:Date.now()}),get:t=>{const o=GM_getValue(I[e](t));return o?.date&&(o.date=Date.now(),GM_setValue(I[e](t),o)),o?.value}}}function n(){return([1e7]+-1e3+4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}function s(e,t,o){const n=(e,n)=>["stroke: rgb(0 0 0 / 50%);","stroke-width: 2px;","stroke-linejoin: round;",`fill: ${t||e};`,`opacity: ${o||n};`].join("\n");switch(e){case"best":return n("limegreen",.9);case"secondary":return n("dodgerblue",.7);case"opponent":return n("crimson",.3)}}function i(e,t){"function"==typeof GM_notification?GM_notification({title:e,text:t}):alert(`[${e}]\n\n`+t)}function r(e,t){return[...e].filter(e=>{const o=getComputedStyle(e),n=e.getBoundingClientRect(),s="hidden"===o.visibility||"none"===o.display||"0"===o.opacity||0==n.width||0==n.height;return t?s:!s})}function a(e){const t=e.getBoundingClientRect();if(0!==t.width&&0!==t.height)return{width:t.width,height:t.height};const o=window.getComputedStyle(e);return{width:parseFloat(o.width),height:parseFloat(o.height)}}function c(e,t){const o=t?.onlyFlipY;ee=a(W);const[n,s]=S();X=s,Z=n;const i=w();let[r,c]=function(e){const t=window.getComputedStyle(e),o=new DOMMatrix(t.transform);return[o.e,o.f]}(e),l=ee.width/X;const d=Math.round(r/l),u=Math.round(c/l);return o||"w"===i?[d,Z-u-1]:[X-d-1,u]}function l(e){const t=a(e);te=t;const o=parseFloat(e.style.left?.replace("px","")),n=parseFloat(e.style.top?.replace("px","")),s=Math.max(Math.round(o/t.width),0),i=Math.max(Math.round(n/t.width),0);return"w"===w()?[s,Z-(i+1)]:[X-(s+1),i]}function d(){const e=a(W);ee=e;const t=e?.width,o=e.height,n=E();if(n){const e=a(n);te=a(n);const s=e?.width,i=e?.height,r=Math.floor(t/s),c=Math.floor(o/i);if(0<r&&r<=69&&0<c&&c<=69)return[r,c]}}function u(e){const t=e.charCodeAt(0)-97;let o=null;return o=":"===e.slice(1)?9:Number(e.slice(1))-1,[t,o]}function m(e){const[t,o]=S(),[n,s]=(C(),e);let i;return i=t-s,`${String.fromCharCode("a".charCodeAt(0)+n)}${i}`}function h(e){const t=W.getBoundingClientRect(),o=a(E()),n=o?.width,s=o?.height;te=o;const[i,r]=S(),c=e.map(e=>{const[o,i]=function(e){const[t,o]=S(),n=u(e);let s,i;return"w"===C()?(s=n[0],i=o-(n[1]+1)):(s=t-(n[0]+1),i=n[1]),[s,i]}(e);return[t.x+o*n+n/2,t.y+i*s+s/2]});return c}function p(e,t){C();let[o,n]=function(e){const[t,o]=S(),n=u(e);let s,i;return i=o-(n[1]+1),s=n[0],[s,i]}(e);const s=t[n][o];if(1===s)return null;const i=s===s.toUpperCase(),r=(e,t,o,n)=>Math.abs(e-o)+Math.abs(t-n);let a=[];for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++){const c=t[e][s];if(1===c||i&&c===c.toLowerCase()||!i&&c===c.toUpperCase())continue;const l=r(n,o,e,s);l<6&&a.push({distance:l,coord:[s,e],piece:c})}return a.length>0?h([m(a[Math.floor(Math.random()*a.length)].coord)])[0]:null}function g(){return E(!0)?.length??0}function f(e,t){return $[e]?.get(t)}function w(){return U.playerColor.get(B)}function y(e,[t,o],n){t=Math.min(Math.max(t,0),100),o=Math.min(Math.max(o,0),100);const s=e.getContext("2d"),i=t*e.width,r=o*e.height,a=s.getImageData(i,r,1,1).data;if(n){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const o=t.getContext("2d");o.drawImage(e,0,0),o.fillStyle="red",o.beginPath(),o.arc(i,r,1,0,2*Math.PI),o.fill();const n=t.toDataURL();console.log(e,a,n)}return 0!==a[3]}function b(e,t){let o={pathname:window.location.pathname};t&&"object"==typeof t&&(o={...o,...t});const n=le[F]?.[e];return"function"!=typeof n?null:n(o)}function v(e,t){le[e]=t}function M(){return b("boardElem")||null}function E(e){const t=M(),o=e?e=>[...t?.querySelectorAll(e)]:t?.querySelector?.bind(t);return"function"!=typeof o?null:b("pieceElem",{boardQuerySelector:o,getAll:e})||null}function C(){return b("boardOrientation")||null}function S(){const e=b("boardDimensions");return e?(X=e[0],Z=e[1],e):(X=8,Z=8,[8,8])}function L(){const[e,t]=S(),o=Array.from({length:t},()=>Array(e).fill(1)),n=E(!0);return(Array.isArray(n)||n instanceof NodeList)&&n.forEach(e=>{const n=function(e){return b("pieceElemFen",{pieceElem:e})||null}(e),s=function(e){return b("pieceElemCoords",{pieceElem:e})||null}(e);try{const[e,i]=s;o[t-(i+1)][e]=n}catch(e){}}),oe=o,o}function k(e){const[t,o]=S(),n=u(e);return L()?.[o-(n[1]+1)]?.[n[0]]}function A(e){const t=L().map(e=>e.join("")).join("/").replace(/1+/g,e=>e.length);return e?t:`${t} ${w()} ${function(){let e="";const t=k("e1"),o=k("h1"),n=k("a1");"K"==t&&"R"==o&&(e+="K"),"K"==t&&"R"==n&&(e+="Q");const s=k("e8"),i=k("h8"),r=k("a8");return"k"==s&&"r"==i&&(e+="k"),"k"==s&&"r"==r&&(e+="q"),e||"-"}()} - 0 1`}function D(){K=null}function q(e,t){const o=A();if(o!==U.fen.get(B)||t){const e=g();Math.abs(e-re)>7&&(se=!1),D(),me.setBoardDimensions(S());const t=w();O();const n=w(),s=n!=t;s&&(ue.commands.log(`Player color (e.g. board orientation) changed from ${t} to ${n}!`),D(),se=!1,ue.commands.log(`Turn updated to ${n}!`)),me.removeMarkings(),ue.commands.updateBoardFen(o),ie=Date.now(),re=e,s&&ue.commands.calculateBestMoves(o)}}async function O(){const e=C();(ne!==e||Q&&Q?.orientation!==e)&&(ne=e,U.playerColor.set(B,e),me.setBoardOrientation(e),await ue.commands.updateBoardOrientation(e))}async function x(){await ue.commands.createInstance(B);const e=window.location.pathname,t="chess.com"===F&&e?.includes("/variants"),o="app.edchess.io"===F,n=C();U.playerColor.set(B,n),U.fen.set(B,A()),function(){const e=GM_getValue(I.AcasConfig),t=e?.global?.profiles,o=e?.instance?.[B]?.profiles;if(t){const e=Object.keys(t);for(profileName of e){const e=t[profileName][H.displayMovesOnExternalSite],o=t[profileName][H.renderOnExternalSite],n=t[profileName][H.feedbackOnExternalSite];if(e||o||n)return!0}}if(o){const e=Object.keys(o);for(profileName of e){const e=o[profileName][H.displayMovesOnExternalSite],n=t[profileName][H.renderOnExternalSite],s=t[profileName][H.feedbackOnExternalSite];if(e||n||s)return!0}}return!1}()&&(Q=new UniversalBoardDrawer(W,{window:window,boardDimensions:S(),playerColor:w(),zIndex:"worldchess.com"===F?9999:500,prepend:!0,debugMode:G,adjustSizeByDimensions:!!t,adjustSizeConfig:{noLeftAdjustment:!0},ignoreBodyRectLeft:o})),await O(),new MutationObserver(e=>{if(function(e){return b("isMutationNewMove",{mutationArr:e})||!1}(e))try{"chess.org"===F||"worldchess.com"===F?setTimeout(()=>q(),250):q()}catch(e){}}).observe(W,{childList:!0,subtree:!0,attributes:!0}),ue.setIntervalAsync(async()=>{await ue.commands.createInstance(B)},1e3)}await LOAD_LEGACY_GM_SUPPORT();const R={prod:"psyyke.github.io",dev:"localhost"},N="/A.C.A.S/",V="currentBackendURL",P="function"==typeof GM_getValue?GM_getValue(V):await GM.getValue(V),_=Object.values(R).some(e=>P?.includes(e)),G=!1,F=window.location.hostname.replace("www.","");_||GM_setValue(V,t(!0));const T="-temp-value-",I={AcasConfig:"AcasConfig",playerColor:e=>"playerColor"+T+e,turn:e=>"turn"+T+e,fen:e=>"fen"+T+e},U={playerColor:o("playerColor"),fen:o("fen")};if(function(){const t=Object.values(R).find(e=>e===window?.location?.host),o=window?.location?.pathname?.includes(N),n="string"==typeof t&&o;return n&&GM_setValue(V,e(t)),n}())return void("object"==typeof unsafeWindow?"object"==typeof unsafeWindow&&(unsafeWindow.USERSCRIPT={getValue:e=>GM_getValue(e),setValue:(e,t)=>GM_setValue(e,t),deleteValue:e=>GM_deleteValue(e),listValues:e=>GM_listValues(e),instanceVars:U,getInfo:()=>GM_info},unsafeWindow.isUserscriptActive=!0):function(){const e={USERSCRIPT_getValue:(e,t)=>{const[o]=e,n=GM_getValue(o);window.postMessage({messageId:t,value:n},"*")},USERSCRIPT_setValue:(e,t)=>{const[o,n]=e;GM_setValue(o,n),window.postMessage({messageId:t,value:!0},"*")},USERSCRIPT_deleteValue:(e,t)=>{const[o]=e;GM_deleteValue(o),window.postMessage({messageId:t,value:!0},"*")},USERSCRIPT_listValues:(e,t)=>{const o=GM_listValues();window.postMessage({messageId:t,value:o},"*")},USERSCRIPT_getInfo:(e,t)=>{const o="undefined"!=typeof GM_info?JSON.parse(JSON.stringify(GM_info)):{};window.postMessage({messageId:t,value:o},"*")},USERSCRIPT_instanceVars:(e,t)=>{const[o,n,s]=e;if(!U.hasOwnProperty(n))return void window.postMessage({messageId:t,value:!1},"*");const i=void 0!==s?U[n].set(o,s):U[n].get(o);window.postMessage({messageId:t,value:i},"*")}};window.addEventListener("message",t=>{const o=e[t.data?.type];o&&o(t.data.args,t.data.messageId)});const t=document.createElement("script");t.innerHTML="window.isUserscriptActive = true;",document.head.appendChild(t)}());const B=n(),j=[e(R?.prod),e(R?.dev),"https://www.chess.com/play","https://lichess.org/","https://chess.org/","https://papergames.io/en/chess","https://playstrategy.org/","https://www.pychess.org/","https://www.coolmathgames.com/0-chess","https://chess.net/"],H={engineElo:"engineElo",moveSuggestionAmount:"moveSuggestionAmount",arrowOpacity:"arrowOpacity",displayMovesOnExternalSite:"displayMovesOnExternalSite",showMoveGhost:"showMoveGhost",showOpponentMoveGuess:"showOpponentMoveGuess",showOpponentMoveGuessConstantly:"showOpponentMoveGuessConstantly",onlyShowTopMoves:"onlyShowTopMoves",maxMovetime:"maxMovetime",chessVariant:"chessVariant",chessEngine:"chessEngine",lc0Weight:"lc0Weight",engineNodes:"engineNodes",chessFont:"chessFont",useChess960:"useChess960",onlyCalculateOwnTurn:"onlyCalculateOwnTurn",ttsVoiceEnabled:"ttsVoiceEnabled",ttsVoiceName:"ttsVoiceName",ttsVoiceSpeed:"ttsVoiceSpeed",chessEngineProfile:"chessEngineProfile",primaryArrowColorHex:"primaryArrowColorHex",secondaryArrowColorHex:"secondaryArrowColorHex",opponentArrowColorHex:"opponentArrowColorHex",reverseSide:"reverseSide",autoMove:"autoMove",autoMoveLegit:"autoMoveLegit",autoMoveRandom:"autoMoveRandom",autoMoveAfterUser:"autoMoveAfterUser",legitModeType:"legitModeType",moveDisplayDelay:"moveDisplayDelay",renderOnExternalSite:"renderOnExternalSite",feedbackOnExternalSite:"feedbackOnExternalSite",moveAsFilledSquares:"moveAsFilledSquares"},$={};Object.values(H).forEach(e=>{$[e]={get:t=>function(e,t,o){"object"==typeof o&&(o=o.name);const n=GM_getValue(I.AcasConfig),s=n?.instance?.[t]?.[e],i=n?.global?.[e];if(void 0!==s)return s;if(void 0!==i)return i;if(o){const s=n?.global?.profiles?.[o]?.[e],i=n?.instance?.[t]?.profiles?.[o]?.[e];if(void 0!==i)return i;if(void 0!==s)return s}return null}(e,B,t),set:null}});let Q=null,W=null,K=null,z=[],Y=[],J=[],X=null,Z=null,ee=null,te=null,oe=null,ne=null,se=!1,ie=0,re=0,ae=!1,ce=[];const le={},de={pawn:"p",knight:"n",bishop:"b",rook:"r",queen:"q",king:"k"},ue=new CommLinkHandler(`frontend_${B}`,{singlePacketResponseWaitTime:1500,maxSendAttempts:3,statusCheckInterval:1,silentMode:!0});ue.commands.createInstance=async()=>await ue.send("mum","createInstance",{domain:F,instanceID:B,chessVariant:b("chessVariant")||null,playerColor:w()}),ue.registerSendCommand("ping",{commlinkID:"mum",data:"ping"}),ue.registerSendCommand("pingInstance",{data:"ping"}),ue.registerSendCommand("log"),ue.registerSendCommand("updateBoardOrientation"),ue.registerSendCommand("updateBoardFen"),ue.registerSendCommand("calculateBestMoves"),ue.registerListener(`backend_${B}`,e=>{try{switch(e.command){case"ping":return`pong (took ${Date.now()-e.date}ms)`;case"getFen":return A();case"removeSiteMoveMarkings":return me.removeMarkings(),!0;case"markMoveToSite":me.markMoves(e.data);const o=e.data?.[0]?.profile,n=f(H.autoMove,o),s=f(H.autoMoveAfterUser,o);if(n&&(!s||se)){const t=ce.filter(e=>e.move.active);for(const e of t)e.move.stop();const n=f(H.autoMoveLegit,o);!async function(e,t,o){new he(e,t,o,()=>{})}(o,f(H.autoMoveRandom,o)?e.data[Math.floor(Math.random()*Math.random()*e.data.length)]?.player:e.data[0]?.player,n)}return se=!0,!0;case"renderMetricsToSite":return function(e){function t(e){const t=e?.data;if(!t)return;const o=t?.shapeType,n=t?.shapeSquare,s=t?.shapeConfig;if(o&&n&&s){const e=Q.createShape(o,n,s);Y.push(e)}}function o(t){return e.filter(e=>e?.data?.shapeType===t)||[]}Y.forEach(e=>{e&&e?.remove()}),o("text").forEach(t),o("rectangle").forEach(t)}(e.data),!0;case"feedbackToSite":return t=e.data,J.forEach(e=>{e&&e?.remove()}),t.forEach(function(e){const t=e?.data;if(!t)return;const o=t?.shapeType,n=t?.shapeSquare,s=t?.shapeConfig;if(o&&n&&s){const e=Q.createShape(o,n,s);J.push(e)}}),!0}}catch(e){return null}var t});const me={markMoves:e=>{function t(e,t){const o={style:t};return Q.createShape("rectangle",e,o)}const o=e.length,n={0:[],1:[]};e.forEach((e,i)=>{const r=e.profile;0===i&&me.removeMarkings(r);const[a,c]=e.player,[l,d]=e.opponent,u=l&&d,m=i+1,h=f(H.showOpponentMoveGuess,r),p=f(H.showOpponentMoveGuessConstantly,r),g=f(H.arrowOpacity,r)/100,w=f(H.primaryArrowColorHex,r),y=f(H.secondaryArrowColorHex,r),b=f(H.opponentArrowColorHex,r);if(f(H.moveAsFilledSquares,r)){const e=0===i?1:0,o=`opacity: ${g}; stroke-width: 5; stroke: black; rx: 2; ry: 2; fill: ${e?w:y};`,s=n[e].find(e=>e===a)?"opacity: 0;":"",l=`filter: brightness(1.5); stroke-dasharray: 4 4; ${o} ${n[e].find(e=>e===c)?"opacity: 0;":""}`,d=t(a,`${o} ${s}`),u=t(c,l);n[e].push(a,c),z.push({otherElems:[d,u]},r)}else{let t=null,n=null,f=s("best",w,g),v=30,M=80,E=60,C=30;if(0!==i){f=s("secondary",y,g);const e=2===o?.75:1-(m-1)/(o-1)*.5;v*=e,M*=e,E*=e}if(t=Q.createShape("arrow",[a,c],{style:f,lineWidth:v,arrowheadWidth:M,arrowheadHeight:E,startOffset:C}),u&&h)if(n=Q.createShape("arrow",[l,d],{style:s("opponent",b,g),lineWidth:v,arrowheadWidth:M,arrowheadHeight:E,startOffset:C}),p)n.style.display="block";else{const e=Q.addSquareListener(a,t=>{switch(n||e.remove(),t){case"enter":n.style.display="inherit";break;case"leave":n.style.display="none"}})}if(0===i&&t){const e=t.parentElement;e.appendChild(t),n&&e.appendChild(n)}z.push({...e,playerArrowElem:t,oppArrowElem:n,profile:r})}})},removeMarkings:e=>{let t=z;e?(t=t.filter(t=>t.profile===e),z=z.filter(t=>t.profile!==e)):z=[],t.forEach(e=>{e.oppArrowElem?.remove(),e.playerArrowElem?.remove(),e?.otherElems?.forEach(e=>e?.remove())})},setBoardOrientation:e=>{Q&&Q.setOrientation(e)},setBoardDimensions:e=>{Q&&Q.setBoardDimensions(e)}};class he{constructor(e,t,o,s){if(this.id=n(),ce.push({id:this.id,move:this}),this.profile=e,this.fenMoveArr=t,this.isLegit=o,this.active=!0,this.isPromotingPawn=!1,this.onFinished=function(...e){ce.filter(e=>e.id!==this.id),this.active=!1,s(...e)},this.moveDomCoords=h(t),this.isPromotion=function(e){const[t,o]=e,n=k(t);if("string"!=typeof n||"p"!==n.toLowerCase())return!1;const s=parseInt(o[1],10);return"P"===n&&s===(Z??8)||"p"===n&&1===s}(t),this.isLegit){const e=f(H.legitModeType,this.profile)??"casual",t=[{minPieces:30,maxPieces:1/0},{minPieces:23,maxPieces:29},{minPieces:16,maxPieces:22},{minPieces:10,maxPieces:15},{minPieces:6,maxPieces:9},{minPieces:3,maxPieces:5},{minPieces:1,maxPieces:2}],o={beginner:[[2e3,4e3],[3e3,15e3],[5e3,25e3],[4e3,3e4],[3e3,15e3],[2e3,1e4],[1e3,4e3]],casual:[[900,3e3],[1e3,15e3],[3e3,2e4],[2e3,13e3],[1500,1e4],[1e3,9e3],[500,3e3]],intermediate:[[750,2e3],[1e3,1e4],[2e3,15e3],[1500,12e3],[1e3,8e3],[750,7e3],[500,2e3]],advanced:[[500,1500],[1e3,8e3],[750,8e3],[750,12e3],[750,5e3],[750,3e3],[500,1200]],master:[[333,999],[400,2e3],[400,3e3],[400,2500],[400,2e3],[400,1500],[333,750]],professional:[[333,666],[333,666],[333,1e3],[333,1500],[333,1e3],[333,666],[333,666]],god:[[50,333],[50,233],[50,300],[50,250],[50,200],[50,150],[50,100]]};this.timeRanges=t.map((t,n)=>({...t,timeRange:o[e][n]})),this.shouldHesitate=this.isLegit&&Math.random()<.15,this.shouldHesitateTwice=this.isLegit&&Math.random()<.25,this.hesitationTypeOne=this.isLegit&&Math.random()<.35;const n=this.calculateMoveTime(g()),s=Date.now()-ie,i=Math.max(n-s,500),r=this.generateDelaysForDesiredTime(i);for(const e of Object.keys(r))this[e]=r[e]}this.start()}generateDelaysForDesiredTime(e){const t=this.getRandomIntegerBetween(1e3,1111);if(e>6e3){const o=[{move:.4,to:.2,hesitation:.15,hesitationResolve:.15,secondHesitationResolve:.15},{move:.1,to:.3,hesitation:.25,hesitationResolve:.15,secondHesitationResolve:.2},{move:.2,to:.25,hesitation:.2,hesitationResolve:.2,secondHesitationResolve:.15}],n=o[Math.floor(Math.random()*o.length)];return{promotionDelay:t,moveDelay:e*n.move,toSquareSelectDelay:e*n.to,hesitationDelay:e*n.hesitation,hesitationResolveDelay:e*n.hesitationResolve,secondHesitationResolveDelay:e*n.secondHesitationResolve}}if(e>3e3){const o=[{move:.3,to:.2,hesitation:.25,hesitationResolve:.25},{move:.1,to:.3,hesitation:.45,hesitationResolve:.15},{move:.2,to:.25,hesitation:.2,hesitationResolve:.35}],n=o[Math.floor(Math.random()*o.length)];return{promotionDelay:t,moveDelay:e*n.move,toSquareSelectDelay:e*n.to,hesitationDelay:e*n.hesitation,hesitationResolveDelay:e*n.hesitationResolve,secondHesitationResolveDelay:-1}}{const o=[{move:.9,to:.1},{move:.45,to:.55},{move:.6,to:.4},{move:.4,to:.6},{move:.1,to:.9}],n=o[Math.floor(Math.random()*o.length)];return{promotionDelay:t,moveDelay:e*n.move,toSquareSelectDelay:e*n.to,hesitationDelay:-1,hesitationResolveDelay:-1,secondHesitationResolveDelay:-1}}}calculateMoveTime(e){for(let t of this.timeRanges)if(e>=t.minPieces&&e<=t.maxPieces)return this.getRandomIntegerBetween(t.timeRange[0],t.timeRange[1]);return 500}getRandomIntegerBetween(e,t){return Math.floor(Math.random()*(t-e+1))+e}getRandomIntegerNearAverage(e,t){const o=(e+t)/2,n=(t-e)/2;let s=Math.floor(o+(Math.random()-.5)*n*1.5);return Math.max(e,Math.min(t,s))}delay(e){return!this.active||new Promise(t=>setTimeout(t,e))}async triggerPieceClick(e){if(!ce.find(e=>e.move===this))return;let t,o;if(e instanceof Element){const n=e.getBoundingClientRect();t=n.left+n.width/2,o=n.top+n.height/2}else{if("object"!=typeof e)return;t=e[0],o=e[1]}const n=Math.random()<.85?4:Math.random()<.15?3:2,s=Math.random()<.65?3:Math.random()<.35?2:4,i=(te?.width-4)/n,r=(te?.height-4)/s,a={bubbles:!0,cancelable:!0,clientX:t+2*(Math.random()-.5)*i,clientY:o+2*(Math.pow(Math.random(),.5)-.5)*r},c=e instanceof Element?e:document.elementFromPoint(t,o);if(c)switch(F){case"chess.com":c.dispatchEvent(new PointerEvent("pointerdown",a)),this.isLegit&&await this.delay(this.getRandomIntegerNearAverage(35,125)),c.dispatchEvent(new PointerEvent("pointerup",a));break;case"lichess.org":case"worldchess.com":c.dispatchEvent(new MouseEvent("mousedown",a)),this.isLegit&&await this.delay(this.getRandomIntegerNearAverage(35,125)),c.dispatchEvent(new MouseEvent("mouseup",a))}}click(e){this.active&&this.triggerPieceClick(e)}async hesitate(){const e=p(this.fenMoveArr[0],L());if(e&&(this.hesitationTypeOne&&(this.click(this.moveDomCoords[0]),await this.delay(this.hesitationDelay)),this.click(e),await this.delay(this.hesitationResolveDelay),this.shouldHesitateTwice&&-1!==this.secondHesitationResolveDelay)){const e=p(this.fenMoveArr[0],L());this.click(e),await this.delay(this.secondHesitationResolveDelay)}this.finishMove(this.toSquareSelectDelay,this.promotionDelay)}async finishMove(e,t){this.click(this.moveDomCoords[0]),await this.delay(e),this.click(this.moveDomCoords[1]),this.isPromotion&&(this.isPromotingPawn=!0,await this.delay(t),this.click(this.moveDomCoords[1]),this.isPromotingPawn=!1),this.onFinished(!0)}async playLegit(){await this.delay(this.moveDelay),this.shouldHesitate&&-1!==this.hesitationDelay?this.hesitate():this.finishMove(this.toSquareSelectDelay,this.promotionDelay)}async start(){this.isLegit?this.playLegit():this.finishMove(5,1111)}async stop(){this.isPromotingPawn&&this.click(this.moveDomCoords[1]),this.onFinished(!1)}}v("chess.com",{boardElem:e=>{const t=e.pathname;return t?.includes("/variants")?document.querySelector(".TheBoard-layers"):document.querySelector("#board-layout-chessboard > .board")},pieceElem:e=>{const t=e.pathname,o=e.getAll;if(t?.includes("/variants")){const e=r(document.querySelectorAll(".TheBoard-layers *[data-piece]")).filter(e=>"x"!==e?.dataset?.piece?.toLowerCase());return o?e:e[0]}return e.boardQuerySelector(".piece")},squareElems:e=>{const t=e.pathname,o=e.element;if(t?.includes("/variants"))return[...o.querySelectorAll(".square")]},chessVariant:e=>{const t=e.pathname;if(t?.includes("/variants")){const e=t.match(/variants\/([^\/]*)/)?.[1].replaceAll("-chess","").replaceAll("-","");return{"doubles-bughouse":"bughouse","paradigm-chess30":"paradigm"}[e]||e}},boardOrientation:e=>{const t=e.pathname;if(t?.includes("/variants")){const e=document.querySelector(".playerbox-bottom [data-player]")?.dataset?.player;return e?"0"===e?"w":"b":"w"}const o=M();return o?.classList.contains("flipped")?"b":"w"},pieceElemFen:e=>{const t=e.pathname,o=e.pieceElem;let n=null,s=null;if(t?.includes("/variants"))K||function(){let e=[];document.querySelectorAll("*[data-color]").forEach(t=>{const o=Number(t?.dataset?.color);e?.includes(o)||e.push(o)}),e?.length>1&&(e=e.sort((e,t)=>e-t),K={[e[0]]:"w",[e[1]]:"b"})}(),n=K?.[o?.dataset?.color],s=o?.dataset?.piece,s?.length>1&&(s=s[0]);else{const e=[...o.classList].find(e=>e.match(/^(b|w)[prnbqk]{1}$/));[n,s]=e.split("")}return"w"==n?s.toUpperCase():s.toLowerCase()},pieceElemCoords:e=>{const t=e.pathname,o=e.pieceElem;return t?.includes("/variants")?c(o):o.classList.toString()?.match(/square-(\d)(\d)/)?.slice(1)?.map(e=>Number(e)-1)},boardDimensions:e=>{const t=e.pathname;if(t?.includes("/variants")){const e=document.querySelector(".TheBoard-squares");let t=0,o=0;return[...e.childNodes].forEach(e=>{const n=r([...e.childNodes]);n?.length>0&&(t+=1,n.length>o&&(o=n.length))}),[t,o]}return[8,8]},isMutationNewMove:e=>{const t=e.pathname,o=e.mutationArr;if(t?.includes("/variants"))return!!o.find(e=>"childList"===e.type);if(1==o.length)return!1;const n=!!o.find(e=>e?.target?.classList?.contains("hover-square")),s=!!o.find(e=>e?.target?.classList?.contains("highlight")),i=!!o.find(e=>e?.target?.classList?.contains("element-pool")),r=!!o.filter(e=>e?.target?.classList?.contains("highlight")).map(e=>e?.target?.style?.["background-color"]).find(e=>"rgb(244, 42, 50)"===e);return(o.length>=4&&!n||o.length>=7||s||i)&&!r}}),v("lichess.org",{boardElem:()=>document.querySelector("cg-board"),pieceElem:e=>e.boardQuerySelector("piece:not(.ghost)"),chessVariant:()=>{const e=document.querySelector(".variant-link");if(e){let t=e?.innerText?.toLowerCase()?.replaceAll(" ","-");return{correspondence:"chess",koth:"kingofthehill","three-check":"3check"}[t]||t}},boardOrientation:()=>{const e=document.querySelector("coords.files");return e?.classList?.contains("black")?"b":"w"},pieceElemFen:e=>{const t=e.pieceElem,o=t?.classList?.contains("white")?"w":"b",n=[...t?.classList]?.find(e=>Object.keys(de).includes(e));if(o&&n){const e=de[n];return"w"==o?e.toUpperCase():e.toLowerCase()}},pieceElemCoords:e=>{const t=e.pieceElem,o=t?.cgKey;if(o)return u(o)},boardDimensions:()=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!!(t.length>=4||t.find(e=>"childList"===e.type))||!!t.find(e=>e?.target?.classList?.contains("last-move"))}}),v("playstrategy.org",{boardElem:()=>document.querySelector("cg-board"),pieceElem:e=>e.boardQuerySelector('piece[class*="-piece"]:not(.ghost)'),chessVariant:()=>{const e=document.querySelector(".variant-link");if(e){let t=e?.innerText?.toLowerCase()?.replaceAll(" ","-");return{correspondence:"chess",koth:"kingofthehill","three-check":"3check","five-check":"5check","no-castling":"nocastle"}[t]||t}},boardOrientation:()=>{const e=document.querySelector(".cg-wrap");return e.classList?.contains("orientation-p1")?"w":"b"},pieceElemFen:e=>{const t=e.pieceElem,o=w(),n=t?.classList?.contains("ally")?o:"w"==o?"b":"w";let s=null;if([...t?.classList]?.forEach(e=>{if(e?.includes("-piece")){const t=e?.split("-piece")?.[0];t&&1===t?.length&&(s=t)}}),n&&s)return"w"==n?s.toUpperCase():s.toLowerCase()},pieceElemCoords:e=>{const t=e.pieceElem,o=t?.cgKey;if(o)return u(o)},boardDimensions:()=>d(),isMutationNewMove:e=>{const t=e.mutationArr;return!!(t.length>=4||t.find(e=>"childList"===e.type))||!!t.find(e=>e?.target?.classList?.contains("last-move"))}}),v("pychess.org",{boardElem:()=>document.querySelector("cg-board"),pieceElem:e=>e.boardQuerySelector('piece[class*="-piece"]:not(.ghost)'),chessVariant:()=>{const e=document.querySelector("#main-wrap .tc .user-link");if(e){let t=e?.innerText?.toLowerCase()?.replaceAll(" ","")?.replaceAll("-","");return{correspondence:"chess",koth:"kingofthehill",nocastling:"nocastle","gorogoro+":"gorogoro",oukchaktrang:"cambodian"}[t]||t}},boardOrientation:()=>{const e=document.querySelector(".cg-wrap");return e.classList?.contains("orientation-black")?"b":"w"},pieceElemFen:e=>{const t=e.pieceElem,o=w(),n=t?.classList?.contains("ally")?o:"w"==o?"b":"w";let s=null;if([...t?.classList]?.forEach(e=>{if(e?.includes("-piece")){const t=e?.split("-piece")?.[0];t&&1===t?.length&&(s=t)}}),n&&s)return"w"==n?s.toUpperCase():s.toLowerCase()},pieceElemCoords:e=>{const t=e.pieceElem,o=t?.cgKey;if(o)return u(o)},boardDimensions:()=>d(),isMutationNewMove:e=>{const t=e.mutationArr;return!!(t.length>=4||t.find(e=>"childList"===e.type))||!!t.find(e=>e?.target?.classList?.contains("last-move"))}}),v("chess.org",{boardElem:()=>document.querySelector(".cg-board"),pieceElem:e=>e.boardQuerySelector("piece:not(.ghost)"),chessVariant:()=>"chess",boardOrientation:()=>{const e=document.querySelector("coords.files");return e?.classList?.contains("black")?"b":"w"},pieceElemFen:e=>{const t=e.pieceElem,o=t?.classList?.contains("white")?"w":"b",n=[...t?.classList]?.find(e=>Object.keys(de).includes(e));if(o&&n){const e=de[n];return"w"==o?e.toUpperCase():e.toLowerCase()}},pieceElemCoords:e=>c(e.pieceElem),boardDimensions:()=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!(ae||!(t.length>=4||t.find(e=>"childList"===e.type))&&!t.find(e=>e?.target?.classList?.contains("last-move")))}}),v("chess.coolmathgames.com",{boardElem:()=>document.querySelector("cg-board"),pieceElem:e=>e.boardQuerySelector("piece:not(.ghost)"),chessVariant:()=>"chess",boardOrientation:()=>(M(),document.querySelector(".ranks.black")?"b":"w"),pieceElemFen:e=>{const t=e.pieceElem,o=t?.classList?.contains("white")?"w":"b",n=[...t?.classList]?.find(e=>Object.keys(de).includes(e));if(o&&n){const e=de[n];return"w"==o?e.toUpperCase():e.toLowerCase()}},pieceElemCoords:e=>{const t=e.pieceElem,o=t?.cgKey;if(o)return u(o)},boardDimensions:()=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!(ae||!(t.length>=4||t.find(e=>"childList"===e.type))&&!t.find(e=>e?.target?.classList?.contains("last-move")))}}),v("papergames.io",{boardElem:()=>document.querySelector(".cm-chessboard"),pieceElem:e=>e.boardQuerySelector("*[data-piece][data-square]"),chessVariant:()=>"chess",boardOrientation:()=>{const e=M();if(e){const t=[...e.querySelector(".coordinates").childNodes]?.[0].textContent;return"h"==t?"b":"w"}},pieceElemFen:e=>{const t=e.pieceElem;return function(e){if(!e||2!==e.length)return null;const t=e[0].toLowerCase(),o=e[1];return"w"===t?o.toUpperCase():"b"===t?o.toLowerCase():null}(t?.dataset?.piece)},pieceElemCoords:e=>{const t=e.pieceElem,o=t?.dataset?.square;if(o)return u(o)},boardDimensions:()=>[8,8],isMutationNewMove:e=>e.mutationArr.length>=12}),v("vole.wtf",{boardElem:()=>document.querySelector("#board"),pieceElem:e=>e.boardQuerySelector('*[data-t][data-l][data-p]:not([data-p="0"]'),chessVariant:()=>"chess",boardOrientation:()=>"w",pieceElemFen:e=>{const t=e.pieceElem,o=Number(t?.dataset?.p),n="pknbrq";return o>8?n[o-9].toUpperCase():n[o-1]},pieceElemCoords:e=>{const t=e.pieceElem;return[Number(t?.dataset?.l),7-Number(t?.dataset?.t)]},boardDimensions:()=>[8,8],isMutationNewMove:e=>e.mutationArr.length>=12}),v("immortal.game",{boardElem:()=>document.querySelector("div.pawn.relative, div.knight.relative, div.bishop.relative, div.rook.relative, div.queen.relative, div.king.relative")?.parentElement?.parentElement,pieceElem:e=>e.boardQuerySelector("div.pawn.relative, div.knight.relative, div.bishop.relative, div.rook.relative, div.queen.relative, div.king.relative"),chessVariant:()=>"chess",boardOrientation:()=>{const e=[...document.querySelectorAll("svg text[x]")].find(e=>"a"==e?.textContent);return(Number(e?.getAttribute("x"))||10)<15?"w":"b"},pieceElemFen:e=>{const t=e.pieceElem,o=t?.classList?.contains("white")?"w":"b",n=[...t?.classList]?.find(e=>Object.keys(de).includes(e));if(o&&n){const e=de[n];return"w"===o?e.toUpperCase():e.toLowerCase()}},pieceElemCoords:e=>{const t=e.pieceElem;return c(t?.parentElement)},boardDimensions:()=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!ae&&t.length>=5}}),v("worldchess.com",{boardElem:()=>document.querySelector('*[data-component="GameLayoutBoard"] cg-board'),pieceElem:e=>e.boardQuerySelector('cg-piece:not(*[style*="visibility: hidden;"])'),chessVariant:()=>"chess",boardOrientation:()=>{const e=document.querySelector("cg-titles");return e?.classList?.contains("rotated")?"b":"w"},pieceElemFen:e=>{const t=e.pieceElem,o=t?.className?.[0],n=t?.className?.[1];if(o&&n){const e=n;return"w"===o?e.toUpperCase():e.toLowerCase()}},pieceElemCoords:e=>c(e.pieceElem,{onlyFlipY:!0}),boardDimensions:()=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!ae&&!!t.find(e=>"style"===e?.attributeName)}}),v("chess.net",{boardElem:()=>document.querySelector("cg-board"),pieceElem:e=>e.boardQuerySelector("piece:not(.ghost)"),chessVariant:()=>{const e=document.querySelector(".variant-link");if(e){let t=e?.innerText?.toLowerCase()?.replaceAll(" ","-");return{correspondence:"chess",koth:"kingofthehill","three-check":"3check"}[t]||t}},boardOrientation:()=>{const e=document.querySelector("coords.files");return e?.classList?.contains("black")?"b":"w"},pieceElemFen:e=>{const t=e.pieceElem,o=t?.classList?.contains("white")?"w":"b",n=[...t?.classList]?.find(e=>Object.keys(de).includes(e));if(o&&n){const e=de[n];return"w"==o?e.toUpperCase():e.toLowerCase()}},pieceElemCoords:e=>{const t=e.pieceElem,o=t?.cgKey;if(o)return u(o)},boardDimensions:()=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!!(t.length>=4||t.find(e=>"childList"===e.type))||!!t.find(e=>e?.target?.classList?.contains("last-move"))}}),v("freechess.club",{boardElem:()=>document.querySelector("cg-board"),pieceElem:e=>e.boardQuerySelector("piece:not(.ghost)"),chessVariant:()=>"chess",boardOrientation:()=>{const e=document.querySelector("coords.files");return e?.classList?.contains("black")?"b":"w"},pieceElemFen:e=>{const t=e.pieceElem,o=t?.classList?.contains("white")?"w":"b",n=[...t?.classList]?.find(e=>Object.keys(de).includes(e));if(o&&n){const e=de[n];return"w"==o?e.toUpperCase():e.toLowerCase()}},pieceElemCoords:e=>{const t=e.pieceElem,o=t?.cgKey;if(o)return u(o)},boardDimensions:()=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!!(t.length>=4||t.find(e=>"childList"===e.type))||!!t.find(e=>e?.target?.classList?.contains("last-move"))}}),v("play.chessclub.com",{boardElem:()=>document.querySelector("cg-board"),pieceElem:e=>e.boardQuerySelector("piece:not(.ghost)"),chessVariant:()=>"chess",boardOrientation:()=>{const e=document.querySelector("coords.files");return e?.classList?.contains("black")?"b":"w"},pieceElemFen:e=>{const t=e.pieceElem,o=t?.classList?.contains("white")?"w":"b",n=[...t?.classList]?.find(e=>Object.keys(de).includes(e));if(o&&n){const e=de[n];return"w"==o?e.toUpperCase():e.toLowerCase()}},pieceElemCoords:e=>{const t=e.pieceElem,o=t?.cgKey;if(o)return u(o)},boardDimensions:()=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!!(t.length>=4||t.find(e=>"childList"===e.type))||!!t.find(e=>e?.target?.classList?.contains("last-move"))}}),v("gameknot.com",{boardElem:()=>document.querySelector("#chess-board-acboard"),pieceElem:e=>e.boardQuerySelector('*[class*="chess-board-piece"] > img[src*="chess56."][style*="visible"]'),chessVariant:()=>"chess",boardOrientation:()=>document.querySelector("#chess-board-my-side-color .player_white")?"w":"b",pieceElemFen:e=>{const t=e.pieceElem,o=Number(t.style.left.replace("px","")),n="kqrnbp"[-1*Number(t.style.top.replace("px",""))/60];return"w"==(o>=0?"w":"b")?n.toUpperCase():n.toLowerCase()},pieceElemCoords:e=>l(e.pieceElem.parentElement),boardDimensions:()=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!!t.find(e=>"childList"===e.type)||!!t.find(e=>e?.target?.classList?.contains("last-move"))}}),v("chesstempo.com",{boardElem:()=>document.querySelector(".ct-board-squares"),pieceElem:e=>e.boardQuerySelector('*[class*="ct-pieceClass"][class*="ct-piece-"]'),chessVariant:()=>"chess",boardOrientation:()=>"a"===document.querySelector(".ct-coord-column").innerText?"w":"b",pieceElemFen:e=>{const t=[...e.pieceElem.classList].find(e=>e?.includes("ct-piece-")),o=t?.split("ct-piece-")?.pop(),n=o.startsWith("white")?"w":"b",s=o.substring(5),i=de[s];return"w"===n?i.toUpperCase():i.toLowerCase()},pieceElemCoords:e=>{const t=e.pieceElem;return[t?.ct?.piece?.piece?.column,t?.ct?.piece?.piece?.row]},boardDimensions:()=>[8,8],isMutationNewMove:e=>e.mutationArr.length>=4}),v("redhotpawn.com",{boardElem:()=>document.querySelector("#board-0_1"),pieceElem:e=>e.boardQuerySelector('li.piece[id*="-pc-"]'),chessVariant:()=>"chess",boardOrientation:()=>Number([...document.querySelectorAll(".boardCoordinate")].find(e=>"a"===e?.innerText)?.style?.left?.replace("px",""))<200?"w":"b",pieceElemFen:e=>{const t=e.pieceElem;return(t?.id?.match(/-pc-(.*?)-/)||[])[1]},pieceElemCoords:e=>l(e.pieceElem),boardDimensions:()=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!ae&&t.length>=4}}),v("simplechess.com",{boardElem:()=>document.querySelector("#chessboard"),pieceElem:e=>{const t=e.getAll,o=[...document.querySelectorAll("canvas.canvas_piece")].filter(e=>y(e,[.5,.5]));return t?o:o[0]},chessVariant:()=>"chess",boardOrientation:()=>"8"===document.querySelector("#chessboard_coordy0")?.innerText?"w":"b",pieceElemFen:e=>{const t=e.pieceElem,o=[{name:"k",coords:[52/60,26/60]},{name:"q",coords:[8/60,16/60]},{name:"n",coords:[.85,.7]},{name:"b",coords:[.15,50/60]},{name:"r",coords:[.75,.25]},{name:"p",coords:[.5,.5]}];let n=null;for(e of o)if(y(t,e.coords)){n=e.name;break}if(n)return"w"===function(e,[t,o],n){const s=e.getContext("2d"),i=t*e.width,r=o*e.height,a=s.getImageData(i,r,1,1).data,c=(a[0]+a[1]+a[2])/3;if(n){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const o=t.getContext("2d");o.drawImage(e,0,0),o.fillStyle="red",o.beginPath(),o.arc(i,r,1,0,2*Math.PI),o.fill();const n=t.toDataURL();console.log(e,a,n)}return c<128?"b":"w"}(t,{k:[.7,.45],q:[.5,50/60],n:[38/60,41/60],b:[.5,20/60]}[n]||[.5,.5])?n.toUpperCase():n.toLowerCase()},pieceElemCoords:e=>l(e.pieceElem),boardDimensions:()=>[8,8],isMutationNewMove:e=>{const t=e.mutationArr;return!ae&&t.length>=7}}),v("chessworld.net",{boardElem:()=>document.querySelector("#ChessWorldChessBoard"),pieceElem:e=>e.boardQuerySelector('img[src*="merida"'),chessVariant:()=>"chess",boardOrientation:()=>document.querySelector('div[style*="boardb.jpg"]')?"w":"b",pieceElemFen:e=>{const t=e.pieceElem,[o,n]=t?.src?.split("/")?.pop()?.replace(".png","")?.split("_"),s=de[n];return"w"==("white"===o?"w":"b")?s.toUpperCase():s.toLowerCase()},pieceElemCoords:e=>{const t=e.pieceElem;return u(t?.id)},boardDimensions:()=>[8,8],isMutationNewMove:e=>e.mutationArr.length>=2}),v("app.edchess.io",{boardElem:()=>document.querySelector('*[data-boardid="chessboard"]'),pieceElem:e=>e.boardQuerySelector("*[data-piece]"),chessVariant:()=>"chess",boardOrientation:()=>"h1"==document.querySelector("*[data-square]")?.dataset?.square?"b":"w",pieceElemFen:e=>{const t=e.pieceElem,[o,n]=t?.dataset?.piece?.split("");return"w"===o?n.toUpperCase():n.toLowerCase()},pieceElemCoords:e=>{const t=e.pieceElem;return u(t?.parentElement?.parentElement?.dataset?.square)},boardDimensions:()=>[8,8],isMutationNewMove:e=>e.mutationArr.length>=2}),"function"==typeof GM_registerMenuCommand&&(GM_registerMenuCommand("[u] Open GreasyFork Page",()=>{GM_openInTab("https://greasyfork.org/en/scripts/459137",!0)},"u"),GM_registerMenuCommand("[o] Open GUI Manually",()=>{GM_openInTab(t(),!0)},"o"),GM_registerMenuCommand("[s] Start Manually",()=>{W?x():i("Failed to start manually","No chessboard element found!")},"s"),GM_registerMenuCommand("[g] Get Moves Manually",()=>{W?q(0,!0):i("Failed to get moves","No chessboard element found!")},"g"),GM_registerMenuCommand("[r] Render BoardDrawer Manually",()=>{"function"==typeof Q?.updateDimensions?Q.updateDimensions():i("Failed to render BoardDrawer","BoardDrawer not initialized or something else went wrong!")},"r"),"function"==typeof GM_setClipboard&&GM_registerMenuCommand("[c] Copy FEN to Clipboard",()=>{W?GM_setClipboard(A()):i("Failed to get FEN","No chessboard element found!")},"c")),setInterval(function(){const e=M(),o=E(),n=e&&o,s="chess.com"===F&&e?.className.includes("webgl-2d");(n||s)&&W!=e&&(W=e,W.addEventListener("mousedown",()=>{ae=!0}),W.addEventListener("mouseup",()=>{ae=!1}),W.addEventListener("touchstart",()=>{ae=!0}),W.addEventListener("touchend",()=>{ae=!1}),j.includes(window.location.href)||function(){let e=0;const o=ue.setIntervalAsync(async()=>{await async function(){return!!await ue.commands.ping()}()?(x(),o.stop()):e<1&&(e++,GM_openInTab(t(),!0))},1e3)}())},1e3)})();