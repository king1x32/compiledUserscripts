// ==UserScript==
// @name                     GoogleGPT ðŸ¤–
// @author                   KudoAI
// @namespace                https://kudoai.com
// @version                  2025.11.5
// @license                  MIT
// @icon                     data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%22170.667%22%20height=%22170.667%22%3E%3Cstyle%3E:root%7B--fill:%23000%7D@media%20(prefers-color-scheme:dark)%7B:root%7B--fill:%23fff%7D%7D%3C/style%3E%3Cpath%20fill=%22var(--fill)%22%20d=%22M82.346%20159.79c-18.113-1.815-31.78-9.013-45.921-24.184C23.197%20121.416%2017.333%20106.18%2017.333%2086c0-21.982%205.984-36.245%2021.87-52.131C55.33%2017.74%2069.27%2011.867%2091.416%2011.867c17.574%200%2029.679%203.924%2044.309%2014.363l8.57%206.116-8.705%208.705-8.704%208.704-4.288-3.608c-13.91-11.704-35.932-14.167-53.085-5.939-3.4%201.631-9.833%206.601-14.297%2011.045C44.669%2061.753%2040.95%2070.811%2040.95%2086c0%2014.342%203.594%2023.555%2013.26%2033.995%2019.088%2020.618%2048.46%2022.539%2070.457%204.608l5.333-4.348%2011.333%203.844c6.234%202.114%2011.54%203.857%2011.791%203.873.252.015-2.037%203.008-5.087%206.65-6.343%207.577-20.148%2017.217-30.493%2021.295-8.764%203.454-23.358%205.06-35.198%203.873zM92%2086.333V74.667h60.648l-11.41%2011.41-11.411%2011.41-18.914.257L92%2098z%22/%3E%3C/svg%3E
// @icon64                   data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%22170.667%22%20height=%22170.667%22%3E%3Cstyle%3E:root%7B--fill:%23000%7D@media%20(prefers-color-scheme:dark)%7B:root%7B--fill:%23fff%7D%7D%3C/style%3E%3Cpath%20fill=%22var(--fill)%22%20d=%22M82.346%20159.79c-18.113-1.815-31.78-9.013-45.921-24.184C23.197%20121.416%2017.333%20106.18%2017.333%2086c0-21.982%205.984-36.245%2021.87-52.131C55.33%2017.74%2069.27%2011.867%2091.416%2011.867c17.574%200%2029.679%203.924%2044.309%2014.363l8.57%206.116-8.705%208.705-8.704%208.704-4.288-3.608c-13.91-11.704-35.932-14.167-53.085-5.939-3.4%201.631-9.833%206.601-14.297%2011.045C44.669%2061.753%2040.95%2070.811%2040.95%2086c0%2014.342%203.594%2023.555%2013.26%2033.995%2019.088%2020.618%2048.46%2022.539%2070.457%204.608l5.333-4.348%2011.333%203.844c6.234%202.114%2011.54%203.857%2011.791%203.873.252.015-2.037%203.008-5.087%206.65-6.343%207.577-20.148%2017.217-30.493%2021.295-8.764%203.454-23.358%205.06-35.198%203.873zM92%2086.333V74.667h60.648l-11.41%2011.41-11.411%2011.41-18.914.257L92%2098z%22/%3E%3C/svg%3E
// @compatible               brave
// @compatible               chrome
// @compatible               chromebeta
// @compatible               chromecanary
// @compatible               chromedev
// @compatible               edge
// @compatible               edgebeta
// @compatible               edgecanary
// @compatible               edgedev
// @compatible               fennec
// @compatible               firefox
// @compatible               firefoxbeta
// @compatible               firefoxnightly
// @compatible               ghost
// @compatible               iceraven
// @compatible               ironfox
// @compatible               lemur
// @compatible               librewolf
// @compatible               mises
// @compatible               opera after allowing userscript manager access to search page results in opera://extensions
// @compatible               operaair after allowing userscript manager access to search page results in opera://extensions
// @compatible               operagx after allowing userscript manager access to search page results in opera://extensions
// @compatible               qq
// @compatible               quetta
// @compatible               safari
// @compatible               orion
// @compatible               vivaldi
// @compatible               waterfox
// @compatible               whale
// @match                    *://*.google.com/search*
// @match                    *://*.google.ad/search*
// @match                    *://*.google.ae/search*
// @match                    *://*.google.com.af/search*
// @match                    *://*.google.com.ag/search*
// @match                    *://*.google.com.ai/search*
// @match                    *://*.google.al/search*
// @match                    *://*.google.am/search*
// @match                    *://*.google.co.ao/search*
// @match                    *://*.google.com.ar/search*
// @match                    *://*.google.as/search*
// @match                    *://*.google.at/search*
// @match                    *://*.google.com.au/search*
// @match                    *://*.google.az/search*
// @match                    *://*.google.ba/search*
// @match                    *://*.google.com.bd/search*
// @match                    *://*.google.be/search*
// @match                    *://*.google.bf/search*
// @match                    *://*.google.bg/search*
// @match                    *://*.google.com.bh/search*
// @match                    *://*.google.bi/search*
// @match                    *://*.google.bj/search*
// @match                    *://*.google.com.bn/search*
// @match                    *://*.google.com.bo/search*
// @match                    *://*.google.com.br/search*
// @match                    *://*.google.bs/search*
// @match                    *://*.google.bt/search*
// @match                    *://*.google.co.bw/search*
// @match                    *://*.google.by/search*
// @match                    *://*.google.com.bz/search*
// @match                    *://*.google.ca/search*
// @match                    *://*.google.cd/search*
// @match                    *://*.google.cf/search*
// @match                    *://*.google.cg/search*
// @match                    *://*.google.ch/search*
// @match                    *://*.google.ci/search*
// @match                    *://*.google.co.ck/search*
// @match                    *://*.google.cl/search*
// @match                    *://*.google.cm/search*
// @match                    *://*.google.cn/search*
// @match                    *://*.google.com.co/search*
// @match                    *://*.google.co.cr/search*
// @match                    *://*.google.com.cu/search*
// @match                    *://*.google.cv/search*
// @match                    *://*.google.com.cy/search*
// @match                    *://*.google.cz/search*
// @match                    *://*.google.de/search*
// @match                    *://*.google.dj/search*
// @match                    *://*.google.dk/search*
// @match                    *://*.google.dm/search*
// @match                    *://*.google.com.do/search*
// @match                    *://*.google.dz/search*
// @match                    *://*.google.com.ec/search*
// @match                    *://*.google.ee/search*
// @match                    *://*.google.com.eg/search*
// @match                    *://*.google.es/search*
// @match                    *://*.google.com.et/search*
// @match                    *://*.google.fi/search*
// @match                    *://*.google.com.fj/search*
// @match                    *://*.google.fm/search*
// @match                    *://*.google.fr/search*
// @match                    *://*.google.ga/search*
// @match                    *://*.google.ge/search*
// @match                    *://*.google.gg/search*
// @match                    *://*.google.com.gh/search*
// @match                    *://*.google.com.gi/search*
// @match                    *://*.google.gl/search*
// @match                    *://*.google.gm/search*
// @match                    *://*.google.gr/search*
// @match                    *://*.google.com.gt/search*
// @match                    *://*.google.gy/search*
// @match                    *://*.google.com.hk/search*
// @match                    *://*.google.hn/search*
// @match                    *://*.google.hr/search*
// @match                    *://*.google.ht/search*
// @match                    *://*.google.hu/search*
// @match                    *://*.google.co.id/search*
// @match                    *://*.google.ie/search*
// @match                    *://*.google.co.il/search*
// @match                    *://*.google.im/search*
// @match                    *://*.google.co.in/search*
// @match                    *://*.google.iq/search*
// @match                    *://*.google.is/search*
// @match                    *://*.google.it/search*
// @match                    *://*.google.je/search*
// @match                    *://*.google.com.jm/search*
// @match                    *://*.google.jo/search*
// @match                    *://*.google.co.jp/search*
// @match                    *://*.google.co.ke/search*
// @match                    *://*.google.com.kh/search*
// @match                    *://*.google.ki/search*
// @match                    *://*.google.kg/search*
// @match                    *://*.google.co.kr/search*
// @match                    *://*.google.com.kw/search*
// @match                    *://*.google.kz/search*
// @match                    *://*.google.la/search*
// @match                    *://*.google.com.lb/search*
// @match                    *://*.google.li/search*
// @match                    *://*.google.lk/search*
// @match                    *://*.google.co.ls/search*
// @match                    *://*.google.lt/search*
// @match                    *://*.google.lu/search*
// @match                    *://*.google.lv/search*
// @match                    *://*.google.com.ly/search*
// @match                    *://*.google.co.ma/search*
// @match                    *://*.google.md/search*
// @match                    *://*.google.me/search*
// @match                    *://*.google.mg/search*
// @match                    *://*.google.mk/search*
// @match                    *://*.google.ml/search*
// @match                    *://*.google.com.mm/search*
// @match                    *://*.google.mn/search*
// @match                    *://*.google.ms/search*
// @match                    *://*.google.com.mt/search*
// @match                    *://*.google.mu/search*
// @match                    *://*.google.mv/search*
// @match                    *://*.google.mw/search*
// @match                    *://*.google.com.mx/search*
// @match                    *://*.google.com.my/search*
// @match                    *://*.google.co.mz/search*
// @match                    *://*.google.com.na/search*
// @match                    *://*.google.com.ng/search*
// @match                    *://*.google.com.ni/search*
// @match                    *://*.google.ne/search*
// @match                    *://*.google.nl/search*
// @match                    *://*.google.no/search*
// @match                    *://*.google.com.np/search*
// @match                    *://*.google.nr/search*
// @match                    *://*.google.nu/search*
// @match                    *://*.google.co.nz/search*
// @match                    *://*.google.com.om/search*
// @match                    *://*.google.com.pa/search*
// @match                    *://*.google.com.pe/search*
// @match                    *://*.google.com.pg/search*
// @match                    *://*.google.com.ph/search*
// @match                    *://*.google.com.pk/search*
// @match                    *://*.google.pl/search*
// @match                    *://*.google.pn/search*
// @match                    *://*.google.com.pr/search*
// @match                    *://*.google.ps/search*
// @match                    *://*.google.pt/search*
// @match                    *://*.google.com.py/search*
// @match                    *://*.google.com.qa/search*
// @match                    *://*.google.ro/search*
// @match                    *://*.google.ru/search*
// @match                    *://*.google.rw/search*
// @match                    *://*.google.com.sa/search*
// @match                    *://*.google.com.sb/search*
// @match                    *://*.google.sc/search*
// @match                    *://*.google.se/search*
// @match                    *://*.google.com.sg/search*
// @match                    *://*.google.sh/search*
// @match                    *://*.google.si/search*
// @match                    *://*.google.sk/search*
// @match                    *://*.google.com.sl/search*
// @match                    *://*.google.sn/search*
// @match                    *://*.google.so/search*
// @match                    *://*.google.sm/search*
// @match                    *://*.google.sr/search*
// @match                    *://*.google.st/search*
// @match                    *://*.google.com.sv/search*
// @match                    *://*.google.td/search*
// @match                    *://*.google.tg/search*
// @match                    *://*.google.co.th/search*
// @match                    *://*.google.com.tj/search*
// @match                    *://*.google.tl/search*
// @match                    *://*.google.tm/search*
// @match                    *://*.google.tn/search*
// @match                    *://*.google.to/search*
// @match                    *://*.google.com.tr/search*
// @match                    *://*.google.tt/search*
// @match                    *://*.google.com.tw/search*
// @match                    *://*.google.co.tz/search*
// @match                    *://*.google.com.ua/search*
// @match                    *://*.google.co.ug/search*
// @match                    *://*.google.co.uk/search*
// @match                    *://*.google.com.uy/search*
// @match                    *://*.google.co.uz/search*
// @match                    *://*.google.com.vc/search*
// @match                    *://*.google.co.ve/search*
// @match                    *://*.google.vg/search*
// @match                    *://*.google.co.vi/search*
// @match                    *://*.google.com.vn/search*
// @match                    *://*.google.vu/search*
// @match                    *://*.google.ws/search*
// @match                    *://*.google.rs/search*
// @match                    *://*.google.co.za/search*
// @match                    *://*.google.co.zm/search*
// @match                    *://*.google.co.zw/search*
// @match                    *://*.google.cat/search*
// @include                  https://auth0.openai.com
// @connect                  api.binjie.fun
// @connect                  api.openai.com
// @connect                  api11.gptforlove.com
// @connect                  cdn.jsdelivr.net
// @connect                  chat-share.kudoai.workers.dev
// @connect                  chatai.mixerbox.com
// @connect                  chatgpt.com
// @connect                  fanyi.sogou.com
// @connect                  googlegpt.io
// @connect                  raw.githubusercontent.com
// @require                  https://cdn.jsdelivr.net/npm/@kudoai/chatgpt.js@3.8.4/dist/chatgpt.min.js#sha256-tYhvHliPyfsEyE9hTEyGudofjnp2Hpz/iWOllkm9o4w=
// @require                  https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js#sha256-dppVXeVTurw1ozOPNE3XqhYmDJPOosfbKQcHyQSE58w=
// @require                  https://cdn.jsdelivr.net/npm/json5@2.2.3/dist/index.min.js#sha256-S7ltnVPzgKyAGBlBG4wQhorJqYTehj5WQCrADCKJufE=
// @require                  https://cdn.jsdelivr.net/gh/adamlui/ai-web-extensions@cc60313/assets/js/components/chatbot/buttons.js#sha256-SKlhJO503awp8matfnXaUyhN638Isl6wf0MJXKFEY/w=
// @require                  https://cdn.jsdelivr.net/gh/adamlui/ai-web-extensions@2255fee/assets/js/components/chatbot/icons.js#sha256-nAcuQD4FVFzUN1pS6pOjw2V3IvkDwYV+P3m5IN8nsdo=
// @require                  https://cdn.jsdelivr.net/gh/adamlui/ai-web-extensions@3230687/assets/js/components/chatbot/menus.js#sha256-1Nk1i+914uf/6PJTXk/0MdpnnYsOhREIpIokhEt8JJU=
// @require                  https://cdn.jsdelivr.net/gh/adamlui/ai-web-extensions@485996c/assets/js/components/chatbot/replyBubble.js#sha256-/F0kipD9jDAtlnlfL4Q3cbboS5bPx9ierlnRU897eqQ=
// @require                  https://cdn.jsdelivr.net/gh/adamlui/ai-web-extensions@81bd554/assets/js/components/chatbot/tooltip.js#sha256-XA9qhdh8zyjofZbbwvbsh5oPxyHK2nS/cJONI+Tfuts=
// @require                  https://cdn.jsdelivr.net/gh/adamlui/ai-web-extensions@58d6a4b/assets/js/lib/chatbot/api.js#sha256-UyfKgAjMDNy7BAToonBPi+eXah8Th/j7Nq5n/IPPzBI=
// @require                  https://cdn.jsdelivr.net/gh/adamlui/ai-web-extensions@8112473/assets/js/lib/chatbot/feedback.js#sha256-ri8OzNa/8sQINDn7bW84F2OuVYZxubMSm/Zpli/cPnQ=
// @require                  https://cdn.jsdelivr.net/gh/adamlui/ai-web-extensions@f4da9d4/assets/js/lib/chatbot/log.js#sha256-kjt26UXbx44I0/iDOf50F/LbRtsYcSwMHrexImR4D5A=
// @require                  https://cdn.jsdelivr.net/gh/adamlui/ai-web-extensions@1905225/assets/js/lib/chatbot/prompts.js#sha256-knOM9aAD5WcFCF5CvjMRFKfhdDC01vGVyrC6+cpXwLg=
// @require                  https://cdn.jsdelivr.net/gh/adamlui/ai-web-extensions@4565425/assets/js/lib/chatbot/session.js#sha256-cH2e3l2bZQRekQHxaeSShdNguqD41evEOkMrrVIydHQ=
// @require                  https://cdn.jsdelivr.net/gh/adamlui/ai-web-extensions@1861401/assets/js/lib/chatbot/themes.js#sha256-ujpN5pwFdqQjF4UCsu7Pgge1aHbl6jNmbmcvw3AwoVM=
// @require                  https://cdn.jsdelivr.net/gh/adamlui/ai-web-extensions@3b0bccd/assets/js/lib/chatbot/ui.js#sha256-oN097tZtsr57Do6gpjDuRTQ1iLr3HzFxWmUmICvYD3c=
// @require                  https://cdn.jsdelivr.net/gh/adamlui/ai-web-extensions@4565425/assets/js/lib/chatbot/userscript.js#sha256-DTD+Tj/9angBw8/Q4e8PMz2SBwueqvNzeY8PwZlMgbs=
// @require                  https://cdn.jsdelivr.net/gh/adamlui/ai-web-extensions@1e84c2e/assets/js/lib/dom.js/dist/dom.min.js#sha256-xovdxRnmYD/eCgBiGCu5+Vd3+WWIvLUKVtU/MnRueeU=
// @require                  https://cdn.jsdelivr.net/npm/generate-ip@2.4.5/dist/generate-ip.min.js#sha256-PI9snFGy1YvX4fiT8SJ01RveRSa6vZujEJxk8y/jvVs=
// @require                  https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js#sha256-g3pvpbDHNrUrveKythkPMF2j/J7UFoHbUyFQcFe1yEY=
// @require                  https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js#sha256-n0UwfFeU7SR6DQlfOmLlLvIhWmeyMnIDp/2RmVmuedE=
// @require                  https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js#sha256-e1fUJ6xicGd9r42DgN7SzHMzb5FJoWe44f4NbvZmBK4=
// @require                  https://cdn.jsdelivr.net/npm/marked@12.0.2/marked.min.js#sha256-Ffq85bZYmLMrA/XtJen4kacprUwNbYdxEKd0SqhHqJQ=
// @resource ggptIconBlack   https://cdn.jsdelivr.net/gh/KudoAI/googlegpt@9db3bda/assets/images/icons/googlegpt/black/icon64.png.b64#sha256-yiTqggYRNsWcJtyIUDzFrPqrL3yeTaPCrEGAW0QFuPM=
// @resource ggptIconWhite   https://cdn.jsdelivr.net/gh/KudoAI/googlegpt@9db3bda/assets/images/icons/googlegpt/white/icon64.png.b64#sha256-BYRq92cF5knykaKnmNi1U4CrwBC/jK1V+MGfH4NGui4=
// @resource ggptLSlogo      https://cdn.jsdelivr.net/gh/KudoAI/googlegpt@9db3bda/assets/images/logos/googlegpt/flat/black-green/logo480x64.png.b64#sha256-fzSZhLVQQolCLWYr/h29NWfR1Yl4glHv1TcsveYYv+U=
// @resource ggptDSlogo      https://cdn.jsdelivr.net/gh/KudoAI/googlegpt@9db3bda/assets/images/logos/googlegpt/flat/white-green/logo480x64.png.b64#sha256-3qRdGKhF3pojDqVVh/5kODIg7QvYbbLf4zFkEh5xoGc=
// @resource hljsCSS         https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/base16/railscasts.min.css#sha256-nMf0Oxaj3sYJiwGCsfqNpGnBbcofnzk+zz3xTxtdLEQ=
// @resource rpgCSS          https://cdn.jsdelivr.net/gh/adamlui/ai-web-extensions@727feff/assets/styles/rising-particles/dist/gray.min.css#sha256-48sEWzNUGUOP04ur52G5VOfGZPSnZQfrF3szUr4VaRs=
// @resource rpwCSS          https://cdn.jsdelivr.net/gh/adamlui/ai-web-extensions@727feff/assets/styles/rising-particles/dist/white.min.css#sha256-6xBXczm7yM1MZ/v0o1KVFfJGehHk47KJjq8oTktH4KE=
// @grant                    GM_getValue
// @grant                    GM_setValue
// @grant                    GM_deleteValue
// @grant                    GM_cookie
// @grant                    GM_registerMenuCommand
// @grant                    GM_unregisterMenuCommand
// @grant                    GM_getResourceText
// @grant                    GM_xmlhttpRequest
// @grant                    GM.xmlHttpRequest
// @noframes
// @downloadURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/googlegpt.user.js
// @updateURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/googlegpt.meta.js
// @homepageURL              https://www.googlegpt.io
// @supportURL               https://support.googlegpt.io
// @contributionURL          https://github.com/sponsors/KudoAI
// ==/UserScript==
(async()=>{"use strict";window.env={browser:{language:chatgpt.getUserLanguage()},scriptManager:{name:(()=>{try{return GM_info.scriptHandler}catch(e){return"unknown"}})(),version:(()=>{try{return GM_info.version}catch(e){return"unknown"}})()}},["Chromium","Firefox","Chrome","Edge","Brave","Mobile"].forEach(e=>env.browser[`is${"Firefox"==e?"FF":e}`]=chatgpt.browser["is"+e]()),Object.assign(env.browser,{get isCompact(){return innerWidth<=480}}),env.userLocale=location.hostname.endsWith(".com")?"us":location.hostname.split(".").pop(),env.scriptManager.supportsStreaming=/Tampermonkey|ScriptCat/.test(env.scriptManager.name),env.scriptManager.supportsTooltips="Tampermonkey"==env.scriptManager.name&&parseInt(env.scriptManager.version.split(".")[0])>=5,window.inputEvents={},["down","move","up"].forEach(e=>inputEvents[e]=(window.PointerEvent?"pointer":env.browser.isMobile?"touch":"mouse")+e),window.xhr="undefined"!=typeof GM&&GM.xmlHttpRequest||GM_xmlhttpRequest,window.app={version:GM_info.script.version,chatgptjsVer:/chatgpt\.js@([\d.]+)/.exec(GM_info.scriptMetaStr)[1],commitHashes:{app:"fb94f79",aiweb:"02c1241"}},app.urls={resourceHost:`https://cdn.jsdelivr.net/gh/KudoAI/googlegpt@${app.commitHashes.app}`};const e={app:await new Promise(e=>xhr({method:"GET",url:`${app.urls.resourceHost}/assets/data/app.json`,onload:({responseText:t})=>e(JSON.parse(t))})),msgs:await new Promise(e=>{function t(){xhr({method:"GET",url:s,onload:n})}function n(n){try{const t=JSON.parse(n.responseText),a={};for(const e in t)"object"==typeof t[e]&&"message"in t[e]&&(a[e]=t[e].message);e(a)}catch(n){if(i++,3==i)return e({});s=env.browser.language.includes("-")&&1==i?s.replace(/(_locales\/[^_]+)_[^_]+(\/)/,"$1$2"):`${a}en/messages.json`,t()}}const a=`${app.urls.resourceHost}/greasemonkey/_locales/`,o=`${env.browser.language?env.browser.language.replace("-","_"):"en"}/`;let s=`${a+o}messages.json`,i=0;t()})};Object.assign(app,{...e.app,urls:{...app.urls,...e.app.urls},msgs:e.msgs}),app.urls.aiwebAssets=app.urls.aiwebAssets.replace("@latest",`@${app.commitHashes.aiweb}`),app.alerts={waitingResponse:`${app.msgs.alert_waitingFor} ${app.name} ${app.msgs.alert_response}...`,login:`${app.msgs.alert_login} @ `,checkCloudflare:`${app.msgs.alert_checkCloudflare} @ `,tooManyRequests:`${app.msgs.alert_tooManyRequests}.`,parseFailed:`${app.msgs.alert_parseFailed}.`,proxyNotWorking:`${app.msgs.mode_proxy} ${app.msgs.alert_notWorking}.`,apiNotWorking:`API ${app.msgs.alert_notWorking}.`,suggestProxy:`${app.msgs.alert_try} ${app.msgs.alert_switchingOn} ${app.msgs.mode_proxy}`,suggestDiffAPI:`${app.msgs.alert_try} ${app.msgs.alert_selectingDiff} API`,suggestOpenAI:`${app.msgs.alert_try} ${app.msgs.alert_switchingOff} ${app.msgs.mode_proxy}`},app.katexDelimiters=await new Promise(e=>xhr({method:"GET",onload:({responseText:t})=>e(JSON.parse(t)),url:`${app.urls.aiwebAssets}/data/katex-delimiters.json`})),window.apis=Object.assign(Object.create(null),await new Promise(e=>xhr({method:"GET",onload:({responseText:t})=>e(Object.fromEntries(Object.entries(JSON5.parse(t)).filter(([,e])=>!e.disabled))),url:`${app.urls.aiwebAssets}/data/ai-chat-apis.json5`}))),apis.AIchatOS.userID="#/chat/"+Date.now(),window.config={},window.settings={load(...e){e.flat().forEach(e=>config[e]=function(e,t){const n=settings.controls?.[e];return null!=t&&("toggle"==n?.type&&"boolean"!=typeof t||"slider"==n?.type&&isNaN(parseFloat(t)))&&(t=void 0),t??n?.defaultVal??("slider"==n?.type&&100)}(e,GM_getValue(`${app.configKeyPrefix}_${e}`,void 0)))},save(e,t){GM_setValue(`${app.configKeyPrefix}_${e}`,t),config[e]=t},typeIsEnabled(e){const t=/disabled|hidden/i;return t.test(e)&&!t.test(this.controls[e]?.label||"")?!config[e]:config[e]}},settings.load("debugMode"),log.debug("Initializing settings..."),Object.assign(settings,{controls:{proxyAPIenabled:{type:"toggle",icon:"sunglasses",defaultVal:!1,label:app.msgs.menuLabel_proxyAPImode,helptip:app.msgs.helptip_proxyAPImode},preferredAPI:{type:"modal",icon:"lightning",defaultVal:!1,label:`${app.msgs.menuLabel_preferred} API`,helptip:app.msgs.helptip_preferredAPI},streamingDisabled:{type:"toggle",icon:"signalStream",defaultVal:!1,label:app.msgs.mode_streaming,helptip:app.msgs.helptip_streamingMode},autoGet:{type:"toggle",icon:"speechBalloonLasso",defaultVal:!0,label:app.msgs.menuLabel_autoAnswer,helptip:app.msgs.helptip_autoGetAnswers},autoSummarize:{type:"toggle",icon:"summarize",defaultVal:!1,label:app.msgs.menuLabel_autoSummarizeResults,helptip:app.msgs.helptip_autoSummarizeResults},autoFocusChatbarDisabled:{type:"toggle",mobile:!1,icon:"caretsInward",defaultVal:!0,label:app.msgs.menuLabel_autoFocusChatbar,helptip:app.msgs.helptip_autoFocusChatbar},autoScroll:{type:"toggle",mobile:!1,icon:"arrowsDown",defaultVal:!1,label:`${app.msgs.mode_autoScroll} (${app.msgs.menuLabel_whenStreaming})`,helptip:app.msgs.helptip_autoScroll},rqDisabled:{type:"toggle",icon:"speechBalloons",defaultVal:!1,label:`${app.msgs.menuLabel_show} ${app.msgs.menuLabel_relatedQueries}`,helptip:app.msgs.helptip_showRelatedQueries},prefixEnabled:{type:"toggle",icon:"slash",defaultVal:!1,label:`${app.msgs.menuLabel_require} "/" ${app.msgs.menuLabel_beforeQuery}`,helptip:app.msgs.helptip_prefixMode},suffixEnabled:{type:"toggle",icon:"questionMark",defaultVal:!1,label:`${app.msgs.menuLabel_require} "?" ${app.msgs.menuLabel_afterQuery}`,helptip:app.msgs.helptip_suffixMode},widerSidebar:{type:"toggle",mobile:!1,icon:"widescreenTall",defaultVal:!1,label:app.msgs.menuLabel_widerSidebar,helptip:app.msgs.helptip_widerSidebar},stickySidebar:{type:"toggle",mobile:!1,icon:"sidebar",defaultVal:!1,label:app.msgs.menuLabel_stickySidebar,helptip:app.msgs.helptip_stickySidebar},anchored:{type:"toggle",mobile:!1,icon:"anchor",defaultVal:!1,label:app.msgs.mode_anchor,helptip:app.msgs.helptip_anchorMode},bgAnimationsDisabled:{type:"toggle",icon:"sparkles",defaultVal:!1,label:`${app.msgs.menuLabel_background} ${app.msgs.menuLabel_animations}`,helptip:app.msgs.helptip_bgAnimations},fgAnimationsDisabled:{type:"toggle",icon:"sparkles",defaultVal:!1,label:`${app.msgs.menuLabel_foreground} ${app.msgs.menuLabel_animations}`,helptip:app.msgs.helptip_fgAnimations},replyLang:{type:"prompt",icon:"languageChars",label:app.msgs.menuLabel_replyLanguage,helptip:app.msgs.helptip_replyLanguage},scheme:{type:"modal",icon:"scheme",label:app.msgs.menuLabel_colorScheme,helptip:app.msgs.helptip_colorScheme},debugMode:{type:"toggle",icon:"bug",defaultVal:!1,label:app.msgs.mode_debug,helptip:app.msgs.helptip_debugMode},about:{type:"modal",icon:"questionMarkCircle",label:`${app.msgs.menuLabel_about} ${app.name}...`}}}),Object.assign(config,{lineHeightRatio:env.browser.isMobile?1.357:1.375,maxFontSize:24,minFontSize:11}),settings.load(Object.keys(settings.controls),"expanded","fontSize","minimized","notFirstRun"),config.replyLang||settings.save("replyLang",env.browser.language),config.fontSize||settings.save("fontSize",env.browser.isMobile?14:14.0423),env.scriptManager.supportsStreaming||settings.save("streamingDisabled",!0),!config.notFirstRun&&env.browser.isMobile&&settings.save("autoGet",!0),settings.save("notFirstRun",!0),log.debug(`Success! config = ${log.prettifyObj(config)}`),window.update={appBottomPos(){app.div.style.bottom=(config.minimized?22-app.div.offsetHeight:-33)+"px"},appStyle(){const{scheme:e}=env.ui.app,t="dark"==e&&!config.bgAnimationsDisabled;modals.stylize(),app.styles?.isConnected||document.head.append(app.styles||=dom.create.style()),app.styles.textContent=`:root {\n                  --app-bg-color-light-scheme: white ; --app-bg-color-dark-scheme: #1f1f1f ;\n                  --pre-bg-color-light-scheme: #b7b7b736 ; --pre-bg-color-dark-scheme: #3a3a3a ;\n                  --reply-header-bg-color-light-scheme: #d7d4d4 ;\n                  --reply-header-bg-color-dark-scheme: ${t?"#0e0e0e24":"#545454"};\n                  --reply-header-fg-color-light-scheme: white ; --reply-header-fg-color-dark-scheme: white ;\n                  --chatbar-btn-color-light-scheme: lightgrey ; --chatbar-btn-color-dark-scheme: #fff ;\n                  --chatbar-btn-hover-color-light-scheme: #638ed4 ; --chatbar-btn-hover-color-dark-scheme: #fff ;\n                  --font-color-light-scheme: #4e4e4e ; --font-color-dark-scheme: #e3e3e3 ;\n                  --app-border: ${t?"none":"1px solid #"+("light"==e?"dadce0":"3b3b3b")};\n                  --app-gradient-bg: linear-gradient(180deg, ${"dark"==e?"#99a8a6 -245px, black 185px":"#b6ebff -163px, white 65px"}) ;\n                  --app-anchored-shadow: 0 15px 52px rgb(0,0,${"light"==e?"7,0.06":"11,0.22"}) ;\n                  --app-transition: opacity 0.5s ease, transform 0.5s ease, /* for 1st fade-in */\n                                    bottom 0.1s cubic-bezier(0,0,0.2,1), /* smoothen Anchor Y min/restore */\n                                    width 0.167s cubic-bezier(0,0,0.2,1) ; /* smoothen Anchor X expand/shrink */\n                  --standby-btn-zoom: scale(1.015) ; --standby-btn-transition: all 0.18s ease ;\n                  --btn-transition: transform 0.15s ease, /* for hover-zoom */\n                                    opacity 0.25s ease-in-out ; /* + btn-zoom-fade-out + .app-hover-only shows */\n                  --font-size-slider-thumb-transition: transform 0.05s ease ; /* for hover-zoom */\n                  --reply-pre-transition: max-height 0.167s cubic-bezier(0, 0, 0.2, 1) ; /* for Anchor changes */\n                  --rq-transition: opacity 0.55s ease, transform 0.1s ease !important ; /* for fade-in + hover-zoom */\n                  --fade-in-transition: opacity 0.4s ease ;\n                  --fade-in-less-transition: opacity 0.2s ease } /* used by Font Size slider + Pin menu */.fade-in {\n                    opacity: 0 ; transform: translateY(10px) ;\n                    transition: var(--fade-in-less-transition) ;\n                       -webkit-transition: var(--fade-in-transition) ;\n                       -moz-transition: var(--fade-in-transition) ;\n                       -o-transition: var(--fade-in-transition) ;\n                       -ms-transition: var(--fade-in-transition)\n                }\n                .fade-in-less {\n                    opacity: 0 ;\n                    transition: var(--fade-in-less-transition) ;\n                       -webkit-transition: var(--fade-in-less-transition) ;\n                       -moz-transition: var(--fade-in-less-transition) ;\n                       -o-transition: var(--fade-in-less-transition) ;\n                       -ms-transition: var(--fade-in-less-transition)\n                }\n                .fade-in.active, .fade-in-less.active { opacity: 1 ; transform: translateY(0) }\n                @keyframes btn-zoom-fade-out {\n                    0% { opacity: 1 } 55% { opacity: 0.25 ; transform: scale(1.85) }\n                    75% { opacity: 0.05 ; transform: scale(2.15) } 100% { opacity: 0 ; transform: scale(6.85) }}\n                @keyframes icon-scroll { 0% { transform: translateX(0) } 100% { transform: translateX(-14px) }}\n                @keyframes pulse { 0%, to { opacity: 1 } 50% { opacity: .5 }}\n                @keyframes rotate { from { transform: rotate(0deg) } to { transform: rotate(360deg) }}\n                @keyframes spinY { 0% { transform: rotateY(0deg) } 100% { transform: rotateY(360deg) }}.no-user-select {\n                   -webkit-user-select: none ; -moz-user-select: none ;\n                   -ms-user-select: none ; user-select: none }\n                .no-mobile-tap-outline { outline: none ; -webkit-tap-highlight-color: transparent }\n                /* stylize scrollbars in Chromium/Safari */\n                    #${app.slug} *::-webkit-scrollbar { width: 7px }\n                    #${app.slug} *::-webkit-scrollbar-thumb { background: #cdcdcd }\n                    #${app.slug} *::-webkit-scrollbar-thumb:hover { background: #a6a6a6 }\n                    #${app.slug} *::-webkit-scrollbar-track { background: none }\n                #${app.slug} * { scrollbar-width: thin } /* make scrollbars thin in Firefox */\n                .cursor-overlay { /* for fontSizeSlider.createAppend() drag listeners to show resize cursor everywhere */\n                    position: fixed ; top: 0 ; left: 0 ; width: 100% ; height: 100% ;\n                    z-index: 9999 ; cursor: ew-resize }\n                #${app.slug} { /* main app div */\n                    color: var(--font-color-${e}-scheme) ;\n                    background: var(--app-bg-color-${e}-scheme) ;\n                    position: sticky ; z-index: 101 ; padding: ${env.browser.isFF?20:22}px 26px 6px 26px ;\n                    ${env.browser.isMobile?"":"margin-top: 55px ;"} /* add top margin on desktop */\n                    border-radius: 8px ; height: fit-content ;\n                    width: ${env.browser.isMobile?"auto":"319px"};\n                    ${env.browser.isMobile?"margin: 8px 0 8px":"margin-bottom: 30px"}; /* add vertical margins */\n                    word-wrap: break-word ; white-space: pre-wrap ;\n                    transition: var(--app-transition) ;\n                       -webkit-transition: var(--app-transition) ; -moz-transition: var(--app-transition) ;\n                       -o-transition: var(--app-transition) ; -ms-transition: var(--app-transition) }\n                #${app.slug}:has(.${app.slug}-alert) { /* app alerts */\n                    border: var(--app-border) ; background-image: var(--app-gradient-bg) }\n                #${app.slug} .app-hover-only { /* hide app-hover-only elems */\n                    position: absolute ; left: -9999px ; opacity: 0 ; /* using position to support transitions */\n                    width: 0 } /* to support width calcs */\n                /* show app-hover-only elems on hover + Font Size button when slider visible */\n                #${app.slug}:hover .app-hover-only, #${app.slug}:active .app-hover-only,\n                    #${app.slug}:has([id$=font-size-slider-track].active) [id$=font-size-btn] {\n                        position: relative ; left: auto ; width: auto ; opacity: 1 }\n                #${app.slug} p { margin: 0 }\n                #${app.slug} .alert-link {\n                    color: ${"light"==e?"#190cb0":"white ; text-decoration: underline"}}\n                .${app.slug}-name {\n                    font-size: 1.35rem ; font-weight: 700 ; text-decoration: none ;\n                    color: ${"dark"==e?"white":"black"} !important }\n                .byline { /* header byline */\n                    font-size: 12px ; margin-left: 7px ; color: #aaa ;\n                  --byline-transition: 0.15s ease-in-out ; transition: var(--byline-transition) ;\n                       -webkit-transition: var(--byline-transition) ; -moz-transition: var(--byline-transition) ;\n                       -o-transition: var(--byline-transition) ; -ms-transition: var(--byline-transition) }\n                .byline a, .byline a:visited { color: #aaa ; text-decoration: none !important }\n                .byline a:hover {\n                    color: ${"dark"==e?"white":"black"};\n                    transition: var(--byline-transition) ;\n                       -webkit-transition: var(--byline-transition) ; -moz-transition: var(--byline-transition) ;\n                       -o-transition: var(--byline-transition) ; -ms-transition: var(--byline-transition) }\n                #${app.slug}-header-btns { display: flex ; direction: rtl ; gap: 2px ; float: right }\n                .${app.slug}-header-btn {\n                    float: right ; cursor: pointer ; position: relative ; top: 6px ;\n                    ${"dark"==e?"fill: white ; stroke: white":"fill: #adadad ; stroke: #adadad"}}\n                .${app.slug}-header-btn:hover svg { /* highlight/zoom header button on hover */\n                    ${"dark"==e?"fill: #d9d9d9 ; stroke: #d9d9d9":"fill: black ; stroke: black"};\n                    ${env.browser.isMobile?"":"transform: scale(1.285)"}}\n                ${config.fgAnimationsDisabled?"":`.${app.slug}-header-btn, .${app.slug}-header-btn svg { /* smooth header button fade-in + hover-zoom */\n                    transition: var(--btn-transition) ;\n                       -webkit-transition: var(--btn-transition) ; -moz-transition: var(--btn-transition) ;\n                       -o-transition: var(--btn-transition) ; -ms-transition: var(--btn-transition) }`}\n                .${app.slug}-header-btn:active {\n                    ${"dark"==e?"fill: #999999 ; stroke: #999999":"fill: #638ed4 ; stroke: #638ed4"}}\n                #${app.slug}-logo, .${app.slug}-header-btn svg {\n                    filter: drop-shadow(${"dark"==e?"#7171714d 10px":"#aaaaaa21 7px"} 7px 3px) }\n                #${app.slug} .loading {\n                    padding-bottom: 15px ; color: #b6b8ba ; fill: #b6b8ba ;\n                    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite }\n                #${app.slug} section.loading { padding: 15px 0 14px 5px } /* pad loading status when sending replies */\n                #${app.slug}-font-size-slider-track {\n                    width: 98% ; height: 7px ; margin: 3px auto ${env.browser.isCompact?-6:-11}px ;\n                    padding: 15px 0 ; background-color: #ccc ; box-sizing: content-box; background-clip: content-box ;\n                   -webkit-background-clip: content-box }\n                #${app.slug}-font-size-slider-track::before { /* to add finger cursor to unpadded core only */\n                    content: "" ; position: absolute ; top: 10px ; left: 0 ; right: 0 ;\n                    height: calc(100% - 20px) ; cursor: pointer }\n                #${app.slug}-font-size-slider-tip {\n                    z-index: 1 ; position: absolute ; bottom: 20px ;\n                    border-left: 4.5px solid transparent ; border-right: 4.5px solid transparent ;\n                    border-bottom: 16px solid #ccc }\n                #${app.slug}-font-size-slider-thumb {\n                    z-index: 2 ; width: 7px ; height: 25px ; border-radius: 30% ; position: relative ;\n                    top: -7.5px ; cursor: ew-resize ;\n                    background-color: ${"dark"==e?"white":"#4a4a4a"};\n                  --shadow: rgba(0,0,0,0.21) 1px 1px 9px 0 ;\n                        box-shadow: var(--shadow) ; -webkit-box-shadow: var(--shadow) ; -moz-box-shadow: var(--shadow) ;\n                    ${config.fgAnimationsDisabled?"":"transition: var(--font-size-slider-thumb-transition) \n                       -webkit-transition: var(--font-size-slider-thumb-transition) ;\n                       -moz-transition: var(--font-size-slider-thumb-transition) ;\n                       -o-transition: var(--font-size-slider-thumb-transition) ;\n                       -ms-transition: var(--font-size-slider-thumb-transition)"}}\n                ${env.browser.isMobile?"":`#${app.slug}-font-size-slider-thumb:hover { transform: scale(1.125) }`}\n                .${app.slug}-standby-btns { margin: 20px 0 -14px }\n                .${app.slug}-standby-btn {\n                  --skew: skew(-13deg) ; --counter-skew: skew(13deg) ; border-radius: 8px ;\n                  --content-color: ${"dark"==e?"white":"black"};\n                    display: flex ; align-items: center ; justify-content: center ; gap: 8px ;\n                    width: 90% ; height: 51px ; margin-bottom: 9px ; padding: 12px 0 ;\n                    cursor: pointer ; transform: var(--skew) ; border: 1px solid var(--content-color) ;\n                    background: none ; box-shadow: #aaaaaa12 7px 7px 3px 0px ; color: var(--content-color) ;\n                    ${config.fgAnimationsDisabled?"":"will-change: transform ;\n                           transition: var(--standby-btn-transition) ;\n                               -webkit-transition: var(--standby-btn-transition) ;\n                               -moz-transition: var(--standby-btn-transition) ;\n                               -o-transition: var(--standby-btn-transition) ;\n                               -ms-transition: var(--standby-btn-transition)"}}\n                .${app.slug}-standby-btn:hover {\n                    color: var(--content-color) ; border-radius: 2px ; transform: var(--skew) var(--standby-btn-zoom) }\n                .${app.slug}-standby-btn > span { transform: var(--counter-skew) }\n                .${app.slug}-standby-btn > svg {\n                    position: relative ; stroke: var(--content-color) ; fill: stroke: var(--content-color) ;\n                    transform: var(--counter-skew) }\n                .${app.slug}-standby-btn:nth-child(odd) { margin-right: 10% }\n                .${app.slug}-standby-btn:nth-child(even) { margin-left: 10% ; margin-bottom: 19px }\n                .${app.slug}-standby-btn:first-of-type svg { /* Query button icon */\n                    width: 11px ; height: 11px ; top: -1.5px ; right: -1.5px }\n                .${app.slug}-standby-btn:nth-of-type(2) svg { /* Summarize button icon */\n                    width: 17.5px ; height: 17.5px }#${app.slug} .reply-tip {\n                    content: "" ; position: relative ; border: 7px solid transparent ;\n                    float: left ; margin: 3px -15px 0 0 ;\n                    left: ${env.browser.isMobile?12:6}px ; /* positioning */\n                    border-bottom-style: solid ; border-bottom-width: 20px ; border-top: 0 ; border-bottom-color:\n                        ${t?"#0000":`var(--reply-header-bg-color-${e}-scheme)`}}\n                #${app.slug} .reply-header {\n                    display: flex ; align-items: center ; position: relative ; box-sizing: border-box ; width: 100% ;\n                    top: 16px ; padding: 16px 14px ; height: 18px ; border-radius: 12px 12px 0 0 ;\n                    ${"light"==e?"border-bottom: 1px solid white":t?"border: 1px solid ; border-bottom-color: transparent":""};\n                    background: var(--reply-header-bg-color-${e}-scheme) ;\n                    color:      var(--reply-header-fg-color-${e}-scheme) ;\n                    fill:       var(--reply-header-fg-color-${e}-scheme) ;\n                    stroke:     var(--reply-header-fg-color-${e}-scheme) }\n                #${app.slug} .reply-header-txt { flex-grow: 1 ; font-size: 12px ; font-family: monospace }\n                #${app.slug} .reply-header-btns { margin: 3.5px -5px 0 }\n                #${app.slug} .reply-pre {\n                    font-size: ${config.fontSize}px ; white-space: pre-wrap ; min-width: 0 ;\n                    line-height: ${config.fontSize*config.lineHeightRatio}px ; overscroll-behavior: contain ;\n                    position: relative ; z-index: 1 ; /* allow top-margin to overlap header in light scheme */\n                    margin: ${"light"==e?13:15}px 0 0 0 ; padding: 1em 1em 0 1em ;\n                    border-radius: 0 0 12px 12px ; overflow: auto ;\n                    ${config.bgAnimationsDisabled?`background: var(--pre-bg-color-${e}-scheme) ;\n                         color: var(--font-color-${e}-scheme)`:"dark"==e?"background: #2b3a40cf ; color: var(--font-color-dark-scheme) ; border: 1px solid white":"background: var(--pre-bg-color-light-scheme) ;\n                            color: var(--font-color-light-scheme) ; border: none"};\n                    ${config.fgAnimationsDisabled?"":"transition: var(--reply-pre-transition) ;\n                            -webkit-transition: var(--reply-pre-transition) ;\n                            -moz-transition: var(--reply-pre-transition) ;\n                            -o-transition: var(--reply-pre-transition) ;\n                            -ms-transition: var(--reply-pre-transition)"}}\n                #${app.slug} .reply-pre a, #${app.slug} .reply-pre a:visited { color: #4495d4 }\n                #${app.slug} .reply-pre a:hover { color: ${"dark"==e?"white":"#28a017"}}\n                #${app.slug} .code-header {\n                    display: flex ; direction: rtl ; gap: 9px ; align-items: center ;\n                    height: 11px ; margin: 3px -2px 0 }\n                #${app.slug} .code-header btn { cursor: pointer }\n                #${app.slug} .code-header svg { height: 13px ; width: 13px ; fill: white }#${app.slug} .reply-pre h1 { font-size: 1.25em }\n                #${app.slug} .reply-pre h2 { font-size: 1.1em } /* size headings */\n                #${app.slug} .reply-pre ol { margin: -5px 0 -8px 7px ; padding-left: 1.58em }\n                #${app.slug} .reply-pre ul { /* reduce v-spacing, indent */\n                    margin: -10px 0 -6px ; padding-left: 1.5em }\n                #${app.slug} .reply-pre li { /* reduce v-spacing, show hollow bullets */\n                    margin: -8px 0 ; list-style: circle }\n                #${app.slug} .reply-pre ul ul { margin-top: 0 } /* push sub-lists down */\n                #${app.slug} .reply-pre ul ul > li { list-style: disc } /* fill sub-bullets */#${app.slug} ${GM_getResourceText("hljsCSS").replace(/\/\*[^*]+\*\//g,"").trim().replace(/([,}])(.)(?![^{]*\})/g,`$1#${app.slug} $2`)} /* scope selectors to app */\n                #${app.slug} pre:has(> code) { padding: 0 } /* remove padded border around code blocks */\n                #${app.slug} code { font-size: 0.85em } /* shrink code vs. regular text */.katex-html { display: none } /* hide unrendered math */#${app.slug}-chatbar {\n                    border: solid 1px ${t?"#aaa":"dark"==e?"#777":"#555"};\n                    border-radius: 12px 13px 12px 0 ; margin: 12px 0 15px 0 ; padding: 13px 55px 13px 10px ;\n                    position: relative ; z-index: 555 ; color: ${"dark"==e?"#eee":"#222"};\n                    height: 16px ; max-height: 200px ; resize: none ;\n                    background: ${"light"==e?"#eeeeee9e":"#515151"+(config.bgAnimationsDisabled?"":"9e")};\n                    ${"dark"==e?"":"--chatbar-inset-shadow: 0 1px 2px rgba(15,17,17,0.1) inset ;\n                        box-shadow: var(--chatbar-inset-shadow) ; -webkit-box-shadow: var(--chatbar-inset-shadow) ;\n                       -moz-box-shadow: var(--chatbar-inset-shadow) ;"}\n                        transition: box-shadow 0.15s ease ;\n                           -webkit-transition: box-shadow 0.15s ease ; -moz-transition: box-shadow 0.15s ease ;\n                           -o-transition: box-shadow 0.15s ease ; -ms-transition: box-shadow 0.15s ease }\n                ${t?"":`#${app.slug}-chatbar:hover:not(:focus) {\n                        outline: ${"light"==e?"black":"white"} auto 5px ;\n                      --chatbar-hover-inset-shadow: 0 ${"dark"==e?"3px 2px":"1px 7px"} rgba(15,17,17,0.15) inset ;\n                        box-shadow: var(--chatbar-hover-inset-shadow) ;\n                       -webkit-box-shadow: var(--chatbar-hover-inset-shadow) ;\n                       -moz-box-shadow: var(--chatbar-hover-inset-shadow) ;\n                        transition: box-shadow 0.25s ease ;\n                           -webkit-transition: box-shadow 0.25s ease ; -moz-transition: box-shadow 0.25s ease ;\n                           -o-transition: box-shadow 0.25s ease ; -ms-transition: box-shadow 0.25s ease }`}\n                #${app.slug}-chatbar:focus-visible { /* fallback outline chatbar + reduce inset shadow on focus */\n                    outline: -webkit-focus-ring-color auto 1px ;\n                    ${t?"":`--inset-shadow: 0 ${"dark"==e?"3px -1px":"1px 2px"} rgba(0,0,0,0.3) inset ;\n                        box-shadow: var(--inset-shadow) ;\n                       -webkit-box-shadow: var(--inset-shadow) ; -moz-box-shadow: var(--inset-shadow)`}\n                }\n                .${app.slug}-chatbar-btn {\n                    z-index: 560 ; border: none ; float: right ; position: relative ; background: none ;\n                    cursor: pointer ; bottom: ${env.browser.isFF?47:52}px ;\n                    transform: scale(1.05) ; margin-right: 3px ; /* zoom 'em a bit */\n                    color:  var(--chatbar-btn-color-${e}-scheme) ;\n                    fill:   var(--chatbar-btn-color-${e}-scheme) ;\n                    stroke: var(--chatbar-btn-color-${e}-scheme)\n                }\n                .${app.slug}-chatbar-btn:hover {\n                    color:  var(--chatbar-btn-hover-color-${e}-scheme) ;\n                    fill:   var(--chatbar-btn-hover-color-${e}-scheme) ;\n                    stroke: var(--chatbar-btn-hover-color-${e}-scheme)\n                }.${app.slug}-related-queries {\n                    display: flex ; flex-wrap: wrap ; width: 100% ; margin-bottom: 19px ; padding: 0 5px }\n                .${app.slug}-related-query {\n                    font-size: ${env.browser.isMobile?1:.81}em ; cursor: pointer ; will-change: transform ;\n                    box-sizing: border-box ; width: fit-content ; max-width: 100% ; /* confine to outer div */\n                    margin: 5px 12px 7px 0 ; padding: 8px 12px 8px 13px ;\n                    color: ${"dark"==e?config.bgAnimationsDisabled?"#ccc":"#f2f2f2":"#767676"};\n                    background: ${"dark"==e?"#7e7e7e4f":"#fdfdfdb0"};\n                    border: 1px solid ${"dark"==e?config.bgAnimationsDisabled?"#5f5f5f":"#777":"#d2d2d2"};\n                    border-radius: 0 13px 12px 13px ; flex: 0 0 auto ;\n                  --rq-shadow: 1px 4px 8px -6px rgba(169,169,169,0.75) ; box-shadow: var(--rq-shadow) ;\n                       -webkit-box-shadow: var(--rq-shadow) ; -moz-box-shadow: var(--rq-shadow) ;\n                    ${config.fgAnimationsDisabled?"":"transition: var(--rq-transition) ;\n                       -webkit-transition: var(--rq-transition) ; -moz-transition: var(--rq-transition) ;\n                       -o-transition: var(--rq-transition) ; -ms-transition: var(--rq-transition)"}}\n                .${app.slug}-related-query:hover, .${app.slug}-related-query:focus {\n                    ${config.fgAnimationsDisabled?"":"transform: scale(1.055) !important ;"}\n                    background: ${"dark"==e?"#a2a2a270":"#dae5ffa3 ; color: #000000a8 ; border-color: #a3c9ff"}}\n                .${app.slug}-related-query svg { /* related query icon */\n                    float: left ; margin: -0.09em 6px 0 0 ;\n                    color: ${"dark"==e?"#aaa":"#c1c1c1"}}#${app.slug} footer {\n                    position: relative ; text-align: right ; font-size: 0.75rem ; line-height: 1.43em ;\n                    right: -54px ; margin: ${env.browser.isFF?1:-2}px -32px 12px }\n                #${app.slug} footer * { color: #aaa ; text-decoration: none }\n                #${app.slug} footer a:hover { color: ${"dark"==e?"white":"black"}}.chatgpt-notif {\n                    fill: white ; stroke: white ; font-size: 25px !important ; padding: 13px 14px 13px 13px !important }\n                .notif-close-btn { display: none !important } /* hide notif close btn */\n                .${app.slug}-menu {\n                    position: absolute ; z-index: 12250 ;\n                    padding: 3.5px 5px !important ; font-family: "Source Sans Pro", sans-serif ; font-size: 12px }.${app.slug}-menu ul { margin: 0 ; padding: 0 ; list-style: none }\n                .${app.slug}-menu-item { padding: 0 5px ; line-height: 20.5px }\n                .${app.slug}-menu-item:not(.${app.slug}-menu-header):hover {\n                    cursor: pointer ; background: white ; color: black ; fill: black }#${app.slug}.wider { min-width: 455px }\n                #${app.slug}.wider ~ div { min-width: 508px } /* expand side snippets */\n                #center_col:has(~ div #${app.slug}.wider),\n                    #center_col:has(~ div #${app.slug}.wider) div {\n                        max-width: 516px } /* shrink center column/children */\n                div:has(> #${app.slug}.wider) { /* shift sidebar left to align w/ skinnier center column */\n                    position: relative ; left: -136px }#${app.slug}.sticky { position: sticky ; top: 87px }\n                #${app.slug}.sticky ~ * { display: none }#${app.slug}.anchored {\n                    position: fixed ; bottom: -7px ; right: 35px ; width: 388px ; z-index: 8888 ;\n                    border: var(--app-border) ; box-shadow: var(--app-anchored-shadow) ;\n                    ${config.bgAnimationsDisabled?`background: var(--app-bg-color-${e}-scheme)`:"background-image: var(--app-gradient-bg)"}}\n                #${app.slug}.expanded { width: 528px !important }\n                #${app.slug}.anchored .anchored-hidden { display: none } /* hide non-Anchor elems in mode */\n                #${app.slug}:not(.anchored) .anchored-only { display: none } /* hide Anchor elems outside mode */@media (hover: none) {\n                    #${app.slug} .app-hover-only { /* show app-hover-only elems */\n                        position: relative ; left: auto ; width: auto ; opacity: 1 }\n                    #${app.slug} *:hover { transform: none !important } /* disable hover fx */\n                }@media screen and (max-width: 480px) {\n                    #${app.slug} #${app.slug}-logo { /* header logo... */\n                        top: 0 ; width: calc(100% - 154px) } /* remove y-pos, widen till btns */\n                    #${app.slug} .byline { display: none !important } /* hide byline */\n                    #${app.slug} [class*=reply-tip] { display: none } /* hide reply tip */\n                    .${app.slug}-related-queries { padding: 0 } /* remove RQ parent padding */\n                }`,themes.apply(config.theme)},bylineVisibility(){if(env.browser.isCompact)return;const e={byline:app.div.querySelector(".byline")};if(!e.byline)return;Object.assign(e,{appPrefix:app.div.querySelector("#app-prefix"),btns:app.div.querySelectorAll(`#${app.slug}-header-btns > btn`),logo:app.div.querySelector(`#${app.slug}-logo`)});const t=getComputedStyle(app.div),n={appDiv:app.div.getBoundingClientRect().width,appDivXpadding:parseFloat(t.paddingLeft)+parseFloat(t.paddingRight)};Object.entries(e).forEach(([e,t])=>n[e]=dom.get.computedWidth(t));const a=n.appDiv-n.appDivXpadding-n.appPrefix-n.logo-n.btns-16;Object.assign(e.byline.style,n.byline>a?{position:"absolute",left:"-9999px",opacity:0}:{position:"",left:"",opacity:1})},chatbarWidth(){const e=app.div.querySelector(`#${app.slug}-chatbar`);e&&(e.style.width=(env.browser.isMobile?81.4:config.anchored?config.expanded?87.4:83.3:config.widerSidebar?env.ui.site.hasSidebar?85.4:85.9:env.ui.site.hasSidebar?79.3:80.1)+"%")},async footerContent(){function e(e){let t,n,a=e.length;for(;0!=a;)n=Math.floor(chatgpt.randomFloat()*a),a-=1,t=e[a],e[a]=e[n],e[n]=t;return e}function t(e){let t=[...e],n=t.length-1;return e.forEach(([e,a])=>{if(a.boost){const o=parseInt(a.boost)/100,s=Math.ceil(n/(1-o))*o-1;for(let n=0;n<s;n++)t.push([e,a]);n+=s}}),t}const n=await get.json("https://cdn.jsdelivr.net/gh/KudoAI/ads-library/advertisers/index.json").catch(e=>log.error(e.message));if(!n)return;let a;for(const[o,s]of e(t(Object.entries(n))))if(s.campaigns.text){a=o;break}if(!a)return;const o=await get.json(`https://cdn.jsdelivr.net/gh/KudoAI/ads-library/advertisers/${a}/text/campaigns.json`).catch(e=>log.error(e.message));if(!o)return;const s=new RegExp(app.name.toLowerCase(),"i"),i=(()=>{const e=new Date;return e.getFullYear()+String(e.getMonth()+1).padStart(2,"0")+String(e.getDate()).padStart(2,"0")})();let r=!1;for(const[n,a]of e(t(Object.entries(o))))if(a.active&&(!a.endDate||i<=a.endDate)){for(const[o,i]of e(t(Object.entries(a.adGroups)))){if(/^self$/i.test(o)&&!s.test(n)||s.test(n)&&!/^self$/i.test(o)||0==i.active||i.targetBrowsers&&!i.targetBrowsers.some(e=>new RegExp(e,"i").test(navigator.userAgent))||i.targetLocations&&(!env.userLocale||!i.targetLocations.some(e=>e.includes(env.userLocale)||env.userLocale.includes(e))))continue;const e=i.ads.filter(e=>0!=e.active);if(!e.length)continue;const t=e[Math.floor(chatgpt.randomFloat()*e.length)];let p=t.destinationURL||i.destinationURL||a.destinationURL||"";if(p.includes("http")){const[e,t]=p.split("?"),n=new URLSearchParams(t||"");n.set("utm_source",app.name.toLowerCase()),n.set("utm_content","app_footer_link"),p=`${e}?${n.toString()}`}const l=p?dom.create.anchor(p):dom.create.elem("span");app.footerContent.replaceWith(l),app.footerContent=l,app.footerContent.textContent=t.text,app.footerContent.setAttribute("title",t.tooltip||""),r=!0;break}if(r)break}},replyPrefix(){const e=app.div.querySelector("pre p");if(!e)return;const t="dark"==env.ui.app.scheme&&!config.bgAnimationsDisabled&&!/shuffle|summarize/.test(get.reply.src),n=e.textContent.startsWith(">> ");t&&!n?e.prepend(">> "):!t&&n&&(e.textContent=e.textContent.replace(/^>> /,""))},risingParticles(){["sm","med","lg"].forEach(e=>document.querySelectorAll(`[id*=particles-${e}]`).forEach(t=>t.id=config.bgAnimationsDisabled?`particles-${e}-off`:`${"dark"==env.ui.app.scheme?"white":"gray"}-particles-${e}`))},rqVisibility(){const e=app.div.querySelector(`.${app.slug}-related-queries`);e&&(e.style.display=config.rqDisabled||config.anchored?"none":"flex")},scheme(e){env.ui.app.scheme=e,t.googlegpt.update(),icons.googlegpt.update(),update.appStyle(),update.risingParticles(),update.replyPrefix(),modals.settings.updateSchemeStatus()}},window.toggle={anchorMode(e=""){const t=config.anchored;let n=!1;if("on"==e||!e&&!config.anchored?(settings.save("anchored",!0),["sticky","wider"].forEach(e=>{config[`${e}Sidebar`]&&(toggle.sidebar(e),n=!0)})):(settings.save("anchored",!1),config.expanded&&(toggle.expandedMode("off"),n=!0)),t!=config.anchored){if(app.div.classList.toggle("anchored",config.anchored),update.rqVisibility(),replyBubble.updateMaxHeight(),update.chatbarWidth(),getComputedStyle(app.div).transitionProperty.includes("width")&&app.div.addEventListener("transitionend",function e(t){"width"==t.propertyName&&(update.bylineVisibility(),app.div.removeEventListener("transitionend",e))}),modals.settings.get()){const e=document.querySelector("[id*=anchor] input");e.checked!=config.anchored&&modals.settings.toggle.switch(e)}feedback.notify(`${app.msgs.mode_anchor} ${menus.toolbar.state.words[+config.anchored]}`,void 0,n?2.75:void 0)}},animations(e){const t=`${e}AnimationsDisabled`;if(settings.save(t,!config[t]),update.appStyle(),"bg"==e&&(update.risingParticles(),update.replyPrefix()),"fg"==e&&modals.settings.get()){const e=document.querySelector("#about-settings-entry > span > div");e.innerHTML=modals.settings.aboutContent[config.fgAnimationsDisabled?"short":"long"],e.style.float=config.fgAnimationsDisabled?"right":""}feedback.notify(`${settings.controls[t].label} ${menus.toolbar.state.words[+!config[t]]}`)},autoGen(e){const t=["get","summarize"],n=`auto${log.toTitleCase(e)}`;let a=!1;if(settings.save(n,!config[n]),config[n]){const n=t[+(e==t[0])];config[`auto${log.toTitleCase(n)}`]&&(toggle.autoGen(n),a=!0),["prefix","suffix"].forEach(e=>{config[`${e}Enabled`]&&(toggle.manualGen(e),a=!0)}),app.div.querySelector(`button[class*=standby]:has(svg.${"get"==e?"send":"summarize"})`)?.click()}if(feedback.notify(`${settings.controls[n].label} ${menus.toolbar.state.words[+config[n]]}`,void 0,a?2.75:void 0),modals.settings.get()){const e=document.querySelector(`[id*=${n}] input`);e.checked!=config[n]&&modals.settings.toggle.switch(e)}},expandedMode(e=""){const t="on"==e||!e&&!config.expanded;settings.save("expanded",t),app.div.classList.toggle("expanded",t),config.minimized&&toggle.minimized("off"),update.chatbarWidth(),getComputedStyle(app.div).transitionProperty.includes("width")&&app.div.addEventListener("transitionend",function e(t){"width"==t.propertyName&&(update.bylineVisibility(),app.div.removeEventListener("transitionend",e))});const n=app.div.querySelector(`#${app.slug}-arrows-btn`);n&&n.firstChild.replaceWith(icons.create({key:"arrowsDiagonal"+(config.expanded?"In":"Out"),size:17}))},manualGen(e){const t=`${e}Enabled`;let n=!1;if(settings.save(t,!config[t]),config[t]&&["get","summarize"].forEach(e=>{config[`auto${log.toTitleCase(e)}`]&&(toggle.autoGen(e),n=!0)}),feedback.notify(`${settings.controls[t].label} ${menus.toolbar.state.words[+config[t]]}`,void 0,n?2.75:void 0),modals.settings.get()){const e=document.querySelector(`[id*=${t}] input`);e.checked!=config[t]&&modals.settings.toggle.switch(e)}},minimized(e=""){const t="on"==e||!e&&!config.minimized;settings.save("minimized",t);const n=app.div.querySelector("[id$=chevron-btn]");n&&(n.textContent="",n.append(icons.create({key:"chevron"+(config.minimized?"Up":"Down"),size:22,style:"position: relative ; top: -1px"})),n.onclick=()=>{app.div.querySelector("[id$=font-size-slider-track]")?.classList.contains("active")&&fontSizeSlider.toggle("off"),toggle.minimized()}),update.appBottomPos(),tooltip.toggle("off")},proxyMode(){if(settings.save("proxyAPIenabled",!config.proxyAPIenabled),feedback.notify(`${app.msgs.menuLabel_proxyAPImode} ${menus.toolbar.state.words[+config.proxyAPIenabled]}`),menus.toolbar.refresh(),modals.settings.get()){const e=document.querySelector("[id*=proxy] input"),t=document.querySelector("[id*=preferredAPI]"),n=document.querySelector("[id*=streaming] input");e.checked!=config.proxyAPIenabled&&modals.settings.toggle.switch(e),t.classList.toggle("active",config.proxyAPIenabled),t.style.pointerEvents=config.proxyAPIenabled?"":"none",(n.checked&&!config.proxyAPIenabled||!n.checked&&config.proxyAPIenabled&&!config.streamingDisabled)&&modals.settings.toggle.switch(n)}const e=app.div.querySelector(`#${app.slug} .api-btn`);e&&(e.style.pointerEvents=config.proxyAPIenabled?"":"none"),app.div.querySelector(`.${app.slug}-alert`)&&get.reply({msgs:app.msgChain,src:get.reply.src})},relatedQueries(){settings.save("rqDisabled",!config.rqDisabled),update.rqVisibility(),config.rqDisabled||app.div.querySelector(`.${app.slug}-related-queries`)||get.related(app.msgChain[app.msgChain.length-1]?.content||n).then(e=>show.related(e)).catch(e=>{log.error(e.message),api.tryNew(get.related)}),replyBubble.updateMaxHeight(),feedback.notify(`${app.msgs.menuLabel_relatedQueries} ${menus.toolbar.state.words[+!config.rqDisabled]}`)},sidebar(e,t=""){const n=e+"Sidebar",a=config.stickySidebar;let o=!1;if("on"==t||!t&&!config[n]?("sticky"==e&&config.anchored&&(toggle.anchorMode(),o=!0),settings.save(n,!0)):settings.save(n,!1),app.div.classList.toggle(e,config[n]),replyBubble.updateMaxHeight(),update.bylineVisibility(),update.chatbarWidth(),"wider"==e&&document.querySelectorAll(`#${app.slug} svg.widescreenTall, #${app.slug} svg.widescreenWide`).forEach(e=>e.replaceWith(icons.create({key:"widescreen"+(config.widerSidebar?"Wide":"Tall")}))),modals.settings.get()){const t=document.querySelector(`[id*=${e}] input`);t.checked!=config[`${e}Sidebar`]&&modals.settings.toggle.switch(t)}"sticky"==e&&a==config.stickySidebar||feedback.notify(`${app.msgs[`menuLabel_${e}Sidebar`]||log.toTitleCase(e)+" Sidebar"} ${menus.toolbar.state.words[+config[n]]}`,void 0,o?2.75:void 0)},streaming(){if(env.scriptManager.supportsStreaming)if(config.proxyAPIenabled)settings.save("streamingDisabled",!config.streamingDisabled),feedback.notify(`${settings.controls.streamingDisabled.label} ${menus.toolbar.state.words[+!config.streamingDisabled]}`);else{let e=`${settings.controls.streamingDisabled.label} ${app.msgs.alert_isCurrentlyOnlyAvailBy} ${app.msgs.alert_switchingOn} ${app.msgs.mode_proxy}. (${app.msgs.alert_openAIsupportSoon}!)`;const t=app.msgs.alert_switchingOn;e=e.replace(t,`<a class="alert-link" href="#">${t}</a>`);const n=modals.alert(`${app.msgs.mode_streaming} ${app.msgs.alert_unavailable}`,e);n.querySelector('[href="#"]').onclick=()=>{n.querySelector(".modal-close-btn")?.click(),toggle.proxyMode()}}else{const e=env.browser.isFF?"https://addons.mozilla.org/firefox/addon/scriptcat/":env.browser.isEdge?"https://microsoftedge.microsoft.com/addons/detail/scriptcat/liilgpjgabokdklappibcjfablkpcekh":"https://chromewebstore.google.com/detail/scriptcat/ndcooeababalnlpkfedmmbbbgkljhpjf";modals.alert(`${settings.controls.streamingDisabled.label} ${app.msgs.alert_unavailable}`,`${settings.controls.streamingDisabled.label} ${app.msgs.alert_isOnlyAvailFor} <a target="_blank" rel="noopener" href="https://tampermonkey.net">Tampermonkey</a> ${app.msgs.about_and} <a target="_blank" rel="noopener" href="${e}">ScriptCat</a>. (${app.msgs.alert_userscriptMgrNoStream}.)`)}}},window.get={json:e=>new Promise((t,n)=>{function a(e){xhr({method:"GET",url:e,onload:({responseText:a,status:i})=>{if(i>=300&&404!=i)return n(new Error(`${i<400?"REDIRECT":i<500?"CLIENT":"SERVER"} ERROR: ${i}`));try{t(e.endsWith(".json")?JSON.parse(a):JSON5.parse(a))}catch(e){s<1?o():n(new Error(`PARSE ERROR: ${e.message}`))}},onerror:e=>{s<1?o():n(new Error(`LOAD ERROR: ${e.message}`))}})}function o(){s++,a(e.endsWith(".json")?e+"5":e.slice(0,-1))}let s=0;a(e)}),async related(e){if(get.related.status="waiting",get.related.triedAPIs=get.related.triedAPIs||[],get.related.attemptCnt=get.related.attemptCnt||1,get.related.api=api.pick(get.related),!get.related.api)return;"OpenAI"==get.related.api&&(config.openAIkey=await Promise.race([session.getOAItoken(),new Promise(e=>setTimeout(e,3e3))]));const t=get.related.api;get.related.query=e,get.related.timeout=setTimeout(()=>{"done"!=get.related.status&&get.related.api==t&&get.related.triedAPIs.length!=Object.keys(apis).length&&api.tryNew(get.related,"timeout")},7e3);const n=get.related.api;let a=prompts.create("relatedQueries",{prevQuery:e,mods:"all"});return a=prompts.augment(a,{api:n}),new Promise(e=>{const t=apis[n].method,o=api.createReqData(n,[{role:"user",content:a}]),s={headers:api.createHeaders(n),method:t,responseType:"text",onerror:e=>{log.error(e),api.tryNew(get.related)},onload:t=>api.process.text(t,{caller:get.related,callerAPI:n}).then(e),url:apis[n].endpoints?.completions||apis[n].endpoint};"POST"==t?s.data=JSON.stringify(o):"GET"==t&&(s.url+=`?q=${o}`),xhr(s)})},async reply({msgs:e,src:t=null}){get.reply.src=t,show.reply.updatedAPIinHeader=!1;const n=app.div.querySelector(`.${app.slug}-related-queries`),a=icons.create({key:"arrowsCyclic",size:15});let o;if(a.style.cssText="position: relative ; top: 2px ; margin-right: 6px",app.div.querySelector(".reply-pre")?(/regen|summarize/i.test(t)||n?.remove(),app.div.querySelector("footer").textContent="",o=app.div.querySelector("section"),o.style.margin="3px 0 -10px",o.textContent=app.alerts.waitingResponse,a.style.animation="rotate 1s infinite cubic-bezier(0, 1.05, 0.79, 0.44)"):(feedback.appAlert("waitingResponse"),o=app.div.querySelector(`.${app.slug}-alert`),a.style.animation="rotate 2s infinite linear"),o.classList.add("loading","no-user-select"),o.prepend(a),(e=structuredClone(e)).length>3&&(e=e.slice(-3)),e.forEach(e=>{"assistant"==e.role&&e.content.length>250&&(e.content=e.content.substring(0,250)+"...")}),get.reply.status="waiting",get.reply.triedAPIs=get.reply.triedAPIs||[],get.reply.attemptCnt=get.reply.attemptCnt||1,get.reply.api=config.proxyAPIenabled?api.pick(get.reply):"OpenAI",!get.reply.api)return feedback.appAlert((config.preferredAPI?"api":"proxy")+"NotWorking","suggest"+(config.preferredAPI?"DiffAPI":"OpenAI"));if(config.proxyAPIenabled){const e=get.reply.api;clearTimeout(get.reply.timeout),get.reply.timeout=get.reply.timeout=setTimeout(()=>{config.proxyAPIenabled&&"done"!=get.reply.status&&!get.reply.sender&&get.reply.api==e&&get.reply.triedAPIs.length!=Object.keys(apis).length-1&&api.tryNew(get.reply,"timeout")},1e3*(config.streamingDisabled?10:7*(config.preferredAPI?2:1)))}else config.openAIkey=await Promise.race([session.getOAItoken(),new Promise(e=>setTimeout(e,3e3))]);const s=get.reply.api,i=e[e.length-1];i.content=prompts.augment(i.content,{api:s,caller:get.reply});const r=apis[s].method,p=api.createReqData(s,e),l={headers:api.createHeaders(s),method:r,responseType:config.streamingDisabled||!config.proxyAPIenabled?"text":"stream",onerror:e=>{log.error(e),config.proxyAPIenabled?api.tryNew(get.reply):feedback.appAlert(config.openAIkey?["OpenAI","apiNotWorking","suggestProxy"]:"login")},onload:e=>api.process.text(e,{caller:get.reply,callerAPI:s}),onloadstart:e=>api.process.stream(e,{caller:get.reply,callerAPI:s}),url:apis[s].endpoints?.completions||apis[s].endpoint};"POST"==r?l.data=JSON.stringify(p):"GET"==r&&(l.url+=`?q=${p}`),xhr(l),config.rqDisabled||n||1!=get.reply.attemptCnt||get.related(app.msgChain[app.msgChain.length-1].content).then(e=>show.related(e)).catch(e=>{log.error(e.message),api.tryNew(get.related)}),update.footerContent()}},window.show={async codeCornerBtns(){app.div.querySelector("code")&&(window.codeLangData||=await get.json(`${app.urls.aiwebAssets}/data/code-languages.json`).catch(e=>log.error(e.message)),app.div.querySelectorAll("code").forEach(e=>{if(e.querySelector("[id$=copy-btn]"))return;const t=dom.create.elem("div",{class:"code-header"}),n=buttons.reply.bubble.copy.cloneNode(!0);n.style.cssText="",Object.entries(buttons.reply.bubble.copy.listeners).forEach(([e,t])=>n[e]=t);const a=dom.create.elem("btn",{id:`${app.slug}-download-btn`}),o={download:icons.create({key:"download"}),downloaded:icons.create({key:"checkmarkDouble"})};Object.entries(o).forEach(([e,t])=>{t.id=`${app.slug}-${e}-icon`,["width","height"].forEach(e=>t.setAttribute(e,15))}),a.append(o.download),a.onclick=({currentTarget:e})=>{if(!a.firstChild.matches("[id$=download-icon]"))return;a.style.cursor="default",a.firstChild.replaceWith(o.downloaded.cloneNode(!0)),tooltip.update(e),setTimeout(()=>{a.firstChild.replaceWith(o.download.cloneNode(!0)),a.style.cursor="pointer",a.matches(":hover")&&a.dispatchEvent(new Event("mouseenter"))},1e4);const t=a.closest("code"),n={hljsSlug:/language-(\w+)/.exec(t.className)?.[1]};if(n.hljsSlug&&window.codeLangData)for(const[e,t]of Object.entries(window.codeLangData))if(t.hljsSlug==n.hljsSlug){[n.name,n.fileExtension]=[e,t.fileExtension];break}const s=t.textContent.replace(/^>> /,"").trim()+"\n",i=dom.create.anchor(URL.createObjectURL(new Blob([s],{type:"text/plain"}))),r=new Date,p=[r.getFullYear(),String(r.getMonth()+1).padStart(2,"0"),String(r.getDate()).padStart(2,"0")].join("-");i.download=`${app.slug}_${n.name.toLowerCase()||"code"}_${p}_${Date.now().toString(36)}${n.fileExtension?"."+n.fileExtension:""}`,document.body.append(i),i.click(),i.remove(),URL.revokeObjectURL(i.href)},a.onmouseenter=a.onmouseleave=tooltip.toggle,t.append(n,a),e.prepend(t)}))},related(e){if(log.caller="show.related()","waiting"==get.reply.status)return setTimeout(()=>show.related(e),500,e);const t=app.div.querySelector(`#${app.slug} .reply-pre`)?.textContent.trim();if(/shuffle|summarize/i.test(get.reply.src)||get.related.replyIsQuestion||!/[?ï¼Ÿ]/.test(t)){if(e&&!app.div.querySelector(`.${app.slug}-related-queries`)){const t=dom.create.elem("div",{class:`${app.slug}-related-queries anchored-hidden`});app.div.append(t),e.forEach((e,n)=>{const a=dom.create.elem("div",{title:app.msgs.tooltip_sendRelatedQuery,tabindex:0,class:`${app.slug}-related-query fade-in no-user-select no-mobile-tap-outline`});a.textContent=e,a.prepend(icons.create({key:"arrowDownRight"})),t.append(a),setTimeout(()=>{a.classList.add("active"),a.onclick=a.onkeydown=e=>{if([" ","Spacebar","Enter","Return"].includes(e.key)||[32,13].includes(e.keyCode)||"click"==e.type){e.preventDefault();const t=app.div.querySelector("textarea");if(!t)return;const n=e.target.textContent;t.value=n,/\[[^[\]]+\]/.test(n)?(t.focus(),ui.addListeners.replySection.chatbarAutoSizer(),t.setSelectionRange(n.indexOf("["),n.indexOf("]")+1)):t.dispatchEvent(new KeyboardEvent("keydown",{key:"Enter",bubbles:!0,cancelable:!0}))}}},50*(n+1))}),replyBubble.updateMaxHeight(),get.related.replyIsQuestion=null}}else log.debug("Re-getting related queries to answer reply question..."),get.related.replyIsQuestion=!0,get.related(t).then(e=>show.related(e)).catch(e=>{log.error(e.message),api.tryNew(get.related)})},reply({content:e,standby:n=!1,apiUsed:a=null}){var o,s,i,r,p;show.reply.shareURL=null,tooltip.toggle("off");const l=app.div.querySelector("[id$=regen-btn]")?.firstChild;if(l?.style?.animation){l.style.animation=l.style.cursor="";const d=l.closest("btn");d.matches(":hover")&&d.dispatchEvent(new Event("mouseenter"))}if(!app.div.querySelector(".reply-pre")){app.div.textContent="",dom.addRisingParticles(app.div);const c=dom.create.elem("div",{class:"app-header",style:"margin: -8px 0 0 0"});app.div.append(c);const g=dom.create.elem("span",{id:"app-prefix",class:"no-user-select",style:"margin-right: -2px ; font-size: "+(env.browser.isMobile?"1.7rem":"1.1rem")});g.textContent="ðŸ¤– ",c.append(g);const m=t.googlegpt.create();m.width=env.browser.isMobile?177:env.browser.isFF?124:122,m.style.cssText=`position: relative ; top: ${env.browser.isMobile?4:env.browser.isFF?3:2}px`+(env.browser.isMobile?"; margin-left: 1px":"");const u=dom.create.anchor(app.urls.app,m);u.classList.add(`${app.slug}-name`,"no-user-select"),c.append(u);const b=dom.create.elem("div",{id:`${app.slug}-header-btns`,class:"no-mobile-tap-outline",style:"margin-top: 1px"});c.append(b),env.browser.isMobile||((o=dom.create.elem("btn",{id:`${app.slug}-chevron-btn`,class:`${app.slug}-header-btn anchored-only`,style:"margin: -3.5px 1px 0 11px"})).append(icons.create({key:"chevron"+(config.minimized?"Up":"Down"),size:22,style:"position: relative ; top: -1px"})),b.append(o));const h=dom.create.elem("btn",{id:`${app.slug}-about-btn`,class:`${app.slug}-header-btn`,style:`margin-top: ${env.browser.isMobile?.25:-.15}rem`});h.append(icons.create({key:"questionMarkCircle"})),b.append(h);const f=dom.create.elem("btn",{id:`${app.slug}-settings-btn`,class:`${app.slug}-header-btn`,style:`margin: ${env.browser.isMobile?6:0}px 10px 0 4.5px`});if(f.append(icons.create({key:"sliders",size:17})),b.append(f),n||((s=dom.create.elem("btn",{id:`${app.slug}-font-size-btn`,class:`${app.slug}-header-btn app-hover-only`,style:`margin: ${env.browser.isMobile?5:-2}px 9px 0 0`})).append(icons.create({key:"fontSize"})),b.append(s)),env.browser.isMobile||((i=dom.create.elem("btn",{id:`${app.slug}-pin-btn`,class:`${app.slug}-header-btn app-hover-only`,style:"margin: -1.55px 9.5px 0 0"})).append(icons.create({key:"pin",size:16.5,style:"position: relative ; top: 2px"})),b.append(i),(r=dom.create.elem("btn",{id:`${app.slug}-wsb-btn`,class:`${app.slug}-header-btn app-hover-only anchored-hidden`,style:"margin: -0.5px 12px 0 0"})).append(icons.create({key:"widescreen"+(config.widerSidebar?"Wide":"Tall")})),b.append(r),(p=dom.create.elem("btn",{id:`${app.slug}-arrows-btn`,class:`${app.slug}-header-btn app-hover-only anchored-only`,style:"margin: 0 11.5px 0 0"})).append(icons.create({key:"arrowsDiagonal"+(config.expanded?"In":"Out"),size:17})),b.append(p)),ui.addListeners.btns.appHeader(),!env.browser.isMobile){const y=dom.create.elem("span",{class:"byline no-user-select",textContent:"by "});y.append(dom.create.anchor(app.urls.publisher,"KudoAI")),c.querySelector(`.${app.slug}-name`).insertAdjacentElement("afterend",y),update.bylineVisibility()}if(n){const x=dom.create.elem("div",{class:`${app.slug}-standby-btns`,style:"will-change: transform"});["query","summarize"].forEach(e=>{const t={node:dom.create.elem("button",{class:`${app.slug}-standby-btn no-mobile-tap-outline`}),icon:icons.create({key:"query"==e?"send":"summarize"}),textSpan:dom.create.elem("span")};t.textSpan.textContent="query"==e?`${app.msgs.btnLabel_sendSearchQueryTo} ${app.name}`:app.msgs.tooltip_summarizeResults,t.node.onclick=()=>{show.reply.userInteracted=!0,show.reply.chatbarFocused=!1,app.msgChain.push({role:"user",content:"summarize"==e?prompts.create("summarizeResults"):new URL(location.href).searchParams.get("q")}),get.reply({msgs:app.msgChain,src:e})},t.node.append(t.icon,t.textSpan),x.append(t.node)}),app.div.append(x)}else replyBubble.insert()}if(!app.div.querySelector(`#${app.slug}-chatbar`)){const v=app.div.querySelector("section")||dom.create.elem("section");v.className.includes("loading")&&(v.textContent=v.className=v.style="");const w=dom.create.elem("form"),$=dom.create.elem("div"),k=dom.create.elem("textarea",{id:`${app.slug}-chatbar`,rows:1,placeholder:`${app.msgs[n?"placeholder_askSomethingElse":"tooltip_sendReply"]}...`});$.append(k),w.append($),v.append(w),app.div.querySelector(".reply-bubble, [class*=standby-btns]").after(v),["send","shuffle","summarize"].forEach((e,t)=>{if("summarize"==e&&app.div.querySelector("[class*=standby-btn]"))return;const n=dom.create.elem("button",{id:`${app.slug}-${e}-btn`,class:`${app.slug}-chatbar-btn no-mobile-tap-outline`});n.style.right=(0==t?3:1==t?-3:-5)+"px",n.append(icons.create({key:e,size:"send"==e?14:18})),$.append(n)}),app.footer=app.div.querySelector("footer")||dom.create.elem("footer"),app.footer.append(app.footerContent),app.div.querySelector("footer")||app.div.append(app.footer),ui.addListeners.replySection(),env.browser.isMobile&&show.reply.userInteracted&&(document.body.scrollTop=0,document.documentElement.scrollTop=0)}if(!n){if(!show.reply.updatedAPIinHeader){show.reply.updatedAPIinHeader=!0;const C=app.div.querySelector(".reply-header-txt"),z=dom.create.elem("span",{class:"api-btn",style:"cursor: pointer",textContent:"â¦¿"});function _(e,t,{speed:n=1}={}){t.textContent="";let a=0;!function o(){a<e.length&&(t.textContent+=e[a],a++,setTimeout(o,50/n))}()}z.onmouseenter=z.onmouseleave=z.onclick=menus.hover.toggle,z.style.pointerEvents=config.proxyAPIenabled?"":"none",C.replaceChildren(z,` API ${app.msgs.componentLabel_used}: `,dom.create.elem("b")),setTimeout(()=>_(a,C.lastChild,{speed:1.5}),150)}const S=app.div.querySelector(".reply-pre");try{S.innerHTML=marked.parse(e)}catch(A){log.error(A.message)}hljs.highlightAll(),S.querySelectorAll("code").forEach(e=>{e.innerHTML=e.innerHTML.replace(/;\s*/g,";<br>")}),update.replyPrefix(),[S,...S.querySelectorAll("*")].forEach(e=>renderMathInElement(e,{delimiters:app.katexDelimiters,throwOnError:!1})),config.stickySidebar&&replyBubble.updateMaxHeight(),config.autoScroll&&!env.browser.isMobile&&config.proxyAPIenabled&&!config.streamingDisabled&&(config.stickySidebar||config.anchored?S.scrollTop=S.scrollHeight:scrollBy({top:app.div.querySelector(`#${app.slug}-chatbar`).getBoundingClientRect().bottom-innerHeight+13}))}show.reply.chatbarFocused||env.browser.isMobile||!(!config.autoFocusChatbarDisabled&&(config.anchored||app.div.offsetHeight<innerHeight-app.div.getBoundingClientRect().top)||config.autoFocusChatbarDisabled&&config.anchored&&show.reply.userInteracted)||(app.div.querySelector(`#${app.slug}-chatbar`).focus(),show.reply.chatbarFocused=!0),config.anchored&&update.appBottomPos(),update.chatbarWidth(),show.reply.userInteracted=!1}},window.fontSizeSlider={fadeInDelay:5,hWheelDistance:10,createAppend(){function e(e){const a=t.offsetWidth-n.offsetWidth;e<0&&(e=0),e>a&&(e=a),n.style.left=e+"px";const o=app.div.querySelector(".reply-pre"),s=e/a,i=config.minFontSize+s*(config.maxFontSize-config.minFontSize);o.style.fontSize=i+"px",o.style.lineHeight=i*config.lineHeightRatio+"px",settings.save("fontSize",i),n.title=Math.floor(10*config.fontSize)/10+"px"}fontSizeSlider.cursorOverlay=dom.create.elem("div",{class:"cursor-overlay"});const t=dom.create.elem("div",{id:`${app.slug}-font-size-slider-track`,class:"fade-in-less",style:"display: none"}),n=dom.create.elem("div",{title:Math.floor(10*config.fontSize)/10+"px",id:`${app.slug}-font-size-slider-thumb`}),a=dom.create.elem("div",{id:`${app.slug}-font-size-slider-tip`});t.append(n,a),app.div.insertBefore(t,app.div.querySelector(`.${app.slug}-tooltip,.reply-bubble`)),setTimeout(()=>{const e=(config.fontSize-config.minFontSize)/(config.maxFontSize-config.minFontSize)*(t.offsetWidth-n.offsetWidth);n.style.left=e+"px"},fontSizeSlider.fadeInDelay);let o,s,i=!1;return n.addEventListener(inputEvents.down,e=>{0==e.button&&(e.preventDefault(),i=!0,o=e.clientX,s=n.offsetLeft,document.body.append(fontSizeSlider.cursorOverlay))}),document.addEventListener(inputEvents.move,({clientX:t})=>{i&&e(s+t-o)}),document.addEventListener(inputEvents.up,()=>{i=!1,fontSizeSlider.cursorOverlay?.isConnected&&fontSizeSlider.cursorOverlay.remove()}),env.browser.isMobile||(t.onwheel=t=>{t.preventDefault(),e(n.offsetLeft-Math.sign(t.deltaY)*fontSizeSlider.hWheelDistance)}),t.addEventListener(inputEvents.down,a=>{if(0!=a.button)return;a.preventDefault();const r=a.clientX||a.touches?.[0]?.clientX;e(r-t.getBoundingClientRect().left-n.offsetWidth/2),i=!0,o=r,s=n.offsetLeft,document.body.append(fontSizeSlider.cursorOverlay)}),t},toggle(e=""){const t=document.getElementById(`${app.slug}-font-size-slider-track`)||fontSizeSlider.createAppend(),n=app.div.querySelector(".reply-tip"),a=document.getElementById(`${app.slug}-font-size-slider-tip`);if("on"==e||!e&&"none"==t.style.display){const e=document.getElementById(`${app.slug}-font-size-btn`),o={appDiv:app.div.getBoundingClientRect(),btnSpan:e.getBoundingClientRect()};a.style.right=o.appDiv.right-(o.btnSpan.left+o.btnSpan.right)/2-35.5+"px",t.style.display=a.style.display="",n&&(n.style.display="none"),setTimeout(()=>t.classList.add("active"),fontSizeSlider.fadeInDelay)}else("off"==e||!e&&"none"!=t.style.display)&&(t.classList.remove("active"),n&&(n.style.display=""),a.style.display=t.style.display="none")}};const t={googlegpt:{create(){const e=dom.create.elem("img",{id:`${app.slug}-logo`,class:"no-mobile-tap-outline"});return t.googlegpt.update(e),e},update(...e){(e=e.flat()).length||(e=document.querySelectorAll(`#${app.slug}-logo`)),e.forEach(e=>e.src=GM_getResourceText(`ggpt${"dark"==env.ui.app.scheme?"DS":"LS"}logo`))}}};if(window.modals={stack:[],class:`${app.slug}-modal`,about(){const e="text-transform: uppercase ; font-size: 16px ; font-weight: bold ;color: "+("dark"==env.ui.app.scheme?"white":"#494141"),n=modals.alert(`${app.symbol} ${app.msgs.appName}`,`<span style="${e}">ðŸ§  ${app.msgs.about_author}:</span> <a href="${app.author[0].url}" target="_blank" rel="nopener">${app.author[0].name}</a> ${app.msgs.about_and} <a href="${app.urls.contributors}" target="_blank" rel="nopener">${app.msgs.about_contributors}</a>\n<span style="${e}">ðŸ·ï¸ ${app.msgs.about_version}:</span> <span class="about-em">${app.version}</span>\n<span style="${e}">ðŸ“œ ${app.msgs.about_openSourceCode}:</span> <a href="${app.urls.github}" target="_blank" rel="nopener">`+app.urls.github+"</a>\n"+`<span style="${e}">ðŸš€ ${app.msgs.about_latestChanges}:</span> `+`<a href="${app.urls.github}/commits" target="_blank" rel="nopener">`+`${app.urls.github}/commits</a>\n`+`<span style="${e}">âš¡ ${app.msgs.about_poweredBy}:</span> `+`<a href="${app.urls.chatgptjs}" target="_blank" rel="noopener">chatgpt.js</a>`+` v${app.chatgptjsVer}`,[function(){userscript.updateCheck()},function(){},function(){},function(){}],"",629),a=t.googlegpt.create();return a.width=405,a.style.cssText=`max-width: 98% ; margin: 15px ${env.browser.isMobile?"auto":"14.5%"} -1px`,n.firstChild.nextSibling.before(a),n.querySelector("h2").remove(),n.querySelector("p").style.cssText="\n                overflow-wrap: anywhere ; line-height: 1.55 ;\n                margin: "+(env.browser.isCompact?"21px 0 -20px":"15px 0 -28px 17px"),n.querySelectorAll("button").forEach(e=>{e.style.cssText="height: 50px ; min-width: 136px",/support|rate|extensions/i.test(e.textContent)&&(e.replaceWith(e=e.cloneNode(!0)),e.onclick=()=>modals.safeWinOpen(e.textContent.includes(app.msgs.btnLabel_getSupport)?app.urls.support:app.urls.relatedExtensions)),/updates/i.test(e.textContent)?e.textContent=`ðŸš€ ${app.msgs.btnLabel_checkForUpdates}`:/support/i.test(e.textContent)?e.textContent=`ðŸ§  ${app.msgs.btnLabel_getSupport}`:/rate/i.test(e.textContent)?e.textContent=`â­ ${app.msgs.btnLabel_rateUs}`:/extensions/i.test(e.textContent)?e.textContent=`ðŸ¤– ${app.msgs.btnLabel_moreAIextensions}`:e.style.display="none"}),n},alert(e="",t="",n="",a="",o=""){const s=chatgpt.alert(e,t,n,a,o),i=document.getElementById(s).firstChild;return this.init(i),i},api(){const e=[app.msgs.menuLabel_random,...Object.keys(apis).filter(e=>"OpenAI"!=e)].map(e=>{function t(){if(settings.save("preferredAPI",e!=app.msgs.menuLabel_random&&e),modals.settings.get()){const t=document.querySelector("[id*=preferredAPI] > span");t.textContent!=e&&(t.textContent=e)}feedback.notify(`${app.msgs.menuLabel_preferred} API ${app.msgs.menuLabel_saved.toLowerCase()}`,(config.anchored?"top":"bottom")+"-right"),app.div.querySelector(`.${app.slug}-alert`)&&config.proxyAPIenabled&&get.reply({msgs:app.msgChain,src:get.reply.src})}return Object.defineProperty(t,"name",{value:e.toLowerCase()}),t}),t=modals.alert(`${app.msgs.menuLabel_preferred} API:`,"",e,"",503);t.querySelector("h2").style.justifySelf="center";const n=t.querySelector(".modal-buttons");return n.style.cssText="margin: 18px 0px 4px !important ; "+(env.browser.isCompact?"":"flex-wrap: wrap ; justify-content: center ; gap: 9px"),n.querySelectorAll("button").forEach((e,t)=>{0==t?e.style.display="none":e.classList.toggle("primary-modal-btn",config.preferredAPI&&config.preferredAPI.toLowerCase()==e.textContent.toLowerCase()||e.textContent==app.msgs.menuLabel_random&&!config.preferredAPI)}),t},handlers:{dismiss:{click(e){const t=e.target,n=document.querySelector(`#${app.slug}-settings > img`);if(n){const t=n.getBoundingClientRect();if(e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom)return}(t==e.currentTarget||t.closest("[class*=-close-btn]"))&&modals.hide((t.closest("[class*=-modal-bg]")||t).firstChild)},key(e){(e.key.startsWith("Esc")||27==e.keyCode)&&modals.hide(document.querySelector("[class$=-modal]"))}},drag:{mousedown(e){if(0!=e.button||!/auto|default/.test(getComputedStyle(e.target).cursor)||e.target.closest("ul"))return;modals.draggingModal=e.currentTarget,e.preventDefault(),Object.assign(modals.draggingModal.style,{transform:"scale(1.05)",transition:"0.1s","-webkit-transition":"0.1s","-moz-transition":"0.1s","-o-transition":"0.1s","-ms-transition":"0.1s"}),document.body.style.cursor="grabbing",[...modals.draggingModal.children].forEach(e=>e.style.pointerEvents="none"),["mousemove","mouseup"].forEach(e=>document.addEventListener(e,modals.handlers.drag[e]));const t=modals.draggingModal.getBoundingClientRect();modals.handlers.drag.offsetX=e.clientX-t.left+21,modals.handlers.drag.offsetY=e.clientY-t.top+12},mousemove(e){if(modals.draggingModal){const t=e.clientX-modals.handlers.drag.offsetX,n=e.clientY-modals.handlers.drag.offsetY;Object.assign(modals.draggingModal.style,{left:`${t}px`,top:`${n}px`})}},mouseup(){Object.assign(modals.draggingModal.style,{cursor:"inherit",transform:"scale(1)",transition:"inherit","-webkit-transition":"inherit","-moz-transition":"inherit","-o-transition":"inherit","-ms-transition":"inherit"}),document.body.style.cursor="",[...modals.draggingModal.children].forEach(e=>e.style.pointerEvents=""),["mousemove","mouseup"].forEach(e=>document.removeEventListener(e,modals.handlers.drag[e])),modals.draggingModal=null}}},hide(e){const t=e?.parentNode;t&&(t.style.animation="modal-zoom-fade-out 0.165s ease-out",t.onanimationend=()=>t.remove())},init(e){this.stylize(),e.classList.add("no-user-select",this.class),e.parentNode.classList.add(`${this.class}-bg`),e.onwheel=e.ontouchmove=e=>e.preventDefault(),e.onmousedown=this.handlers.drag.mousedown,e.parentNode.className.includes("chatgpt-modal")||[e.parentNode,e.querySelector("[class*=-close-btn]")].forEach(e=>e.onclick=this.handlers.dismiss.click),dom.addRisingParticles(e),setTimeout(()=>{e.parentNode.style.backgroundColor=`rgba(67,70,72,${"dark"==env.ui.app.scheme?.62:.33})`,e.parentNode.classList.add("animated")},100)},observeRemoval(e,t,n){const a=e.parentNode;new MutationObserver(([e],o)=>{e.removedNodes.forEach(e=>{if(e==a){if(modals.stack[0].includes(n||t)){modals.stack.shift();const e=modals.stack[0];e&&(modals.stack.shift(),modals.open(e))}o.disconnect()}})}).observe(a.parentNode,{childList:!0,subtree:!0})},open(e,t){const n=t?modals[e][t]():(modals[e].show||modals[e])();n&&("prompt"!=settings.controls[e]?.type&&(this.stack.unshift(t?`${e}_${t}`:e),log.debug(`Modal stack: ${JSON.stringify(modals.stack)}`)),this.init(n),this.observeRemoval(n,e,t),modals.handlers.dismiss.key.added||(document.addEventListener("keydown",modals.handlers.dismiss.key),modals.handlers.dismiss.key.added=!0))},replyLang(){let e=prompt(`${app.msgs.prompt_updateReplyLang}:`,config.replyLang);null!=e&&(/\d/.test(e)||(e=e.length<4||e.includes("-")?e.toUpperCase():log.toTitleCase(e),settings.save("replyLang",e||env.browser.language),modals.alert(`${app.msgs.alert_langUpdated}!`,`${app.name} ${app.msgs.alert_willReplyIn} ${e||app.msgs.alert_yourSysLang}.`,"","",330),modals.settings.get()&&(document.querySelector("#replyLang-settings-entry span").textContent=e)))},safeWinOpen(e){open(e,"_blank","noopener")},scheme(){const e=modals.alert(`${app.name} ${app.msgs.menuLabel_colorScheme.toLowerCase()}:`,"",[function(){},function(){},function(){}]);e.querySelector("h2").style.justifySelf="center",e.querySelector(".modal-buttons").style.cssText="\n                justify-content: center ; margin: 20px 0 9px !important";const t={light:"â˜€ï¸",dark:"ðŸŒ˜",auto:"ðŸŒ—"};return e.querySelectorAll("button").forEach(n=>{const a=n.textContent.toLowerCase();n.classList.toggle("primary-modal-btn",config.scheme==n.textContent.toLowerCase()||"Auto"==n.textContent&&!config.scheme),Object.prototype.hasOwnProperty.call(t,a)?n.textContent=`${t[a]} ${app.msgs["scheme_"+a]||app.msgs["menuLabel_"+a]||a.toUpperCase()}`:n.style.display="none",n.replaceWith(n=n.cloneNode(!0)),n.onclick=()=>{const t="auto"==a?ui.getScheme():a;settings.save("scheme","auto"!=a&&t),e.querySelectorAll("button").forEach(e=>e.classList.remove("primary-modal-btn")),n.classList.add("primary-modal-btn"),n.style.cssText="pointer-events: none",setTimeout(()=>{n.style.pointerEvents="auto"},100),update.scheme(t),function(e){feedback.notify(`${app.msgs.menuLabel_colorScheme}: ${("light"==e?app.msgs.scheme_light||"Light":"dark"==e?app.msgs.scheme_dark||"Dark":app.msgs.menuLabel_auto).toUpperCase()}`);const t=document.querySelectorAll(".chatgpt-notif");t[t.length-1].append(icons.create({key:"light"==e?"sun":"dark"==e?"moon":"arrowsCyclic",style:"width: 23px ; height: 23px ; position: relative ; top: 1px ; margin-left: 6px"}))}(a)}}),e},settings:{createAppend(){const e=dom.create.elem("div"),t=dom.create.elem("div",{id:`${app.slug}-settings`});e.append(t);const n=Object.keys(settings.controls).filter(e=>!(env.browser.isMobile&&0==settings.controls[e].mobile)),a=icons.googlegpt.create();a.style.cssText+=`width: ${env.browser.isCompact?64:65}px ;\n                                               margin: 13px 0 ${env.browser.isCompact?"-35":"-27"}px ;\n                                               position: relative ; top: -42px ; ${env.browser.isCompact?"left: 6px":""}`;const o=dom.create.elem("div",{id:`${app.slug}-settings-title`}),s=icons.create({key:"sliders"}),i=dom.create.elem("h4",{textContent:app.msgs.menuLabel_settings});s.style.cssText+="\n                    width: 21px ; height: 21px ; position: relative ; top: 2.5px ; right: 12px",i.prepend(s),o.append(i);const r=[],p=dom.create.elem("div"),l=env.browser.isMobile&&(env.browser.isCompact||n.length<8)?1:2,d=Math.floor(n.length/2);for(let e=0;e<l;e++)r.push(dom.create.elem("ul"));p.style.width="95%",l>1&&(p.style.cssText+="display: flex ; padding: 11px 0 13px ; gap: 15px",r[0].style.cssText="padding-right: 15px"),n.forEach((e,t)=>{const n=settings.controls[e],a=dom.create.elem("li",{id:`${e}-settings-entry`,title:n.helptip||""}),o=dom.create.elem("label",{textContent:n.label});a.append(o),r[env.browser.isCompact?0:+(t>=d)].append(a);const s=icons.create({key:n.icon});if(s.style.cssText="position: relative ;"+(/proxy/i.test(e)?"top: 3px ; left: -0.5px ; margin-right: 9px":/preferred/i.test(e)?"top: 3.5px ; margin-right: 7.5px":/streaming/i.test(e)?"top: 3px ; left: 0.5px ; margin-right: 9px":/auto(?:get|focus)/i.test(e)?"top: 4.5px ; margin-right: 7px":/summarize/i.test(e)?"top: 3.5px ; left: -5px ; margin-right: 3px ; height: 17.5px":/autoscroll/i.test(e)?"top: 3.5px ; left: -1.5px ; margin-right: 6px":/^rq/.test(e)?"top: 2.5px ; left: 0.5px ; margin-right: 9px ; transform: scaleY(-1)":/prefix/i.test(e)?"top: 2.5px ; left: 0.5px ; margin-right: 9px":/suffix/i.test(e)?"top: 4px ; left: -1.5px ; margin-right: 7px":/sidebar/i.test(e)?"top: 4px ; left: -1.5px ; margin-right: 7.5px":/anchor/i.test(e)?"top: 3px ; left: -2.5px ; margin-right: 5.5px":/animation/i.test(e)?"top: 3px ; left: -1.5px ; margin-right: 6.5px":/replylang/i.test(e)?"top: 3px ; left: -1.5px ; margin-right: 9px":/scheme/i.test(e)?"top: 2.5px ; left: -1.5px ; margin-right: 8px":/debug/i.test(e)?"top: 3.5px ; left: -1.5px ; margin-right: 8px":/about/i.test(e)?"top: 3px ; left: -3px ; margin-right: 5.5px":""),a.prepend(s),e.includes("Animation")&&(s[(e.startsWith("fg")?"last":"first")+"Child"].style.fill="none"),"toggle"==n.type){const t=dom.create.elem("input",{type:"checkbox",disabled:!0,style:"display: none"});t.checked=settings.typeIsEnabled(e)&&!("streamingDisabled"==e&&!config.proxyAPIenabled);const n=dom.create.elem("span",{class:"track"}),o=dom.create.elem("span",{class:"knob"});n.append(o),a.append(t,n),setTimeout(()=>modals.settings.toggle.updateStyles(t),155),a.onclick=()=>{("streamingDisabled"!=e||env.scriptManager.supportsStreaming&&config.proxyAPIenabled)&&modals.settings.toggle.switch(t);const n=/get|summarize/i.exec(e),a=/(?:suf|pre)fix/i.exec(e);e.includes("proxy")?toggle.proxyMode():e.includes("streaming")?toggle.streaming():e.includes("rq")?toggle.relatedQueries():n?toggle.autoGen(n[0].toLowerCase()):a?toggle.manualGen(a[0].toLowerCase()):e.includes("Sidebar")?toggle.sidebar(e.replace("Sidebar","")):e.includes("anchor")?toggle.anchorMode():e.includes("bgAnimation")?toggle.animations("bg"):e.includes("fgAnimation")?toggle.animations("fg"):(settings.save(e,!config[e]),feedback.notify(`${settings.controls[e].label} ${menus.toolbar.state.words[+(e.includes("Disabled")!=config[e])]}`))}}else{a.classList.add("active");const t=dom.create.elem("span",{style:"float: right ; font-size: 11px ; margin-top: 3px ;"+("about"!=e?"text-transform: uppercase !important":"")});({about:()=>{const e=dom.create.elem("div"),n="&emsp;&emsp;&emsp;&emsp;&emsp;";modals.settings.aboutContent={short:`v${GM_info.script.version}`,long:`${app.msgs.about_version}: <span class="about-em">v${GM_info.script.version+n}</span>${app.msgs.about_poweredBy} <span class="about-em">chatgpt.js</span>${n}`};for(let e=0;e<7;e++)modals.settings.aboutContent.long+=modals.settings.aboutContent.long;e.innerHTML=modals.settings.aboutContent[config.fgAnimationsDisabled?"short":"long"],e.style.float=config.fgAnimationsDisabled?"right":"",t.append(e),a.onclick=()=>modals.open("about")},preferredAPI:()=>{t.textContent=config.preferredAPI||app.msgs.menuLabel_random,a.onclick=()=>modals.open("api"),a.classList.toggle("active",config.proxyAPIenabled),a.style.pointerEvents=config.proxyAPIenabled?"":"none"},replyLang:()=>{t.textContent=config.replyLang,a.onclick=()=>modals.open("replyLang")},scheme:()=>{modals.settings.updateSchemeStatus(t),a.onclick=()=>modals.open("scheme")}})[e]?.(),a.append(t)}}),p.append(...r);const c=dom.create.elem("div",{title:app.msgs.tooltip_close,class:`${app.slug}-modal-close-btn no-mobile-tap-outline`});return c.append(icons.create({key:"x",size:11})),t.append(a,o,c,p),document.body.append(e),e},get:()=>document.getElementById(`${app.slug}-settings`),show(){modals.settings.stylize();const e=modals.settings.get()?.parentNode||modals.settings.createAppend();if(e.style.display="",env.browser.isCompact){const t=e.querySelector(`#${app.slug}-settings`);modals.settings.scaleRatio||=.93*innerWidth/t.scrollWidth,t.style.transform=`scale(${modals.settings.scaleRatio})`}return e.firstChild},stylize(){const{scheme:e}=env.ui.app;this.styles?.isConnected||document.head.append(this.styles||=dom.create.style()),this.styles.textContent=`\n                    #${app.slug}-settings {\n                        min-width: ${env.browser.isCompact?288:698}px ; max-width: 75vw ; word-wrap: break-word ;\n                        margin: 12px 23px ; border-radius: 15px ;\n                        ${"dark"==e?"stroke: white ; fill: white":"stroke: black ; fill: black"};\n                      --shadow: 0 30px 60px rgba(0,0,0,0.12) ; box-shadow: var(--shadow) ;\n                           -webkit-box-shadow: var(--shadow) ; -moz-box-shadow: var(--shadow)\n                    }\n                    #${app.slug}-settings-title {\n                        font-weight: bold ; line-height: 19px ; text-align: center ;\n                        margin: 0 -6px ${env.browser.isCompact?2:-15}px 0\n                    }\n                    #${app.slug}-settings-title h4 {\n                        font-size: ${env.browser.isCompact?22:29}px ; font-weight: bold ;\n                        margin: 0 0 ${env.browser.isCompact?9:27}px\n                    }\n                    #${app.slug}-settings ul {\n                        align-content: center ; /* for symmetrized gaps when odd num of entries */\n                        list-style: none ; padding: 0 ; margin-bottom: 2px ; /* hide bullets, close bottom gap */\n                        width: ${env.browser.isCompact?100:50}% /* set width based on column cnt */\n                    }\n                    ${env.browser.isCompact?"":`#${app.slug}-settings ul:first-of-type { /* color desktop middle sep */\n                        border-right: 1px dotted ${"dark"==e?"white":"black"}}`}\n                    #${app.slug}-settings li {\n                        color: ${"dark"==e?"rgb(255,255,255,0.65)":"rgba(0,0,0,0.45)"};\n                        fill: ${"dark"==e?"rgb(255,255,255,0.65)":"rgba(0,0,0,0.45)"};\n                        stroke: ${"dark"==e?"rgb(255,255,255,0.65)":"rgba(0,0,0,0.45)"};\n                        height: 24px ; padding: 6px 10px ; font-size: 13.5px ;\n                        border-bottom: 1px dotted ${"dark"==e?"white":"black"}; /* add separators */\n                        border-radius: 3px ; /* slightly round highlight strip */\n                        ${config.fgAnimationsDisabled||env.browser.isMobile?"":"transition: var(--settings-li-transition) ;\n                                -webkit-transition: var(--settings-li-transition) ;\n                                -moz-transition: var(--settings-li-transition) ;\n                                -o-transition: var(--settings-li-transition) ;\n                                -ms-transition: var(--settings-li-transition)"}\n                    }\n                    #${app.slug}-settings li.active {\n                        color: ${"dark"==e?"rgb(255,255,255)":"rgba(0,0,0)"};\n                        fill: ${"dark"==e?"rgb(255,255,255)":"rgba(0,0,0)"};\n                        stroke: ${"dark"==e?"rgb(255,255,255)":"rgba(0,0,0)"}\n                    }\n                    #${app.slug}-settings li label { padding-right: 20px } /* right-pad labels so toggles don't hug */\n                    #${app.slug}-settings li:last-of-type { border-bottom: none } /* remove last bottom-border */\n                    #${app.slug}-settings li, #${app.slug}-settings li label { cursor: pointer } /* add finger on hover */\n                    #${app.slug}-settings li:hover {\n                        background: rgba(100,149,237,0.88) ; color: white ; fill: white ; stroke: white ;\n                        ${env.browser.isMobile?"":"transform: scale(1.15)"}\n                    }\n                    #${app.slug}-settings li > input { float: right } /* pos toggles */\n                    #${app.slug}-settings li > .track {\n                        position: relative ; left: -1px ; bottom: -5.5px ; float: right ;\n                        background-color: #ccc ; width: 26px ; height: 13px ; border-radius: 28px ;\n                        ${config.fgAnimationsDisabled?"":"transition: 0.4s ; -webkit-transition: 0.4s ; -moz-transition: 0.4s ;\n                                -o-transition: 0.4s ; -ms-transition: 0.4s"}\n                    }\n                    #${app.slug}-settings li .knob {\n                        position: absolute ; left: 1px ; bottom: 1px ; content: "" ;\n                        background-color: white ; width: 11px ; height: 11px ; border-radius: 28px ;\n                        ${config.fgAnimationsDisabled?"":"transition: 0.2s ; -webkit-transition: 0.2s ; -moz-transition: 0.2s ;\n                                -o-transition: 0.2s ; -ms-transition: 0.2s"}\n                    }\n                    #scheme-settings-entry > span { margin: 3px -2px 0 } /* align Scheme status */\n                    #scheme-settings-entry > span > svg { /* v-align/left-pad Scheme status icon */\n                        position: relative ; top: 2px ; margin-left: 4px }\n                    ${config.fgAnimationsDisabled?"":"#scheme-settings-entry svg[class*=arrowsCyclic],\n                                .chatgpt-notif svg[class*=arrowsCyclic] { animation: rotate 5s linear infinite }"}\n                    #about-settings-entry span { color: ${"dark"==e?"#28ee28":"green"}}\n                    #about-settings-entry > span { /* outer About status span */\n                        width: ${env.browser.isCompact?"15vw":"95px"}; height: 20px ; overflow: hidden ;\n                        ${env.browser.isCompact?"position: relative ; bottom: 3px ;":""} /* v-align */\n                        ${config.fgAnimationsDisabled?"":"mask-image: linear-gradient(\n                                    to right, transparent, black 20%, black 89%, transparent) ;\n                        -webkit-mask-image: linear-gradient(\n                                    to right, transparent, black 20%, black 89%, transparent) ;"}\n                    }\n                    #about-settings-entry > span > div {\n                        text-wrap: nowrap ;\n                        ${config.fgAnimationsDisabled?"":"animation: ticker linear 75s infinite"}\n                    }\n                    @keyframes ticker { 0% { transform: translateX(100%) } 100% { transform: translateX(-2000%) }}\n                    .about-em { color: ${"dark"==e?"white":"green"} !important }`},toggle:{switch(e){e.checked=!e.checked,modals.settings.toggle.updateStyles(e)},updateStyles(e){const t=e.parentNode,n=t.querySelector("span"),a=n.querySelector("span");requestAnimationFrame(()=>{n.style.backgroundColor=e.checked?"#ad68ff":"#ccc",n.style.boxShadow=e.checked?"2px 1px 9px #d8a9ff":"none",a.style.transform=e.checked?"translateX(14px) translateY(0)":"translateX(0)",t.classList.toggle("active",e.checked)})}},updateSchemeStatus(e=null){e||=document.querySelector("#scheme-settings-entry span"),e&&(e.textContent="",e.append(document.createTextNode(app.msgs[/dark|light/.test(config.scheme)?`scheme_${config.scheme}`:"menuLabel_auto"]),icons.create({size:12,key:"dark"==config.scheme?"moon":"light"==config.scheme?"sun":"arrowsCyclic"})))}},shareChat(e){const t=modals.alert(`${log.toTitleCase(app.msgs.btnLabel_convo)} ${app.msgs.tooltip_page} ${app.msgs.alert_generated.toLowerCase()}!`,`<a target="_blank" rel="noopener" href="${e}">${e}</a>`,[function(){navigator.clipboard.writeText(e).then(()=>feedback.notify(app.msgs.notif_copiedToClipboard))},function(){modals.safeWinOpen(e)},function(){xhr({method:"GET",url:e,onload:({responseText:e})=>{const t=dom.create.anchor(URL.createObjectURL(new Blob([e],{type:"text/html"})));t.download=e.match(/<title>([^<]+)<\/title>/i)[1].replace(/\s*[â€”|/]+\s*/g," ").replace(/\.{2,}/g,"").toLowerCase().trim().replace(/\s+/g,"-")+".html",document.body.append(t),t.click(),t.remove(),URL.revokeObjectURL(t.href)},onerror:e=>log.error("Failed to download chat:",e)})}]),n=t.querySelector("h2"),a=icons.create({key:"speechBalloons"});a.style.cssText="height: 23px ; width: 23px ; position: relative ; top: 5px ; right: 8px ;\n                                       fill: "+("dark"==env.ui.app.scheme?"white":"black"),n.prepend(a);const o=t.querySelectorAll("button");return o[0].style.display="none",env.browser.language.startsWith("en")||o.forEach(e=>{/copy/i.test(e.textContent)?e.textContent=`${app.msgs.tooltip_copy} URL`:/visit/i.test(e.textContent)?e.textContent=app.msgs.btnLabel_visitPage:/download/i.test(e.textContent)&&(e.textContent=`${app.msgs.btnLabel_download} ${log.toTitleCase(app.msgs.btnLabel_convo)}`)}),t.style.wordBreak="break-all",t.querySelector("h2").style.justifySelf="center",t.querySelector("p").style.cssText="text-align: center ; margin: 10px 0 -22px",t.querySelector(".modal-buttons").style.cssText="justify-content: center",t},stylize(){const{scheme:e}=env.ui.app;this.styles?.isConnected||document.head.append(this.styles||=dom.create.style()),this.styles.textContent=`:root {\n                  --modal-btn-zoom: scale(1.055) ; --modal-btn-transition: transform 0.15s ease ;\n                  --settings-li-transition: transform 0.1s ease ; /* for Settings entry hover-zoom */\n                  --fg-transition: opacity 0.65s cubic-bezier(0.165,0.84,0.44,1), /* fade-in */\n                                   transform 0.55s cubic-bezier(0.165,0.84,0.44,1) !important ; /* move-in */\n                  --bg-transition: background-color 0.25s ease !important } /* dim */@keyframes modal-zoom-fade-out {\n                    0% { opacity: 1 } 50% { opacity: 0.25 ; transform: scale(1.05) }\n                    100% { opacity: 0 ; transform: scale(1.35) }\n                }\n                .chatgpt-modal > div {\n                    background-color: white ; color: #202124 ;\n                    padding: ${env.browser.isCompact?"31px":"25px 31px"}!important\n                }\n                .chatgpt-modal p { margin: 14px 0 -29px 4px ; font-size: 1.28em ; line-height: 1.57 }\n                .modal-buttons {\n                    margin: 42px 4px ${env.browser.isMobile?"2px 4px":"-3px -4px"} !important ; width: 100% }\n                .chatgpt-modal button { /* this.alert() buttons */\n                    min-width: 113px ; padding: ${env.browser.isMobile?"5px":"4px 15px"} !important ;\n                    cursor: pointer ; border-radius: 0 !important ; height: 39px ;\n                    border: 1px solid ${"dark"==e?"white":"black"}!important }\n                .primary-modal-btn { background: black !important ; color: white !important }\n                .chatgpt-modal button:hover {\n                  --btn-shadow: ${"light"==e?"2px 1px 43px #00cfff70":"2px 1px 54px #00cfff"};\n                    color: inherit !important ; /* remove color hack */\n                    background-color: rgb(${"light"==e?"192 223 227 / 5%":"43 156 171 / 43%"}) !important\n                }\n                ${"dark"==e?".chatgpt-modal > div, .chatgpt-modal button:not(.primary-modal-btn) {\n                        color: white !important }\n                    .primary-modal-btn { background: #00cfff !important ; color: black !important }\n                    .chatgpt-modal a { color: #00cfff !important }":""}\n                .${modals.class} { display: grid ; place-items: center } /* for centered icon/logo */\n                [class*=modal-close-btn] {\n                    position: absolute !important ; float: right ; top: 14px !important ; right: 16px !important ;\n                    cursor: pointer ; width: 33px ; height: 33px ; border-radius: 20px\n                }\n                [class*=modal-close-btn] path {${"dark"==e?"stroke: white ; fill: white":"stroke: #9f9f9f ; fill: #9f9f9f"}}\n                ${"dark"==e?"[class*=modal-close-btn]:hover path { stroke: black ; fill: black }":""}\n                [class*=modal-close-btn]:hover { background-color: #f2f2f2 } /* hover underlay */\n                [class*=modal-close-btn] svg { margin: 11.5px } /* center SVG for hover underlay */\n                [class*=-modal] h2 {\n                    font-size: 1.65rem ; line-height: 32px ; padding: 0 ; margin: 9px 0 -3px !important ;\n                    ${env.browser.isMobile?"text-align: center":"justify-self: start"}} /* left-align on desktop */\n                [class*=-modal] p { justify-self: start ; font-size: 20px }\n                [class*=-modal] button {\n                    color: ${"dark"==e?"white":"black"}; font-size: 12px !important ; background: none }\n                [class*=-modal-bg] {\n                    pointer-events: auto ; /* override any disabling from site modals */\n                    position: fixed ; top: 0 ; left: 0 ; width: 100% ; height: 100% ; /* expand to full view-port */\n                    display: flex ; justify-content: center ; align-items: center ; z-index: 9999 ; /* align */\n                    transition: var(--bg-transition) ; /* dim */\n                       -webkit-transition: var(--bg-transition) ; -moz-transition: var(--bg-transition) ;\n                       -o-transition: var(--bg-transition) ; -ms-transition: var(--bg-transition) }\n                [class*=-modal-bg].animated > div {\n                    z-index: 13456 ; opacity: 0.98 ; transform: translateX(0) translateY(0) }\n                [class$=-modal] { /* native modals + chatgpt.alert()s */\n                    position: absolute ; /* to be click-draggable */\n                    opacity: 0 ; /* to fade-in */\n                    background-image: linear-gradient(180deg, ${"dark"==e?"#99a8a6 -200px, black 200px":"#b6ebff -296px, white 171px"}) ;\n                    border: 1px solid ${"dark"==e?"white":"#b5b5b5"} !important ;\n                    color: ${"dark"==e?"white":"black"};\n                    transform: translateX(-3px) translateY(7px) ; /* offset to move-in from */\n                    transition: var(--fg-transition) ; /* fade-in + move-in */\n                       -webkit-transition: var(--fg-transition) ; -moz-transition: var(--fg-transition) ;\n                       -o-transition: var(--fg-transition) ; -ms-transition:  var(--fg-transition) }\n                    ${env.browser.isMobile?"":"[class$=-modal] button:hover { transform: var(--modal-btn-zoom) }"}\n                    ${config.fgAnimationsDisabled?"":`[class$=-modal] button {\n                        ${env.browser.isMobile?"":"will-change: transform ;"}\n                        transition: var(--modal-btn-transition) ;\n                           -webkit-transition: var(--modal-btn-transition) ;\n                           -moz-transition: var(--modal-btn-transition) ;\n                           -o-transition: var(--modal-btn-transition) ;\n                           -ms-transition: var(--modal-btn-transition) }`}`},update:{width:377,available(){const e=modals.alert(`ðŸš€ ${app.msgs.alert_updateAvail}!`,`${app.msgs.alert_newerVer} ${app.name} (v${app.latestVer}) ${app.msgs.alert_isAvail}!  <a target="_blank" rel="noopener" style="font-size: 0.97rem" href="${app.urls.github}/commits/main/greasemonkey/${app.slug}.user.js">${app.msgs.link_viewChanges}</a>`,function(){modals.safeWinOpen(`${app.urls.update.gm}?t=${Date.now()}`)},"",modals.update.width);if(!env.browser.language.startsWith("en")){const t=e.querySelectorAll("button");t[1].textContent=app.msgs.btnLabel_update,t[0].textContent=app.msgs.btnLabel_dismiss}return e},unavailable:()=>modals.alert(`${app.msgs.alert_upToDate}!`,`${app.name} (v${app.version}) ${app.msgs.alert_isUpToDate}!`,"","",modals.update.width)}},menus.toolbar.register(),/udm=2(?:&|$)/.test(location.search))return log.debug("Exited from Google Images");env.ui={app:{scheme:config.scheme||ui.getScheme()},site:{hasSidebar:!!document.querySelector("[class*=kp-]"),scheme:ui.getScheme()}},app.div=dom.create.elem("div",{id:app.slug,class:"fade-in"}),themes.apply(config.theme),ui.addListeners.appDiv(),["anchored","expanded","sticky","wider"].forEach(e=>(config[e]||config[`${e}Sidebar`])&&app.div.classList.add(e)),update.appStyle(),["rpg","rpw"].forEach(e=>document.head.append(dom.create.style(GM_getResourceText(`${e}CSS`)))),app.centerCol=document.querySelector("#center_col")||document.querySelector("#main"),(env.browser.isMobile?app.centerCol:document.getElementById("rhs")||(()=>{const e=dom.create.elem("div");return app.centerCol.insertAdjacentElement("afterend",e),e})()).prepend(app.div),setTimeout(()=>app.div.classList.add("active"),100),/udm=50(?:&|$)/.test(location.search)?(toggle.anchorMode("on"),env.browser.isMobile||(dom.get.loadedElem(`#${app.slug}-pin-btn`).then(e=>e.style.display="none"),document.head.append(dom.create.style("li#anchored-settings-entry { display: none }")))):document.addEventListener(inputEvents.down,e=>{function t(e){if(!e.protocol.startsWith("http"))return;let t;if((e.hostname.startsWith("www.google.")||e.hostname==location.hostname)&&["/url","/local_url","/searchurl/rr.html","/linkredirect"].includes(e.pathname)){if(t=/[?&](?:q|url|dest)=((?:https?|ftp)[%:][^&]+)/.exec(e.search),t)return decodeURIComponent(t[1]);if(t=/[?&](?:q|url)=((?:%2[Ff]|\/)[^&]+)/.exec(e.search),t)return e.origin+decodeURIComponent(t[1]);if(t=/[#&]url=(https?[:%][^&]+)/.exec(e.hash),t)return decodeURIComponent(t[1])}return"googleweblight.com"==e.hostname&&"/fp"==e.pathname&&(t=/[?&]u=((?:https?|ftp)[%:][^&]+)/.exec(e.search),t)?decodeURIComponent(t[1]):void 0}let n=e.target;for(;n&&!n.href;)n=n.parentElement;if(!n)return;n.removeAttribute("ping"),n.getAttribute("onmousedown")?.includes("rwt(")&&(n.removeAttribute("onmousedown"),env.browser.isChrome&&e.stopImmediatePropagation());let a=t(n);a&&(n.href=a,a=t(n),a&&(n.href=a))},!0),setTimeout(()=>document.querySelectorAll('a[href^="https://www.amazon."]').forEach(e=>{const t=new URL(e.href);t.searchParams.set("tag","kudo-ai-20"),e.href=t.toString()}),1500),app.footerContent=dom.create.anchor(app.urls.discuss,app.msgs.link_shareFeedback),app.msgChain=[];const n=new URL(location.href).searchParams.get("q");config.autoGet||config.autoSummarize||(config.prefixEnabled||config.suffixEnabled)&&[config.prefixEnabled&&location.href.includes("q=%2F"),config.suffixEnabled&&/q=.*?(?:%3F|ï¼Ÿ|%EF%BC%9F)(?:&|$)/.test(location.href)].filter(Boolean).length==config.prefixEnabled+config.suffixEnabled?(app.msgChain.push({time:Date.now(),role:"user",content:config.autoSummarize?prompts.create("summarizeResults"):n}),get.reply({msgs:app.msgChain,src:"query"})):(show.reply({standby:!0}),config.rqDisabled||get.related(n).then(e=>show.related(e)).catch(e=>{log.error(e.message),api.tryNew(get.related)}));const a=new MutationObserver(()=>{const e=document.getElementById("rhs");e&&(e.prepend(app.div),a.disconnect())});a.observe(document.body,{subtree:!0,childList:!0}),setTimeout(()=>a.disconnect(),5e3)})();