// ==UserScript==
// @name Smoothscroll
// @author       Creec Winceptor
// @namespace https://greasyfork.org/users/3167
// @include     *
// @version 12
// @downloadURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/Smoothscroll.user.js
// @updateURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/Smoothscroll.meta.js
// ==/UserScript==
function e(e,o){if(null!=o)return e.scrollsubpixels=o,o;var l=e.scrollsubpixels;return null!=l?l:0}function o(o,l){if(null!=l)return o.scrollpixels=l,e(o,0),l;var n=o.scrollpixels;return null!=n?n:0}function l(t,r){var u,i,s,a,d,f,g,m=e(t),h=o(t);c.Debug>3&&console.log("scrollpixels: "+h),c.Debug>3&&(console.log("target: ",t),t==document.documentElement&&console.log("document.documentElement")),u=0,h>0&&(u=1),h<0&&(u=-1),i=h*(1-Math.pow(r,-1/(r*c.Smoothness))),Math.abs(h)>2?(f=m+(a=i-(s=Math.floor(Math.abs(i))*u))-(d=Math.floor(Math.abs(m+a))*u),o(t,h-s-d),e(t,f),g=s+d,c.Debug>1&&console.log("scrolldelta: "+g),t.style.scrollBehavior="auto",t.scrollTop=t.scrollTop+g,c.Debug>1&&console.log("target.scrollTop: "+t.scrollTop),t.scrollanimated=!0,n(function(e){l(t,e)})):(n(function(){o(t,0)}),t.scrollanimated=!1)}function n(e){var o=performance.now();window.requestAnimationFrame(()=>{var l=performance.now()-o,n=1e3/Math.max(l,1),t=Math.min(Math.max(n,c.MinRefreshrate),c.MaxRefreshrate);e(t)})}function t(e,o){var l,n;return document.body,l=function(e,o){if(o<0)return e.scrollTop>0;if(o>0){if(e==document.body){if(0==e.scrollTop){if(e.scrollTop=3,0==e.scrollTop)return!1;e.scrollTop=0}return Math.round(e.clientHeight+e.scrollTop)<e.offsetHeight}return Math.round(e.clientHeight+e.scrollTop)<e.scrollHeight}}(e,o),l?(n=function(e){if(e==window||e==document)return!1;if(e==document.body)return"hidden"!=window.getComputedStyle(document.body)["overflow-y"];if(e==document.documentElement)return window.innerWidth>document.documentElement.clientWidth;var o=window.getComputedStyle(e);return"hidden"!=o["overflow-y"]&&"visible"!=o["overflow-y"]}(e),n?(c.Debug>1&&(console.log("scrollablecheck: "+l),console.log("scrollbarcheck: "+n)),!0):(c.Debug>1&&console.log("scrollbarcheck: "+n),!1)):(c.Debug>1&&console.log("scrollablecheck: "+l),!1)}function r(e){return e.path?e.path:e.composedPath?e.composedPath():(c.Debug>1&&console.log("Smoothscroll: e.path is undefined"),null)}var c={Smoothness:.5,Acceleration:.5,Debug:0,Refreshrate:60,MaxRefreshrate:300,MinRefreshrate:1,Stop:function(e){e&&o(e,0)}};c.Start=function(e,n){e&&(o(e,n),e.scrollanimated||l(e,c.Refreshrate))},"undefined"!=typeof module&&(module.exports=c),!(window.top!=window.self||window.Smoothscroll&&window.Smoothscroll.Loaded)&&(window.requestAnimationFrame||(window.requestAnimationFrame=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame),document.documentElement.addEventListener("wheel",function(e){(function(e){var l=function(e){var o,l,n=e.deltaY,u=r(e);if(!u)return null;for(c.Debug>2&&(console.log("nodes: "),console.log(u),console.log("target: ")),o=0;o<u.length;o++)if(l=u[o],c.Debug>2&&console.log(l),t(l,n))return c.Debug>2&&console.log("true"),l;return c.Debug>1&&console.log("false"),null}(e);l&&function(e,l){var n,t,r,u,i,s,a;if(e.defaultPrevented)return!0;n=e.deltaY,c.Debug&&console.log("e: ",e),e.deltaMode&&1==e.deltaMode&&(t=function(e,o){var l;if(window.getComputedStyle){if(l=document.defaultView.getComputedStyle(e,null).getPropertyValue(o))return parseInt(l)}else if(e.currentStyle&&(l=e.currentStyle[o.encamel()]))return parseInt(l);return null}(l,"line-height"),c.Debug&&console.log("line: "+t),t&&t>0&&(n=e.deltaY*t)),e.deltaMode&&2==e.deltaMode&&(r=l.clientHeight,c.Debug&&console.log("page: "+r),r&&r>0&&(n=e.deltaY*r)),u=o(l),i=Math.sqrt(Math.abs(u/n*c.Acceleration)),a=u+n+(s=Math.round(n*i)),c.Debug&&(console.log("scrollpixels: "+u),console.log("delta: "+n),console.log("acceleration: "+s),console.log("totalscroll: "+a)),c.Start(l,a),e.preventDefault()}(e,l)})(e),c.Debug>0&&console.log(e)},{passive:!1}),document.documentElement.addEventListener("mousedown",function(e){(function(e){!function(e){var o,l,n=r(e);if(!n)return null;for(o=0;o<n.length;o++)l=n[o],c.Stop(l)}(e)})(e),c.Debug>0&&console.log(e)}),window.Smoothscroll=c,window.Smoothscroll.Loaded=!0,console.log("Smoothscroll: loaded"));