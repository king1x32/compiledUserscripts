// ==UserScript==
// @name         Pixeldrain Download Bypass
// @namespace    http://tampermonkey.net/
// @version      1.6.5
// @author       MegaLime0, honey, Nurarihyon
// @match        https://pixeldrain.com/*
// @match        https://pixeldrain.net/*
// @match        https://cdn.pd8.workers.dev/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=pixeldrain.com
// @grant        GM_openInTab
// @downloadURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/Pixeldrain20Download20Bypass.user.js
// @updateURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/Pixeldrain20Download20Bypass.meta.js
// ==/UserScript==
!function(){"use strict";function e(e){const t=window.location.href;if("file"==e){const e=t.replace(`${location.origin}/u/`,"");return n+e}if("gallery"==e){const e=document.querySelectorAll("a.file"),t=[],l=[];return e.forEach(e=>{const i=e.querySelector("div").style.backgroundImage.match(o);if(i&&i.length>1){const o=n+i[1];t.push(o),l.push(e.textContent)}}),{bypassUrlList:t,bypassUrlNames:l}}}function t(e){const t=document.createElement("a");t.href=e,t.download="",t.click()}const n="https://pd.1drv.eu.org/",o=/\/api\/file\/(\w+)\//;if(/pixeldrain\.(com|net)$/.test(window.location.hostname)){const n=document.createElement("button"),o=document.createElement("a");o.className="icon",o.textContent="download",o.style.color="#d7dde8";const l=document.createElement("span");l.textContent="Download Bypass",n.appendChild(o),n.appendChild(l);const i=document.createElement("button"),c=document.createElement("i");c.className="icon",c.textContent="link";const s=document.createElement("span");s.textContent="Show Bypass Links",i.appendChild(c),i.appendChild(s);const a=document.createElement("div");a.style.zIndex=20,a.style.whiteSpace="pre-line",a.id="popupBox",a.style.display="none",a.style.position="fixed",a.style.top="50%",a.style.left="50%",a.style.transform="translate(-50%, -50%)",a.style.padding="20px",a.style.background="#2f3541",a.style.border="2px solid #a4be8c",a.style.color="#d7dde8",a.style.borderRadius="10px",a.style.width="30%",a.style.height="90%",a.style.maxWidth="600px",n.addEventListener("click",function(){const n=window.location.href;n.includes(`${location.origin}/u/`)&&t(e("file")),n.includes(`${location.origin}/l/`)&&e("gallery").bypassUrlList.forEach(e=>{t(e)})}),i.addEventListener("click",function(){const t=document.getElementById("popupBox"),n=document.createElement("span");n.innerHTML="&times;",n.style.position="absolute",n.style.top="1px",n.style.right="7px",n.style.cursor="pointer",n.onclick=function(){t.style.display="none"},t.innerHTML="",t.appendChild(n);const o=window.location.href;if(o.includes(`${location.origin}/u/`)){const n=e("file"),o=document.createElement("a");o.href=n,o.textContent=n,t.appendChild(o)}if(o.includes(`${location.origin}/l/`)){let n=e("gallery"),o=n.bypassUrlList;n.bypassUrlNames;const l=document.createElement("div");l.style.maxHeight="calc(100% - 40px)",l.style.overflowY="auto",l.style.paddingBottom="10px",o.forEach(e=>{const t=document.createElement("a");t.href=e,t.textContent=e,t.style.display="block",l.appendChild(t)}),t.appendChild(l),t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.justifyContent="center";const i=document.createElement("div");i.style.display="flex",i.style.justifyContent="center",i.style.marginTop="10px";const c=document.createElement("button");c.textContent="🔗 Copy URL",c.style.marginRight="5px",c.addEventListener("click",function(){const e=o.join("\n");navigator.clipboard.writeText(e).then(function(){c.textContent="✔️ Copied",setTimeout(function(){c.textContent="🔗 Copy URL"},2500)},function(e){console.error("Failed to copy URLs: ",e)})}),i.appendChild(c);const s=document.createElement("button");s.textContent="📄 Save as Text File",s.style.marginLeft="5px",s.addEventListener("click",function(){const e=document.getElementById("popupBox").querySelectorAll("a");if(e.length>0){const t=window.location.href.match(/\/l\/([^/#?]+)/);if(t&&t.length>1){const n=t[1]+".txt";let o="";e.forEach(e=>{o+=e.href+"\n"});const l=new Blob([o.trim()],{type:"text/plain"}),i=URL.createObjectURL(l),c=document.createElement("a");c.href=i,c.download=n,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(i)}else console.error("Failed to extract file identifier from URL.")}else console.error("Popup content not found.")}),i.appendChild(s),t.appendChild(i)}t.style.display="block"}),document.querySelectorAll("div.label").forEach(e=>{if("Size"===e.textContent.trim()){const t=e.nextElementSibling;t&&(t.insertAdjacentElement("afterend",i),t.insertAdjacentElement("afterend",n))}}),document.body.appendChild(a)}}();