// ==UserScript==
// @name               Comic Looms
// @name:en            Comic Looms
// @namespace          https://github.com/MapoMagpie/comic-looms
// @version            4.12.9
// @author             MapoMagpie
// @license            MIT
// @icon               data:image/x-icon;base64,AAABAAEAQEAAAAEAIAAoQgAAFgAAACgAAABAAAAAgAAAAAEAIAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAADF2+r/xdzo/8Xc6P/F3Oj/xdzo/8Xc6P/F3Oj/xdzo/8Xc6P/F3Of/xdzn/8Xc5//F3Oj/xdzo/8Xc6P/F3Oj/xdzo/8Tb5//E2+f/xdzo/8Xc6P/F3Oj/xdzo/8Xc6P/F3Oj/xdzo/8Xc6P/F3Oj/xdzo/8Xc6P/F3Oj/xdzo/8Xc6P/F3Oj/xdzo/8Xc6P/E2+f/xNvn/8Xb6P/E3Of/xNvn/8Tb5//F3Oj/xdzo/8Xc6P/F3Oj/xdzo/8Xc6P/F3Oj/xNvn/8Tb5//E2+f/xNvn/8Xc6P/F3Oj/xdzo/8Xc6P/F3Oj/xdzo/8Xc6P/F3Oj/xdzo/8Xc6P/F3Oj/xdvp/8Xd5//F3eb/xd3m/8Xd5//F3ef/xd3n/8Xd5//F3ef/xd3n/8Xd5//F3ef/xd3n/8Xd5//F3eb/xd3m/8Xd5v/F3eb/xd3m/8Xe5//F3eb/xd3m/8Xd5v/F3eb/xd3m/8Xd5//F3eb/xd3m/8Xd5//F3eb/xd3m/8Xd5v/F3eb/xd3n/8Xd5//F3ef/xd3n/8Xd5//E3OX/w9vm/8Tc5//D2+X/wtvk/8Xd5//F3eb/xd3m/8Xd5v/F3eb/xd3m/8Xd5v/F3ef/xd3n/8Xe5v/F3uf/xd3m/8Xe5v/F3eb/xd3n/8Xd5v/F3eb/xd3n/8Xd5//F3ef/xdzo/8Xb6f/F3eb/xd7l/8Xe5f/D3uX/xN7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xN7l/8Te5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5P/F3uT/xd3k/8Xd5P/F3eT/xd3k/8Xd5P/E3OP/zeXr/9Dm6//N4uf/0uju/9Hq8f/H4On/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5v/F3ef/xd3n/8Xd6f/F2ur/xd3n/8Xe5f/E3uX/w97l/8Pe5f/F3uX/xN3k/8Xd5P/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uT/xd3k/8Xd5P/F3eT/xd3k/8Xd5P/F3eP/xN3j/8Td4//E3eT/xN3k/8Td5P/E3eT/xN3l/8Pe5f/D3ub/xN/n/8Tf6P/E4Oj/xOHp/8Xh6//F4Or/0ez2/5aquv9YZ4X/YXGQ/1Jbd/+LmKj/yd3l/8be5//F3uT/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/E3uX/xd7m/8Xd5//F3ej/xdrq/8Xd5//F3uX/xd7l/8Te5f/F3uX/xd7l/8ji6v/G4Oj/xN3l/8Tc5P/E3eT/xN3k/8Pd5f/E3uf/xN/o/8Tf6P/E3+r/xOHq/8bi7P/G4+z/x+Tu/8jl7v/J5e//y+Xv/8vl7v/M5e3/zeXs/87k6v/P4uj/z+Dj/9De3//O2dr/zdXV/8zRzv/IysX/xMK8/8rEvv+Ng4P/T2yk/01spv8ZKmj/DCBs/3yFmP/b8fj/w93p/8Td5f/E3eT/xd7l/8Td5P/E3eT/xN3k/8Xe5f/F3uX/xd7l/8Xe5f/E3uX/w97l/8Te5f/F3uX/xd7l/8Xe5f/F3ef/xd3n/8Xb6v/F3ef/xd7l/8Xe5f/F3uX/xt7m/8fd5P+6ztP/xNnd/8zj6f/N5/D/zubu/87l7P/O4+j/z+Hk/8/e3//O2tr/ztXU/8vQzv/Iy8f/xcS+/8K7tP+9s6v/uayj/7Okmv+unZL/p5WK/6CNg/+ZhXz/kn14/4p2dP+CcXT/e21y/3Rpcv9vZXL/aWRy/2Nhdf9hZH3/VFNn/0BSf/9JZqf/IjNy/x45jf9DP1f/tqid/9DT0P/P4+r/yePv/8Pd5v/G4Oj/yuTs/8rj6//D3eT/xN3k/8Xe5f/E3uX/w97l/8Te5f/F3uX/xd7l/8Xe5f/F3uX/xd3n/8Xd6P/F2ur/xd3n/8Xe5f/F3uX/w9zj/8/n7/+Il6v/QVF8/y07af9laHv/r6KZ/5+Ph/+Zh3//kH95/4l4dP+EdHT/fW9z/3drcv9yaXP/bGZ1/2Zjd/9fYHj/Wl99/1phg/9VYYf/UWGN/1BklP9PZpr/T2mi/01sqf9NcLD/UXS5/1F4vv9Te8P/VX3H/1eAzP9Ygc3/XojX/0lpr/8+Tnv/VXOv/yU1dv8eLWn/GiZT/y8zWP9uW2H/n4yE/8XAuf/V4uT/xNnf/7HEyf+2yM3/0eXq/8ri6f/E3eT/xd7l/8Te5f/E3uX/xd7l/8Xe5f/F3uX/xd7l/8Xd5//G3ef/xdrq/8Xd5//F3uX/xd7l/8Lb4//Q6e//gJGo/0dlqf8fOIf/GSNY/0ZRfv9RaKD/UWqi/1Bvq/9Rc7P/U3e8/1R7w/9Vf8j/V4HN/1qF0/9dh9b/XorZ/12K2/9hjN7/Y47f/2SQ3v9lk97/aJLg/2mT3/9pkt3/aJHd/2iR3f9pkdz/aJHa/2qR2v9pkdn/Z47X/2WN2P9IZrH/RVqK/1t8t/82S4n/HShZ/zdLi/8iNnf/FS99/x4ua/87Oln/alxk/0BGYf9DWpD/OUuC/0tTcv++0dr/x+Hp/8Td5P/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3ef/xt3o/8Xb6v/F3ef/xd7l/8Xe5f/D3OP/z+nv/5qruP9HZab/Ijp9/xcgUP9QcLf/apbl/2OO2/9kj9v/Y47a/2SP2v9jj9n/ZI3W/2OJ0v9hhs7/XILJ/1t/xP9ZfL//V3i7/1Rzs/9TcK7/T2yo/0tnof9GYZr/Q1qT/z9Vi/86T4P/OEp7/zVEdP8xQG3/LDpl/ys1Xv8pMlj/ICJD/zE8Xv9KYpX/MEN2/x8rV/8fLl7/IzBq/yk+h/8kPoz/GzmN/xUxfv8ZLW7/Kjx7/yU5eP8XJF//sMHJ/8vl7P/E3eT/xd7l/8Xe5f/F3uX/xd7l/8Te5f/F3uX/xd3n/8be6P/F2ur/xd3n/8Xe5f/F3uX/xd7l/8fh6f+90df/Wnaj/zFHf/8YH07/MkN+/z9UiP9CVor/P1OG/z5Pf/8xPm3/KzVg/y43X/8zOl7/NDpa/zE0VP8sLkz/LS1I/zAtR/8yL0b/MzBH/zYyR/84NUr/PTpL/0I/T/9JRlb/UU5a/1lXYP9iXmf/aWdu/3Nyd/99fYD/hIWJ/5manP9iZ3b/S2qq/1iAyf84SYH/Z1df/0xJZf8sM2D/KjZv/yo1cf8hMXL/JD2H/yU/jv8WJGH/Qklo/8zi6P/E3eX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xd5//F3ej/xdrq/8Xd5//F3uX/xd7l/8Xe5f/D2+P/0Onv/4mcrv9JZaL/JC9i/xosbv8aLnX/FiFU/x4pZv8ZIFH/aGl2/42Pl/+Dgoj/dXB3/3V0ev+Pj5D/rLGx/663uv+zvMD/usPH/77Kzv/C0NT/xtXY/8ra3f/M3uH/zuHl/9Dk6f/S5+z/0unv/9Tq8f/V6/L/0+zz/9Dq8v/e+P3/hJar/1V+xv9gj9z/Mz9v/7Oonv/SzML/xMnJ/2x4kv85T47/QlyX/yMwaf8hM3f/DRdL/4yZo//R6/L/wtvi/8Xe5f/F3uX/xd7l/8Xe5f/E3uX/xd7l/8Xe5f/F3ef/xd3n/8Xa6v/F3ef/xd7l/8Xe5f/F3uX/xd7l/8Xf5v/H3OT/W2uM/zE/c/8mNGz/IjRy/xooXv8aJ2j/IC1g/8XY3v/g+v//cIKc/0pop/8xRYH/Hy9v/217lv/X8ff/y+Xt/8rm7v/J5O3/yOPr/8fh6v/G4On/xd/n/8Te5f/D3eX/w9zk/8Lb4//B2uL/wdrh/8HZ4f++19//zeTr/3yNof9Se8P/XofM/yIya/8rPHL/VGKI/56ruP97hJT/YozU/3er+P8nP4n/MT1q/56stf/I4Of/xN7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd3n/8bd6P/F2ur/xd3n/8Xe5f/F3uX/xd7l/8Xe5f/C2+P/0Oft/3SHov9Vgcv/PFeY/x0ucf8gM3j/EyVr/3N7kf/P5u3/zOPp/36Nof9Sdrz/M0qL/w4gbf9KVXX/zuTp/8DY4P/C2+P/xNzl/8Xe5//G4Of/yeLp/8ni6//L5Oz/zufu/8/o7//Q6vD/0uvx/9Ts8f/U7PH/0unv/9/2+f+Glqn/UnzD/12Hzf8lPH//HDiJ/xUuf/8TKXP/HCxo/y9Ad/9XdrX/IjyH/0dWgP/Z7/H/w93l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xN7l/8Te5f/F3uX/xd7l/8Xd5//F3ej/xdrq/8Xd5//F3uX/w97l/8Pe5f/F3uX/w9zk/83l6/9zh6X/V4bR/z1cof8fOIf/IDN4/w8bWP+hqbb/2fL4/8/n8P/C1tv/W3Sr/0Fdo/8TJGb/orC9/973+//R6O7/0enu/8zh5v/J3eL/xtjc/8LS1v+7zNL/tcXM/66+xP+pt8D/oK65/5elsf+Om6z/g5Gl/3iGnv94hZ7/Ul5+/1qEyf9bhsr/Jjt//yI/kP8lQI//JUGR/yM/kf8aM4H/LUKG/yQ8hP9DU33/zOHl/8Td5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Te5f/D3uX/xd7l/8Xe5f/F3ef/xt3n/8Xa6v/F3ef/xd7l/8Pe5f/D3uX/xd7l/8Pc5P/O5ev/c4el/1eF0P89W5//HzN+/x0qaf8TIWT/XWJ2/8PS0v+1xMj/pa+1/0tcif8xRH7/Eh1R/2x2i/97iqD/aHSM/2Fuif9jdpn/Wm2U/1Fmk/9MZZT/R2GV/0pkmv9OaqH/Q1+Z/0JenP9CYJ//RmOi/0hmpf9Ka6r/T3Ct/0FWh/9chMj/XIfM/yM1cv8XKWL/HTJz/yE4f/8jO4X/ITyL/y9JkP8iN3//RVSA/87k5//E3eX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/E3uX/xd7l/8Xe5f/F3uX/xd3n/8bd6P/F2ur/xd3n/8Xe5f/D3uX/w97l/8Xe5f/D3OT/zuXr/3OHpP9WhM//PVqd/xwvef8bKGr/JDVx/zhPgv9OZZj/R2Gb/0tnoP9KZ6P/VHKx/1p7u/9Qc7X/VXe6/1Zzrv9ge6//Y4TD/3CPw/+HptL/iqjR/5q22f97lLr/YXag/7LH3P+yyNv/t8ve/7vP3v+90d3/zODm/56tuP83QGD/XojM/1mDyf8iLVf/ICta/yIvZf8eLWr/Hi1r/xstcP8pPHn/IjZ8/0VUgP/O4+f/xN3l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xd5//F3ej/xdrq/8Xd5//F3uX/w97l/8Pe5f/F3uX/w9zk/83l6/9yhqP/VoPP/0Jdnf8iL2D/GCNX/yg4av9be7n/WnKf/4OWrf9ccpT/TGij/yw/eP9KVnj/t8LE/3qElv9PW3P/u8PC/1Rbcv9dY3P/sre2/5ykqP+hqaz/eYGN/y82Uv+Bh5L/fYSR/3J5iP9pcYP/YWl+/1xmfP9JUW3/Ji1Q/1+Kzv9Xgcb/PVCE/zBFgf8kMWX/JDuF/yQ/jv8gN4H/JDl//xoveP9HV4H/z+Pn/8Pd5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3ef/xd3n/8Xa6v/F3ef/xN7l/8Pe5f/D3uX/xN7l/8Lb4//R6O7/eY2p/1F+zP9LaKX/PFCA/xohS/8gLF3/Kjt0/y84Yf9HTm7/Ljll/yw9d/8hLmb/LDlq/0JOe/89S33/MUB2/zpJfP85Sn7/MkN6/zJDef8wQ3n/Lj93/zNCe/84SH7/LD12/y0+ef8vPnv/MEB9/zJAfv8xP3//MEGC/zE/dv9dhsn/WobM/yAzdP83Snr/JjNg/xooZ/8gN37/IjqI/yQ+jf8TJ3H/SVmD/83k5//D3eX/xd7l/8Te5f/D3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd3n/8Xd6P/E2ur/xd3n/8Te5f/D3uX/w97l/8Td5P/G4Of/wtXd/1Jggv9YhtT/RF6a/yo5bP8sPHH/Qluc/zxVkv9BWpn/P1ST/0VZlf9GWI7/Q1WK/zVIfP85SoD/NkV4/zZEc/83Q3D/OENs/ztEa/86RGf/OkVm/z9JZ/9CS2n/RE1r/0dQbf9JUm3/TVZw/1Nbcv9ZYXb/XWV5/2Rtf/9OV3H/WoXL/1mFyf8lO4D/JTx+/1dmiv9FTGf/Nj1Y/y43Yf8kMmj/FSRo/0pahf/M5Of/w93l/8Xe5f/E3uX/w97l/8Xe5f/F3uX/xN7l/8Te5f/E3uX/xd7l/8Xd5//F3ej/xdrq/8Xd5//E3uX/w97l/8Pe5f/D3OP/zujv/5uuuf8xQWv/YI7Z/0Jdm/82UI3/GShc/x4rZP8WH0r/FxxB/wYCAv8ODyb/DA86/zU2Tf+PkJb/Jyk0/0BBTP+WmqD/maCl/5adov+Yn6T/maGn/5miqP+boqr/m6Or/5qkrP+apKz/mKKr/5ehqv+XoKr/lp+q/5Gcp/+Un6v/aHGJ/1eDyP9ahsr/Jz2B/xcxhP9QVnf/VFlr/z1BV/8vNEz/KjZp/xknZP9LWob/y+Ll/8Lb4//F3uX/xd7l/8Te5f/D3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3ef/xd3n/8Xa6v/F3ef/xd7l/8Pe5f/D3uX/w9zk/8zm7f+ou8P/M0Bm/1+N2v9BW5L/GyRL/wwSOP8VHEb/JC9d/xYaOP8SEyf/IidN/yEoWP8zOl3/aW+J/01VcP9VXHn/WmKB/1Jaef9OVnj/S1R2/0hTc/9IUnL/SVNz/0lSdP9HUXP/RU9y/0NMcf9CTHL/Qkxy/z9KcP8/SW7/Pkhu/zY/Zf9bh8v/WobL/yY9gP8eOIf/NT5m/zY9W/83P1v/OUFd/yg1a/8VI2H/TVyF/9rw8//K4uz/xNzj/8Xe5f/F3uX/xN7l/8Xe5P/F3uX/xN3k/8Xe5f/F3uX/xd3n/8bd6P/F2ur/xd3n/8Te5f/D3uX/w97l/8Xe5f/F3+b/xNrg/1Rjgv9Zh9X/PlmV/ztPiP8tPG3/KTVg/yY4df8XGT3/RE9z/1Bfhf9UYoj/UV+H/0VRef9LVXz/SVR5/0RQdv9CT3f/QU14/0FNev8/Tnr/P096/0BPef8/Tnn/PEp5/zlIdf82RXX/NEJ2/zFBc/8uPnD/LTxv/yc3av8nM2L/XYjM/1uHy/8mPX//HTmH/yQxY/8kMFf/HCNI/ykqPP8fIDj/EBY+/yAmTP9MUWD/sMHL/8vj7f/B2uP/xN7l/8Xe5//G3+j/xuDo/8nj6//F3+b/xN3k/8Xd5//G3ef/xNvq/8Xd5//E3uX/w97l/8Pe5f/F3uX/wtri/87k6v91iab/U4LP/0RfoP8pQIP/JTyB/zhKhf8tPXf/IjR8/xolXP8UGTj/GiRO/xQeRv8qNVz/LTpg/zA9Zf8yPmb/Mz9n/zRAZ/81QGb/OD9j/zk/X/87QFz/PEFa/z5CWf89QVb/Pj9U/0FBVv9JR1z/UExf/1RRYf9jXmv/UFFm/1iDyf9ahcn/JTt//yA7if8cJU//FBpB/xQZNf8cJlD/IzNx/yM0bf8bJFn/Bgs8/0NJYv/R5Or/0Obs/8zi5//J3uT/xtrf/8TY2v+4ytD/x93k/8rj6v/F3Ob/x97o/8Xa6v/F3ef/xd7l/8Te5f/E3uX/w9zj/8jh6f/a8vf/domn/1SDz/8/Wp//GS12/xs2g/8mPoL/Fidb/wogaP8cJ0//DxIl/x4hM/9iXFz/e3R0/4F5eP+Cenj/h3x5/4p9ev+Mfnn/jH55/4+Aef+Sg3r/lYV8/5eGfP+aiX3/nIt+/5yNf/+fj4H/opKF/6SVif+snZD/hn13/1hbav9ij9j/YI/U/ylDiP8ZM4P/SE9r/3yBiP8pNV3/OVOU/0tpq/8zTI3/Hixp/xwiVv8cIk7/S1Vx/1Nef/9LVnr/RlN5/0FOeP8+S3j/HShO/2Bqff/J3uf/xt3n/8bd5//F2ur/xd3n/8Xe5f/E3uX/xNzk/8/m7/+zxc7/nKmw/2Jxjv9Yh9H/Plqe/x0weP8dNoT/SVJ5/46Pk/+UlJv/rKur/7Kxr/+5trX/1c3I/9TMx//X0Mr/29XP/9/a1f/i3tj/5uLb/+jj3v/p5uL/7enk/+/r5//u7Oj/8O7r//Hv6//y8Oz/8vDt//Lw7f/x8O3/9/Xu/05Taf8FDS3/OlCK/zRLi/8QFz//DRNA/z1CWP+DiZL/PU+A/0dlqv9Sb6//JzZs/zxXoP9WftT/VHzO/094zP9OeM7/U3zT/1aA2P9diN//XYfc/05wqP9JZ4n/hpen/9Hn8f/E2+X/xdvq/8Xd5//F3uX/w9vj/9Dn8P+QoLL/HydJ/wsMMf8vP23/Zprh/z9ep/8bLXX/GiJP/6yrqf/d3NX/0c/M/8zKx//Ry8j/zsrF/8bCvv/FwLz/w765/7+5tP+8ta7/uK+n/7Kqov+tpJz/qJ+X/5+blP+clY7/mZCH/5WLgf+RhXv/jIB2/4h7cv+Ddm//f3Ns/3NoZf9DTm7/OEp2/zdIef86TH//RFeH/zdGdf8HDDH/JStL/0daiv9DYKn/SmSl/xohSP9AU3X/aoy4/2OArP9kgqz/aISr/2mFqv9th6r/aYKi/1pzk/80RGb/ZXWH/77T3f/J3+n/xt3n/8Xa6v/F3ef/xN3j/8vk7P+zw87/Kzlj/yAybf8fLGD/Fxw7/zhOhv8xQW//FhxE/xkZMf8sLD3/NDVI/yIpRf8fIjb/Qj1H/09IUP9OSE//T0lQ/1BLUv9RS1X/UU1X/1JPW/9SUF//UVFj/05QZ/9LUWn/T1Vs/1Rab/9VXHP/V113/1hhev9YZX//WGaG/1tskf9OXYT/WXu4/2+f7f9rmeH/Z5La/2qX4f9Naab/DxM2/z5IYf9TZpD/ZYzK/2GCtP82RHD/IzVs/yU1a/8fKU//HyZE/6Ovuv+0xs//tsbO/7DAyf+cqrb/iJCd/8PX4f/L4uv/xN3k/8fe5//E2ur/xd3n/8Lb4v/T7PP/dYGT/yU6df8kNXf/LTtw/0xmlv9PaqH/U2+g/1d0pf9ee7L/X321/2B+tv9ggLz/YoLB/1+Bwf9fgML/XYDD/11/w/9bfsb/W3/G/1x+yP9afcf/W37G/1p/yP9Xfsr/VX7K/1V9yv9VfMf/UnrF/1F5xf9RecP/TnjB/092vf9Rd7v/S2yu/zFAav9GVXX/XXaj/1Ztmf9FUnj/PUp1/xgiT/+DjZ7/dIOh/16FwP9vk8b/PU5//01bhf9iea3/NUhx/zE5V//H2+T/zefu/8nj6v/M5u3/zeXt/6a2wf/K4ur/xNvl/8Xe5f/H3uf/xdrq/8Xd5//C2+L/0erw/2dziP8tQX3/JDh7/0BVgv9PZpj/U3Co/1BqoP9RaqD/TWSa/01jmf9KYZb/R12U/0ZZkf9GWI7/R1iM/0ZYjP9HWIv/SFmK/0dZiP9LW4f/Tl2H/1Ngif9WY4r/WWaM/11pj/9ebY//ZHCQ/2p0kv9teZX/cnuX/3Z+mf95gpr/f4ea/4eNn/8hLFL/CxQ2/2GJ0f9XgMn/Jzd1/zFFif8aJ1b/XGV6/zI5U/8vQn3/T3C3/zdKhP94f5b/bXmS/wsUPf9FTWz/y+Do/8Tc5P/E3eT/xd7l/8Pa4v+drLj/yN7n/8Xd5f/F3uX/xt7n/8Xa6v/F3ef/wtzi/9Hq8f+DkaL/Okt4/y8/dP8qN2T/JSxO/zNBb/8vPm//M0Ny/1h2vv8qNmf/GCBV/0JGX/+QjIn/2dfR/+3s5P/t7OX/8vDs//X07//49vH/+vjz//389/////n////7/////v//////////////////////////////////////////////////////1M/K/3Byf/9ahc3/XIXK/y9Hj/8fOI3/UFdy/5eao/9RV2n/GSBJ/yozWP8kL1f/KDJi/z1DXv8eIz//eIWV/9Lr8f/C2+L/xd7l/8Xe5f/E3eX/m6y3/8fd5f/F3uX/xd3n/8Xd6P/E2ur/xd3n/8Td5P/H4Of/wNXg/1FZcf80P2H/GyZg/ys8av9chsn/OFGR/zZKgf9fiNr/GyVS/w0UPf88PFP/g3x6/7ewrP/Fvrj/wLmz/761r/+6saz/uK6o/7Sqpf+wpqL/rKKf/6ifnP+km5j/n5eU/5yUkP+XkIz/lI2J/5KLhv+NhYH/iYF//4Z/fv+DfHz/fnp6/4yHhf9dX23/WYXN/1qDx/8zTpf/HDKC/1xecf/IyMn/Zml9/yEmRf8/PEH/LCxF/1hjgP/M4ej/vtHZ/8Tb4//G4Ob/xd7l/8Xe5f/F3uX/xt/m/5ytuP/F2+T/xd/m/8Xe5v/H3ef/xdrq/8Xd5//F3uX/w93k/8vj6/+90Nn/a3eK/01Taf9EU3j/YJLc/zlSj/8qPHD/WH3H/yEnT/8hJj//HyIx/zM1Qv9CQUz/QUBL/0A+Sv8+PEn/PTxJ/0A9R/9BP0f/QT9I/0JARv9DQkf/RURJ/0ZETP9GR03/R0hO/0lLUv9NTVT/TU5U/01OU/9MTlT/S01W/1BSWv8gJTv/FiFE/2CLz/9bhcz/JTRv/xceTP8IEUD/ISZD/1BVZv9DQ1H/S0tX/09UY//F2eP/xd7l/8ji6f/G3+b/xd7l/8Xe5f/F3uX/xN3k/8fg5/+gsLr/xNri/8Xf5v/F3uX/x97n/8Xa6v/F3ef/xd7l/8Xe5f/E3eT/yePq/8/p7//Y7/L/doun/1aFzv89WJP/IzBf/yg5av8XHT7/MkFu/1JSXv+Bf4H/qqip/6Sgof+loqb/pqar/6mprP+qqq3/q6qr/6yqqv+urKv/r6yp/7Ctqf+xrqz/sK+u/7Gxsf+0s7H/trOw/7eysP+3s7H/tbGv/7a0sv+jo6X/KS9R/xwkRP9hjNL/WYPI/zdLfP9FYZX/FShp/3+Opv/P3uH/S0pU/01NV/9eZG//0ejy/8Td5P/E3eT/xd7l/8Xe5f/E3uX/xd7l/8Td5P/I4ej/obC7/8PZ4P/G4Ob/xd7l/8fe5//F2+r/xd3n/8Xe5f/F3uX/xd7l/8Td5P/A2uL/zOTo/3GGov9YhtL/OlGK/yMyXf8iLFf/CQom/xQYM/8eHCf/Qz0+/2pmZP9oZGX/Z2Zo/2Nmav9lZ2n/Z2dp/2ppaf9ramf/a2pm/2xpaf9raWf/amlm/2poZv9qaGX/a2Zi/2tmYP9rZV//aGNf/2ZhXv9jXln/TlFb/yk7bv8dJU7/Yo7T/1mDxv9GXI3/VnKp/xMmaP91g53/vs7T/0pKVP9QUVj/X2Vw/83k7P/D3eP/xd7l/8Xe5f/F3uX/xN7l/8Xe5f/E3eT/yuPq/5+vuf/B1t7/xuDn/8Xe5f/G3uf/xdrq/8Xd5//F3uX/xd7l/8Xe5f/F3uX/w9zk/87m6v90iKb/UXzG/zZHd/9GXY7/Iy1c/zlKgf9AUoX/PlB9/0hZgv9CU3v/QlN7/0RWfv9FWH//Sl+B/09ggv9JWoD/SVl+/0lZff9MXID/TF6B/01fgv9OYIX/TWCG/05hhv9OYof/TmGH/05ihf9OY4b/T2KG/0pegf9OaZj/HCZI/2CLz/9bic//Ii1f/xwwdv8TLX3/doSb/8HR1f9KSVT/UE9X/15lb//O5e3/xNzj/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xN3k/8zj6v+er7n/vdPb/8fh6P/F3uX/xt7n/8Xa6v/F3ef/xd7l/8Xe5f/F3uX/xd7l/8Pc5P/O5ur/c4mm/1N+yP9BV4//UGaV/yo0Yv85SXv/QVOA/0Vclf9RYpL/jpey/5Kbtf+Rm7T/kpq0/5igtv+fprf/lp2y/5Scsv+UnbP/lp60/5ees/+Yn7P/mJ+0/5iftP+YoLb/mKC2/5aftv+XobX/lqC0/5mluf9+jKH/Wnik/yApTP9gi83/WojP/yg4dv8jNXj/FC18/3WEm//C0db/SUlT/09OV/9dZG3/zeXt/8Pc4//F3uX/xd7l/8Xe5f/F3uX/xd7l/8Td5P/L5ev/na23/7rQ2P/H4ej/xd3l/8fe5//F2ur/xd3n/8Xe5f/F3uX/xd7l/8Xe5f/D3OT/zubq/3KGpf9Wgs3/OlWa/yMwa/86R3P/AwQh/xccO/8TH07/PkNl///+7P////T////y////8/////L////y////8/////L////z////8v////L////z////8v////L////w////8P////H////y////8f////b/+vLo/09ehv8ZIEn/Yo7Q/1mGyv8pQIT/Jjh4/xMpdP90g5v/wM/U/0dHUv9PTlf/XGJr/8zj6v/D3OP/xd7l/8Xe5f/F3uX/xN7l/8Te5f/E3OP/yuTr/5mps/+4zdX/yOLp/8Td5f/H3uf/xdrq/8Xd5//F3uX/xd7l/8Xe5f/F3uX/w9zk/87m6v90hqb/VX/N/z9Znv8aLHL/Lz9+/y03af8aHjv/Fxsz/zQ8W/92eoz/e3+P/3x/j/+AgI//g4KQ/4SDkv+FhJL/h4aT/4mHk/+LhpP/jYiU/42Klv+OjJb/kI2Y/5KPmv+UkZz/lpOd/5aUnf+Wlpz/lJOc/5+do/9dX3T/JzRc/2CL0P9ahsn/KUCF/yo+gv8TK3b/fo6l/8vb4P9JSVT/UlJb/2Jnb//c8ff/xN3l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/wtvi/9Pt9P+is77/tMjS/8rj6v/E3eT/xt7n/8Xa6v/F3ef/xd7l/8Xe5f/F3uX/w9zj/8DZ4f/M5Oj/c4Wl/1SAzf89WJ7/HC5z/yE6hf8uPXj/JixN/x0kRf85QWf/lZSe/5eXo/+TlJ//k5Kf/5KQof+RkKD/j4+e/42Onf+Mjpz/jIuc/4uLnP+Jipr/h4iZ/4WHmf+FiJn/hYeX/4SGlv+DhpX/gYWU/4GEk/9+gJD/jo6a/2RpgP9YhMv/XIfM/yg/hf8oPoX/EiRj/1phb/+fpaj/OzY8/09MUv9MTlb/rLe9/8fc5f/E3ub/xN3k/8Te5f/F3uX/xN3k/8vh6v+0xs//eYOM/7fK1P/L4+z/xd3k/8fd5//F2ur/xd3n/8Xe5f/F3uX/w9zj/9Do8P/S6fL/3PHz/3yOq/9Rf8z/PVqf/xwudP8kQI3/HChk/zc+Y/8dJ1H/SVB5////+f///////////////////////////////////////////////////////////////////////////////v////7////9/////f////z////6//////+np7D/T3vD/1+Jzv8pQIb/HSth/xcdQ/8YJVn/Jzx4/0Rem/8uOmX/GiNL/xMfWv+Jlaf/0+30/8Te5v/H4Oj/xd3n/9Dp8v+errz/GiFB/yk3Xf+Mmqf/0eny/8Pb5P/G3uf/xdvq/8Xd5//F3uX/xN3k/9Dm8P+hrrj/XGJw/0VJXP8/TW3/W4rW/zxZn/8aKGf/FyFP/w8SL/8cHzr/GyE+/zlAZP+LjJT/lZSZ/5qWlP+emJX/oJqW/6Gbl/+jm5n/ppya/6eem/+ooJ3/q6Kf/66lov+xqaX/tKun/7ewqv+5sqz/vrWw/8K4sv/CurX/xLy3/8O7tv/Z0Mb/h4aT/1N/x/9fidD/Kzx3/yMvX/8mNnH/M1Gn/zpguf9Ca8P/LTx2/zBKlP8qTKX/WmJ8/9Hj4//D1Nn/xdba/8LU2P/P4OH/XmqF/xknWP8xQXb/R1F0/8vg5P/G3Of/xt3n/8Xa6v/F3ef/wtvi/9Lr8/97hZT/BwkS/xAZPf8JDS3/Kzdc/1+N2v86VZn/GyZV/xcgT/8UG0H/GB42/xIVK/8yOVH/bnB9/25we/9oaGn/bmpo/25raP9va2r/b2pq/3Brav9saGf/amRk/2VgYf9iXV//Ylxf/2BcXv9dWlv/XFha/1xXWf9bVlf/WlRW/1hSVf9cVlj/Lyk0/yAkQP9gi9L/XIbM/yo3Y/8wQXj/M0N6/zdOjv82U5//QV+j/zJAc/8hMGz/M0+e/zA7Zv9IXY7/Sl+R/0ldj/9MX5D/R1iK/zxRhv8iMWX/IC5Q/09xh/+4ytP/yuLs/8bc5//E2ur/xNvl/8vl7P+sv8v/Exkp/xsqQf84RGr/pqyu/0BNbv9bitj/PViW/zdKf/8dMHX/b3GI/9DOy/++vL3/v769/8vJxf/KycT/yMbC/8fEwP/Ewb3/wb65/7+7tv+/u7X/vbmz/7q2sf+2tK//tbOu/7Wyrv+zsav/sK6p/7Ctqf+tqqf/qqmk/6elov+urKf/iYyQ/x4qVP8jLFz/YYzT/1uFyv8uPGj/O0+J/0RZj/9EXZb/MEiO/0tmpv9AT3z/LkWN/zZUqf9BS3L/b4ey/2uEsv9pg7L/aYS0/2R9rf9bdKb/Ljts/yYxYf88Unj/uczV/8nh6//F3ef/xdrq/8La5P/V7PP/ZG+C/xAePP8pO2H/NENx/2Bqfv9cZ4H/VITT/0Jdm/9feqX/MU+b/8PDyv////////////////////////////////////////////////////////////////////////////////////7////9/////P////v///76///9+f/7+vb////+/56ptP83Uof/Lzx6/2CM0v9ahMj/O057/0FXk/85S4L/Lj5u/yU6fP9NaKr/VmaI/zBIkf8cMYD/e4aU/9rx8v/J3uP/zOHl/8vf4//R5Ob/cIKb/y8+a/85T43/SFWA/8nd4v/G3ej/xt3n/8Xa6f/G3Of/y+Dn/0BJZ/8hNF3/KThp/1Rffv80R33/NUBh/12M2v84UpP/aYCi/y9Gi/9hZ4X/p6Wm/6Ojqv+trbD/t7e5/7u6vP++vb//wcDC/8XExf/Jycn/zc3N/9DQ0P/S0tL/1tXW/9rZ2f/d3Nz/4N/e/+Tj4f/n5eT/6ujn/+3s6v/w7+7/8PDv//36+P+grLj/U22a/yw6df9gjNP/WYPH/z1Qe/89U4z/HilS/z5Siv8vS5v/UG2s/1Vrjf8UGDf/VVtw/7nO1v/H4en/w9zk/8Td5f/C2+P/zOft/5iouf8sOmD/M0Nr/4KRov/R6fH/xNvk/8bd6P/E2un/yd/q/77S2f84RWf/KkBq/yo4av9KVHf/Jzdu/yk5af9ijtj/MUmO/0VYfv8+T3f/DxhT/xQgV/8ULH7/QU11/9LNyP/X0tH/0c3L/9DMyv/Mysb/ycbD/8XDv//Dwb7/wL68/768uv+9urn/vbm3/7u4tv+4t7T/trWy/7Sysv+ysK//sLCu/66urv+xsK//lpqg/01olP8fK1r/YIzR/1mDyv8+UHv/RFmN/yU2Z/8wQXb/MEF2/0Vckf8+UoD/Gh00/8bY3f/N5+7/w9zj/8Xe5f/F3uX/xd7l/8Td5P/L4+r/nq+6/5Skrf/J4uj/xd7m/8Xd5//H3ef/xNrp/8ng6v+80dj/PElp/ylAav9IVYT/p621/xokUP8nNWP/ZI7Y/zZPlP8uPnT/Ok58/xkfSP8YH0L/Ex5F/zg7Tf+WjYH/oJOI/6SVif+rmIz/sJyN/7ehkP+6ppP/vqqX/8Owmv/Isp3/zbWh/9C6pf/Svqn/1sKt/9rIsf/czbb/38+8/+PTwP/l1sT/5tnJ/+3ezv+enaL/RE5t/1yIy/9bhsv/RliF/05ilP8rPHb/LD58/x8pVP8bI0v/KTRs/yQrUP+zxMr/yePq/8Td5P/F3uX/xd7l/8Xe5f/F3uX/xN3k/87o7v/Q6vH/xd7l/8Xe5f/F3ef/xt3o/8Xa6f/H3ef/x93m/1Bbcv8vRm3/MUFw/ycuUv8YIVP/NkNq/2KL2f82TpH/MUWC/zBBgP8pNWv/JC9j/yIrWv8nMV3/LDhi/y04Yv8uOGH/LTdd/y41XP8uNVr/LzdY/zE3Vv8yNlP/NDdS/zY5Uf83O0//OzxP/zw8Tv8+PU3/QT9N/0NCTf9IRE7/S0ZP/0xIT/9RTFT/U0pO/zY4SP9ei9H/XIjM/0JVhv9QZZn/Lj5v/yQvXf8sO3b/MUB1/yo6ef9NVXX/zuLo/8Te5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/D3OP/w9zj/8Xe5f/F3uX/xd3n/8Xd6P/F2+r/xNrk/9Lp8f9zgJH/KDlT/y5Dcv8bJVD/gIyd/3SFov9Vf8//OFGW/y5Bfv87UJT/Q1ik/0Rdp/9HZK3/Smat/0hlqf9JZKj/SGGm/0VepP9EXaP/Q1yi/0Baof89WJz/O1SZ/ztTlf88UJH/Ok6Q/zlMjv82Sor/NEeG/zRGhv8yRYX/LkJ//yw/ev8rPnn/JjZt/yk9dP81S4H/XojM/16L0f83TYP/SFuO/ztPh/8rNmL/KjNV/zM+bf8lM2//aHSR/9Xt8//C2+L/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xd5//F3ej/xtvq/8Tc5f/J4+n/uMvX/yw2Sf8cLFL/V2KB/+7++/93iqr/U3/M/zhTlv8vQn//Ok+Q/0Vcov9JZKr/Wnu//2GDx/9kiMz/ZYnO/2WL0P9mjNL/ZozU/2SO1P9lj9X/ZI7V/2WN0/9ljNL/Y4rR/2OJz/9ih83/YIbK/1+Fyv9eg8v/XYPN/1yCzP9agcr/WXzH/0BfrP84U5z/RV+f/12Gy/9gjdL/OlKI/ys3aP81RHL/IitY/y05Zf8wO2X/GCJe/2t3lP/R6u7/wtvj/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/w97l/8Xe5f/F3uX/xd7l/8Xe5f/F3ef/xd3n/8Xb6v/G3ef/w9zj/87n7v+ktcH/P0ha/yErVP9SVWf/T1x4/12I1P85UpX/LT1v/yY2aP8gKlb/LDhn/0tXe/9GU3j/P050/0VUev9HWYH/RVmE/0Vahv9FW4n/RVuN/0ZdkP9JX5H/S2GU/0tilv9MZZv/S2ac/0xnoP9OaKT/Tmmk/09qpv9Sban/U2+r/05sqv83Upj/NkyM/z1Of/9fiM7/YYzU/zpPgv8hLWT/LTt0/y46cP8zPGH/Lzhb/xYgXv94hqD/0uvw/8Lb4v/F3uX/xd7l/8Xe5f/D3uX/w97l/8Pe5f/F3uX/xd7l/8Xe5f/F3uX/xd3n/8Xd6P/E2ur/xd3n/8Xe5f/D3OP/zeft/8/l7f+Xp7T/eISS/2Bxj/9Zgcr/NUuO/zI9ZP86Rmj/SVVw/x4tX/99hJn/eX6S/wUNQP+HlKL/s8XO/6O0v/+gsLz/nKu4/5eltP+SoLD/jZus/4iVqf+BjqP/fImf/3eEm/90gJb/cHqR/2x1jP9ncIj/YmyF/1xng/9WYoH/S1Nw/0ZYh/9DV4r/YorM/12Kz/9FW4//MTpd/y09ef8zQnf/Pkx9/y4zWP8XIWD/j52x/9Dq7//C2+P/xd7l/8Xe5f/F3uX/w97l/8Pe5f/F3uX/xd7l/8Xe5f/F3uX/xd7m/8Xd5//F3uf/xdrq/8Xd5//F3uX/xd7l/8Pc4//E3eT/zObt/9/4+/98kKr/T3a7/y1Agv8bKFr/h5Oj/258mf98iaD/R1Fz/yovTP8fKVz/tsjQ/9Tt9P/M5uz/zuju/87p7//P6vD/0Orw/9Hr8P/R6/H/0urw/9Pr8P/S6/D/0urv/9Hp7v/Q6O3/z+fs/8/l6//O5er/zeTq/8/g5P9keaf/FCVc/0tspv9kkNT/Ok6D/yMsVf8rN2X/LDtq/zVGff8hJkr/ICtm/6e3xf/M5u3/w9zj/8Xe5f/F3uX/w97l/8Pe5f/E3uX/xd7l/8Xe5f/E3uX/xN7l/8Xe5v/F3ef/xd3o/8Xa6v/F3ef/xd7l/8Xe5f/F3uX/xd7l/8HZ4f/N5uz/jJ6u/1R4t/80SpH/Hyhb/8XQ0P9ebYv/wtDZ/4OOnP8EDD//P0lw/8fd4f/D3OT/w9zj/8Pc4//D3OP/w9zj/8Pb4//D2+P/wtvj/8Lb4//C2+P/wtvj/8Pc4//D3OP/w9zj/8Pc5P/E3eT/xd7l/8Td5P/K4ur/g5Sq/256kv9Zcpn/YIjK/ztUjv8uOGX/V112/0lVff9MWXr/ERlG/zZDd/+/09v/yOHo/8Td5P/F3uX/xd7l/8Pe5f/D3uX/w97l/8Pe5f/D3uX/w97l/8Xe5f/F3uX/xd3n/8Xc6f/F2ur/xd3m/8Xe5f/F3uX/xd7l/8Xe5f/E3eT/yeTr/7PGzv9cean/RF+j/xolZ/90fpT/aHSJ/3+Hlf86Q2v/ER1a/3N/kv/T7PH/wtvi/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8vj6v/a8PX/d4um/1l+u/9IY6P/Rk1x/5CWpP9aaI3/cneE/xEfZv9bZ4v/0Obt/8Pc5P/F3uX/xd7l/8Pe5f/E3uX/w97l/8Pe5f/D3uX/w97l/8Pe5f/E3uX/xd7l/8Xd5//F3ej/xdvq/8Xd5v/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Pc4//O5uz/fpCn/0prrP8rOXn/Hi9w/yYyW/8cJVD/FSJf/yQsVP+7zdT/yePq/8Td5P/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/B2uL/y+Tr/6Cwvv9ScaH/XHy3/z5Nff9naXj/JCxG/y86bf8aKGj/kaCv/9Hp8v/D2+P/xd7l/8Xe5f/D3uX/xd7l/8Te5f/D3uX/w97l/8Pe5f/D3uX/w97l/8Xe5f/F3ef/xd3n/8Xa6v/F3ef/xd7l/8Pe5f/D3uX/w97l/8Xe5f/E3eT/x+Ho/7/T2/9ieJ7/PE+F/xkiWv8WJmf/FyVi/yMrUf+Wo67/zufu/8DZ4f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Te5f/D3uX/w97l/8Xe5f/F3uX/xd7l/8Xe5f/E3uX/xN7l/8Te5f/E3uX/xd7l/8Xe5f/F3uX/xd7l/8Td5P/M4+r/eImf/1Jtov86T4n/Ex1O/xQbS/8QG1j/R09u/8vg6P/F3eX/xd7l/8Xe5f/E3uX/w97l/8Xe5f/F3uX/xd7l/8Pe5f/D3uX/w97l/8Pe5f/F3uX/xd3n/8Xd5//F2ur/xd3n/8Xe5f/D3uX/w97l/8Pe5f/E3uX/xd7l/8Lb4v/S7PL/kqKt/z5Vhf9DTXT/l6Gq/7G/x//G2OD/2fD3/8/n7f/Q6e7/xt/m/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xN7l/8Te5f/E3uX/xd7l/8Xe5f/F3uX/xN7l/8Xe5f/E3uX/xN7l/8Xe5f/F3uX/xd7l/8Xe5f/F3eT/xuDn/8bd5P+ClKn/XGuM/zxHbv8rOWj/Ult1/7vO1//J4+r/xN3k/8Xe5f/F3uX/xd7l/8Te5f/E3uX/xd7l/8Te5f/D3uX/w97l/8Pe5f/D3uX/xd7l/8Xd5//F3ej/xdvp/8Xd5//F3uX/w97l/8Pe5f/D3uX/w97l/8Te5f/E3eT/yuTr/6/Dzf84TX//bXyY/5+quf9rdYv/prfE/6O2xv+Yqbz/nK2+/8Tc5f/G3+b/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xN7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Td5P/G3+b/zebs/8rg5f/E2N3/v9PX/9Dn7P/J4un/w93k/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Te5f/D3uX/w97l/8Pe5f/D3uX/xd7l/8Xe5f/F3ef/xd3o/8Xb6f/F3ef/xd7l/8Xe5f/E3uX/w97l/8Pe5f/D3uX/xN3k/8rk6/+vw8v/SWWb/z9QeP8hNXL/HjR5/zlBZv9JWYL/R1iB/05cff+4zNb/yeLq/8Td5P/E3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xN7l/8Pe5f/E3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Pc5P/E3uX/xuDn/8jh6f/D3OT/xN3k/8Xe5f/F3uX/xd7l/8Xe5v/F3uX/xd7l/8Xe5f/E3uX/xN7l/8Te5f/D3uX/xN7l/8Xe5f/F3uX/xd3n/8Xd6P/F2+j/xd3n/8Xe5f/F3uX/xd7l/8Xe5f/E3uX/xd7l/8Xe5f/G4Of/w9nh/26Dnf+Qn7L/lqa5/4iZrf/D1t//wNbc/8Ta3//H3eP/yODn/8Xe5f/G3+b/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/E3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xd5f/E3eT/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/G3+b/xd7l/8Xe5f/F3uX/xN7l/8Te5f/F3uX/xN7l/8Xe5f/F3uX/xd7l/8Xd5//F3ej/xdvp/8Xd5//F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7k/8fg5//K4eb/zuXs/8/o7f/P5+z/yeHo/8jh6P/I4ej/x+Dn/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xt/l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3uX/xd7l/8Xe5f/F3ef/xd3o/8Xc6P/F3ef/xd7m/8Xe5v/F3uf/xd7m/8Xe5v/F3ub/xd7m/8Xe5v/F3ub/xN3m/8Td5f/D3OX/w9zk/8Td5f/F3ef/xd7n/8be5v/F3ub/xd7m/8Xe5//F3ub/xd7m/8Xe5//F3ub/xd7m/8Xe5//F3ub/xd7n/8Xe5v/F3ub/xd7n/8Xe5v/F3ub/xd7n/8Xe5//F3ub/xd7n/8Xe5//F3uf/xd7m/8Xe5//F3uf/xd7m/8Xe5//F3uf/xd7m/8Xe5v/F3uf/xd7n/8be5//F3uf/xd7m/8Xe5v/F3uf/xd7n/8Xe5//F3uf/xd7n/8Xe5//F3ub/xd3m/8bd6v/F3Of/xt3n/8bd5v/G3ub/x97n/8fe5v/H3ub/x97o/8fe5//H3uj/xt/n/8bf5v/G3uf/xt7n/8fe5//H3+b/x97m/8fe5//G3uf/xt7n/8be6P/G3uf/xt7n/8be5v/G3uf/x97m/8fe5v/H3+b/xt7m/8fe5//H3+f/x9/m/8bf5v/G3ub/x9/m/8fe5v/H3uf/xt7n/8be5v/G3uj/xt/n/8bf5v/H3+f/x9/n/8fe5//G3+f/xt/m/8be5v/H3ub/xt7m/8be5//G3uf/xt7n/8bf5//G3+f/x97o/8bf5//G3uf/xt7n/8be5//G3uf/xt7n/8bd6P/G3un/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=
// @supportURL         https://github.com/MapoMagpie/comic-looms
// @match              https://*.pixiv.net/*
// @match              https://steamcommunity.com/*
// @match              https://twitter.com/*
// @match              https://x.com/*
// @match              https://*.instagram.com/*
// @match              https://*.manhuagui.com/*
// @match              https://*.mangacopy.com/*
// @match              https://*.copymanga.tv/*
// @match              https://*.artstation.com/*
// @match              *://*/*
// @require            https://cdn.jsdelivr.net/npm/@zip.js/zip.js@2.7.57/dist/zip-full.min.js
// @require            https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js
// @require            https://cdn.jsdelivr.net/npm/pica@9.0.1/dist/pica.min.js
// @connect            *
// @grant              GM_getValue
// @grant              GM_setValue
// @grant              GM_xmlhttpRequest
// @downloadURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/Comic20Looms.user.js
// @updateURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/Comic20Looms.meta.js
// ==/UserScript==
!function(e,t,n){"use strict";function i(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e)for(const n in e)if("default"!==n){const i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:()=>e[n]})}return t.default=e,Object.freeze(t)}function a(e){return Object.entries(e).reduce((e,[t,n])=>(e[t]=new he(n),e),{})}function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function o(){return window.btoa(r())}function s(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode(parseInt(t,16))}))}function l(){const e=window.screen.width;return e>2500?7:e>1900?6:e>700?5:3}function c(){const e=window.screen.availHeight;return Math.floor(e/3.4)}function d(){return{colCount:l(),rowHeight:c(),readMode:"pagination",gridMode:"flow",autoLoad:!0,fetchOriginal:!1,restartIdleLoader:2e3,threads:3,downloadThreads:4,timeout:10,version:ue,debug:!0,first:!0,reversePages:!1,pageHelperAbTop:"unset",pageHelperAbLeft:"20px",pageHelperAbBottom:"20px",pageHelperAbRight:"unset",imgScale:100,defaultImgScaleModeC:60,autoPageSpeed:5,autoPlay:!1,hdThumbnails:!1,filenameTemplate:"{number}-{title}",preventScrollPageTime:100,archiveVolumeSize:1200,pixivConvertTo:"GIF",pixivImageServer:void 0,autoCollapsePanel:!0,minifyPageHelper:ge?"never":"inBigMode",keyboards:{inBigImageMode:{},inFullViewGrid:{},inMain:{}},muted:!1,volume:50,paginationIMGCount:1,hitomiFormat:"auto",autoOpen:!1,autoLoadInBackground:!0,reverseMultipleImagesPost:!0,ehentaiTitlePrefer:"japanese",scrollingDelta:300,scrollingSpeed:20,id:r(),configPatchVersion:0,displayText:{},customStyle:"",magnifier:!1,autoEnterBig:!1,pixivRecordReading:!1,pixivAscendWorks:!1,filenameOrder:"auto",dragImageOut:!1,excludeVideo:!1,enableFilter:!1,imgNodeActions:[],minRatio:.5}}function h(e){const t=fe.getItem(g(e));return t?JSON.parse(t):{}}function p(e,t){const n=g(t),i=fe.getItem(n),a=i?JSON.parse(i):{};["selectedSiteNameConfig"].forEach(e=>delete a[e]),t&&["keyboards","siteProfiles"].forEach(e=>delete a[e]),fe.setItem(n,JSON.stringify({...a,...e}))}function g(e){return e?me+s(e).replaceAll(/[+=\/]/g,"-"):me}function u(e,t,...n){("debug"!==e||ve.conf.debug)&&("error"===e?console.warn((new Date).toLocaleString(),"EHVP:"+t,...n):console.info((new Date).toLocaleString(),"EHVP:"+t,...n))}function m(e,t,n,i,a){if(void 0===ne)throw new Error("your userscript manager does not support Gm_xmlhttpRequest api");return ne({method:"GET",url:e,timeout:a||6e5,responseType:t,nocache:!1,revalidate:!1,headers:{Referer:window.location.href,"Cache-Control":"public, max-age=2592000, immutable",...i},...n})?.abort}function f(e,t,n){return new Promise((i,a)=>{try{m(e,t,{onload:e=>i(e.response),onerror:e=>a(e)},n??{},1e4)}catch(e){a(e)}})}async function b(e,t,n="text"){const i=new Array(e.length);let a=0;for(;a<e.length;){const r=e.slice(a,a+t).map((e,t)=>window.fetch(e).then(t=>{if(t.ok)try{switch(n){case"text":return t.text();case"json":return t.json();case"arraybuffer":return t.arrayBuffer()}}catch(n){throw new Error(`failed to fetch ${e}: ${t.status} ${n}`)}throw new Error(`failed to fetch ${e}: ${t.status} ${t.statusText}`)}).then(e=>i[t+a]=e).catch(e=>i[t+a]=new Error(e)));await Promise.all(r),a+=t}return i}function w(e){return new Promise(t=>setTimeout(t,e))}function v(e,t){var n,i;const a=CryptoJS;if(!a)throw new Error("cryptoJS undefined");return n=a.enc.Utf8.parse(e),i=a.AES.decrypt(t,n,{mode:a.mode.ECB,padding:a.pad.Pkcs7}),a.enc.Utf8.stringify(i).toString()}function y(e){const t=Uint8Array.from(atob(e),e=>e.charCodeAt(0));return(new TextDecoder).decode(t)}function C(e,t,n){const i=(n.mh_info.startimg+e-1).toString().padStart(4,"0");let a=i+".jpg";null!=n.image_info.imgKey&&""!=n.image_info.imgKey&&(a=i+".enc.webp");const r=window.location.host.replace("www.","");return[a,"https://img"+n.mh_info.use_server+"."+r+"/comic/"+encodeURI(t)+a]}function x(e,t,n){const i=new RegExp(t+"=((\\w+)(\\([^)]+\\))?)[,; ]","gm"),a=e.matchAll(i),r=[];let o=!0;for(const t of a){o=!1;const i=t[2],a=t[3];a&&(n=a),i&&r.push(...x(e,i,n))}return o&&e.includes("function "+t)&&r.push([t,n??null]),r}function I(e){return"https://i.eahentai.com/file/ea-gallery/"+encodeURI(e).replace(/,/g,"%2C").replace(/&/g,"%26").replace(/\+/g,"%2B").replace(/%20/g,"+")}async function A(e,t){let n;for(let t=0;t<3;t++)try{n=await f(e,"blob");break}catch(e){u("error","fetch thumbnail failed, ",e)}if(!n)throw new Error("load sprite image error");e=URL.createObjectURL(n);const i=await new Promise((t,n)=>{const i=new Image;i.onload=()=>t(i),i.onerror=()=>n(new Error("load sprite image error")),i.src=e});return URL.revokeObjectURL(e),function(e,t){const n=document.createElement("canvas"),i=n.getContext("2d"),a=[];for(const r of t)n.width=r.width,n.height=r.height,i.drawImage(e,r.x,r.y,r.width,r.height,0,0,r.width,r.height),a.push(n.toDataURL());return n.remove(),a}(i,t)}function _(e){if(!e)return;const t=e.match(/\/\w+-\d+-(\d+)-(\d+)-/);return t&&3===t.length?{w:parseInt(t[1]),h:parseInt(t[2])}:void 0}function S(e){const t={w:parseInt(e.width),h:parseInt(e.height)};if(!isNaN(t.w)&&!isNaN(t.h))return t}function k(e,t){const n=t.querySelector(e);if(!n)throw new Error(`Can't find element: ${e}`);return n}function E(e){switch(e.slice(0,1)){case"j":return"jpg";case"g":return"gif";case"p":return"png";case"w":return"webp";case"a":return"avif";case"m":return"mp4";default:throw new Error("cannot parse image extension from info: "+e)}}function L(e){return Et.includes(e)}function T(e){return Lt.includes(e)}function P(e){const t=new Map;for(const n of e??[])n.path&&n.server&&t.set(n.path,{server:n.server,name:n.name});return t}function R(e){switch(e.slice(0,1)){case"j":return"jpg";case"g":return"gif";case"p":return"png";case"w":return"webp";case"a":return"avif";case"m":return"mp4";default:throw new Error("cannot parse image extension from info: "+e)}}function M(e){const t=new Headers;t.set("authorization","Bearer AAAAAAAAAAAAAAAAAAAAANRILgAAAAAAnNwIzUejRCOuH5E6I8xnZz4puTs%3D1Zv7ttfk8LF81IUq16cHjhLTvJu4FA33AGWWjCpTnA"),t.set("Pragma","no-cache"),t.set("Cache-Control","no-cache"),t.set("content-type","application/json"),t.set("x-client-uuid",e),t.set("x-twitter-auth-type","OAuth2Session"),t.set("x-twitter-client-language","en"),t.set("x-twitter-active-user","yes"),t.set("x-client-transaction-id",o()),t.set("Sec-Fetch-Dest","empty"),t.set("Sec-Fetch-Mode","cors"),t.set("Sec-Fetch-Site","same-origin");const n=document.cookie.match(/ct0=(\w+)/)?.[1];if(!n)throw new Error("Not found csrfToken");return t.set("x-csrf-token",n),t}function N(e){const t=[],n=[];let i;for(const a of e.entries)"TimelineTimelineItem"!==a.content.entryType||a.entryId.startsWith("promoted-")?"TimelineTimelineModule"===a.content.entryType&&"VerticalConversation"===a.content.displayType?a.content.items.forEach(e=>{t.push(e.item),e.item.itemContent.tweet_results.result.legacy?.id_str&&n.push(e.item.itemContent.tweet_results.result.legacy?.id_str),e.item.itemContent.tweet_results.result.legacy?.retweeted_status_result?.result?.legacy?.id_str&&n.push(e.item.itemContent.tweet_results.result.legacy?.retweeted_status_result?.result?.legacy?.id_str)}):"TimelineTimelineCursor"===a.content.entryType&&a.entryId.startsWith("cursor-bottom")&&(i=a.content.value):(t.push(a.content),a.content.itemContent.tweet_results.result.legacy?.id_str&&n.push(a.content.itemContent.tweet_results.result.legacy.id_str),a.content.itemContent.tweet_results.result.legacy?.retweeted_status_result?.result?.legacy?.id_str&&n.push(a.content.itemContent.tweet_results.result.legacy?.retweeted_status_result?.result?.legacy?.id_str));return{items:t,ids:n,cursor:i}}function $(e,t){const n=new TextEncoder,i=e=>n.encode(e).byteLength,a=i(e);if(a<=t)return e;const r=[e.length>>1,1+(e.length>>1)];let o=!0;for(;;){if(a-i(e.slice(...r))<=t)return e.slice(0,r[0])+",,,"+e.slice(r[1]);if(o&&r[0]>3)r[0]-=1,o=!1;else{if(!(r[1]<e.length-3))break;r[1]+=1,o=!0}}return e.slice(0,t)}function O(e,t){let n=t;if(e.has(n)){const t=n.split("."),i=t.pop(),a=t.join("."),r=parseInt(a.match(/_(\d+)$/)?.[1]||"");return n=isNaN(r)?`${a}_1.${i}`:`${a.replace(/\d+$/,(r+1).toString())}.${i}`,O(e,n)}return e.add(n),n}function q(e){return new ReadableStream({pull(t){t.enqueue(e),t.close()}})}function U(){let e,t;const n=new Promise((n,i)=>{e=n,t=i});return{resolve:e,reject:t,promise:n}}function B(e){const t=[];if(e.ctrlKey&&t.push("ctrl"),e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.metaKey&&t.push("meta"),e instanceof KeyboardEvent){let n=e.key;" "===n&&(n="space"),t.push(n)}if(e instanceof MouseEvent){let n="m"+e.button;t.push(n)}return t.join("+").toLowerCase()}function z(e,t,n,i){const a=t.getBoundingClientRect();let r=a.left+a.width/2-e.offsetWidth/2;r=Math.min(r,n-e.offsetWidth),r=Math.max(r,0),e.style.left=r+"px",a.top>i/2?(e.style.bottom=i-a.top+"px",e.style.top="unset"):(e.style.top=a.bottom+"px",e.style.bottom="unset")}function D(e,t,n){const i=e.map(e=>`<div><span style="user-select: text;">${e}</span><span class="ehvp-custom-btn ehvp-custom-btn-plain" data-value="${e}">&nbspx&nbsp</span></div>`);t.innerHTML=i.join(""),Array.from(t.querySelectorAll("div > span + span")).forEach(e=>{e.addEventListener("click",()=>{n(e.getAttribute("data-value")),e.parentElement.remove()})})}function F(){const e=V();return`\n<div class="b-main" style="flex-direction:row;">\n  <a class="b-main-item s-pickable" data-key="entry">${e.entry}</a>\n  <a class="b-main-item s-pickable" data-key="collapse">${e.collapse}</a>\n  <div class="b-main-item">\n      <a class="" style="color:#ffc005;">1</a><span id="p-slash-1">/</span><span id="p-total">0</span>\n  </div>\n  <div class="b-main-item s-pickable" data-key="fin">\n      <span>${e.fin}:</span><span id="p-finished">0</span>\n  </div>\n  <a class="b-main-item s-pickable" data-key="autoPagePlay" data-status="play">\n     <span>${e.autoPagePlay}</span>\n  </a>\n  <a class="b-main-item s-pickable" data-key="autoPagePause" data-status="paused">\n     <span>${e.autoPagePause}</span>\n  </a>\n  <a class="b-main-item s-pickable" data-key="config">${e.config}</a>\n  <a class="b-main-item s-pickable" data-key="download">${e.download}</a>\n  <a class="b-main-item s-pickable" data-key="chapters">${e.chapters}</a>\n  <a class="b-main-item s-pickable" data-key="filter">${e.filter}</a>\n  <div class="b-main-item">\n      <div id="read-mode-select"\n      ><a class="b-main-option b-main-option-selected s-pickable" data-key="pagination" data-value="pagination">${e.pagination}</a\n      ><a class="b-main-option s-pickable" data-key="continuous" data-value="continuous">${e.continuous}</a\n      ><a class="b-main-option s-pickable" data-key="horizontal" data-value="horizontal">${e.horizontal}</a></div>\n  </div>\n  <div class="b-main-item">\n      <span>\n        <a class="b-main-btn" type="button">&lt;</a>\n        <a class="b-main-btn" type="button">-</a>\n        <span class="b-main-input">1</span>\n        <a class="b-main-btn" type="button">+</a>\n        <a class="b-main-btn" type="button">&gt;</a>\n      </span>\n  </div>\n  <div class="b-main-item">\n      <span>\n        <span>${Jn.zoomIcon}</span>\n        <a class="b-main-btn" type="button">-</a>\n        <span class="b-main-input" style="width: 3rem; cursor: move;">100</span>\n        <a class="b-main-btn" type="button">+</a>\n      </span>\n  </div>\n</div>`}function V(){return{...Qn,...ve.conf.displayText}}function j(e,t){return Array.from(e.cssRules).find(e=>e.selectorText===t)}function H(e,t,n,i,a){function r(i,a,r,o){if(!r){const e={colCount:[1,12],rowHeight:[50,4096],threads:[1,10],downloadThreads:[1,10],timeout:[8,40],autoPageSpeed:[1,100],preventScrollPageTime:[-1,9e4],paginationIMGCount:[1,3],scrollingDelta:[1,5e3],scrollingSpeed:[1,100]};let t=1;"preventScrollPageTime"!==i&&"rowHeight"!==i&&"scrollingDelta"!==i||(t=1===ve.conf[i]?9:10),"add"===a?r=Math.min(ve.conf[i]+t,e[i][1]):"minus"===a&&(r=Math.max(ve.conf[i]-t,e[i][0]))}if(void 0!==r){if(ve.conf[i]=r,k(`#${i}Input`,e.config.panel).value=ve.conf[i].toString(),"colCount"!==i&&"rowHeight"!==i||ye.emit("fvg-layout-resize"),"paginationIMGCount"===i){k("#paginationInput",e.paginationAdjustBar).textContent=ve.conf.paginationIMGCount.toString();const i=j(e.styleSheet,".bifm-container-page .bifm-img");i&&(i.style.maxWidth=100===ve.conf.imgScale&&1===ve.conf.paginationIMGCount?"100%":""),t.setNow(n[n.currIndex])}p({[i]:r},o??ve.conf.selectedSiteNameConfig)}}function o(n,a){const r=k(`#${n}Checkbox`,e.config.panel);void 0!==a?r.checked=a:a=r.checked||!1,void 0!==a&&(ve.conf[n]=a,p({[n]:a},ve.conf.selectedSiteNameConfig),"autoLoad"===n&&(i.autoLoad=ve.conf.autoLoad,i.abort(0,ve.conf.restartIdleLoader/3)),"reversePages"===n&&t.changeLayout())}function l(n,i){n&&(ve.conf.readMode=n),t.changeLayout(),ve.conf.autoPageSpeed="pagination"===ve.conf.readMode?5:1,p({readMode:ve.conf.readMode,autoPageSpeed:ve.conf.autoPageSpeed},i??ve.conf.selectedSiteNameConfig),k("#autoPageSpeedInput",e.config.panel).value=ve.conf.autoPageSpeed.toString(),Array.from(e.readModeSelect.querySelectorAll(".b-main-option")).forEach(e=>{e.getAttribute("data-value")===ve.conf.readMode?e.classList.add("b-main-option-selected"):e.classList.remove("b-main-option-selected")}),"pagination"===ve.conf.readMode?e.root.querySelectorAll(".img-land").forEach(e=>e.style.display=""):e.root.querySelectorAll(".img-land").forEach(e=>e.style.display="none")}function c(n,i){const r=k(`#${n}Select`,e.config.panel);if(i?r.value=i:i=r.value,i)if(ve.conf[n]=i,"readMode"!==n){if(p({[n]:i},ve.conf.selectedSiteNameConfig),"minifyPageHelper"===n)switch(ve.conf.minifyPageHelper){case"always":a.minify("bigImageFrame");break;case"inBigMode":case"never":a.minify(t.visible?"bigImageFrame":"fullViewGrid")}"gridMode"===n&&ye.emit("fvg-layout-change")}else l()}function d(e,t){t&&g(t);const n=window.setTimeout(()=>e.classList.add("p-collapse"),100);t&&(m[t]=n)}function g(e){(e?[e]:[...Object.keys(m)]).forEach(e=>{window.clearTimeout(m[e]),delete m[e]})}function u(){t.visible?e.bigImageFrame.focus():e.fullViewGrid.focus()}const m={},f=document.body.style.overflow,b=function(){const e={"exit-big-image-mode":new ei(["escape","enter"],()=>t.hidden()),"step-image-prev":new ei(["arrowleft"],()=>{t.callbackOnWheel?.(),t.stepNext(ve.conf.reversePages?"next":"prev")}),"step-image-next":new ei(["arrowright"],()=>{t.callbackOnWheel?.(),t.stepNext(ve.conf.reversePages?"prev":"next")}),"step-to-first-image":new ei(["home"],()=>t.stepNext("next",0,1)),"step-to-last-image":new ei(["end"],()=>t.stepNext("prev",0,-1)),"scale-image-increase":new ei(["="],()=>t.scaleBigImages(1,5)),"scale-image-decrease":new ei(["-"],()=>t.scaleBigImages(-1,5)),"scroll-image-up":new ei(["pageup","arrowup","shift+space"],e=>{const n=B(e),i=["pageup","shift+space"].includes(n);let a=!["pageup","arrowup","shift+space"].includes(n);t.onWheel(new WheelEvent("wheel",{deltaY:-1*ve.conf.scrollingDelta}),i,a,void 0,e)},!0),"scroll-image-down":new ei(["pagedown","arrowdown","space"],e=>{const n=B(e),i=["pagedown","space"].includes(n),a=!["pagedown","arrowdown","space"].includes(n);t.onWheel(new WheelEvent("wheel",{deltaY:ve.conf.scrollingDelta}),i,a,void 0,e)},!0),"toggle-auto-play":new ei(["p"],()=>ye.emit("toggle-auto-play")),"round-read-mode":new ei(["alt+m"],()=>{const e=["pagination","continuous","horizontal"],t=(e.indexOf(ve.conf.readMode)+1)%e.length;c("readMode",e[t])},!0),"toggle-reverse-pages":new ei(["alt+f"],()=>o("reversePages",!ve.conf.reversePages),!0),"rotate-image":new ei(["alt+r"],()=>ye.emit("bifm-rotate-image"),!0),"cherry-pick-current":new ei(["alt+x"],()=>t.cherryPickCurrent(!1),!0),"exclude-current":new ei(["shift+alt+x"],()=>t.cherryPickCurrent(!0),!0),"go-prev-chapter":new ei(["shift+alt+w"],()=>ye.emit("pf-step-chapters","prev"),!0),"go-next-chapter":new ei(["alt+w"],()=>ye.emit("pf-step-chapters","next"),!0)},s={"open-big-image-mode":new ei(["enter"],()=>{let e=n.currIndex;if(w&&w.length>0){if(e=Number(w.join(""))-1,w=null,isNaN(e))return;e=Math.max(0,Math.min(e,n.length-1))}n[e].node.root?.querySelector("a")?.dispatchEvent(new MouseEvent("click",{bubbles:!1,cancelable:!0}))}),"pause-auto-load-temporarily":new ei(["alt+p"],()=>{i.autoLoad=!i.autoLoad,i.autoLoad?(i.abort(n.currIndex,ve.conf.restartIdleLoader/3),ye.emit("notify-message","info","Auto load Restarted",3e3)):ye.emit("notify-message","info","Auto load Pause",3e3)}),"exit-full-view-grid":new ei(["escape"],()=>ye.emit("toggle-main-view",!1)),"columns-increase":new ei(["="],()=>r("colCount","add")),"columns-decrease":new ei(["-"],()=>r("colCount","minus")),"toggle-auto-play":new ei(["p"],()=>ye.emit("toggle-auto-play")),"retry-fetch-next-page":new ei(["alt+n"],()=>ye.emit("pf-retry-extend")),"resize-flow-vision":new ei(["alt+r"],()=>ye.emit("fvg-layout-resize")),"start-download":new ei(["shift+alt+d"],()=>ye.emit("start-download",()=>a.minify("fullViewGrid",!1))),"go-prev-chapter":new ei(["shift+alt+w"],()=>ye.emit("pf-step-chapters","prev"),!0),"go-next-chapter":new ei(["alt+w"],()=>ye.emit("pf-step-chapters","next"),!0)};return{inBigImageMode:e,inFullViewGrid:s,inMain:{"open-full-view-grid":new ei(["enter"],()=>{const e=document.activeElement;e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement||ye.emit("toggle-main-view",!0)},!0),"start-download":new ei(["shift+alt+d"],()=>{ye.emit("start-download",()=>a.minify("exit",!1))},!0)}}}();let w=null;return{modNumberConfigEvent:r,modBooleanConfigEvent:o,modSelectConfigEvent:c,modTextConfigEvent:function(t,n){const i=k(`#${t}TextInput`,e.config.panel);n?i.value=n:n=i.value,ve.conf[t]=n,p({[t]:n},ve.conf.selectedSiteNameConfig)},togglePanelEvent:function t(n,i,a){const r=`${n}-panel`,o=k("#"+r,e.pageHelper);o&&(void 0!==i?i?d(o,r):(Array.from(e.root.querySelectorAll(".p-panel")).filter(e=>e!==o).forEach(e=>d(e,e.id)),o.classList.remove("p-collapse"),a&&z(o,a,e.root.clientWidth,e.root.clientHeight)):t(n,!o.classList.contains("p-collapse"),a))},showFullViewGrid:function(){e.root.classList.remove("ehvp-root-collapse"),t.visible?(t.root.focus(),a.minify("bigImageFrame")):(e.fullViewGrid.focus(),a.minify("fullViewGrid")),document.body.style.overflow="hidden"},hiddenFullViewGrid:function(){a.minify("exit"),e.entryBTN.setAttribute("data-stage","exit"),e.root.classList.add("ehvp-root-collapse"),t.visible?t.root.blur():e.fullViewGrid.blur(),document.body.style.overflow=f},fullViewGridKeyBoardEvent:function(t){if(e.root.classList.contains("ehvp-root-collapse"))return;const n=B(t),i=Object.entries(b.inFullViewGrid).find(([e,t])=>{const i=ve.conf.keyboards.inFullViewGrid[e];return void 0!==i&&i.length>0?i.includes(n):t.defaultKeys.includes(n)});if(i){const[e,n]=i;n.noPreventDefault||t.preventDefault(),n.cb(t)}else t instanceof KeyboardEvent&&1===t.key.length&&t.key>="0"&&t.key<="9"&&(w=w?[...w,Number(t.key)]:[Number(t.key)],t.preventDefault())},bigImageFrameKeyBoardEvent:function(t){if(e.bigImageFrame.classList.contains("big-img-frame-collapse"))return;const n=B(t),i=Object.entries(b.inBigImageMode).find(([e,t])=>{const i=ve.conf.keyboards.inBigImageMode[e];return void 0!==i&&i.length>0?i.includes(n):t.defaultKeys.includes(n)});if(!i)return;const[a,r]=i;r.noPreventDefault||t.preventDefault(),r.cb(t)},keyboardEvent:function(t){if(!e.root.classList.contains("ehvp-root-collapse"))return;if(!e.bigImageFrame.classList.contains("big-img-frame-collapse"))return;const n=B(t),i=Object.entries(b.inMain).find(([e,t])=>{const i=ve.conf.keyboards.inMain[e];return void 0!==i&&i.length>0?i.includes(n):t.defaultKeys.includes(n)});if(!i)return;const[a,r]=i;r.noPreventDefault||t.preventDefault(),r.cb(t)},showGuideEvent:function(){!function(e,t){const n=`\n<div class="ehvp-custom-panel">\n  <div class="ehvp-custom-panel-title">\n    <span>${pe.showHelp.get()}</span>\n    <span id="ehvp-custom-panel-close" class="ehvp-custom-panel-close">✖</span>\n  </div>\n  <div class="ehvp-custom-panel-container ehvp-help-panel">\n    <div class="ehvp-custom-panel-content">${pe.help.get()}</div>\n  </div>\n</div>\n`,i=document.createElement("div");i.classList.add("ehvp-full-panel"),i.innerHTML=n;const a=()=>{i.remove(),t?.()};i.addEventListener("click",e=>{e.target.classList.contains("ehvp-full-panel")&&a()}),e.appendChild(i),i.querySelector(".ehvp-custom-panel-close").addEventListener("click",a)}(e.root,u)},collapsePanelEvent:d,abortMouseleavePanelEvent:g,showKeyboardCustomEvent:function(){!function(e,t,n){function i(t,n,a,r){const o=`<span data-id="${a}" data-key="${r}" class="ehvp-custom-panel-item-value"><span>${r}</span><span class="ehvp-custom-btn ehvp-custom-btn-plain" style="padding:0;border:none;">&nbspx&nbsp</span></span>`,s=document.createElement("div");s.innerHTML=o;const l=s.firstElementChild;t.before(l),l.querySelector(".ehvp-custom-btn").addEventListener("click",o=>{const s=ve.conf.keyboards[n][a];if(s&&s.length>0){const e=s.indexOf(r);-1!==e&&s.splice(e,1),0===s.length&&delete ve.conf.keyboards[n][a],p({keyboards:ve.conf.keyboards})}o.target.parentElement.remove(),0===Array.from(t.parentElement.querySelectorAll(".ehvp-custom-panel-item-value")).length&&e[n][a].defaultKeys.forEach(e=>i(t,n,a,e))}),s.remove()}const a=`\n<div class="ehvp-custom-panel">\n  <div class="ehvp-custom-panel-title">\n    <span>${pe.showKeyboard.get()}</span>\n    <span id="ehvp-custom-panel-close" class="ehvp-custom-panel-close">✖</span>\n  </div>\n  <div class="ehvp-custom-panel-container">\n    <div class="ehvp-custom-panel-content">\n      ${Object.entries(e.inMain).map(([e])=>`\n        <div class="ehvp-custom-panel-item">\n         <div class="ehvp-custom-panel-item-title">\n           <span>${pe.keyboard[e].get()}</span>\n         </div>\n         <div class="ehvp-custom-panel-item-values">\n           \x3c!-- wait element created from button event --\x3e\n           <button class="ehvp-add-keyboard-btn ehvp-custom-btn ehvp-custom-btn-green" style="margin-left: 0.2em;" data-cate="inMain" data-id="${e}">+</button>\n         </div>\n        </div>\n      `).join("")}\n    </div>\n    <div class="ehvp-custom-panel-content">\n      ${Object.entries(e.inFullViewGrid).map(([e])=>`\n        <div class="ehvp-custom-panel-item">\n         <div class="ehvp-custom-panel-item-title">\n           <span>${pe.keyboard[e].get()}</span>\n         </div>\n         <div class="ehvp-custom-panel-item-values">\n           \x3c!-- wait element created from button event --\x3e\n           <button class="ehvp-add-keyboard-btn ehvp-custom-btn ehvp-custom-btn-green" style="margin-left: 0.2em;" data-cate="inFullViewGrid" data-id="${e}">+</button>\n         </div>\n        </div>\n      `).join("")}\n    </div>\n    <div class="ehvp-custom-panel-content">\n      ${Object.entries(e.inBigImageMode).map(([e])=>`\n        <div class="ehvp-custom-panel-item">\n         <div class="ehvp-custom-panel-item-title">\n           <span>${pe.keyboard[e].get()}</span>\n         </div>\n         <div class="ehvp-custom-panel-item-values">\n           \x3c!-- wait element created from button event --\x3e\n           <button class="ehvp-add-keyboard-btn ehvp-custom-btn ehvp-custom-btn-green" style="margin-left: 0.2em;display:inline-block;" data-cate="inBigImageMode" data-id="${e}">+</button>\n         </div>\n        </div>\n      `).join("")}\n    </div>\n  </div>\n</div>\n`,r=document.createElement("div");r.classList.add("ehvp-full-panel"),r.innerHTML=a;const o=()=>{r.remove(),n?.()};r.addEventListener("click",e=>{e.target.classList.contains("ehvp-full-panel")&&o()}),t.appendChild(r),r.querySelector(".ehvp-custom-panel-close").addEventListener("click",o),r.querySelectorAll(".ehvp-add-keyboard-btn").forEach(t=>{const n=t.getAttribute("data-cate"),a=t.getAttribute("data-id");let r=ve.conf.keyboards[n][a];void 0!==r&&0!==r.length||(r=e[n][a].defaultKeys),r.forEach(e=>i(t,n,a,e));const o=e=>{if(e.preventDefault(),e instanceof KeyboardEvent){const t=e.key.toLowerCase();if("alt"===t||"shift"===t||"control"===t||"meta"===t)return}const s=B(e);void 0!==ve.conf.keyboards[n][a]?ve.conf.keyboards[n][a].push(s):ve.conf.keyboards[n][a]=r.concat(s),p({keyboards:ve.conf.keyboards}),i(t,n,a,s),t.textContent="+",t.removeAttribute("d-pressing"),t.removeEventListener("keyup",o),t.removeEventListener("mouseup",o)};t.addEventListener("click",e=>{e.preventDefault(),t.textContent="Press Key",t.setAttribute("d-pressing",""),t.addEventListener("keyup",o,{once:!1}),t.addEventListener("mouseup",o,{once:!1})}),t.addEventListener("mouseleave",()=>{t.textContent="+",t.removeAttribute("d-pressing"),t.removeEventListener("keyup",o),t.removeEventListener("mouseup",o)})})}(b,e.root,u)},showSiteProfilesEvent:function(){!function(e,t){const n=ve.matchers,i=n.map(e=>{const t=e.name,n=h(t),i="id-"+s(t).replaceAll(/[+=\/]/g,"-");return`<li data-index="${i}" class="ehvp-custom-panel-list-item">\n             <div class="ehvp-custom-panel-list-item-title">\n               <div style="font-size: 1.2em;font-weight: 800;">${t}</div>\n               <div>\n                 <label class="ehvp-custom-panel-checkbox"><span>${pe.enable.get()}: </span><input id="${i}-enable-checkbox" ${n.enable??1?"checked":""} type="checkbox"></label>\n                 <label class="ehvp-custom-panel-checkbox"><span>${pe.addRegexp.get()}: </span><span id="${i}-add-workurl" class="ehvp-custom-btn ehvp-custom-btn-green">&nbsp+&nbsp</span></label>\n               </div>\n             </div>\n             <div id="${i}-workurls"></div>\n           </li>`}),a=`\n<div class="ehvp-custom-panel">\n  <div class="ehvp-custom-panel-title">\n    <span>\n      <span>${pe.showSiteProfiles.get()}</span>\n      <span style="font-size:0.5em;">\n        <span class="p-tooltip"> ${pe.enable.get()}? <span class="p-tooltiptext">${pe.enableTooltips.get()}</span></span>\n        <span class="p-tooltip"> ${pe.enableAutoOpen.get()}? <span class="p-tooltiptext">${pe.enableAutoOpenTooltips.get()}</span></span>\n        <span class="p-tooltip"> ${pe.enableFlowVision.get()}? <span class="p-tooltiptext">${pe.enableFlowVisionTooltips.get()}</span></span>\n      </span>\n    </span>\n    <span id="ehvp-custom-panel-close" class="ehvp-custom-panel-close">✖</span>\n  </div>\n  <div class="ehvp-custom-panel-container">\n    <div class="ehvp-custom-panel-content">\n      <ul class="ehvp-custom-panel-list">\n      ${i.join("")}\n      </ul>\n    </div>\n  </div>\n</div>\n`,r=document.createElement("div");r.classList.add("ehvp-full-panel"),r.innerHTML=a;const o=()=>{r.remove(),t?.()};r.addEventListener("click",e=>{e.target.classList.contains("ehvp-full-panel")&&o()}),e.appendChild(r),r.querySelector(".ehvp-custom-panel-close").addEventListener("click",o),n.forEach(e=>{const t=e.name,n="id-"+s(t).replaceAll(/[+=\/]/g,"-"),i=e.workURLs.map(e=>e.source),a=()=>h(t),o=k(`#${n}-enable-checkbox`,r);o.addEventListener("click",()=>{p({enable:o.checked})});const l=k(`#${n}-add-workurl`,r),c=k(`#${n}-workurls`,r),d=(t,n)=>{const r=n.workURLs?.indexOf(t)??-1;let o=!1;r>-1&&(n.workURLs.splice(r,1),o=!0),0===(n.workURLs?.length??0)&&(n.workURLs=void 0,o=!0,D(i,c,e=>{d(e,a())})),o&&p({workURLs:n.workURLs},e.name)};l.addEventListener("click",()=>{const t=document.createElement("div");t.addEventListener("click",e=>e.target===t&&t.remove()),t.setAttribute("style","position:absolute;width:100%;height:100%;"),r.appendChild(t),function(n,r){const o=document.createElement("div");o.style.position="fixed",o.style.lineHeight="2em",o.id="input-element",o.innerHTML='<input type="text" style="width:20em;height:2em;"><button class="ehvp-custom-btn ehvp-custom-btn-plain">&nbsp√&nbsp</button>',n.appendChild(o);const s=o.querySelector("input");o.querySelector("button").addEventListener("click",()=>{(n=>{if(!n)return;try{new RegExp(n)}catch(e){return}t.remove();const r=a();r.workURLs||(r.workURLs=[...i]),r.workURLs.push(n),p({workURLs:r.workURLs},e.name),D(r.workURLs,c,e=>{d(e,a())})})(s.value),o.remove()}),z(o,r,n.offsetWidth,n.offsetHeight)}(t,l)}),D(a().workURLs??i,c,e=>{d(e,a())})}),r.querySelectorAll(".p-tooltip").forEach(t=>{const n=t.querySelector(".p-tooltiptext");n&&(t.addEventListener("mouseenter",()=>{n.style.display="block",z(n,t,e.offsetWidth,e.offsetHeight)}),t.addEventListener("mouseleave",()=>n.style.display="none"))})}(e.root,u)},showStyleCustomEvent:function(){!function(e,t){const n=`\n<div class="ehvp-custom-panel" style="min-width:30vw;">\n  <div class="ehvp-custom-panel-title">\n    <span>${pe.showStyleCustom.get()}</span>\n    <span id="ehvp-custom-panel-close" class="ehvp-custom-panel-close">✖</span>\n  </div>\n  <div class="ehvp-custom-panel-container">\n    <div class="ehvp-custom-panel-content">\n      <div id="control-bar-example-container"></div>\n      <div style="margin-top:1em;line-height:2em;">\n        <input id="b-main-btn-custom-input" style="width: 30%;" type="text">\n        <span id="b-main-btn-custom-confirm" class="ehvp-custom-btn ehvp-custom-btn-green">&nbspOk&nbsp</span>\n        <span id="b-main-btn-custom-reset" class="ehvp-custom-btn ehvp-custom-btn-plain">&nbspReset&nbsp</span>\n        <span id="b-main-btn-custom-preset1" class="ehvp-custom-btn ehvp-custom-btn-plain">&nbspPreset1&nbsp</span>\n        <span id="b-main-btn-custom-preset2" class="ehvp-custom-btn ehvp-custom-btn-plain">&nbspPreset2&nbsp</span>\n      </div>\n      <div><span style="font-size:0.6em;color:#888;">${pe.controlBarStyleTooltip.get()}</span></div>\n    </div>\n    <div class="ehvp-custom-panel-content" style="position:relative;">\n      <div>\n        <span class="ehvp-style-preset-btn ehvp-custom-btn ehvp-custom-btn-green" data-index="0">Preset 1</span>\n        <span class="ehvp-style-preset-btn ehvp-custom-btn ehvp-custom-btn-green" data-index="1">Preset 2</span>\n        <span class="ehvp-style-preset-btn ehvp-custom-btn ehvp-custom-btn-green" data-index="2">Preset 3</span>\n        <span class="ehvp-style-preset-btn ehvp-custom-btn ehvp-custom-btn-green" data-index="3">Preset 4</span>\n        <span class="ehvp-style-preset-btn ehvp-custom-btn ehvp-custom-btn-plain" data-index="99">Reset</span>\n      </div>\n      <textarea id="style-custom-input" style="width: 100%; height: 50vh;border:none;background-color:#00000090;color:#97ff97;text-align:left;vertical-align:top;font-size:1.2em;font-weight:600;">${ve.conf.customStyle??""}</textarea>\n      <span style="position:absolute;bottom:2em;right:1em;" class="ehvp-custom-btn ehvp-custom-btn-green" id="style-custom-confirm">&nbspApply&nbsp</span>\n    </div>\n  </div>\n</div>\n`,i=document.createElement("div");i.classList.add("ehvp-full-panel"),i.innerHTML=n;const a=()=>{i.remove(),t?.()};i.addEventListener("click",e=>{e.target.classList.contains("ehvp-full-panel")&&a()}),e.appendChild(i),i.querySelector(".ehvp-custom-panel-close").addEventListener("click",a);const r=i.querySelector("#control-bar-example-container");let o;r.innerHTML=F();const s=()=>{Array.from(i.querySelectorAll(".s-pickable[data-key]")).forEach(e=>{e.addEventListener("click",()=>{o=e.getAttribute("data-key")||void 0,l.value="",o&&l.focus()})})};s();const l=i.querySelector("#b-main-btn-custom-input"),c=i.querySelector("#b-main-btn-custom-confirm"),d=i.querySelector("#b-main-btn-custom-reset"),h=()=>{const e=l.value;l.value="",e&&o&&(ve.conf.displayText[o]=e,p({displayText:ve.conf.displayText}),r.innerHTML=F(),s())};c.addEventListener("click",h),l.addEventListener("keypress",e=>"Enter"===e.key&&h()),d.addEventListener("click",()=>{l.value="",ve.conf.displayText={},p({displayText:ve.conf.displayText}),r.innerHTML=F(),s()});for(let e=0;e<2;e++)i.querySelector(`#b-main-btn-custom-preset${e+1}`).addEventListener("click",()=>{ve.conf.displayText=[{entry:"ENTER",collapse:"X",config:"C",download:"D",chapters:"CH.",filter:"FL.",fin:"F",pagination:"P",continuous:"C",horizontal:"H",autoPagePlay:"PLAY",autoPagePause:"PAUSE"},{entry:"<✿>",collapse:">✴<",config:"☸",download:"⬇",chapters:"CH.",filter:"⌕",fin:"⬇",pagination:"❏",continuous:"⇅",horizontal:"⇆",autoPagePlay:"⊳",autoPagePause:"⇢⇢⇢"}][e]??{},p({displayText:ve.conf.displayText}),r.innerHTML=F(),s()});const g=i.querySelector("#style-custom-input"),u=i.querySelector("#style-custom-confirm");g.addEventListener("keydown",e=>{if("Tab"===e.key){e.preventDefault();const t=g.selectionStart,n=g.value.slice(0,t),i=g.value.slice(t);g.value=n+"  "+i,g.selectionStart=t+2,g.selectionEnd=t+2}});const m=t=>{e.querySelector("#ehvp-style-custom")?.remove();const n=document.createElement("style");n.id="ehvp-style-custom",ve.conf.customStyle=t,p({customStyle:t}),n.innerHTML=t,e.appendChild(n)};u.addEventListener("click",()=>m(g.value)),i.querySelectorAll(".ehvp-style-preset-btn").forEach(e=>{e.addEventListener("click",()=>{const t=(n=parseInt(e.getAttribute("data-index")??"0"),[`.ehvp-root {\n  --ehvp-theme-bg-color: #393939db;\n  --ehvp-theme-font-color: #fff;\n  --ehvp-thumbnail-list-bg: #000000;\n  --ehvp-thumbnail-border-size: 2px;\n  --ehvp-thumbnail-border-radius: 0px;\n  --ehvp-thumbnail-box-shadow: none;\n  --ehvp-img-fetched: #95ff97;\n  --ehvp-img-failed: red;\n  --ehvp-img-init: #ffffff;\n  --ehvp-img-fetching: #00000000;\n  --ehvp-controlbar-border: none;\n  --ehvp-panel-border: none;\n  --ehvp-panel-box-shadow: none;\n  --ehvp-big-images-gap: 0px;\n  --ehvp-big-images-bg: #000000c4;\n  --ehvp-clickable-color-hover: #90ea90;\n  --ehvp-playing-progress-bar-color: #ffffffd0;\n  ${ge?"":"font-size: 16px;"}\n  font-family: Poppins,sans-serif;\n}\n/** override any style here, make the big image have a green border */\n/**\n.bifm-container > div {\n  border: 2px solid green;\n}\n*/`,`.ehvp-root {\n  --ehvp-theme-bg-color: #ffffff;\n  --ehvp-theme-font-color: #760098;\n  --ehvp-thumbnail-list-bg: #ffffff;\n  --ehvp-thumbnail-border-size: 2px;\n  --ehvp-thumbnail-border-radius: 4px;\n  --ehvp-thumbnail-box-shadow: 0px 2px 2px 0px #785174;\n  --ehvp-img-fetched: #d96cff;\n  --ehvp-img-failed: red;\n  --ehvp-img-init: #000000;\n  --ehvp-img-fetching: #ffffff70;\n  --ehvp-controlbar-border: 2px solid #760098;\n  --ehvp-panel-border: 2px solid #760098;\n  --ehvp-panel-box-shadow: none;\n  --ehvp-big-images-gap: 0px;\n  --ehvp-big-images-bg: #919191b0;\n  --ehvp-clickable-color-hover: #ff87ba;\n  --ehvp-playing-progress-bar-color: #760098d0;\n  ${ge?"":"font-size: 16px;"}\n  font-family: Poppins, sans-serif;\n}`,`.ehvp-root {\n  --ehvp-theme-bg-color: #000000c9;\n  --ehvp-theme-font-color: #ffe637;\n  --ehvp-thumbnail-list-bg: #000000;\n  --ehvp-thumbnail-border-size: 2px;\n  --ehvp-thumbnail-border-radius: 0px;\n  --ehvp-thumbnail-box-shadow: none;\n  --ehvp-img-fetched: #ffe637;\n  --ehvp-img-failed: red;\n  --ehvp-img-init: #fff;\n  --ehvp-img-fetching: #00000000;\n  --ehvp-controlbar-border: 2px solid #ffe637;\n  --ehvp-panel-border: 2px solid #ffe637;\n  --ehvp-panel-box-shadow: none;\n  --ehvp-big-images-gap: 0px;\n  --ehvp-big-images-bg: #000000d6;\n  --ehvp-clickable-color-hover: #90ea90;\n  --ehvp-playing-progress-bar-color: #ffe637d0;\n  ${ge?"":"font-size: 16px;"}\n  font-family: Poppins, sans-serif;\n}`,`.ehvp-root {\n  --ehvp-theme-bg-color: #ffffff;\n  --ehvp-theme-font-color: #000000;\n  --ehvp-thumbnail-list-bg: #ffffff;\n  --ehvp-thumbnail-border-size: 2px;\n  --ehvp-thumbnail-border-radius: 4px;\n  --ehvp-thumbnail-box-shadow: 0px 2px 2px 0px #000000;\n  --ehvp-img-fetched: #000000;\n  --ehvp-img-failed: red;\n  --ehvp-img-init: #ffffff;\n  --ehvp-img-fetching: #ffffff70;\n  --ehvp-controlbar-border: 2px solid #000000;\n  --ehvp-panel-border: 2px solid #000000;\n  --ehvp-panel-box-shadow: none;\n  --ehvp-big-images-gap: 0px;\n  --ehvp-big-images-bg: #919191b0;\n  --ehvp-clickable-color-hover: #ff0000;\n  --ehvp-playing-progress-bar-color: #000000d0;\n  ${ge?"":"font-size: 16px;"}\n  font-family: Poppins, sans-serif;\n}`][n]??"");var n;g.value=t,m(t)})})}(e.root,u)},showActionCustomEvent:function(){!function(e,t){function n(){s.innerHTML="";const e=document.createElement("div");ve.conf.imgNodeActions.map(t=>{const a=`<span class="ehvp-custom-panel-item-value"><span class="ehvp-span-action-icon">${t.icon}</span><span class="ehvp-custom-btn ehvp-custom-btn-plain" style="padding:0;border:none;">&nbspx&nbsp</span></span>`;e.innerHTML=a;const r=e.firstElementChild;s.append(r),r.querySelector(".ehvp-custom-btn").addEventListener("click",()=>{const e=ve.conf.imgNodeActions.findIndex(e=>e.icon===t.icon&&e.funcBody===t.funcBody);-1!==e&&(i(t),ve.conf.imgNodeActions.splice(e,1),p({imgNodeActions:ve.conf.imgNodeActions}),n())}),r.querySelector(".ehvp-span-action-icon").addEventListener("click",()=>i(t))}),e.remove()}function i(e){l.value=e.icon,c.value=e.description,d.value=e.workon??"",h.value=e.funcBody}const a=`\n<div class="ehvp-custom-panel" style="min-width:30vw;">\n  <div class="ehvp-custom-panel-title">\n    <span>${pe.showActionCustom.get()}</span>\n    <span id="ehvp-custom-panel-close" class="ehvp-custom-panel-close">✖</span>\n  </div>\n\n  <div class="ehvp-custom-panel-container">\n\n    <div class="ehvp-custom-panel-content">\n      <div class="ehvp-custom-panel-item">\n       <div class="ehvp-custom-panel-item-title">\n         <span>${pe.showActionCustom.get()}</span>\n       </div>\n       <div id="ehvp-image-action-values" class="ehvp-custom-panel-item-values">\n         \x3c!-- wait element created from button event --\x3e\n       </div>\n      </div>\n    </div>\n\n    <div class="ehvp-custom-panel-content">\n      <div class="ehvp-custom-panel-item">\n        <div class="ehvp-custom-panel-item-title">\n         <span>${pe.example.get()}</span>\n        </div>\n        <div>\n          <span class="ehvp-action-preset-btn ehvp-custom-btn ehvp-custom-btn-green" data-index="0">Example 1</span>\n          <span class="ehvp-action-preset-btn ehvp-custom-btn ehvp-custom-btn-green" data-index="1">Example 2</span>\n          <span class="ehvp-action-preset-btn ehvp-custom-btn ehvp-custom-btn-green" data-index="2">Example 3</span>\n          <span class="ehvp-action-preset-btn ehvp-custom-btn ehvp-custom-btn-green" data-index="3">Example 4</span>\n        </div>\n      </div>\n    </div>\n\n    <div class="ehvp-custom-panel-content" style="position:relative;">\n      <div><span style="font-size:1.6em;color:#888;">${pe.description.get()}</span></div>\n      <div>\n        <div>\n          <label>\n            <span>${pe.icon.get()}</span>\n            <input id="ehvp-action-input-icon" style="width: 2em;" type="text">\n          </label>\n        </div>\n        <div>\n          <label>\n            <span>${pe.description.get()} (${pe.optional.get()})</span>\n            <input id="ehvp-action-input-desc" style="width: 98%;" type="text">\n          </label>\n        </div>\n        <div>\n          <label>\n            <span>${pe.workon.get()} (${pe.optional.get()},${pe.regexp.get()})</span>\n            <input id="ehvp-action-input-workon" style="width: 98%;" type="text">\n          </label>\n        </div>\n      </div>\n      <div><span style="font-size:1.6em;color:#888;">${pe.function.get()} ${pe.parameters.get()}</span></div>\n      <div>\n        <a class="ehvp-custom-btn-green" target="_blank" href="https://github.com/MapoMagpie/eh-view-enhance/blob/9ec4f7970983501ca3c5d8165c455a2654b52bf6/src/img-fetcher.ts#L30">imf</a>\n        <a class="ehvp-custom-btn-green" target="_blank" href="https://github.com/MapoMagpie/eh-view-enhance/blob/9ec4f7970983501ca3c5d8165c455a2654b52bf6/src/img-node.ts#L47">imn</a>\n        <a class="ehvp-custom-btn-green" target="_blank" href="https://www.tampermonkey.net/documentation.php?locale=en#api:GM_xmlhttpRequest">gm_xhr</a>\n        <a class="ehvp-custom-btn-green" target="_blank" href="https://github.com/MapoMagpie/eh-view-enhance/blob/9ec4f7970983501ca3c5d8165c455a2654b52bf6/src/event-bus.ts#L8">EBUS</a>\n      </div>\n      <div><span style="font-size:1.6em;color:#888;">${pe.function.get()} ${pe.body.get()}</span></div>\n      <textarea id="ehvp-action-input-funcbody" style="min-width: 60vw; height: 50vh;border:none;background-color:#00000090;color:#97ff97;text-align:left;vertical-align:top;font-size:1.2em;font-weight:600;"></textarea>\n      <span id="ehvp-action-add-confirm" style="position:absolute;bottom:2em;right:1em;" class="ehvp-custom-btn ehvp-custom-btn-green">&nbspAdd&nbsp</span>\n    </div>\n\n  </div>\n</div>\n`,r=document.createElement("div");r.classList.add("ehvp-full-panel"),r.innerHTML=a;const o=()=>{r.remove(),t?.()};r.addEventListener("click",e=>{e.target.classList.contains("ehvp-full-panel")&&o()}),e.appendChild(r),r.querySelector(".ehvp-custom-panel-close").addEventListener("click",o);const s=r.querySelector("#ehvp-image-action-values"),l=r.querySelector("#ehvp-action-input-icon"),c=r.querySelector("#ehvp-action-input-desc"),d=r.querySelector("#ehvp-action-input-workon"),h=r.querySelector("#ehvp-action-input-funcbody"),g=r.querySelector("#ehvp-action-add-confirm");n(),r.querySelectorAll(".ehvp-action-preset-btn").forEach(e=>{e.addEventListener("click",()=>{const t=[{icon:"S",description:"Upload this image to local (miniserve --port 14001 --upload-files . .)",workon:"e[-x]hentai.org|x.com|pixiv.com",funcBody:'\nif (imf.stage === 3 && imf.data) {\n  const formData = new FormData();\n  formData.append("file", new Blob([imf.data]), imn.title);\n  formData.append("path", "/");\n  const p = new Promise((resolve, reject) => {\n    gm_xhr({\n      url: "http://localhost:14001/upload?path=/",\n      method: "POST",\n      timeout: 10 * 1000,\n      data: formData,\n      onload: () => resolve(true),\n      onabort: () => reject("abort"),\n      onerror: (ev) => reject(ev.error),\n      ontimeout: () => reject("timeout"),\n    });\n  });\n  await p;\n}\n  '},{icon:"换",description:"Download and Replace this image",workon:".*",funcBody:'\nconst p = new Promise((resolve, reject) => {\n  gm_xhr({\n    url: "https://media.senscritique.com/media/000022161329/0/les_miserables_shoujo_cosette.jpg",\n    method: "GET",\n    responseType: "blob",\n    timeout: 10 * 1000,\n    onload: (ev) => resolve(ev.response),\n    onabort: () => reject("abort"),\n    onerror: (ev) => reject(ev.error),\n    ontimeout: () => reject("timeout"),\n  });\n});\nconst data = await p;\nreturn {data};\n  '},{icon:"✔",description:"Cherry pick this image",funcBody:'EBUS.emit("add-cherry-pick-range", imf.chapterIndex, imf.index, true, false);'},{icon:"✖",description:"Cherry pick but exclude this image",funcBody:'EBUS.emit("add-cherry-pick-range", imf.chapterIndex, imf.index, false, false);'}][parseInt(e.getAttribute("data-index")??"0")];t&&i(t)})}),h.addEventListener("keydown",e=>{if("Tab"===e.key){e.preventDefault();const t=h.selectionStart,n=h.value.slice(0,t),i=h.value.slice(t);h.value=n+"  "+i,h.selectionStart=t+2,h.selectionEnd=t+2}}),g.addEventListener("click",()=>function(){const e=l.value,t=c.value,i=d.value,a=h.value;if(e)if(a){try{(0,async function(){}.constructor)("imf","imn","gm_xhr","EBUS",a)}catch(e){return void confirm("cannot create function (this site limit), "+e)}if(i)try{new RegExp(i)}catch(e){return void confirm("invalid regexp: "+e)}ve.conf.imgNodeActions.push({icon:e,description:t,workon:i,funcBody:a}),p({imgNodeActions:ve.conf.imgNodeActions}),n(),r.querySelector(".ehvp-custom-panel-container")?.scrollTo({top:0})}else confirm("func body cannot be empty!");else confirm("icon cannot be empty!")}())}(e.root,u)},changeReadModeEvent:l}}function G(e,t,n,i){const a={vw:e,vh:t};return n<=e/2?a.left=Math.max(n,5):a.right=Math.max(e-n,5),i<=t/2?a.top=Math.max(i,5):a.bottom=Math.max(t-i,5),a}function W(e){const t=e.i18nKey||e.key,n=pe[t],i=pe[`${t}Tooltip`];if(!n)throw new Error(`i18n key ${t} not found`);let a=!0;e.displayInSite&&(a=e.displayInSite.test(location.href));const r=ve.conf.selectedSiteNameConfig?ve.conf:ve.globalConf;let o="";switch(e.typ){case"boolean":o=`<input id="${e.key}Checkbox" ${r[e.key]?"checked":""} type="checkbox" />`;break;case"number":o=`<span>\n                  <button id="${e.key}MinusBTN" class="p-btn" type="button">-</button>\n                  <input id="${e.key}Input" value="${r[e.key]}" disabled type="text" />\n                  <button id="${e.key}AddBTN" class="p-btn" type="button">+</button></span>`;break;case"select":if(!e.options)throw new Error(`options for ${e.key} not found`);const t=e.options.map(t=>`<option value="${t.value}" ${r[e.key]==t.value?"selected":""}>${t.display}</option>`).join("");o=`<select id="${e.key}Select">${t}</select>`;break;case"input":o=`<span><input id="${e.key}TextInput" ${r[e.key]?"value="+r[e.key]:""} class="text-input" placeholder="${e.placeholder??""}" type="text" /></span>`}const[s,l]=e.gridColumnRange?e.gridColumnRange:[1,11];return`<div class="config-panel-item" style="grid-column-start: ${s}; grid-column-end: ${l}; padding-left: 5px;${a?"":" display: none;"}"><label class="p-label"><span><span>${n.get()}</span><span class="p-tooltip">${i?" ?:":" :"}<span class="p-tooltiptext">${i?.get()||""}</span></span></span>${o}</label></div>`}function Z(e,t,n){e.addEventListener("mousedown",n=>{const{left:i}=e.getBoundingClientRect(),a=n=>{const a=n.clientX-i,r=Math.round(a/e.clientWidth*100);t(r)};a(n),e.addEventListener("mousemove",a),e.addEventListener("mouseup",()=>{e.removeEventListener("mousemove",a)},{once:!0}),e.addEventListener("mouseleave",()=>{e.removeEventListener("mousemove",a)},{once:!0})},{signal:n})}function X(e){return`${Math.floor(e/60).toString().padStart(2,"0")}:${Math.floor(e%60).toString().padStart(2,"0")}`}function K(e,t){const n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)}function Y(e){if(!e)return-1;const t=e.getAttribute("d-index")||"",n=parseInt(t);return isNaN(n)?-1:n}function J(){function e(e){i.pageHelper&&(e?(d.showFullViewGrid(),h.first&&(h.first=!1,ye.emit("pf-init",()=>{}))):(["config","downloader"].forEach(e=>d.togglePanelEvent(e,!0)),d.hiddenFullViewGrid()))}const t=ve.matcher.constructor(),n=new wi,i=function(e){const t=document.createElement("div"),n=V();t.id="ehvp-base",t.setAttribute("style","all: initial"),document.body.after(t);const i=`\n<div id="page-loading" class="page-loading" style="display: none;">\n    <div class="page-loading-text border-ani">Loading...</div>\n</div>\n<div id="message-box" class="ehvp-message-box"></div>\n<div id="ehvp-nodes-container" class="full-view-grid" tabindex="6"></div>\n<div id="big-img-frame" class="big-img-frame big-img-frame-collapse" tabindex="7">\n   <a id="img-land-left" class="img-land img-land-left"></a>\n   <a id="img-land-right" class="img-land img-land-right"></a>\n</div>\n<div id="p-helper" class="p-helper">\n    <div>\n        ${oi.html()}\n        ${ri.html()}\n        ${si.html()}\n        ${li.html()}\n    </div>\n    <div id="b-main" class="b-main">\n        <a id="entry-btn" class="b-main-item clickable" data-display-texts="${n.entry},${n.collapse}">${n.entry}</a>\n        <div id="page-status" class="b-main-item" hidden>\n            <a class="clickable" id="p-curr-page" style="color:#ffc005;">1</a><span id="p-slash-1">/</span><span id="p-total">0</span>\n        </div>\n        <div id="fin-status" class="b-main-item" hidden>\n            <span>${n.fin}:</span><span id="p-finished">0</span>\n        </div>\n        <a id="auto-page-btn" class="b-main-item clickable" hidden data-status="paused" data-display-texts="${n.autoPagePlay},${n.autoPagePause}">\n           <span>${n.autoPagePlay}</span>\n           <div id="auto-page-progress"></div>\n        </a>\n        <a id="config-panel-btn" class="b-main-item clickable" hidden>${n.config}</a>\n        <a id="downloader-panel-btn" class="b-main-item clickable" hidden>${n.download}</a>\n        <a id="chapters-panel-btn" class="b-main-item clickable" hidden>${n.chapters}</a>\n        <a id="filter-panel-btn" class="b-main-item clickable" hidden>${n.filter}</a>\n        <div id="read-mode-bar" class="b-main-item" hidden>\n            <div id="read-mode-select"\n            ><a class="b-main-option clickable ${"pagination"===ve.conf.readMode?"b-main-option-selected":""}" data-value="pagination">${n.pagination}</a\n            ><a class="b-main-option clickable ${"continuous"===ve.conf.readMode?"b-main-option-selected":""}" data-value="continuous">${n.continuous}</a\n            ><a class="b-main-option clickable ${"horizontal"===ve.conf.readMode?"b-main-option-selected":""}" data-value="horizontal">${n.horizontal}</a></div>\n        </div>\n        <div id="pagination-adjust-bar" class="b-main-item" hidden>\n            <span>\n              <a id="paginationStepPrev" class="b-main-btn clickable" type="button">&lt;</a>\n              <a id="paginationMinusBTN" class="b-main-btn clickable" type="button">-</a>\n              <span id="paginationInput" class="b-main-input">${ve.conf.paginationIMGCount}</span>\n              <a id="paginationAddBTN" class="b-main-btn clickable" type="button">+</a>\n              <a id="paginationStepNext" class="b-main-btn clickable" type="button">&gt;</a>\n            </span>\n        </div>\n        <div id="scale-bar" class="b-main-item" hidden>\n            <span>\n              <span>${Jn.zoomIcon}</span>\n              <a id="scaleMinusBTN" class="b-main-btn clickable" type="button">-</a>\n              <span id="scaleInput" class="b-main-input" style="width: 3rem; cursor: move;">${ve.conf.imgScale}</span>\n              <a id="scaleAddBTN" class="b-main-btn clickable" type="button">+</a>\n            </span>\n        </div>\n    </div>\n</div>\n`,a=t.attachShadow({mode:"open"}),r=document.createElement("div");r.classList.add("ehvp-root"),r.classList.add("ehvp-root-collapse"),r.innerHTML=i;const o=document.createElement("style");o.innerHTML=`\n.ehvp-root {\n  --ehvp-theme-bg-color: #333343bb;\n  --ehvp-theme-font-color: #fff;\n  --ehvp-thumbnail-list-bg: #000;\n  --ehvp-thumbnail-border-size: 2px;\n  --ehvp-thumbnail-border-radius: 5px;\n  --ehvp-thumbnail-box-shadow: none;\n  --ehvp-img-fetched: #90ffae;\n  --ehvp-img-failed: red;\n  --ehvp-img-init: #fff;\n  --ehvp-img-fetching: #ffffff70;\n  --ehvp-controlbar-border: 1px solid #2f7b10;\n  --ehvp-panel-border: none;\n  --ehvp-panel-box-shadow: none;\n  --ehvp-big-images-gap: 0px;\n  --ehvp-big-images-bg: #000000d6;\n  --ehvp-clickable-color-hover: #90ea90;\n  --ehvp-playing-progress-bar-color: #ffffffd0;\n  font-size: 16px;\n  font-family: Poppins,sans-serif;\n}\n.ehvp-root {\n  width: 100%;\n  height: 100%;\n  background-color: #000;\n  position: fixed;\n  top: 0px;\n  left: 0px;\n  z-index: 2000;\n  box-sizing: border-box;\n  overflow: clip;\n}\n.ehvp-root input[type="checkbox"] {\n  width: 1em;\n  height: unset !important;\n}\n.ehvp-root select {\n  width: 8em;\n  height: 2em;\n}\n.ehvp-root input {\n  width: 3em;\n  height: 1.5em;\n}\n.config-panel-item input.text-input {\n  width: 10em;\n  cursor: auto;\n}\n.ehvp-root-collapse {\n  height: 0;\n}\n.fvg-flow {\n  width: 100%;\n  height: 100%;\n  overflow: hidden scroll;\n  background: var(--ehvp-thumbnail-list-bg);\n}\n.fvg-grid {\n  width: 100%;\n  height: 100%;\n  display: grid;\n  align-content: start;\n  grid-gap: 0.7em;\n  grid-template-columns: repeat(${ve.conf.colCount}, minmax(10px, 1fr));\n  overflow: hidden scroll;\n  padding: 0.3em;\n  box-sizing: border-box;\n  background: var(--ehvp-thumbnail-list-bg);\n}\n.ehvp-root input, .ehvp-root select {\n  color: var(--ehvp-theme-font-color);\n  background-color: var(--ehvp-theme-bg-color);\n  border: 1px solid #000000;\n  border-radius: 4px;\n  margin: 0px;\n  padding: 0px;\n  text-align: center;\n  vertical-align: middle;\n}\n.ehvp-root input:enabled:hover, .ehvp-root select:enabled:hover, .ehvp-root input:enabled:focus, .ehvp-root select:enabled:focus {\n  background-color: #34355b !important;\n}\n.ehvp-root select option {\n  background-color: #34355b !important;\n  color: #f1f1f1;\n  font-size: 1em;\n}\n.p-label {\n  cursor: pointer;\n  height: 2em;\n}\n.p-label > span {\n  white-space: nowrap;\n}\n.p-label > span:first-child {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  position: relative;\n  padding-right: 1.5em;\n}\n.p-label > span:first-child > .p-tooltip {\n  position: absolute;\n  right: 0.2em;\n}\n.full-view-grid, .big-img-frame {\n  outline: none !important;\n}\n.img-node {\n  position: relative;\n  padding: var(--ehvp-thumbnail-border-size);\n  box-sizing: border-box;\n  background-color: var(--ehvp-img-init);\n  border-radius: var(--ehvp-thumbnail-border-radius);\n  box-shadow: var(--ehvp-thumbnail-box-shadow);\n}\n.fvg-sub-container {\n  display: flex;\n  width: 100%;\n  flex-wrap: nowrap;\n  /**\n  contain: content;\n  scollbar-width: none;\n  */\n}\n/**\n.full-view-grid::-webkit-scrollbar {\n  display: none;\n}\n*/\n.fvg-sub-container .img-node {\n  height: 100%;\n}\n.fvg-sub-container .img-node a {\n  width: 100%;\n  height: 100%;\n}\n.img-node canvas, .img-node img {\n  width: 100%;\n  height: 100%;\n  border-radius: var(--ehvp-thumbnail-border-radius);\n}\n.img-node-numtip {\n  position: absolute;\n  top: 0;\n  left: 0.5em;\n  font-size: 1.8em;\n  font-weight: 900;\n  height: 1.8em;\n  line-height: 1.8em;\n  text-shadow: 0px 0px 3px #000000;\n  color: var(--ehvp-theme-font-color);\n  display: none;\n}\n.img-node:hover .img-node-numtip {\n  display: block;\n}\n.img-node > a {\n  display: block;\n  line-height: 0;\n  position: relative;\n  z-index: 1;\n  width: 100%;\n  height: 100%;\n}\n.img-node-actions {\n  position: absolute;\n  bottom: 10px;\n  height: 1.2em;\n  left: 0;\n  z-index: 1;\n}\n.img-node-action-btn {\n  line-height: 1.2em;\n  border: 1px solid #efe;\n  text-align: center;\n  border-radius: 5px;\n  color: #efe;\n  font-weight: 900;\n  background-color: #1f1f1fc7;\n  margin-left: 0.3em;\n  text-shadow: #000 1px 0 10px;\n  cursor: pointer;\n}\n.img-node-action-btn:hover {\n  border: 1px solid yellow;\n  color: yellow;\n}\n.img-node-action-btn-processing {\n  animation: btn-rotate 1s linear infinite;\n}\n.img-node-action-btn-done {\n  border: 1px solid #6eff84;\n  color: #6eff84;\n}\n.img-node-action-btn-error {\n  border: 1px solid red;\n  color: red;\n}\n@keyframes btn-rotate {\n\t0% {\n    transform: rotate(0.0turn);\n\t}\n\t100% {\n    transform: rotate(1.0turn);\n\t}\n}\n.ehvp-chapter-description, .img-node-error-hint {\n  display: block;\n  position: absolute;\n  bottom: 0px;\n  left: 0px;\n  background-color: #708090e3;\n  color: #ffe785;\n  width: 100%;\n  font-weight: 700;\n  min-height: 3em;\n  font-size: 0.8em;\n  padding: 0.5em;\n  box-sizing: border-box;\n  line-height: 1.3em;\n  z-index: 10;\n}\n.img-node-error-hint {\n  color: #8a0000;\n}\n.img-fetched {\n  background-color: var(--ehvp-img-fetched);\n}\n.img-fetch-failed {\n  background-color: var(--ehvp-img-failed);\n}\n.img-fetching {\n  background-color: var(--ehvp-img-fetching);\n}\n.img-excluded {\n  filter: brightness(0.3);\n}\n.img-fetching::after {\n  content: '';\n  position: absolute;\n  top: 0%;\n  left: 0%;\n  width: 30%;\n  height: 30%;\n  background-color: #ff0000;\n  animation: img-loading 1s linear infinite;\n}\n@keyframes img-loading {\n\t25% {\n    background-color: #ff00ff;\n    top: 0%;\n    left: 70%;\n\t}\n\t50% {\n    background-color: #00ffff;\n    top: 70%;\n    left: 70%;\n\t}\n\t75% {\n    background-color: #ffff00;\n    top: 70%;\n    left: 0%;\n\t}\n}\n.big-img-frame::-webkit-scrollbar {\n  display: none;\n}\n.big-img-frame {\n  position: fixed;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  right: 0;\n  overflow: auto;\n  scrollbar-width: none;\n  z-index: 2001;\n  background: var(--ehvp-big-images-bg);\n  display: flex;\n}\n.bifm-container > div {\n  box-sizing: border-box;\n}\n.bifm-container-vert {\n  width: ${ve.conf.imgScale}%;\n  height: fit-content;\n  margin: 0 auto;\n}\n.bifm-container-hori {\n  width: fit-content;\n  height: ${ve.conf.imgScale}%;\n  margin: auto 0;\n  display: flex;\n  flex-wrap: nowrap;\n}\n.bifm-container-page {\n  width: fit-content;\n  height: ${ve.conf.imgScale}%;\n  margin: 0 auto;\n  display: flex;\n  flex-wrap: nowrap;\n}\n.bifm-container-vert > div {\n  margin: var(--ehvp-big-images-gap) 0px;\n}\n.bifm-container-hori > div {\n  margin: 0px var(--ehvp-big-images-gap);\n}\n.bifm-container-page > div {\n  height: 100%;\n  margin: 0px var(--ehvp-big-images-gap);\n  display: flex;\n}\n.bifm-node-hide {\n  position: fixed;\n  left: -100%;\n  z-index: -1000;\n  opacity: 0;\n}\n.bifm-container-page .bifm-img {\n  ${100===ve.conf.imgScale&&1===ve.conf.paginationIMGCount?"max-width: 100%;":""}\n}\n.bifm-img {\n  height: 100%;\n  object-fit: contain;\n  display: block;\n}\n.bifm-rotate-90 {\n  transform: rotate(90deg);\n  width: 100vh;\n  height: 100vw;\n  transform-origin: 0px 0px;\n  left: 100vw;\n}\n.bifm-rotate-180 {\n  transform: rotate(180deg);\n}\n.bifm-rotate-270 {\n  transform: rotate(270deg);\n  width: 100vh;\n  height: 100vw;\n  transform-origin: 0px 0px;\n  left: 0px;\n  top: 100vh;\n}\n#bifm-loading-helper {\n  position: fixed;\n  z-index: 3000;\n  display: none;\n  padding: 0px 3px;\n  background-color: #ffffff90;\n  font-weight: blod;\n  left: 0px;\n}\n.ehvp-root-collapse .big-img-frame {\n  position: unset;\n}\n.p-helper {\n  position: fixed;\n  z-index: 2011 !important;\n  box-sizing: border-box;\n  top: ${ve.conf.pageHelperAbTop};\n  left: ${ve.conf.pageHelperAbLeft};\n  bottom: ${ve.conf.pageHelperAbBottom};\n  right: ${ve.conf.pageHelperAbRight};\n}\n.p-panel {\n  z-index: 2012 !important;\n  background-color: var(--ehvp-theme-bg-color);\n  box-sizing: border-box;\n  position: fixed;\n  color: var(--ehvp-theme-font-color);\n  padding: 3px;\n  border-radius: 4px;\n  font-weight: 800;\n  overflow: hidden;\n  width: 24em;\n  height: 32em;\n  max-height: 75vh;\n  border: var(--ehvp-panel-border);\n  box-shadow: var(--ehvp-panel-box-shadow);\n}\n.clickable {\n  text-decoration-line: underline;\n  user-select: none;\n  text-align: center;\n  white-space: nowrap;\n}\n.clickable:hover {\n  color: var(--ehvp-clickable-color-hover) !important;\n}\n.p-collapse {\n  height: 0px !important;\n  padding: 0px !important;\n  border: none !important;\n}\n.b-main {\n  display: flex;\n  user-select: none;\n  flex-direction: ${"unset"===ve.conf.pageHelperAbLeft?"row-reverse":"row"};\n  flex-wrap: wrap-reverse;\n}\n.b-main-item {\n  box-sizing: border-box;\n  border: var(--ehvp-controlbar-border);\n  border-radius: 4px;\n  background-color: var(--ehvp-theme-bg-color);\n  color: var(--ehvp-theme-font-color);\n  font-weight: 800;\n  padding: 0em 0.3em;\n  margin: 0em 0.2em;\n  position: relative;\n  white-space: nowrap;\n  font-size: 1em;\n  line-height: 1.2em;\n}\n.b-main-option {\n  padding: 0em 0.2em;\n}\n.b-main-option-selected {\n  color: black;\n  background-color: #ffffffa0;\n  border-radius: 6px;\n}\n.b-main-btn {\n  display: inline-block;\n  width: 1em;\n}\n.b-main-input {\n  color: var(--ehvp-theme-font-color);\n  background-color: var(--ehvp-theme-bg-color);\n  border-radius: 6px;\n  display: inline-block;\n  text-align: center;\n  width: 1.5em;\n  cursor: ns-resize;\n}\n.chapter-thumbnail {\n  width: auto;\n  height: 100%;\n  aspect-ratio: 1 / 1;\n  position: relative;\n}\n.chapter-thumbnail > #chapter-thumbnail-image-container {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  just-content: center;\n  items-align: center;\n  z-index: 1;\n}\n.chapter-thumbnail > #chapter-thumbnail-image-container > img {\n  object-fit: contain;\n  display: block;\n  height: 100%;\n  min-width: 100%;\n}\n.chapter-thumbnail > canvas {\n  width: 100%;\n  height: 100%;\n  /**\n  filter: blur(3px) brightness(0.5);\n  */\n}\n.chapter-list {\n  height: 100%;\n  width: 100%;\n  overflow: hidden auto;\n  scrollbar-width: none;\n  border-left: 2px solid black;\n}\n.chapter-list::-webkit-scrollbar {\n  display: none;\n}\n.chapter-list-item {\n  width: 100%;\n  padding-left: 0.7em;\n  white-space: nowrap;\n  line-height: 1.8em;\n  text-decoration: underline;\n}\n.chapter-list-item:hover {\n  background-color: #cddee3ab;\n}\n.chapter-list-item-hl {\n  filter: brightness(150%);\n  background-color: #84c5ff6b;\n}\n.p-chapters {\n  width: 34em;\n  height: 18em;\n  display: flex;\n  max-height: 80%;\n  max-width: 100%;\n}\n.p-chapters-large {\n  width: 45em;\n  height: 25em;\n}\n.p-chapters-large .chapter-thumbnail {\n  width: auto;\n  height: 100%;\n}\n.p-config {\n  display: grid;\n  grid-template-columns: repeat(10, 1fr);\n  align-content: start;\n  line-height: 2em;\n  overflow: auto scroll;\n  scrollbar-width: none;\n}\n.p-config::-webkit-scrollbar {\n  display: none;\n}\n.p-config label {\n  display: flex;\n  justify-content: space-between;\n  padding-right: 10px;\n  margin-bottom: unset;\n}\n.p-config input {\n  cursor: ns-resize;\n}\n.p-downloader {\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  align-items: center;\n}\n.p-downloader canvas {\n  /* border: 1px solid greenyellow; */\n}\n.p-downloader .download-notice {\n  text-align: center;\n  width: 100%;\n}\n.p-downloader .downloader-btn-group {\n  align-items: center;\n  text-align: right;\n  width: 100%;\n}\n.p-btn {\n  color: var(--ehvp-theme-font-color);\n  cursor: pointer;\n  font-weight: 800;\n  background-color: var(--ehvp-theme-bg-color);\n  vertical-align: middle;\n  width: 1.5em;\n  height: 1.5em;\n  border: 1px solid #000000;\n  border-radius: 4px;\n}\n@keyframes main-progress {\n  from {\n    width: 0%;\n  }\n  to {\n    width: 100%;\n  }\n}\n.big-img-frame-collapse {\n  display: none;\n}\n.ehvp-root-collapse .img-land,\n.big-img-frame-collapse .img-land,\n.ehvp-root-collapse .ehvp-message-box,\n.ehvp-root-collapse .p-panel\n {\n  display: none !important;\n}\n.download-bar {\n  background-color: #33333310;\n  height: 0.3em;\n  width: 100%;\n  bottom: -0.5em;\n  position: absolute;\n  box-sizing: border-box;\n  z-index: 2;\n}\n.download-bar > div {\n  background-color: var(--ehvp-img-fetched);\n  height: 100%;\n  border: none;\n}\n.img-land-left, .img-land-right {\n  width: 15%;\n  height: 50%;\n  position: fixed;\n  z-index: 2004;\n  top: 25%;\n}\n.img-land-left {\n  left: 0;\n  cursor: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC3UlEQVR4nO2ZS28TMRDHV0APcON1gXKisUMRJ0QFJ74EAgQfhMclF15nCqk2noTHcVF2nDRCqBc+AZUKRYR3U0olaODK47JoNiqU0mjX9uymSPlLI0Vayfv72157ZuJ5Qw01lLMCL9gKxfAESLwMAutK4nMQ+BWE/tkL+o3z8bNi41Kl2Dhe8kpbvEGrdhAPKKlvKIlLIHVkGB9A4vXKWH00d/DqWLAXhPaV0D8swP8K1RujfK8Y7s4FXkk8B0J/cQXfwEhXCTyTGbh/1B8BqRU3OPxjBKdKJx9vY4Zv7lBSP8waHlZNSGzRO5ng/ZE84WGNCZaVyGPbQP8ou8KfHyB8RFEV4WkreDrWQOIKF8jsZDuaq7wy30pCd33R3GM++0L7nPCrsjEBEm8ZwdPtyHFJrYe3N4Hf7xam96c2QOlBVvCk2dtt8/EEXksFT0lWL0/JBv7ZnTdW4ymJS5Q0JhroZZXZwM/ff+s0riqEE8kGKCXOAL4dLERQdJsYJfTFFPsfQ274l/VOVD3UcP6mQOCD5BWgwoMR/jUu8sDLeAWepjBgnir3g3/36GNUG+eBhzhwJXkLGZ7//eDfzywzw+v4PmA1UB1vRAszy3xnvWQwYLqFaoebfU3YpQ3abQvZfMR5mVDpPmKs2wyejwkMMr3IMjch8EKiAWo6ubwkSxO+aB5LlcwpqRc3nQmBndTdPOqYuS43twkl9NVU8JwFTT8TTyZfZFvQkKgj4GpgIxPm8Jpm/6ZnKjUe7FJSf+Y0YQnfte6bQkGf5TBAYZuRVqQ+ZQX/eyUETnGZyGXrrBfVoS5FjnUIPc3W5O01d7GVI3wzGA22e5yi2eA6mZK2TYm7vb5W1KvkbDnCn/jk/MGaHLHU7qMLxnnGJX6jWS8fae308hbdjtQxs8qdBHZA4BWQep83aMUJYCGcoL4NtT6o8KDKjtKROCWJqzyco2eUElNWuSn+Zh1qKO//1y8OuBKqSFLycQAAAABJRU5ErkJggg=="), auto;\n}\n.img-land-right {\n  right: 0;\n  cursor: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAADG0lEQVR4nO2ZS2tTQRTHL2oXuvO10bqymYkVV2LRlV9CVPQrdO9jE/ANPvCZcjvToju5mpxJGqtWwZ1QH4UWa1WotTUWtNWt1VJHTi6V2KbJnZmTW4X8YaAQuPP7z5nHOaee11BDDTkr8IKVMpndIzkclwwygsOwZPBNMvUzHPg3vCr9lswd60zmdqe81ApvudW9FbYIrs4JDkXJlTYcHyWHs50tmebYwbtago2SKV8w9cMC/K8hwm+kbyWz62OBFxwOSaa+uoJXMDItGByoG7i/02+SXAlqcLnICHSk9j5ZRQyfXyO46q03vJw3waGAcxLB+01xwssyEySRiGPbyKVH2hX+8DLCaxxdLLvfCh6vNclhynTCR+39+sXl13Rbialpn+U3mK8+U77pZI/b+/Xc7JxGvbwyQhgJuG4Ej6+j6SNVDj8vukjAzM1Ez+bIBjA9MJ1k9F5RV9Lzi8M0JhiciQSPSVaYpxgettacHi0sYeKSeyQEhyImjTUNhFml3SRVTRBEQiSybbUNYErsMEk1E88uuJkQTB2NsP8h67pSVU2cdzDB4E7tCGDhQXDoljTxS+unJ4dsIzAUwQBdqty9Pa8/9E1WNnFi0OKbMFV7CxEUKfUzATOxG8AxcONNxfMwcnuM3gB1tTVwrTL827vjumtbjn4LUR3iqvAZG3gV9RBDpp7w72DCCl6GEQjq/pBVg8d8Ca9X628zOFLTADad6gH/vreou13gudI+y++KlMwJriZI4e9/coaXDMYjd/OwY0YG/4AAnpcO8OlI8LYFDSZqCzX2kAZemhY0YRRU2nSichNjfZOlV9gdXuHqX/VMJVqDdYKrLzYmiOGnrfumMqEO2kxqf8+rRaOTq31W8H8iwaCDCiaWrbNQWIdSFDnGg6kesiZv2NyFQozw+aA5WO1RClfD5may2TYp6vZ6ubBXadNyjDA+Ox9YkysW2334wDivOIfvuOrpHYW1XtzC1xE7Zla5E4NxyeCU5GqTt9wqJYCJbBv2bbD1gYUHVnaYjpRSklKVB4P4G6bEmFX+E/9mbagh7//Xb5hJEJPq8mugAAAAAElFTkSuQmCC"), auto;\n}\n.p-tooltip { }\n.p-tooltip .p-tooltiptext {\n  display: none;\n  max-width: 34em;\n  background-color: var(--ehvp-theme-bg-color);\n  color: var(--ehvp-theme-font-color);\n  border-radius: 6px;\n  position: fixed;\n  z-index: 1;\n  font-size: small;\n  white-space: normal;\n  text-align: left;\n  padding: 0.3em 1em;\n  box-sizing: border-box;\n  pointer-events: none;\n}\n.page-loading {\n  width: 100%;\n  height: 100%;\n  justify-content: center;\n  align-items: center;\n  background-color: #333333a6;\n}\n.page-loading-text {\n  color: var(--ehvp-theme-font-color);\n  font-size: 6em;\n}\n@keyframes rotate {\n\t100% {\n\t\ttransform: rotate(1turn);\n\t}\n}\n.border-ani {\n\tposition: relative;\n\tz-index: 0;\n\toverflow: hidden;\n}\n.border-ani::before {\n\tcontent: '';\n\tposition: absolute;\n\tz-index: -2;\n\tleft: -50%;\n\ttop: -50%;\n\twidth: 200%;\n\theight: 200%;\n\tbackground-color: #fff;\n\tanimation: rotate 4s linear infinite;\n}\n.border-ani::after {\n\tcontent: '';\n\tposition: absolute;\n\tz-index: -1;\n\tleft: 6px;\n\ttop: 6px;\n\twidth: calc(100% - 16px);\n\theight: calc(100% - 16px);\n\tbackground-color: #333;\n}\n.overlay-tip {\n  position: absolute;\n  z-index: 10;\n  font-weight: 800;\n  top: 0.3em;\n  right: 0.3em;\n  font-size: 0.8em;\n  color: var(--ehvp-theme-font-color);\n  text-shadow: 0px 0px 3px #000000;\n}\n.lightgreen { color: #90ea90; }\n.ehvp-full-panel {\n  position: fixed;\n  width: 100%;\n  height: 100%;\n  background-color: #000000e8;\n  z-index: 3000;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n  top: 0;\n}\n.ehvp-custom-panel {\n  min-width: 50vw;\n  min-height: 50vh;\n  max-width: 80vw;\n  max-height: 80vh;\n  background-color: var(--ehvp-theme-bg-color);\n  border: 1px solid #000000;\n  display: flex;\n  flex-direction: column;\n  text-align: start;\n  color: var(--ehvp-theme-font-color);\n  position: relative;\n  user-select: none;\n}\n.ehvp-custom-panel-title {\n  font-size: 1.8em;\n  line-height: 2em;\n  font-weight: 800;\n  display: flex;\n  justify-content: space-between;\n  padding-left: 1em;\n}\n.ehvp-custom-panel-close {\n  width: 2em;\n  text-align: center;\n}\n.ehvp-custom-panel-close:hover {\n  background-color: #c3c0e0;\n}\n.ehvp-custom-panel-container {\n  overflow: auto;\n  scrollbar-width: thin;\n}\n.ehvp-custom-panel-content {\n  border: 1px solid #000000;\n  border-radius: 4px;\n  margin: 0.5em;\n  padding: 0.5em;\n}\n.ehvp-custom-panel-item {\n  margin: 0.2em 0em;\n}\n.ehvp-custom-panel-item-title {\n  font-size: 1.4em;\n}\n.ehvp-custom-panel-item-values {\n  margin-top: 0.3em;\n  text-align: end;\n  line-height: 1.3em;\n}\n.ehvp-custom-panel-item-value {\n  font-size: 1.1em;\n  font-weight: 800;\n  color: black;\n  background-color: #c5c5c5;\n  border: 1px solid #000000;\n  box-sizing: border-box;\n  margin-left: 0.3em;\n  display: inline-flex;\n}\n.ehvp-custom-panel-item-value span {\n  padding: 0em 0.5em;\n}\n.ehvp-custom-panel-item-value button {\n  background-color: #fff;\n  color: black;\n  border: none;\n}\n.ehvp-custom-panel-item-value button:hover {\n  background-color: #ffff00;\n}\n.ehvp-custom-panel-item-input, .ehvp-custom-panel-item-span {\n  font-size: 1.1em;\n  font-weight: 800;\n  background-color: #7fef7b;\n  color: black;\n  border: none;\n}\n.ehvp-custom-panel-item-span {\n  background-color: #34355b;\n  color: white;\n}\n.ehvp-custom-panel-item-add-btn:hover {\n  background-color: #ffff00 !important;\n}\n.ehvp-custom-panel-list > li {\n  line-height: 3em;\n  margin-left: 0.5em;\n  font-size: 1.4em;\n}\n.ehvp-custom-panel-checkbox:hover {\n  border: 1px solid var(--ehvp-theme-font-color);\n}\n.ehvp-custom-panel-list-item-disable {\n  text-decoration: line-through;\n  color: red;\n}\n.ehvp-help-panel > div > h2 {\n  color: #c1ffc9;\n}\n.ehvp-help-panel > div > p {\n  font-size: 1.1em;\n  margin-left: 1em;\n  font-weight: 600;\n}\n.ehvp-help-panel > div > ul {\n  font-size: 1em;\n}\n.ehvp-help-panel > div a {\n  color: #ff5959;\n}\n.ehvp-help-panel > div strong {\n  color: #d76d00;\n}\n.bifm-vid-ctl {\n  position: fixed;\n  z-index: 2010;\n  padding: 3px 10px;\n  bottom: 0.2em;\n  ${"unset"===ve.conf.pageHelperAbLeft?"left: 0.2em;":"right: 0.2em;"}\n}\n.bifm-vid-ctl > div {\n  display: flex;\n  align-items: center;\n  line-height: 1.2em;\n}\n.bifm-vid-ctl > div > * {\n  margin: 0 0.1em;\n}\n.bifm-vid-ctl:not(:hover) .bifm-vid-ctl-btn,\n.bifm-vid-ctl:not(:hover) .bifm-vid-ctl-span,\n.bifm-vid-ctl:not(:hover) #bifm-vid-ctl-volume\n{\n  opacity: 0;\n}\n.bifm-vid-ctl-btn {\n  height: 1.5em;\n  width: 1.5em;\n  font-size: 1.2em;\n  padding: 0;\n  margin: 0;\n  border: none;\n  background-color: #00000000;\n  cursor: pointer;\n}\n#bifm-vid-ctl-volume {\n  width: 5em;\n  height: 0.5em;\n}\n.bifm-vid-ctl-pg {\n  border: 1px solid #00000000;\n  background-color: #3333337e;\n  -webkit-appearance: none;\n}\n#bifm-vid-ctl-pg {\n  width: 100%;\n  height: 0.2em;\n  background-color: #333333ee;\n}\n.bifm-vid-ctl:hover {\n  background-color: var(--ehvp-theme-bg-color);\n}\n.bifm-vid-ctl:hover #bifm-vid-ctl-pg {\n  height: 0.8em;\n}\n.bifm-vid-ctl-pg-inner {\n  background-color: #ffffffa0;\n  height: 100%;\n}\n.bifm-vid-ctl:hover #bifm-vid-ctl-pg .bifm-vid-ctl-pg-inner {\n  background-color: #fff;\n}\n.bifm-vid-ctl-span {\n  color: white;\n  font-weight: 800;\n}\n.download-middle {\n  width: 100%;\n  height: auto;\n  flex-grow: 1;\n  overflow: hidden;\n}\n.download-middle .ehvp-tabs + div {\n  width: 100%;\n  height: calc(100% - 2em);\n}\n.ehvp-tabs {\n  height: 2em;\n  width: 100%;\n  line-height: 2em;\n}\n.ehvp-p-tab {\n  border: 1px dotted #ff0;\n  font-size: 1em;\n  padding: 0 0.4em;\n}\n.download-chapters, .download-status, .download-cherry-pick {\n  width: 100%;\n  height: 100%;\n}\n.download-chapters {\n  overflow: hidden auto;\n}\n.download-chapters label {\n  white-space: nowrap;\n}\n.download-chapters label span {\n  margin-left: 0.5em;\n}\n.ehvp-p-tab-selected {\n  color: rgb(120, 240, 80) !important;\n}\n.ehvp-message-box {\n  position: fixed;\n  z-index: 4001;\n  top: 0;\n  left: 0;\n}\n.ehvp-message {\n  margin-top: 1em;\n  margin-left: 1em;\n  line-height: 2em;\n  background-color: #ffffffd6;\n  border-radius: 6px;\n  padding-left: 0.3em;\n  position: relative;\n  box-shadow: inset 0 0 5px 2px #8273ff;\n  color: black;\n}\n.ehvp-message > button {\n  border: 1px solid #00000000;\n  margin-left: 1em;\n  color: black;\n  background-color: #00000000;\n  height: 2em;\n  width: 2em;\n  text-align: center;\n  font-weight: 800;\n}\n.ehvp-message > button:hover {\n  background-color: #444;\n}\n.ehvp-message-duration-bar {\n  position: absolute;\n  bottom: 0;\n  width: 0%;\n  left: 0;\n  height: 0.1em;\n  background: red;\n}\n.ehvp-custom-btn {\n  border: 1px solid #000;\n  font-weight: 700;\n  color: #000;\n  background-color: #ffffff80;\n}\n.ehvp-custom-btn-plain {\n  background-color: #aaa;\n}\n.ehvp-custom-btn-green {\n  background-color: #7fef7b;\n}\n.ehvp-custom-btn:hover {\n  border: 1px solid #fff;\n  color: #333;\n  background-color: #ffffff90;\n  filter: brightness(150%);\n}\n.ehvp-custom-btn:active {\n  color: #ccc;\n}\n.ehvp-custom-panel-list-item-title {\n  display: flex;\n  justify-content: space-between;\n  border-bottom: 2px solid #000;\n  padding: 0em 1em;\n}\n.ehvp-custom-panel-title:hover, .ehvp-custom-panel-list-item-title:hover {\n  background-color: #33333388;\n}\n.s-pickable:hover {\n  border: 1px solid red;\n  filter: brightness(150%);\n}\n#tag-candidates > .tc-selected {\n  color: red;\n  background-color: #fff;\n}\n#tag-candidates > li:hover {\n  color: green;\n  background-color: #aaa;\n}\n#auto-page-progress {\n  height: 100%;\n  width: 0%;\n  position: absolute;\n  top: 0px;\n  left: 0px;\n  background: var(--ehvp-playing-progress-bar-color);\n}\n@media (max-width: ${ge?"1440px":"720px"}) {\n  .ehvp-root {\n    font-size: 4cqw;\n  }\n  .ehvp-root-collapse #entry-btn {\n    font-size: 2.2em;\n  }\n  .p-helper {\n    bottom: 0px;\n    left: 0px;\n    top: unset;\n    right: unset;\n  }\n  .b-main {\n    flex-direction: row;\n  }\n  .b-main-item {\n    font-size: 1.3em;\n    margin-top: 0.2em;\n  }\n  #pagination-adjust-bar,\n  #scale-bar\n  {\n    display: none;\n  }\n  .p-panel {\n    width: 100%;\n    font-size: 5cqw;\n  }\n  .p-chapters {\n    width: 100%;\n  }\n  .ehvp-custom-panel {\n    max-width: 100%;\n  }\n  .ehvp-root input, .ehvp-root select {\n    width: 2em;\n    height: 1.2em;\n    font-size: 1em;\n  }\n  .ehvp-root select {\n    width: 7em !important;\n  }\n  .p-btn {\n    font-size: 1em;\n  }\n  .bifm-vid-ctl {\n    display: none;\n  }\n  .ehvp-custom-panel-list-item-title {\n    display: block;\n  }\n  .chapter-thumbnail {\n    display: none;\n  }\n  .bifm-container-hori > div {\n    width: 100%;\n  }\n}\n`;const s=document.createElement("style");return s.id="ehvp-style-custom",s.innerHTML=ve.conf.customStyle,a.append(o),r.append(s),a.append(r),{root:r,fullViewGrid:k("#ehvp-nodes-container",r),bigImageFrame:k("#big-img-frame",r),pageHelper:k("#p-helper",r),configPanelBTN:k("#config-panel-btn",r),downloaderPanelBTN:k("#downloader-panel-btn",r),chaptersPanelBTN:k("#chapters-panel-btn",r),filterPanelBTN:k("#filter-panel-btn",r),entryBTN:k("#entry-btn",r),currPageElement:k("#p-curr-page",r),totalPageElement:k("#p-total",r),finishedElement:k("#p-finished",r),imgLandLeft:k("#img-land-left",r),imgLandRight:k("#img-land-right",r),autoPageBTN:k("#auto-page-btn",r),pageLoading:k("#page-loading",r),messageBox:k("#message-box",r),config:new oi(r),downloader:new ri(r),chapters:new si(r),filter:new li(r,e),readModeSelect:k("#read-mode-select",r),paginationAdjustBar:k("#pagination-adjust-bar",r),styleSheet:o.sheet}}(n);[i.fullViewGrid,i.bigImageFrame].forEach(e=>function(e){const t=Element.prototype.scrollTo;Object.defineProperty(e,"scrollTo",{value:t,writable:!0,configurable:!0})}(e));const a=Kn.newQueue(),r=new Yn(a),o=new Re(a,t,n),s=new Wn(i,a,r,o,t),l=new ci(i,()=>o.chapters,()=>s.downloading),c=new fi(i,e=>o.chapters[e]);new ni(i,c);const d=H(i,c,a,r,l);(function(e,t,n,i,a){function r(i){ve.conf.autoCollapsePanel&&!i.classList.contains("p-panel-large")&&e.collapsePanelEvent(i,i.id),n.visible?t.bigImageFrame.focus():t.fullViewGrid.focus()}t.config.initEvents(e);const o={config:{panel:t.config.panel,btn:t.configPanelBTN},downloader:{panel:t.downloader.panel,btn:t.downloaderPanelBTN,cb:()=>i.check()},chapters:{panel:t.chapters.panel,btn:t.chaptersPanelBTN},filter:{panel:t.filter.panel,btn:t.filterPanelBTN}};Object.entries(o).forEach(([t,n])=>{n.panel.addEventListener("mouseleave",()=>r(n.panel)),n.panel.addEventListener("blur",()=>r(n.panel)),n.btn.addEventListener("click",()=>{e.togglePanelEvent(t,void 0,n.btn),n.cb?.()})});let s=!1;var l,c;t.pageHelper.addEventListener("mouseover",()=>{s=!0,e.abortMouseleavePanelEvent(),a.minify(a.lastStage,!0)}),t.pageHelper.addEventListener("mouseleave",()=>{s=!1,Object.values(o).forEach(e=>r(e.panel)),setTimeout(()=>!s&&a.minify(a.lastStage,!1),700)}),t.entryBTN.addEventListener("click",()=>{let e=t.entryBTN.getAttribute("data-stage")||"exit";e="open"===e?"exit":"open",t.entryBTN.setAttribute("data-stage",e),ye.emit("toggle-main-view","open"===e)}),t.currPageElement.addEventListener("wheel",e=>{n.callbackOnWheel?.(),n.stepNext(e.deltaY>0?"next":"prev",e.deltaY>0?-1:1,parseInt(t.currPageElement.textContent)-1)}),document.addEventListener("keydown",t=>e.keyboardEvent(t)),document.addEventListener("mouseup",t=>e.keyboardEvent(t)),t.fullViewGrid.addEventListener("keydown",t=>{e.fullViewGridKeyBoardEvent(t),t.stopPropagation()}),t.fullViewGrid.addEventListener("mouseup",t=>{e.fullViewGridKeyBoardEvent(t),t.stopPropagation()}),t.bigImageFrame.addEventListener("keydown",t=>{e.bigImageFrameKeyBoardEvent(t),t.stopPropagation()}),t.bigImageFrame.addEventListener("mouseup",t=>{e.bigImageFrameKeyBoardEvent(t),t.stopPropagation()}),t.imgLandLeft.addEventListener("click",e=>{n.callbackOnWheel?.(),n.stepNext(ve.conf.reversePages?"next":"prev"),e.stopPropagation()}),t.imgLandRight.addEventListener("click",e=>{n.callbackOnWheel?.(),n.stepNext(ve.conf.reversePages?"prev":"next"),e.stopPropagation()}),l=t.pageHelper,c={onFinish:()=>{ve.conf.pageHelperAbTop=t.pageHelper.style.top,ve.conf.pageHelperAbLeft=t.pageHelper.style.left,ve.conf.pageHelperAbBottom=t.pageHelper.style.bottom,ve.conf.pageHelperAbRight=t.pageHelper.style.right,p({pageHelperAbTop:ve.conf.pageHelperAbTop,pageHelperAbLeft:ve.conf.pageHelperAbLeft,pageHelperAbBottom:ve.conf.pageHelperAbBottom,pageHelperAbRight:ve.conf.pageHelperAbRight},ve.conf.selectedSiteNameConfig)},onMoving:e=>{t.pageHelper.style.top=void 0===e.top?"unset":`${e.top}px`,t.pageHelper.style.bottom=void 0===e.bottom?"unset":`${e.bottom}px`,t.pageHelper.style.left=void 0===e.left?"unset":`${e.left}px`,t.pageHelper.style.right=void 0===e.right?"unset":`${e.right}px`;const n=j(t.styleSheet,".b-main");n&&(n.style.flexDirection=void 0===e.left?"row-reverse":"row")}},(k("#dragHub",t.pageHelper)??l).addEventListener("mousedown",e=>{e.preventDefault();const t=window.innerHeight,n=window.innerWidth,i=new AbortController;c.onStart?.(e.clientX,e.clientY),document.addEventListener("mousemove",e=>{c.onMoving?.(G(n,t,e.clientX,e.clientY))},{signal:i.signal}),document.addEventListener("mouseup",()=>{i.abort(),c.onFinish?.(G(n,t,e.clientX,e.clientY))},{once:!0})}),t.readModeSelect.addEventListener("click",t=>{const n=t.target.getAttribute("data-value");n&&(e.changeReadModeEvent(n,ve.matcher.name),a.minify(a.lastStage))}),k("#paginationStepPrev",t.pageHelper).addEventListener("click",()=>{n.callbackOnWheel?.(),n.stepNext(ve.conf.reversePages?"next":"prev",ve.conf.reversePages?-1:1)}),k("#paginationStepNext",t.pageHelper).addEventListener("click",()=>{n.callbackOnWheel?.(),n.stepNext(ve.conf.reversePages?"prev":"next",ve.conf.reversePages?1:-1)}),k("#paginationMinusBTN",t.pageHelper).addEventListener("click",()=>e.modNumberConfigEvent("paginationIMGCount","minus",void 0,ve.matcher.name)),k("#paginationAddBTN",t.pageHelper).addEventListener("click",()=>e.modNumberConfigEvent("paginationIMGCount","add",void 0,ve.matcher.name)),k("#paginationInput",t.pageHelper).addEventListener("wheel",t=>e.modNumberConfigEvent("paginationIMGCount",t.deltaY<0?"add":"minus",void 0,ve.matcher.name)),k("#scaleInput",t.pageHelper).addEventListener("mousedown",e=>{const t=e.target,i=ve.conf.imgScale||("continuous"===ve.conf.readMode?ve.conf.defaultImgScaleModeC:100);!function(e,t,n,i){if(1!==e.buttons)return;document.querySelector("#drag-element-with-line")?.remove();const a=document.createElement("canvas");a.id="drag-element-with-line",a.style.position="fixed",a.style.zIndex="100000",a.style.top="0px",a.style.left="0px",a.style.width="100vw",a.style.height="100vh",a.width=window.innerWidth,a.height=window.innerHeight,document.body.appendChild(a);const r=t.getBoundingClientRect(),o=Math.floor(r.height/2.2),[s,l]=[r.left+r.width/2,r.top+r.height/2],c=a.getContext("2d",{alpha:!0}),d=new AbortController;a.addEventListener("mouseup",()=>{document.body.removeChild(a),d.abort()},{once:!0}),a.addEventListener("mousemove",e=>{const[t,r]=[n.x?s:e.clientX,l];c.clearRect(0,0,a.width,a.height),c.beginPath(),c.moveTo(s,l),c.lineTo(t,r),c.strokeStyle="#ffffffa0",c.lineWidth=4,c.stroke(),c.beginPath(),c.arc(t,r,o,0,2*Math.PI),c.fillStyle="#ffffffa0",c.fill(),i(function(e,t,n,i){return{start:{x:e,y:t},end:{x:n,y:i},distance:Math.sqrt(Math.pow(n-e,2)+Math.pow(i-t,2)),direction:1<<(t>i?3:2)|1<<(e>n?1:0)}}(s,l,t,r))},{signal:d.signal})}(e,t,{},e=>{if(0===e.distance)return;const a=1==(3&e.direction)?1:-1;n.scaleBigImages(1,0,Math.floor(i+.6*e.distance*a)),t.textContent=ve.conf.imgScale.toString()})}),k("#scaleMinusBTN",t.pageHelper).addEventListener("click",()=>n.scaleBigImages(-1,10)),k("#scaleAddBTN",t.pageHelper).addEventListener("click",()=>n.scaleBigImages(1,10)),k("#scaleInput",t.pageHelper).addEventListener("wheel",e=>n.scaleBigImages(e.deltaY>0?-1:1,5))})(d,i,c,s,l),ye.subscribe("downloader-canvas-on-click",e=>{a.currIndex=e,a.chapterIndex===c.chapterIndex&&c.show(a[e])}),ye.subscribe("notify-message",(e,t,n)=>function(e,t,n,i){n=n.replace(/https?:\/\/[^\s<>"']+/g,e=>{const t=e.replace(/[&<>"']/g,e=>{switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return e}});return`<a target="_blank" href="${t}">${t}</a>`});const a=document.createElement("div");a.classList.add("ehvp-message"),a.innerHTML=`<span ${"error"===t?"style='color: red;'":""}>${n}</span><button>X</button><div class="ehvp-message-duration-bar"></div>`,e.appendChild(a),a.querySelector("button")?.addEventListener("click",()=>a.remove());const r=a.querySelector("div.ehvp-message-duration-bar");i&&(r.style.animation=`${i}ms linear main-progress`,r.addEventListener("animationend",()=>a.remove()))}(i.messageBox,e,t,n)),o.beforeInit=()=>i.pageLoading.style.display="flex",o.afterInit=()=>{if(i.pageLoading.style.display="none",r.processingIndexList=[0],r.start(),ve.conf.autoEnterBig||c.visible){const e=a[c.getPageNumber()];e&&c.show(e)}},ve.conf.first&&(d.showGuideEvent(),ve.conf.first=!1,p({first:!1})),ye.subscribe("start-download",e=>{h.first=!1,0===o.chapters.length?ye.emit("pf-init",()=>{s.start(),e()}):(s.start(),w(20).then(e))});const h={first:!0};return ye.subscribe("toggle-main-view",e),ve.conf.autoOpen&&(i.entryBTN.setAttribute("data-stage","open"),e(!0)),()=>(console.log("destory eh-view-enhance"),e(!1),o.abort(),r.abort(),a.length=0,ye.reset(),document.querySelector("#ehvp-base")?.remove(),w(500))}function Q(){Ci.addEvent("LOCATION-CHANGE",()=>{const e=()=>{window.self===window.top?document.querySelector(".ehvp-base")||ve.ready.then(()=>{yi=J()}):u("error","in iframe")};yi?yi().then(e):e()},20)}var ee,te,ne,ie,ae,re,oe,se="undefined"!=typeof document?document.currentScript:null;const le=i(t);class ce{url;title;originTitle;downloader;tags;constructor(e,t){this.url=e,this.title=t,this.tags={},this.downloader="https://github.com/MapoMagpie/comic-looms"}}ee=(()=>"undefined"!=typeof GM_getValue?GM_getValue:void 0)(),te=(()=>"undefined"!=typeof GM_setValue?GM_setValue:void 0)(),ne=(()=>"undefined"!=typeof GM_xmlhttpRequest?GM_xmlhttpRequest:void 0)();const de=(oe=navigator.language).startsWith("zh")?1:oe.startsWith("ko")?2:oe.startsWith("es")?3:0;class he extends Array{constructor(e){super(...e)}get(){return this[de]}}const pe={...a({imageScale:["SCALE","缩放","배율","Escala"],config:["CONF","配置","설정","Ajustes"],chapters:["CHAPTERS","章节","챕터","Capítulos"],filter:["FILTER","过滤","FILTER","FILTER"],autoPagePlay:["PLAY","播放","재생","Reproducir"],autoPagePause:["PAUSE","暂停","일시 중지","Pausar"],collapse:["FOLD","收起","접기","Plegar"],colCount:["Columns","每行数量","열 수","Columnas"],colCountTooltip:["The number of images per row in the thumbnail list. If the layout is Flow Vision, the final number of images per row will be influenced by the specific aspect ratio of the images.","缩略图列表的每行图片数量。如果布局为自适应视图，最终每行图片数量受图片的具体宽高比影响。","썸네일 목록에서 한 줄에 표시되는 이미지의 개수입니다. 레이아웃이 반응형인 경우, 최종 한 줄에 표시되는 이미지의 개수는 이미지의 구체적인 가로세로 비율에 영향을 받습니다.","El número de imágenes por fila en la lista de miniaturas. Si el diseño es adaptable, el número final de imágenes por fila estará influenciado por la proporción de aspecto específica de las imágenes."],rowHeight:["Row Height","每行高度","행 높이","Altura de fila"],rowHeightTooltip:["This option is only effective when the layout of the thumbnail list is Flow Vision. The reference height per row, along with the number of images per row, jointly influences the final display effect.","此项仅在缩略图列表的布局为自适应视图时有效。每行的参考高度，和每行数量共同影响最终的展示效果。","이 옵션은 썸네일 목록의 레이아웃이 반응형일 때만 유효합니다. 각 행의 기준 높이는 행당 이미지 개수와 함께 최종 표시 결과에 영향을 미칩니다.","Esta opción solo es efectiva cuando el diseño de la lista de miniaturas es adaptable. La altura de referencia por fila, junto con el número de imágenes por fila, influye en el efecto final de la visualización."],threads:["Preload Threads","最大同时加载","동시 로드 수","Hilos de pre-carga"],threadsTooltip:["Max Preload Threads","大图浏览时，每次滚动到下一张时，预加载的图片数量，大于1时体现为越看加载的图片越多，将提升浏览体验。","큰 이미지 모드에서 다음 이미지로 이동할 때 미리 로드할 이미지 수입니다.<br>이 값이 1보다 클 경우, 동시에 로드되는 이미지가 더 많아져서 사용 경험이 향상됩니다.","Hilos máximos de pre-carga"],downloadThreads:["Download Threads","最大同时下载","최대 동시 다운로드","Hilos de descarga"],downloadThreadsTooltip:["Max Download Threads, suggest: <5","下载模式下，同时加载的图片数量，建议小于等于5","다운로드 모드에서 동시에 다운로드할 이미지 수입니다. 5 이하로 설정하는 것이 좋습니다.","Hilos máximos de descarga, sugerido: <5"],paginationIMGCount:["Images Per Page","每页图片数量","페이지당 이미지 수","Imágenes por página"],paginationIMGCountTooltip:["In Pagination Read mode, the number of images displayed on each page","当阅读模式为翻页模式时，每页展示的图片数量","페이지 넘김 모드에서 각 페이지에 표시될 이미지 수입니다.","En el modo de lectura por paginación, el número de imágenes mostradas en cada página"],timeout:["Timeout(second)","超时时间(秒)","이미지 로딩 시도 시간 (초)","Tiempo de espera (segundos)"],preventScrollPageTime:["Min Paging Time","最小翻页时间","최소 페이지 넘김 시간","Tiempo mínimo de paginación"],preventScrollPageTimeTooltip:["In Pagination read mode, prevent immediate page flipping when scrolling to the bottom/top to improve the reading experience.<br>Set to 0 to disable this feature,<br>If set to less than 0, page-flipping via scrolling is always disabled, except for the spacebar.<br>measured in milliseconds.","当阅读模式为翻页模式时，滚动浏览时，阻止滚动到底部时立即翻页，提升阅读体验。<br>设置为0时则禁用此功能，单位为毫秒。<br>设置小于0时则永远禁止通过滚动的方式翻页。空格键除外。","페이지 넘김 모드에서 아래/위로 스크롤 시 너무 빨리 페이지가 넘어가는 것을 방지하여 읽기 경험을 개선합니다.<br>0으로 설정하면 이 기능이 비활성화됩니다.<br>0보다 작은 값으로 설정하면 단축키를 제외하고 스크롤을 통한 페이지 넘김이 항상 비활성화됩니다. (밀리초 단위)","En el modo de lectura por paginación, evita el cambio inmediato de página al desplazarse hacia el fondo o la parte superior para mejorar la experiencia de lectura.<br>Establezca en 0 para desactivar esta función,<br>Si se establece en menos de 0, el cambio de página mediante desplazamiento siempre está desactivado, excepto para la barra espaciadora.<br>Medido en milisegundos."],autoPageSpeed:["Auto Paging Speed","自动翻页速度","자동 페이지 넘김 속도","Velocidad de paginación automática"],autoPageSpeedTooltip:["In Pagination read mode, Auto Page Speed means how many seconds it takes to flip the page automatically.<br>In Continuous read mode, Auto Page Speed means the scrolling speed.","当阅读模式为翻页模式时，自动翻页速度表示为多少秒后翻页。<br>当阅读模式为连续模式时，自动翻页速度表示为滚动速度。","페이지 넘김 모드에서 자동 페이지 넘김 속도는 몇 초 후에 자동으로 페이지가 넘어갈지를 의미합니다.<br>연속 읽기 모드에서 자동 페이지 넘김 속도는 자동 스크롤 속도를 의미합니다.","En el modo de lectura por paginación, la velocidad de página automática indica cuántos segundos toma cambiar la página automáticamente.<br>En el modo de lectura continua, la velocidad de página automática indica la velocidad de desplazamiento."],scrollingDelta:["Scrolling Delta","滚动距离","Scrolling Delta","Scrolling Delta"],scrollingDeltaTooltip:["During non-native scrolling (custom keyboard scrolling, horizontal scrolling), the distance of each scroll.","非浏览器原生的滚动时（按键滚动、横向滚动），每次滚动的距离。","비기본 스크롤(사용자 정의 키보드 스크롤, 가로 스크롤) 중 각 스크롤의 거리입니다.","Durante el desplazamiento no nativo (desplazamiento con teclado personalizado, desplazamiento horizontal), la distancia de cada desplazamiento."],scrollingSpeed:["Scrolling Speed","滚动速度","스크롤 속도","Velocidad de desplazamiento"],scrollingSpeedTooltip:["During non-native scrolling (custom keyboard scrolling, horizontal scrolling), the speed of scrolling.","非浏览器原生的滚动时（按键滚动、横向滚动），滚动的速度。","비기본 스크롤(사용자 정의 키보드 스크롤, 가로 스크롤) 중 스크롤 속도입니다.","Durante el desplazamiento no nativo (desplazamiento con teclado personalizado, desplazamiento horizontal), la velocidad de desplazamiento."],fetchOriginal:["Raw Image","最佳质量","원본 이미지","Imagen sin procesar"],fetchOriginalTooltip:["enable will download the original source, cost more traffic and quotas","启用后，将加载未经过压缩的原档文件，下载打包后的体积也与画廊所标体积一致。<br>注意：这将消耗更多的流量与配额，请酌情启用。","활성화하면 원본 파일이 다운로드됩니다. 더 많은 트래픽과 할당량이 소비됩니다.","Activar descargará la fuente original, lo que consumirá más tráfico y cuotas"],autoLoad:["Auto Load","自动加载","자동 로드","Carga automática"],autoLoadTooltip:["Automatically start loading images after entering this script's view","进入本脚本的浏览模式后，即使不浏览也会一张接一张的加载图片。直至所有图片加载完毕。","보기 모드에 진입하면, 사용자가 탐색 중이 아닐 때도 이미지가 하나씩 자동으로 로드됩니다. 모든 이미지가 로드될 때까지 계속됩니다.","Comience a cargar imágenes automáticamente después de ingresar a la vista de este script."],reversePages:["Reverse Pages","反向翻页","페이지 순서 뒤집기","Revertir páginas"],reversePagesTooltip:["Clicking on the side navigation, if enable then reverse paging, which is a reading style similar to Japanese manga where pages are read from right to left.","点击侧边导航时，是否反向翻页，反向翻页类似日本漫画那样的从右到左的阅读方式。","측면 내비게이션을 클릭했을 때 이미지들을 거꾸로 배치할 지 선택합니다. 일본 만화처럼 오른쪽에서 왼쪽으로 읽는 스타일의 이미지에 적용하면 좋습니다.","Hacer clic en la navegación lateral, si está habilitado, revertirá la paginación, que es un estilo de lectura similar al manga japonés, donde las páginas se leen de derecha a izquierda."],autoPlay:["Auto Page","自动翻页","자동 페이지 넘김","Paginación automática"],autoPlayTooltip:["Auto Page when entering the big image readmode.","当阅读大图时，开启自动播放模式。","이미지 크게 보기 모드에 들어가면 바로 자동 페이지 넘김을 활성화합니다.","Paginación automática al entrar en el modo de lectura de imagen grande."],autoLoadInBackground:["Keep Loading","后台加载","백그라운드 로딩","Sigue cargando"],autoLoadInBackgroundTooltip:["Keep Auto-Loading after the tab loses focus","当标签页失去焦点后保持自动加载。","사용자가 다른 창을 볼 때도 자동 로딩을 계속합니다.","Mantener la carga automática después de que la pestaña pierda el enfoque"],autoOpen:["Auto Open","自动展开","자동 이미지 열기","Abrir automáticamente"],autoOpenTooltip:["Automatically open after the gallery page is loaded","进入画廊页面后，自动展开阅读视图。","갤러리 페이지가 로드된 후 첫 페이지를 자동으로 엽니다.","Abrir automáticamente después de que la página de la galería se cargue"],autoCollapsePanel:["Auto Fold Control Panel","自动收起控制面板","설정 창 자동으로 닫기","Plegar automáticamente el panel de control"],autoCollapsePanelTooltip:["When the mouse is moved out of the control panel, the control panel will automatically fold. If disabled, the display of the control panel can only be toggled through the button on the control bar.","当鼠标移出控制面板时，自动收起控制面板。禁用此选项后，只能通过控制栏上的按钮切换控制面板的显示。","마우스가 설정 창이나 컨트롤 바를 벗어나면 설정 창이 자동으로 닫힙니다. 비활성화된 경우, 컨트롤 바의 버튼을 통해서만 창을 여닫을 수 있습니다.","Cuando el mouse se mueve fuera del panel de control, este se plegará automáticamente. Si está desactivado, la visualización del panel de control solo se puede alternar mediante el botón en la barra de control."],magnifier:["Magnifier","放大镜","돋보기","Lupa"],magnifierTooltip:["In the pagination reading mode, you can temporarily zoom in on an image by dragging it with the mouse click, and the image will follow the movement of the cursor.","在翻页阅读模式下，你可以通过鼠标左键拖动图片临时放大图片以及图片跟随指针移动。","Pagination 읽기 모드에서 마우스 클릭으로 이미지를 드래그하면 일시적으로 이미지를 확대할 수 있으며, 이미지가 마우스 커서의 움직임을 따라 이동합니다.","En el modo de lectura por paginación, puedes hacer un zoom temporal en una imagen arrastrándola con el clic del mouse, y la imagen seguirá el movimiento del cursor."],autoEnterBig:["Auto Big","自动大图","이미지 바로 보기","Auto Grande"],dragImageOut:["Drag Image Out","拖拽图片到外部","이미지를 밖으로 드래그","Arrastrar imagen hacia afuera"],dragImageOutTooltip:["Enabling this option will restore the browser's default dragging behavior for images (saving the image to the directory where it was dragged), \nbut will disable the magnifier and the ability to drag and move images.","启用此项将恢复浏览器默认对图片的拖拽行为(保存图片到所拖拽到的目录)，但会禁用放大镜功能以及拖拽移动图片位置的功能。","이 옵션을 활성화하면 이미지에 대한 브라우저의 기본 드래그 동작(이미지를 드래그한 디렉토리에 이미지 저장)이 복원됩니다. \n하지만 돋보기와 이미지 드래그 및 이동 기능은 비활성화됩니다.","Habilitar esta opción restaurará el comportamiento de arrastre predeterminado del navegador para imágenes (guardando la imagen en el directorio donde fue arrastrada). \npero desactivará la lupa y la capacidad de arrastrar y mover imágenes."],autoEnterBigTooltip:["Directly enter the Big image view when the script's entry is clicked or auto-opened","点击脚本入口或自动打开脚本后直接进入大图阅读视图。","이미지 뷰어가 열리면 즉시 큰 이미지 보기 모드로 전환됩니다.","Entrar directamente en la vista de imagen grande cuando se haga clic en la entrada del script o se abra automáticamente"],hdThumbnails:["HD Thumbnails","高清缩略图","HD 썸네일","Miniaturas HD"],hdThumbnailsTooltip:["When the large image is loaded, whether to resample a clearer image from the large image as a thumbnail, will affect performance.","当图片加载完毕后，是否从源图重新采样更加清晰的图片作为缩略图，此项会影响性能。","큰 이미지가 로드될 때 큰 이미지에서 보다 선명한 이미지를 썸네일로 리샘플링할지 여부가 성능에 영향을 미칩니다.","Cuando se carga la imagen grande, el hecho de volver a muestrear una imagen más clara de la imagen grande como miniatura afectará el rendimiento."],pixivJustCurrPage:["Pixiv Only Load Current Page","Pixiv 仅加载当前作品页","Pixiv 현재 페이지만 로드","Pixiv: Cargar solo la página actual"],pixivJustCurrPageTooltip:['In Pixiv, if the current page is on a artwork page, only load the images from current page. Disable this option or the current page is on the artist\'s homepage, all images by that author will be loaded. <br>Note: You can continue loading all the remaining images by the author by scrolling on the page or pressing "Try Fetch Next Page" key after disabling this option.',"在Pixiv中，如果当前页是作品页则只加载当前页中的图片，如果该选项禁用或者当前页是作者主页，则加载该作者所有的作品。<br>注：你可以禁用该选项后，然后通过页面滚动或按下Shift+n来继续加载该作者所有的图片。",'Pixiv에서 현재 페이지가 작품 페이지일 경우, 해당 페이지의 이미지들만 로드합니다. 이 옵션을 비활성화하거나 현재 페이지가 작가의 홈 페이지일 경우, 해당 작가의 모든 이미지를 로드합니다. <br>참고: 이 옵션을 비활성화한 후, 페이지를 스크롤하거나 "다음 페이지 로딩 재시도" 키를 눌러 작가의 나머지 이미지를 계속 로드할 수 있습니다.','En Pixiv, si la página actual está en una página de una obra, solo se cargarán las imágenes de la página actual. Desactive esta opción si la página actual está en la página de inicio del artista; en ese caso, se cargarán todas las imágenes de ese autor. <br>Nota: Puedes continuar cargando todas las imágenes restantes del autor desplazándote por la página o presionando la tecla "Intentar cargar la siguiente página" después de desactivar esta opción.'],pixivRecordReading:["Pixiv Record Reading","Pixiv 记录阅读位置","Pixiv 기록읽기","Pixiv Lectura de registros"],pixivRecordReadingTooltip:["Reading position recorded. A new chapter continuing from this position will be provided next time.","记录阅读位置，再次阅读时，将出现一个新的章节表示从该位置继续阅读。","읽기 위치가 기록되었습니다. 이 위치에서 이어지는 새로운 장은 다음에 제공될 예정입니다.","Posición de lectura registrada. La próxima vez se publicará un nuevo capítulo a partir de esta posición."],pixivAscendWorks:["Pixiv Ascending Works","Pixiv 升序排列作品","Pixiv 오름차순 작품","Obras Ascendentes Pixiv"],pixivAscendWorksTooltip:["Sort the artist's works in ascending order, from oldest to newest. (need refresh)","将画师的作品以升序方式排序，从旧到新。(需要刷新)","아티스트의 작품을 오름차순으로 정렬합니다. 오래된 것부터 최신 순으로. (need refresh)","Ordena las obras del artista en orden ascendente, de las más antiguas a las más recientes. (need refresh)"],pixivImageServer:["Pixiv Img Server","Pixiv 图片服务器","Pixiv 이미지 서버","Pixiv Img Server"],pixivImageServerTooltip:["Replace Pixiv’s default image server i.pximg.net with the proxy server you specify, such as i.pixiv.re, to achieve better loading speeds","将Pixiv默认的图片服务器 i.pximg.net 替换为你所指定的代理服务器，如： i.pixiv.re，以获得更佳的加载速度。","Pixiv의 기본 이미지 서버 i.pximg.net을(를) 지정한 프록시 서버(예: i.pixiv.re)로 교체하여 더 빠른 로딩 속도를 얻으세요.","Reemplaza el servidor de imágenes predeterminado de Pixiv, i.pximg.net, por el servidor proxy que especifiques, como i.pixiv.re, para obtener una velocidad de carga mejor."],readMode:["Read Mode","阅读模式","읽기 모드","Modo de lectura"],gridMode:["Thumbnail Mode","缩略图模式","Thumbnail Mode","Thumbnail Mode"],readModeTooltip:["Switch to the next picture when scrolling, otherwise read continuously","滚动时切换到下一张图片，否则连续阅读","스크롤 시 다음 이미지로 전환하거나, 이미지들을 연속으로 배치합니다.","Cambiar a la siguiente imagen al desplazarse, de lo contrario, leer de manera continua"],stickyMouse:["Sticky Mouse","黏糊糊鼠标","마우스 고정","Mouse adhesivo"],stickyMouseTooltip:["In pagination reading mode, scroll a single image automatically by moving the mouse.","非连续阅读模式下，通过鼠标移动来自动滚动单张图片。","페이지 읽기 모드에서 마우스 커서를 움직여 하나의 이미지를 자동으로 스크롤합니다.","En el modo de lectura por paginación, desplaza una sola imagen automáticamente moviendo el mouse."],minifyPageHelper:["Minify Control Bar","最小化控制栏","컨트롤 바 최소화","Minimizar barra de control"],minifyPageHelperTooltip:["Minify Control Bar","最小化控制栏","언제 컨트롤 바를 최소화할지 선택합니다.","Minimizar barra de control"],hitomiFormat:["Hitomi Image Format","Hitomi 图片格式","Hitomi 이미지 형식","Formato de imagen de Hitomi"],hitomiFormatTooltip:["In Hitomi, Fetch images by the format.<br>if Auto then try Avif > Jxl > Webp, Requires Refresh","在Hitomi中的源图格式。<br>如果是Auto，则优先获取Avif > Jxl > Webp，修改后需要刷新生效。","Hitomi에서 이미지를 어떤 종류의 파일로 가져올 지 선택합니다.<br>Auto 설정 시 Avif > Jxl > Webp 순으로 시도하며, 변경 후 새로고침이 필요합니다.","En Hitomi, obtener imágenes por formato.<br>Si está en automático, intentará Avif > Jxl > Webp. Requiere actualización."],ehentaiTitlePrefer:["Title Language Prefer","标题语言偏好","제목 언어 선호","Idioma del título preferido"],ehentaiTitlePreferTooltip:["Many galleries have both an English/Romanized title and a title in Japanese script. <br>Which one do you want to use as the archive filename?","许多图库都同时拥有英文/罗马音标题和日文标题，<br>您希望下载时哪个作为文件名？","많은 갤러리가 영어/로마자 제목과 일본어 제목을 모두 가지고 있습니다. <br>어떤 것을 아카이브 파일 이름으로 사용할지 선택할 수 있습니다.","Muchas galerías tienen tanto un título en inglés/romanizado como un título en script japonés.<br>¿Cuál quieres usar como nombre de archivo?"],reverseMultipleImagesPost:["Descending Images In Post","反转推文图片顺序","포스트 이미지 내림차순 정렬","Imágenes descendentes en la publicación"],reverseMultipleImagesPostTooltip:["Reverse order for post with multiple images attatched","反转推文图片顺序","여러 이미지가 첨부된 포스트 내 이미지들의 순서를 역순으로 정렬합니다.","Orden inverso para publicaciones con múltiples imágenes adjuntas"],excludeVideo:["Exclude Videos","排除视频","비디오 제외","Excluir videos"],excludeVideoTooltip:["Exclude videos, now only applies to x.com and kemono.su.","排除视频，现在仅作用于x.com和kemono.su","비디오 제외, 현재 x.com과 kemono.su에만 적용됩니다.","Excluir videos, ahora solo se aplica a x.com y kemono.su."],filenameOrder:["Filename Order","文件名排序","파일명 순서","Orden de nombres de archivo"],filenameOrderTooltip:["Filename Sorting Rules for Downloaded Files:\n<br>  Auto: Detect whether the original filenames are consistent with the reading order under natural sorting (Windows). If consistent, keep the original filenames; otherwise, prepend a number to the original filenames to ensure the correct order.\n<br>  Numbers: Ignore the original filenames and rename the files directly according to the reading order.\n<br>  Original: Keep only the original filenames without ensuring the reading order, which may result in overwriting files with the same name.\n<br>  Alphabetically: Detect whether the original filenames are consistent with the reading order under alphabetical sorting (Linux). If consistent, keep the original filenames; otherwise, prepend a number to the original filenames to ensure the correct order. ","下载文件内的文件名排序规则：\n<br>  Auto: 检测原文件名在自然排序(Windows)下是否与阅读顺序一致，如果一致保留原文件名，否则将在原文件名前添加序号以保证顺序。\n<br>  Numbers: 忽略原文件名，直接以阅读顺序为文件命名。\n<br>  Original: 只保留原文件名，不能保证阅读顺序以及同名文件覆盖。\n<br>  Alphabetically: 检测原文件名在字母排序下(Linux)是否与阅读顺序一致，如果一致保留原文件名，否则将在原文件名前添加序号以保证顺序。","다운로드 파일의 파일명 정렬 규칙:\n<br>  Auto: 원본 파일명이 기본 정렬(Windows)에서 읽기 순서와 일치하는지 감지합니다. 일치하는 경우 원본 파일명을 유지하고, 그렇지 않으면 순서를 보장하기 위해 파일명 앞에 번호를 추가합니다.\n<br>  Numbers: 원본 파일명을 무시하고 읽기 순서에 따라 파일명을 직접 지정합니다.\n<br>  Original: 원본 파일명만 유지하며, 읽기 순서가 보장되지 않으며 동일한 이름의 파일이 덮어쓰일 수 있습니다.\n<br>  Alphabetically: 원본 파일명이 알파벳 정렬(Linux)에서 읽기 순서와 일치하는지 감지합니다. 일치하는 경우 원본 파일명을 유지하고, 그렇지 않으면 순서를 보장하기 위해 파일명 앞에 번호를 추가합니다. ","Reglas de ordenamiento de nombres de archivos para archivos descargados:\n<br>  Auto: Detecta si los nombres de archivo originales son consistentes con el orden de lectura bajo el ordenamiento natural (Windows). Si son consistentes, conserva los nombres de archivo originales; de lo contrario, antepone un número a los nombres originales para garantizar el orden correcto.\n<br>  Numbers: Ignora los nombres de archivo originales y renombra los archivos directamente según el orden de lectura.\n<br>  Original: Conserva únicamente los nombres de archivo originales sin garantizar el orden de lectura, lo que puede resultar en sobrescribir archivos con el mismo nombre.\n<br>  Alphabetically: Detecta si los nombres de archivo originales son consistentes con el orden de lectura bajo el orden alfabético (Linux). Si son consistentes, conserva los nombres de archivo originales; de lo contrario, antepone un número a los nombres originales para garantizar el orden correcto. "],dragToMove:["Drag to Move the control bar","拖动移动","드래그해서 컨트롤 바 이동","Arrastra para mover la barra de control"],resetDownloaded:["Reset Downloaded Images","重置已下载的图片","다운로드한 이미지 초기화","Restablecer imágenes descargadas"],resetDownloadedConfirm:["You will reset Downloaded Images!","已下载的图片将会被重置为未下载！","이미지들은 다운로드하지 않은 상태로 초기화됩니다!","¡Vas a restablecer las imágenes descargadas!"],resetFailed:["Reset Failed Images","重置下载错误的图片","로딩 실패한 이미지 초기화","Restablecer imágenes fallidas"],showHelp:["Help","帮助","도움말","Ayuda"],showKeyboard:["Keyboard","快捷键","단축키","Teclado"],showSiteProfiles:["Site Profiles","站点配置","사이트 설정","Perfiles del sitio"],showStyleCustom:["Style","样式","스타일","Estilo"],showActionCustom:["Image Actions","图片操作","이미지 작업","Acciones de imagen"],example:["Example","示例","예시","Ejemplo"],description:["Description","描述","설명","Descripción"],function:["Function","函数","함수","Función"],parameters:["Parameters","参数","매개변수","Parámetros"],body:["Body","体","본문","Cuerpo"],icon:["ICON","图标","아이콘","ICONO"],optional:["Optional","可选","선택적","Opcional"],regexp:["Regexp","正则","정규식","Regexp"],workon:["Work On Sites","生效站点","사이트에서 작동","Funciona en sitios"],global:["Global","全局","글로벌","Global"],controlBarStyleTooltip:["Click on an item to modify its display text, such as emoji or personalized text. Changes will take effect after restarting.","点击某项后修改其显示文本，比如emoji或个性文字，也许svg，重启后生效。","아이템을 클릭하여 이모티콘이나 텍스트 등을 수정할 수 있습니다. 변경 사항은 재시작 후 적용됩니다.","Haga clic en un elemento para modificar el texto que se muestra, como emoji o texto personalizado. Los cambios entrarán en vigor después de reiniciar."],resetConfig:["Reset Config","重置配置","구성 재설정","Restablecer configuración"],letUsStar:["Let's Star","点星","별 눌러줘","Presiona la estrella"],download:["DL","下载","다운로드","Descargar"],forceDownload:["Take Loaded","获取已下载的","다운로드된 이미지 가져오기","Tomar cargado"],downloadStart:["Start Download","开始下载","다운로드 시작","Comenzar descarga"],downloading:["Downloading...","下载中...","다운로드 중...","Descargando..."],downloadFailed:["Failed(Retry)","下载失败(重试)","실패(재시도)","Fallido(Reintentar)"],downloaded:["Downloaded","下载完成","다운로드 완료","Descargado"],packaging:["Packaging...","打包中...","압축 중...","Empaquetando..."],status:["Status","状态","상태","Estado"],selectChapters:["Chapters","章节","챕터","capítulos"],cherryPick:["Cherry Pick","范围选择","범위 선택","Seleccionar individualmente"],enable:["Enable","启用","활성화","Habilitar"],enableTooltips:["Enable the script on this site.","在此站点上启用本脚本的功能。","선택된 사이트에서만 스크립트를 활성화합니다.","Habilitar el script en este sitio."],enableAutoOpen:["Auto Open","自动打开","자동 크게 보기","Apertura automática"],enableAutoOpenTooltips:["Automatically open the interface of this script when entering the corresponding page.","当进入对应的生效页面后，自动打开本脚本界面。","해당 페이지에 들어갈 때 이 스크립트의 인터페이스를 자동으로 엽니다.","Abrir automáticamente la interfaz de este script al ingresar a la página correspondiente."],enableFlowVision:["Flow Vision","自适应视图","Flow Vision","Flow Vision"],enableFlowVisionTooltips:["Enable a new thumbnail list layout where the images in each row have uniform height, but the number of images per row is automatically adjusted. \n    <br>The overall appearance is more compact and comfortable, suitable for illustration-based websites with irregular image aspect ratios.\n    <br>Note: Since some websites cannot retrieve image aspect ratio information, the effect may be impacted.","启用一种新的缩略图列表布局，使每行的图片高度一致，但自动分配每行的图片数量。\n    <br>整体看起来更紧凑舒适，适合图片宽高比不规则的插画类站点。\n    <br>注意：由于一些站点无法提取得知图片的宽高比，因此效果可能会受到影响。","새로운 썸네일 리스트 레이아웃을 활성화하여 각각의 행에 있는 이미지들이 동일한 높이를 가지도록 합니다. 대신 행당 이미지의 수는 자동으로 조정됩니다. \n    <br>전체적인 외관은 더 간결하고 편안하며, 불규칙한 이미지 비율을 가진 일러스트 기반 웹사이트에 적합합니다. \n    <br>참고: 일부 웹사이트는 이미지 비율 정보를 가져올 수 없으므로, 이로 인해 효과에 영향을 받을 수 있습니다.","Activar un nuevo diseño de lista de miniaturas donde las imágenes en cada fila tienen altura uniforme, pero el número de imágenes por fila se ajusta automáticamente. \n    <br>La apariencia general es más compacta y cómoda, adecuada para sitios web basados en ilustraciones con relaciones de aspecto de imagen irregulares.\n    <br>Nota: Dado que algunos sitios web no pueden recuperar la información de la relación de aspecto de las imágenes, el efecto puede verse afectado."],addRegexp:["Add Work URL Regexp","添加生效地址规则","URL 정규식 추가","Agregar expresión regular de URL"],failFetchReason1:["Refused to connect {{domain}}(origin image url), Please check the domain blacklist: Tampermonkey > Comic Looms > Settings > XHR Security > User domain blacklist","被拒绝连接{{domain}}(大图地址)，请检查域名黑名单: Tampermonkey(篡改猴) > 漫画织机 > 设置 > XHR Security >  User domain blacklist","Refused to connect {{domain}}(origin image url), Please check the domain blacklist: Tampermonkey > Comic Looms > Settings > XHR Security > User domain blacklist","Refused to connect {{domain}}(origin image url), Please check the domain blacklist: Tampermonkey > Comic Looms > Settings > XHR Security > User domain blacklist"],latestArtWorks:["The Latest Artworks","最新作品","최신 예술 작품","Las últimas obras de arte"],afterLastReading:["After  Last Reading","上次阅读之后","마지막으로 읽은 후","Después de la última lectura"],beforeLastReading:["Before Last Reading","上次阅读之前","마지막으로 읽기 전에","Antes de la última lectura"],allArtWorks:["All Artworks","全部作品","모든 작품","Todas las obras de arte"],currentArtWorks:["Artwork On The Current Page","当前页的作品","현재 페이지의 아트워크","Obra de arte en la página actual"],help:['\n<h2>[How to Use? Where is the Entry?]</h2>\n<p>The script typically activates on gallery homepages or artist homepages. For example, on E-Hentai, it activates on the gallery detail page, or on Twitter, it activates on the user&#39;s homepage or tweets.</p>\n<p>When active, a <strong>&lt;🎑&gt;</strong> icon will appear at the bottom left of the page. Click it to enter the script&#39;s reading interface.</p>\n<h2 style="color:red;">[Some existing issues and their solutions.]</h2>\n<ul>\n<li>When using Firefox to browse Twitter|X, after navigating to some pages, you need to refresh the page for this script to work on that page.</li>\n<li>When using Firefox to browse Twitter|X, the download function of this script may not work.</li>\n</ul>\n<h4>Solution:</h4>\n<p>These issues are caused by Twitter|X&#39;s Content Security Policy (CSP), which disables URL mutation detection and the Zip creation functionality.</p>\n<p>You can modify Twitter|X&#39;s response header <strong>Content-Security-Policy</strong> to <strong>Content-Security-Policy: object-src \'*\'</strong> using other extensions.</p>\n<p>For example, in the extension <strong>Header Editor</strong>, click the Add button:</p>\n<ul>\n<li>Name: csp-remove(any name)</li>\n<li>Rule type: Modify response header</li>\n<li>Match type: domain</li>\n<li>Match rules: x.com</li>\n<li>Execute type: normal</li>\n<li>Header name: content-security-policy</li>\n<li>Header value: object-src \'*\'</li>\n</ul>\n<h2>[Can the Script&#39;s Entry Point or Control Bar be Relocated?]</h2>\n<p>Yes! At the bottom of the configuration panel, there&#39;s a <strong>Drag to Move</strong> option. Drag the icon to reposition the control bar anywhere on the page.</p>\n<h2>[Can the Script Auto-Open When Navigating to the Corresponding Page?]</h2>\n<p>Yes! There is an <strong>Auto Open</strong> option in the configuration panel. Enable it to activate this feature.</p>\n<h2>[How to Zoom Images?]</h2>\n<p>There are several ways to zoom images in big image reading mode:</p>\n<ul>\n<li>Right-click + mouse wheel</li>\n<li>Keyboard shortcuts</li>\n<li>Zoom controls on the control bar: click the -/+ buttons, scroll the mouse wheel over the numbers, or drag the numbers left or right.</li>\n</ul>\n<h2>[How to maintain spacing between large images?]</h2>\n<p>In CONF > Style, modify or add: .ehvp-root { --ehvp-big-images-gap: 2px; }</p>\n<h2>[How to Open Images from a Specific Page?]</h2>\n<p>In the thumbnail list interface, simply type the desired page number on your keyboard (without any prompt) and press Enter or your custom shortcuts.</p>\n<h2>[About the Thumbnail List]</h2>\n<p>The thumbnail list interface is the script&#39;s most important feature, allowing you to quickly get an overview of the entire gallery.</p>\n<p>Thumbnails are also lazy-loaded, typically loading about 20 images, which is comparable to or even fewer requests than normal browsing.</p>\n<p>Pagination is also lazy-loaded, meaning not all gallery pages load at once. Only when you scroll near the bottom does the next page load.</p>\n<p>Don&#39;t worry about generating a lot of requests by quickly scrolling through the thumbnail list; the script is designed to handle this efficiently.</p>\n<h2>[About Auto-Loading and Pre-Loading]</h2>\n<p>By default, the script automatically and slowly loads large images one by one.</p>\n<p>You can still click any thumbnail to start loading and reading from that point, at which time auto-loading will stop and pre-load 3 images from the reading position.</p>\n<p>Just like the thumbnail list, you don&#39;t need to worry about generating a lot of loading requests by fast scrolling.</p>\n<h2>[About Downloading]</h2>\n<p>Downloading is integrated with large image loading. When you finish browsing a gallery and want to save and download the images, you can click <strong>Start Download</strong> in the download panel. don&#39;t worry about re-downloading already loaded images.</p>\n<p>You can also directly click <strong>Start Download</strong> in the download panel without reading.</p>\n<p>Alternatively, click the <strong>Take Loaded</strong> button in the download panel if some images consistently fail to load. This will save the images that have already been loaded.</p>\n<p>The download panel&#39;s status indicators provide a clear view of image loading progress.</p>\n<p><strong>Note:</strong> When the download file size exceeds 1.2GB, split compression will be automatically enabled. If you encounter errors while extracting the files, please update your extraction software or use 7-Zip.</p>\n<h2>[Can I Select the Download Range?]</h2>\n<p>Yes, the download panel has an option to select the download range(Cherry Pick), which applies to downloading, auto-loading, and pre-loading.</p>\n<p>Even if an image is excluded from the download range, you can still click its thumbnail to view it, which will load the corresponding large image.</p>\n<h2>[How to Select Images on Some Illustration Sites?]</h2>\n<p>In the thumbnail list, you can use some hotkeys to select images:</p>\n<ul>\n<li><strong>Ctrl + Left Click:</strong> Selects the image. The first selection will exclude all other images.</li>\n<li><strong>Ctrl + Shift + Left Click:</strong> Selects the range of images between this image and the last selected image.</li>\n<li><strong>Alt + Left Click:</strong> Excludes the image. The first exclusion will select all other images.</li>\n<li><strong>Alt + Shift + Left Click:</strong> Excludes the range of images between this image and the last excluded image.</li>\n</ul>\n<p>In addition, there are several other methods:</p>\n<ul>\n<li>Middle-click on a thumbnail to open the original image url, then right-click to save the image.</li>\n<li>Set the download range to 1 in the download panel. This excludes all images except the first one. Then, click on thumbnails of interest in the list, which will load the corresponding large images. After selecting, clear the download range and click <strong>Take Loaded</strong> to package and download your selected images.</li>\n<li>Turn off auto-loading and set pre-loading to 1 in the configuration panel, then proceed as described above.</li>\n</ul>\n<h2>[Can I Operate the Script via Keyboard?]</h2>\n<p>Yes! There&#39;s a <strong>Keyboard</strong> button at the bottom of the configuration panel. Click it to view or configure keyboard operations.</p>\n<p>You can even configure it for one-handed full keyboard operation, freeing up your other hand!</p>\n<h2>[How to Feed the Author]</h2>\n<p>Give me a star on <a target="_blank" href="https://github.com/MapoMagpie/eh-view-enhance">Github</a> or a good review on <a target="_blank" href="https://greasyfork.org/scripts/397848-e-hentai-view-enhance">Greasyfork</a>.</p>\n<p>Please do not review on Greasyfork, as its notification system cannot track subsequent feedback. Many people leave an issue and never back.\nReport issues here: <a target="_blank" href="https://github.com/MapoMagpie/eh-view-enhance/issues">issue</a></p>\n<h2>[How to Reopen the Guide?]</h2>\n<p>Click the <strong>Help</strong> button at the bottom of the configuration panel.</p>\n','\n<h2>[如何使用？入口在哪里？]</h2>\n<p>脚本一般生效于画廊详情页或画家的主页或作品页。比如在E-Hentai上，生效于画廊详情页，或者在Twitter上，生效于推主的主页或推文。</p>\n<p>生效时，在页面的左下方会有一个<strong>&lt;🎑&gt;</strong>图标，点击后即可进入脚本的阅读界面。</p>\n<h2 style="color:red;">[一些现存的问题，以及解决方式。]</h2>\n<ul>\n<li>使用Firefox浏览Twitter|X时，跳转到其他页面后，需要刷新才可以使此脚本在该页面生效。</li>\n<li>使用Firefox浏览Twitter|X时，此脚本的下载功能可能无法使用。</li>\n</ul>\n<h4>解决方式:</h4>\n<p>这些问题是由于Twitter|X的内容安全策略(CSP)导致，它使URL的变动检测和创建Zip功能失效。</p>\n<p>可以通过其他拓展修改Twitter|X的响应头<strong>Content-Security-Policy</strong>为<strong>Content-Security-Policy: object-src \'*\'</strong></p>\n<p>例如在拓展<strong>Header Editor</strong>中，点击添加按钮:</p>\n<ul>\n<li>Name: csp-remove(随意)</li>\n<li>Rule type: Modify response header</li>\n<li>Match type: domain</li>\n<li>Match rules: x.com</li>\n<li>Execute type: normal</li>\n<li>Header name: content-security-policy</li>\n<li>Header value: object-src \'*\'</li>\n</ul>\n<h2>[脚本的入口或控制栏可以更改位置吗？]</h2>\n<p>可以！在配置面板的下方，有一个<strong>拖拽移动</strong>的选项，对着图标进行拖动，你可以将控制栏移动到页面上的任意位置。</p>\n<h2>[进入对应的页面的，可以自动打开脚本吗？]</h2>\n<p>可以！在配置面板中，有一个<strong>自动打开</strong>的选项，启用即可。</p>\n<h2>[如何缩放图片？]</h2>\n<p>有几种方式可以在大图阅读模式中缩放图片：</p>\n<ul>\n<li>鼠标右键+滚轮</li>\n<li>键盘快捷键</li>\n<li>控制栏上的缩放控制，点击-/+按钮，或者在数字上滚动滚轮，或者左右拖动数字。</li>\n</ul>\n<h2>[如何让大图之间保持间隔？]</h2>\n<p>在CONF > Style中，修改或添加 .ehvp-root { --ehvp-big-images-gap: 2px; }</p>\n<h2>[如何打开指定页数的图片？]</h2>\n<p>在缩略图列表界面中，直接在键盘上输入数字(没有提示)，然后按下回车或自定义的快捷键。</p>\n<h2>[关于缩略图列表。]</h2>\n<p>缩略图列表是脚本最重要的特性，可以让你快速地了解整个画廊的情况。</p>\n<p>并且缩略图也是延迟加载的，通常会加载20张左右，与正常浏览所发出的请求相当，甚至更低。</p>\n<p>并且分页也是延迟加载的，并不会一次性加载画廊的所有分页，只有滚动到接近底部时，才会加载下一页。</p>\n<p>不用担心因为在缩略图列表中快速滚动而导致发出大量的请求，脚本充分考虑到了这一点。</p>\n<h2>[关于自动加载和预加载。]</h2>\n<p>默认配置下，脚本会自动且缓慢地一张接一张地加载大图。</p>\n<p>你仍然可以点击任意位置的缩略图，并从该处开始加载并阅读，此时会自动加载会停止并从阅读的位置预加载3张图片。</p>\n<p>同缩略图列表一样，无需担心因为快速滚动而导致发出大量的加载请求。</p>\n<h2>[关于下载。]</h2>\n<p>下载与大图加载是一体的，当你浏览完画廊时，突然想起来要保存下载，此时你可以在下载面板中点击<strong>开始下载</strong>，不必担心会重复下载已经加载过的图片。</p>\n<p>当然你也可以不浏览，直接在下载面板中点击<strong>开始下载</strong>。</p>\n<p>或者点击下载面板中的<strong>获取已下载的</strong>按钮，当一些图片总是加载失败的时候，你可以使用此功能来保存已经加载过的图片。</p>\n<p>通过下载面板中的状态可以直观地看到图片加载的情况。</p>\n<p><strong>注意：</strong>当下载文件大小超过1.2G后，会自动启用分卷压缩。当使用解压软件解压出错时，请更新解压软件或使用7-Zip。</p>\n<h2>[可以选择下载范围吗？]</h2>\n<p>可以，在下载面板中有选择下载范围的功能，该功能对下载、自动加载、预加载都生效。</p>\n<p>另外，如果一张图片被排除在下载范围之外，你仍然可以点击该图片的缩略图进行浏览，这会加载对应的大图。</p>\n<h2>[如何在一些插画网站上挑选图片？]</h2>\n<p>在缩略图列表中使用一些快捷键可以进行图片的挑选。</p>\n<ul>\n<li><strong>Ctrl+鼠标左键：</strong> 选中该图片，当第一次选中时，其他的图片都会被排除。</li>\n<li><strong>Ctrl+Shift+鼠标左键：</strong> 选中该图片与上一张选中的图片之间的范围。</li>\n<li><strong>Alt+鼠标左键：</strong> 排除该图片，当第一次排除时，其他的图片都会被选中。</li>\n<li><strong>Alt+Shift+鼠标左键：</strong> 排除该图片与上一张排除的图片之间的范围。</li>\n</ul>\n<p>除此之外还有几种方式：</p>\n<ul>\n<li>在缩略图上按下鼠标中键，即可打开图片的原始地址，之后你可以右键保存图片。</li>\n<li>在下载面板中设置下载范围为1，这样会排除第一张图片以外的所有图片，之后在缩略图列表上点击你感兴趣的图片，对应的大图会被加载，最终挑选完毕后，删除掉下载范围并点击<strong>获取已下载的</strong>，这样你挑选的图片会被打包下载。</li>\n<li>在配置面板中关闭自动加载，并设置预加载数量为1，之后与上面的方法类似。</li>\n</ul>\n<h2>[可以通过键盘来操作吗？]</h2>\n<p>可以！在配置面板的下方，有一个<strong>快捷键</strong>按钮，点击后可以查看键盘操作，或进行配置。</p>\n<p>甚至可以配置为单手全键盘操作，解放另一只手！</p>\n<h2>[如何Feed作者。]</h2>\n<p>给我<a target="_blank" href="https://github.com/MapoMagpie/eh-view-enhance">Github</a>星星，或者<a target="_blank" href="https://greasyfork.org/scripts/397848-e-hentai-view-enhance">Greasyfork</a>上好评。</p>\n<p>请勿在Greasyfork上反馈问题，因为该站点的通知系统无法跟踪后续的反馈。很多人只是留下一个问题，再也没有回来过。\n请在此反馈问题: <a target="_blank" href="https://github.com/MapoMagpie/eh-view-enhance/issues">issue</a></p>\n<h2>[如何再次打开指南？]</h2>\n<p>在配置面板的下方，点击<strong>帮助</strong>按钮。</p>\n','\n<h2>[사용 방법? 스크립트는 어떻게 실행되나요?]</h2>\n<p>이 스크립트는 주로 갤러리 홈페이지나 아티스트 홈페이지에서 활성화됩니다. 예를 들어, E-Hentai에서는 갤러리 상세 페이지에서, Twitter에서는 사용자의 홈 또는 트윗에서, arca.live에서는 작성된 글에서 활성화됩니다.</p>\n<p>스크립트가 활성화되면 페이지의 왼쪽 하단에 <strong>&lt;🎑&gt;</strong> 아이콘이 나타납니다. 이 아이콘을 클릭하면 스크립트의 읽기 화면으로 진입할 수 있습니다.</p>\n\n<h2>[스크립트의 진입점 또는 컨트롤 바를 이동할 수 있나요?]</h2>\n<p>네! 설정 패널 하단에 <strong>드래그해서 컨트롤 바 이동</strong> 옵션이 있습니다. 이 아이콘을 드래그하여 페이지 내 원하는 위치로 컨트롤 바를 이동할 수 있습니다.</p>\n\n<h2>[해당 페이지로 이동할 때 스크립트가 자동으로 열리게 할 수 있나요?]</h2>\n<p>네! 설정 패널에서 <strong>자동으로 이미지 열기</strong> 옵션을 활성화하면 이 기능이 켜집니다.</p>\n\n<h2>[이미지를 확대하려면 어떻게 해야 하나요?]</h2>\n<p>큰 이미지 보기 모드에서 이미지를 확대하는 방법은 여러 가지가 있습니다:</p>\n<ul>\n<li>오른쪽 클릭 + 마우스 휠</li>\n<li>키보드 단축키</li>\n<li>컨트롤 바의 확대/축소 컨트롤: -/+ 버튼을 클릭하거나, 숫자 위에서 마우스 휠을 스크롤하거나, 숫자를 좌우로 드래그하세요.</li>\n</ul>\n\n<h2>[큰 이미지 간의 간격을 유지하려면 어떻게 해야 하나요?]</h2>\n<p>CONF > Style에서 다음을 수정하거나 추가하세요: .ehvp-root { --ehvp-big-images-gap: 2px; }</p>\n\n<h2>[특정 페이지의 이미지를 열려면 어떻게 해야 하나요?]</h2>\n<p>썸네일 리스트 화면에서 원하는 페이지 번호를 키보드로 입력하고 Enter 키나 사용자 지정 단축키를 누르세요.</p>\n\n<h2>[썸네일 리스트에 대하여]</h2>\n<p>썸네일 리스트 화면은 스크립트의 가장 중요한 기능으로, 전체 갤러리를 빠르게 둘러볼 수 있게 해줍니다.</p>\n<p>썸네일은 지연 로딩되며, 일반적으로 약 20개의 이미지를 로드합니다. 이는 일반적인 브라우징보다 요청 수가 적거나 비슷한 정도입니다.</p>\n<p>페이징 또한 지연 로딩됩니다. 즉, 모든 갤러리의 페이지가 한 번에 로드되지 않습니다. 하단 근처로 스크롤할 때만 다음 페이지가 로드됩니다.</p>\n<p>썸네일 리스트를 빠르게 스크롤해도 괜찮습니다. 이 스크립트는 그런 경우에도 많은 요청이 발생하지 않도록 효율적으로 설계되어 있습니다.</p>\n\n<h2>[자동 로딩 및 사전 로딩에 대하여]</h2>\n<p>기본적으로 스크립트는 큰 이미지를 하나씩 자동으로 천천히 로드합니다.</p>\n<p>원하는 썸네일을 클릭하여 그 지점에서 로딩 및 읽기를 시작할 수 있으며, 이때 자동 로딩이 중지되고 읽기 위치에서 3개의 이미지를 사전 로딩합니다.</p>\n<p>썸네일 리스트와 마찬가지로 빠르게 스크롤해도 많은 로딩 요청이 발생하지 않도록 설계되어 있으니 걱정하지 않으셔도 됩니다.</p>\n\n<h2>[다운로드에 대하여]</h2>\n<p>다운로드는 큰 이미지 로딩과 통합되어 있습니다. 갤러리를 모두 본 후 이미지를 저장하고 다운로드하려면 다운로드 패널에서 <strong>다운로드 시작</strong>을 클릭하세요. 이미 로드된 이미지를 다시 다운로드하는 것에 대해서는 걱정 안 하셔도 됩니다.</p>\n<p>이미지를 보지 않고 바로 다운로드 패널에서 <strong>다운로드 시작</strong>을 클릭할 수도 있습니다.</p>\n<p>또한 일부 이미지가 로드되지 않을 때는 다운로드 패널에서 <strong>이미 다운로드한 이미지 가져오기</strong> 버튼을 클릭하여 이미 로드된 이미지를 저장할 수 있습니다.</p>\n<p>다운로드 패널의 상태 표시기를 통해 이미지 로딩 진행 상황을 명확히 볼 수 있습니다.</p>\n<p><strong>참고:</strong> 다운로드 파일 크기가 1.2GB를 초과할 경우, 분할 압축이 자동으로 활성화됩니다. 파일을 추출하는 동안 오류가 발생하면 추출 소프트웨어를 업데이트하거나 7-Zip을 사용하세요.</p>\n\n<h2>[다운로드 범위를 선택할 수 있나요?]</h2>\n<p>네, 다운로드 패널에는 다운로드 범위를 선택할 수 있는 옵션(Cherry Pick)이 있으며, 이는 다운로드, 자동 로딩 및 사전 로딩에 적용됩니다.</p>\n<p>다운로드 범위에서 제외된 이미지라도 썸네일을 클릭하여 해당 큰 이미지를 로드할 수 있습니다.</p>\n\n<h2>[일러스트 사이트에서 이미지를 선택하려면 어떻게 해야 하나요?]</h2>\n<p>썸네일 리스트에서 다음 핫키를 사용하여 이미지를 선택할 수 있습니다:</p>\n<ul>\n<li><strong>Ctrl + 왼쪽 클릭:</strong> 이미지를 선택합니다. 첫 번째 선택은 다른 모든 이미지를 제외합니다.</li>\n<li><strong>Ctrl + Shift + 왼쪽 클릭:</strong> 이 이미지와 마지막으로 선택된 이미지 사이의 이미지를 선택합니다.</li>\n<li><strong>Alt + 왼쪽 클릭:</strong> 이미지를 제외합니다. 첫 번째 제외는 다른 모든 이미지를 선택합니다.</li>\n<li><strong>Alt + Shift + 왼쪽 클릭:</strong> 이 이미지와 마지막으로 제외된 이미지 사이의 이미지를 제외합니다.</li>\n</ul>\n<p>추가적으로 몇 가지 방법이 더 있습니다:</p>\n<ul>\n<li>썸네일에서 중간 클릭으로 원본 이미지 URL을 열고, 그 후 오른쪽 클릭하여 이미지를 저장합니다.</li>\n<li>다운로드 패널에서 다운로드 범위를 1로 설정하세요. 이는 첫 번째 이미지 이외의 모든 이미지를 제외합니다. 그런 다음 목록에서 관심 있는 썸네일을 클릭하여 해당 큰 이미지를 로드합니다. 선택한 후, 다운로드 범위를 해제하고 <strong>이미 다운로드한 이미지 가져오기</strong>를 클릭하여 선택한 이미지를 패키징하고 다운로드합니다.</li>\n<li>자동 로딩을 끄고 설정 패널에서 사전 로딩을 1로 설정한 다음, 위의 방법대로 진행합니다.</li>\n</ul>\n\n<h2>[키보드로 스크립트를 조작할 수 있나요?]</h2>\n<p>네! 설정 패널 하단에 <strong>단축키</strong> 버튼이 있습니다. 이 버튼을 클릭하여 키보드 조작을 확인하거나 설정할 수 있습니다.</p>\n<p>한 손으로 모든 키보드 조작을 할 수 있도록 설정할 수도 있어, 다른 손을 자유롭게 쓸 수 있습니다!</p>\n\n<h2>[특정 사이트에서 자동 열기를 비활성화하려면 어떻게 해야 하나요?]</h2>\n<p>설정 패널 하단에 있는 <strong>사이트 설정</strong> 버튼을 클릭하여 특정 사이트에서 자동 열기를 제외할 수 있습니다. 예를 들어, Twitter나 Booru 타입의 사이트를 제외할 수 있습니다.</p>\n\n<h2>[특정 사이트에서 이 스크립트를 비활성화하려면 어떻게 해야 하나요?]</h2>\n<p>설정 패널 하단의 <strong>사이트 설정</strong> 버튼을 클릭하여 특정 사이트를 제외할 수 있습니다. 제외된 사이트에서는 더 이상 스크립트가 활성화되지 않습니다.</p>\n<p>사이트를 다시 활성화하려면 제외되지 않은 사이트에서 설정해야 합니다.</p>\n\n<h2>[개발자에게 도움을 주고 싶다면?]</h2>\n<p><a target="_blank" href="https://github.com/MapoMagpie/eh-view-enhance">Github</a>에 별을 주시거나, <a target="_blank" href="https://greasyfork.org/scripts/397848-e-hentai-view-enhance">Greasyfork</a>에서 좋은 리뷰를 남겨주세요.</p>\n<p>단, Greasyfork에 버그 제보 내용의 리뷰를 남기지 마세요. 해당 플랫폼의 알림 시스템이 후속 피드백을 추적할 수 없습니다. 많은 사람들이 문제를 제기하고 다시 돌아오지 않습니다.<br> 문제는 여기에 보고해 주세요: <a target="_blank" href="https://github.com/MapoMagpie/eh-view-enhance/issues">이슈</a></p>\n\n<h2>[가이드를 다시 열려면?]</h2>\n<p>설정 패널 하단에 있는 <strong>도움말</strong> 버튼을 클릭하세요.</p>\n\n<h2>[해결되지 않은 문제들]</h2>\n<ul>\n<li>Firefox를 사용하여 Twitter의 홈페이지를 새 탭에서 연 후 사용자의 홈페이지로 이동하면 스크립트가 활성화되지 않으며 페이지 새로고침이 필요합니다.</li>\n<li>Chrome과 Firefox의 프레임내에서 사이트를 여는 것을 방지하는 확장 프로그램을 사용하는 경우, E-Hentai에서 갤러리 내 이미지를 열 수 없게 되며 설정 메뉴 또한 표시되지 않습니다. 이 문제를 해결하려면 확장 프로그램을 비활성화하거나 예외 항목을 추가하세요.</li>\n</ul>\n\n<h2>[작동 원리]</h2>\n<p>이 스크립트는 단순한 jQuery(구형 스크립트)에서부터 최첨단 Vue.js 프레임워크에 이르기까지 매우 다양한 웹 기술에서 작동합니다. 이 스크립트는 해당 기술들을 해킹하지 않고도 상호작용할 수 있도록 최적화되어 있습니다.</p>\n<p>설정 패널의 자동 저장 및 사이트별 설정 기능은 스크립트의 본체 코드에 저장되지 않으며, 스크립트에서 수집하는 정보는 로컬 컴퓨터에만 저장됩니다.</p>\n<p>또한 이 스크립트는 많은 이미지를 처리할 수 있도록 효율적으로 설계되었습니다. 이미지 로딩 시점에서는 브라우저에 의존하며, 이미지 관련 데이터는 사용자 시스템의 메모리로 직접 로드됩니다. 이는 데이터 전송량과 서버 요청 수를 줄이면서도 빠르고 유연한 이미징을 가능하게 합니다.</p>\n\n<h2>[스크립트가 작동하지 않는 이유는 무엇인가요?]</h2>\n<p>이 스크립트는 웹페이지의 HTML 구조와 상호작용하기 때문에 페이지가 변경될 경우(예: 개발자가 업데이트를 하거나 광고를 삽입할 때) 예상대로 작동하지 않을 수 있습니다. 이 경우, 브라우저 콘솔을 열어 오류 메시지를 확인하세요. 오류 메시지가 표시되면 GitHub 이슈 섹션에 보고해 주세요.</p>\n\n<h2>[기타 정보]</h2>\n<p>설정 패널에서 다양한 설정 옵션을 사용할 수 있으며, 각 설정은 사용자 환경을 최적화하는 데 도움이 됩니다. 스크립트가 의도대로 작동하지 않는 경우 GitHub 이슈에서 해결 방법을 찾아보세요.</p>\n',"\n<h2>¿Cómo se usa? ¿Dónde está la entrada</h2>\n<p>El script generalmente se activa en las páginas principales de galerías o en las páginas principales de artistas. Por ejemplo, en E-Hentai, se activa en la página de detalles de la galería, o en Twitter, se activa en la página principal del usuario o en los tweets.p>\n<p>Cuando esté activo, aparecerá un ícono de <strong>&lt;🎑&gt;</strong> en la parte inferior izquierda de la página.</p>\n<h2 style=\"color:red;\">[Algunos problemas no resueltos]</h2>\n<ul>\n<li>Al usar Firefox para abrir la página principal de Twitter en una nueva pestaña y luego navegar a la página principal del usuario, el script no se activa y requiere actualizar la página.</li>\n<li>En Firefox, la función de descarga no funciona en el dominio twitter.com. Firefox no redirige twitter.com a x.com cuando se abre en una nueva pestaña. Debes usar x.com en lugar de twitter.com.</li>\n</ul>\n<h2>[¿Se puede reubicar el punto de entrada o la barra de control del script?]</h2>\n<p>¡Sí! En la parte inferior del panel de configuración, hay una opción de <strong>Arrastrar para mover</strong>. Arrastra el ícono para reposicionar la barra de control en cualquier parte de la página.</p>\n<h2>[¿Puede el script abrirse automáticamente al navegar a la página correspondiente?]</h2>\n<p>¡Sí! Hay una opción de <strong>Apertura Automática</strong> en el panel de configuración. Actívala para habilitar esta función.</p>\n<h2>[¿Cómo hacer zoom en las imágenes?]</h2>\n<p>Hay varias formas de hacer zoom en las imágenes en el modo de lectura de imágenes grandes:</p>\n<ul>\n<li>Clic derecho + rueda del ratón</li>\n<li>Atajos de teclado</li>\n<li>Controles de zoom en la barra de control: haz clic en los botones -/+, desplaza la rueda del ratón sobre los números o arrastra los números hacia la izquierda o derecha.</li>\n</ul>\n<h2>[¿Cómo mantener el espacio entre imágenes grandes?]</h2>\n<p>En CONF > Style, modifique o añada: .ehvp-root { --ehvp-big-images-gap: 2px; }</p>\n<h2>[¿Cómo abrir imágenes de una página específica?]</h2>\n<p>En la interfaz de lista de miniaturas, simplemente escribe el número de página deseado en tu teclado (sin necesidad de un aviso) y presiona Enter o utiliza tus atajos personalizados.</p>\n<h2>[Acerca de la Lista de Miniaturas]</h2>\n<p>La interfaz de lista de miniaturas es la característica más importante del script, ya que te permite obtener rápidamente una vista general de toda la galería.</p>\n<p>Las miniaturas se cargan de forma diferida, normalmente cargando alrededor de 20 imágenes, lo que es comparable o incluso implica menos solicitudes que la navegación normal.</p>\n<p>La paginación también se carga de manera diferida, lo que significa que no todas las páginas de la galería se cargan a la vez. Solo cuando te acercas al final de la página, se carga la siguiente.</p>\n<p>No te preocupes por generar muchas solicitudes al desplazarte rápidamente por la lista de miniaturas; el script está diseñado para manejar esto de manera eficiente.</p>\n<h2>[Acerca de la Carga Automática y la Carga Anticipada]</h2>\n<p>Por defecto, el script carga automáticamente y de manera gradual las imágenes grandes una por una.</p>\n<p>Aún puedes hacer clic en cualquier miniatura para comenzar a cargar y leer desde ese punto, momento en el cual la carga automática se detendrá y se pre-cargarán 3 imágenes desde la posición de lectura.</p>\n<p>Al igual que con la lista de miniaturas, no necesitas preocuparte por generar muchas solicitudes de carga al desplazarte rápidamente.</p>\n<h2>[Acerca de la Descarga]</h2>\n<p>La descarga está integrada con la carga de imágenes grandes. Cuando termines de navegar por una galería y quieras guardar y descargar las imágenes, puedes hacer clic en <strong>Iniciar Descarga</strong> en el panel de descargas. No te preocupes por volver a descargar las imágenes ya cargadas.</p>\n<p>También puedes hacer clic directamente en <strong>Iniciar Descarga</strong> en el panel de descargas sin necesidad de leer.</p>\n<p>Alternativamente, haz clic en el botón <strong>Tomar Cargadas</strong> en el panel de descargas si algunas imágenes no se cargan consistentemente. Esto guardará las imágenes que ya se han cargado.</p>\n<p>Los indicadores de estado del panel de descargas proporcionan una visión clara del progreso de la carga de imágenes.</p>\n<p><strong>Nota:</strong> Cuando el tamaño del archivo de descarga supere los 1.2 GB, se habilitará automáticamente la compresión dividida. Si encuentras errores al extraer los archivos, por favor actualiza tu software de extracción o usa 7-Zip.</p>\n<h2>[¿Puedo seleccionar el rango de descarga?]</h2>\n<p>Sí, el panel de descargas tiene una opción para seleccionar el rango de descarga (Cherry Pick), que se aplica a la descarga, carga automática y carga anticipada.</p>\n<p>Incluso si una imagen está excluida del rango de descarga, aún puedes hacer clic en su miniatura para verla, lo que cargará la imagen grande correspondiente.</p>\n<h2>[¿Cómo seleccionar imágenes en algunos sitios de ilustración?]</h2>\n<p>En la lista de miniaturas, puedes usar algunas teclas de acceso rápido para seleccionar imágenes:</p>\n<ul>\n<li><strong>Ctrl + Clic Izquierdo:</strong> Selecciona la imagen. La primera selección excluirá todas las demás imágenes.</li>\n<li><strong>Ctrl + Shift + Clic Izquierdo:</strong> Selecciona el rango de imágenes entre esta imagen y la última imagen seleccionada.</li>\n<li><strong>Alt + Clic Izquierdo:</strong> Excluye la imagen. La primera exclusión seleccionará todas las demás imágenes.</li>\n<li><strong>Alt + Shift + Clic Izquierdo:</strong> Excluye el rango de imágenes entre esta imagen y la última imagen excluida.</li>\n</ul>\n<p>Además, hay otros métodos:</p>\n<ul>\n<li>Haz clic en el botón del medio en una miniatura para abrir la URL de la imagen original, luego haz clic derecho para guardar la imagen.</li>\n<li>Establece el rango de descarga en 1 en el panel de descargas. Esto excluirá todas las imágenes excepto la primera. Luego, haz clic en las miniaturas de interés en la lista, lo que cargará las imágenes grandes correspondientes. Después de seleccionar, borra el rango de descarga y haz clic en <strong>Tomar Cargadas</strong> para empaquetar y descargar tus imágenes seleccionadas.</li>\n<li>Desactiva la carga automática y establece la carga anticipada en 1 en el panel de configuración, luego procede como se describe anteriormente.</li>\n</ul>\n<h2>[¿Puedo operar el script mediante el teclado?]</h2>\n<p>¡Sí! Hay un botón del <strong>Teclado</strong> en la parte inferior del panel de configuración. Haz clic en él para ver o configurar las operaciones del teclado.</p>\n<p>¡Incluso puedes configurarlo para operar con una sola mano, liberando así tu otra mano!</p>\n<h2>[¿Cómo apoyar al autor?]</h2>\n<p>Déjame una estrella en <a target='_blank' href='https://github.com/MapoMagpie/eh-view-enhance'>Github</a> o una buena reseña en <a target='_blank' href='https://greasyfork.org/scripts/397848-e-hentai-view-enhance'>Greasyfork</a>.</p>\n<p>Por favor, no dejes reseñas en Greasyfork, ya que su sistema de notificaciones no puede rastrear comentarios posteriores. Muchas personas dejan un problema y nunca vuelven.\nReporta problemas aquí: <a target='_blank' href='https://github.com/MapoMagpie/eh-view-enhance/issues'>issue</a></p>\n<h2>[¿Cómo reabrir la guía?]</h2>\n<p>Haz clic en el botón de <strong>Ayuda</strong> en la parte inferior del panel de configuración.</p>\n"]}),keyboard:a({"open-full-view-grid":["Enter Read Mode","进入阅读模式","읽기 모드 시작","Entrar en modo de lectura"],"start-download":["Start Download","开始下载","다운로드 시작","Iniciar Descarga"],"step-image-prev":["Go Prev Image","切换到上一张图片","이전 이미지","Ir a la imagen anterior"],"step-image-next":["Go Next Image","切换到下一张图片","다음 이미지","Ir a la imagen siguiente"],"exit-big-image-mode":["Exit Big Image Mode","退出大图模式","이미지 크게 보기 종료","Salir del modo de imagen grande"],"step-to-first-image":["Go First Image","跳转到第一张图片","첫 이미지로 이동","Ir a la primera imagen"],"step-to-last-image":["Go Last Image","跳转到最后一张图片","마지막 이미지로 이동","Ir a la última imagen"],"scale-image-increase":["Increase Image Scale","放大图片","이미지 확대","Aumentar la escala de la imagen"],"scale-image-decrease":["Decrease Image Scale","缩小图片","이미지 축소","Disminuir la escala de la imagen"],"scroll-image-up":["Scroll Image Up (Please Keep Default Keys)","向上滚动图片 (请保留默认按键)","이미지 위로 스크롤 (기본 키는 그대로 두십시오)","Desplazar la imagen hacia arriba (Por favor, mantener las teclas predeterminadas)"],"scroll-image-down":["Scroll Image Down (Please Keep Default Keys)","向下滚动图片 (请保留默认按键)","이미지 아래로 스크롤 (기본 키는 그대로 두십시오)","Desplazar la imagen hacia abajo (Por favor, mantener las teclas predeterminadas)"],"toggle-auto-play":["Toggle Auto Play","切换自动播放","자동 재생 시작/중지","Alternar reproducción automática"],"round-read-mode":["Switch Reading mode (Loop)","切换阅读模式(循环)","읽기 모드 전환(루프)","Cambiar modo de lectura (bucle)"],"toggle-reverse-pages":["Toggle Pages Reverse","切换阅读方向","페이지 반전 전환","Alternar páginas hacia atrás"],"rotate-image":["Rotate Image","旋转图片","이미지 회전","Girar imagen"],"cherry-pick-current":["Cherry Pick Current Images","选择当前图片","체리픽 현재 이미지","Imágenes actuales de Cherry Pick"],"exclude-current":["Exclude current images","排除当前图片","현재 이미지 제외","Excluir imágenes actuales"],"open-big-image-mode":["Enter Big Image Mode","进入大图阅读模式","이미지 크게 보기","Entrar al modo de imagen grande"],"pause-auto-load-temporarily":["Pause Auto Load Temporarily","临时停止自动加载","자동 이미지 로딩 일시 중지","Pausar carga automática temporalmente"],"exit-full-view-grid":["Exit Read Mode","退出阅读模式","읽기 모드 종료","Salir del modo de lectura"],"columns-increase":["Increase Columns ","增加每行数量","열 수 늘리기","Aumentar columnas"],"columns-decrease":["Decrease Columns ","减少每行数量","열 수 줄이기","Disminuir columnas"],"retry-fetch-next-page":["Try Fetch Next Page","重新加载下一分页","다음 페이지 로딩 재시도","Intentar cargar la siguiente página"],"go-prev-chapter":["Switch To Previous Chapter","切换到上一章节","이전 장으로 전환","Cambiar al capítulo anterior"],"go-next-chapter":["Switch To Next Chapter","切换到下一章节","다음 장으로 전환","cambiar al siguiente capítulo"],"resize-flow-vision":["Resize Thumbnail Grid Layout","Resize Thumbnail Grid Layout","Resize Thumbnail Grid Layout","Resize Thumbnail Grid Layout"]})},ge=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile/i.test(navigator.userAgent),ue="4.4.0",me="ehvh_cfg_",fe=function(){if("function"==typeof ee&&"function"==typeof te)return{setItem:(e,t)=>te(e,t),getItem:e=>ee(e)};if("undefined"!=typeof localStorage)return{setItem:(e,t)=>localStorage.setItem(e,t),getItem:e=>localStorage.getItem(e)};throw new Error("No supported storage method found")}(),be={imgSrcCSP:!1,originalPolicy:""},we=[{key:"colCount",typ:"number"},{key:"rowHeight",typ:"number"},{key:"threads",typ:"number"},{key:"downloadThreads",typ:"number"},{key:"paginationIMGCount",typ:"number"},{key:"timeout",typ:"number"},{key:"preventScrollPageTime",typ:"number"},{key:"autoPageSpeed",typ:"number"},{key:"scrollingDelta",typ:"number"},{key:"scrollingSpeed",typ:"number"},{key:"fetchOriginal",typ:"boolean",gridColumnRange:[1,6]},{key:"autoLoad",typ:"boolean",gridColumnRange:[6,11]},{key:"reversePages",typ:"boolean",gridColumnRange:[1,6]},{key:"autoPlay",typ:"boolean",gridColumnRange:[6,11]},{key:"autoLoadInBackground",typ:"boolean",gridColumnRange:[1,6]},{key:"autoOpen",typ:"boolean",gridColumnRange:[6,11]},{key:"magnifier",typ:"boolean",gridColumnRange:[1,6]},{key:"autoEnterBig",typ:"boolean",gridColumnRange:[6,11]},{key:"dragImageOut",typ:"boolean",gridColumnRange:[1,6]},{key:"hdThumbnails",typ:"boolean",gridColumnRange:[6,11]},{key:"autoCollapsePanel",typ:"boolean",gridColumnRange:[1,11]},{key:"pixivRecordReading",typ:"boolean",gridColumnRange:[1,11],displayInSite:/pixiv.net/},{key:"pixivAscendWorks",typ:"boolean",gridColumnRange:[1,11],displayInSite:/pixiv.net/},{key:"pixivImageServer",typ:"input",gridColumnRange:[1,11],placeholder:"https://i.pixiv.re",displayInSite:/pixiv.net/},{key:"reverseMultipleImagesPost",typ:"boolean",gridColumnRange:[1,11],displayInSite:/(x.com|twitter.com)\//},{key:"excludeVideo",typ:"boolean",gridColumnRange:[1,11],displayInSite:/(x.com|twitter.com|kemono.cr)\//},{key:"readMode",typ:"select",options:[{value:"pagination",display:"Pagination"},{value:"continuous",display:"Continuous"},{value:"horizontal",display:"Horizontal"}]},{key:"gridMode",typ:"select",options:[{value:"grid",display:"Grid"},{value:"flow",display:"Flow"}]},{key:"minifyPageHelper",typ:"select",options:[{value:"always",display:"Always"},{value:"inBigMode",display:"InBigMode"},{value:"never",display:"Never"}]},{key:"hitomiFormat",typ:"select",options:[{value:"auto",display:"Auto"},{value:"avif",display:"Avif"},{value:"webp",display:"Webp"},{value:"jxl",display:"Jxl"}],displayInSite:/hitomi.la\//},{key:"ehentaiTitlePrefer",typ:"select",options:[{value:"english",display:"English"},{value:"japanese",display:"Japanese"}],displayInSite:/e[-x]hentai(.*)?.(org|onion)\/|imhentai.xxx/},{key:"filenameOrder",typ:"select",options:[{value:"auto",display:"Auto"},{value:"numbers",display:"Numbers"},{value:"original",display:"Original"},{value:"alphabetically",display:"Alphabetically"}]}],ve=new class{ready;resolve;reject;matchers;matcher;conf;globalConf;constructor(){this.ready=new Promise(e=>this.resolve=e),this.matchers=[],this.globalConf=this.conf=function(){const e=fe.getItem(me);if(e){let t=JSON.parse(e);if(t.version===ue)return function(e){let t=!1;const n=d(),i=Object.keys(n);i.forEach(i=>{void 0===e[i]&&(e[i]=n[i],t=!0)});const a=Object.keys(e);for(const n of a)i.includes(n)||(delete e[n],t=!0);["pageHelperAbTop","pageHelperAbLeft","pageHelperAbBottom","pageHelperAbRight"].forEach(n=>{if("unset"!==e[n]){const i=parseInt(e[n]),a=n.endsWith("Right")||n.endsWith("Left")?window.screen.width:window.screen.height;(isNaN(i)||i<5||i>a)&&(e[n]="5px",t=!0)}}),["pagination","continuous","horizontal"].includes(e.readMode)||(e.readMode="pagination",t=!0),(void 0===e.imgScale||isNaN(e.imgScale)||0===e.imgScale)&&(e.imgScale="continuous"===e.readMode?e.defaultImgScaleModeC:100,t=!0),!e.imgNodeActions||e.imgNodeActions instanceof Array||(e.imgNodeActions=[],t=!0);const r=function(e){let t=!1;return e.configPatchVersion<8&&(e.configPatchVersion=8,e.colCount=l(),e.keyboards={inBigImageMode:{},inFullViewGrid:{},inMain:{}},t=!0),e.configPatchVersion<10&&(e.configPatchVersion=10,e.customStyle="",t=!0),t?e:null}(e);return r&&(e=r,t=!0),t&&p(e),e}(t)}const t=d();return p(t),t}()}addSetup(e){this.matchers.push(e);const t=h(e.name);if(!(t.enable??1))return;let n=t.workURLs?.map(e=>new RegExp(e))??[];0===n.length&&(n=e.workURLs),n.find(e=>e.test(window.location.href))&&(this.conf={...this.conf,...t},this.matcher=e,this.resolve?.(e))}},ye=new class{events;constructor(){this.events=new Map}emit(e,...t){["imf-download-state-change","imf-check-picked"].includes(e)||u("debug","event bus emitted: ",e);const n=this.events.get(e);let i;return n&&n.forEach(e=>i=e(...t)),i}subscribe(e,t){const n=this.events.get(e);n?n.push(t):this.events.set(e,[t])}reset(){this.events=new Map}};class Ce{tids;mode;lastExecTime;constructor(e){this.tids={},this.lastExecTime=Date.now(),this.mode=e||"debounce"}addEvent(e,t,n){if("throttle"===this.mode){const e=Date.now();e-this.lastExecTime>=n&&(this.lastExecTime=e,t())}else"debounce"===this.mode&&(window.clearTimeout(this.tids[e]),this.tids[e]=window.setTimeout(t,n))}}const xe=new e({features:["wasm"]}),Ie={filter:"box"},Ae="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==",_e=document.createElement("div");_e.classList.add("img-node"),_e.innerHTML='\n<a>\n  <img decoding="async" loading="eager" title="untitle.jpg" src="" style="display: none;" />\n  <canvas id="sample-canvas" width="100" height="100"></canvas>\n</a>';const Se=document.createElement("div");Se.classList.add("overlay-tip"),Se.innerHTML="<span>GIF</span>";const ke=/\.(\w+)[^\/]*$|twimg.*format=(\w+)/;class Ee{icon;description;func;reueable=!1;done=!1;processing=!1;constructor(e,t,n,i){this.icon=e,this.description=t,this.func=n,this.reueable=i??!1}}class Le{root;thumbnailSrc;href;title;onclick;imgElement;canvasElement;canvasCtx;delaySRC;_originSrc;blobSrc;mimeType;downloadBar;picked=!0;debouncer=new Ce;rect;tags;actions=[];get originSrc(){return this._originSrc}set originSrc(e){this._originSrc=e,this.updateTagByExtension()}constructor(e,t,n,i,a,r){this.href=t,this.title=n,this.delaySRC=i,this.rect=r,this.tags=new Set,this.thumbnailSrc=e,this.originSrc=a}setTags(...e){e.forEach(e=>this.tags.add(e))}updateTagByExtension(){let e=this.originSrc||this.thumbnailSrc;if(!e)return;const t=e.match(ke)?.find((e,t)=>t>0&&e);t&&this.updateTagByPrefix("ext:"+t)}updateTagByPrefix(e){if(this.tags.has(e))return;const t=e.split(":").shift();if(!t)return;const n=Array.from(this.tags.entries()).find(([e])=>e.startsWith(t));n?.[0]&&this.tags.delete(n?.[0]),this.tags.add(e)}create(){this.root=_e.cloneNode(!0);const e=this.root.firstElementChild;e.href=this.href,e.target="_blank",this.imgElement=e.firstElementChild,this.canvasElement=e.lastElementChild,this.imgElement.setAttribute("title",this.title),this.canvasElement.id="canvas-"+this.title.replaceAll(/[^\w]/g,"_");const t=Math.max(ve.conf.minRatio,this.ratio());return this.root.style.aspectRatio=t.toString(),this.root.setAttribute("data-ratio",t.toString()),this.canvasElement.width=512,this.canvasElement.height=Math.floor(512/t),this.canvasCtx=this.canvasElement.getContext("2d"),this.canvasCtx.fillStyle="#aaa",this.canvasCtx.fillRect(0,0,this.canvasElement.width,this.canvasElement.height),this.onclick&&e.addEventListener("click",e=>{e.preventDefault(),this.onclick(e)},{passive:!1,capture:!1}),this.root.addEventListener("mouseenter",()=>{if(0===this.actions.length)return;if(this.root.addEventListener("mouseleave",()=>{this.root.querySelector(".img-node-actions > .img-node-action-btn-processing")||this.root.querySelector(".img-node-actions")?.remove()}),this.root.querySelector(".img-node-actions"))return;const e=document.createElement("div");e.classList.add("img-node-actions");for(const t of this.actions){const n=document.createElement("button");n.classList.add("img-node-action-btn"),t.done&&n.classList.add("img-node-action-btn-done"),n.textContent=t.icon,n.addEventListener("click",e=>{const n=e.target;n.disabled=!0,n.classList.add("img-node-action-btn-processing"),t.processing=!0,t.func(this).then(()=>{n.classList.remove("img-node-action-btn-processing"),n.classList.add("img-node-action-btn-done"),n.disabled=!1,t.done=!0}).catch(e=>{n.classList.remove("img-node-action-btn-processing"),n.classList.add("img-node-action-btn-error"),n.disabled=!1,ye.emit("notify-message","error",`execute action [${t.icon}] failed, reason: ${e}`),console.error(e)}).finally(()=>t.processing=!1)},{passive:!1,capture:!0}),e.appendChild(n)}this.root.appendChild(e)}),this.root}resize(e,t){if(!this.root||!this.imgElement||!this.canvasElement)return e("undefined elements");if(!this.imgElement.src||this.imgElement.src===Ae)return e("empty or default src");if(this.root.offsetWidth<=1)return e("element too small");if(this.imgElement.src===this.imgElement.getAttribute("data-rendered"))return;this.imgElement.onload=null,this.imgElement.onerror=null;const n=Math.max(ve.conf.minRatio,this.ratio());this.rect={w:this.imgElement.naturalWidth,h:this.imgElement.naturalHeight};const i=Math.max(ve.conf.minRatio,this.ratio()),a=this.root.parentElement?.classList.contains("fvg-sub-container");Math.abs(i-n)>.07&&(this.root.style.aspectRatio=i.toString(),this.root.setAttribute("data-ratio",i.toString()),a?(this.canvasElement.height=this.root.offsetHeight,this.canvasElement.width=Math.floor(this.root.offsetHeight/i)):(this.canvasElement.width=this.root.offsetWidth,this.canvasElement.height=Math.floor(this.root.offsetWidth*i)),t());const r=e=>{this.imgElement.src="",this.imgElement.setAttribute("data-rendered",e)},o=this.imgElement.naturalWidth/i,s=(this.imgElement.naturalHeight-o)/2;if(this.imgElement.src===this.thumbnailSrc)this.canvasCtx?.drawImage(this.imgElement,0,s,this.imgElement.naturalWidth,o,0,0,this.canvasElement.width,this.canvasElement.height),r(this.imgElement.src);else{const e=e=>{(async function(e,t){return xe.resize(e,t,Ie).then()})(e,this.canvasElement).then(()=>window.setTimeout(()=>r(this.imgElement.src),100)).catch(()=>r(this.canvasCtx?.drawImage(this.imgElement,0,s,this.imgElement.naturalWidth,o,0,0,this.canvasElement.width,this.canvasElement.height)||""))};this.ratio()<ve.conf.minRatio?createImageBitmap(this.imgElement,0,s,this.imgElement.naturalWidth,o).then(e):e(this.imgElement)}}ratio(){return this.rect?Math.floor(this.rect.w/this.rect.h*1e3)/1e3:1}render(e,t,n){this.debouncer.addEvent("IMG-RENDER",()=>{if(!this.imgElement)return e("element undefined");let i=!(n||ve.conf.hdThumbnails&&this.blobSrc);if("image/gif"===this.mimeType||this.mimeType?.startsWith("video")){const e=Se.cloneNode(!0);e.firstChild.textContent=this.mimeType.split("/")[1].toUpperCase(),this.root?.appendChild(e),i=!0}if(this.imgElement.onload=()=>this.resize(e,t),this.imgElement.onerror=()=>e("img load error"),i){const n=this.delaySRC;this.delaySRC=void 0,n?n.then(n=>(this.thumbnailSrc=n)&&this.render(e,t)).catch(e):this.imgElement.src=this.thumbnailSrc||this.blobSrc||Ae}else this.imgElement.src=this.blobSrc||this.thumbnailSrc||Ae},30)}unrender(){this.imgElement&&(this.imgElement.src="")}progress(e){if(this.root)if(4!==e.readyState){if(!this.downloadBar){const e=document.createElement("div");e.classList.add("download-bar"),e.innerHTML='<div style="width: 0%"></div>',this.downloadBar=e,this.root.firstElementChild.appendChild(this.downloadBar)}this.downloadBar&&(this.downloadBar.firstElementChild.style.width=e.loaded/e.total*100+"%")}else this.downloadBar&&this.downloadBar.parentNode&&this.downloadBar.parentNode.removeChild(this.downloadBar)}changeStyle(e,t){if(!this.root)return;const n=()=>this.root.classList.forEach(e=>["img-excluded","img-fetching","img-fetched","img-fetch-failed"].includes(e)&&this.root?.classList.remove(e));if(this.picked)switch(e){case"fetching":n(),this.root.classList.add("img-fetching");break;case"fetched":n(),this.root.classList.add("img-fetched");break;case"failed":n(),this.root.classList.add("img-fetch-failed");break;case"init":n()}else n(),this.root.classList.add("img-excluded");if(this.root.querySelector(".img-node-error-hint")?.remove(),t){const e=document.createElement("div");e.classList.add("img-node-error-hint"),e.innerHTML=`<span>${t}</span><br><span style="color: white;">You can click here retry again,<br>Or press mouse middle button to open origin image url</span>`,this.root.firstElementChild.appendChild(e)}}equal(e){return e===this.root||e===this.root?.firstElementChild||e===this.canvasElement||e===this.imgElement}}ie=(e=>(e[e.FAILED=0]="FAILED",e[e.URL=1]="URL",e[e.DATA=2]="DATA",e[e.DONE=3]="DONE",e))(ie||{});class Te{index;node;stage=1;tryTimes=0;lock=!1;rendered=!1;data;contentType;downloadState;timeoutId;matcher;chapterIndex;chapterID;randomID;failedReason;abortSignal=void 0;constructor(e,t,n,i,a){this.index=e,this.node=t,this.node.onclick=e=>{e.ctrlKey||e.metaKey?ye.emit("add-cherry-pick-range",this.chapterIndex,this.index,!0,e.shiftKey):e.altKey?ye.emit("add-cherry-pick-range",this.chapterIndex,this.index,!1,e.shiftKey):ye.emit("imf-on-click",this)},this.downloadState={total:100,loaded:0,readyState:0},this.matcher=n,this.chapterIndex=i,this.chapterID=a,this.randomID=i+Math.random().toString(16).slice(2)+this.node.href}create(){const e=this.node.create(),t=document.createElement("div");return t.classList.add("img-node-numtip"),t.innerHTML=`<span>${this.index+1}</span>`,e.firstElementChild.appendChild(t),e}setDownloadState(e){this.downloadState={...this.downloadState,...e},this.node.progress(this.downloadState),ye.emit("imf-download-state-change",this)}async start(){if(!this.lock){this.lock=!0;try{this.node.changeStyle("fetching"),await this.fetchImage(),this.node.changeStyle("fetched"),ye.emit("imf-on-finished",this.index,!0,this),this.failedReason=void 0}catch(e){this.failedReason=e.toString(),this.node.changeStyle("failed",this.failedReason),u("error","IMG-FETCHER ERROR:",e),this.stage=0,ye.emit("imf-on-finished",this.index,!1,this)}finally{this.lock=!1}}}resetStage(){this.node.changeStyle("init"),this.stage=1}async fetchImage(){const e=async()=>{try{switch(this.stage){case 0:case 1:const t=await this.fetchOriginMeta();return this.node.originSrc=t.url,this.node.updateTagByExtension(),t.title&&(this.node.title=t.title,this.node.imgElement&&(this.node.imgElement.title=t.title)),this.node.href=t.href||this.node.href,this.stage=2,e();case 2:const n=await this.fetchImageData();if([this.data,this.contentType]=n,[this.data,this.contentType]=await this.matcher.processData(this.data,this.contentType,this.node),this.node.updateTagByPrefix("mime:"+(this.contentType??"unknown")),this.contentType.startsWith("text"))throw u("error","unexpect content:\n",(new TextDecoder).decode(this.data)),new Error(`expect image data, fetched wrong type: ${this.contentType}, the content is showing up in console(F12 open it).`);this.node.blobSrc=be.imgSrcCSP?this.node.originSrc:URL.createObjectURL(new Blob([this.data],{type:this.contentType})),this.node.mimeType=this.contentType,this.node.render(e=>{u("error","render image failed, "+e),this.rendered=!1},()=>ye.emit("imf-resize",this)),this.stage=3;case 3:return null}}catch(e){return this.stage=0,e}};let t;for(this.tryTimes=0;this.tryTimes<3;){if(t=await e(),null===t)return;this.tryTimes++,u("error",`fetch image error, try times: ${this.tryTimes}, error:`,t)}throw t}async fetchOriginMeta(){return await this.matcher.fetchOriginMeta(this.node,this.tryTimes>0||0===this.stage,this.chapterID)}async fetchImageData(){const e=await this.fetchBigImage();if(null==e)throw new Error(`fetch image data is empty, image url:${this.node.originSrc}`);return e.arrayBuffer().then(t=>[new Uint8Array(t),e.type])}render(e){const t=ye.emit("imf-check-picked",this.chapterIndex,this.index)??this.node.picked,n=t!==this.node.picked;if(this.node.picked=t,e&&(this.rendered=!1),this.rendered){if(n){let e;switch(this.stage){case 0:e="failed";break;case 1:e="init";break;case 2:e="fetching";break;case 3:e="fetched"}this.node.changeStyle(e,this.failedReason)}}else this.rendered=!0,this.node.render(e=>{u("error","render image failed, "+e),this.rendered=!1},()=>ye.emit("imf-resize",this),e),this.node.changeStyle(3===this.stage?"fetched":void 0,this.failedReason)}isRender(){return this.rendered}unrender(){this.rendered&&(this.rendered=!1,this.node.unrender(),this.node.changeStyle("init"))}ratio(){return this.node.ratio()}async fetchBigImage(){if(this.node.originSrc?.startsWith("blob:"))return await fetch(this.node.originSrc).then(e=>e.blob());const e=this;return new Promise(async(t,n)=>{const i=new Ce,a=()=>{i.addEvent("XHR_TIMEOUT",()=>{this.abort(),n(new Error("timeout"))},1e3*ve.conf.timeout)};try{this.abortSignal=m(e.node.originSrc,"blob",{onload:function(n){const i=n.response;try{e.setDownloadState({readyState:n.readyState})}catch(e){u("error","warn: fetch big image data onload setDownloadState error:",e)}e.abortSignal=void 0,t(i)},onerror:function(t){if(e.abortSignal=void 0,0===t.status&&t.error?.includes("URL is not permitted")){const e=t.error.match(/(https?:\/\/.*?)\/.*/)?.[1]??"";n(new Error(pe.failFetchReason1.get().replace("{{domain}}",e)))}else n(new Error(`response status:${t.status}, error:${t.error}, response:${t.response}`))},onprogress:function(t){e.setDownloadState({total:t.total,loaded:t.loaded,readyState:t.readyState}),a()},onloadstart:function(){e.setDownloadState(e.downloadState)}},this.matcher.headers()),a()}catch(e){n(e)}})}abort(){this.abortSignal?.(),this.abortSignal=void 0}}class Pe{id;title;source;queue;filteredQueue;thumbimg;sourceIter;done;onclick;meta;constructor(e,t,n,i){this.id=e,this.title=t,this.source=n,this.queue=[],this.thumbimg=i,this.filteredQueue=[]}}class Re{chapters=[];chapterIndex=0;queue;matcher;filter;beforeInit;afterInit;nodeActionDesc=[];appendPageLock=!1;abortb=!1;constructor(e,t,n){this.queue=e,this.matcher=t,this.filter=n,this.filter.onChange=()=>this.changeToChapter(this.chapterIndex);const i=new Ce;ye.subscribe("ifq-on-finished-report",e=>i.addEvent("APPEND-NEXT-PAGES",()=>this.appendPages(e),5)),ye.subscribe("imf-on-finished",(e,t,n)=>{0===e&&t&&(this.chapters[n.chapterIndex].thumbimg=n.node.blobSrc)}),ye.subscribe("pf-try-extend",()=>i.addEvent("APPEND-NEXT-PAGES",()=>!this.queue.downloading?.()&&this.appendNextPage(),5)),ye.subscribe("pf-retry-extend",()=>!this.queue.downloading?.()&&this.appendNextPage(!0)),ye.subscribe("pf-init",e=>this.init().then(e)),ye.subscribe("pf-append-chapters",e=>this.appendNewChapters(e).then(()=>this.chapters)),ye.subscribe("pf-step-chapters",e=>{if("prev"===e){const e=this.chapterIndex-1;if(e<0)return;this.changeToChapter(e),ye.emit("notify-message","info","switch to chapter: "+this.chapters[e].title,2e3)}else if("next"===e){const e=this.chapterIndex+1;if(e>=this.chapters.length)return;this.changeToChapter(e),ye.emit("notify-message","info","switch to chapter: "+this.chapters[e].title,2e3)}}),ye.subscribe("filter-update-all-tags",async()=>{const e=this.chapters[this.chapterIndex],t=new Set;e.filteredQueue.forEach(e=>e.node.tags.forEach(e=>t.add(e))),this.filter.allTags=t})}appendToView(e,t,n,i){ye.emit("pf-on-appended",e,t,n,i)}abort(){this.abortb=!0}async appendNewChapters(e){try{const t=await this.matcher.appendNewChapters(e,this.chapters);t&&t.length>0&&(t.forEach(e=>{e.sourceIter=this.matcher.fetchPagesSource(e),e.onclick=e=>this.changeToChapter(e)}),this.chapters.push(...t),ye.emit("pf-update-chapters",this.chapters,!0))}catch(e){ye.emit("notify-message","error",`${e}`)}}async init(){this.beforeInit?.();try{if(ve.conf.imgNodeActions.length>0){const e=async function(){}.constructor;this.nodeActionDesc=ve.conf.imgNodeActions.filter(e=>!e.workon||new RegExp(e.workon).test(window.location.href)).map(t=>({icon:t.icon,description:t.description,fun:e("imf","imn","gm_xhr","EBUS",t.funcBody)}))}}catch(e){console.error(e),ye.emit("notify-message","error","cannot create your node actions, "+e)}this.chapters=await this.matcher.fetchChapters().catch(e=>ye.emit("notify-message","error",e.toString())||[]),this.afterInit?.(),this.chapters.forEach(e=>{e.sourceIter=this.matcher.fetchPagesSource(e),e.onclick=e=>this.changeToChapter(e)}),ye.emit("pf-update-chapters",this.chapters),1===this.chapters.length&&this.changeToChapter(0)}changeToChapter(e){this.chapterIndex=e,ye.emit("pf-change-chapter",e,this.chapters[e]);const t=this.chapters[e];t.filteredQueue=[...this.filter.filterNodes(t.queue,!0)],t.filteredQueue.forEach((e,t)=>e.index=t),t.filteredQueue.length>0&&this.appendToView(t.filteredQueue.length,t.filteredQueue,e,this.chapters[e].done),this.queue.downloading?.()||(this.beforeInit?.(),this.restoreChapter(e).then(this.afterInit).catch(this.onFailed))}async restoreChapter(e){this.chapterIndex=e;const t=this.chapters[this.chapterIndex];if(this.queue.restore(e,t.filteredQueue),t.sourceIter){if(0===t.queue.length){const e=await t.sourceIter.next();if(!e.done){if(e.value.error)throw e.value.error;await this.appendImages(e.value.value)}this.appendPages(this.queue.length)}}else u("error","chapter sourceIter is not set!")}async appendPages(e){for(;!(e+60<this.queue.length)&&await this.appendNextPage(););}async appendNextPage(e){if(this.appendPageLock)return!1;try{this.appendPageLock=!0;const t=this.chapters[this.chapterIndex];if(e&&(t.done=!1),t.done||this.abortb)return!1;const n=await t.sourceIter.next();if(n.done)return t.done=!0,this.appendToView(this.queue.length,[],this.chapterIndex,!0),!1;if(n.value.error)throw t.done=!0,n.value.error;return await this.appendImages(n.value.value)}catch(e){return u("error","PageFetcher:appendNextPage error: ",e),this.onFailed?.(e),!1}finally{this.appendPageLock=!1}}async appendImages(e){try{const t=await this.obtainImageNodeList(e);if(this.abortb)return!1;if(0===t.length)return!1;const n=this.chapters[this.chapterIndex],i=n.filteredQueue.length,a=t.map((e,t)=>{const n=new Te(t+i,e,this.matcher,this.chapterIndex,this.chapters[this.chapterIndex].id);return this.nodeActionDesc.forEach(t=>{e.actions.push(new Ee(t.icon,t.description,async e=>{const i=await t.fun(n,e,ne,ye);i?.data&&(n.contentType=i.data.type,n.data=new Uint8Array(await i.data.arrayBuffer()),n.node.blobSrc=URL.createObjectURL(new Blob([n.data],{type:n.contentType})),n.render(!0),ye.emit("imf-on-finished",n.index,!0,n))}))}),n});n.queue.push(...a);const r=this.filter.filterNodes(a,!1);return r.forEach((e,t)=>e.index=i+t),n.filteredQueue.push(...r),this.queue.push(...r),this.appendToView(this.queue.length,r,this.chapterIndex),!0}catch(e){return u("error","page fetcher append images error: ",e),this.onFailed?.(e),!1}}async obtainImageNodeList(e){let t,n=0;for(;n<3;)try{return await this.matcher.parseImgNodes(e,this.chapters[this.chapterIndex].id)}catch(e){u("error","warn: parse image nodes failed, retrying: ",e),n++,t=e}throw u("error","warn: parse image nodes failed: reached max try times!"),t}onFailed(e){ye.emit("notify-message","error",e.toString())}}class Me{value;error;static ok(e){return{value:e}}static err(e){return{error:e}}}class Ne{async fetchChapters(){return[new Pe(0,"Default",window.location.href)]}title(e){const t=this.galleryMeta(e[0]);return t.originTitle||t.title||"unknown"}galleryMeta(e){return new ce(window.location.href,document.title||"unknown")}async processData(e,t,n){return[e,t]}headers(){return{}}appendNewChapters(e,t){throw new Error("this site does not support add new chapters yet")}}class $e extends Ne{meta;async fetchChapters(){const e=[],t=document.querySelector(".thumb-overlay > img"),n=Array.from(document.querySelectorAll(".visible-lg .episode > ul > a"));if(n.length>0)n.forEach((n,i)=>{const a=Array.from(n.querySelector("li")?.childNodes||[]).map(e=>e.textContent?.trim()).filter(Boolean).map(e=>e),r=new URL(n.href);r.searchParams.set("read_mode","read-by-page"),e.push(new Pe(i,a,r.href,t?.src))});else{const t=document.querySelector(".visible-lg .read-block")?.firstElementChild;if(void 0===t)throw new Error("No page found");let n="";if(n=t instanceof HTMLAnchorElement?t.href:t.getAttribute("href")||"",!n||n.startsWith("javascript"))throw new Error("未能找到阅读按钮！");if(n.startsWith("#coinbuycomic"))throw new Error("此漫画需要硬币解锁！请点击开始阅读按钮进行解锁。");const i=new URL(n);i.searchParams.set("read_mode","read-by-page"),e.push(new Pe(0,"Default",i.href))}return e}async*fetchPagesSource(e){yield Me.ok(e.source)}async parseImgNodes(e){const t=[],n=await window.fetch(e).then(e=>e.text()),i=(new DOMParser).parseFromString(n,"text/html"),a=Array.from(i.querySelectorAll(".owl-carousel-page > .center > img"));for(const e of a){const n=e.getAttribute("data-src");if(!n){u("error","warn: cannot find img src",e);continue}const i=n.split("/").pop();t.push(new Le("",n,i,void 0,n))}return t}async processData(e,t,n){const i=n.originSrc.match(/(\d+)\/(\d+)\.(\w+)/),a=i[1];if(Number(a)<220980)return[e,t];const r=i[2];if("gif"===i[3])return[e,t];const o=await createImageBitmap(new Blob([e],{type:t})),s=document.createElement("canvas");return s.width=o.width,s.height=o.height,function(e,t,n,i){const a=t.width,r=t.height,o=function(e,t){let n=(i=(e=window.atob(e))+(t=window.atob(t)),md5(i)).slice(-1).charCodeAt(0);var i;return parseInt(e)>=268850&&parseInt(e)<=421925?n%=10:parseInt(e)>=421926&&(n%=8),n<10?2+2*n:10}(window.btoa(n),window.btoa(i)),s=parseInt((r%o).toString()),l=a;for(let n=0;n<o;n++){let i=Math.floor(r/o),a=i*n;const c=r-i*(n+1)-s;0==n?i+=s:a+=s,e.drawImage(t,0,c,l,i,0,a,l,i)}}(s.getContext("2d"),o,a,r),new Promise(e=>s.toBlob(t=>t?.arrayBuffer().then(n=>e([new Uint8Array(n),t.type])).finally(()=>s.remove()),t))}galleryMeta(){if(this.meta)return this.meta;const e=document.querySelector(".panel-heading h2")?.textContent||document.title||"UNTITLE";this.meta=new ce(window.location.href,e),this.meta.originTitle=e;const t=document.querySelectorAll("div.tag-block > span"),n={};return t.forEach(e=>{const t=e.getAttribute("data-type")?.trim();if(t){const i=Array.from(e.querySelectorAll("a")).map(e=>e.textContent).filter(Boolean);i.length>0&&(n[t]=i)}}),this.meta.tags=n,this.meta}async fetchOriginMeta(e,t){let n=e.originSrc;if(t){const e=n.match(/\/\/cdn-msp(\d)?\./);let t=1;null!==e&&e.length>0&&(t=parseInt(e[1]??"1"),isNaN(t)&&(t=1),t++,t%=3,t=0===t?t=3:t),n=n.replace(/\/\/cdn-msp(\d)?\./,`//cdn-msp${1===t?"":t}.`)}return{url:n}}}ve.addSetup({name:"禁漫",workURLs:[/(18|jm)comic.*?\/album\/\d+/],match:["https://18comic.vip/*"],constructor:()=>new $e});const Oe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class qe extends Ne{async*fetchPagesSource(){yield Me.ok(document)}async parseImgNodes(e){const t=Array.from(e.querySelectorAll(".single-thumb > a")),n=t.length.toString().length,i=t.map((e,t)=>{const i=e.href,a=e.querySelector("img.lazy");if(!a)throw new Error("cannot find image element");const r=a.getAttribute("data-src")??"",o=r.split(".").pop()??"jpg",s=(t+1).toString().padStart(n,"0")+"."+o;return new Le(r,i,s,void 0,void 0,{w:a.width,h:a.height})});if(0===i.length)throw new Error("cannot find images by css selector: .single-thumb > a");const a=await window.fetch(i[0].href).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html")).catch(Error);if(a instanceof Error)throw a;const r=Array.from(a.querySelectorAll("script")).find(e=>e.textContent?.trimStart().startsWith("var readerPages ")),o=r?.textContent?.match(/var readerPages = JSON\.parse\(atob\("(.*)?\"\)\)/)?.[1];if(o){const e=JSON.parse(window.atob(o));i.forEach((t,n)=>{const i=e.pages[(n+1).toString()];i&&(t.title=i.f??t.title,t.originSrc=e.baseUriImg.replace("%s",i.f),t.rect={w:i.w,h:i.h})})}return i}async fetchOriginMeta(e){if(e.originSrc)return{url:e.originSrc};const t=await window.fetch(e.href).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html")).catch(Error);if(t instanceof Error)throw t;const n=t.querySelector(".js-main-img");if(!n)throw new Error("cannot find image from: "+e.href);return{url:n.src,title:n.src.split("/").pop()??e.title}}meta;galleryMeta(){if(this.meta)return this.meta;const e=document.querySelector("#main-info > h1")?.textContent??document.title,t=new ce(window.location.href,e);return Array.from(document.querySelectorAll(".tag-container.field-name")).forEach(e=>{const n=e.firstChild?.textContent?.trim()?.replace(":","")?.toLowerCase(),i=Array.from(e.querySelectorAll("span.filter-elem"));if(n&&i.length>0){const e=i.map(e=>e.textContent?.trim()).filter(Boolean);t.tags[n]=e}}),this.meta=t,this.meta}}ve.addSetup({name:"3Hentai",workURLs:[/3hentai.net\/d\/\d+$/],constructor:()=>new qe});const Ue=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class Be extends Ne{originImages;index=0;meta;title(){return this.galleryMeta().title}galleryMeta(){return this.meta||(this.meta=this.initGalleryMeta(document)),this.meta}initGalleryMeta(e){const t=e.querySelector("header.entry-header > h1")?.textContent??e.title,n=new ce(window.location.href,t);return n.originTitle=e.querySelector("header.entry-header > span")?.textContent||void 0,n.tags=Array.from(e.querySelectorAll("ul.info-list > li.meta-data")).reduce((e,t)=>{const n=t.querySelector("span.data")?.textContent?.replace(":","").toLowerCase().trim();return n&&(e[n]=Array.from(t.querySelectorAll("span.value")).map(e=>e.textContent?.trim()).filter(Boolean)),e},{}),n}async*fetchPagesSource(){const e=document.querySelector("meta[name='csrf-token'][content]")?.content;if(!e)throw new Error("cannot get csrf token form this page");this.originImages=await window.fetch(window.location.href,{headers:{"X-CSRF-TOKEN":e,"X-Requested-With":"XMLHttpRequest","Sec-Fetch-Dest":"empty"},method:"POST"}).then(e=>e.json());const t=Array.from(document.querySelectorAll("body > script")).find(e=>e.textContent?.trimStart().startsWith("var ajx"))?.textContent?.match(/pag = (\{.*?\}),/s)?.[1];if(!t)throw new Error("cannot get page info");const n=JSON.parse(t.replaceAll(/(\w+) :/g,'"$1":'));let i=n.idx;for(yield Me.ok(document);i*n.stp<n.cnt;){const t=await window.fetch(n.act,{headers:{"X-CSRF-TOKEN":e,"X-Requested-With":"XMLHttpRequest","Sec-Fetch-Dest":"empty","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",body:`index=${i}`});t.ok||(yield Me.err(new Error(`fetch thumbnails failed, status: ${t.statusText}`))),i++,yield Me.ok(await t.text().then(e=>(new DOMParser).parseFromString(e,"text/html")))}}async parseImgNodes(e){const t=Array.from(e.querySelectorAll("li > a.page-item"));if(0===t.length)throw new Error("cannot find thumbnails");const n=[],i=this.originImages.length.toString().length;for(const e of t){const t=this.originImages[this.index],a=e.href,r=e.firstElementChild.src,o=t.split(".").pop()??"jpg",s=r.slice(0,r.indexOf("tbn"))+t,l=(this.index+1).toString().padStart(i,"0");n.push(new Le(r,a,`${l}.${o}`,void 0,s)),this.index++}return n}async fetchOriginMeta(e){return{url:e.originSrc}}}ve.addSetup({name:"Akuma.moe",workURLs:[/akuma.moe\/g\/\w+\/?$/],match:["https://akuma.moe/*"],constructor:()=>new Be});const ze=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class De extends Ne{async*fetchPagesSource(){yield Me.ok(document)}async parseImgNodes(e){const t=Array.from(e.querySelectorAll(".article-content img:not(.arca-emoticon):not(.twemoji), .article-content video:not(.arca-emoticon)")),n=[],i=t.length.toString().length;return t.forEach((e,t)=>{if("img"===e.tagName.toLowerCase()){const a=e;if(a.src&&"0px"!==a.style.width){const e=a.src,r=new URL(e),o=r.pathname.split(".").pop();r.searchParams.set("type","orig");const s=(t+1).toString().padStart(i,"0")+"."+o;n.push(new Le(e,r.href,s,void 0,r.href))}}else if("video"===e.tagName.toLowerCase()){const a=e;if(a.src){const e=a.src,r=new URL(e),o=r.pathname.split(".").pop();r.searchParams.set("type","orig");const s=(t+1).toString().padStart(i,"0")+"."+o,l=a.poster||"";n.push(new Le(l,r.href,s,void 0,r.href))}}}),n}async fetchOriginMeta(e){return{url:e.href}}}ve.addSetup({name:"Arcalive",workURLs:[/arca.live\/b\/\w*\/\d+/],match:["https://arca.live/*"],constructor:()=>new De});const Fe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class Ve extends Ne{pageData=new Map;info={username:"",projects:0,assets:0};tags={};galleryMeta(){const e=new ce(window.location.href,`artstaion-${this.info.username}-w${this.info.projects}-p${this.info.assets}`);return e.tags=this.tags,e}async*fetchPagesSource(){const{id:e,username:t}=await this.fetchArtistInfo();this.info.username=t;let n=0;for(;;){n++;try{const i=await this.fetchProjects(t,e.toString(),n);if(!i||0===i.length)break;yield Me.ok(i)}catch(e){n--,yield Me.err(e)}}}async parseImgNodes(e){const t=e.map(e=>`https://www.artstation.com/projects/${e.hash_id}.json`),n=await b(t,10,"json"),i=[];for(const e of n)if(e instanceof Error)u("error",e.message),ye.emit("notify-message","error",e.message,8e3);else{this.info.projects++,this.tags[e.slug]=e.tags;for(let t=0;t<e.assets.length;t++){const n=e.assets[t];if("cover"===n.asset_type)continue;const a=n.image_url.replace("/large/","/small/"),r=n.image_url.match(/\.(\w+)\?\d+$/)?.[1]??"jpg",o=`${e.slug}-${t+1}.${r}`;let s=n.image_url;if(n.has_embedded_player&&n.player_embedded){if(n.player_embedded.includes("youtube"))continue;s=n.player_embedded}this.info.assets++,i.push(new Le(a,e.permalink,o,void 0,s,{w:n.width,h:n.height}))}}return i}async fetchOriginMeta(e){if(e.originSrc?.startsWith("<iframe")){const t=e.originSrc.match(/src=['"](.*?)['"]\s/)?.[1];if(!t)throw new Error("cannot match video clip url");const n=(await window.fetch(t).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html"))).querySelector("video > source");if(!n)throw new Error("cannot find video element");return{url:n.src}}return{url:e.originSrc}}async processData(e,t){return t.startsWith("binary")||t.startsWith("text")?[e,"video/mp4"]:[e,t]}async fetchArtistInfo(){const e=window.location.pathname.slice(1).split("/").shift();if(!e)throw new Error("cannot match artist's username");return await window.fetch(`https://www.artstation.com/users/${e}/quick.json`).then(e=>e.json())}async fetchProjects(e,t,n){const i=`https://www.artstation.com/users/${e}/projects.json?user_id=${t}&page=${n}`;return(await window.fetch(i).then(e=>e.json())).data}}ve.addSetup({name:"Art Station",workURLs:[/artstation.com\/[-\w]+(\/albums\/\d+)?$/],match:["https://www.artstation.com/*"],constructor:()=>new Ve});const je=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class He extends Ne{async*fetchPagesSource(){const e=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");if(!e)throw new Error("cannot find csrf_token");const t=document.querySelector("#load_id")?.value;if(!t)throw new Error("cannot find load_id");const n=document.querySelector("#load_dir")?.value;if(!n)throw new Error("cannot find load_dir");const i=document.querySelector("#t_pages")?.value;if(!i)throw new Error("cannot find t_pages");const a=window.location.origin+"/inc/thumbs_loader.php",r=await window.fetch(a,{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},body:`_token=${e}&id=${t}&dir=${n}&visible_pages=0&t_pages=${i}&type=2`,method:"POST"}).then(e=>e.text()).catch(Error);if(r instanceof Error)throw r;yield Me.ok(r)}async parseImgNodes(e){const t=Array.from(e.matchAll(/<a href="(.*?)".*data-src="(.*?)"/g)).filter(e=>3===e.length).map(e=>[e[1],e[2]]),n=t.length.toString().length;return t.map((e,t)=>new Le(e[1],window.location.origin+e[0],(t+1).toString().padStart(n,"0")))}async fetchOriginMeta(e){const t=e.href,n=await window.fetch(t).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html")).catch(Error);if(n instanceof Error)throw n;const i=n.querySelector("#fimg")?.getAttribute("data-src");if(!i)throw new Error("cannot find image from: "+t);const a=i.split(".").pop()??"jpg";return{url:i,title:e.title+"."+a}}meta;galleryMeta(){if(this.meta)return this.meta;const e=document.querySelector(".right > .info > h1")?.textContent??document.title,t=new ce(window.location.href,e);return t.originTitle=document.querySelector(".right > .info > h2")?.textContent??void 0,Array.from(document.querySelectorAll(".right > .info > ul > .tags")).forEach(e=>{const n=e.querySelector("h3")?.textContent?.trim().replace(":","").toLowerCase();if(n){const i=Array.from(e.querySelectorAll(".tag_list > a > span")).map(e=>e.firstChild?.textContent??void 0).filter(Boolean);i.length>0&&(t.tags[n]=i)}}),this.meta=t,this.meta}}ve.addSetup({name:"AsmHentai",workURLs:[/asmhentai.com\/g\/\d+\/?$/],match:["https://asmhentai.com/*"],constructor:()=>new He});const Ge=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class We extends Ne{async*fetchPagesSource(){const e=window.location.href.match(/space.bilibili.com\/(\d+)\//)?.[1];if(!e)throw new Error("cannot find host_mid from "+window.location.href);const t=document.querySelector("script#__RENDER_DATA__")?.textContent?.match(/%3A%22([\w\.\-_]*)%22/)?.[1];if(!t)throw new Error("cannot find webid");let n="",i=1;for(;;){const a=o(),r=Date.now().toString(),s=await fetch(`https://api.bilibili.com/x/polymer/web-dynamic/v1/opus/feed/space?host_mid=${e}&page=${i}&offset=${n}&type=all&web_location=333.1387&w_webid=${t}&w_rid=${a}&wts=${r}`,{credentials:"include",headers:{"Sec-Fetch-Dest":"empty","Sec-Fetch-Mode":"cors","Sec-Fetch-Site":"same-site"},referrer:window.location.href,method:"GET",mode:"cors"}).then(e=>e.json());if(0!==s.code&&(yield Me.err(new Error("fetch opus error: "+s.message))),0===s.data.items.length&&(yield Me.err(new Error("fetch opus zero"))),!s.data.has_more)return;{n=s.data.offset,i+=1;const e=[...s.data.items];for(;e.length>0;)yield Me.ok(e.splice(0,2)),await w(1e3)}}}async parseImgNodes(e){const t=[];for(const n of e){const e=await f(`https://www.bilibili.com/opus/${n.opus_id}?spm_id_from=333.1387.0.0`,"text",{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"en-US,en;q=0.7,zh-CN;q=0.3","Upgrade-Insecure-Requests":"1","Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"same-site","Sec-Fetch-User":"?1",Priority:"u=0, i",Origin:"https://space.bilibili.com",Cookie:document.cookie,Referrer:window.location.href});if(e.match("<title>验证码_哔哩哔哩</title>"))throw new Error("触发风控，请打开此链接处理验证码：https:"+n.jump_url);t.push(e)}const n=t.map(e=>{const t=e.match(/window.__INITIAL_STATE__=(\{.*\});/)?.[1];if(!t)throw new Error("fetch opus error: cannot find windows.__INITIAL_STATE__");const n=JSON.parse(t)?.detail;if(!n)throw new Error("fetch opus error: cannot find detail from windows.__INITIAL_STATE__");return n});if(e.length!==n.length)throw new Error(`fetch opus detail error, opus count: ${e.length}, detail count: ${n.length}`);return e.map((e,t)=>{const i=n[t].modules.filter(e=>"MODULE_TYPE_CONTENT"===e.module_type||"MODULE_TYPE_TOP"===e.module_type).map(e=>e.module_top?.display.album.pics??e.module_content?.paragraphs.filter(e=>e.pic).map(e=>e.pic?.pics??[]).flat()??[]).flat();if(!i)throw new Error("cannot find opus content: "+e.jump_url);const a=i.length.toString().length;return i.map((t,n)=>{const i=e.opus_id+"-"+(n+1).toString().padStart(a,"0");return new Le(0===n?e.cover.url:"",e.jump_url,i,void 0,t.url,{w:t.width,h:t.height})})}).flat()}async fetchOriginMeta(e){const t=e.originSrc?.split(".").pop()??"jpg";return{url:e.originSrc,title:e.title+"."+t}}}ve.addSetup({name:"Bilibili",workURLs:[/space.bilibili.com\/\d+\/upload\/opus$/],match:["https://www.bilibili.com/*"],constructor:()=>new We});const Ze=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Xe=/var C_DATA='(.*?)'/;class Ke extends Ne{infoMap={};keymap;keys=["dDeIieDgQpwVQZsJ","54bilXmmMoYBqBcI","KcmiZ8owmiBoPRMf","4uOJvtnq5YYIKZWA","lVfo0i0o4g3V78Rt","i8XLTfT8Mvu1Fcv2"];getActualK;async fetchChapters(){this.keys=await new Promise((e,t)=>{const n="https://www.colamanga.com/js/custom.js",i=document.createElement("script");i.addEventListener("load",async()=>{try{const t=function(e){const t=e.matchAll(/window(\[\w+\(0x[^)]+\)\]){2}\(((\w+)(\(0x[^)]+\))?),/gm),n=[];for(const i of t){const t=i[3],a=i[4];if(t)for(const[i,r]of x(e,t,a)){if(null===i||null===r)continue;const e=new Function("return "+i+r)();n.includes(e)||n.push(e)}}return n}(await window.fetch(n).then(e=>e.text()));e(t)}catch(e){t(e)}}),i.src=n,i.type="text/javascript",document.querySelector("head").append(i)}),[this.keymap,this.getActualK]=await new Promise((e,t)=>{const n="https://www.colamanga.com/js/manga.read.js",i=document.createElement("script");i.addEventListener("load",async()=>{try{const t=await window.fetch(n).then(e=>e.text());let i;const a=t.matchAll(/if\(_0x\w+==(0x\w+)\)return (_0x\w+)\((0x\w+)\);/gm),r={};let o=!0;for(const e of a){const n=e[1],a=e[2],s=e[3];if(!i){const e=x(t,a)?.[0]?.[0]??a;console.log("colamanga, the function name: ",e),i=new Function("p",`return ${e}(p)`)}const l=i(s);r[parseInt(n)]=l,o=!1}if(o)throw new Error("cannot init key map from "+n);const s=function(e){const t=e.match(/(eval\(function.*?\)\)\)),_0x/)?.[1];return new Function("ksddd",`\n        var actualKey = ksddd;\n        ${t};\n        return actualKey;\n      `)}(t);e([r,s])}catch(e){t(e)}}),i.src=n,i.type="text/javascript",document.querySelector("head").append(i)});const e=document.querySelector("dt.fed-part-rows > a")?.getAttribute("data-original")||void 0;return Array.from(document.querySelectorAll(".all_data_list .fed-part-rows > li > a")).map((t,n)=>new Pe(n,t.title,t.href,e))}async*fetchPagesSource(e){yield Me.ok(e.source)}async parseImgNodes(e,t){const n=await window.fetch(e).then(e=>e.text()),i=n.match(Xe)?.[1];if(!i)throw new Error("cannot find C_DATA from page: "+e);let a;for(const e of this.keys)try{a=v(e,y(i));break}catch(e){u("error",e.toString())}if(!a)throw new Error("colamanga decrypt C_DATA failed");a=a.replace("};","},"),a=a.replaceAll("info=","info:"),a="{"+a+"}",a=a.replaceAll(/(\w+):/g,'"$1":');const r=JSON.parse(a),[o,s]=function(e,t,n,i){let a,r;for(const t of i)try{if(a=v(t,y(e)),""==a||isNaN(parseInt(a)))throw new Error("colamanga failed decrypt image count");break}catch(e){u("error",e.toString())}for(const e of i)try{if(r=v(e,y(t)),""==r||!r.startsWith(n+"/"))throw new Error("colamanga failed decrypt image path");break}catch(e){u("error",e.toString())}return[a,r]}(r.mh_info.enc_code1,r.mh_info.enc_code2,r.mh_info.mhid,this.keys);if(void 0===o||void 0===s)throw new Error("colamanga decrypt mh_info failed");const l=[],c=window.location.origin+r.mh_info.webPath+r.mh_info.pageurl;this.infoMap[c]=r;for(let e=r.mh_info.startimg;e<=parseInt(o);e++){const[t,n]=C(e,s,r);l.push(new Le("",c,t,void 0,n))}return l}async fetchOriginMeta(e){return{url:e.originSrc}}async processData(e,t,n){const i=this.infoMap[n.href];if(!i)throw new Error("cannot found info from "+n.href);return i.image_info.imgKey?[this.decryptImageData(e,i.image_info.keyType,i.image_info.imgKey,this.keymap,this.keys),t]:[e,t]}headers(){return{Referer:window.location.href,Origin:window.location.origin}}decryptImageData(e,t,n,i,a){let r;if(""!==t&&"0"!==t)r=i[parseInt(t)];else for(const e of a)try{r=v(e,n);break}catch(e){u("error",e.toString())}const o=function(e){let t=[],n=0,i=e.length;for(;n<i;)t.push(e[n++]<<24|e[n++]<<16|e[n++]<<8|e[n++]);return{sigBytes:4*t.length,words:t}}(e),s={ciphertext:o},l=CryptoJS,c=this.getActualK?.(r),d=l.enc.Utf8.parse(c),h=function(e){const t=e.words.length,n=new Uint8Array(t<<2);let i,a=0;for(let r=0;r<t;r++)i=e.words[r],n[a++]=i>>24,n[a++]=i>>16&255,n[a++]=i>>8&255,n[a++]=255&i;return n}(l.AES.decrypt(s,d,{iv:l.enc.Utf8.parse("0000000000000000"),mode:l.mode.CBC,padding:l.pad.Pkcs7}));return h}}ve.addSetup({name:"colamanga",workURLs:[/colamanga.com\/manga-\w*\/?$/],match:["https://www.colamanga.com/*"],constructor:()=>new Ke});const Ye=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class Je extends Ne{tags={};blacklistTags=[];count=0;async*fetchPagesSource(){let e=document;this.blacklistTags=this.getBlacklist(e),yield Me.ok(e);let t=0;for(;;){const n=this.nextPage(e);if(!n)break;try{e=await window.fetch(n).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html"))}catch(e){t++,t>3&&(yield Me.err(new Error(`fetch next page failed, ${e}`)));continue}t=0,yield Me.ok(e)}}async fetchOriginMeta(e){const t=this.cachedOriginMeta(e.href);if(t)return t;let n=null;const i=await window.fetch(e.href).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html"));if(ve.conf.fetchOriginal&&(n=this.getOriginalURL(i)),n||(n=this.getNormalURL(i)),!n)throw new Error("Cannot find origin image or video url");let a;const r=n.split(".").pop()?.match(/^\w+/)?.[0],o=this.extractIDFromHref(e.href);return r&&o&&(a=`${o}.${r}`),{url:n,title:a}}cachedOriginMeta(e){return null}async parseImgNodes(e){const t=[];return this.queryList(e).forEach(e=>{const[n,i]=this.toImgNode(e);if(n){if(this.count++,""!==i){const e=i.trim().replaceAll(": ",":").split(" ").map(e=>e.trim()).filter(e=>""!==e);if(this.blacklistTags.findIndex(t=>e.includes(t))>=0)return;this.tags[n.title.split(".")[0]]=e}t.push(n)}}),t}galleryMeta(){const e=new URL(window.location.href),t=e.searchParams.get("tags")?.trim(),n=new ce(window.location.href,`${this.site().toLowerCase().replace(" ","-")}_${t}_${this.count}`);return n.tags=this.tags,n}}class Qe extends Je{site(){return"danbooru"}nextPage(e){return e.querySelector(".paginator a.paginator-next")?.href||null}queryList(e){return Array.from(e.querySelectorAll(".posts-container > article"))}getBlacklist(e){return e.querySelector("meta[name='blacklisted-tags']")?.getAttribute("content")?.split(",")||[]}toImgNode(e){const t=e.querySelector("a");if(!t)return u("error","warn: cannot find anchor element",t),[null,""];const n=t.querySelector("img");if(!n)return u("error","warn: cannot find img element",n),[null,""];const i=t.getAttribute("href");return i?[new Le(n.src,i,`${e.getAttribute("data-id")||e.id}.jpg`),e.getAttribute("data-tags")||""]:(u("error","warn: cannot find href",t),[null,""])}getOriginalURL(e){return e.querySelector("#image-resize-notice > a")?.href||null}getNormalURL(e){return e.querySelector("#image")?.getAttribute("src")||null}extractIDFromHref(e){return e.match(/posts\/(\d+)/)?.[1]}}class et extends Je{site(){return"rule34"}nextPage(e){if(window.location.search.includes("page=favorites")){const t=e.querySelector("#paginator a[name=next]")?.getAttribute("onclick")?.match(/location='(.*)?'/)?.[1]||null;return t?window.location.origin+"/"+t:t}return e.querySelector(".pagination a[alt=next]")?.href||null}queryList(e){return window.location.search.includes("page=favorites")?Array.from(e.querySelectorAll("#content .thumb a")):Array.from(e.querySelectorAll(".image-list > .thumb:not(.blacklisted-image) > a"))}getBlacklist(e){return e.querySelector("meta[name='blacklisted-tags']")?.getAttribute("content")?.split(",")||[]}toImgNode(e){const t=e.querySelector("img");if(!t)return u("error","warn: cannot find img element",t),[null,""];const n=e.getAttribute("href");return n?[new Le(t.src,n,`${e.id}.jpg`),t.getAttribute("alt")||""]:(u("error","warn: cannot find href",e),[null,""])}getOriginalURL(e){const t=e.querySelector("#note-container + script")?.textContent?.trim().replace("image = ","").replace(";","").replaceAll("'",'"');try{if(t){const e=JSON.parse(t);return`${e.domain}/${e.base_dir}/${e.dir}/${e.img}`}}catch(e){u("error","get original url failed",e)}return null}getNormalURL(e){const t=e.querySelector("#image,#gelcomVideoPlayer > source");return t?.getAttribute("src")||t?.getAttribute("data-cfsrc")||null}extractIDFromHref(e){return e.match(/id=(\d+)/)?.[1]}}class tt extends Je{site(){return"gelbooru"}nextPage(e){const t=e.querySelector("#paginator a[alt=next]")?.href;return t||e.querySelector("#paginator b + a")?.href||null}queryList(e){return Array.from(e.querySelectorAll(".thumbnail-container > article.thumbnail-preview:not(.blacklisted-image) > a"))}getBlacklist(e){return e.querySelector("meta[name='blacklisted-tags']")?.getAttribute("content")?.split(",")||[]}toImgNode(e){const t=e.querySelector("img");if(!t)return u("error","warn: cannot find img element",t),[null,""];const n=e.getAttribute("href");if(!n)return u("error","warn: cannot find href",e),[null,""];const i=new Le(t.src,n,`${e.id}.jpg`),a=t.title.split(" ").map(e=>e.trim()).filter(e=>e&&!(e.startsWith("score")||e.startsWith("rating"))).map(e=>"tag:"+e);return i.setTags(...a),[i,t.getAttribute("alt")||""]}getOriginalURL(e){return e.querySelector("head > meta[property='og:image']")?.getAttribute("content")||null}getNormalURL(e){const t=e.querySelector("#image");if(t?.src)return t.src;const n=Array.from(e.querySelectorAll("#gelcomVideoPlayer > source"));return 0===n.length?null:n.find(e=>e.type.endsWith("mp4"))?.src||n[0].src}extractIDFromHref(e){return e.match(/id=(\d+)/)?.[1]}}class nt extends Je{cache=new Map;nextPage(e){return e.querySelector(".pagination #paginator-next")?.href??null}getOriginalURL(){throw new Error("Method not implemented.")}getNormalURL(){throw new Error("Method not implemented.")}extractIDFromHref(){throw new Error("Method not implemented.")}getBlacklist(e){const t=e.querySelector("meta[name='blacklisted-tags']")?.getAttribute("content");return t?t.slice(1,-1).split(",").map(e=>e.slice(1,-1)):[]}queryList(e){return be.imgSrcCSP=!0,Array.from(e.querySelectorAll(".posts-container > article"))}toImgNode(e){const t=e.getAttribute("data-preview-url");if(!t)return[null,""];const n=e.getAttribute("data-tags"),i=e.getAttribute("data-id"),a=e.getAttribute("data-sample-url"),r=e.getAttribute("data-file-url"),o=e.getAttribute("data-file-ext")||void 0;if(!a||!r||!i)return[null,""];const s=`${window.location.origin}/posts/${i}`,l=e.getAttribute("data-width"),c=e.getAttribute("data-height");let d;return l&&c&&(d={w:parseInt(l),h:parseInt(c)}),this.cache.set(s,{normal:a,original:r,id:i,fileExt:o}),[new Le(t,s,`${i}.jpg`,void 0,void 0,d),n||""]}cachedOriginMeta(e){const t=this.cache.get(e);if(!t)throw new Error("miss origin meta: "+e);const n=t.fileExt??t.original.split(".").pop()??"jpg";return ve.conf.fetchOriginal||["webm","webp","mp4"].includes(n)?{url:t.original,title:`${t.id}.${n}`}:{url:t.normal,title:`${t.id}.${t.normal.split(".").pop()}`}}site(){return"e621"}}ve.addSetup({name:"e621",workURLs:[/e621.net\/((posts|favorites)(?!\/)|$)/],match:["https://e621.net/*"],constructor:()=>new nt}),ve.addSetup({name:"rule34",workURLs:[/rule34.xxx\/index.php\?page=(post&s=list|favorites&s=view)/],match:["https://rule34.xxx/*"],constructor:()=>new et}),ve.addSetup({name:"gelbooru",workURLs:[/gelbooru.com\/index.php\?page=post&s=list/],match:["https://gelbooru.com/*"],constructor:()=>new tt}),ve.addSetup({name:"danbooru",workURLs:[/danbooru.donmai.us\/(posts(?!\/)|$)/],match:["https://danbooru.donmai.us/*"],constructor:()=>new Qe});const it=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class at extends Ne{meta;async*fetchPagesSource(){const e=window.location.href.match(/eahentai.com\/a\/(\d+)/)?.[1];if(!e)throw new Error("cannot get gallery id from url: "+window.location.href);const t=`${window.location.origin}/api/image/album/${e}`,n=await window.fetch(t,{referrer:window.location.href}).then(e=>e.json());if(!n||0===n.length)throw new Error("cannot fetch album data from: "+t);const i=n[0],a=new ce(window.location.href,i.title);a.tags.tags=i.tags.split("|"),a.tags.author=[i.author],a.tags.albumType=i.albumType.split("|"),a.tags.characters=i.characters?.split("|")??[],this.meta=a,yield Me.ok(n[0])}async parseImgNodes(e){return e.images.map((t,n)=>{const i=I(t.thumbnailUri),a=`${window.location.origin}/a/${e.albumID}/${n}`,r=t.imageUri.split(".").pop()??"jpg",o=I(t.imageUri);return new Le(i,a,t.title+"."+r,void 0,o)})}async fetchOriginMeta(e){return{url:e.originSrc}}galleryMeta(e){return this.meta??super.galleryMeta(e)}}ve.addSetup({name:"eahentai",workURLs:[/eahentai.com\/a\/\d+\/?$/],match:["https://eahentai.com/*"],constructor:()=>new at});const rt=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),ot={normal:/\<img\sid=\"img\"\ssrc=\"(.*?)\"\sstyle/,original:/\<a\shref=\"(http[s]?:\/\/e[x-]?hentai(55ld2wyap5juskbm67czulomrouspdacjamjeloj7ugjbsad)?\.(org|onion)\/fullimg?[^"\\]*)\"\>/,nlValue:/\<a\shref=\"\#\"\sid=\"loadfail\"\sonclick=\"return\snl\(\'(.*)\'\)\"\>/,isMPV:/https?:\/\/e[-x]hentai(55ld2wyap5juskbm67czulomrouspdacjamjeloj7ugjbsad)?\.(org|onion)\/mpv\/\w+\/\w+\/#page\w/,mpvImageList:/imagelist\s=\s(\[.*?\])/,sprite:/url\((.*?)\)/,workURL:/e[-x]hentai(.*)?.(org|onion)\/g\/\w+/};class st extends Ne{docMap={};title(e){const t=e[0].meta||this.galleryMeta(e[0]);let n="";return n="japanese"===ve.conf.ehentaiTitlePrefer?t.originTitle||t.title||"UNTITLE":t.title||t.originTitle||"UNTITLE",e.length>1&&(n+="+"+e.length+"chapters"),n}galleryMeta(e){if(e.meta)return e.meta;const t=this.docMap[e.id],n=t.querySelectorAll("#gd2 h1");let i,a;n&&n.length>0&&(i=n[0].textContent||void 0,n.length>1&&(a=n[1].textContent||void 0)),e.meta=new ce(window.location.href,i||"UNTITLE"),e.meta.originTitle=a;const r=t.querySelectorAll("#taglist tr"),o={},s=t.querySelector("#gdc > div")?.textContent;s&&(o.category=[s]);const l=t.querySelector("#gdn > a")?.textContent;return l&&(o.uploader=[l]),Array.from(t.querySelectorAll("#gdd > table:not([hidden]) tr")).forEach(e=>{const t=e.querySelector(".gdt1")?.textContent?.replace(":","")?.toLowerCase();let n=e.querySelector(".gdt2")?.textContent;if(t&&n){if("parent"!==t&&"父级"!==t||(n=e.querySelector(".gdt2 a")?.href??n),"language"===t||"语言"===t)return;o[t]=[n]}}),r.forEach(e=>{const t=e.childNodes,n=t[0].textContent;if(n&&t[1]){const e=[];t[1].childNodes.forEach(t=>{t.textContent&&e.push(t.textContent)}),o[n.replace(":","")]=e}}),e.meta.tags=o,e.meta}async fetchChapters(){const e=new Pe(0,"Default",window.location.href);return this.docMap[0]=document,this.galleryMeta(e),e.title=e.meta.title,[e]}async appendNewChapters(e,t){if(!ot.workURL.test(e))throw new Error("invaild gallery url");const n=await window.fetch(e).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html"));let i=t[t.length-1]?.id||0;i+=1;const a=new Pe(i,"NewChapter-"+i,e);return this.docMap[i]=n,this.galleryMeta(a),a.title=a.meta.title,[a]}async parseImgNodes(e){const t=[],n=await window.fetch(e).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html"));if(!n)throw new Error("warn: eh matcher failed to get document from source page!");let i=!1,a=e=>{const t=e.firstElementChild,n=t.firstElementChild,i=n.getAttribute("title")?.replace(/Page\s\d+[:_]\s*/,"")||"untitle.jpg";return{thumbnailImage:n.src,title:i,href:t.getAttribute("href"),wh:_(n.src)||{w:100,h:100},style:e.style,backgroundImage:null,delaySrc:void 0}},r=n.querySelectorAll("#gdt .gdtl");if(r&&0!=r.length||(r=n.querySelectorAll("#gdt .gdtm > div"),i=r?.length>0,a=e=>{const t=e.firstElementChild,n=t.firstElementChild,i=n.getAttribute("title")?.replace(/Page\s\d+[:_]\s*/,"")||"untitle.jpg";return{backgroundImage:e.style.background.match(ot.sprite)?.[1]?.replaceAll('"',"")||null,title:i,href:t.getAttribute("href"),wh:S(e.style)??{w:100,h:100},style:e.style,thumbnailImage:"",delaySrc:void 0}}),r&&0!=r.length||(r=n.querySelectorAll("#gdt > a"),i=r?.length>0,a=e=>{const t=e;let n=t.firstElementChild;(!n.style.background||n.childElementCount>0)&&(n=n.firstElementChild);const i=n.getAttribute("title")?.replace(/Page\s\d+[:_]\s*/,"")||"untitle.jpg";return{backgroundImage:n.style.background.match(ot.sprite)?.[1]?.replaceAll('"',"")||null,title:i,href:t.getAttribute("href"),wh:S(n.style)??{w:100,h:100},style:n.style,thumbnailImage:"",delaySrc:void 0}}),!r||0==r.length)throw new Error("warn: failed query image nodes!");const o=[],s=Array.from(r),l=a(s[0]);if(ot.isMPV.test(l.href)){i=!0;const e=await window.fetch(l.href).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html")),t=JSON.parse(e.querySelector("#pane_outer + script")?.innerHTML.match(ot.mpvImageList)?.[1]??"[]"),n=Array.from(e.querySelectorAll("#pane_thumbs > a > div")),a=location.pathname.split("/")[2];for(let e=0;e<t.length;e++){const i=t[e],r=i.t.match(/\((http.*)\)/)?.[1]||null;n[e].style.background="url"+i.t;const s={backgroundImage:r,title:i.n,href:`${location.origin}/s/${i.k}/${a}-${e+1}`,wh:S(n[e].style)??{w:100,h:100},style:n[e].style,thumbnailImage:"",delaySrc:void 0};o.push(s)}}else s.forEach(e=>o.push(a(e)));if(i){const e=[];for(let t=0;t<o.length;t++){const n=o[t];n.backgroundImage?0===e.length||e[e.length-1].url!==n.backgroundImage?e.push({url:n.backgroundImage,range:[{index:t,style:n.style}]}):e[e.length-1].range.push({index:t,style:n.style}):u("error","e-hentai miss node, ",n)}e.forEach(({url:e,range:t})=>{if(e=e.startsWith("http")?e:window.location.origin+e,1===t.length)o[t[0].index].thumbnailImage=e;else{const i=[];for(let e=0;e<t.length;e++)o[t[e].index].delaySrc=new Promise((e,t)=>i.push({resolve:e,reject:t}));A(e,(n=t.map(e=>e.style),n.map(e=>{const[t,n]=e.backgroundPosition.split(" ").map(e=>Math.abs(parseInt(e)));if(isNaN(t))throw new Error("invalid background position");return{x:t,y:n,width:parseInt(e.width),height:parseInt(e.height)}}))).then(e=>{for(let t=0;t<e.length;t++)i[t].resolve(e[t])}).catch(e=>i.forEach(t=>t.reject(e)))}var n})}for(let e=0;e<o.length;e++){const n=o[e];t.push(new Le(n.thumbnailImage,n.href,n.title,n.delaySrc,void 0,n.wh))}return t}async*fetchPagesSource(e){const t=this.docMap[e.id],n=t.querySelector("#gdt a")?.getAttribute("href");if(n&&ot.isMPV.test(n))return void(yield Me.ok(window.location.href));const i=Array.from(t.querySelectorAll(".gtb td a")).filter(e=>e.href).map(e=>e.href);if(0===i.length)throw new Error("cannot found next page elements");let a,r=0;for(const e of i){const t=new URL(e),n=parseInt(t.searchParams.get("p")||"0");n>=r&&(r=n,a=t)}if(!a)throw new Error("cannot found next page elements again");a.searchParams.delete("p"),yield Me.ok(a.href);for(let e=1;e<r+1;e++)a.searchParams.set("p",e.toString()),yield Me.ok(a.href)}async fetchOriginMeta(e,t){const n=await window.fetch(e.href).then(e=>e.text()).catch(e=>new Error(e));if(n instanceof Error||!n)throw new Error(`fetch source page error, ${n.toString()}`);let i;if(ve.conf.fetchOriginal){i=ot.original.exec(n)?.[1].replace(/&amp;/g,"&");const t=e.href.includes("?")?e.href.split("?").pop():void 0;i&&t&&(i+="?"+t)}if(i||(i=ot.normal.exec(n)?.[1]),t){const t=ot.nlValue.exec(n)?.[1];t?(e.href=e.href+(e.href.includes("?")?"&":"?")+"nl="+t,u("info",`IMG-FETCHER retry url:${e.href}`),i=(await this.fetchOriginMeta(e,!1)).url):u("error",`Cannot matching the nlValue, content: ${n}`)}if(!i)throw u("error","cannot matching the image url from content:\n",n),new Error("cannot matching the image url from content. (the content is showing up in console(F12 open it)");if(i.startsWith("http")||(i=window.location.origin+i),i.endsWith("509.gif"))throw new Error("509, Image limits Exceeded, Please reset your Quota!");return{url:i,href:e.href}}async processData(e,t){if(t.startsWith("text")&&1329===e.byteLength)throw new Error('fetching the raw image requires being logged in, please try logging in or disable "raw image"');return[e,t]}}ve.addSetup({name:"e-hentai",workURLs:[ot.workURL],constructor:()=>new st});const lt=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class ct extends Ne{meta;galleryMeta(){return this.meta}parseMeta(){const e=document.querySelector(".comics-panel-margin h3.title")?.textContent?.replaceAll(/\s/g,""),t=document.querySelector(".comics-panel-margin h4.title")?.textContent?.replaceAll(/\s/g,""),n=new ce(window.location.href,e??document.title);n.originTitle=t??void 0,Array.from(document.querySelectorAll(".comics-panel-margin .comics-metadata-margin-top h5")).forEach(e=>{let t=e.firstChild?.textContent??"misc";t=t.trim().replace(/：:/,"");const i=Array.from(e.querySelectorAll("a")).map(e=>e.textContent?.trim()).filter(Boolean);n.tags[t]=i}),this.meta=n}async*fetchPagesSource(){this.parseMeta(),yield Me.ok(document)}async parseImgNodes(e){const t=Array.from(e.querySelectorAll(".comics-panel-margin > a")),n=t[0],i={j:"jpg",p:"png",g:"gif",w:"webp"};let a,r="";if(n){const e=await window.fetch(n.href).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html")),t=e.querySelector("#comic-content-wrapper img");r=t?.getAttribute("prefix")??t?.getAttribute("data-prefix")??"";const i=e.querySelector("#comic-content-wrapper script")?.textContent?.match(/extensions.innerHTML = '(.*)?'/)?.[1]?.replaceAll("&quot;",'"');a=i?JSON.parse(i):void 0}const o=t.length.toString().length;return t.map((e,t)=>{const n=e.href,s=e.querySelector("img")?.getAttribute("data-srcset")||"";let l="jpg",c=r&&a?`${r}${a[t]}.${l}`:void 0;return r&&a&&r.includes("nhentai")&&(l=i[a?.[t]??"j"]??"jpg",c=`${r}${t+1}.${l}`),new Le(s,n,(t+1).toString().padStart(o,"0")+"."+l,void 0,c)})}async fetchOriginMeta(e,t){if(!t&&e.originSrc)return{url:e.originSrc};const n=(await window.fetch(e.href).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html"))).querySelector("#comic-content-wrapper img");if(!n)throw new Error("cannot find img from "+e.href);return{url:n.src}}headers(){return{Origin:"",Referer:""}}}ve.addSetup({name:"hanime1.me",workURLs:[/hanime1.me\/comic\/\d+\/?$/],match:["https://hanime1.me/comic/*"],constructor:()=>new ct});const dt=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),ht=/initReader\("(.*?)\",\s?"(.*?)",\s?(.*?)\)/,pt=/read\/\d+\/(\d+)$/;class gt extends Ne{meta;baseURL;readerData;async*fetchPagesSource(){this.meta=this.pasrseGalleryMeta(document),yield Me.ok(document)}async parseImgNodes(e){const t=[];return Array.from(e.querySelectorAll(".section .container + .container > .box > .columns > .column a")).forEach((e,n)=>{const i=e.querySelector("img");if(!i)return;const a=(e.href.split("/").pop()||n.toString())+"."+i.src.split(".").pop();t.push(new Le(i.src,e.href,a))}),t}async fetchOriginMeta(e){if(!this.readerData){const t=await window.fetch(e.href).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html")),n=t.querySelector("body > script")?.textContent?.match(ht)?.slice(1);if(!n||3!==n.length)throw new Error("cannot find reader data");try{this.initReader(n[0],n[1])}catch(e){throw new Error("hentainexus updated decryption function")}}if(!this.readerData)throw new Error("cannot find reader data");const t=e.href.match(pt)?.[1]||"001",n=this.readerData.find(e=>e.url_label===t)?.image;if(!n)throw new Error("cannot find image url");const i=n.split(".").pop();return{url:n,title:t+"."+i}}galleryMeta(e){return this.meta||super.galleryMeta(e)}pasrseGalleryMeta(e){const t=e.querySelector("h1.title")?.textContent||"UNTITLED",n=new ce(this.baseURL||window.location.href,t);return e.querySelectorAll(".view-page-details tr").forEach(e=>{const t=e.querySelector(".viewcolumn")?.textContent?.trim();if(!t)return;let i=Array.from(e.querySelector(".viewcolumn + td")?.childNodes||[]).map(e=>e?.textContent?.trim()).filter(Boolean);0!==i.length&&("Tags"===t&&(i=i.map(e=>e.replace(/\s?\([0-9,]*\)$/,""))),n.tags[t]=i)}),n}initReader(e,t){this.meta&&(this.meta.originTitle=t.replace(/::\s?HentaiNexus/,""));const n=window.location.hostname.split(""),i=Math.min(n.length,64),a=window.atob(e).split("");for(let e=0;e<i;e++)a[e]=String.fromCharCode(a[e].charCodeAt(0)^n[e].charCodeAt(0));const r=a.join(""),o=[],s=[];for(let e=2;s.length<16;++e)if(!o[e]){s.push(e);for(let t=e<<1;t<=256;t+=e)o[t]=!0}let l=0;for(let e=0;e<64;e++){l^=r.charCodeAt(e);for(let e=0;e<8;e++)l=1&l?l>>>1^12:l>>>1}l&=7;const c=new Uint8Array(256);for(let e=0;e<256;e++)c[e]=e;let d="",h=0;for(let e=0,t=0;e<256;e++)t=(t+c[e]+r.charCodeAt(e%64))%256,h=c[e],c[e]=c[t],c[t]=h;for(let e=s[l],t=0,n=0,i=0,a=0,o=0;o+64<r.length;o++)i=(i+e)%256,a=(n+c[(a+c[i])%256])%256,n=(n+i+c[i])%256,h=c[i],c[i]=c[a],c[a]=h,t=c[(a+c[(i+c[(t+n)%256])%256])%256],d+=String.fromCharCode(r.charCodeAt(o+64)^t);this.readerData=JSON.parse(d)}}ve.addSetup({name:"hentainexus",workURLs:[/hentainexus.com\/view\/\d+/],match:["https://hentainexus.com/*"],constructor:()=>new gt});const ut=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),mt={j:"jpg",p:"png",b:"bmp",g:"gif",w:"webp"};class ft extends Ne{meta;galleryMeta(){if(this.meta)return this.meta;const e=document.querySelector(".gp_top_right > h1")?.textContent??document.title;return this.meta=new ce(window.location.href,e),Array.from(document.querySelectorAll(".gp_top_right_info > ul")).forEach(e=>{const t=e.querySelector("span.info_txt")?.textContent?.replace(":","")?.toLowerCase();if(!t)return;const n=Array.from(e.querySelectorAll("a.gp_btn_tag")).map(e=>e.firstChild?.textContent).filter(Boolean);this.meta.tags[t]=n}),this.meta}async*fetchPagesSource(){const e=Array.from(document.querySelectorAll("script")).find(e=>e.textContent?.trimStart()?.startsWith("var g_th"))?.textContent?.match(/\('(\{.*\})'\)/)?.[1];if(!e)throw new Error("cannot find g_th");const t=document.querySelector("input#load_server")?.value;if(!t)throw new Error("cannot find server id");const n=document.querySelector("input#load_dir")?.value;if(!n)throw new Error("cannot find load dir");const i=document.querySelector("input#gallery_id")?.value;if(!i)throw new Error("cannot find gallery id");const a=document.querySelector("input#load_id")?.value;if(!a)throw new Error("cannot find load id");const r=document.querySelector("input#load_pages")?.value;if(!r)throw new Error("cannot find load pages");const o=JSON.parse(e),s={serverID:t,galleryID:i,loadDir:n,loadID:a,loadPages:parseInt(r),images:o};yield Me.ok(s)}async parseImgNodes(e){const t=`m${e.serverID}.hentaizap.com`,n=[],i=e.loadPages.toString().length;for(let a=0;a<e.loadPages;a++){const[r,o,s]=e.images[(a+1).toString()]?.split(",")??[];if(!r||!o||!s)throw new Error("cannot find image g_th: "+(a+1));const l=mt[r]??"webp",c=`https://${t}/${e.loadDir}/${e.loadID}/${a+1}t.jpg`,d=`${window.location.origin}/g/${e.galleryID}/${a+1}/`,h=`https://${t}/${e.loadDir}/${e.loadID}/${a+1}.${l}`,p=(a+1).toString().padStart(i,"0"),g=new Le(c,d,`${p}.${l}`,void 0,h,{w:parseInt(o),h:parseInt(s)});n.push(g)}return n}async fetchOriginMeta(e){return{url:e.originSrc}}}ve.addSetup({name:"HentaiZap",workURLs:[/hentaizap.com\/gallery\/\w+\/?/],match:["https://hentaizap.com/*"],constructor:()=>new ft});const bt=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),wt="gold-usergeneratedcontent.net";class vt{base=void 0;b;m;constructor(e,t){this.b=e,this.m=new Function("g",t)}real_full_path_from_hash(e){return e.replace(/^.*(..)(.)$/,"$2/$1/"+e)}s(e){const t=/(..)(.)$/.exec(e);return parseInt(t[2]+t[1],16).toString(10)}subdomain_from_url(e,t,n){let i="";t||("webp"===n?i="w":"avif"===n&&(i="a"));let a=/\/[0-9a-f]{61}([0-9a-f]{2})([0-9a-f])/.exec(e);if(!a)return i;let r=parseInt(a[2]+a[1],16);return isNaN(r)||(t?i=String.fromCharCode(97+this.m(r))+t:i+=1+this.m(r)),i}thumbURL(e){e=e.replace(/^.*(..)(.)$/,"$2/$1/"+e);const t="https://a."+wt+"/webpsmalltn/"+e+".webp";return t.replace(/\/\/..?\.(?:gold-usergeneratedcontent\.net|hitomi\.la)\//,"//"+this.subdomain_from_url(t,"tn","webp")+"."+wt+"/")}originURL(e,t){let n=t;"webp"===n||"avif"===n?n="":n+="/";let i="https://a."+wt+"/"+n+this.b+this.s(e)+"/"+e+"."+t;return i=i.replace(/\/\/..?\.(?:gold-usergeneratedcontent\.net|hitomi\.la)\//,"//"+this.subdomain_from_url(i,this.base,t)+"."+wt+"/"),i}}const yt=/m:\sfunction\(g\)\s{(.*?return.*?;)/s,Ct=/b:\s'(\d*\/)'/;class xt extends Ne{gg;meta={};infoRecord={};formats=["avif","jxl","webp"];formatIndex=0;async fetchChapters(){if(this.formatIndex="auto"===ve.conf.hitomiFormat?0:this.formats.indexOf(ve.conf.hitomiFormat),-1===this.formatIndex)throw new Error("invalid hitomi format: "+ve.conf.hitomiFormat);const e=await window.fetch(`https://ltn.${wt}/gg.js?_=${Date.now()}`).then(e=>e.text());this.gg=new vt(Ct.exec(e)[1],yt.exec(e)[1]);const t=[];return t.push(new Pe(0,document.querySelector("#gallery-brand")?.textContent||"default",window.location.href,document.querySelector(".content > .cover-column > .cover img")?.src)),t}async*fetchPagesSource(e){const t=e.source,n=t.match(/([0-9]+)(?:\.html)/)?.[1];if(!n)throw new Error("cannot query hitomi gallery id");const i=await window.fetch(`https://ltn.${wt}/galleries/${n}.js`).then(e=>e.text()).then(e=>e.replace("var galleryinfo = ",""));if(!i)throw new Error("cannot query hitomi gallery info");const a=JSON.parse(i);this.setGalleryMeta(a,n,e),yield Me.ok(a)}async parseImgNodes(e){const t=e.files,n=[];for(let e=0;e<t.length;e++){const i=t[e];let a=this.formats.slice(this.formatIndex).find(e=>1===i["has"+e]);a||(a="webp",u("error","no format found: ",t[e]));const r=i.name.replace(/\.\w+$/,""),o=this.gg.originURL(i.hash,a),{width:s,height:l}=i;n.push(new Le(this.gg.thumbURL(t[e].hash),o,r+"."+a,void 0,o,s&&l?{w:s,h:l}:void 0))}return n}async fetchOriginMeta(e){return{url:e.originSrc}}setGalleryMeta(e,t,n){this.infoRecord[n.id]=e,this.meta[n.id]=new ce(n.source,e.title||"hitomi-"+t),this.meta[n.id].originTitle=e.japanese_title||void 0;const i=["scene_indexes","files"];for(const t in e)i.indexOf(t)>-1||(this.meta[n.id].tags[t]=e[t])}galleryMeta(e){return this.meta[e.id]}title(){const e=Object.entries(this.infoRecord);return 0===e.length?"hitomi-unknown":1===e.length?e[0][1].japanese_title||e[0][1].title||"hitomi-unknown":"hitomi-multiple"+e.map(e=>e[1].id).join("_")}}ve.addSetup({name:"hitomi",workURLs:[/hitomi.la\/(?!reader)\w+\/.*\d+\.html/],match:["https://hitomi.la/*"],constructor:()=>new xt});const It=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class At extends Ne{meta;data;gth;async fetchOriginMeta(e,t){return{url:e.originSrc}}async parseImgNodes(){if(!this.data||!this.gth)throw new Error("impossibility");const e=[],t=this.data.total.toString().length;for(let n=1;n<=this.data.total;n++){const i=`https://m${this.data.server}.imhentai.xxx/${this.data.imgDir}/${this.data.gid}/${n}t.jpg`,a=`https://imhentai.xxx/view/${this.data.uid}/${n}/`,r=E(this.gth[n.toString()]),o=`https://m${this.data.server}.imhentai.xxx/${this.data.imgDir}/${this.data.gid}/${n}.${r}`;let s;const l=this.gth[n.toString()].split(",");3===l.length&&(s={w:parseInt(l[1]),h:parseInt(l[2])});const c=new Le(i,a,`${n.toString().padStart(t,"0")}.${r}`,void 0,o,s);e.push(c)}return e}async*fetchPagesSource(){const e=k("#load_server",document).value,t=k("#gallery_id",document).value,n=k("#load_id",document).value,i=k("#load_dir",document).value,a=k("#load_pages",document).value;this.data={server:e,uid:t,gid:n,imgDir:i,total:Number(a)};const r=Array.from(document.querySelectorAll("script")).find(e=>e.textContent?.trimStart().startsWith("var g_th"))?.textContent?.match(/\('(\{.*?\})'\)/)?.[1];if(!r)throw new Error("cannot match gallery images info");this.gth=JSON.parse(r),yield Me.ok(null)}title(){const e=this.galleryMeta();let t="";return t="japanese"===ve.conf.ehentaiTitlePrefer?e.originTitle||e.title||"UNTITLE":e.title||e.originTitle||"UNTITLE",t}galleryMeta(){if(this.meta)return this.meta;const e=document.querySelector(".right_details > h1")?.textContent||void 0,t=document.querySelector(".right_details > p.subtitle")?.textContent||void 0,n=new ce(window.location.href,e||"UNTITLE");n.originTitle=t,n.tags={};const i=Array.from(document.querySelectorAll(".galleries_info > li"));for(const e of i){let t=e.querySelector(".tags_text")?.textContent;if(!t)continue;if(t=t.replace(":","").trim(),!t)continue;const i=Array.from(e.querySelectorAll("a.tag")).map(e=>e.firstChild?.textContent?.trim()).filter(e=>Boolean(e));n.tags[t]=i}return this.meta=n,this.meta}}ve.addSetup({name:"im-hentai",workURLs:[/imhentai.xxx\/gallery\/\d+\//],match:["https://imhentai.xxx/*"],constructor:()=>new At});const _t=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class St extends Ne{config;async*fetchPagesSource(){this.config=function(){const e=new Error("cannot find instagram config from script[data-sjs]"),t=Array.from(document.querySelectorAll("script[data-sjs]")).find(e=>e.textContent?.trimStart().startsWith('{"require":[["ScheduledServerJS","handle",null,[{"__bbox":{"define":'))?.textContent;if(!t)throw e;const n=JSON.parse(t),i=n.require?.[0]?.[3]?.[0]?.__bbox?.define,a=i.reduce((e,t)=>(e[t[0]]=t[2],e),{});if(!a)throw e;let r=a.InstagramSecurityConfig?.csrf_token,o=a.LSD?.token,s=a.WebBloksVersioningID?.versioningID,l=a.CurrentUserInitialData?.APP_ID,c=a.CurrentUserInitialData?.NON_FACEBOOK_USER_ID,d=a.SiteData?.haste_session,h=a.SiteData?.client_revision,p=a.SiteData?.hsi,g=a.SiteData?.__spin_r,u=a.SiteData?.__spin_b,m=a.SiteData?.__spin_t,f=a.DTSGInitData?.token;const b=window.location.pathname.split("/")?.[1];if(!(r&&o&&s&&l&&c&&d&&h&&p&&g&&u&&m&&f&&b))throw e;return{csrfToken:r,lsd:o,bloksVersionID:s,appID:l,userID:c,hasteSession:d,clientVersion:h,hsi:p,spinR:g,spinB:u,spinT:m,dtsg:f,docID:"8363144743749214",apiName:"PolarisProfilePostsTabContentQuery_connection",dyn:"7xeUjG1mxu1syUbFp41twpUnwgU7SbzEdF8aUco2qwJxS0k24o0B-q1ew65xO0FE2awgo9oO0n24oaEnxO1ywOwv89k2C1Fwc60D87u3ifK0EUjwGzEaE2iwNwmE2eUlwhEe87q7U1mVEbUGdG1QwTU9UaQ0Lo6-3u2WE5B08-269wr86C1mwPwUQp1yUb9UK6V8aUuwm9EO6UaU4W",username:b}}();let e=null;for(;;)try{const[t,n]=await this.fetchPosts(e);if(e=n.end_cursor,yield Me.ok(t),!n.has_next_page)break}catch(e){yield Me.err(e)}}async parseImgNodes(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n],a=i.video_versions,r=!a&&i.carousel_media&&i.carousel_media.length>0?i.carousel_media.map(e=>e.image_versions2):[i.image_versions2],o=r.length.toString().length;for(let e=0;e<r.length;e++){const n=r[e],s=r.length>1?`${i.pk}-${(e+1).toString().padStart(o,"0")}`:i.pk,l=a?"mp4":"jpeg",[c,d]=this.getThumbAndOrigin(n.candidates,a);t.push(new Le(c?.url??"",`${window.location.origin}/p/${i.code}`,`${s}.${l}`,void 0,d.url,{w:c.width,h:c.height}))}}return t}async fetchOriginMeta(e){return{url:e.originSrc}}async fetchPosts(e){if(!this.config)throw new Error("instagram config null");const t=this.config,n=new Headers;n.append("x-fb-friendly-name",t.apiName),n.append("x-bloks-version-id",t.bloksVersionID),n.append("x-csrftoken",t.csrfToken),n.append("x-ig-app-id",t.appID),n.append("x-fb-lsd",t.lsd),n.append("x-asbd-id","129477");let i={username:t.username,__relay_internal__pv__PolarisIsLoggedInrelayprovider:!0,__relay_internal__pv__PolarisFeedShareMenurelayprovider:!0,data:{count:12,include_relationship_info:!0,latest_besties_reel_media:!0,latest_reel_media:!0}};e&&(i.after=e,i.before=null,i.first=12,i.last=null);const a=new URLSearchParams;a.append("av",t.userID),a.append("__d","www"),a.append("__user","0"),a.append("__a","1"),a.append("__req","x"),a.append("__hs",t.hasteSession),a.append("dpr","1"),a.append("__ccg","UNKNOWN"),a.append("__rev",t.clientVersion),a.append("__hsi",t.hsi),a.append("__dyn",t.dyn),a.append("__comet_req","7"),a.append("fb_dtsg",t.dtsg),a.append("lsd",t.lsd),a.append("__spin_r",t.spinR),a.append("__spin_b",t.spinB),a.append("__spin_t",t.spinT),a.append("fb_api_caller_class","RelayModern"),a.append("fb_api_req_friendly_name",t.apiName),a.append("variables",JSON.stringify(i)),a.append("server_timestamps","true"),a.append("doc_id",t.docID);const r=await window.fetch("https://www.instagram.com/graphql/query",{headers:n,body:a,method:"POST"}).then(e=>e.json()),o=r?.data?.xdt_api__v1__feed__user_timeline_graphql_connection;if(!o)throw new Error("failed fetch user's posts by API");return[o.edges.map(e=>e.node),o.page_info]}getThumbAndOrigin(e,t){const n=t?.[0]??e[0];let i;for(const t of e)if(i){if(i.width<t.width||t.width<=240)break;i=t}else i=t;return[i,n]}}ve.addSetup({name:"Instagram",workURLs:[/instagram.com\/(?!(home|explore|direct|reels|stories))\w+/],match:["https://www.instagram.com/*"],constructor:()=>new St});const kt=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Et=["jpeg","jpg","png","gif","webp","bmp","avif","jxl"],Lt=["mp4","webm","ogg","ogv","mov","avi","mkv","av1"];class Tt{async*next(){const e=new URL(window.location.href);let t=parseInt(e.searchParams.get("o")??"0");t=isNaN(t)?0:t;const n=e.searchParams.get("q");for(;;){const e=await window.fetch(this.getURL(t,n),{headers:{Accept:"text/css"}}).then(e=>e.json()).catch(Error);if(e instanceof Error){yield Me.err(e);continue}if(e.error){yield Me.err(new Error(e.error));continue}const i=this.getPosts(e);if(!i||0===i.length)break;t+=i.length;const a=P(this.getList(e));a.size>0&&i.forEach(e=>{if(e.file?.path){const t=a.get(e.file.path);e.file.name=t?.name,e.file.server=t?.server}e.attachments&&e.attachments.length>0&&e.attachments.forEach(e=>{if(e.path){const t=a.get(e.path);e.name=t?.name,e.server=t?.server}})});const r=i.length;for(;i.length>0;)yield Me.ok(i.splice(0,10));if(r<50)break}}}class Pt extends Tt{getURL(e,t){const n=new URL(`${window.location.origin}/api/v1${window.location.pathname}/posts`);return e>0&&n.searchParams.set("o",e.toString()),t&&n.searchParams.set("q",t),n.href}getPosts(e){return e}getList(e){return[]}}class Rt extends Tt{getURL(e,t){const n=new URL(`${window.location.origin}/api/v1${window.location.pathname}`);return e>0&&n.searchParams.set("o",e.toString()),t&&n.searchParams.set("q",t),n.href}getPosts(e){return e.posts}getList(){return[]}}class Mt extends Tt{getPosts(e){return e?.post?[e.post]:[]}getURL(){return`${window.location.origin}/api/v1${window.location.pathname}`}getList(e){return[...e.previews??[],...e.attachments??[]]}}class Nt extends Ne{list;constructor(){super(),window.location.href.includes("/posts")?this.list=new Rt:/user\/\w+/.test(window.location.href)&&(/post\/\w+/.test(window.location.href)?this.list=new Mt:this.list=new Pt)}fetchPagesSource(){if(!this.list)throw new Error("Current path is not supported");return this.list.next()}async parseImgNodes(e){const t=[],n=(e,t,n,i,a,r)=>{const o=`https://img.kemono.cr/thumbnail/data/${i}`,s=`${window.location.origin}/${n}/user/${t}/post/${e}`,l=new Le(o,s,a,void 0,r?`${r}/data/${i}?f=${a}`:void 0);i.indexOf(".mp4")>1&&(l.mimeType="video/mp4",l.thumbnailSrc="");const c=i.split(".").pop()??"";if(L(c)||!ve.conf.excludeVideo&&T(c))return l},i=[];for(const t of e){const e=[];t.file?.path&&e.push(t.file),e.push(...t.attachments??[]),i.push({res:t,list:e,needFetchPost:!e[0]?.server&&e.length>0})}await this.batchFetchPathServerMap(i);const a=new Map;for(const e of i)for(const i of e.list){if(!i.path)continue;if(!i.name||!i.server)throw new Error("cannot find image or video name and server");const r=n(e.res.id,e.res.user,e.res.service,i.path,i.name,i.server);if(r){if(a.has(r.originSrc))continue;a.set(r.originSrc,!0),t.push(r)}}return t}async fetchOriginMeta(e){if(!e.originSrc)throw new Error("cannot find kemono image file: "+e.href);return{url:e.originSrc}}async batchFetchPathServerMap(e){const t=e.filter(e=>e.needFetchPost).map(e=>new Request(`${window.location.origin}/api/v1/${e.res.service}/user/${e.res.user}/post/${e.res.id}`,{headers:{Accept:"text/css"}})),n=P((await b(t,10,"json")).reduce((e,t)=>[...e,...t.previews??[],...t.attachments??[]],[]));e.filter(e=>e.needFetchPost).forEach(e=>e.list.forEach(e=>{if(e.path){const t=n.get(e.path);e.name=t?.name,e.server=t?.server}}))}}ve.addSetup({name:"Kemono",workURLs:[/kemono.cr\/(\w+\/user\/\w+(\/post\/\w+)?|posts)(\?\w=.*)?$/],match:["https://kemono.cr/*"],constructor:()=>new Nt});const $t=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Ot=/Post\.register\((.*)\)/g;class qt extends Ne{infos={};count=0;async*fetchPagesSource(){let e=document;yield Me.ok(e);let t=0;for(;;){const n=e.querySelector("#paginator a.next_page")?.href;if(!n)break;try{e=await window.fetch(n).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html"))}catch(e){if(t++,t>3)throw new Error(`fetch next page failed, ${e}`);continue}t=0,yield Me.ok(e)}}async parseImgNodes(e){const t=e.querySelector("body > script + script")?.textContent;if(!t)throw new Error("cannot find post list from script");const n=t.matchAll(Ot),i=[];for(const e of n)if(e&&!(e.length<2))try{const t=JSON.parse(e[1]);this.infos[t.id.toString()]=t,this.count++;const n=t.file_ext||t.file_url.split(".").pop();i.push(new Le(t.preview_url,`${window.location.origin}/post/show/${t.id}`,`${t.id}.${n}`))}catch(e){u("error","parse post info failed",e);continue}return i}async fetchOriginMeta(e){const t=e.href.split("/").pop();if(!t)throw new Error(`cannot find id from ${e.href}`);let n;if(n=ve.conf.fetchOriginal?this.infos[t]?.file_url:this.infos[t]?.sample_url,!n)throw new Error(`cannot find url for id ${t}`);return{url:n}}galleryMeta(){const e=new URL(window.location.href),t=e.searchParams.get("tags")?.trim(),n=new ce(window.location.href,`konachan_${t}_${this.count}`);return n.infos=this.infos,n}}ve.addSetup({name:"konachan",workURLs:[/konachan.com\/post(?!\/show\/.*)/],match:["https://konachan.com/*"],constructor:()=>new qt});const Ut=Object.freeze(Object.defineProperty({__proto__:null,KonachanMatcher:qt},Symbol.toStringTag,{value:"Module"}));class Bt extends Ne{update_date;chapterCount=0;meta;galleryMeta(){if(this.meta)return this.meta;let e=document.querySelector(".comicParticulars-title-right > ul > li > h6")?.textContent??document.title;return document.querySelectorAll(".comicParticulars-title-right > ul > li > span.comicParticulars-right-txt").forEach(e=>{/^\d{4}-\d{2}-\d{2}$/.test(e.textContent?.trim()||"")&&(this.update_date=e.textContent?.trim())}),e+="-c"+this.chapterCount+(this.update_date?"-"+this.update_date:""),this.meta=new ce(window.location.href,e),this.meta}async*fetchPagesSource(e){yield Me.ok(e.source)}async parseImgNodes(e){const t=await f(e,"text",{"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.79 Safari/537.36"}),n=(new DOMParser).parseFromString(t,"text/html"),i=t.match(/var (jojo|ccy|cct)\s?=\s?'(.*?)';/)?.[2];if(!i)throw new Error("cannot find jojo|ccy|cct Key for decrypt :(");const a=n.querySelector(".imageData[contentKey]")?.getAttribute("contentKey")??t.match(/var (contentKey)\s?=\s?'(.*?)';/)?.[2];if(!a)throw new Error("cannot find content key");try{const t=await async function(e,t){const n=new TextEncoder,i=new TextDecoder,a=n.encode(t),r=e.substring(0,16),o=e.substring(16),s=n.encode(r),l=new Uint8Array(o.match(/.{1,2}/g).map(e=>parseInt(e,16))),c=await crypto.subtle.importKey("raw",a,{name:"AES-CBC"},!1,["decrypt"]),d=await crypto.subtle.decrypt({name:"AES-CBC",iv:s},c,l);return i.decode(d)}(a,i),n=JSON.parse(t),r=n.length.toString().length;return n.map((t,n)=>new Le("",e,(n+1).toString().padStart(r,"0")+".webp",void 0,t.url))}catch(e){throw new Error("cannot decrypt contentKey: "+e.toString()+"\n"+a)}}async fetchOriginMeta(e){return{url:e.originSrc}}async fetchChapters(){const e=document.querySelector(".comicParticulars-left-img > img[data-src]")?.getAttribute("data-src")||void 0,t=window.location.href.match(zt)?.[1];if(!t)throw new Error("cannot match comic id");const n=`https://api.mangacopy.com/api/v3/comic2/${t}?platform=1&_update=true`,i=await window.fetch(n).then(e=>e.json()).catch(e=>new Error(e.toString()));if(i instanceof Error||!i.results.groups)throw new Error("fetch comic detail error: "+i.toString());if(200!==i.code)throw new Error("fetch comic detail error: "+i.message);const a=[],r=i.results.groups;let o=0;for(const n in r){let i=0;for(;;){const s=`https://api.mangacopy.com/api/v3/comic/${t}/group/${r[n].path_word}/chapters?limit=100&offset=${i}&_update=true`,l=await window.fetch(s).then(e=>e.json()).catch(e=>new Error(e.toString()));if(l instanceof Error)throw new Error("fetch chapters error: "+l.toString());if(200!==l.code)throw new Error("fetch chaters error: "+l.message);const c=l.results;i+=c.list.length;for(const i of c.list)a.push(new Pe(o++,"default"===n?i.name:`${r[n].name}-${i.name}`,`${window.location.origin}/comic/${t}/chapter/${i.uuid}`,e));if(i>=c.total)break}}return a}}const zt=/\/comic\/(\w*)/;ve.addSetup({name:"拷贝漫画",workURLs:[/(mangacopy|copymanga).*?\/comic\/[^\/]*\/?$/],match:["https://www.mangacopy.com/*"],constructor:()=>new Bt});const Dt=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class Ft extends Ne{async fetchChapters(){let e=Array.from(document.querySelectorAll("div[data-name='chapter-list'] .flex-col > .px-2 > .space-x-1 > a"));return 0===e.length&&(e=Array.from(document.querySelectorAll("div[data-name='chapter-list'] .flex-col-reverse > .px-2 > .space-x-1 > a")),e=e.reverse()),e.map((e,t)=>new Pe(t,e.textContent??"Chapter"+(t+1),e.href))}async*fetchPagesSource(e){yield Me.ok(e.source)}async parseImgNodes(e){const t=await window.fetch(e).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html")).catch(Error);if(t instanceof Error)throw t;const n=Array.from(t.querySelectorAll("div[data-name='image-item'] > div")),i=n.length.toString().length;return n.map((t,n)=>{const a=t.querySelector("img")?.src;if(!a)throw new Error("cannot find image from chapter: "+e);const r=a.split(".").pop()??"jpg",o=(n+1).toString().padStart(i,"0")+"."+r,[s,l]=[parseInt(t.style.width),parseInt(t.style.height)];return new Le("",e,o,void 0,a,{w:s,h:l})})}async fetchOriginMeta(e){return{url:e.originSrc}}}ve.addSetup({name:"MangaPark",workURLs:[/mangapark.(net|com)\/title\/[^/]+$/],match:["https://mangapark.com/*"],constructor:()=>new Ft});const Vt=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class jt extends Ne{meta;galleryMeta(){if(this.meta)return this.meta;const e=new ce(window.location.href,""),t=document.querySelector("astro-island[component-url^='/_astro/Display_EmotionChart'][props]")?.getAttribute("props");if(t){const n=JSON.parse(t)?.data?.[1];if(n?.name){e.title=n.name[1];try{["artists","authors","genres","altNames"].forEach(t=>{const i=JSON.parse(n[t][1]).map(e=>e[1]);e.tags[t]=i,"altNames"===t&&(e.originTitle=i[i.length-1])})}catch(e){u("error","parse gallery info error",e)}}}return this.meta=e,this.meta}async fetchChapters(){let e=Array.from(document.querySelectorAll("div[name=chapter-list] .scrollable-panel .flex-col-reverse astro-slot > div"));return e=e.reverse(),0===e.length&&(e=Array.from(document.querySelectorAll("div[name=chapter-list] .scrollable-panel .flex-col astro-slot > div"))),e.map((e,t)=>{const n=e.querySelector("div:first-child > a");if(!n)throw new Error("cannot find chapter element");return new Pe(t,n.textContent,n.href)})}async*fetchPagesSource(e){const t=new URL(e.source);t.searchParams.set("load","2");const n=await window.fetch(t).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html")).catch(Error);if(n instanceof Error)throw n;yield Me.ok(n)}async parseImgNodes(e){const t=e.querySelector("astro-island[component-url^='/_astro/ImageList'][props]")?.getAttribute("props");if(!t)throw new Error("cannot find ImageList props");const n=JSON.parse(t);if(!n.imageFiles?.[1])throw new Error("cannot find imageFiles from ImageList props");const i=JSON.parse(n.imageFiles[1]);if(!i.length||0===i.length)throw new Error("cannot find images");const a=i.length.toString().length;return i.map(([e,t],n)=>{const i=(n+1).toString().padStart(a,"0"),r=t.split(".").pop()??"webp";let o;const s=t.match(/\/\d+_(\d+)_(\d+)_\d+\.\w+$/);return s&&3===s.length&&(o={w:parseInt(s[1]),h:parseInt(s[2])}),new Le("",n+1+"",`${i}.${r}`,void 0,t,o)})}async fetchOriginMeta(e){return{url:e.originSrc}}}ve.addSetup({name:"BATO.TO v3x",workURLs:[/(mangatoto.com|bato.to)\/title\/\d+[^\/]*$/],match:["https://mangatoto.com/*","https://bato.to/*"],constructor:()=>new jt});const Ht=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class Gt extends Ne{meta;chapterCount=0;galleryMeta(){if(this.meta)return this.meta;let e=document.querySelector(".book-title > h1")?.textContent??document.title;e+="-c"+this.chapterCount;const t=document.querySelector(".detail-list .status")?.textContent?.match(Zt),n=t?.[1];e+=n?"-"+n:"";const i=t?.[2];return e+=i?"-"+i.trim():"",this.meta=new ce(window.location.href,e),this.meta}async*fetchPagesSource(e){yield Me.ok(e.source)}async parseImgNodes(e){const t=(await window.fetch(e).then(e=>e.text())).match(Xt);if(!t||t.length<5)throw new Error("cannot match image data");let n;try{n=function(e,t,n,i){function a(e){return(e<t?"":a(Math.floor(e/t)).toString())+((e%=t)>35?String.fromCharCode(e+29):e.toString(36))}const r=(o=i,LZString.decompressFromBase64(o)).split("|");var o;const s={};for(;n--;)s[a(n)]=r[n]||a(n);const l=e.replace(new RegExp("\\b\\w+\\b","g"),e=>s[e]);return JSON.parse(l)}(t[1],parseInt(t[2]),parseInt(t[3]),t[4])}catch(e){throw new Error("cannot parse image data: "+e.toString())}const i=function(){const e=parseInt(window.localStorage.getItem("")??"0"),t=parseInt(window.localStorage.getItem("")??"0");return`https://${Wt[e]?.hosts[t]?.h??"us1"}.hamreus.com`}();return n.files.map((e,t)=>{const a=`${i}/${n.path}/${e}?e=${n.sl.e}&m=${n.sl.m}}`,r=`https://www.manhuagui.com/comic/${n.bid}/${n.cid}.html#p=${t+1}`;return new Le("",r,e,void 0,a)})}async fetchOriginMeta(e){return{url:e.originSrc}}async fetchChapters(){const e=document.querySelector(".book-cover img")?.src,t=[];return document.querySelectorAll(".chapter-list").forEach(n=>{let i=function(e,t,n){const i=e=>e.previousElementSibling;let a=e;for(;a=i(a);)if(n(a))return a;return null}(n,0,e=>"h4"===e.tagName.toLowerCase())?.firstElementChild?.textContent??void 0;i=i?i+"-":"",n.querySelectorAll("ul").forEach(n=>{const a=Array.from(n.querySelectorAll("li > a")).reverse().map(t=>new Pe(0,i+t.title,t.href,e));t.push(...a)})}),t.forEach((e,t)=>e.id=t+1),t}}const Wt=[{name:"自动",hosts:[{h:"i",w:.1},{h:"eu",w:5},{h:"eu1",w:5},{h:"us",w:1},{h:"us1",w:1},{h:"us2",w:1},{h:"us3",w:1}]},{name:"电信",hosts:[{h:"eu",w:1},{h:"eu1",w:1}]},{name:"联通",hosts:[{h:"us",w:1},{h:"us1",w:1},{h:"us2",w:1},{h:"us3",w:1}]}],Zt=/\[(\d{4}-\d{2}-\d{2})\].*?\[(.*?)\]/,Xt=/\('\w+\.\w+\((.*?)\).*?,(\d+),(\d+),'(.*?)'\[/;ve.addSetup({name:"漫画柜",workURLs:[/manhuagui.com\/comic\/\d+\/?$/],match:["https://www.manhuagui.com/*"],constructor:()=>new Gt});const Kt=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class Yt extends Ne{map=new Map;currentDirectorMedias=[];async fetchChapters(){const e=Array.from(document.querySelectorAll("table tbody a.file")),t=[];let n=1;for(const i of e){const e=i.href,a=e.split(".").pop()?.toLowerCase();if("zip"===a)t.push(new Pe(n,i.textContent??"unknown-"+n,e)),n++;else if(L(a??"")||T(a??"")){const e=new Le(i.href,i.href,i.textContent??"",void 0,i.href);L(a)?e.mimeType="image/"+a:T(a)&&(e.mimeType="video/"+a),this.currentDirectorMedias.push(e)}}if(this.currentDirectorMedias.length>0&&t.unshift(new Pe(0,"Current Directory","")),0===t.length)throw new Error("can not found zip files or current directory has empty image list");return t}async*fetchPagesSource(e){yield Me.ok(e.source)}async parseImgNodes(e,t){if(!e&&this.currentDirectorMedias.length>0)return this.currentDirectorMedias;const n=await window.fetch(e).then(e=>e.blob()),i=new le.ZipReader(new le.BlobReader(n)),a=await i.getEntries(),r=new Map;return this.map.set(t,r),a.filter(e=>{const t=(e.filename.split(".").pop()??"jpg").toLowerCase();return L(t)||T(t)}).map(e=>{const t=e.getData(new le.BlobWriter);r.set(e.filename,t);const n=(e.filename.split(".").pop()??"jpg").toLowerCase(),i=new Le("",e.filename,e.filename,void 0);return L(n)?i.mimeType="image/"+n:T(n)&&(i.mimeType="video/"+n),i})}async fetchOriginMeta(e,t,n){if(e.originSrc)return{url:e.originSrc};const i=this.map.get(n)?.get(e.href);if(!i)throw new Error("cannot read image from zip");const a=await i;return{url:URL.createObjectURL(a)}}async processData(e,t,n){return[e,n.mimeType]}}ve.addSetup({name:"Mini Serve",workURLs:[/.*:41021/],constructor:()=>new Yt});const Jt=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class Qt extends Ne{meta;galleryMeta(e){return this.meta??super.galleryMeta(e)}initGalleryMeta(){const e=document.querySelector(".grow > div[data-flux-heading]")?.textContent??document.title;this.meta=new ce(window.location.href,e)}async fetchChapters(){this.initGalleryMeta();const e=Array.from(document.querySelectorAll(".mt-8.mb-12 > div[x-data]")),t=[];for(const n of e){let e=n.getAttribute("x-data");e&&(e=e.replace(/,\n\s*toggleSorting\(\) \{.*?\},/gms,""),e=e.replaceAll(/(chapters|decending)/g,'"$1"'));const i=JSON.parse(e??"{}");let a=n.querySelector(".text-lg > div")?.textContent??"";if(a=a?a+"-":"",!i.chapters)continue;const r=i.chapters.map(e=>new Pe(e.id,a+e.title,`https://mycomic.com/cn/chapters/${e.id}`));t.push(...r)}return t}async*fetchPagesSource(e){const t=await window.fetch(e.source).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html"));yield Me.ok(t)}async parseImgNodes(e,t){const n=Array.from(e.querySelectorAll(".\\-mx-6 > img[x-ref]")),i=[],a=n.length.toString().length;for(let e=0;e<n.length;e++){const t=n[e],r=t.getAttribute("src")||t.getAttribute("data-src");if(!r){u("error","cannot find imgage src, ",t);continue}const o=r.split(".").pop(),s=(e+1).toString().padStart(a,"0")+"."+o;i.push(new Le("",r,s,void 0,r,{w:t.width,h:t.height}))}return i}async fetchOriginMeta(e){return{url:e.originSrc}}}ve.addSetup({name:"My Comic",workURLs:[/mycomic.com\/(\w+\/)?comics\/\d+$/],match:["https://mycomic.com/*"],constructor:()=>new Qt});const en=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class tn extends Ne{meta;imageCDNUrls;galleryMeta(){return this.meta}parseInfo(){let e="",t="";Array.from(document.querySelectorAll("body > script")).forEach(n=>{const i=n.textContent;i&&(i.trimStart().startsWith("window._n_app")&&(e=i),i.trimStart().startsWith("window._gallery")&&(t=i))});const n=e.match(/thumb_cdn_urls:\s?\[(.*?)\],/)?.[1]?.split(",").map(e=>e.trim().replaceAll('"',"")),i=e.match(/image_cdn_urls:\s?\[(.*?)\],/)?.[1]?.split(",").map(e=>e.trim().replaceAll('"',""));if(!n||0===n.length)throw new Error("cannot find thumb_cdn_urls from script");if(!i||0===i.length)throw new Error("cannot find image_cdn_urls from script");const a=t.match(/parse\((.*)\);/)?.[1];if(!a)throw new Error("cannot find images info");const r=JSON.parse(JSON.parse(a)),o=new ce(window.location.href,r.title.english);return o.originTitle=r.title.japanese,o.tags=r.tags.reduce((e,t)=>(e[t.type]||(e[t.type]=[]),e[t.type].push(t.name),e),{}),this.meta=o,{info:r,thumbCDNUrls:n,imageCDNUrls:i}}async fetchOriginMeta(e,t){if(t){const t=/https:\/\/(.*?)\//,n=e.originSrc?.match(t)?.[1],i=this.imageCDNUrls?.indexOf(n??"")??-1;if(i>-1)return{url:e.originSrc.replace(t,`https://${this.imageCDNUrls[(i+1)%this.imageCDNUrls.length]}/`)}}return{url:e.originSrc}}async parseImgNodes(e){await w(200);const t=Array.from(e.querySelectorAll(".thumb-container > .gallerythumb"));if(0==t.length)throw new Error("cannot find image nodes");const{info:n,imageCDNUrls:i}=this.parseInfo();this.imageCDNUrls=i;const a=t.length.toString().length,r=[];for(let e=0;e<t.length;e++){const o=t[e],s=o.querySelector("img")?.getAttribute("data-src")??"",l=(e+1).toString().padStart(a,"0"),c=R(n.images.pages[e].t),d=location.origin+o.getAttribute("href"),h=`https://${i[e%i.length]}/galleries/${n.media_id}/${e+1}.${c}`,p={w:n.images.pages[e].w,h:n.images.pages[e].h};r.push(new Le(s,d,l+"."+c,void 0,h,p))}return r}async*fetchPagesSource(){yield Me.ok(document)}}class nn extends Ne{meta;galleryMeta(){return this.meta}parseMeta(){const e=document.querySelector(".info h1")?.textContent,t=document.querySelector(".info h2")?.textContent,n=new ce(window.location.href,e??document.title);n.originTitle=t??void 0,Array.from(document.querySelectorAll(".info > ul > li.tags")).forEach(e=>{let t=e.querySelector("span.text")?.textContent??"misc";t=t.trim().replace(":","");const i=Array.from(e.querySelectorAll("a.tag_btn > .tag_name")).map(e=>e.textContent?.trim()).filter(Boolean);n.tags[t]=i}),this.meta=n}async*fetchPagesSource(){this.parseMeta(),yield Me.ok(document)}async parseImgNodes(e){const t=e;await w(200);const[n,i]=this.parseInfo(t);if(n.length!==i.length)throw new Error("thumbs length not eq images length");const a=t.querySelector(".cover img")?.src;if(!a)throw new Error("cannot find cover src");const r=a.slice(0,a.lastIndexOf("/")+1),o=[],s=n.length.toString().length;let l=window.location.href;l.endsWith("/")&&(l=l.slice(0,-1));for(let e=0;e<n.length;e++){const t=(e+1).toString().padStart(s,"0"),a=i[e],c=r+a[0]+"."+R(a[1]),d=n[e],h=r+d[0]+"."+R(d[1]),p=d[1].split(",");let g;3===p.length&&(g={w:parseInt(p[1].trim()),h:parseInt(p[2].trim())}),o.push(new Le(c,l+"/"+(e+1),t+"."+R(d[1]),void 0,h,g))}return o}parseInfo(e){const t=Array.from(e.querySelectorAll("script[type]")).find(e=>e.textContent?.trimStart().startsWith("var g_th"))?.textContent?.match(/\('(.*)'\);/);if(!t||2!==t.length)throw new Error("cannot find images info from script");const n=JSON.parse(t[1]);return[Object.entries(n.fl),Object.entries(n.th)]}async fetchOriginMeta(e){return{url:e.originSrc}}}ve.addSetup({name:"nhentai",workURLs:[/nhentai.net\/g\/\d+\/?$/],match:["https://nhentai.net/*"],constructor:()=>new tn}),ve.addSetup({name:"nhentai.xxx",workURLs:[/nhentai.xxx\/g\/\d+\/?$/],match:["https://nhentai.xxx/*"],constructor:()=>new nn});const an=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),rn=/niyaniya.moe\/\w+\/(\d+\/\w+)/,on="api.schale.network",sn={0:"misc",1:"artist",2:"circle",7:"uploader",8:"male",9:"female",10:"mixed",11:"language"};class ln extends Ne{meta;galleryMeta(){return this.meta||new ce(window.location.href,"koharu-unknows")}async*fetchPagesSource(e){yield Me.ok(e.source)}createMeta(e){const t=e.tags.reduce((e,t)=>{const n=sn[t.namespace||0]||"misc";return e[n]||(e[n]=[]),e[n].push(t.name),e},{});this.meta=new ce(window.location.href,e.title),this.meta.tags=t}async parseImgNodes(e){const t=e.match(rn),n=window.localStorage.getItem("clearance");if(!n)throw new Error("cannot get clearance from localStorage");if(!t||t.length<2)throw new Error("invaild url: "+e);const i=t[1],a=`https://${on}/books/detail/${i}`,r=`https://${on}/books/detail/${i}?crt=${n}`,[o,s]=await Promise.all([window.fetch(a).then(e=>e.json()).then(e=>e).catch(Error),window.fetch(r,{method:"POST"}).then(e=>e.json()).then(e=>e).catch(Error)]);if(o instanceof Error||s instanceof Error)throw new Error("failed to obtain data, perhaps the API of this site has changed");o.data=s.data,this.createMeta(o);const[l,c]=Object.entries(o.data).sort((e,t)=>t[1].size-e[1].size).find(([e,t])=>void 0!==t.id&&void 0!==t.key)??[void 0,void 0];if(void 0===l&&void 0===c)throw new Error("cannot find resolution from gallery detail");const d=`https://${on}/books/data/${i}/${c.id}/${c.key}/${l}?crt=${n}`,h=await window.fetch(d).then(e=>e.json()).then(e=>e).catch(Error);if(h instanceof Error)throw new Error("failed to obtain data, perhaps the API of this site has changed");if(h.entries.length!==o.thumbnails.entries.length)throw new Error("thumbnails length not match");const p=o.thumbnails.entries,g=o.thumbnails.base,u=h.base,m=h.entries.length.toString().length;return h.entries.map((e,t)=>{const n=`${window.location.origin}/reader/${i}/${t+1}`,a=(t+1).toString().padStart(m,"0")+"."+e.path.split(".").pop(),r=u+e.path;return new Le(g+p[t].path,n,a,void 0,r,{w:e.dimensions[0],h:e.dimensions[1]})})}async fetchOriginMeta(e){return{url:e.originSrc}}headers(){return{Referer:"https://niyaniya.moe/",Origin:window.location.origin}}}ve.addSetup({name:"niyaniya.moe",workURLs:[/(niyaniya.moe|shupogaki.moe|hoshino.one)\/(g|reader)\/\d+\/\w+/],match:["https://niyaniya.moe/*"],constructor:()=>new ln});const cn=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));!function(e){e.LOAD="LOAD",e.EXEC="EXEC",e.FFPROBE="FFPROBE",e.WRITE_FILE="WRITE_FILE",e.READ_FILE="READ_FILE",e.DELETE_FILE="DELETE_FILE",e.RENAME="RENAME",e.CREATE_DIR="CREATE_DIR",e.LIST_DIR="LIST_DIR",e.DELETE_DIR="DELETE_DIR",e.ERROR="ERROR",e.DOWNLOAD="DOWNLOAD",e.PROGRESS="PROGRESS",e.LOG="LOG",e.MOUNT="MOUNT",e.UNMOUNT="UNMOUNT"}(ae||(ae={}));const dn=(()=>{let e=0;return()=>e++})(),hn=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),pn=new Error("called FFmpeg.terminate()"),gn=URL.createObjectURL(new Blob([Uint8Array.from(atob("KGZ1bmN0aW9uICgpIHsKICAgICd1c2Ugc3RyaWN0JzsKCiAgICBjb25zdCBDT1JFX1ZFUlNJT04gPSAiMC4xMi42IjsKICAgIGNvbnN0IENPUkVfVVJMID0gYGh0dHBzOi8vdW5wa2cuY29tL0BmZm1wZWcvY29yZUAke0NPUkVfVkVSU0lPTn0vZGlzdC91bWQvZmZtcGVnLWNvcmUuanNgOwogICAgdmFyIEZGTWVzc2FnZVR5cGU7CiAgICAoZnVuY3Rpb24gKEZGTWVzc2FnZVR5cGUpIHsKICAgICAgICBGRk1lc3NhZ2VUeXBlWyJMT0FEIl0gPSAiTE9BRCI7CiAgICAgICAgRkZNZXNzYWdlVHlwZVsiRVhFQyJdID0gIkVYRUMiOwogICAgICAgIEZGTWVzc2FnZVR5cGVbIldSSVRFX0ZJTEUiXSA9ICJXUklURV9GSUxFIjsKICAgICAgICBGRk1lc3NhZ2VUeXBlWyJSRUFEX0ZJTEUiXSA9ICJSRUFEX0ZJTEUiOwogICAgICAgIEZGTWVzc2FnZVR5cGVbIkRFTEVURV9GSUxFIl0gPSAiREVMRVRFX0ZJTEUiOwogICAgICAgIEZGTWVzc2FnZVR5cGVbIlJFTkFNRSJdID0gIlJFTkFNRSI7CiAgICAgICAgRkZNZXNzYWdlVHlwZVsiQ1JFQVRFX0RJUiJdID0gIkNSRUFURV9ESVIiOwogICAgICAgIEZGTWVzc2FnZVR5cGVbIkxJU1RfRElSIl0gPSAiTElTVF9ESVIiOwogICAgICAgIEZGTWVzc2FnZVR5cGVbIkRFTEVURV9ESVIiXSA9ICJERUxFVEVfRElSIjsKICAgICAgICBGRk1lc3NhZ2VUeXBlWyJFUlJPUiJdID0gIkVSUk9SIjsKICAgICAgICBGRk1lc3NhZ2VUeXBlWyJET1dOTE9BRCJdID0gIkRPV05MT0FEIjsKICAgICAgICBGRk1lc3NhZ2VUeXBlWyJQUk9HUkVTUyJdID0gIlBST0dSRVNTIjsKICAgICAgICBGRk1lc3NhZ2VUeXBlWyJMT0ciXSA9ICJMT0ciOwogICAgICAgIEZGTWVzc2FnZVR5cGVbIk1PVU5UIl0gPSAiTU9VTlQiOwogICAgICAgIEZGTWVzc2FnZVR5cGVbIlVOTU9VTlQiXSA9ICJVTk1PVU5UIjsKICAgIH0pKEZGTWVzc2FnZVR5cGUgfHwgKEZGTWVzc2FnZVR5cGUgPSB7fSkpOwoKICAgIGNvbnN0IEVSUk9SX1VOS05PV05fTUVTU0FHRV9UWVBFID0gbmV3IEVycm9yKCJ1bmtub3duIG1lc3NhZ2UgdHlwZSIpOwogICAgY29uc3QgRVJST1JfTk9UX0xPQURFRCA9IG5ldyBFcnJvcigiZmZtcGVnIGlzIG5vdCBsb2FkZWQsIGNhbGwgYGF3YWl0IGZmbXBlZy5sb2FkKClgIGZpcnN0Iik7CiAgICBjb25zdCBFUlJPUl9JTVBPUlRfRkFJTFVSRSA9IG5ldyBFcnJvcigiZmFpbGVkIHRvIGltcG9ydCBmZm1wZWctY29yZS5qcyIpOwoKICAgIC8vLyA8cmVmZXJlbmNlIG5vLWRlZmF1bHQtbGliPSJ0cnVlIiAvPgogICAgLy8vIDxyZWZlcmVuY2UgbGliPSJlc25leHQiIC8+CiAgICAvLy8gPHJlZmVyZW5jZSBsaWI9IndlYndvcmtlciIgLz4KICAgIGxldCBmZm1wZWc7CiAgICBjb25zdCBsb2FkID0gYXN5bmMgKHsgY29yZVVSTDogX2NvcmVVUkwsIHdhc21VUkw6IF93YXNtVVJMLCB3b3JrZXJVUkw6IF93b3JrZXJVUkwsIH0pID0+IHsKICAgICAgICBjb25zdCBmaXJzdCA9ICFmZm1wZWc7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfY29yZVVSTCkKICAgICAgICAgICAgICAgIF9jb3JlVVJMID0gQ09SRV9VUkw7CiAgICAgICAgICAgIC8vIHdoZW4gd2ViIHdvcmtlciB0eXBlIGlzIGBjbGFzc2ljYC4KICAgICAgICAgICAgaW1wb3J0U2NyaXB0cyhfY29yZVVSTCk7CiAgICAgICAgfQogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgaWYgKCFfY29yZVVSTCkKICAgICAgICAgICAgICAgIF9jb3JlVVJMID0gQ09SRV9VUkwucmVwbGFjZSgnL3VtZC8nLCAnL2VzbS8nKTsKICAgICAgICAgICAgLy8gd2hlbiB3ZWIgd29ya2VyIHR5cGUgaXMgYG1vZHVsZWAuCiAgICAgICAgICAgIHNlbGYuY3JlYXRlRkZtcGVnQ29yZSA9IChhd2FpdCBpbXBvcnQoCiAgICAgICAgICAgIC8qIHdlYnBhY2tJZ25vcmU6IHRydWUgKi8gLyogQHZpdGUtaWdub3JlICovIF9jb3JlVVJMKSkuZGVmYXVsdDsKICAgICAgICAgICAgaWYgKCFzZWxmLmNyZWF0ZUZGbXBlZ0NvcmUpIHsKICAgICAgICAgICAgICAgIHRocm93IEVSUk9SX0lNUE9SVF9GQUlMVVJFOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IGNvcmVVUkwgPSBfY29yZVVSTDsKICAgICAgICBjb25zdCB3YXNtVVJMID0gX3dhc21VUkwgPyBfd2FzbVVSTCA6IF9jb3JlVVJMLnJlcGxhY2UoLy5qcyQvZywgIi53YXNtIik7CiAgICAgICAgY29uc3Qgd29ya2VyVVJMID0gX3dvcmtlclVSTAogICAgICAgICAgICA/IF93b3JrZXJVUkwKICAgICAgICAgICAgOiBfY29yZVVSTC5yZXBsYWNlKC8uanMkL2csICIud29ya2VyLmpzIik7CiAgICAgICAgZmZtcGVnID0gYXdhaXQgc2VsZi5jcmVhdGVGRm1wZWdDb3JlKHsKICAgICAgICAgICAgLy8gRml4IGBPdmVybG9hZCByZXNvbHV0aW9uIGZhaWxlZC5gIHdoZW4gdXNpbmcgbXVsdGktdGhyZWFkZWQgZmZtcGVnLWNvcmUuCiAgICAgICAgICAgIC8vIEVuY29kZWQgd2FzbVVSTCBhbmQgd29ya2VyVVJMIGluIHRoZSBVUkwgYXMgYSBoYWNrIHRvIGZpeCBsb2NhdGVGaWxlIGlzc3VlLgogICAgICAgICAgICBtYWluU2NyaXB0VXJsT3JCbG9iOiBgJHtjb3JlVVJMfSMke2J0b2EoSlNPTi5zdHJpbmdpZnkoeyB3YXNtVVJMLCB3b3JrZXJVUkwgfSkpfWAsCiAgICAgICAgfSk7CiAgICAgICAgZmZtcGVnLnNldExvZ2dlcigoZGF0YSkgPT4gc2VsZi5wb3N0TWVzc2FnZSh7IHR5cGU6IEZGTWVzc2FnZVR5cGUuTE9HLCBkYXRhIH0pKTsKICAgICAgICBmZm1wZWcuc2V0UHJvZ3Jlc3MoKGRhdGEpID0+IHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgICAgICB0eXBlOiBGRk1lc3NhZ2VUeXBlLlBST0dSRVNTLAogICAgICAgICAgICBkYXRhLAogICAgICAgIH0pKTsKICAgICAgICByZXR1cm4gZmlyc3Q7CiAgICB9OwogICAgY29uc3QgZXhlYyA9ICh7IGFyZ3MsIHRpbWVvdXQgPSAtMSB9KSA9PiB7CiAgICAgICAgZmZtcGVnLnNldFRpbWVvdXQodGltZW91dCk7CiAgICAgICAgZmZtcGVnLmV4ZWMoLi4uYXJncyk7CiAgICAgICAgY29uc3QgcmV0ID0gZmZtcGVnLnJldDsKICAgICAgICBmZm1wZWcucmVzZXQoKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgfTsKICAgIGNvbnN0IHdyaXRlRmlsZSA9ICh7IHBhdGgsIGRhdGEgfSkgPT4gewogICAgICAgIGZmbXBlZy5GUy53cml0ZUZpbGUocGF0aCwgZGF0YSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9OwogICAgY29uc3QgcmVhZEZpbGUgPSAoeyBwYXRoLCBlbmNvZGluZyB9KSA9PiBmZm1wZWcuRlMucmVhZEZpbGUocGF0aCwgeyBlbmNvZGluZyB9KTsKICAgIC8vIFRPRE86IGNoZWNrIGlmIGRlbGV0aW9uIHdvcmtzLgogICAgY29uc3QgZGVsZXRlRmlsZSA9ICh7IHBhdGggfSkgPT4gewogICAgICAgIGZmbXBlZy5GUy51bmxpbmsocGF0aCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9OwogICAgY29uc3QgcmVuYW1lID0gKHsgb2xkUGF0aCwgbmV3UGF0aCB9KSA9PiB7CiAgICAgICAgZmZtcGVnLkZTLnJlbmFtZShvbGRQYXRoLCBuZXdQYXRoKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH07CiAgICAvLyBUT0RPOiBjaGVjayBpZiBjcmVhdGlvbiB3b3Jrcy4KICAgIGNvbnN0IGNyZWF0ZURpciA9ICh7IHBhdGggfSkgPT4gewogICAgICAgIGZmbXBlZy5GUy5ta2RpcihwYXRoKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH07CiAgICBjb25zdCBsaXN0RGlyID0gKHsgcGF0aCB9KSA9PiB7CiAgICAgICAgY29uc3QgbmFtZXMgPSBmZm1wZWcuRlMucmVhZGRpcihwYXRoKTsKICAgICAgICBjb25zdCBub2RlcyA9IFtdOwogICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBuYW1lcykgewogICAgICAgICAgICBjb25zdCBzdGF0ID0gZmZtcGVnLkZTLnN0YXQoYCR7cGF0aH0vJHtuYW1lfWApOwogICAgICAgICAgICBjb25zdCBpc0RpciA9IGZmbXBlZy5GUy5pc0RpcihzdGF0Lm1vZGUpOwogICAgICAgICAgICBub2Rlcy5wdXNoKHsgbmFtZSwgaXNEaXIgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBub2RlczsKICAgIH07CiAgICAvLyBUT0RPOiBjaGVjayBpZiBkZWxldGlvbiB3b3Jrcy4KICAgIGNvbnN0IGRlbGV0ZURpciA9ICh7IHBhdGggfSkgPT4gewogICAgICAgIGZmbXBlZy5GUy5ybWRpcihwYXRoKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH07CiAgICBjb25zdCBtb3VudCA9ICh7IGZzVHlwZSwgb3B0aW9ucywgbW91bnRQb2ludCB9KSA9PiB7CiAgICAgICAgY29uc3Qgc3RyID0gZnNUeXBlOwogICAgICAgIGNvbnN0IGZzID0gZmZtcGVnLkZTLmZpbGVzeXN0ZW1zW3N0cl07CiAgICAgICAgaWYgKCFmcykKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGZmbXBlZy5GUy5tb3VudChmcywgb3B0aW9ucywgbW91bnRQb2ludCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9OwogICAgY29uc3QgdW5tb3VudCA9ICh7IG1vdW50UG9pbnQgfSkgPT4gewogICAgICAgIGZmbXBlZy5GUy51bm1vdW50KG1vdW50UG9pbnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfTsKICAgIHNlbGYub25tZXNzYWdlID0gYXN5bmMgKHsgZGF0YTogeyBpZCwgdHlwZSwgZGF0YTogX2RhdGEgfSwgfSkgPT4gewogICAgICAgIGNvbnN0IHRyYW5zID0gW107CiAgICAgICAgbGV0IGRhdGE7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHR5cGUgIT09IEZGTWVzc2FnZVR5cGUuTE9BRCAmJiAhZmZtcGVnKQogICAgICAgICAgICAgICAgdGhyb3cgRVJST1JfTk9UX0xPQURFRDsgLy8gZXNsaW50LWRpc2FibGUtbGluZQogICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgRkZNZXNzYWdlVHlwZS5MT0FEOgogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBhd2FpdCBsb2FkKF9kYXRhKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRkZNZXNzYWdlVHlwZS5FWEVDOgogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBleGVjKF9kYXRhKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRkZNZXNzYWdlVHlwZS5XUklURV9GSUxFOgogICAgICAgICAgICAgICAgICAgIGRhdGEgPSB3cml0ZUZpbGUoX2RhdGEpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBGRk1lc3NhZ2VUeXBlLlJFQURfRklMRToKICAgICAgICAgICAgICAgICAgICBkYXRhID0gcmVhZEZpbGUoX2RhdGEpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBGRk1lc3NhZ2VUeXBlLkRFTEVURV9GSUxFOgogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkZWxldGVGaWxlKF9kYXRhKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRkZNZXNzYWdlVHlwZS5SRU5BTUU6CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHJlbmFtZShfZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEZGTWVzc2FnZVR5cGUuQ1JFQVRFX0RJUjoKICAgICAgICAgICAgICAgICAgICBkYXRhID0gY3JlYXRlRGlyKF9kYXRhKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRkZNZXNzYWdlVHlwZS5MSVNUX0RJUjoKICAgICAgICAgICAgICAgICAgICBkYXRhID0gbGlzdERpcihfZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEZGTWVzc2FnZVR5cGUuREVMRVRFX0RJUjoKICAgICAgICAgICAgICAgICAgICBkYXRhID0gZGVsZXRlRGlyKF9kYXRhKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgRkZNZXNzYWdlVHlwZS5NT1VOVDoKICAgICAgICAgICAgICAgICAgICBkYXRhID0gbW91bnQoX2RhdGEpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBGRk1lc3NhZ2VUeXBlLlVOTU9VTlQ6CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHVubW91bnQoX2RhdGEpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBFUlJPUl9VTktOT1dOX01FU1NBR0VfVFlQRTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgIGlkLAogICAgICAgICAgICAgICAgdHlwZTogRkZNZXNzYWdlVHlwZS5FUlJPUiwKICAgICAgICAgICAgICAgIGRhdGE6IGUudG9TdHJpbmcoKSwKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7CiAgICAgICAgICAgIHRyYW5zLnB1c2goZGF0YS5idWZmZXIpOwogICAgICAgIH0KICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgaWQsIHR5cGUsIGRhdGEgfSwgdHJhbnMpOwogICAgfTsKCn0pKCk7Cg=="),e=>e.charCodeAt(0))],{type:"text/javascript"}));class un{#e=null;#t={};#n={};#i=[];#a=[];loaded=!1;#r=()=>{this.#e&&(this.#e.onmessage=({data:{id:e,type:t,data:n}})=>{switch(t){case ae.LOAD:this.loaded=!0,this.#t[e](n);break;case ae.MOUNT:case ae.UNMOUNT:case ae.EXEC:case ae.FFPROBE:case ae.WRITE_FILE:case ae.READ_FILE:case ae.DELETE_FILE:case ae.RENAME:case ae.CREATE_DIR:case ae.LIST_DIR:case ae.DELETE_DIR:this.#t[e](n);break;case ae.LOG:this.#i.forEach(e=>e(n));break;case ae.PROGRESS:this.#a.forEach(e=>e(n));break;case ae.ERROR:this.#n[e](n)}delete this.#t[e],delete this.#n[e]})};#o=({type:e,data:t},n=[],i)=>this.#e?new Promise((a,r)=>{const o=dn();this.#e&&this.#e.postMessage({id:o,type:e,data:t},n),this.#t[o]=a,this.#n[o]=r,i?.addEventListener("abort",()=>{r(new DOMException(`Message # ${o} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(hn);on(e,t){"log"===e?this.#i.push(t):"progress"===e&&this.#a.push(t)}off(e,t){"log"===e?this.#i=this.#i.filter(e=>e!==t):"progress"===e&&(this.#a=this.#a.filter(e=>e!==t))}load=({classWorkerURL:e,...t}={},{signal:n}={})=>(this.#e||(this.#e=e?new Worker(new URL(e,se&&"SCRIPT"===se.tagName.toUpperCase()&&se.src||new URL("__entry.js",document.baseURI).href),{type:"module"}):new Worker(new URL(gn,se&&"SCRIPT"===se.tagName.toUpperCase()&&se.src||new URL("__entry.js",document.baseURI).href),{type:"module"}),this.#r()),this.#o({type:ae.LOAD,data:t},void 0,n));exec=(e,t=-1,{signal:n}={})=>this.#o({type:ae.EXEC,data:{args:e,timeout:t}},void 0,n);ffprobe=(e,t=-1,{signal:n}={})=>this.#o({type:ae.FFPROBE,data:{args:e,timeout:t}},void 0,n);terminate=()=>{const e=Object.keys(this.#n);for(const t of e)this.#n[t](pn),delete this.#n[t],delete this.#t[t];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(e,t,{signal:n}={})=>{const i=[];return t instanceof Uint8Array&&i.push(t.buffer),this.#o({type:ae.WRITE_FILE,data:{path:e,data:t}},i,n)};mount=(e,t,n)=>this.#o({type:ae.MOUNT,data:{fsType:e,options:t,mountPoint:n}},[]);unmount=e=>this.#o({type:ae.UNMOUNT,data:{mountPoint:e}},[]);readFile=(e,t="binary",{signal:n}={})=>this.#o({type:ae.READ_FILE,data:{path:e,encoding:t}},void 0,n);deleteFile=(e,{signal:t}={})=>this.#o({type:ae.DELETE_FILE,data:{path:e}},void 0,t);rename=(e,t,{signal:n}={})=>this.#o({type:ae.RENAME,data:{oldPath:e,newPath:t}},void 0,n);createDir=(e,{signal:t}={})=>this.#o({type:ae.CREATE_DIR,data:{path:e}},void 0,t);listDir=(e,{signal:t}={})=>this.#o({type:ae.LIST_DIR,data:{path:e}},void 0,t);deleteDir=(e,{signal:t}={})=>this.#o({type:ae.DELETE_DIR,data:{path:e}},void 0,t)}!function(e){e.MEMFS="MEMFS",e.NODEFS="NODEFS",e.NODERAWFS="NODERAWFS",e.IDBFS="IDBFS",e.WORKERFS="WORKERFS",e.PROXYFS="PROXYFS"}(re||(re={}));const mn=new Error("failed to get response body reader"),fn=new Error("failed to complete download"),bn=async(e,t,n=!1,i)=>{const a=n?await(async(e,t)=>{const n=await fetch(e);let i;try{const a=parseInt(n.headers.get("Content-Length")||"-1"),r=n.body?.getReader();if(!r)throw mn;const o=[];let s=0;for(;;){const{done:n,value:i}=await r.read(),l=i?i.length:0;if(n){if(-1!=a&&a!==s)throw fn;t&&t({url:e,total:a,received:s,delta:l,done:n});break}o.push(i),s+=l,t&&t({url:e,total:a,received:s,delta:l,done:n})}const l=new Uint8Array(s);let c=0;for(const e of o)l.set(e,c),c+=e.length;i=l.buffer}catch(e){console.log("failed to send download progress event: ",e),i=await n.arrayBuffer()}return i})(e,i):await(await fetch(e)).arrayBuffer(),r=new Blob([a],{type:t});return URL.createObjectURL(r)};class wn{coreURL;wasmURL;ffmpeg;size=0;maxSize=14e7;taskCount=0;reloadLock=!1;async init(){const e="https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm";return this.coreURL=await bn(`${e}/ffmpeg-core.js`,"text/javascript"),this.wasmURL=await bn(`${e}/ffmpeg-core.wasm`,"application/wasm"),this.ffmpeg=new un,await this.load(),this}async load(){await this.ffmpeg.load({coreURL:this.coreURL,wasmURL:this.wasmURL})}async check(){if(!this.coreURL||!this.wasmURL||!this.ffmpeg)throw new Error("FFmpegConvertor not init");if(this.size>this.maxSize){const e=this.reloadLock;if(await this.waitForTaskZero(),this.reloadLock)await this.waitForReloadLock();else{this.reloadLock=!0;try{u("info","FFmpegConvertor: size limit exceeded, terminate ffmpeg, verLock: ",e),this.ffmpeg.terminate(),await this.load(),this.size=0,this.taskCount=0}finally{this.reloadLock=!1}}}}async writeFiles(e,t){const n=this.ffmpeg;await Promise.all(e.map(async e=>{this.size+=e.data.byteLength,await n.writeFile(t+e.name,e.data)}))}async readOutputFile(e){const t=await this.ffmpeg.readFile(e);return this.size+=t.length,t}async convertTo(e,t,n){await this.check(),this.taskCount++;try{const i=this.ffmpeg,a=Math.random().toString(36).substring(7);let r,o,s;switch(await this.writeFiles(e,a),r=n?n.map(e=>`file '${a}${e.file}'\nduration ${e.delay/1e3}`).join("\n"):e.map(e=>`file '${a}${e.name}'\nduration 0.04`).join("\n"),await i.writeFile(a+"meta.txt",r),t){case"GIF":o=a+"output.gif",s="image/gif",await i.exec(["-f","concat","-safe","0","-i",a+"meta.txt","-vf","split[a][b];[a]palettegen=stats_mode=diff[p];[b][p]paletteuse=dither=bayer:bayer_scale=2",o]);break;case"MP4":o=a+"output.mp4",s="video/mp4",await i.exec(["-f","concat","-safe","0","-i",a+"meta.txt","-c:v","h264","-pix_fmt","yuv420p",o])}const l=await this.readOutputFile(o),c=e.map(e=>i.deleteFile(a+e.name));return n&&c.push(i.deleteFile(a+"meta.txt")),c.push(i.deleteFile(o)),await Promise.all(c),new Blob([l],{type:s})}finally{this.taskCount--}}async waitForTaskZero(){for(;this.taskCount>0;)await new Promise(e=>setTimeout(e,100));await new Promise(e=>setTimeout(e,100*Math.random()+10))}async waitForReloadLock(){for(;this.reloadLock;)await new Promise(e=>setTimeout(e,100));await new Promise(e=>setTimeout(e,100*Math.random()+10))}}class vn{homeData;thumbnails={};pids={};async fetchChapters(){const{error:e,body:t}=await window.fetch("https://www.pixiv.net/ajax/top/illust?mode=all&lang=en").then(e=>e.json());if(e)throw new Error("fetch your home data error, check you have already logged in");this.homeData=t,this.thumbnails=t.thumbnails.illust.reduce((e,t)=>(e[t.id]=t,e),{});const n=[],i=t.page.recommendByTag.reduce((e,t)=>(e[t.tag]=t.ids,e),{});this.pids={follow:t.page.follow.map(e=>e.toString()),"for you":t.page.recommend.ids,...i};let a=0;for(const[e,t]of Object.entries(this.pids))n.push(new Pe(a,"follow"===e?"Your Following":"Recommend "+e,e,this.thumbnails[t[0]??""]?.url)),a++;return n}async*next(e){const t=this.pids[e.source];if(0!==t.length)for(;t.length>0;){const e=t.splice(0,20).reduce((e,t)=>{const n=this.thumbnails[t]?.userId??"unk";return e[n]||(e[n]=[]),e[n].push(t),e},{}),n=Object.entries(e).map(([e,t])=>({id:"unk"===e?void 0:e,pids:t}));yield Me.ok(n)}else yield Me.ok([])}title(){return"home"}}class yn{artist;chapterPids=new Map;title(){return this.artist??"artist-unknown"}constructor(){ve.conf.pixivRecordReading&&ye.subscribe("ifq-do",(e,t)=>window.localStorage.setItem(`cl-${this.artist}-last-read`,t.node.href))}async fetchChapters(){if(this.artist=await this.findArtistID(),!this.artist)throw new Error("Cannot find artist id!");const e=await window.fetch(`https://www.pixiv.net/ajax/user/${this.artist}/profile/all`).then(e=>e.json()).catch(Error);if(e instanceof Error)throw e;if(e.error)throw new Error(`Fetch illust list error: ${e.message}`);let t=[...Object.keys(e.body.illusts),...Object.keys(e.body.manga)];t=t.sort((e,t)=>parseInt(t)-parseInt(e));const n=window.localStorage.getItem(`cl-${this.artist}-latest`);window.localStorage.setItem(`cl-${this.artist}-latest`,t[0]);const i=[],a=n?t.indexOf(n):-1;if(a>0){const e=new Pe(i.length+1,pe.latestArtWorks,""),n=[...t.slice(0,a)];this.chapterPids.set(e.id,n),i.push(e)}const r=window.location.href.match(/artworks\/(\d+)$/)?.[1];if(r){const e=new Pe(i.length+1,pe.currentArtWorks.get(),"");this.chapterPids.set(e.id,[r]),i.push(e)}if(ve.conf.pixivRecordReading){const e=window.localStorage.getItem(`cl-${this.artist}-last-read`)?.match(/artworks\/(\d+)$/)?.[1],n=e?t.indexOf(e):-1;if(n>0&&n<t.length-1){const e=new Pe(i.length+1,ve.conf.pixivAscendWorks?pe.beforeLastReading.get():pe.afterLastReading.get(),""),a=[...t.slice(n)];this.chapterPids.set(e.id,a),i.push(e);const r=new Pe(i.length+1,ve.conf.pixivAscendWorks?pe.afterLastReading.get():pe.beforeLastReading.get(),""),o=[...t.slice(0,n+1)];this.chapterPids.set(r.id,o),i.push(r)}}const o=new Pe(i.length+1,pe.allArtWorks.get(),"");return this.chapterPids.set(o.id,t),i.push(o),i}async*next(e){let t=this.chapterPids.get(e.id);if(!t)throw new Error("cannot get pid list of "+e.title);for(ve.conf.pixivAscendWorks&&(t=t.reverse());t.length>0;){const e=t.splice(0,20);yield Me.ok([{id:this.artist,pids:e}])}}async findArtistID(){let e=window.location.href;const t=/users\/(\d+)/.exec(e)?.[1];if(t)return t;const n=/artworks\/(\d+)/.exec(e)?.[1];if(n){if(e=document.querySelector("a[data-gtm-value][href*='/users/']")?.href||document.querySelector("a.user-details-icon[href*='/users/']")?.href,e){const t=/users\/(\d+)/.exec(e)?.[1];if(t)return t}return await window.fetch(`${window.location.origin}/ajax/illust/${n}?lang=en`).then(e=>e.json()).then(e=>e.body?.userId)}}}const Cn=/\/(\d+)_([a-z]+)\d*\.\w*$/;class xn extends Ne{api;meta;pageCount=0;works={};ugoiraMetas={};convertor;csrfToken;pidDatas=new Map;constructor(){super(),this.meta=new ce(window.location.href,"UNTITLE"),/pixiv.net(\/en\/)?$/.test(window.location.href)?this.api=new vn:this.api=new yn}async processData(e,t,n){const i=this.ugoiraMetas[n.originSrc];if(!i)return[e,t];const a=new le.ZipReader(new le.Uint8ArrayReader(e)),r=performance.now();this.convertor||(this.convertor=await(new wn).init());const o=performance.now(),s=await a.getEntries().then(e=>e.map(e=>e.getData?.(new le.Uint8ArrayWriter).then(t=>({name:e.filename,data:t})))),l=await Promise.all(s).then(e=>e.filter(e=>e&&e.data.length>0).map(e=>e)),c=performance.now();if(l.length!==i.body.frames.length)throw new Error("unpack ugoira file error: file count not equal to meta");const d=await this.convertor.convertTo(l,ve.conf.pixivConvertTo,i.body.frames),h=performance.now();return u("debug",`convert ugoira to ${ve.conf.pixivConvertTo}\ninit convertor cost: ${o-r}ms\nunpack ugoira  cost: ${c-o}ms\nffmpeg convert cost: ${h-c}ms\ntotal cost: ${(h-r)/1e3}s\nsize: ${d.size/1e3} KB, original size: ${e.byteLength/1e3} KB\nbefore contentType: ${t}, after contentType: ${d.type}\n`),d.arrayBuffer().then(e=>[new Uint8Array(e),d.type])}galleryMeta(){return this.meta.title=`pixiv_${this.api.title()}_w${Object.keys(this.works).length}_p${this.pageCount}`||"UNTITLE",this.meta.tags=Object.entries(this.works).reduce((e,t)=>(e[t[0]]=t[1].tags,e),{}),this.meta}async fetchTagsByPids(e,t){try{const n=await window.fetch(`https://www.pixiv.net/ajax/user/${e}/profile/illusts?ids[]=${t.join("&ids[]=")}&work_category=illustManga&is_first_page=0&lang=en`).then(e=>e.json());if(n.error)u("error","WARN: fetch tags by pids error: ",n.message);else{const e={};Object.entries(n.body.works).forEach(([t,n])=>{e[t]={id:n.id,title:n.title,alt:n.alt,illustType:n.illustType,description:n.description,tags:n.tags,pageCount:n.pageCount}}),this.works={...this.works,...e}}}catch(e){u("error","ERROR: fetch tags by pids error: ",e)}}fetchChapters(){return this.csrfToken=document.querySelector("#__NEXT_DATA__")?.textContent?.match(/\\"api\\":\{\\"token\\":\\"(\w+)\\"/)?.[1],this.api.fetchChapters()}fetchPagesSource(e){return this.api.next(e)}async fetchPidAndData(e){const t=e.filter(e=>!this.pidDatas.has(e)),n=await b(t.map(e=>`https://www.pixiv.net/ajax/illust/${e}/pages?lang=en`),5,"json");for(let e=0;e<t.length;e++)this.pidDatas.set(t[e],n[e]);return e.map(e=>[e,this.pidDatas.get(e)])}async parseImgNodes(e){const t=[];if(0===e.length)return t;const n=[];for(const t of e)t.id&&this.fetchTagsByPids(t.id,t.pids),n.push(...t.pids);if(0===n.length)return t;ve.conf.pixivAscendWorks?n.sort((e,t)=>parseInt(e)-parseInt(t)):n.sort((e,t)=>parseInt(t)-parseInt(e));const i=await this.fetchPidAndData(n);for(let e=0;e<i.length;e++){const[n,a]=i[e];if(!a||a instanceof Error||a.error){const e=`pid:[${n}], ${a?.message}`;u("error",e),ye.emit("notify-message","error",e,8e3);continue}const r=new Ee("☺","like this illust",async()=>{this.csrfToken?await fetch("https://www.pixiv.net/ajax/illusts/like",{headers:{"content-type":"application/json; charset=utf-8","x-csrf-token":this.csrfToken},body:'{"illust_id":"'+n+'"}',method:"POST",mode:"cors"}):ye.emit("notify-message","error","cannot find csrf_token from this page")}),o=new Ee("♥","bookmark this illust",async()=>{this.csrfToken?await fetch("https://www.pixiv.net/ajax/illusts/bookmarks/add",{credentials:"include",headers:{"content-type":"application/json; charset=utf-8","x-csrf-token":this.csrfToken},body:'{"illust_id":"'+n+'","restrict":0,"comment":"","tags":[]}',method:"POST",mode:"cors"}):ye.emit("notify-message","error","cannot find csrf_token from this page")});this.pageCount+=a.body.length;const s=a.body.length.toString().length;let l=-1;for(const e of a.body){let i=e.urls.original.split("/").pop()||`${n}_p${l.toString().padStart(s)}.jpg`;const a=e.urls.original.match(Cn);a&&a.length>2&&a[2]&&"ugoira"===a[2]&&(i=i.replace(/\.\w+$/,".gif")),l++;const c=new Le(this.changeImageServer(e.urls.small),`${window.location.origin}/artworks/${n}`,i,void 0,this.changeImageServer(e.urls.original),{w:e.width,h:e.height});c.actions.push(r),c.actions.push(o),t.push(c)}}return t}async fetchOriginMeta(e){const t=e.originSrc.match(Cn);if(!t||t.length<2)return{url:e.originSrc};const n=t[1],i=t[2];if(2===this.works[n]?.illustType||"ugoira"===i){const e=await window.fetch(`https://www.pixiv.net/ajax/illust/${n}/ugoira_meta?lang=en`).then(e=>e.json()),t=this.changeImageServer(e.body.src);return this.ugoiraMetas[t]=e,{url:t}}return{url:e.originSrc}}changeImageServer(e){let t=ve.conf.pixivImageServer;return t?(t.startsWith("http")||(t="https://"+t),t.endsWith("/")||(t+="/"),e.replace(/https?:\/\/[\.\w]*\//,t)):e}}ve.addSetup({name:"Pixiv",workURLs:[/pixiv.net\/(en\/)?(artworks\/.*|users\/.*|$)/],match:["https://www.pixiv.net/*"],constructor:()=>new xn});const In=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class An extends Ne{sprites=[];fetchedThumbnail=[];galleryId="";imgCount=0;galleryMeta(){const e=document.querySelector(".site-manga-info__title-text")?.textContent||"UNTITLE",t=new ce(window.location.href,e);t.originTitle=e;const n=document.querySelectorAll("div.mdc-chip .site-tag-count"),i={};return n.forEach(e=>{const t=e.getAttribute("data-tag")?.trim().split(":");if(void 0===t||0===t.length)return;const n=t[0];void 0===i[n]&&(i[n]=[]),i[n].push(t[1].replaceAll('"',""))}),t.tags=i,t}async fetchOriginMeta(e){return{url:e.originSrc}}async parseImgNodes(e){const t=[],n=this.imgCount.toString().length;for(let i=e[0];i<e[1];i++){let e,a="";this.sprites[i]?e=this.fetchThumbnail(i):a=`https://rokuhentai.com/_images/page-thumbnails/${this.galleryId}/${i}.jpg`;const r=`https://rokuhentai.com/_images/pages/${this.galleryId}/${i}.jpg`;t.push(new Le(a,r,i.toString().padStart(n,"0")+".jpg",e,r))}return t}async*fetchPagesSource(){const e=document,t=parseInt(e.querySelector(".mdc-typography--caption")?.textContent||"");if(isNaN(t))throw new Error("error: failed query image count!");this.imgCount=t,this.galleryId=window.location.href.split("/").pop();const n=Array.from(e.querySelectorAll(".mdc-layout-grid__cell .site-page-card__media"));for(const e of n){this.fetchedThumbnail.push(void 0);const t=parseInt(e.getAttribute("data-offset-x")||""),n=parseInt(e.getAttribute("data-offset-y")||""),i=parseInt(e.getAttribute("data-width")||""),a=parseInt(e.getAttribute("data-height")||"");if(isNaN(t)||isNaN(n)||isNaN(i)||isNaN(a)){this.sprites.push(void 0);continue}const r=e.getAttribute("data-src");this.sprites.push({src:r,pos:{x:t,y:n,width:i,height:a}})}for(let e=0;e<this.imgCount;e+=20)yield Me.ok([e,Math.min(e+20,this.imgCount)])}async fetchThumbnail(e){if(this.fetchedThumbnail[e])return this.fetchedThumbnail[e];const t=this.sprites[e].src,n=[];for(let i=e;i<this.imgCount&&t===this.sprites[i]?.src;i++)n.push(this.sprites[i].pos);const i=await A(t,n);for(let t=e;t<e+i.length;t++)this.fetchedThumbnail[t]=i[t-e];return this.fetchedThumbnail[e]}async processData(e){return[e,"image/jpeg"]}}ve.addSetup({name:"rokuhentai",workURLs:[/rokuhentai.com\/\w+$/],match:["https://rokuhentai.com/*"],constructor:()=>new An});const _n=Object.freeze(Object.defineProperty({__proto__:null,RokuHentaiMatcher:An},Symbol.toStringTag,{value:"Module"})),Sn=/background-image:\surl\(.*?(h.*\/).*?\)/;class kn extends Ne{async fetchOriginMeta(e){let t="";try{if(t=await window.fetch(e.href).then(e=>e.text()),!t)throw new Error("[text] is empty")}catch(e){throw new Error(`Fetch source page error, expected [text]！ ${e}`)}const n=(new DOMParser).parseFromString(t,"text/html"),i=n.querySelector(".actualmediactn > a")?.getAttribute("href");if(!i)throw new Error("Cannot Query Steam original Image URL");return{url:i}}async parseImgNodes(e){const t=[],n=await window.fetch(e).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html"));if(!n)throw new Error("warn: steam matcher failed to get document from source page!");const i=n.querySelectorAll(".profile_media_item");if(!i||0==i.length)throw new Error("warn: failed query image nodes!");for(const e of Array.from(i)){const n=Sn.exec(e.innerHTML)?.[1];if(!n)throw new Error(`Cannot Match Steam Image URL, Content: ${e.innerHTML}`);const i=new Le(n,e.getAttribute("href"),e.getAttribute("data-publishedfileid")+".jpg");t.push(i)}return t}async*fetchPagesSource(){let e=-1;document.querySelectorAll(".pagingPageLink").forEach(t=>{e=Number(t.textContent)});const t=new URL(window.location.href);if(t.searchParams.set("view","grid"),-1===e){const n=await window.fetch(t.href).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html")).catch(()=>null);if(!n)throw new Error("warn: steam matcher failed to get document from source page!");n.querySelectorAll(".pagingPageLink").forEach(t=>e=Number(t.textContent))}if(e>0)for(let n=1;n<=e;n++)t.searchParams.set("p",n.toString()),yield Me.ok(t.href);else yield Me.ok(t.href)}parseGalleryMeta(){const e=new URL(window.location.href).searchParams.get("appid");return new ce(window.location.href,"steam-"+e||"all")}}ve.addSetup({name:"Steam Screenshots",workURLs:[/steamcommunity.com\/id\/[^/]+\/screenshots.*/],match:["https://steamcommunity.com/*"],constructor:()=>new kn});const En=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class Ln{uuid=r();userID;fetchChapters(){return window.location.href.includes("/media")?[new Pe(1,"User Medias",window.location.href,"https://pbs.twimg.com/profile_images/1683899100922511378/5lY42eHs_bigger.jpg")]:[new Pe(0,"User Posts",window.location.href,"https://pbs.twimg.com/profile_images/1683899100922511378/5lY42eHs_bigger.jpg"),new Pe(1,"User Media",window.location.href,"https://pbs.twimg.com/profile_images/1683899100922511378/5lY42eHs_bigger.jpg")]}async next(e,t){if(this.userID||(this.userID=function(){const e=window.location.href.match(/(twitter|x).com\/(\w+)\/?/)?.[2]||"lililjiliijili",t=Array.from(document.querySelectorAll("button[data-testid][aria-label]"));if(0===t.length)return;const n=t.find(t=>(t.getAttribute("aria-label")??"").toLowerCase().includes(`@${e.toLowerCase()}`))||t[0];return n.getAttribute("data-testid").match(/(\d+)/)?.[1]}()),!this.userID)throw new Error("Cannot obatained User ID");let n="";if(0===e.id){const e=`{"userId":"${this.userID}","count":20,${t?'"cursor":"'+t+'",':""}"includePromotedContent":true,"withQuickPromoteEligibilityTweetFields":true,"withVoice":true}`,i="&features=%7B%22rweb_video_screen_enabled%22%3Afalse%2C%22profile_label_improvements_pcf_label_in_post_enabled%22%3Atrue%2C%22rweb_tipjar_consumption_enabled%22%3Atrue%2C%22verified_phone_label_enabled%22%3Afalse%2C%22creator_subscriptions_tweet_preview_api_enabled%22%3Atrue%2C%22responsive_web_graphql_timeline_navigation_enabled%22%3Atrue%2C%22responsive_web_graphql_skip_user_profile_image_extensions_enabled%22%3Afalse%2C%22premium_content_api_read_enabled%22%3Afalse%2C%22communities_web_enable_tweet_community_results_fetch%22%3Atrue%2C%22c9s_tweet_anatomy_moderator_badge_enabled%22%3Atrue%2C%22responsive_web_grok_analyze_button_fetch_trends_enabled%22%3Afalse%2C%22responsive_web_grok_analyze_post_followups_enabled%22%3Atrue%2C%22responsive_web_jetfuel_frame%22%3Afalse%2C%22responsive_web_grok_share_attachment_enabled%22%3Atrue%2C%22articles_preview_enabled%22%3Atrue%2C%22responsive_web_edit_tweet_api_enabled%22%3Atrue%2C%22graphql_is_translatable_rweb_tweet_is_translatable_enabled%22%3Atrue%2C%22view_counts_everywhere_api_enabled%22%3Atrue%2C%22longform_notetweets_consumption_enabled%22%3Atrue%2C%22responsive_web_twitter_article_tweet_consumption_enabled%22%3Atrue%2C%22tweet_awards_web_tipping_enabled%22%3Afalse%2C%22responsive_web_grok_show_grok_translated_post%22%3Afalse%2C%22responsive_web_grok_analysis_button_from_backend%22%3Atrue%2C%22creator_subscriptions_quote_tweet_preview_enabled%22%3Afalse%2C%22freedom_of_speech_not_reach_fetch_enabled%22%3Atrue%2C%22standardized_nudges_misinfo%22%3Atrue%2C%22tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled%22%3Atrue%2C%22longform_notetweets_rich_text_read_enabled%22%3Atrue%2C%22longform_notetweets_inline_media_enabled%22%3Atrue%2C%22responsive_web_grok_image_annotation_enabled%22%3Atrue%2C%22responsive_web_enhance_cards_enabled%22%3Afalse%7D&fieldToggles=%7B%22withArticlePlainText%22%3Afalse%7D";n=`${window.location.origin}/i/api/graphql/q6xj5bs0hapm9309hexA_g/UserTweets?variables=${encodeURIComponent(e)}${i}`}else{const e=`{"userId":"${this.userID}","count":20,${t?'"cursor":"'+t+'",':""}"includePromotedContent":false,"withClientEventToken":false,"withBirdwatchNotes":false,"withVoice":true,"withV2Timeline":true}`,i="&features=%7B%22rweb_tipjar_consumption_enabled%22%3Atrue%2C%22responsive_web_graphql_exclude_directive_enabled%22%3Atrue%2C%22verified_phone_label_enabled%22%3Afalse%2C%22creator_subscriptions_tweet_preview_api_enabled%22%3Atrue%2C%22responsive_web_graphql_timeline_navigation_enabled%22%3Atrue%2C%22responsive_web_graphql_skip_user_profile_image_extensions_enabled%22%3Afalse%2C%22communities_web_enable_tweet_community_results_fetch%22%3Atrue%2C%22c9s_tweet_anatomy_moderator_badge_enabled%22%3Atrue%2C%22articles_preview_enabled%22%3Atrue%2C%22tweetypie_unmention_optimization_enabled%22%3Atrue%2C%22responsive_web_edit_tweet_api_enabled%22%3Atrue%2C%22graphql_is_translatable_rweb_tweet_is_translatable_enabled%22%3Atrue%2C%22view_counts_everywhere_api_enabled%22%3Atrue%2C%22longform_notetweets_consumption_enabled%22%3Atrue%2C%22responsive_web_twitter_article_tweet_consumption_enabled%22%3Atrue%2C%22tweet_awards_web_tipping_enabled%22%3Afalse%2C%22creator_subscriptions_quote_tweet_preview_enabled%22%3Afalse%2C%22freedom_of_speech_not_reach_fetch_enabled%22%3Atrue%2C%22standardized_nudges_misinfo%22%3Atrue%2C%22tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled%22%3Atrue%2C%22tweet_with_visibility_results_prefer_gql_media_interstitial_enabled%22%3Atrue%2C%22rweb_video_timestamps_enabled%22%3Atrue%2C%22longform_notetweets_rich_text_read_enabled%22%3Atrue%2C%22longform_notetweets_inline_media_enabled%22%3Atrue%2C%22responsive_web_enhance_cards_enabled%22%3Afalse%7D&fieldToggles=%7B%22withArticlePlainText%22%3Afalse%7D";n=`${window.location.origin}/i/api/graphql/aQQLnkexAl5z9ec_UgbEIA/UserMedia?variables=${encodeURIComponent(e)}${i}`}try{const t=await window.fetch(n,{headers:M(this.uuid),signal:AbortSignal.timeout(1e4)}),i=await t.json();if(200!==t.status&&i?.errors?.[0].message)throw new Error(i?.errors?.[0].message);if(0===e.id){const e=i.data.user.result.timeline.timeline.instructions.find(e=>"TimelineAddEntries"===e.type);if(!e)throw new Error("Not found TimelineAddEntries");const{items:t,cursor:n}=N(e);return[t,n]}{const e=i.data.user.result.timeline_v2.timeline.instructions,t=[],n=e.find(e=>"TimelineAddToModule"===e.type),a=e.find(e=>"TimelineAddEntries"===e.type);if(!a)throw new Error("Not found TimelineAddEntries");if(n&&n.moduleItems.forEach(e=>t.push(e.item)),0===t.length){const e=a.entries.find(e=>"TimelineTimelineModule"===e.content.entryType)?.content;e?.items.forEach(e=>t.push(e.item))}const r=a.entries.find(e=>"TimelineTimelineCursor"===e.content.entryType&&e.entryId.startsWith("cursor-bottom"))?.content?.value;return[t,r]}}catch(e){throw new Error(`twitter api query error: ${e}`)}}}class Tn{uuid=r();listID;fetchChapters(){return[new Pe(1,"User Medias",window.location.href)]}getListID(){return window.location.href.match(/i\/lists\/(\d+)$/)?.[1]}async next(e,t){if(this.listID||(this.listID=this.getListID()),!this.listID)throw new Error("Cannot obatained list ID");const n=`{"listId":"${this.listID}","count":20${t?',"cursor":"'+t+'"':""}}`,i=`${window.location.origin}/i/api/graphql/LSefrrxhpeX8HITbKfWz9g/ListLatestTweetsTimeline?variables=${encodeURIComponent(n)}&features=%7B%22rweb_video_screen_enabled%22%3Afalse%2C%22profile_label_improvements_pcf_label_in_post_enabled%22%3Atrue%2C%22rweb_tipjar_consumption_enabled%22%3Atrue%2C%22responsive_web_graphql_exclude_directive_enabled%22%3Atrue%2C%22verified_phone_label_enabled%22%3Afalse%2C%22creator_subscriptions_tweet_preview_api_enabled%22%3Atrue%2C%22responsive_web_graphql_timeline_navigation_enabled%22%3Atrue%2C%22responsive_web_graphql_skip_user_profile_image_extensions_enabled%22%3Afalse%2C%22premium_content_api_read_enabled%22%3Afalse%2C%22communities_web_enable_tweet_community_results_fetch%22%3Atrue%2C%22c9s_tweet_anatomy_moderator_badge_enabled%22%3Atrue%2C%22responsive_web_grok_analyze_button_fetch_trends_enabled%22%3Afalse%2C%22responsive_web_grok_analyze_post_followups_enabled%22%3Atrue%2C%22responsive_web_jetfuel_frame%22%3Afalse%2C%22responsive_web_grok_share_attachment_enabled%22%3Atrue%2C%22articles_preview_enabled%22%3Atrue%2C%22responsive_web_edit_tweet_api_enabled%22%3Atrue%2C%22graphql_is_translatable_rweb_tweet_is_translatable_enabled%22%3Atrue%2C%22view_counts_everywhere_api_enabled%22%3Atrue%2C%22longform_notetweets_consumption_enabled%22%3Atrue%2C%22responsive_web_twitter_article_tweet_consumption_enabled%22%3Atrue%2C%22tweet_awards_web_tipping_enabled%22%3Afalse%2C%22responsive_web_grok_show_grok_translated_post%22%3Afalse%2C%22responsive_web_grok_analysis_button_from_backend%22%3Atrue%2C%22creator_subscriptions_quote_tweet_preview_enabled%22%3Afalse%2C%22freedom_of_speech_not_reach_fetch_enabled%22%3Atrue%2C%22standardized_nudges_misinfo%22%3Atrue%2C%22tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled%22%3Atrue%2C%22longform_notetweets_rich_text_read_enabled%22%3Atrue%2C%22longform_notetweets_inline_media_enabled%22%3Atrue%2C%22responsive_web_grok_image_annotation_enabled%22%3Atrue%2C%22responsive_web_enhance_cards_enabled%22%3Afalse%7D`;try{const e=await window.fetch(i,{headers:M(this.uuid),signal:AbortSignal.timeout(1e4)}),t=await e.json();if(200!==e.status&&t?.errors?.[0].message)throw new Error(t?.errors?.[0].message);const n=t.data.list.tweets_timeline.timeline.instructions.find(e=>"TimelineAddEntries"===e.type);if(!n)throw new Error("Not found TimelineAddEntries");const{items:a,cursor:r}=N(n);return[a,r]}catch(e){throw new Error(`twitter api query error: ${e}`)}}}class Pn{uuid=r();seenTweetIds={1:[],2:[],3:[]};chapterCursors={1:void 0,2:void 0,3:void 0};myID;fetchChapters(){return[new Pe(1,"For you",window.location.href,"https://pbs.twimg.com/profile_images/1683899100922511378/5lY42eHs_bigger.jpg"),new Pe(2,"Following",window.location.href,"https://pbs.twimg.com/profile_images/1683899100922511378/5lY42eHs_bigger.jpg"),new Pe(3,"Your Likes",window.location.href,"https://pbs.twimg.com/profile_images/1683899100922511378/5lY42eHs_bigger.jpg")]}async next(e){const t=this.chapterCursors[e.id],n=this.seenTweetIds[e.id].map(e=>'"'+e+'"').join(","),i=M(this.uuid),[a,r]=(()=>{if(1===e.id)return[`${window.location.origin}/i/api/graphql/ci_OQZ2k0rG0Ax_lXRiWVA/HomeTimeline`,`{"variables":{"count":20,${t?`"cursor":"${t}",`:""}"includePromotedContent":true,"latestControlAvailable":true,"requestContext":"launch","withCommunity":true,"seenTweetIds":[${n}]},"features":{"rweb_video_screen_enabled":false,"profile_label_improvements_pcf_label_in_post_enabled":true,"rweb_tipjar_consumption_enabled":true,"responsive_web_graphql_exclude_directive_enabled":true,"verified_phone_label_enabled":false,"creator_subscriptions_tweet_preview_api_enabled":true,"responsive_web_graphql_timeline_navigation_enabled":true,"responsive_web_graphql_skip_user_profile_image_extensions_enabled":false,"premium_content_api_read_enabled":false,"communities_web_enable_tweet_community_results_fetch":true,"c9s_tweet_anatomy_moderator_badge_enabled":true,"responsive_web_grok_analyze_button_fetch_trends_enabled":false,"responsive_web_grok_analyze_post_followups_enabled":true,"responsive_web_jetfuel_frame":false,"responsive_web_grok_share_attachment_enabled":true,"articles_preview_enabled":true,"responsive_web_edit_tweet_api_enabled":true,"graphql_is_translatable_rweb_tweet_is_translatable_enabled":true,"view_counts_everywhere_api_enabled":true,"longform_notetweets_consumption_enabled":true,"responsive_web_twitter_article_tweet_consumption_enabled":true,"tweet_awards_web_tipping_enabled":false,"responsive_web_grok_show_grok_translated_post":false,"responsive_web_grok_analysis_button_from_backend":true,"creator_subscriptions_quote_tweet_preview_enabled":false,"freedom_of_speech_not_reach_fetch_enabled":true,"standardized_nudges_misinfo":true,"tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled":true,"longform_notetweets_rich_text_read_enabled":true,"longform_notetweets_inline_media_enabled":true,"responsive_web_grok_image_annotation_enabled":true,"responsive_web_enhance_cards_enabled":false},"queryId":"ci_OQZ2k0rG0Ax_lXRiWVA"}`];if(2===e.id)return[`${window.location.origin}/i/api/graphql/nMyTQqsJiUGBKLGNSQamAA/HomeLatestTimeline`,`{"variables":{"count":20,${t?`"cursor":"${t}",`:""}"includePromotedContent":true,"latestControlAvailable":true,"seenTweetIds":[${n}]},"features":{"rweb_video_screen_enabled":false,"profile_label_improvements_pcf_label_in_post_enabled":true,"rweb_tipjar_consumption_enabled":true,"responsive_web_graphql_exclude_directive_enabled":true,"verified_phone_label_enabled":false,"creator_subscriptions_tweet_preview_api_enabled":true,"responsive_web_graphql_timeline_navigation_enabled":true,"responsive_web_graphql_skip_user_profile_image_extensions_enabled":false,"premium_content_api_read_enabled":false,"communities_web_enable_tweet_community_results_fetch":true,"c9s_tweet_anatomy_moderator_badge_enabled":true,"responsive_web_grok_analyze_button_fetch_trends_enabled":false,"responsive_web_grok_analyze_post_followups_enabled":true,"responsive_web_jetfuel_frame":false,"responsive_web_grok_share_attachment_enabled":true,"articles_preview_enabled":true,"responsive_web_edit_tweet_api_enabled":true,"graphql_is_translatable_rweb_tweet_is_translatable_enabled":true,"view_counts_everywhere_api_enabled":true,"longform_notetweets_consumption_enabled":true,"responsive_web_twitter_article_tweet_consumption_enabled":true,"tweet_awards_web_tipping_enabled":false,"responsive_web_grok_show_grok_translated_post":false,"responsive_web_grok_analysis_button_from_backend":true,"creator_subscriptions_quote_tweet_preview_enabled":false,"freedom_of_speech_not_reach_fetch_enabled":true,"standardized_nudges_misinfo":true,"tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled":true,"longform_notetweets_rich_text_read_enabled":true,"longform_notetweets_inline_media_enabled":true,"responsive_web_grok_image_annotation_enabled":true,"responsive_web_enhance_cards_enabled":false},"queryId":"nMyTQqsJiUGBKLGNSQamAA"}`];{if(this.myID||(this.myID=Array.from(document.querySelectorAll("script")).find(e=>e.innerText.startsWith("window.__INITIAL_STATE__"))?.innerText.match(/"id_str":\s?"(\d+)"/)?.[1]),!this.myID)throw new Error("cannot find my id from current page");const e=t?`"cursor":"${t}",`:"",n=`{"userId":"${this.myID}","count":20,${e}"includePromotedContent":false,"withClientEventToken":false,"withBirdwatchNotes":false,"withVoice":true}`,i="&features=%7B%22rweb_video_screen_enabled%22%3Afalse%2C%22profile_label_improvements_pcf_label_in_post_enabled%22%3Atrue%2C%22rweb_tipjar_consumption_enabled%22%3Atrue%2C%22responsive_web_graphql_exclude_directive_enabled%22%3Atrue%2C%22verified_phone_label_enabled%22%3Afalse%2C%22creator_subscriptions_tweet_preview_api_enabled%22%3Atrue%2C%22responsive_web_graphql_timeline_navigation_enabled%22%3Atrue%2C%22responsive_web_graphql_skip_user_profile_image_extensions_enabled%22%3Afalse%2C%22premium_content_api_read_enabled%22%3Afalse%2C%22communities_web_enable_tweet_community_results_fetch%22%3Atrue%2C%22c9s_tweet_anatomy_moderator_badge_enabled%22%3Atrue%2C%22responsive_web_grok_analyze_button_fetch_trends_enabled%22%3Afalse%2C%22responsive_web_grok_analyze_post_followups_enabled%22%3Atrue%2C%22responsive_web_jetfuel_frame%22%3Afalse%2C%22responsive_web_grok_share_attachment_enabled%22%3Atrue%2C%22articles_preview_enabled%22%3Atrue%2C%22responsive_web_edit_tweet_api_enabled%22%3Atrue%2C%22graphql_is_translatable_rweb_tweet_is_translatable_enabled%22%3Atrue%2C%22view_counts_everywhere_api_enabled%22%3Atrue%2C%22longform_notetweets_consumption_enabled%22%3Atrue%2C%22responsive_web_twitter_article_tweet_consumption_enabled%22%3Atrue%2C%22tweet_awards_web_tipping_enabled%22%3Afalse%2C%22responsive_web_grok_show_grok_translated_post%22%3Afalse%2C%22responsive_web_grok_analysis_button_from_backend%22%3Atrue%2C%22creator_subscriptions_quote_tweet_preview_enabled%22%3Afalse%2C%22freedom_of_speech_not_reach_fetch_enabled%22%3Atrue%2C%22standardized_nudges_misinfo%22%3Atrue%2C%22tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled%22%3Atrue%2C%22longform_notetweets_rich_text_read_enabled%22%3Atrue%2C%22longform_notetweets_inline_media_enabled%22%3Atrue%2C%22responsive_web_grok_image_annotation_enabled%22%3Atrue%2C%22responsive_web_enhance_cards_enabled%22%3Afalse%7D&fieldToggles=%7B%22withArticlePlainText%22%3Afalse%7D";return[`${window.location.origin}/i/api/graphql/uxjTlmrTI61zreSIV1urbw/Likes?variables=${encodeURIComponent(n)}${i}`,""]}})();try{const t={};i.forEach((e,n)=>{t[n]=e});const n=await new Promise((e,n)=>{ne({method:r?"POST":"GET",url:a,headers:t,data:r||void 0,timeout:2e4,onload:t=>e(t.response),ontimeout:()=>n("timeout"),onerror:e=>n(e)})}),o=JSON.parse(n);if(o?.errors?.[0].message)throw new Error(o?.errors?.[0].message);const s=(()=>{if(3===e.id){if(o?.data?.user?.result?.timeline_v2?.timeline?.instructions)return o.data.user.result.timeline_v2.timeline.instructions;if(o?.data?.user?.result?.timeline?.timeline?.instructions)return o.data.user.result.timeline.timeline.instructions;throw new Error("cannot found: json?.data?.user?.result?.timeline_v2?.timeline?.instructions")}if(!o?.data?.home?.home_timeline_urt?.instructions)throw new Error("cannot found: json?.data?.home?.home_timeline_urt?.instructions");return o.data.home.home_timeline_urt.instructions})().find(e=>"TimelineAddEntries"===e.type);if(!s)throw new Error("Not found TimelineAddEntries");const{items:l,ids:c,cursor:d}=N(s);return this.seenTweetIds[e.id]=c,this.chapterCursors[e.id]=d,[l,d]}catch(e){throw new Error(`twitter api query error: ${e}`)}}}class Rn extends Ne{postCount=0;mediaCount=0;api;uuid=r();constructor(){super(),/\/home$/.test(window.location.href)?this.api=new Pn:/i\/lists\/\d+$/.test(window.location.href)?this.api=new Tn:this.api=new Ln}async fetchChapters(){return this.api.fetchChapters()}async*fetchPagesSource(e){let t;for(;;)try{const[n,i]=await this.api.next(e,t);if(t=i||"last",!n||0===n.length)break;if(yield Me.ok(n),!i)break}catch(e){yield Me.err(e)}}async parseImgNodes(e){if(!e)throw new Error("warn: cannot find items");const t=[];for(const n of e){const e=n?.itemContent?.tweet_results?.result?.legacy||n?.itemContent?.tweet_results?.result?.tweet?.legacy||n?.itemContent?.tweet_results?.result?.legacy?.retweeted_status_result?.result?.legacy,i=e?.entities.media;if(void 0===i){const e=n.itemContent?.tweet_results?.result?.core?.user_results?.result?.legacy?.name,t=n.itemContent.tweet_results.result.rest_id;u("error",`cannot found mediaList: ${window.location.origin}/${e}/status/${t}`,n);continue}const a=e?.id_str,r=new Ee("♥","like this tweet",async()=>{await fetch("https://x.com/i/api/graphql/lI07N6Otwv1PhnEgXILM7A/FavoriteTweet",{headers:M(this.uuid),body:'{"variables":{"tweet_id":"'+a+'"},"queryId":"lI07N6Otwv1PhnEgXILM7A"}',method:"POST",mode:"cors"})}),o=new Ee("🔖","bookmark this tweet",async()=>{await fetch("https://x.com/i/api/graphql/aoDbu3RHznuiSkQ9aNM67Q/CreateBookmark",{headers:M(this.uuid),body:'{"variables":{"tweet_id":"'+a+'"},"queryId":"aoDbu3RHznuiSkQ9aNM67Q"}',method:"POST",mode:"cors"})});this.postCount++,ve.conf.reverseMultipleImagesPost&&i.reverse();for(let e=0;e<i.length;e++){const n=i[e];if(ve.conf.excludeVideo&&"video"===n.type)continue;if("video"!==n.type&&"photo"!==n.type&&"animated_gif"!==n.type){u("error",`Not supported media type: ${n.type}`);continue}const a=n.media_url_https.split(".").pop(),s=n.media_url_https.replace(`.${a}`,""),l=`${s}?format=${a}&name=${n.sizes.small?"small":"thumb"}`;let c=n.expanded_url.replace(/\/(photo|video)\/\d+/,"");c=`${c}/${"video"===n.type?"video":"photo"}/${e+1}`;const d=`${s}?format=${a}&name=${n.sizes.large?"large":n.sizes.medium?"medium":"small"}`,h=`${n.id_str}-${s.split("/").pop()}.${a}`,p={w:n.sizes.small.w,h:n.sizes.small.h},g=new Le(l,c,h,void 0,d,p);if(g.actions.push(r),g.actions.push(o),n.video_info){let e=0;for(const t of n.video_info.variants)void 0!==t.bitrate&&t.bitrate>=e&&(e=t.bitrate,g.originSrc=t.url,g.mimeType=t.content_type,g.title=g.title.replace(/\.\w+$/,`.${t.content_type.split("/")[1]}`))}t.push(g),this.mediaCount++}}return t}async fetchOriginMeta(e){return{url:e.originSrc}}galleryMeta(){const e=window.location.href.match(/(twitter|x).com\/(\w+)\/?/)?.[2];return new ce(window.location.href,`twitter-${e||document.title}-${this.postCount}-${this.mediaCount}`)}}ve.addSetup({name:"Twitter | X",workURLs:[/(\/x|twitter).com\/(?!(explore|notifications|messages|jobs|lists)$|i\/(?!list)|search\?)\w+/],match:["https://x.com/*"],constructor:()=>new Rn});const Mn=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class Nn extends Ne{meta;baseURL;galleryURL;async*fetchPagesSource(){const e=this.extractIDFromHref(window.location.href);if(!e)throw new Error("Cannot find gallery ID");this.baseURL=`${window.location.origin}/photos-index-page-1-aid-${e}.html`,this.galleryURL=`${window.location.origin}/photos-gallery-aid-${e}.html`;let t=await window.fetch(this.baseURL).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html"));this.meta=this.pasrseGalleryMeta(t);let n=await this.requestGalleryImages(this.galleryURL);yield Me.ok(n)}async parseImgNodes(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n];let a=new Le("",i.url,i.caption,void 0,i.url);t.push(a)}return t}async fetchOriginMeta(e){const t=e.originSrc??e.thumbnailSrc,n=t.includes(".")?t.split(".").pop():"jpg";return{url:t,title:e.title.replace("[","").replace("]","")+"."+n}}galleryMeta(e){return this.meta||super.galleryMeta(e)}extractIDFromHref(e){const t=e.match(/-(\d+).html$/);if(t)return t[1]}pasrseGalleryMeta(e){const t=e.querySelector("#bodywrap > h2")?.textContent||"unknown",n=new ce(this.baseURL||window.location.href,t),i=Array.from(e.querySelectorAll(".asTB .tagshow")).map(e=>e.textContent).filter(Boolean),a=Array.from(e.querySelector(".asTB > .asTBcell.uwconn > p")?.childNodes||[]).map(e=>e.textContent).filter(Boolean);return n.tags={tags:i,description:a},n}async requestGalleryImages(e){const t=await window.fetch(e).then(e=>e.text());let n="";for(let e of t.split("\n"))e=e.replace('document.writeln("',""),e=e.replace('");',""),e.includes("var imglist")&&(e=e.replace("var imglist = ",""),e=e.replaceAll("fast_img_host+\\",""),e=e.replaceAll("\\",""),n+=e);return this.extractUrlsAndCaptions(n)}extractUrlsAndCaptions(e){const t=/url:\s*"(.*?)",\s*caption:\s*"(.*?)"/gs;let n;const i=[];for(;null!==(n=t.exec(e));)i.push({url:n[1],caption:n[2]});return i.length>0&&i[i.length-1].caption.includes("加入收藏")&&i.pop(),i}}ve.addSetup({name:"绅士漫画",workURLs:[/(wnacg.com|wn\d{2}.cc)\/photos-index/],match:["https://www.wnacg.com/*"],constructor:()=>new Nn});const $n=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class On extends Ne{meta;title(){return this.meta?.title??document.title}galleryMeta(){return this.meta}async*fetchPagesSource(){const e=await this.query(window.location.href+"/read",'{"page":1}');if(!e.props?.pages?.data?.list)throw new Error("cannot fetch pages");{const t=e.props?.pages?.data;yield Me.ok(t)}}async parseImgNodes(e){const t=this.buildList(e);if(0===t.length)throw new Error("cannot build list from gallery data");const n=Math.ceil(e.count/20),i=await this.query(window.location.href,`{"page":${n}}`),a=i.props?.post?.data?.page_list;if(!a)throw new Error("cannot fetch thumbnails");const r=i.props?.post?.data;r&&(this.meta=this.buildGalleryMeta(r));const o=[];for(let e=0;e<t.length;e++){const n=t[e],i=a[e];o.push(new Le(i,n.url,`${n.name}.${n.ext}`,void 0,n.url))}return o}async fetchOriginMeta(e){return{url:e.originSrc}}buildGalleryMeta(e){const t=new ce(e.url,e.name);return t.originTitle=e.alt_name,t.tags={flag:[e.flag],category:[e.category],date:[e.date],...e.tags},t}buildList(e){const t=e.list,n=[];for(let i=0;i<e.count;i++){const e=parseInt(t.head[i])-1,a=t.head[i].padStart(4,"0"),r="".concat(t.root,"/").concat(t.code.toString(),"/").concat(a,"-").concat(t.hash[i],"-").concat(t.rand[i],".").concat(t.type[i]);n[e]={url:r,name:a,ext:t.type[i]}}return n}async query(e,t){const n=document.cookie.match(/XSRF-TOKEN=(.*)?;?/)?.[1];if(!n)throw new Error("cannot get csrf token form cookie");const i=await window.fetch(e,{headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-Inertia":"true","X-Inertia-Version":o(),"X-XSRF-TOKEN":decodeURIComponent(n)},body:t,method:"POST"});return await i.json()}}ve.addSetup({name:"Yabai.si",workURLs:[/yabai.si\/g\/\w+\/?$/],match:["https://yabai.si/*"],constructor:()=>new On});const qn=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Un=/Post\.register\((.*)\)/g;class Bn extends Ne{infos={};count=0;async*fetchPagesSource(){let e=document;yield Me.ok(e);let t=0;for(;;){const n=e.querySelector("#paginator a.next_page")?.href;if(!n)break;try{e=await window.fetch(n).then(e=>e.text()).then(e=>(new DOMParser).parseFromString(e,"text/html"))}catch(e){if(t++,t>3)throw new Error(`fetch next page failed, ${e}`);continue}t=0,yield Me.ok(e)}}async parseImgNodes(e){const t=e.querySelector("body > form + script")?.textContent;if(!t)throw new Error("cannot find post list from script");const n=t.matchAll(Un),i=[];for(const e of n)if(e&&!(e.length<2))try{const t=JSON.parse(e[1]);this.infos[t.id.toString()]=t,this.count++,i.push(new Le(t.preview_url,`${window.location.origin}/post/show/${t.id}`,`${t.id}.${t.file_ext}`,void 0,void 0,{w:t.width,h:t.height}))}catch(e){u("error","parse post info failed",e);continue}return i}async fetchOriginMeta(e){const t=e.href.split("/").pop();if(!t)throw new Error(`cannot find id from ${e.href}`);let n;if(n=ve.conf.fetchOriginal?this.infos[t]?.file_url:this.infos[t]?.sample_url,!n)throw new Error(`cannot find url for id ${t}`);return{url:n}}galleryMeta(){const e=new URL(window.location.href),t=e.searchParams.get("tags")?.trim(),n=new ce(window.location.href,`yande_${t||"post"}_${this.count}`);return n.infos=this.infos,n}}ve.addSetup({name:"yande.re",workURLs:[/yande.re\/post(?!\/show\/.*)/],match:["https://yande.re/*"],constructor:()=>new Bn});const zn=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class Dn{crc=-1;table=this.makeTable();makeTable(){let e,t,n;const i=[];for(e=0;e<256;e++){for(n=e,t=0;t<8;t++)n=1&n?n>>>1^3988292384:n>>>1;i[e]=n}return i}append(e){let t=0|this.crc;const n=this.table;for(let i=0,a=0|e.length;i<a;i++)t=t>>>8^n[255&(t^e[i])];this.crc=t}get(){return~this.crc}}class Fn{level;nameBuf;comment;header;offset;directory;file;crc;compressedLength;uncompressedLength;volumeNo;constructor(e,t){this.level=0;const n=new TextEncoder;this.nameBuf=n.encode(e.name.trim()),this.comment=n.encode(""),this.header=new Vn(26),this.offset=0,this.directory=!1,this.file=e,this.crc=new Dn,this.compressedLength=0,this.uncompressedLength=0,this.volumeNo=t}}class Vn{array;view;constructor(e){const t=new Uint8Array(e);this.array=t,this.view=new DataView(t.buffer)}}class jn{volumeSize=1610612736;accumulatedSize=0;volumes=1;currVolumeNo=-1;files=[];currIndex=-1;offset=0;offsetInVolume=0;curr;date;writer;close=!1;constructor(e){e?.volumeSize&&(this.volumeSize=e.volumeSize),this.date=new Date(Date.now()),this.writer=async()=>{}}setWriter(e){this.writer=e}add(e){const t=e.size();this.accumulatedSize+=t,this.accumulatedSize>this.volumeSize&&(this.volumes++,this.accumulatedSize=t),this.files.push(new Fn(e,this.volumes-1))}async next(){if(this.currIndex++,this.curr=this.files[this.currIndex],this.curr){if(this.curr.volumeNo>this.currVolumeNo)return this.currIndex--,this.offsetInVolume=0,!0;this.curr.offset=this.offsetInVolume,await this.writeHeader(),await this.writeContent(),await this.writeFooter(),this.offset+=this.offsetInVolume-this.curr.offset}else{if(this.close)return!0;this.close=!0,await this.closeZip()}return!1}async writeHeader(){if(!this.curr)return;const e=this.curr,t=new Vn(30+e.nameBuf.length),n=e.header;0===e.level||e.directory||n.view.setUint16(4,2048),n.view.setUint32(0,335546376),n.view.setUint16(6,(this.date.getHours()<<6|this.date.getMinutes())<<5|this.date.getSeconds()/2,!0),n.view.setUint16(8,(this.date.getFullYear()-1980<<4|this.date.getMonth()+1)<<5|this.date.getDate(),!0),n.view.setUint16(22,e.nameBuf.length,!0),t.view.setUint32(0,1347093252),t.array.set(n.array,4),t.array.set(e.nameBuf,30),this.offsetInVolume+=t.array.length,await this.writer(t.array)}async writeContent(){const e=this.curr,t=(await e.file.stream()).getReader(),n=this.writer;await async function i(){const a=await t.read();if(a.done)return;const r=a.value;return e.crc.append(r),e.uncompressedLength+=r.length,e.compressedLength+=r.length,n(r),await i()}()}async writeFooter(){if(!this.curr)return;const e=this.curr,t=new Vn(16);t.view.setUint32(0,1347094280),e.crc&&(e.header.view.setUint32(10,e.crc.get(),!0),e.header.view.setUint32(14,e.compressedLength,!0),e.header.view.setUint32(18,e.uncompressedLength,!0),t.view.setUint32(4,e.crc.get(),!0),t.view.setUint32(8,e.compressedLength,!0),t.view.setUint32(12,e.uncompressedLength,!0)),await this.writer(t.array),this.offsetInVolume+=e.compressedLength+16,e.compressedLength!==e.file.size()&&u("error","WRAN: read length:",e.compressedLength," origin size:",e.file.size(),", title: ",e.file.name)}async closeZip(){const e=this.files.length;let t=0,n=0;for(n=0;n<e;n++){const e=this.files[n];t+=46+e.nameBuf.length+e.comment.length}const i=new Vn(t+22);let a=0;for(n=0;n<e;n++){const e=this.files[n];i.view.setUint32(a,1347092738),i.view.setUint16(a+4,5120),i.array.set(e.header.array,a+6),i.view.setUint16(a+32,e.comment.length,!0),i.view.setUint16(a+34,e.volumeNo,!0),i.view.setUint32(a+42,e.offset,!0),i.array.set(e.nameBuf,a+46),i.array.set(e.comment,a+46+e.nameBuf.length),a+=46+e.nameBuf.length+e.comment.length}i.view.setUint32(a,1347093766),i.view.setUint16(a+4,this.currVolumeNo,!0),i.view.setUint16(a+6,this.currVolumeNo,!0),i.view.setUint16(a+8,e,!0),i.view.setUint16(a+10,e,!0),i.view.setUint32(a+12,t,!0),i.view.setUint32(a+16,this.offsetInVolume,!0),await this.writer(i.array)}nextReadableStream(){if(this.currVolumeNo++,this.currVolumeNo>=this.volumes)return;const e=this;return new ReadableStream({start(t){e.setWriter(async e=>t.enqueue(e))},async pull(t){await e.next().then(e=>e&&t.close())}})}}class Hn{canvas;mousemoveState;ctx;queue;rectSize;rectGap;columns;padding;scrollTop;scrollSize;debouncer;onClick;cherryPick;constructor(e,t,n){if(this.queue=t,this.cherryPick=n,!e)throw new Error("canvas not found");this.canvas=e,this.canvas.addEventListener("wheel",e=>this.onwheel(e.deltaY)),this.mousemoveState={x:0,y:0},this.canvas.addEventListener("mousemove",e=>{this.mousemoveState={x:e.offsetX,y:e.offsetY},this.drawDebouce()}),this.canvas.addEventListener("click",e=>{this.mousemoveState={x:e.offsetX,y:e.offsetY};const t=this.computeDrawList()?.find(e=>e.selected)?.index;void 0!==t&&ye.emit("downloader-canvas-on-click",t)}),this.ctx=this.canvas.getContext("2d"),this.rectSize=12,this.rectGap=6,this.columns=15,this.padding=7,this.scrollTop=0,this.scrollSize=10,this.debouncer=new Ce,ye.subscribe("imf-download-state-change",()=>this.drawDebouce()),ye.subscribe("downloader-canvas-resize",()=>this.resize())}resize(e){e=e||this.canvas.parentElement,this.canvas.width=Math.floor(e.offsetWidth),this.canvas.height=Math.floor(e.offsetHeight),this.columns=Math.ceil((this.canvas.width-2*this.padding-this.rectGap)/(this.rectSize+this.rectGap)),this.draw()}onwheel(e){const[t,n]=this.getWH(),i=this.computeClientHeight();i>n&&(e>>=1,this.scrollTop+=e,this.scrollTop<0&&(this.scrollTop=0),this.scrollTop+n>i+20&&(this.scrollTop=i-n+20),this.draw())}drawDebouce(){this.debouncer.addEvent("DOWNLOADER-DRAW",()=>this.draw(),20)}computeDrawList(){const e=[],t=this.cherryPick(),[n,i]=this.getWH(),a=this.computeStartX(),r=-this.scrollTop+this.padding;for(let n=0,o=-1;n<this.queue.length;n++){const s=n%this.columns;0==s&&o++;const l=a+(this.rectSize+this.rectGap)*s,c=r+(this.rectSize+this.rectGap)*o;if(!(c+this.rectSize<0)){if(c>i)break;e.push({index:n,x:l,y:c,selected:this.isSelected(l,c),disabled:!t.picked(n)})}}return e}draw(){const[e,t]=this.getWH();this.ctx.clearRect(0,0,e,t);const n=this.computeDrawList();for(const e of n)this.drawSmallRect(e.x,e.y,this.queue[e.index],e.index===this.queue.currIndex,e.selected,e.disabled)}computeClientHeight(){return Math.ceil(this.queue.length/this.columns)*(this.rectSize+this.rectGap)-this.rectGap}scrollTo(e){const t=this.computeClientHeight(),[n,i]=this.getWH();if(t<=i)return;const a=(Math.ceil((e+1)/this.columns)-1)*(this.rectSize+this.rectGap);if(a>i){this.scrollTop=a+this.rectSize-i;const e=t-i+20;this.scrollTop+20<=e&&(this.scrollTop+=20)}}isSelected(e,t){return this.mousemoveState.x-e>=0&&this.mousemoveState.x-e<=this.rectSize&&this.mousemoveState.y-t>=0&&this.mousemoveState.y-t<=this.rectSize}computeStartX(){const[e,t]=this.getWH();return e-((this.rectSize+this.rectGap)*this.columns-this.rectGap)>>1}drawSmallRect(e,t,n,i,a,r){if(r)this.ctx.fillStyle="rgba(20, 20, 20, 1)";else switch(n.stage){case ie.FAILED:this.ctx.fillStyle="rgba(250, 50, 20, 0.9)";break;case ie.URL:this.ctx.fillStyle="rgba(200, 200, 200, 0.6)";break;case ie.DATA:const e=n.downloadState.loaded/n.downloadState.total;this.ctx.fillStyle=`rgba(${200+Math.ceil(-90*e)}, ${200+Math.ceil(0*e)}, ${200+Math.ceil(-80*e)}, ${.6+Math.ceil(.4*e)})`;break;case ie.DONE:this.ctx.fillStyle="rgb(110, 200, 120)"}this.ctx.fillRect(e,t,this.rectSize,this.rectSize),this.ctx.shadowColor="#d53",a?(this.ctx.strokeStyle="rgb(60, 20, 200)",this.ctx.lineWidth=2):i?(this.ctx.strokeStyle="rgb(255, 60, 20)",this.ctx.lineWidth=2):(this.ctx.strokeStyle="rgb(90, 90, 90)",this.ctx.lineWidth=1),this.ctx.strokeRect(e,t,this.rectSize,this.rectSize)}getWH(){return[this.canvas.width,this.canvas.height]}}const Gn=/[\\/:*?"<>|\n\t]/g;class Wn{meta;title;downloading;queue;idleLoader;pageFetcher;done=!1;selectedChapters=[];filenames=new Set;panel;canvas;cherryPicks=[new Zn];constructor(e,t,n,i,a){this.panel=e.downloader,this.panel.initTabs(),this.initEvents(this.panel),this.panel.initCherryPick((e,t)=>{void 0===this.cherryPicks[e]&&(this.cherryPicks[e]=new Zn);const n=this.cherryPicks[e].add(t);return ye.emit("cherry-pick-changed",e,this.cherryPicks[e]),n},(e,t)=>{void 0===this.cherryPicks[e]&&(this.cherryPicks[e]=new Zn);const n=this.cherryPicks[e].remove(t);return ye.emit("cherry-pick-changed",e,this.cherryPicks[e]),n},e=>{void 0===this.cherryPicks[e]&&(this.cherryPicks[e]=new Zn),this.cherryPicks[e].reset(),ye.emit("cherry-pick-changed",e,this.cherryPicks[e])},e=>(void 0===this.cherryPicks[e]&&(this.cherryPicks[e]=new Zn),this.cherryPicks[e].values)),this.panel.initNotice([{btn:pe.resetDownloaded.get(),cb:()=>{confirm(pe.resetDownloadedConfirm.get())&&this.queue.forEach(e=>e.stage===ie.DONE&&e.resetStage())}},{btn:pe.resetFailed.get(),cb:()=>{this.queue.forEach(e=>e.stage===ie.FAILED&&e.resetStage()),this.downloading||this.idleLoader.abort(0,100)}}]),this.queue=t,this.queue.cherryPick=()=>this.cherryPicks[this.queue.chapterIndex]||new Zn,this.idleLoader=n,this.idleLoader.cherryPick=()=>this.cherryPicks[this.queue.chapterIndex]||new Zn,this.canvas=new Hn(this.panel.canvas,t,()=>this.cherryPicks[this.queue.chapterIndex]||new Zn),this.pageFetcher=i,this.meta=e=>a.galleryMeta(e),this.title=e=>a.title(e),this.downloading=!1,this.queue.downloading=()=>this.downloading,ye.subscribe("ifq-on-finished-report",(e,t)=>{if(t.isFinished()){const e=this.selectedChapters.find(e=>e.index===t.chapterIndex);e&&(e.done=!0,e.resolve(!0)),this.downloading||this.done||this.panel.noticeableBTN()}}),ye.subscribe("imf-check-picked",(e,t)=>this.cherryPicks[e]?.picked(t))}initEvents(e){e.forceBTN.addEventListener("click",()=>this.download(this.pageFetcher.chapters)),e.startBTN.addEventListener("click",()=>{this.downloading?this.abort("downloadStart"):this.start()})}needNumberTitle(e){if("numbers"===ve.conf.filenameOrder)return!0;if("original"===ve.conf.filenameOrder)return!1;let t;t="alphabetically"===ve.conf.filenameOrder?(e,t)=>e<t:(e,t)=>e.localeCompare(t,void 0,{numeric:!0,sensitivity:"base"})<0;let n="";for(const i of e){if(n&&t(i.node.title,n))return!0;n=i.node.title}return!1}check(){this.downloading||(setTimeout(()=>ye.emit("downloader-canvas-resize"),110),this.panel.createChapterSelectList(this.pageFetcher.chapters,this.selectedChapters),this.queue.length>0?this.panel.switchTab("status"):this.pageFetcher.chapters.length>1&&this.panel.switchTab("chapters"))}checkSelectedChapters(){this.selectedChapters.length=0;const e=this.panel.selectedChapters();return 0===e.size?this.selectedChapters.push({index:this.pageFetcher.chapterIndex,done:!1,...U()}):this.pageFetcher.chapters.forEach((t,n)=>e.has(t.id)&&this.selectedChapters.push({index:n,done:!1,...U()})),this.selectedChapters}async start(){if(!this.downloading){this.panel.flushUI("downloading"),this.downloading=!0,this.idleLoader.autoLoad=!0,this.checkSelectedChapters();try{for(const e of this.selectedChapters){if(!this.downloading)return;await this.pageFetcher.restoreChapter(e.index),this.queue.forEach(e=>e.stage===ie.FAILED&&e.resetStage()),this.queue.isFinished()?(e.done=!0,e.resolve(!0)):(this.idleLoader.processingIndexList=this.queue.map((e,t)=>e.lock||e.stage!==ie.URL?-1:t).filter(e=>e>=0).splice(0,ve.conf.downloadThreads),this.idleLoader.onFailed(()=>e.reject("download failed or canceled")),this.idleLoader.checkProcessingIndex(),this.idleLoader.start()),await e.promise}this.downloading&&await this.download(this.selectedChapters.filter(e=>e.done).map(e=>this.pageFetcher.chapters[e.index]))}catch(e){if("abort"===e)return;this.abort("downloadFailed"),u("error","download failed: ",e)}finally{this.downloading=!1}}}mapToFileLikes(e,t,n){if(!e||0===e.filteredQueue.length)return[];let i;if(this.needNumberTitle(e.filteredQueue)){const t=e.filteredQueue.length.toString().length;i="numbers"===ve.conf.filenameOrder?(e,n)=>`${n+1}`.padStart(t,"0")+"."+e.split(".").pop():(e,n)=>`${n+1}`.padStart(t,"0")+"_"+e.replaceAll(Gn,"_")}else this.filenames.clear(),i=e=>O(this.filenames,e.replaceAll(Gn,"_"));const a=e.filteredQueue.filter((e,n)=>t.picked(n)&&e.stage===ie.DONE&&e.data).map((e,t)=>({stream:()=>Promise.resolve(q(e.data)),size:()=>e.data.byteLength,name:n+i(e.node.title,t)})),r=(new TextEncoder).encode(JSON.stringify(this.meta(e),null,2));return a.push({stream:()=>Promise.resolve(q(r)),size:()=>r.byteLength,name:n+"meta.json"}),a}async download(e){try{const t=this.title(e).replaceAll(Gn,"_"),i=-1!==navigator.userAgent.indexOf("Win")?"\\":"/",a=1===e.length;this.panel.flushUI("packaging");const r=new Set,o=[];for(let t=0;t<e.length;t++){const n=e[t],s=this.cherryPicks[t]||new Zn;let l=(()=>a?"":n.title instanceof Array?n.title.join("_").replaceAll(Gn,"_").replaceAll(/\s+/g," ")+i:n.title.replaceAll(Gn,"_").replaceAll(/\s+/g," ")+i)();l=$(l,200),l=O(r,l);const c=this.mapToFileLikes(n,s,l);o.push(...c)}const s=new jn({volumeSize:1048576*(ve.conf.archiveVolumeSize||1500)});o.forEach(e=>s.add(e));const l=async()=>{let e;for(;e=s.nextReadableStream();){const i=await new Response(e).blob(),a=s.currVolumeNo===s.volumes-1?"zip":"z"+(s.currVolumeNo+1).toString().padStart(2,"0");n.saveAs(i,`${t}.${a}`)}};await l(),this.done=!0}catch(e){let t=e.toString();throw t.includes("autoAllocateChunkSize")&&(t="Create Zip archive prevented by The content security policy of this page. Please refer to the CONF > Help for a solution."),ye.emit("notify-message","error",`packaging failed, ${t}`),e}finally{this.abort(this.done?"downloaded":"downloadFailed")}}abort(e){this.downloading=!1,this.panel.abort(e),this.idleLoader.abort(),this.selectedChapters.forEach(e=>e.reject("abort"))}}class Zn{values=[];positive=!1;sieve=[];reset(){this.values=[],this.positive=!1,this.sieve=[]}add(e){if(0===this.values.length)return this.positive=e.positive,this.values.push(e),this.setSieve(e),this.values;if(this.values.find(t=>t.id===e.id))return null;const t=e.range(),n=new Set,i=new Set,a=[];let r=!1;for(let o=0;o<this.values.length;o++){const s=this.values[o],l=s.range();if(t[0]>=l[0]&&t[1]<=l[1]){e.positive!==this.positive&&(n.add(s.id),l[0]<t[0]&&a.push(new Xn([l[0],t[0]-1],s.positive)),l[1]>t[1]&&a.push(new Xn([t[1]+1,l[1]],s.positive)),r=t[0]===t[1]&&t[0]===l[0]&&t[1]===l[1]);break}t[0]<=l[0]&&t[1]>=l[1]?n.add(s.id):t[0]<=l[0]&&t[1]>=l[0]&&t[1]<=l[1]?s.reset([t[1]+1,l[1]]):t[0]>=l[0]&&t[0]<=l[1]&&t[1]>=l[1]&&s.reset([l[0],t[0]-1]),e.positive===this.positive&&(i.has(e.id)||(i.add(e.id),a.push(e)))}if(n.size>0&&(this.values=this.values.filter(e=>!n.has(e.id))),a.length>0&&this.values.push(...a),0===this.values.length){if(this.reset(),r)return this.values;this.positive=e.positive,this.values.push(e)}else this.concat();return this.setSieve(e),this.values}setSieve(e){const t=e.range();for(let n=t[0]-1;n<t[1];n++)this.sieve[n]=e.positive===this.positive}concat(){if(this.values.length<2)return;this.values.sort((e,t)=>e.range()[0]-t.range()[0]);let e=0,t=1;const n=[];for(;e<this.values.length&&t<this.values.length;){const i=this.values[e],a=this.values[t],r=i.range(),o=a.range();if(r[1]+1===o[0])i.reset([r[0],o[1]]),n.push(t),t++;else{do{e++}while(n.includes(e));t=e+1}}this.values=this.values.filter((e,t)=>!n.includes(t))}remove(e){const t=this.values.findIndex(t=>t.id===e);if(-1===t)return;const n=this.values.splice(t,1)[0].range();for(let e=n[0]-1;e<n[1];e++)this.sieve[e]=!1;0===this.values.length&&(this.sieve=[],this.positive=!1)}picked(e){return Boolean(this.positive?this.sieve[e]:!this.sieve[e])}}class Xn{value;positive;id;constructor(e,t){this.positive=t,this.value=e.sort((e,t)=>e-t),this.id=Xn.rangeToString(this.value,this.positive)}toString(){return Xn.rangeToString(this.value,this.positive)}reset(e){this.value=e.sort((e,t)=>e-t),this.id=Xn.rangeToString(this.value,this.positive)}range(){return this.value}static rangeToString(e,t){let n="";return n=e[0]===e[1]?e[0].toString():e.map(e=>e.toString()).join("-"),t?n:"!"+n}static from(e){if(e=e?.trim(),!e)return null;const t=(e=e.replace(/!+/,"!")).startsWith("!");if(/^!?\d+$/.test(e)){const n=parseInt(e.replace("!",""));return new Xn([n,n],!t)}if(/^!?\d+-\d+$/.test(e)){const n=e.replace("!","").split("-").map(e=>parseInt(e));return new Xn([n[0],n[1]],!t)}return null}}class Kn extends Array{executableQueue;currIndex;finishedIndex=new Set;debouncer;downloading;dataSize=0;chapterIndex=0;cherryPick;clear(){this.length=0,this.executableQueue=[],this.currIndex=0,this.finishedIndex.clear()}restore(e,t){this.clear(),this.chapterIndex=e,t.forEach((e,t)=>e.stage===ie.DONE&&this.finishedIndex.add(t)),this.push(...t)}static newQueue(){const e=new Kn;return ye.subscribe("imf-on-finished",(t,n,i)=>e.chapterIndex===i.chapterIndex&&e.finishedReport(t,n,i)),ye.subscribe("ifq-do",(t,n,i)=>{n.chapterIndex===e.chapterIndex&&e.do(t,i)}),ye.subscribe("pf-change-chapter",()=>e.forEach(e=>e.unrender())),ye.subscribe("add-cherry-pick-range",(t,n,i)=>{t===e.chapterIndex&&(i||e[n]?.stage===ie.DATA&&(e[n].abort(),e[n].stage=ie.URL))}),e}constructor(){super(),this.executableQueue=[],this.currIndex=0,this.debouncer=new Ce}isFinished(){const e=this.cherryPick?.(this.chapterIndex);if(e&&e.values.length>0){for(let t=0;t<this.length;t++)if(e.picked(t)&&!this.finishedIndex.has(t))return!1;return!0}return this.finishedIndex.size===this.length}do(e,t){t=t||"next",this.currIndex=this.fixIndex(e),ye.emit("ifq-on-do",this.currIndex,this,this.downloading?.()||!1),this.downloading?.()||this.pushInExecutableQueue(t)&&this.debouncer.addEvent("IFQ-EXECUTABLE",()=>{console.log("IFQ-EXECUTABLE: ",this.executableQueue),Promise.all(this.executableQueue.splice(0,ve.conf.paginationIMGCount).map(e=>this[e].start())).then(()=>{const e=this.cherryPick?.(this.chapterIndex);this.executableQueue.filter(t=>!e||e.picked(t)).forEach(e=>this[e].start())})},300)}finishedReport(e,t,n){0!==this.length&&t&&n.stage===ie.DONE&&(this.finishedIndex.add(e),this.dataSize<1e9&&(this.dataSize+=n.data?.byteLength||0),ye.emit("ifq-on-finished-report",e,this))}fixIndex(e){return e<0?0:e>this.length-1?this.length-1:e}pushInExecutableQueue(e){this.executableQueue=[];for(let t=0,n=this.currIndex;this.checkOutbounds(n,e,t);"next"===e?++n:--n)this[n].stage!==ie.DONE&&(this.executableQueue.push(n),t++);return this.executableQueue.length>0}checkOutbounds(e,t,n){let i=!1;return"next"===t&&(i=e<this.length),"prev"===t&&(i=e>-1),!!i&&n<ve.conf.threads+ve.conf.paginationIMGCount-1}findImgIndex(e){for(let t=0;t<this.length;t++)if(this[t].node.equal(e))return t;return 0}}class Yn{queue;processingIndexList;restartId;maxWaitMS;minWaitMS;onFailedCallback;autoLoad=!1;debouncer;cherryPick;constructor(e){this.queue=e,this.processingIndexList=[0],this.maxWaitMS=1e3,this.minWaitMS=300,this.autoLoad=ve.conf.autoLoad,this.debouncer=new Ce,ye.subscribe("ifq-on-do",(e,t,n)=>!n&&this.abort(e)),ye.subscribe("imf-on-finished",e=>{this.processingIndexList.includes(e)&&this.wait().then(()=>{this.checkProcessingIndex(),this.start()})}),ye.subscribe("pf-change-chapter",e=>!this.queue.downloading?.()&&this.abort(e>0?0:void 0)),window.addEventListener("focus",()=>{ve.conf.autoLoadInBackground||this.debouncer.addEvent("Idle-Load-on-focus",()=>{console.log("[ IdleLoader ] window focus, document.hidden:",document.hidden),document.hidden||this.abort(0,10)},100)}),ye.subscribe("pf-on-appended",(e,t,n,i)=>{i||this.processingIndexList.length>0||this.abort(this.queue.currIndex,100)})}onFailed(e){this.onFailedCallback=e}start(){if(this.autoLoad&&(!document.hidden||ve.conf.autoLoadInBackground)&&0!==this.processingIndexList.length&&0!==this.queue.length){u("info","Idle Loader start at:"+this.processingIndexList.toString());for(const e of this.processingIndexList)this.queue[e].start()}}checkProcessingIndex(){if(0===this.queue.length)return;const e=this.cherryPick?.()||new Zn,t=new Set;let n=!1;for(let i=0;i<this.processingIndexList.length;i++){const a=this.processingIndexList[i],r=this.queue[a];if(r.stage===ie.FAILED&&(n=!0),!r.lock&&r.stage!==ie.URL){for(let r=Math.min(a+1,this.queue.length-1),o=this.queue.length;r<o;r++){if(e.picked(r)){const e=this.queue[r];if(!e.lock&&e.stage===ie.URL&&!t.has(r)){t.add(r),this.processingIndexList[i]=r;break}e.stage===ie.FAILED&&(n=!0)}r>=this.queue.length-1&&(o=a,r=0)}if(0===t.size)return this.processingIndexList.length=0,void(n&&this.onFailedCallback&&(this.onFailedCallback(),this.onFailedCallback=void 0))}}}async wait(){const{maxWaitMS:e,minWaitMS:t}=this;return new Promise(function(n){const i=Math.floor(Math.random()*e+t);window.setTimeout(()=>n(!0),i)})}abort(e,t){this.processingIndexList=[],this.debouncer.addEvent("IDLE-LOAD-ABORT",()=>{this.autoLoad&&void 0!==e&&(this.queue.downloading?.()||(this.processingIndexList=[e],this.checkProcessingIndex(),this.start()))},t||ve.conf.restartIdleLoader)}}const Jn={moonViewCeremony:"<🎑>",zoomIcon:"⇱⇲"},Qn={entry:Jn.moonViewCeremony,collapse:pe.collapse.get(),fin:"FIN",autoPagePlay:pe.autoPagePlay.get(),autoPagePause:pe.autoPagePause.get(),config:pe.config.get(),download:pe.download.get(),chapters:pe.chapters.get(),filter:pe.filter.get(),pagination:"PAGE",continuous:"CONT",horizontal:"HORI"};class ei{defaultKeys;cb;noPreventDefault=!1;constructor(e,t,n){this.defaultKeys=e,this.cb=t,this.noPreventDefault=n||!1}}class ti{}class ni{root;queue=[];done=!1;chapterIndex=0;layout;resizedNodesPending=[];debouncer;constructor(e,t){this.root=e.fullViewGrid,this.debouncer=new Ce,"flow"===ve.conf.gridMode?this.layout=new ai(this.root):this.layout=new ii(this.root,e.styleSheet),ye.subscribe("pf-on-appended",(e,t,n,i)=>{this.chapterIndex>-1&&n!==this.chapterIndex||(this.append(t),this.done=i||!1,setTimeout(()=>this.renderCurrView(),200))}),ye.subscribe("pf-change-chapter",e=>{this.chapterIndex=e,this.layout.reset(),this.queue=[],this.done=!1}),ye.subscribe("ifq-do",(e,n)=>{if(!t.visible)return;if(n.chapterIndex!==this.chapterIndex)return;if(!n.node.root)return;let i=0;i="flow"===ve.conf.gridMode?n.node.root.parentElement.offsetTop-window.screen.availHeight/3:n.node.root.offsetTop-window.screen.availHeight/3,i=i<=0?0:i>=this.root.scrollHeight?this.root.scrollHeight:i,this.root.scrollTo.toString().includes("[native code]")?this.root.scrollTo({top:i,behavior:"smooth"}):this.root.scrollTop=i}),ye.subscribe("cherry-pick-changed",e=>this.chapterIndex===e&&this.updateRender()),this.root.addEventListener("scroll",()=>this.debouncer.addEvent("FULL-VIEW-SCROLL-EVENT",()=>{e.root.classList.contains("ehvp-root-collapse")||(this.renderCurrView(),this.tryExtend())},400)),this.root.addEventListener("click",t=>{(t.target===e.fullViewGrid||t.target.classList.contains("fvg-sub-container"))&&ye.emit("toggle-main-view",!1)}),ye.subscribe("fvg-layout-change",()=>{this.layout.remove(this.root),"flow"===ve.conf.gridMode?this.layout=new ai(this.root):this.layout=new ii(this.root,e.styleSheet),this.layout.resize(this.queue)}),ye.subscribe("fvg-layout-resize",()=>this.layout.resize(this.queue)),ye.subscribe("imf-resize",e=>this.resizedNodes(e))}resizedNodes(e){const t=e.node;t.root&&this.resizedNodesPending.push(t.root),this.debouncer.addEvent("RESIZED-NODES",()=>{if(0===this.resizedNodesPending.length)return;let e=null;for(;e=this.resizedNodesPending.shift();){const t=this.layout.resizedNode(e,this.resizedNodesPending);this.resizedNodesPending=this.resizedNodesPending.filter((e,n)=>!t.includes(n))}},50)}append(e){if(e.length>0){let t=this.queue.length;const n=e.map(e=>{const n={node:e,element:e.create(),ratio:e.ratio()};return n.element.setAttribute("data-index",t.toString()),t++,n});this.queue.push(...n),this.layout.append(n)}}tryExtend(){this.done||this.layout.nearBottom()&&ye.emit("pf-try-extend")}updateRender(){this.queue.forEach(({node:e})=>e.isRender()&&e.render())}renderCurrView(){const[e,t]=this.layout.visibleRange(this.root,this.queue.map(e=>e.element)),[n,i]=[parseInt(e.getAttribute("data-index")??"-1"),parseInt(t.getAttribute("data-index")??"-1")];n<i&&n>-1&&i<this.queue.length?(this.queue.slice(n,i+1).forEach(e=>e.node.render()),u("info","render curr view, range: ",`[${n}-${i}]`)):u("error","render curr view error, range: ",`[${n}-${i}]`)}}class ii extends ti{root;style;constructor(e,t){super(),this.root=e,this.style=t,this.root.classList.add("fvg-grid"),this.root.classList.remove("fvg-flow")}append(e){this.root.append(...e.map(e=>e.element))}nearBottom(){const e=Array.from(this.root.childNodes);if(0===e.length)return!1;const t=e[e.length-1];return!(this.root.scrollTop+this.root.clientHeight+2.5*this.root.clientHeight<t.offsetTop+t.offsetHeight)}reset(){this.root.innerHTML=""}resize(e){const t=j(this.style,".fvg-grid");t&&(t.style.gridTemplateColumns=`repeat(${ve.conf.colCount}, minmax(10px, 1fr))`),this.root.innerHTML="",this.append(e)}resizedNode(e,t){return t.map((e,t)=>t)}visibleRange(e,t){if(0===t.length)return[e,e];const n=e.offsetHeight;let i,a,r=0;for(let e=0;e<t.length;e+=ve.conf.colCount){const o=t[e].getBoundingClientRect(),s=o.top+o.height>=0&&o.top<=n;if(s&&void 0===i&&(i=t[e]),i&&!s&&r++,r>=2){a=t[Math.min(t.length-1,e+ve.conf.colCount)];break}}return a=a??t[t.length-1],[i??a,a]}remove(e){e.innerHTML=""}}class ai extends ti{root;lastRow;count=0;resizeObserver;lastRootWidth;base;constructor(e){super(),this.root=e,this.root.classList.add("fvg-flow"),this.root.classList.remove("fvg-grid"),this.lastRootWidth=this.root.offsetWidth,this.base=this.initBaseline(),this.resizeObserver=new ResizeObserver(e=>{const t=e[0],n=t.contentRect.width;this.lastRootWidth!==n&&(this.lastRootWidth=n,Array.from(t.target.querySelectorAll(".fvg-sub-container")).forEach(e=>this.resizeRow(e)))}),this.resizeObserver.observe(this.root)}initBaseline(){return{height:ve.conf.rowHeight,columns:ve.conf.colCount,gap:8}}createRow(e){const t=document.createElement("div");return t.classList.add("fvg-sub-container"),t.style.height=(e??this.base.height)+"px",t.style.marginTop=this.base.gap+"px",this.root.appendChild(t),t}append(e){for(const t of e)t.element.style.marginLeft=this.base.gap+"px",this.lastRow||(this.lastRow=this.createRow()),this.checkRowFilled(this.lastRow,t.ratio)&&(this.resizeRow(this.lastRow),this.lastRow=this.createRow(this.lastRow?.offsetHeight)),this.lastRow.appendChild(t.element),this.count++}checkRowFilled(e,t){if(0===e.childElementCount)return!1;let n=e.childElementCount>=this.base.columns;if(!n){let i=this.base.height*t;const a=e.childElementCount*this.base.gap+this.base.gap;i*=.4/Math.max(1,t),n=this.childrenRatio(e).reduce((e,t)=>e+t*this.base.height,0)+a+i>=this.root.offsetWidth}return n}childrenRatio(e){const t=[];return e.childNodes.forEach(e=>t.push((e=>{let t=parseFloat(e.getAttribute("data-ratio")??"1");return t=isNaN(t)?1:t,t})(e))),t}resizeRow(e){const t=this.childrenRatio(e).reduce((e,t)=>e+t,0),n=e.childElementCount*this.base.gap+this.base.gap,i=(this.root.offsetWidth-n)/t;e.style.height=i+"px"}resize(e){this.base=this.initBaseline(),this.root.innerHTML="",this.lastRow=void 0,this.append(e)}resizedNode(e,t){function*n(){if(a.append(...r),i.childElementCount>0){const e=Array.from(i.childNodes).map(e=>e);a.append(...e),r.push(...e)}let e=null;for(;e=r.shift();)yield e;const t=i?.nextElementSibling;if(t)for(r=Array.from(t.childNodes).map(e=>e);e=r.shift();)yield e}let i=e.parentElement;if(!i)return[];const a=document.createDocumentFragment();let r=[],o=[],s=0,l=1;for(;;){for(const e of n()){const n=parseFloat(e.getAttribute("data-ratio")??"1");if(this.checkRowFilled(i,n)){r.unshift(e),this.resizeRow(i);break}const a=t.indexOf(e);a>=0&&o.push(a),s++,i.appendChild(e)}if(i=i?.nextElementSibling,null===i&&(i=this.createRow()),0===r.length){0===i.childElementCount&&i.remove();break}if(r.length===i.childElementCount&&r[0]===i.firstElementChild)break;l++}return u("info",`resizedNode moved img-nodes [${s}], changed rows [${l}], resized [${o.length}]`),o}nearBottom(){const e=this.lastRow;return!(!e||this.root.scrollTop+this.root.clientHeight+2.5*this.root.clientHeight<e.offsetTop+e.offsetHeight)}reset(){this.lastRow=void 0,this.root.innerHTML=""}visibleRange(){const e=Array.from(this.root.querySelectorAll(".fvg-sub-container"));if(0===e.length)return[this.root,this.root];const t=this.root.offsetHeight;let n,i,a=0;for(let r=0;r<e.length;r++){const o=e[r].getBoundingClientRect(),s=o.top+o.height>=0&&o.top<=t;if(s&&void 0===n&&(n=e[r].firstElementChild),n&&!s&&a++,a>=2){i=e[r].lastElementChild;break}}return i=i??e[e.length-1].lastElementChild,[n??i,i]}remove(e){e.innerHTML=""}}class ri{root;panel;canvas;tabStatus;tabChapters;tabCherryPick;statusElement;chaptersElement;cherryPickElement;noticeElement;forceBTN;startBTN;btn;constructor(e){this.root=e,this.btn=k("#downloader-panel-btn",e),this.panel=k("#downloader-panel",e),this.canvas=k("#downloader-canvas",e),this.tabStatus=k("#download-tab-status",e),this.tabChapters=k("#download-tab-chapters",e),this.tabCherryPick=k("#download-tab-cherry-pick",e),this.statusElement=k("#download-status",e),this.chaptersElement=k("#download-chapters",e),this.cherryPickElement=k("#download-cherry-pick",e),this.noticeElement=k("#download-notice",e),this.forceBTN=k("#download-force",e),this.startBTN=k("#download-start",e),this.panel.addEventListener("transitionend",()=>ye.emit("downloader-canvas-resize"))}initTabs(){const e=[this.statusElement,this.chaptersElement,this.cherryPickElement],t=[{ele:this.tabStatus,cb:()=>{e.forEach((e,t)=>e.hidden=0!=t),ye.emit("downloader-canvas-resize")}},{ele:this.tabChapters,cb:()=>{e.forEach((e,t)=>e.hidden=1!=t)}},{ele:this.tabCherryPick,cb:()=>{e.forEach((e,t)=>e.hidden=2!=t),k("#download-cherry-pick-input",this.cherryPickElement).focus()}}];t.forEach(({ele:e,cb:n},i)=>{e.addEventListener("click",()=>{e.classList.add("ehvp-p-tab-selected"),t.filter((e,t)=>t!=i).forEach(e=>e.ele.classList.remove("ehvp-p-tab-selected")),n()})})}switchTab(e){switch(e){case"status":this.tabStatus.click();break;case"chapters":this.tabChapters.click();break;case"cherry-pick":this.tabCherryPick.click()}}initNotice(e){this.noticeElement.innerHTML="",e.forEach(e=>{const t=document.createElement("a");t.textContent=e.btn,t.classList.add("clickable"),t.style.color="gray",t.style.margin="0em 0.5em",t.addEventListener("click",e.cb),this.noticeElement.append(t)})}abort(e){this.flushUI(e),this.normalizeBTN()}flushUI(e){this.startBTN.style.color="downloadFailed"===e?"red":"",this.startBTN.textContent=pe[e].get(),this.btn.style.color="downloadFailed"===e?"red":""}noticeableBTN(){this.btn.classList.contains("lightgreen")||(this.btn.classList.add("lightgreen"),/✓/.test(this.btn.textContent)||(this.btn.textContent+="✓"))}normalizeBTN(){this.btn.textContent=this.btn.textContent.replace("✓",""),this.btn.classList.remove("lightgreen")}createChapterSelectList(e,t){const n=1===e.length;this.chaptersElement.innerHTML=`\n      <div>\n        <span id="download-chapters-select-all" class="clickable">Select All</span>\n        <span id="download-chapters-unselect-all" class="clickable">Unselect All</span>\n        <span id="download-chapters-add-new" class="clickable">Add New Chapters</span>\n      </div>\n      ${e.map((e,i)=>`<div><label>\n        <input type="checkbox" id="ch-${e.id}" value="${e.id}" ${n||t.find(e=>e.index===i)?"checked":""} />\n        <span>${e.title}</span></label></div>`).join("")}`,[["#download-chapters-select-all",!0],["#download-chapters-unselect-all",!1]].forEach(([t,n])=>this.chaptersElement.querySelector(t)?.addEventListener("click",()=>e.forEach(e=>{const t=this.chaptersElement.querySelector("#ch-"+e.id);t&&(t.checked=n)}))),this.chaptersElement.querySelector("#download-chapters-add-new")?.addEventListener("click",e=>{!function(e,t){const n=document.createElement("div");n.style.position="fixed",n.style.zIndex="2100",n.style.padding="3px",n.style.backgroundColor="var(--ehvp-theme-bg-color)",n.style.border="var(--ehvp-panel-border)",n.style.borderRadius="5px",n.innerHTML='\n          <div style="display: flex; justify-content: center; margin: 10px 2px;"><input id="download-chapters-add-input" style="width: 250px; background-color: #ffffff80;" placeholder="https://example.com" /></div>\n          <div style="display: flex; justify-content: center;">\n            <button class="ehvp-custom-btn ehvp-modal-btn-cancel" style="background-color: gray;">Cancel</button>\n            <button class="ehvp-custom-btn ehvp-modal-btn-confirm" style="background-color: var(--ehvp-clickable-color-hover);">Confirm</button>\n          </div>\n        ',e.appendChild(n),n.querySelector(".ehvp-modal-btn-cancel")?.addEventListener("click",()=>n.remove()),n.querySelector(".ehvp-modal-btn-confirm")?.addEventListener("click",()=>(async e=>{const t=e.querySelector("#download-chapters-add-input")?.value;if(!t)return;const n=ye.emit("pf-append-chapters",t);n&&await n})(n).finally(()=>n.remove())),z(n,t,e.offsetWidth,e.offsetHeight)}(this.root,e.target)})}selectedChapters(){const e=new Set;return this.chaptersElement.querySelectorAll("input[type=checkbox][id^=ch-]:checked").forEach(t=>e.add(Number(t.value))),e}initCherryPick(e,t,n,i){function a(e,t,n){e.querySelectorAll(".ehvp-custom-panel-item-value").forEach(e=>e.remove());const i=document.createElement("div");t.forEach(t=>{const a=`<span class="ehvp-custom-panel-item-value" data-id="${t.id}"><span >${t.toString()}</span><span class="ehvp-custom-btn ehvp-custom-btn-plain" style="padding:0;border:none;">&nbspx&nbsp</span></span>`;i.innerHTML=a;const r=i.firstElementChild;r.style.backgroundColor=t.positive?"#7fef7b":"#ffa975",e.appendChild(r),r.querySelector(".ehvp-custom-btn").addEventListener("click",e=>{const t=e.target.parentElement;n(t.getAttribute("data-id")),t.remove()}),i.remove()})}let r=0;const o=k("#download-cherry-pick-btn-add",this.cherryPickElement),s=k("#download-cherry-pick-btn-exclude",this.cherryPickElement),l=k("#download-cherry-pick-btn-clear",this.cherryPickElement),c=k("#download-cherry-pick-btn-range-before",this.cherryPickElement),d=k("#download-cherry-pick-btn-range-after",this.cherryPickElement),h=k("#download-cherry-pick-input",this.cherryPickElement),p=(n,i)=>{const o=i?[Xn.from((n?"!":"")+i)].filter(e=>null!==e):(h.value||"").split(",").map(e=>(n?"!":"")+e).map(Xn.from).filter(e=>null!==e);o.length>0&&o.forEach(n=>{const i=e(r,n);null!==i&&a(this.cherryPickElement.firstElementChild,i,e=>t(r,e))}),h.value="",h.focus()},g=()=>{n(r),a(this.cherryPickElement.firstElementChild,[],e=>t(r,e)),h.value="",h.focus()};o.addEventListener("click",()=>p(!1)),s.addEventListener("click",()=>p(!0)),l.addEventListener("click",g),this.cherryPickElement.querySelectorAll(".download-cherry-pick-follow-btn").forEach(e=>{e.addEventListener("click",()=>{const t=parseInt(e.getAttribute("data-sibling-step")||"1");let n=e;for(let e=0;e<t;e++)n=n.previousElementSibling;t<=1&&g(),p(t>1,n.getAttribute("data-range")||void 0)})}),h.addEventListener("keypress",e=>"Enter"===e.key&&p(!1));let u=0;ye.subscribe("add-cherry-pick-range",(n,i,r,o)=>{const s=new Xn([i+1,o?(u??i)+1:i+1],r);u=i,a(this.cherryPickElement.firstElementChild,e(n,s)||[],e=>t(n,e))}),ye.subscribe("pf-change-chapter",e=>{-1!==e&&(r=e,a(this.cherryPickElement.firstElementChild,i(r)||[],e=>t(r,e)))});let m=0;ye.subscribe("pf-on-appended",e=>{m=e.toString().length;const t=d.getAttribute("data-range").split("-").map(e=>e.padStart(m,"0")).join("-");d.textContent=t,d.setAttribute("data-range",t);const n=c.getAttribute("data-range").split("-").map((t,n)=>1===n?e.toString():t.padStart(m,"0")).join("-");c.textContent=n,c.setAttribute("data-range",n)}),ye.subscribe("ifq-do",e=>{const t=[1,e+1].map(e=>e.toString().padStart(m,"0")).join("-");d.textContent=t,d.setAttribute("data-range",t);const n=c.getAttribute("data-range").split("-").map((t,n)=>0===n?(e+1).toString().padStart(m,"0"):t).join("-");c.textContent=n,c.setAttribute("data-range",n)})}static html(){return`\n<div id="downloader-panel" class="p-panel p-downloader p-collapse">\n    <div id="download-notice" class="download-notice" style="font-size: 0.7em;"></div>\n    <div id="download-middle" class="download-middle">\n      <div class="ehvp-tabs">\n        <a id="download-tab-status" class="clickable ehvp-p-tab">${pe.status.get()}</a>\n        <a id="download-tab-cherry-pick" class="clickable ehvp-p-tab">${pe.cherryPick.get()}</a>\n        <a id="download-tab-chapters" class="clickable ehvp-p-tab">${pe.selectChapters.get()}</a>\n      </div>\n      <div>\n        <div id="download-status" class="download-status" hidden>\n          <canvas id="downloader-canvas" width="0" height="0"></canvas>\n        </div>\n        <div id="download-cherry-pick" class="download-cherry-pick" hidden>\n          <div class="ehvp-custom-panel-item-values" style="text-align: start;">\n            <div style="margin-bottom: 1rem;display: flex;">\n              <input type="text" class="ehvp-custom-panel-item-input" id="download-cherry-pick-input" placeholder="1, 2-3" style="text-align: start; width: 50%; height: 1.3rem; border-radius: 0px;" />\n              <span class="ehvp-custom-btn ehvp-custom-btn-green" id="download-cherry-pick-btn-add">Pick</span>\n              <span class="ehvp-custom-btn ehvp-custom-btn-plain" id="download-cherry-pick-btn-exclude">Exclude</span>\n              <span class="ehvp-custom-btn ehvp-custom-btn-plain" id="download-cherry-pick-btn-clear">Clear</span>\n            </div>\n            <div style="margin-bottom: 1rem;">\n              <div style="margin-bottom: 0.2rem">\n                <span class="ehvp-custom-panel-item-span" id="download-cherry-pick-btn-range-after" data-range="1-1">1-1</span><span\n                 class="ehvp-custom-btn ehvp-custom-btn-green download-cherry-pick-follow-btn" data-sibling-step="1">pick</span><span\n                 class="ehvp-custom-btn ehvp-custom-btn-plain download-cherry-pick-follow-btn" data-sibling-step="2">exclude</span>\n              </div>\n              <div>\n                <span class="ehvp-custom-panel-item-span" id="download-cherry-pick-btn-range-before" data-range="1-1">1-1</span><span\n                class="ehvp-custom-btn ehvp-custom-btn-green download-cherry-pick-follow-btn" data-sibling-step="1">pick</span><span\n                class="ehvp-custom-btn ehvp-custom-btn-plain download-cherry-pick-follow-btn" data-sibling-step="2">exclude</span>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div id="download-chapters" class="download-chapters" hidden></div>\n      </div>\n    </div>\n    <div class="download-btn-group">\n       <a id="download-force" class="clickable">${pe.forceDownload.get()}</a>\n       <a id="download-start" style="color: rgb(120, 240, 80)" class="clickable">${pe.downloadStart.get()}</a>\n    </div>\n</div>`}}class oi{root;panel;configSelect;constructor(e){this.root=e,this.panel=k("#config-panel",e),this.configSelect=k("#config-a-select",e)}initEvents(e){this.flushConfigItems(e),this.configSelect.addEventListener("click",t=>{const n=t.target.getAttribute("data-value");n&&(ve.conf.selectedSiteNameConfig="global"===n?void 0:n,console.log("ADAPTER.conf.selectedSiteNameConfig: ",ve.conf.selectedSiteNameConfig),Array.from(this.configSelect.querySelectorAll(".b-main-option")).forEach(e=>{e.getAttribute("data-value")===ve.conf.selectedSiteNameConfig||"global"===e.getAttribute("data-value")&&void 0===ve.conf.selectedSiteNameConfig?e.classList.add("b-main-option-selected"):e.classList.remove("b-main-option-selected")}),this.flushConfigItems(e))}),k("#show-guide-element",this.panel).addEventListener("click",e.showGuideEvent),k("#show-keyboard-custom-element",this.panel).addEventListener("click",e.showKeyboardCustomEvent),k("#show-site-profiles-element",this.panel).addEventListener("click",e.showSiteProfilesEvent),k("#show-style-custom-element",this.panel).addEventListener("click",e.showStyleCustomEvent),k("#show-action-custom-element",this.panel).addEventListener("click",e.showActionCustomEvent),k("#reset-config-element",this.panel).addEventListener("click",()=>{const t=ve.conf.selectedSiteNameConfig;(function(e){const t=confirm(`${pe.resetConfig.get()}${e?" On "+e:" On "+pe.global.get()} ?`);return t&&(e?fe.setItem(g(e),""):p(d())),t})(t)&&(ve.conf=ve.globalConf=t?ve.globalConf:d(),ve.conf.selectedSiteNameConfig=t,this.flushConfigItems(e))})}flushConfigItems(e){const t=k("#config-panel-header",this.panel);Array.from(this.panel.querySelectorAll(".config-panel-item")).forEach(e=>e.remove());const n=we.map(W).map(e=>{const t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstElementChild});t.after(...n),we.forEach(t=>{switch(t.typ){case"number":k(`#${t.key}MinusBTN`,this.panel).addEventListener("click",()=>e.modNumberConfigEvent(t.key,"minus")),k(`#${t.key}AddBTN`,this.panel).addEventListener("click",()=>e.modNumberConfigEvent(t.key,"add")),k(`#${t.key}Input`,this.panel).addEventListener("wheel",n=>{n.preventDefault(),n.deltaY<0?e.modNumberConfigEvent(t.key,"add"):n.deltaY>0&&e.modNumberConfigEvent(t.key,"minus")});break;case"boolean":k(`#${t.key}Checkbox`,this.panel).addEventListener("click",()=>e.modBooleanConfigEvent(t.key));break;case"select":k(`#${t.key}Select`,this.panel).addEventListener("change",()=>e.modSelectConfigEvent(t.key));break;case"input":k(`#${t.key}TextInput`,this.panel).addEventListener("change",()=>e.modTextConfigEvent(t.key))}}),this.panel.querySelectorAll(".p-tooltip").forEach(e=>{const t=e.querySelector(".p-tooltiptext");t&&(e.addEventListener("mouseenter",()=>{t.style.display="block",z(t,e,this.root.offsetWidth,this.root.offsetHeight)}),e.addEventListener("mouseleave",()=>t.style.display="none"))})}static html(){return`\n<div id="config-panel" class="p-panel p-config p-collapse">\n    <div id="config-panel-header" style="position: sticky;border: 1px solid black;grid-column-start: 1;grid-column-end: 11;padding: 0px 0.3em;top: 0;z-index: 1;background-color: #33333390">\n      <div id="config-a-select"\n      ><a class="b-main-option clickable ${void 0===ve.conf.selectedSiteNameConfig?"b-main-option-selected":""}" data-value="global">${pe.global.get()}</a\n      ><a class="b-main-option clickable ${ve.conf.selectedSiteNameConfig===ve.matcher.name?"b-main-option-selected":""}" data-value="${ve.matcher.name}">${ve.matcher.name}</a></div>\n    </div>\n\n    \x3c!-- config items will place here --\x3e\n    <div style="grid-column-start: 1; grid-column-end: 11; padding-left: 5px;">\n        <label class="p-label">\n            <span>${pe.dragToMove.get()}:</span>\n            <span id="dragHub" style="font-size: 1.85rem;cursor: grab;">✠</span>\n        </label>\n    </div>\n    <div style="grid-column-start: 1; grid-column-end: 11; padding-left: 5px; text-align: left;">\n         <a id="show-guide-element" class="clickable" style="border: 1px dotted #fff; padding: 0px 3px;">${pe.showHelp.get()}</a>\n         <a id="show-keyboard-custom-element" class="clickable" style="border: 1px dotted #fff; padding: 0px 3px;">${pe.showKeyboard.get()}</a>\n         <a id="show-site-profiles-element" class="clickable" style="border: 1px dotted #fff; padding: 0px 3px;">${pe.showSiteProfiles.get()}</a>\n         <a id="show-style-custom-element" class="clickable" style="border: 1px dotted #fff; padding: 0px 3px;">${pe.showStyleCustom.get()}</a>\n         <a id="show-action-custom-element" class="clickable" style="border: 1px dotted #fff; padding: 0px 3px;">${pe.showActionCustom.get()}</a>\n         <a id="reset-config-element" class="clickable" style="border: 1px dotted #fff; padding: 0px 3px;">${pe.resetConfig.get()}</a>\n         <a class="clickable" style="border: 1px dotted #fff; padding: 0px 3px;" href="https://github.com/MapoMagpie/eh-view-enhance" target="_blank">${pe.letUsStar.get()}</a>\n    </div>\n</div>`}}class si{panel;root;thumbnail;thumbnailImg;thumbnailCanvas;listContainer;constructor(e){this.root=e,this.panel=k("#chapters-panel",e),this.thumbnail=k("#chapter-thumbnail",e),this.thumbnailImg=k("#chapter-thumbnail-image",e),this.thumbnailCanvas=k("#chapter-thumbnail-canvas",e),this.listContainer=k("#chapter-list",e),ye.subscribe("pf-update-chapters",(e,t)=>{this.updateChapterList(e),e.length>1&&!t&&this.relocateToCenter()}),ye.subscribe("pf-change-chapter",(e,t)=>this.updateHighlight(e,t))}updateChapterList(e){const t=this.listContainer.firstElementChild;t.innerHTML="",e.forEach((e,n)=>{const i=document.createElement("div");let a="";a=e.title instanceof Array?e.title.join("\t"):e.title,i.innerHTML=`<span>${a}</span>`,i.setAttribute("id","chapter-list-item-"+e.id.toString()),i.classList.add("chapter-list-item"),i.addEventListener("click",()=>{e.onclick?.(n),this.panel.classList.contains("p-panel-large")&&(this.panel.classList.add("p-collapse"),this.panel.classList.remove("p-panel-large"),this.panel.classList.remove("p-chapters-large"))}),i.addEventListener("mouseenter",()=>this.updateChapterThumbnail(e)),t.appendChild(i)}),this.updateChapterThumbnail(e[0])}relocateToCenter(){this.panel.classList.remove("p-collapse"),this.panel.classList.add("p-panel-large"),this.panel.classList.add("p-chapters-large");const[e,t]=[this.root.offsetWidth,this.root.offsetHeight],[n,i]=[this.panel.offsetWidth,this.panel.offsetHeight],[a,r]=[e/2-n/2,t/2-i/2];this.panel.style.left=a+"px",this.panel.style.top=r+"px"}updateHighlight(e,t){Array.from(this.listContainer.querySelectorAll("div > .chapter-list-item")).forEach((t,n)=>{n===e?t.classList.add("chapter-list-item-hl"):t.classList.remove("chapter-list-item-hl")}),this.updateChapterThumbnail(t)}updateChapterThumbnail(e){this.thumbnailImg.onload=()=>{const e=this.thumbnailImg.naturalWidth,t=this.thumbnailImg.naturalHeight;let[n,i,a,r]=[0,e,0,t];e>t?(n=Math.floor((e-t)/2),i=t):e<t&&(a=Math.floor((t-e)/2),r=e),this.thumbnailCanvas.width=i,this.thumbnailCanvas.height=r,this.thumbnailCanvas.getContext("2d").drawImage(this.thumbnailImg,n,a,i,r,0,0,e,t)},this.thumbnailImg.src=e.thumbimg??Ae,this.thumbnail.querySelector(".ehvp-chapter-description")?.remove();const t=document.createElement("div");t.classList.add("ehvp-chapter-description"),Array.isArray(e.title)?t.innerHTML=e.title.map(e=>`<span>${e}</span>`).join("<br>"):t.innerHTML=`<span>${e.title}</span>`,this.thumbnail.appendChild(t)}static html(){return`\n<div id="chapters-panel" class="p-panel p-chapters p-panel-large p-collapse">\n    <div id="chapter-thumbnail" class="chapter-thumbnail">\n      <div id="chapter-thumbnail-image-container" style="display:none;">\n        <img id="chapter-thumbnail-image" src="${Ae}" alt="thumbnail" />\n      </div>\n      <canvas id="chapter-thumbnail-canvas" width="100" height="100"></canvas>\n    </div>\n    <div id="chapter-list" class="chapter-list">\n      <div></div>\n    </div>\n</div>`}}class li{panel;root;filter;input;list;candidates;candidatasFragment;candidateSelectIndex=0;candidateCached=[];constructor(e,t){this.root=e,this.panel=k("#filter-panel",e),this.input=k("#tag-input",this.panel),this.list=k("#tag-list",this.panel),this.candidates=k("#tag-candidates",this.panel),this.candidatasFragment=document.createDocumentFragment(),this.filter=t,this.input.addEventListener("click",()=>ye.emit("filter-update-all-tags")),this.input.addEventListener("input",()=>{this.candidateSelectIndex=0,this.updateCandidates(!1)}),this.input.addEventListener("keyup",e=>{if(console.log("keypress ev: ",e),"arrowup"===e.key.toLowerCase())this.candidateSelectIndex=this.candidateSelectIndex-1,this.updateCandidates(!0),e.preventDefault();else if("arrowdown"===e.key.toLowerCase())this.candidateSelectIndex=this.candidateSelectIndex+1,this.updateCandidates(!0),e.preventDefault();else if("enter"===e.key.toLowerCase()){const e=this.candidateCached[this.candidateSelectIndex];this.input.value="",e&&(this.filter.push(!0,e),this.updateFilterValues()),this.candidates.hidden=!0}})}updateCandidates(e){if(0===this.input.value.length)return void(this.candidates.hidden=!0);const t=this.input.value.trim();if(e||(this.candidateCached=[...this.filter.allTags].filter(e=>!t||e.includes(t))),this.candidateCached.length>500)return void(this.candidates.hidden=!0);let n;this.candidateSelectIndex=Math.max(0,this.candidateSelectIndex),this.candidateSelectIndex=Math.min(this.candidateCached.length-1,this.candidateSelectIndex);for(let e=0;e<this.candidateCached.length;e++){const t=this.candidateCached[e],i=document.createElement("li");i.textContent=t.toString(),e===this.candidateSelectIndex&&(i.classList.add("tc-selected"),n=i),i.addEventListener("click",e=>{const t=e.target.textContent;t&&(this.input.value="",this.filter.push(!0,t),this.updateFilterValues(),this.candidates.hidden=!0)}),this.candidatasFragment.appendChild(i)}this.candidates.innerHTML="",this.candidates.append(...Array.from(this.candidatasFragment.childNodes)),this.candidates.hidden=!1,n?.scrollIntoView({block:"center"})}updateFilterValues(){this.list.innerHTML="";for(const e of this.filter.values){const t=document.createElement("li");t.textContent=e.tag,t.addEventListener("click",e=>{const t=e.target.textContent;t&&(this.filter.remove(t),this.updateFilterValues())}),this.list.appendChild(t)}}static html(){return'\n<div id="filter-panel" class="p-panel p-filter p-collapse">\n    <div style="position: relative;">\n      <input id="tag-input" class="tag-input" style="width:76%; margin-top:0.6em; margin-left: 12%;"/>\n      <div id="tag-candidates" style="position:absolute; width:100%; min-height:1em; max-height:15em; overflow:auto; background-color:#444; margin-top:0; top:100%;" hidden="true"></div>\n    </div>\n    <div>\n      <ul id="tag-list" class="tag-list">\n      <span>Filter the images, unfinished!</span>\n      </ul>\n    </div>\n</div>'}}class ci{html;chapterIndex=-1;pageNumInChapter=[];lastStage="exit";chapters;downloading;constructor(e,t,n){this.html=e,this.chapters=t,this.downloading=n,ye.subscribe("pf-change-chapter",e=>{let t=0;e>=0&&(t=this.pageNumInChapter[e]||0),this.chapterIndex=e;const[n,i]=(()=>{const t=this.chapters()[e]?.filteredQueue;if(!t)return[0,0];const n=t.filter(e=>e.stage===ie.DONE).length;return[t.length,n]})();this.setPageState({finished:i.toString(),total:n.toString(),current:(t+1).toString()}),this.minify(this.lastStage)}),ye.subscribe("bifm-on-show",()=>this.minify("bigImageFrame")),ye.subscribe("bifm-on-hidden",()=>this.minify("fullViewGrid")),ye.subscribe("ifq-do",(e,t)=>{if(t.chapterIndex!==this.chapterIndex)return;const n=this.chapters()[this.chapterIndex]?.filteredQueue;n&&(this.pageNumInChapter[this.chapterIndex]=e,this.setPageState({current:(e+1).toString()}))}),ye.subscribe("ifq-on-finished-report",(e,t)=>{t.chapterIndex===this.chapterIndex&&(this.setPageState({finished:t.finishedIndex.size.toString()}),u("info",`No.${e+1} Finished，Current index at No.${t.currIndex+1}`))}),ye.subscribe("pf-on-appended",(e,t,n,i)=>{this.chapterIndex>-1&&n!==this.chapterIndex||this.setPageState({total:`${e}${i?"":".."}`})}),e.currPageElement.addEventListener("click",e=>{const t=e.target,n=parseInt(t.textContent||"1")-1;if(this.chapterIndex>=0){const e=this.chapters()[this.chapterIndex]?.filteredQueue;if(!e||!e[n])return;ye.emit("imf-on-click",e[n])}})}setPageState({total:e,current:t,finished:n}){void 0!==e&&(this.html.totalPageElement.textContent=e),void 0!==t&&(this.html.currPageElement.textContent=t),void 0!==n&&(this.html.finishedElement.textContent=n)}minify(e,t=!1){function n(e,t=!1){switch(e){case 0:return t?["entry-btn","page-status","fin-status"]:["entry-btn"];case 1:return["page-status","fin-status","auto-page-btn","config-panel-btn","downloader-panel-btn","chapters-panel-btn","filter-panel-btn","entry-btn"];case 2:return["page-status","fin-status","auto-page-btn","config-panel-btn","downloader-panel-btn","chapters-panel-btn","entry-btn","read-mode-bar","pagination-adjust-bar","scale-bar"];case 3:return["page-status","auto-page-btn"]}return[]}this.lastStage=e;let i=[0,0];if("exit"===e)i=[0,0];else switch(e){case"fullViewGrid":i="never"===ve.conf.minifyPageHelper||"inBigMode"===ve.conf.minifyPageHelper||t?[1,1]:[3,1];break;case"bigImageFrame":i="never"===ve.conf.minifyPageHelper||t?[2,2]:[3,2]}const a=e=>"chapters-panel-btn"===e?this.chapters().length>1:"filter-panel-btn"===e?ve.conf.enableFilter:"auto-page-btn"===e&&3===i[0]?"playing"===this.html.pageHelper.querySelector("#auto-page-btn")?.getAttribute("data-status"):"pagination-adjust-bar"!==e||"pagination"===ve.conf.readMode,r=n(i[0],this.downloading()).filter(a),o=n(i[1],this.downloading()).filter(a),s=Array.from(this.html.pageHelper.querySelectorAll(".b-main > .b-main-item"));for(const e of s){const t=r.indexOf(e.id);e.style.order=-1===t?"99":t.toString(),e.style.opacity=-1===t?"0":"1",e.hidden=!o.includes(e.id)}const l=this.html.pageHelper.querySelector("#entry-btn"),c=l.getAttribute("data-display-texts").split(",");l.textContent="exit"===e?c[0]:c[1]}}const di='<svg width="1.4rem" height="1.4rem" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M106.854 106.002a26.003 26.003 0 0 0-25.64 29.326c16 124 16 117.344 0 241.344a26.003 26.003 0 0 0 35.776 27.332l298-124a26.003 26.003 0 0 0 0-48.008l-298-124a26.003 26.003 0 0 0-10.136-1.994z"/></svg>',hi='<svg width="1.4rem" height="1.4rem" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M16 9.50009L21 14.5001M21 9.50009L16 14.5001M4.6 9.00009H5.5012C6.05213 9.00009 6.32759 9.00009 6.58285 8.93141C6.80903 8.87056 7.02275 8.77046 7.21429 8.63566C7.43047 8.48353 7.60681 8.27191 7.95951 7.84868L10.5854 4.69758C11.0211 4.17476 11.2389 3.91335 11.4292 3.88614C11.594 3.86258 11.7597 3.92258 11.8712 4.04617C12 4.18889 12 4.52917 12 5.20973V18.7904C12 19.471 12 19.8113 11.8712 19.954C11.7597 20.0776 11.594 20.1376 11.4292 20.114C11.239 20.0868 11.0211 19.8254 10.5854 19.3026L7.95951 16.1515C7.60681 15.7283 7.43047 15.5166 7.21429 15.3645C7.02275 15.2297 6.80903 15.1296 6.58285 15.0688C6.32759 15.0001 6.05213 15.0001 5.5012 15.0001H4.6C4.03995 15.0001 3.75992 15.0001 3.54601 14.8911C3.35785 14.7952 3.20487 14.6422 3.10899 14.4541C3 14.2402 3 13.9601 3 13.4001V10.6001C3 10.04 3 9.76001 3.10899 9.54609C3.20487 9.35793 3.35785 9.20495 3.54601 9.10908C3.75992 9.00009 4.03995 9.00009 4.6 9.00009Z" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';class pi{ui;paused=!1;abort;elementID;root;constructor(e){this.root=e,this.ui=this.create(this.root),this.flushUI()}show(){this.ui.root.hidden=!1}hidden(){this.ui.root.hidden=!0}create(e){const t=document.createElement("div");return t.classList.add("bifm-vid-ctl"),t.innerHTML=`\n<div>\n  <button id="bifm-vid-ctl-play" class="bifm-vid-ctl-btn">${di}</button>\n  <button id="bifm-vid-ctl-mute" class="bifm-vid-ctl-btn">${hi}</button>\n    <div id="bifm-vid-ctl-volume" class="bifm-vid-ctl-pg">\n      <div class="bifm-vid-ctl-pg-inner" style="width: 30%"></div>\n    </div>\n  <span id="bifm-vid-ctl-time" class="bifm-vid-ctl-span">00:00</span>\n  <span class="bifm-vid-ctl-span">/</span>\n  <span id="bifm-vid-ctl-duration" class="bifm-vid-ctl-span">10:00</span>\n  \x3c!-- <span id = "bifm-vid-ctl-drag" class="bifm-vid-ctl-span" style = "cursor: grab;">✠</span> --\x3e\n</div>\n<div>\n    <div id="bifm-vid-ctl-pg" class="bifm-vid-ctl-pg">\n      <div class="bifm-vid-ctl-pg-inner" style="width: 30%"></div>\n    </div>\n</div>\n`,e.appendChild(t),{root:t,playBTN:k("#bifm-vid-ctl-play",t),volumeBTN:k("#bifm-vid-ctl-mute",t),volumeProgress:k("#bifm-vid-ctl-volume",t),progress:k("#bifm-vid-ctl-pg",t),time:k("#bifm-vid-ctl-time",t),duration:k("#bifm-vid-ctl-duration",t)}}flushUI(e,t){const{value:n,max:i}=e?{value:e.time,max:e.duration}:{value:0,max:10},a=n/i*100;this.ui.progress.firstElementChild.style.width=`${a}%`,this.ui.time.textContent=X(n),this.ui.duration.textContent=X(i),t||(this.ui.playBTN.innerHTML=this.paused?di:'<svg width="1.4rem" height="1.4rem" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M120.16 45A20.162 20.162 0 0 0 100 65.16v381.68A20.162 20.162 0 0 0 120.16 467h65.68A20.162 20.162 0 0 0 206 446.84V65.16A20.162 20.162 0 0 0 185.84 45h-65.68zm206 0A20.162 20.162 0 0 0 306 65.16v381.68A20.162 20.162 0 0 0 326.16 467h65.68A20.162 20.162 0 0 0 412 446.84V65.16A20.162 20.162 0 0 0 391.84 45h-65.68z"/></svg>',this.ui.volumeBTN.innerHTML=ve.conf.muted?hi:'<svg width="1.4rem" height="1.4rem" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path fill="#fff" d="M10.0012 8.99984H9.1C8.53995 8.99984 8.25992 8.99984 8.04601 9.10883C7.85785 9.20471 7.70487 9.35769 7.60899 9.54585C7.5 9.75976 7.5 10.0398 7.5 10.5998V13.3998C7.5 13.9599 7.5 14.2399 7.60899 14.4538C7.70487 14.642 7.85785 14.795 8.04601 14.8908C8.25992 14.9998 8.53995 14.9998 9.1 14.9998H10.0012C10.5521 14.9998 10.8276 14.9998 11.0829 15.0685C11.309 15.1294 11.5228 15.2295 11.7143 15.3643C11.9305 15.5164 12.1068 15.728 12.4595 16.1512L15.0854 19.3023C15.5211 19.8252 15.739 20.0866 15.9292 20.1138C16.094 20.1373 16.2597 20.0774 16.3712 19.9538C16.5 19.811 16.5 19.4708 16.5 18.7902V5.20948C16.5 4.52892 16.5 4.18864 16.3712 4.04592C16.2597 3.92233 16.094 3.86234 15.9292 3.8859C15.7389 3.9131 15.5211 4.17451 15.0854 4.69733L12.4595 7.84843C12.1068 8.27166 11.9305 8.48328 11.7143 8.63542C11.5228 8.77021 11.309 8.87032 11.0829 8.93116C10.8276 8.99984 10.5521 8.99984 10.0012 8.99984Z" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',this.ui.volumeProgress.firstElementChild.style.width=`${ve.conf.volume||30}%`)}attach(e){this.detach(),this.show(),this.abort=new AbortController;const t={time:e.currentTime,duration:e.duration};this.flushUI(t),e.addEventListener("timeupdate",e=>{const n=e.target;t&&(t.time=n.currentTime,this.flushUI(t,!0))},{signal:this.abort.signal}),e.onwaiting=()=>u("debug","onwaiting"),e.onended=()=>{e.currentTime=0,e.play()},e.muted=ve.conf.muted||!1,e.volume=Math.min(1,(ve.conf.volume||30)/100),this.paused||e.play(),this.elementID=e.id,this.elementID||(this.elementID="vid-"+Math.random().toString(36).slice(2),e.id=this.elementID),this.ui.playBTN.addEventListener("click",()=>{const e=this.getVideoElement();e&&(this.paused=!this.paused,this.paused?e.pause():e.play(),this.flushUI(t))},{signal:this.abort.signal}),this.ui.volumeBTN.addEventListener("click",()=>{const e=this.getVideoElement();e&&(ve.conf.muted=!ve.conf.muted,e.muted=ve.conf.muted,p({muted:e.muted}),this.flushUI(t))},{signal:this.abort.signal}),Z(this.ui.progress,e=>{const n=this.getVideoElement();n&&(n.currentTime=n.duration*(e/100),t.time=n.currentTime,this.flushUI(t))},this.abort.signal),Z(this.ui.volumeProgress,e=>{const n=this.getVideoElement();n&&(ve.conf.volume=Math.min(100,e),n.volume=Math.min(1,ve.conf.volume/100),p({volume:ve.conf.volume}),this.flushUI(t))},this.abort.signal)}detach(){const e=this.getVideoElement();e&&e.pause(),this.elementID=void 0,this.abort?.abort(),this.abort=void 0,this.flushUI(),this.hidden()}getVideoElement(){return this.root.querySelector(`#${this.elementID}`)}}class gi{element;scrolling=!1;step;distance=0;additional=0;lastDirection;directionChanged=!1;scrollMargin;maxScrollMargin;setScrollMargin;constructor(e,t,n){this.element=e,this.step=t||1,n&&"x"===n?(this.scrollMargin=()=>this.element.scrollLeft,this.maxScrollMargin=()=>this.element.scrollWidth-this.element.clientWidth,this.setScrollMargin=e=>this.element.scrollLeft=e):(this.scrollMargin=()=>this.element.scrollTop,this.maxScrollMargin=()=>this.element.scrollHeight-this.element.clientHeight,this.setScrollMargin=e=>this.element.scrollTop=e)}scroll(e,t){let n;t&&(this.step=t);const i=new Promise(e=>n=e);this.distance=Math.abs(e);const a=e<0?"up":"down";if(this.directionChanged=void 0!==this.lastDirection&&this.lastDirection!==a,this.scrolling||this.distance<=0)return i;const r=e/this.distance;this.lastDirection=a,this.additional=0,this.scrolling=!0;const o=()=>{this.scrolling=!1,this.directionChanged=!1,this.lastDirection=void 0,this.distance=0,n?.()},s=()=>{if(!this.scrolling)return o();this.distance-=this.step+this.additional;let e=this.scrollMargin()+(this.step+this.additional)*r;if(e=Math.max(e,0),e=Math.min(e,this.maxScrollMargin()),this.setScrollMargin(e),this.distance<=0||this.directionChanged||0===e||e===this.maxScrollMargin())return o();window.requestAnimationFrame(s)};return window.requestAnimationFrame(s),i}}class ui{id;x;y;constructor(e,t,n){this.id=e,this.x=t,this.y=n}static from(e){return new ui(e.identifier,e.clientX,e.clientY)}distance(e){return K({x:this.x,y:this.y},{x:e.x,y:e.y})}direction(e){const t=this.x-e.x,n=this.y-e.y;return Math.abs(t)>Math.abs(n)?t>0?"L":"R":n>0?"U":"D"}}class mi{element;trail={};handlers;constructor(e,t){this.element=e,this.handlers=t,this.element.addEventListener("touchstart",e=>this.start(e)),this.element.addEventListener("touchmove",e=>this.move(e)),this.element.addEventListener("touchend",e=>this.end(e))}start(e){const t=Array.from(e.targetTouches).map(ui.from);this.trail=t.reduce((e,t)=>(e[t.id]=[t],e),{});let n=0;2===t.length&&(n=t[0].distance(t[1])),this.handlers.start?.(n,e)}move(e){const t=Array.from(e.targetTouches).map(ui.from);if(t.forEach(e=>{const t=this.trail[e.id];t[t.length-1].distance(e)>30&&t.push(e)}),2===Object.keys(this.trail).length&&2===t.length){const n=t[0],i=t[1];return void this.handlers.zoom?.(n.distance(i),e)}}end(e){const t=Object.keys(this.trail).map(Number);if(1===t.length&&this.trail[t[0]].length>1){const n=this.trail[t[0]];let i;for(let e=0,t=1;t<n.length;e++,t++)if(i){if(n[e].direction(n[t])!==i)return}else i=n[e].direction(n[t]);this.handlers.swipe?.(i,e)}if(2===t.length){const n=this.trail[t[0]],i=this.trail[t[1]];if(n.length>1&&i.length>1){const t=[n[0],n[n.length-1]],a=[i[0],i[i.length-1]],{angle:r,clockwise:o}=function(e,t){if(2!==e.length||2!==t.length)throw new Error("line1 or line2 length must be 2");[e,t].forEach(([e,t])=>{if(e.x===t.x&&e.y===t.y)throw new Error(`start at ${e.toString()}, end at ${t.toString()}, not line`)});const n=e[1].x-e[0].x,i=e[1].y-e[0].y,a=t[1].x-t[0].x,r=t[1].y-t[0].y,o=(n*a+i*r)/(Math.sqrt(n**2+i**2)*Math.sqrt(a**2+r**2)),s=n*r-i*a<=0;return{angle:Math.acos(o)*(180/Math.PI),clockwise:s}}(t,a);this.handlers.rotate?.(o,r,e)}}this.trail={},this.handlers.end?.(e)}}class fi{root;container;observer;intersectingElements=[];renderingElements=[];currentIndex=0;preventStep={currentPreventFinished:!1};debouncer;callbackOnWheel;visible=!1;html;vidController;chapterIndex=0;getChapter;loadingHelper;currLoadingState=new Map;scrollerY;scrollerX;lastMouse;pageNumInChapter=[];oriented="next";intersectingIndexLock=!1;constructor(e,t){switch(this.html=e,this.root=e.bigImageFrame,this.debouncer=new Ce,this.getChapter=t,this.scrollerY=new gi(this.root),this.scrollerX=new gi(this.root,void 0,"x"),this.container=document.createElement("div"),this.container.classList.add("bifm-container"),ve.conf.readMode){case"continuous":this.container.classList.add("bifm-container-vert");break;case"pagination":this.container.classList.add("bifm-container-page");break;case"horizontal":this.container.classList.add("bifm-container-hori")}this.observer=new IntersectionObserver(e=>this.intersecting(e),{root:this.root}),this.root.appendChild(this.container),this.initEvent(),ye.subscribe("pf-on-appended",(e,t,n)=>{n===this.chapterIndex&&this.append(t)}),ye.subscribe("pf-change-chapter",e=>{this.chapterIndex=Math.max(0,e),this.container.innerHTML=""}),ye.subscribe("imf-on-click",e=>this.show(e)),ye.subscribe("imf-on-finished",(e,t,n)=>{if(n.chapterIndex!==this.chapterIndex)return;if(this.currLoadingState.delete(e),this.debouncer.addEvent("FLUSH-LOADING-HELPER",()=>this.flushLoadingHelper(),20),!t)return;const i=this.renderingElements.find(t=>Y(t)===e);i&&(i.innerHTML="",i.appendChild(this.newMediaNode(n)))}),ye.subscribe("imf-resize",e=>{e.chapterIndex===this.chapterIndex&&this.onResize(e)}),ye.subscribe("bifm-rotate-image",()=>this.rotate(!0)),this.loadingHelper=document.createElement("span"),this.loadingHelper.id="bifm-loading-helper",this.root.appendChild(this.loadingHelper),ye.subscribe("imf-download-state-change",e=>{if(e.chapterIndex!==this.chapterIndex)return;const[t,n]=[this.currentIndex,this.currentIndex+("pagination"!==ve.conf.readMode?1:ve.conf.paginationIMGCount)];e.index<t||e.index>=n||(this.currLoadingState.set(e.index,Math.floor(e.downloadState.loaded/e.downloadState.total*100)),this.debouncer.addEvent("FLUSH-LOADING-HELPER",()=>this.flushLoadingHelper(),20))}),new bi(this,e.autoPageBTN)}onResize(e){const t=this.container.querySelector(`div[d-index="${e.index}"]`),n=this.container.querySelector(`div[d-index="${this.currentIndex}"]`);if(t&&n)if("continuous"===ve.conf.readMode){const i=n.offsetTop,a=this.root.scrollTop;t.style.aspectRatio=e.ratio().toString(),i!==n.offsetTop&&(this.root.scrollTop=n.offsetTop+(i-a))}else{const i=n.offsetLeft,a=this.root.scrollLeft;t.style.aspectRatio=e.ratio().toString(),"pagination"===ve.conf.readMode&&e.index===this.currentIndex?this.jumpTo(this.currentIndex):i!==n.offsetLeft&&(this.root.scrollLeft=n.offsetLeft-(i-a))}}intersecting(e){for(const t of e)if(t.isIntersecting){const e=t.target;if(-1===Y(e))continue;this.intersectingElements.push(e)}else{const e=this.intersectingElements.indexOf(t.target);e>-1&&this.intersectingElements.splice(e,1)}if(this.intersectingIndexLock){if(!this.intersectingElements.find(e=>this.currentIndex===Y(e)))return;this.intersectingIndexLock=!1}this.debouncer.addEvent("rendering-images",()=>this.rendering(),50)}rendering(){const e=this.intersectingElements.map(e=>({index:Y(e),elem:e}));e.filter(e=>e.index>-1).sort((e,t)=>e.index-t.index),ve.conf.reversePages&&e.reverse();const t=e.map(e=>e.elem);if(0===t.length)return;let n=t[0],[i,a]=[0,ve.conf.paginationIMGCount];for(;(n=n.previousElementSibling)&&i<a;)t.unshift(n),i++;for(n=t[t.length-1],i=0;(n=n.nextElementSibling)&&i<a;)t.push(n),i++;const r=[],o=[];for(const e of this.renderingElements)t.includes(e)?o.push(e):r.push(e);r.forEach(e=>e.innerHTML="");for(const e of t)if(!o.includes(e)){e.innerHTML="";const t=this.getIMF(e);t&&e.appendChild(this.newMediaNode(t))}this.renderingElements=t}getIMF(e){const t=Y(e);return-1===t||isNaN(t)?null:this.getChapter(this.chapterIndex).filteredQueue[t]??null}initEvent(){this.root.addEventListener("wheel",e=>this.onWheel(new WheelEvent("wheel",{deltaY:ve.conf.scrollingDelta*(e.deltaY<0?-1:1),buttons:e.buttons,button:e.button}),void 0,void 0,void 0,e)),this.root.addEventListener("scroll",e=>this.onScroll(e),{passive:!1}),this.root.addEventListener("contextmenu",e=>{e.preventDefault()}),this.root.addEventListener("mousedown",e=>{if(0!==e.button)return;if(e.target.classList.contains("img-land"))return;let t=!1;const n={x:e.clientX,y:e.clientY};let i,a={x:e.clientX,y:e.clientY};const r=new AbortController,[o,s]=[this.root.scrollTop,this.root.scrollLeft];this.root.addEventListener("mouseup",e=>{r.abort(),t?ve.conf.magnifier&&100===ve.conf.imgScale&&(this.scaleBigImages(1,0,ve.conf.imgScale,!1),[this.root.scrollTop,this.root.scrollLeft]=[o,s]):this.hidden(e),t=!1},{once:!0}),this.root.addEventListener("mousemove",e=>{if(ve.conf.dragImageOut)t=!0;else if(!ge){if(!t){if(K(n,{x:e.clientX,y:e.clientY})<20)return;if(ve.conf.magnifier&&100===ve.conf.imgScale&&this.scaleBigImages(1,0,150,!1),"pagination"===ve.conf.readMode){const e=this.intersectingElements;e.length>0&&(i=e[e.length-1].offsetLeft+e[e.length-1].offsetWidth-e[0].offsetLeft)}}t=!0,this.debouncer.addEvent("BIG-IMG-MOUSE-MOVE",()=>{!function(e,t,n,i){let[a,r]=[t.clientY-n.y,t.clientX-n.x];[a,r]=[-a,-r];const o=e.scrollHeight-e.offsetHeight;if(o>0){const t="continuous"===ve.conf.readMode?1:o/(e.offsetHeight/4)*3;let n=e.scrollTop+a*t;n=Math.max(n,0),n=Math.min(n,o),e.scrollTop=n}const s=(i??e.scrollWidth)-e.offsetWidth;if(s>0){const t="pagination"!==ve.conf.readMode?1:s/(e.offsetWidth/4)*3;let n=e.scrollLeft+r*t;e.scrollLeft=n}}(this.root,e,a,i),a={x:e.clientX,y:e.clientY}},5)}},{signal:r.signal})}),new mi(this.root,{start:()=>{"pagination"===ve.conf.readMode&&(this.root.style.overflow="hidden")},swipe:e=>{"continuous"!==ve.conf.readMode&&"horizontal"!==ve.conf.readMode&&(this.oriented=(()=>{switch(e){case"L":return ve.conf.reversePages?"next":"prev";case"R":return ve.conf.reversePages?"prev":"next";case"U":return"next";case"D":return"prev"}})(),this.callbackOnWheel?.(),this.stepNext(this.oriented),"pagination"===ve.conf.readMode&&(this.root.style.overflow=""))},rotate:()=>{}})}cherryPickCurrent(e){ye.emit("add-cherry-pick-range",this.chapterIndex,this.currentIndex,!e,!1);const t="pagination"===ve.conf.readMode&&ve.conf.paginationIMGCount>1,n=this.currentIndex+ve.conf.paginationIMGCount-1;t&&ye.emit("add-cherry-pick-range",this.chapterIndex,n,!e,!0);const i=`${e?"Excluded":"Selected"} Image${t?"s":""} no.${this.currentIndex+1}${t?"-"+(n+1):""}`;ye.emit("notify-message","info",i,1e3)}rotate(e){const t=["bifm-rotate-90","bifm-rotate-180","bifm-rotate-270",""];e||t.reverse();let n=t.findIndex(e=>this.root.classList.contains(e));-1===n?n=e?3:0:this.root.classList.remove(t[n]);const i=(n+1)%4;""!==t[i]&&this.root.classList.add(t[i])}scrollStop(){this.scrollerY.scrolling=!1,this.scrollerX.scrolling=!1}hidden(e){e&&e.target&&"SPAN"===e.target.tagName||(this.visible=!1,ye.emit("bifm-on-hidden"),this.html.fullViewGrid.focus(),this.vidController?.detach(),this.root.classList.add("big-img-frame-collapse"),this.renderingElements.forEach(e=>e.innerHTML=""),this.renderingElements=[],this.intersectingIndexLock=!1)}show(e){this.visible=!0,this.currentIndex=e.index,this.intersectingIndexLock=!0,this.root.classList.remove("big-img-frame-collapse"),this.root.focus(),this.debouncer.addEvent("TOGGLE-CHILDREN-D",()=>e.chapterIndex===this.chapterIndex&&this.setNow(e),100),ye.emit("bifm-on-show")}setNow(e){this.currentIndex=e.index,this.pageNumInChapter[this.chapterIndex]=e.index,this.visible&&this.jumpTo(e.index),ye.emit("ifq-do",e.index,e,this.oriented??"next"),this.lastMouse=void 0,this.currLoadingState.clear(),this.flushLoadingHelper()}append(e){if("pagination"===ve.conf.readMode)return;const t=[],n=this.root.scrollWidth;for(const n of e){const e=document.createElement("div");e.style.aspectRatio=n.ratio().toString(),e.setAttribute("d-index",n.index.toString()),t.push(e),this.observer.observe(e)}const i="continuous"!==ve.conf.readMode&&ve.conf.reversePages;if(0===this.container.childElementCount){const e=window.innerWidth/window.innerHeight,n=document.createElement("div");n.style.aspectRatio=e.toString(),n.setAttribute("d-index","-1"),t.unshift(n);const i=document.createElement("div");i.style.aspectRatio=e.toString(),i.setAttribute("d-index","-1"),t.push(i)}else t.push(i?this.container.firstElementChild:this.container.lastElementChild);i?(t.reverse(),this.container.prepend(...t),this.root.scrollLeft=this.root.scrollLeft+this.root.scrollWidth-n):this.container.append(...t)}changeLayout(){switch(this.resetScaleBigImages(!0),ve.conf.readMode){case"continuous":this.container.classList.remove("bifm-container-hori","bifm-container-vert","bifm-container-page"),this.container.classList.add("bifm-container-vert");break;case"pagination":this.container.classList.remove("bifm-container-hori","bifm-container-vert","bifm-container-page"),this.container.classList.add("bifm-container-page");break;case"horizontal":this.container.classList.remove("bifm-container-hori","bifm-container-vert","bifm-container-page"),this.container.classList.add("bifm-container-hori")}this.container.innerHTML="",this.intersectingElements=[],this.renderingElements=[];const e=this.getChapter(this.chapterIndex).filteredQueue;this.append(e),this.jumpTo(this.currentIndex)}jumpTo(e){switch(ve.conf.readMode){case"pagination":{const e=this.setElements();this.container.offsetWidth>this.root.offsetWidth&&(ve.conf.reversePages?this.root.scrollLeft=this.container.offsetWidth-this.root.offsetWidth:this.root.scrollLeft=0),this.root.scrollTop=0,e[0].firstElementChild&&this.tryPlayVideo(e[0].firstElementChild);break}case"horizontal":{const t=this.container.querySelector(`div[d-index="${e}"]`);if(!t)return;ve.conf.reversePages?this.root.scrollLeft=t.offsetLeft-this.root.offsetWidth+t.offsetWidth:this.root.scrollLeft=t.offsetLeft;break}case"continuous":{const t=this.container.querySelector(`div[d-index="${e}"]`);if(!t)return;const n=this.root.offsetHeight,i=t.offsetHeight;let a=0===e?0:Math.floor((n-i)/2);a=Math.max(0,a),this.root.scrollTop=t.offsetTop-a;break}}}stepNext(e,t=0,n){this.oriented=e;let i=n||this.currentIndex;if(void 0===i||isNaN(i))return;const a=this.getChapter(this.chapterIndex)?.filteredQueue;a&&0!==a.length&&(i="next"===e?i+ve.conf.paginationIMGCount:i-ve.conf.paginationIMGCount,ve.conf.paginationIMGCount>1&&(i+=t),i=i<-ve.conf.paginationIMGCount?a.length-1:Math.max(0,i),a[i]&&(this.resetPreventStep(),this.setNow(a[i])))}checkCurrent(){const e=this.root.getBoundingClientRect(),t="continuous"===ve.conf.readMode?(e,t)=>e.top<=t.height/2&&e.bottom>=t.height/2:(e,t)=>e.left<=t.width/2&&e.right>=t.width/2;for(const n of this.intersectingElements)if(t(n.getBoundingClientRect(),e)){const e=this.getIMF(n);if(null===e)continue;if(e.index===this.currentIndex)continue;ye.emit("ifq-do",e.index,e,this.oriented),this.currentIndex=e.index,this.pageNumInChapter[this.chapterIndex]=e.index,n.firstElementChild&&this.tryPlayVideo(n.firstElementChild);break}}onScroll(e){switch(ve.conf.readMode){case"continuous":{const[e,t]=[this.container.children.item(1),this.container.children.item(this.container.children.length-2)];let n=e.offsetTop??0;this.root.scrollTop<n-3?this.root.scrollTop=n-2:(n=t?t.offsetTop+t.offsetHeight-this.root.offsetHeight:this.root.scrollHeight,this.root.scrollTop>n+3&&(this.root.scrollTop=n+2));break}case"pagination":break;case"horizontal":{const[e,t]=[this.container.children.item(1),this.container.children.item(this.container.children.length-2)];let n=e?.offsetLeft??0;this.root.scrollLeft<n-3?this.root.scrollLeft=n-2:(n=t?t.offsetLeft+t.offsetWidth-this.root.offsetWidth:this.root.scrollWidth,this.root.scrollLeft>n+3&&(this.root.scrollLeft=n+2));break}}"pagination"!==ve.conf.readMode&&this.debouncer.addEvent("bifm-on-wheel",()=>this.checkCurrent(),69)}onWheel(e,t,n,i,a){const r=()=>{e.preventDefault(),a?.preventDefault()};if(i||this.callbackOnWheel?.(),2===e.buttons)return r(),void this.scaleBigImages(e.deltaY>0?-1:1,5);const[o,s]=e.deltaY>0?["next","prev"]:["prev","next"];switch(this.oriented=o,ve.conf.readMode){case"pagination":{const i=this.checkOverflow(),[a,o]=ve.conf.reversePages?[s,this.oriented]:[this.oriented,s];if(this.root.classList.contains("bifm-rotate-90")||this.root.classList.contains("bifm-rotate-270")){this.stepNext(this.oriented);break}if(i[this.oriented].overY-1<=0&&i[a].overX-1<=0){if(r(),!t&&(i[o].overX>0||i[s].overY>0)&&this.tryPreventStep())break;this.stepNext(this.oriented);break}let l="next"===this.oriented?1:-1;n&&i[this.oriented].overY>0&&this.scrollerY.scroll(Math.min(i[this.oriented].overY,Math.abs(3*e.deltaY))*l,Math.abs(Math.ceil(e.deltaY/4))),l*=ve.conf.reversePages?-1:1,i[this.oriented].overY-1<=0&&i[a].overX>0&&this.scrollerX.scroll(Math.min(i[a].overX,Math.abs(3*e.deltaY))*l,Math.abs(Math.ceil(e.deltaY/4)));break}case"horizontal":r(),this.scrollerX.scroll(e.deltaY*(ve.conf.reversePages?-1:1),ve.conf.scrollingSpeed);break;case"continuous":n&&this.scrollerY.scroll(e.deltaY,ve.conf.scrollingSpeed)}}resetPreventStep(e){this.preventStep.ani?.cancel(),this.preventStep.ele?.remove(),this.preventStep={currentPreventFinished:e??!1}}tryPreventStep(){if(0===ve.conf.preventScrollPageTime)return!1;if(this.preventStep.currentPreventFinished)return this.resetPreventStep(),!1;if(!this.preventStep.ele){const e=document.createElement("div");if(e.style.width="100vw",e.style.position="fixed",e.style.display="flex",e.style.justifyContent="center",e.style.bottom="0px",e.innerHTML='<div style="width: 30vw;height: 0.1rem;background-color: #1b00ff59;text-align: center;font-size: 0.8rem;position: relative;font-weight: 800;color: gray;border-radius: 7px;border: 1px solid #510000;"><span style="position: absolute;bottom: -3px;"></span></div>',this.root.appendChild(e),this.preventStep.ele=e,ve.conf.preventScrollPageTime>0){const t=e.children[0].animate([{width:"30vw"},{width:"0vw"}],{duration:ve.conf.preventScrollPageTime});t.onfinish=()=>this.preventStep.ele&&this.resetPreventStep(!0),this.preventStep.ani=t}this.preventStep.currentPreventFinished=!1}return!0}checkOverflow(){const e=Array.from(this.container.querySelectorAll("div:not(.bifm-node-hide)"));if(0===e.length)return{prev:{overX:0,overY:0},next:{overX:0,overY:0},elements:[]};const t=this.root.getBoundingClientRect().left,n=e[0].getBoundingClientRect(),i=e[e.length-1].getBoundingClientRect();return{prev:{overX:-1*Math.round(n.left)+t,overY:-1*Math.round(n.top)},next:{overX:Math.round(i.right)-this.root.offsetWidth,overY:Math.round(n.bottom)-this.root.offsetHeight},elements:e}}restoreScrollTop(e,t){this.root.scrollTop=this.getRealOffsetTop(e)-t}getRealOffsetTop(e){return e.offsetTop}newMediaNode(e){if(e.contentType?.startsWith("video")){const t=document.createElement("video");return t.classList.add("bifm-img"),t.classList.add("bifm-vid"),t.draggable=ve.conf.dragImageOut,t.onloadeddata=()=>{this.visible&&e.index===this.currentIndex&&this.tryPlayVideo(t)},t.src=e.node.blobSrc,t}{const t=document.createElement("img");return t.decoding="async",t.classList.add("bifm-img"),t.draggable=ve.conf.dragImageOut,e.stage===ie.DONE?t.src=e.node.blobSrc:e.node.thumbnailSrc?t.src=e.node.thumbnailSrc:t.src=Ae,t}}tryPlayVideo(e){e instanceof HTMLVideoElement?(this.vidController||(this.vidController=new pi(this.html.root)),this.vidController.attach(e)):this.vidController?.detach()}scaleBigImages(e,t,n,i){let a=ve.conf.imgScale,r=n??a+t*e;switch(ve.conf.readMode){case"pagination":{const e=j(this.html.styleSheet,".bifm-container-page");if(r=Math.max(r,100),r=Math.min(r,300),e&&(e.style.height=`${r}%`),1===ve.conf.paginationIMGCount){const e=j(this.html.styleSheet,".bifm-container-page .bifm-img");e&&(e.style.maxWidth=r>100?"":"100%")}}break;case"horizontal":{const e=this.root.scrollLeft,t=j(this.html.styleSheet,".bifm-container-hori");r=Math.max(r,80),r=Math.min(r,300),t&&(t.style.height=`${r}%`),this.root.scrollLeft=e*(r/a)}break;case"continuous":{const e=this.root.scrollTop,t=j(this.html.styleSheet,".bifm-container-vert");r=Math.max(r,20),r=Math.min(r,100),t&&(t.style.width=`${r}%`),this.root.scrollTop=e*(r/a)}}return(i??1)&&(ve.conf.imgScale=r,p({imgScale:r},ve.matcher.name)),k("#scaleInput",this.html.pageHelper).textContent=`${r}`,r}resetScaleBigImages(e){const t="continuous"!==ve.conf.readMode||ge?100:ve.conf.defaultImgScaleModeC;this.scaleBigImages(1,0,t,e)}flushLoadingHelper(){if(0===this.currLoadingState.size)this.loadingHelper.style.display="none";else{"none"===this.loadingHelper.style.display&&(this.loadingHelper.style.display="inline-block");const e=Array.from(this.currLoadingState).map(([e,t])=>`[P-${e+1}: ${t}%]`);ve.conf.reversePages&&e.reverse(),this.loadingHelper.textContent=`Loading ${e.join(",")}`}}getPageNumber(){return this.pageNumInChapter[this.chapterIndex]??0}setElements(){let e=Array.from(this.container.childNodes);const t=3*ve.conf.paginationIMGCount;if(e.length>t)e.splice(t).forEach(e=>e.remove());else for(;e.length<t;){const t=document.createElement("div");e.push(t)}const n=this.getChapter(this.chapterIndex).filteredQueue;let[i,a]=[this.currentIndex-ve.conf.paginationIMGCount,this.currentIndex+2*ve.conf.paginationIMGCount-1];[i,a]=[Math.max(i,0),Math.min(a,n.length-1)];const r=e.map(e=>({index:Y(e),elem:e})).sort((e,t)=>e.index-t.index),o=e=>{let t=r.findIndex(t=>t.index===e);if(t>-1)return[r.splice(t,1)[0].elem,!1];if(t=r.findIndex(e=>e.index<i||e.index>a),-1===t)return[null,!1];const n=r.splice(t,1)[0];return n.elem.setAttribute("d-index",e.toString()),[n.elem,!0]};e=[];const s=[];for(let t=i;t<=a;t++){const[i,a]=o(t);if(!i)throw new Error(`BIFM.setElements cannot found element by index:[${t}], or found empty element`);const r=t>=this.currentIndex&&t<this.currentIndex+ve.conf.paginationIMGCount;e.push(i),r?(i.classList.remove("bifm-node-hide"),s.push(i)):i.classList.add("bifm-node-hide"),(a||0===i.childElementCount)&&(i.style.aspectRatio="",i.innerHTML="",i.appendChild(this.newMediaNode(n[t])))}ve.conf.reversePages&&e.reverse(),this.renderingElements=[...e];const l=r.map(e=>(e.elem.setAttribute("d-index","-1"),e.elem.innerHTML="",e.elem.classList.add("bifm-node-hide"),e.elem));return e.push(...l),this.container.append(...e),s}}class bi{bifm;status;button;lockVer;constructor(e,t){this.bifm=e,this.status="stop",this.button=t,this.lockVer=0,this.bifm.callbackOnWheel=()=>{"running"===this.status&&(this.stop(),this.start(this.lockVer))},ye.subscribe("bifm-on-hidden",()=>this.stop()),ye.subscribe("bifm-on-show",()=>ve.conf.autoPlay&&this.start(this.lockVer)),ye.subscribe("toggle-auto-play",()=>{"stop"===this.status?this.start(this.lockVer):this.stop()}),this.initPlayButton()}initPlayButton(){this.button.addEventListener("click",()=>{"stop"===this.status?this.start(this.lockVer):this.stop()})}async start(e){this.status="running",this.button.setAttribute("data-status","playing");const t=this.button.getAttribute("data-display-texts").split(",");if(this.button.firstElementChild.innerText=t[1],!this.bifm.visible){const e=this.bifm.getChapter(this.bifm.chapterIndex).filteredQueue;if(0===e.length)return;this.bifm.show(e[this.bifm.currentIndex])}const n=k("#auto-page-progress",this.button),i=()=>"pagination"===ve.conf.readMode?ve.conf.autoPageSpeed:1;for(;;){if(await w(10),n.style.animation=1e3*i()+"ms linear main-progress",await w(1e3*i()),this.lockVer!==e)return;if(n.style.animation="","running"!==this.status)break;const t=this.bifm.getChapter(this.bifm.chapterIndex).filteredQueue;if(this.bifm.currentIndex<0||this.bifm.currentIndex>=t.length)break;if("pagination"===ve.conf.readMode){const e=this.bifm.container.querySelector(`div[d-index="${this.bifm.currentIndex}"]`)?.firstElementChild;if(e instanceof HTMLVideoElement){let t;const n=new Promise(e=>t=e);e.addEventListener("timeupdate",()=>{e.currentTime>=e.duration-1&&w(1e3).then(t)}),await n}}const a=this.bifm.root.offsetHeight/2;this.bifm.onWheel(new WheelEvent("wheel",{deltaY:a}),!0,!0,!0)}this.stop()}stop(){this.status="stop",this.button.setAttribute("data-status","paused"),k("#auto-page-progress",this.button).style.animation="",this.lockVer+=1;const e=this.button.getAttribute("data-display-texts").split(",");this.button.firstElementChild.innerText=e[0],this.bifm.scrollStop()}}class wi{values=[];allTags=new Set;onChange;filterNodes(e,t){if(!ve.conf.enableFilter)return e;let n=e;for(const e of this.values)n=n.filter(t=>{for(const n of t.node.tags)if(n===e.tag)return!0;return!1});return t&&this.allTags.clear(),n.forEach(e=>e.node.tags.forEach(e=>this.allTags.add(e))),n}push(e,t){this.values.find(e=>e.tag===t)||(this.values.push({exclude:e,tag:t}),this.onChange?.(this))}remove(e){const t=this.values.findIndex(t=>t.tag===e);t>-1&&(this.values.splice(t,1),this.onChange?.(this))}clear(){this.values=[],this.onChange?.(this)}}const vi=Object.assign({"./platform/matchers/18comic.ts":Oe,"./platform/matchers/3hentai.ts":Ue,"./platform/matchers/akuma.ts":ze,"./platform/matchers/arca.ts":Fe,"./platform/matchers/artstation.ts":je,"./platform/matchers/asmhentai.ts":Ge,"./platform/matchers/bilibili.ts":Ze,"./platform/matchers/colamanga.ts":Ye,"./platform/matchers/danbooru.ts":it,"./platform/matchers/eahentai.ts":rt,"./platform/matchers/ehentai.ts":lt,"./platform/matchers/hanime1.ts":dt,"./platform/matchers/hentainexus.ts":ut,"./platform/matchers/hentaizap.ts":bt,"./platform/matchers/hitomi.ts":It,"./platform/matchers/im-hentai.ts":_t,"./platform/matchers/instagram.ts":kt,"./platform/matchers/kemono.ts":$t,"./platform/matchers/konachan.ts":Ut,"./platform/matchers/mangacopy.ts":Dt,"./platform/matchers/mangapark.ts":Vt,"./platform/matchers/mangatoto.ts":Ht,"./platform/matchers/manhuagui.ts":Kt,"./platform/matchers/miniserve.ts":Jt,"./platform/matchers/mycomic.ts":en,"./platform/matchers/nhentai.ts":an,"./platform/matchers/niyaniya.ts":cn,"./platform/matchers/pixiv.ts":In,"./platform/matchers/rokuhentai.ts":_n,"./platform/matchers/steam.ts":En,"./platform/matchers/twitter.ts":Mn,"./platform/matchers/wnacg.ts":$n,"./platform/matchers/yabai.ts":qn,"./platform/matchers/yandere.ts":zn});for(const e in vi)vi[e];let yi;const Ci=new Ce;setTimeout(()=>{const e=history.pushState;history.pushState=function(...t){return Q(),e.apply(this,t)};const t=history.replaceState;history.replaceState=function(...e){return t.apply(this,e)},window.addEventListener("popstate",Q),Q()},300)}(pica,zip,saveAs);