// ==UserScript==
// @name		手机浏览器触摸手势
// @name:en		Mobile browser touch gestures
// @version		10.1.0
// @author		L.Xavier
// @namespace	https://greasyfork.org/zh-CN/users/128493
// @match		*://*/*
// @license		MIT
// @grant		window.close
// @grant		GM_setValue
// @grant		GM_getValue
// @grant		GM_openInTab
// @grant		GM_setClipboard
// @run-at		document-start
// @downloadURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/E6898BE69CBAE6B58FE8A788E599A8E8A7A6E691B8E6898BE58ABF.user.js
// @updateURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/E6898BE69CBAE6B58FE8A788E599A8E8A7A6E691B8E6898BE58ABF.meta.js
// ==/UserScript==
function e(){if(S&&!/[●○▽]$/.test(u.path)){S=P=0,v=u.touchEnd;let e=u.path+"○";u.path+="●",u.runGesture(e)}}function t(){D=0;let e=u.path+"▽";u.path+="▼",u.runGesture(e),u.path=u.path.replace("▼","")}function i(t){if(clearTimeout(B),E===t.touches?.length&&(window._isPushing_=null,/[○▽]$/.test(u.path)&&u.runGesture(),u.path=""),1!==(E=t.touches?.length))return;b=Date.now(),y=b-x;let i=x&&(t.changedTouches[0].screenX-u.touchEnd.screenX)**2+(t.changedTouches[0].screenY-u.touchEnd.screenY)**2;if(y>50||i>m){if(v=t.changedTouches[0],y>180||i>4*m){if(u.path="",T=m,u.touchEle=t.target,u.touchEnd=u.touchStart=v,!u.iframeSelect||window.getSelection()+""?u.selectWords=window.getSelection()+"":u.selectWords=u.iframeSelect,u.selectWords&&u.settings["文字手势"])u.path="T";else if(document.contains(u.videoPlayer)&&u.settings["视频手势"]){let e=u.findVideoBox()?.getBoundingClientRect()||new DOMRect;I>0&&u.touchStart.clientY<e.y+e.height/8?u.path="!":u.touchStart.clientX>e.x&&u.touchStart.clientX<e.x+e.width&&u.touchStart.clientY>e.y&&u.touchStart.clientY<e.y+e.height&&(u.path="V")}}else P&&t.preventDefault();w=b,S=P=1}else P&&(u.path=u.path.slice(0,-1));B=setTimeout(e,300+w-b)}function o(i){if(clearTimeout(B),u.touchEnd=i.changedTouches?i.changedTouches[0]:i,window._isPushing_&&setTimeout(window._isPushing_),/[○▽]$/.test(u.path)||E>1)return;let o=(u.touchEnd.screenX-v.screenX)**2,n=(u.touchEnd.screenY-v.screenY)**2,a=o>1.42*n?u.touchEnd.screenX>v.screenX?"→":"←":u.touchEnd.screenY>v.screenY?"↓":"↑",r=Date.now(),s=o+n,d=u.path?.slice(-1);s>m/100?(w=r,P=0,d===a||s>T?(d!==a&&(y<50||"TIV◆".indexOf(d)>-1)&&(u.path+=a,T*=T<m/2||.64,D=r+300,S=1,y=0),v=u.touchEnd,D&&r>D&&setTimeout(t)):s>T/16&&(D=S=0)):s>4&&(P=0),B=setTimeout(e,300+w-r)}function n(e){clearTimeout(B),--E>0?/[○▽]$/.test(u.path)||(u.path="!"):(window._isPushing_=null,u.touchEnd=e.changedTouches[0],x=Date.now(),top!==self&&top.postMessage({type:"iframeLock"},"*"),/[○▽]$/.test(u.path)?setTimeout(u.runGesture):(P&&(u.path+="◆",u.path.indexOf("T")||(e.preventDefault(),window.getSelection().empty())),S&&(B=setTimeout(u.runGesture,179))))}async function a(e){let t=e.target||e;document.contains(u.videoPlayer)&&t.muted||(u.videoPlayer=t,r(),u.videoPlayer.insertAdjacentElement("afterend",u.tipBox),u.settings["视频下载"]&&(await(u.findVideoBox()?.insertAdjacentElement("beforeend",u.videoPlayer._downloadTip_)),window._urlObjects_[u.videoPlayer.src]?(u.videoPlayer._downloadTip_.textContent="正在捕获",u.videoPlayer._downloadTip_.buffers=window._urlObjects_[u.videoPlayer.src].sourceBuffers,window._urlObjects_[u.videoPlayer.src]._downloadTip_=u.videoPlayer._downloadTip_,delete window._urlObjects_[u.videoPlayer.src]):"未加载"===u.videoPlayer._downloadTip_.textContent&&(!u.videoPlayer.src&&u.videoPlayer.children.length&&(u.videoPlayer.src=u.videoPlayer.firstChild.src),u.videoPlayer.src.indexOf("blob:")&&u.videoPlayer.src&&(u.videoPlayer._downloadTip_.textContent="可下载"))))}function r(){if(!u.videoPlayer.videoWidth)return!u.videoPlayer.error&&document.contains(u.videoPlayer)&&setTimeout(r,100),void(k=0);k=+(u.videoPlayer.videoWidth>u.videoPlayer.videoHeight),I>0&&k?top.postMessage({type:"GYRO"},"*"):screen.orientation.unlock()}function s(){let e=u.addStyle(""),t=()=>{L=0},i=null;window.addEventListener("resize",()=>{if(document.fullscreen&&!I){if(L=setTimeout(t,400),I=document.fullscreenElement,"IFRAME"===I.nodeName)return void(I=-1);let o=I.getElementsByTagName("video"),n="VIDEO"===I.nodeName?I:o[0];if(!I.hasAttribute("_videobox_")&&(!n||o.length>1||n._videoBox_.offsetWidth*n._videoBox_.offsetHeight*1.2<I.offsetWidth*I.offsetHeight))return void(I=-1);n!==u.videoPlayer&&(u.videoPlayer?.pause(),a(n)),i=I.parentNode.querySelectorAll('*[_videobox_*="!important"]'),I=1,k&&top.postMessage({type:"GYRO"},"*"),e.textContent="*[_videobox_]{inset:0 !important;margin:0 !important;padding:0 !important;width:100% !important;height:100% !important;max-width:100% !important;max-height:100% !important;}video{position:absolute;transform:none !important;object-fit:contain !important;}",i.forEach(e=>{e.style.cssText=e._fullscreenCSS_})}else I&&!document.fullscreen&&(L=setTimeout(t,400),I=0,e.textContent="",i.forEach(e=>{e.style.cssText=e._cssText_}))},!0)}async function d(){if(V=[...document.querySelectorAll("a:not([_linkShow_])")],Y=[...document.querySelectorAll("video:not([_videoBox_])")],$=[...document.querySelectorAll('img:not([_imgShow_]),[style*="url("]:not([_imgShow_])')],u.shadowList)for(let e=0,t=u.shadowList.length;e<t;++e)V.push(...u.shadowList[e].querySelectorAll("a:not([_linkShow_])")),Y.push(...u.shadowList[e].querySelectorAll("video:not([_videoBox_])")),$.push(...u.shadowList[e].querySelectorAll('img:not([_imgShow_]),[style*="url("]:not([_imgShow_])'));if(Y.length&&u.settings["视频手势"]){u.tipBox||(s(),top!==self&&top.postMessage({type:"forceFullScreen"},"*"),u.tipBox=document.createElement("div"),u.tipBox.style.cssText="display:inline-flex;flex-wrap:wrap;text-align:center;justify-content:center;align-items:center;visibility:hidden;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);min-width:80px;min-height:30px;padding:10px;color:#1e87f0;font-size:22px;background-color:rgba(0,0,0,0.6);border-radius:999px;font-family:system-ui;z-index:2147483647;");for(let e=0,t=Y.length;e<t;++e)Y[e]._videoBox_||(await u.findVideoBox(Y[e]),u.settings["视频下载"]&&await window._initDownload_(Y[e]),Y[e].paused||(a(Y[e]),top!==self&&top.postMessage({type:"iframeLock"},"*")),Y[e].addEventListener("playing",a,!0),Y[e].addEventListener("volumechange",a,!0),Y[e].addEventListener("contextmenu",e=>{e.preventDefault()},!0))}if(u.settings["图片手势"])for(let e=0,t=$.length;e<t;++e)$[e].setAttribute("_imgShow_","0"),_.observe($[e]);if(u.settings["网页加速"])for(let e=0,t=V.length;e<t;++e)V[e].setAttribute("_linkShow_","0"),V[e].href.indexOf("/")>-1&&(V[e]._prefetch_=0,f.observe(V[e]),V[e].addEventListener("click",function(){this._prefetch_=0},!0));document.documentElement._regEvent_||c(),R=0}function l(e){let t={};for(let i in e)"target"!==i&&(t[i]=e[i]);return t}function c(){if(top===self?(window.addEventListener("popstate",()=>{clearTimeout(u.backTimer),u.backTimer=0},!0),window.addEventListener("beforeunload",()=>{clearTimeout(u.backTimer),u.backTimer=0},!0),window.addEventListener("message",async e=>{let t=e.data;switch(t.type){case"iframeLock":N=e.source;break;case"GYRO":await(screen.orientation.lock("landscape")?.catch(Date));break;case"iframeSelect":u.iframeSelect=t.selectWords;break;case"forceFullScreen":for(let t=0,i=C.length;t<i;++t)if(C[t].contentWindow===e.source){C[t].allowFullscreen||(C[t].allowFullscreen=!0,C[t].getAttribute("src")&&C[t].src.indexOf("/")>-1&&(C[t].src=C[t].src));break}break;case"runPath":for(let i=0,o=C.length;i<o;++i)if(C[i].contentWindow===e.source){let e=C[i].getBoundingClientRect();u.touchStart=t.gestureData.touchStart,u.touchEnd=t.gestureData.touchEnd,u.touchStart.target=u.touchEnd.target=u.touchEle=C[i],u.touchStart.pageX=u.touchStart.clientX+=e.x,u.touchStart.pageY=u.touchStart.clientY+=e.y,u.touchEnd.pageX=u.touchEnd.clientX+=e.x,u.touchEnd.pageY=u.touchEnd.clientY+=e.y;break}u.path=t.runPath,setTimeout(u.runGesture);break;case"pushTouch":{let e=u.touchEle.getBoundingClientRect();u.touchEnd=t.gestureData.touchEnd,u.touchEnd.target=u.touchEle,u.touchEnd.pageX=u.touchEnd.clientX+=e.x,u.touchEnd.pageY=u.touchEnd.clientY+=e.y;break}case"download":window._downloadVideo_(t)}},!0)):(window.addEventListener("selectionchange",()=>{top.postMessage({type:"iframeSelect",selectWords:window.getSelection()+""},"*")},!0),window.addEventListener("message",async e=>{"fullscreen"===e.data.type&&await(u.findVideoBox()?.requestFullscreen()?.catch(Date))},!0)),window.addEventListener("touchstart",i,{capture:!0,passive:!1}),window.addEventListener("pointermove",o,{capture:!0,passive:!0}),window.addEventListener("touchmove",o,{capture:!0,passive:!0}),window.addEventListener("touchend",n,{capture:!0,passive:!1}),window.addEventListener("touchcancel",n,{capture:!0,passive:!1}),window.addEventListener("click",e=>{y<50&&(e.preventDefault(),e.stopImmediatePropagation())},!0),u.settings["图片手势"]&&window.addEventListener("contextmenu",e=>{(u.path.indexOf("I")>-1||"IMG"===e.target.nodeName)&&u.touchEle.src!==location.href&&e.preventDefault()},!0),window.addEventListener("visibilitychange",e=>{if(e.stopImmediatePropagation(),document.hidden){let e=u.videoPlayer?.paused,t=u.videoPlayer?.currentTime+.2,i=u.videoPlayer?.playbackRate,o=u.videoPlayer?.volume;setTimeout(()=>{e!==u.videoPlayer?.paused&&(u.videoPlayer.load(),u.videoPlayer.currentTime=t,u.videoPlayer.addEventListener("loadstart",()=>{u.videoPlayer.play(),u.videoPlayer.playbackRate=i,u.videoPlayer.volume=o},!0))})}else if(u.settings["网页加速"]){let e=[...document.querySelectorAll('a[_linkShow_="1"]')],t=Date.now();if(u.shadowList)for(let t=0,i=u.shadowList.length;t<i;++t)e.push(...u.shadowList[t].querySelectorAll('a[_linkShow_="1"]'));for(let i=0,o=e.length;i<o;++i)t>e[i]._prefetch_&&(e[i]._prefetch_=Date.now()+3e5,document.head.insertAdjacentHTML("beforeend",`<link rel="prefetch" href="${e[i].href.replace(/^https?:/,"")}"/>`))}},!0),window.addEventListener("pagehide",e=>{e.stopImmediatePropagation()},!0),window.addEventListener("blur",e=>{e.stopImmediatePropagation()}),window.addEventListener("beforecopy",e=>{e.stopImmediatePropagation()},!0),window.addEventListener("copy",e=>{u.selectWords||e.stopImmediatePropagation()},!0),document.execCommand=()=>{},navigator.clipboard&&(navigator.clipboard.writeText=()=>{},navigator.clipboard.write=()=>{}),u.addStyle("html,html *{user-select:auto !important;touch-action:manipulation;overscroll-behavior-x:none !important;}"),window.addEventListener("selectstart",e=>{e.stopImmediatePropagation()},!0),u.settings["网页加速"]&&HTMLScriptElement.supports&&HTMLScriptElement.supports("speculationrules")){let e=document.createElement("script"),t={prerender:[{source:"document",where:{and:[{selector_matches:'a[_linkShow_="1"]'}]},referrer_policy:"strict-origin-when-cross-origin",eagerness:"immediate"}],prefetch:[{source:"document",where:{and:[{selector_matches:'a[_linkShow_="1"]'}]},referrer_policy:"strict-origin-when-cross-origin",eagerness:"immediate"}],prefetch_with_subresources:[{source:"document",where:{and:[{selector_matches:'a[_linkShow_="1"]'}]},referrer_policy:"strict-origin-when-cross-origin",eagerness:"immediate"}]};e.type="speculationrules",e.textContent=JSON.stringify(t),document.head?.insertAdjacentElement("beforeend",e)}window.addEventListener("beforeunload",e=>{e.stopImmediatePropagation()},!0),window.addEventListener("unload",e=>{e.stopImmediatePropagation()},!0),document.documentElement._regEvent_=1}const u={gesture:{"↑→↓←":{name:"打开设置",code:"/*ONLY TOP*/gestureData.openSet();"},"◆◆":{name:"视频全屏",code:"gestureData.videoFullScreen();"},"●":{name:"手势穿透",code:'if(/^[TIV]/.test(gestureData.path)){gestureData.path=(gestureData.path.indexOf("I")) ? "" : "I";}if(gestureData.path!=="I" && gestureData.settings["图片手势"]){if(gestureData.touchEle.nodeName!=="IMG"){let imgs=[...document.querySelectorAll("[_imgShow_=\'1\']")];if(gestureData.shadowList){for(let Ti=0,len=gestureData.shadowList.length;Ti<len;++Ti){imgs.push(...gestureData.shadowList[Ti].querySelectorAll("[_imgShow_=\'1\']"));}}for(let Ti=0,len=imgs.length;Ti<len;++Ti){if(imgs[Ti].nodeName!=="IMG" && getComputedStyle(imgs[Ti]).backgroundImage==="none"){continue;}let imgRect=imgs[Ti].getBoundingClientRect();if(gestureData.touchStart.clientX>imgRect.x && gestureData.touchStart.clientX<(imgRect.x+imgRect.width) && gestureData.touchStart.clientY>imgRect.y && gestureData.touchStart.clientY<(imgRect.y+imgRect.height)){gestureData.touchEle=imgs[Ti];break;}}}if(gestureData.path || gestureData.selectWords || !(gestureData.touchEle.compareDocumentPosition(gestureData.videoPlayer) & Node.DOCUMENT_POSITION_FOLLOWING)){if(gestureData.touchEle.nodeName==="IMG"){gestureData.path="I";}else{let bgImg=getComputedStyle(gestureData.touchEle).backgroundImage;if(bgImg!=="none"){gestureData.touchEle.src=bgImg.split(\'"\')[1];gestureData.path="I";}}}}'},"→←":{name:"后退",code:"/*ONLY TOP*/function pageBack(){if(gestureData.backTimer){history.go(-1);setTimeout(pageBack,20);}}gestureData.backTimer=setTimeout(()=>{gestureData.backTimer=0;window.close();},200);pageBack();"},"←→":{name:"前进",code:"/*ONLY TOP*/history.go(1);"},"↓↑":{name:"回到顶部",code:'/*WITH TOP*/let boxNode=gestureData.touchEle.parentNode;while(boxNode.nodeName!=="#document"){boxNode.scrollIntoView(true);if(boxNode.scrollTop){boxNode.scrollTo(0,0);}boxNode=boxNode.parentNode;}'},"↑↓":{name:"回到底部",code:'/*WITH TOP*/let boxNode=gestureData.touchEle.parentNode;while(boxNode.nodeName!=="#document"){if(getComputedStyle(boxNode).overflowY!=="hidden"){boxNode.scrollTo(0,boxNode.scrollHeight+999999);}boxNode=boxNode.parentNode;}'},"←↓":{name:"刷新页面",code:'/*ONLY TOP*/document.documentElement.style.cssText="filter:grayscale(100%)";history.go(0);'},"←↑":{name:"新建页面",code:'/*ONLY TOP*/gestureData.GM_openInTab("//limestart.cn",false);'},"→↓":{name:"关闭页面",code:"/*ONLY TOP*/window.close();"},"→↑":{name:"恢复页面",code:'/*ONLY TOP*/gestureData.GM_openInTab("chrome-native://recent-tabs",false);'},"↓↑●":{name:"新页面打开",code:'let linkNode=gestureData.touchEle;while(true){if(linkNode.href){gestureData.GM_openInTab(linkNode.href,false);break;}linkNode=linkNode.parentNode;if(linkNode.nodeName==="BODY"){gestureData.touchEle.click();break;}}'},"↑↓●":{name:"隐藏元素",code:'let boxNode=gestureData.touchEle,area=boxNode.offsetWidth*boxNode.offsetHeight,area_p=boxNode.parentNode.offsetWidth*boxNode.parentNode.offsetHeight,area_s=screen.width*screen.height;while(boxNode.parentNode.nodeName!=="BODY" && area/area_p>0.2 && area_p/area_s<0.9){boxNode=boxNode.parentNode;area_p=boxNode.parentNode.offsetWidth*boxNode.parentNode.offsetHeight;}if(boxNode.nodeName!=="HTML"){boxNode.remove();}'},"↓→":{name:"复制页面",code:"/*ONLY TOP*/gestureData.GM_openInTab(location.href,false);"},"→←→":{name:"半屏模式",code:'/*ONLY TOP*/if(gestureData.halfScreen){setTimeout(()=>{gestureData.halfScreen.remove();halfClose.remove();gestureData.halfScreen=null;document.documentElement.scrollTop=gestureData.scrollTop;},500);gestureData.scrollTop=document.body.scrollTop;let halfClose=gestureData.addStyle("html{transform:translateY(0) !important;}");}else{gestureData.scrollTop=document.documentElement.scrollTop;gestureData.halfScreen=gestureData.addStyle("html,body{height:43vh !important;overflow-y:auto !important;}html{transform:translateY(50vh) !important;transition:0.5s !important;overflow:hidden !important;}");document.body.scrollTop=gestureData.scrollTop;}'},"→↓↑←":{name:"视频解析",code:"/*ONLY TOP*/gestureData.GM_openInTab(`https://jx.xmflv.com/?url=${location.href}`,false);"},"↑→↓":{name:"停止定时器",code:'/*WITH TOP*/let start=gestureData.maxID|0,script=document.createElement("script");gestureData.maxID=setTimeout(Date);script.textContent=`for(let Ti=${start};Ti<${gestureData.maxID+1000};++Ti){clearTimeout(Ti);clearInterval(Ti);}`;document.body.insertAdjacentElement("beforeend",script);alert("已停止网页当前存在的定时器");'},"T→↑":{name:"百度翻译",code:"gestureData.GM_openInTab(`//fanyi.baidu.com/#auto/auto/${encodeURIComponent(gestureData.selectWords)}`,false);"},"T←↑":{name:"有道翻译",code:"gestureData.GM_openInTab(`//dict.youdao.com/w/eng/${encodeURIComponent(gestureData.selectWords)}`,false);"},"T◆◆":{name:"双击搜索",code:"gestureData.GM_setClipboard(gestureData.selectWords);if(!/^((https?:)?\\/\\/)?([\\w\\-]+\\.)+\\w{2,4}(:\\d{1,5})?(\\/\\S*)?$/.test(gestureData.selectWords.trim())){gestureData.selectWords=`//bing.com/search?q=${encodeURIComponent(gestureData.selectWords)}&FORM=CHROMN`;}else if(!/^(https?:)?\\/\\//.test(gestureData.selectWords.trim())){gestureData.selectWords=`//${gestureData.selectWords.trim()}`;}gestureData.GM_openInTab(gestureData.selectWords.trim(),false);"},"I↓↑●":{name:"打开图片",code:"gestureData.GM_openInTab(gestureData.touchEle.src,false);"},"I→↑●":{name:"百度搜图",code:"gestureData.GM_openInTab(`//graph.baidu.com/details?isfromtusoupc=1&tn=pc&carousel=0&promotion_name=pc_image_shituindex&extUiData%5bisLogoShow%5d=1&image=${gestureData.touchEle.src}`,false);"},"V→":{name:"前进10s",code:'gestureData.videoPlayer.currentTime+=10;gestureData.tipBox.textContent="+10s ";gestureData.tipBox.style.visibility="visible";setTimeout(()=>{gestureData.tipBox.style.visibility="hidden";},500);'},"V←":{name:"后退10s",code:'gestureData.videoPlayer.currentTime-=10;gestureData.tipBox.textContent="-10s ";gestureData.tipBox.style.visibility="visible";setTimeout(()=>{gestureData.tipBox.style.visibility="hidden";},500);'},"V↑":{name:"增加倍速",code:'if(document.fullscreen){let playSpeed=gestureData.videoPlayer.playbackRate;playSpeed+=(playSpeed<1.5) ? 0.25 : 0.5;gestureData.tipBox.textContent=`×${playSpeed} ∞ `;gestureData.tipBox.style.visibility="visible";gestureData.videoPlayer.playbackRate=playSpeed;setTimeout(()=>{gestureData.tipBox.style.visibility="hidden";},500)}'},"V↓":{name:"减小倍速",code:'if(document.fullscreen){let playSpeed=gestureData.videoPlayer.playbackRate;playSpeed-=(playSpeed>1.5) ? 0.5 : (playSpeed>0.25 && 0.25);gestureData.tipBox.textContent=`×${playSpeed} ∞ `;gestureData.tipBox.style.visibility="visible";gestureData.videoPlayer.playbackRate=playSpeed;setTimeout(()=>{gestureData.tipBox.style.visibility="hidden";},500)}'},"V→●":{name:"快进播放",code:'gestureData.playSpeed=gestureData.videoPlayer.playbackRate;gestureData.videoPlayer.playbackRate=10;gestureData.tipBox.textContent="×10 ";gestureData.tipBox.style.visibility="visible";'},"V→○":{name:"停止快进",code:'gestureData.videoPlayer.playbackRate=gestureData.playSpeed;gestureData.tipBox.style.visibility="hidden";'},"V←●":{name:"快退播放",code:'gestureData.videoTimer=setInterval(()=>{--gestureData.videoPlayer.currentTime;},100);gestureData.tipBox.textContent="- ×10 ";gestureData.tipBox.style.visibility="visible";'},"V←○":{name:"停止快退",code:'clearInterval(gestureData.videoTimer);gestureData.tipBox.style.visibility="hidden";'},"V↑▼":{name:"增加音量",code:'if(document.fullscreen){gestureData.videoPlayer.muted=false;gestureData.tipBox.textContent=(gestureData.videoPlayer.volume*100|0)+"%";gestureData.tipBox.style.visibility="visible";let lastY=gestureData.touchEnd.screenY;gestureData.videoTimer=setInterval(()=>{if(lastY-gestureData.touchEnd.screenY){let tempVolume=gestureData.videoPlayer.volume+(lastY-gestureData.touchEnd.screenY)/100;gestureData.videoPlayer.volume=+(tempVolume>1) || (+(tempVolume>0) && tempVolume);gestureData.tipBox.textContent=(gestureData.videoPlayer.volume*100|0)+"%";lastY=gestureData.touchEnd.screenY;}},50);}'},"V↑▽":{name:"关闭增加音量",code:'clearInterval(gestureData.videoTimer);gestureData.tipBox.style.visibility="hidden";'},"V↓▼":{name:"减少音量",code:'if(document.fullscreen){gestureData.videoPlayer.muted=false;gestureData.tipBox.textContent=(gestureData.videoPlayer.volume*100|0)+"%";gestureData.tipBox.style.visibility="visible";let lastY=gestureData.touchEnd.screenY;gestureData.videoTimer=setInterval(()=>{if(lastY-gestureData.touchEnd.screenY){let tempVolume=gestureData.videoPlayer.volume+(lastY-gestureData.touchEnd.screenY)/100;gestureData.videoPlayer.volume=+(tempVolume>1) || (+(tempVolume>0) && tempVolume);gestureData.tipBox.textContent=(gestureData.videoPlayer.volume*100|0)+"%";lastY=gestureData.touchEnd.screenY;}},50);}'},"V↓▽":{name:"关闭减少音量",code:'clearInterval(gestureData.videoTimer);gestureData.tipBox.style.visibility="hidden";'},"V→▼":{name:"右滑进度",code:'if(!gestureData.formatTime){gestureData.formatTime=function(time){let minu=time/60,sec=time%60;hour=minu/60;minu%=60;return `${hour|0}:${(minu<10) ? "0":""}${minu|0}:${(sec<10) ? "0" : ""}${sec|0}`;};gestureData.showTip=function(){gestureData.tipBox.innerHTML=`<div style="background:#e1780f;width:100%;height:3px;margin:0 1vw;"><div style="width:${gestureData.videoPlayer.currentTime/gestureData.videoPlayer.duration*100|0}%;background:#1e87f0;height:3px;"></div></div><div style="font-size:min(5vw,18px);">${gestureData.formatTime(gestureData.videoPlayer.currentTime)}<span style="color:#e1780f;">/${gestureData.formatTime(gestureData.videoPlayer.duration)}</span></div>`;}}gestureData.showTip();gestureData.tipBox.style.visibility="visible";let lastX=gestureData.touchEnd.screenX;gestureData.videoTimer=setInterval(()=>{let len=gestureData.touchEnd.screenX-lastX;if(len){gestureData.videoPlayer.currentTime+=len*(1+Math.abs(len)*gestureData.videoPlayer.duration/7200).toFixed(2);lastX=gestureData.touchEnd.screenX;}gestureData.showTip();},50);'},"V→▽":{name:"关闭右滑进度",code:'clearInterval(gestureData.videoTimer);gestureData.tipBox.style.visibility="hidden";'},"V←▼":{name:"左滑进度",code:'if(!gestureData.formatTime){gestureData.formatTime=function(time){let minu=time/60,sec=time%60;hour=minu/60;minu%=60;return `${hour|0}:${(minu<10) ? "0":""}${minu|0}:${(sec<10) ? "0" : ""}${sec|0}`;};gestureData.showTip=function(){gestureData.tipBox.innerHTML=`<div style="background:#e1780f;width:100%;height:3px;margin:0 1vw;"><div style="width:${gestureData.videoPlayer.currentTime/gestureData.videoPlayer.duration*100|0}%;background:#1e87f0;height:3px;"></div></div><div style="font-size:min(5vw,18px);">${gestureData.formatTime(gestureData.videoPlayer.currentTime)}<span style="color:#e1780f;">/${gestureData.formatTime(gestureData.videoPlayer.duration)}</span></div>`;}}gestureData.showTip();gestureData.tipBox.style.visibility="visible";let lastX=gestureData.touchEnd.screenX;gestureData.videoTimer=setInterval(()=>{let len=gestureData.touchEnd.screenX-lastX;if(len){gestureData.videoPlayer.currentTime+=len*(1+Math.abs(len)*gestureData.videoPlayer.duration/7200).toFixed(2);lastX=gestureData.touchEnd.screenX;}gestureData.showTip();},50);'},"V←▽":{name:"关闭左滑进度",code:'clearInterval(gestureData.videoTimer);gestureData.tipBox.style.visibility="hidden";'},"◆◆◆":{name:"视频画中画",code:"if(document.pictureInPictureElement){let playState=document.pictureInPictureElement.paused;document.exitPictureInPicture().then(()=>{if(!playState){gestureData.videoPlayer.play();}}).catch(Date);}else{gestureData.videoPlayer?.requestPictureInPicture().then(()=>{gestureData.videoPlayer.play();}).catch(Date);}"}},settings:{"滑动系数":[.2,0,.5,2],"文字手势":!0,"图片手势":!0,"视频手势":!0,"选词翻译":!1,"网页加速":!1,"视频下载":!1}};u.GM_setValue=GM_setValue,u.GM_getValue=GM_getValue,u.GM_openInTab=GM_openInTab,u.GM_setClipboard=GM_setClipboard,u.gesture=u.GM_getValue("gesture",u.gesture),u.settings=u.GM_getValue("settings",u.settings);const m=((screen.width>screen.height?screen.height:screen.width)*u.settings["滑动系数"][0])**2,g=Element.prototype.attachShadow,h=CanvasRenderingContext2D.prototype.drawImage,p=new MutationObserver(()=>{R||(R=setTimeout(d,500))}),_=new IntersectionObserver(e=>{for(let t=0,i=e.length;t<i;++t)e[t].intersectionRatio?e[t].target.setAttribute("_imgShow_","1"):e[t].target.setAttribute("_imgShow_","0")},{threshold:[0,.5,1]}),f=new IntersectionObserver(e=>{let t=null,i=Date.now();for(let o=0,n=e.length;o<n;++o)t=e[o].target,e[o].intersectionRatio?(t.setAttribute("_linkShow_","1"),i>t._prefetch_&&(t._prefetch_=i+3e5,document.head.insertAdjacentHTML("beforeend",`<link rel="prefetch" href="${t.href.replace(/^https?:/,"")}"/>`))):t.setAttribute("_linkShow_","0")},{rootMargin:"50%",threshold:[0,.5,1]});let v={},y=0,b=0,x=0,w=0,D=0,T=0,E=0,B=0,S=0,P=0;u.runCode=e=>{try{eval(e)}catch(t){(t+"").indexOf("unsafe-eval")>-1?(window.eval=function(){this.gestureData=u,this.close=window.close;let e=document.createElement("script");return i=>{e.remove(),e=document.createElement("script"),e.textContent=`try{${i}}catch(error){alert(\`“${u.path}” 手势执行脚本错误：\\n${t} ！\`);}`,document.body.insertAdjacentElement("beforeend",e)}}(),eval(e)):alert(`“${u.path}” 手势执行脚本错误：\n${t} ！`)}},u.runFrame=e=>{let t=u.gesture[e].code;if(top===self||/^[TIV]/.test(e))u.runCode(t);else if(t.indexOf("/*ONLY TOP*/")<0&&u.runCode(t),/\/\*(ONLY|WITH) TOP\*\//.test(t)){/[●▼]$/.test(e)&&(window._isPushing_=()=>{let e={};e.touchEnd=l(u.touchEnd),top.postMessage({type:"pushTouch",gestureData:e},"*")});let t={};t.touchStart=l(u.touchStart),t.touchEnd=l(u.touchEnd),top.postMessage({type:"runPath",runPath:u.path,gestureData:t},"*")}},u.runGesture=e=>{u.gesture[u.path]?(u.runFrame(u.path),u.gesture[e]&&(u.path=e)):u.gesture[u.path.slice(1)]&&/^[TIV]/.test(u.path)&&(u.runFrame(u.path.slice(1)),u.gesture[e?.slice(1)]&&(u.path=e)),x=0};let k=0,L=0,I=0,C=document.getElementsByTagName("iframe"),N=null;if(CanvasRenderingContext2D.prototype.drawImage=function(e){let t=e;return"VIDEO"!==t.nodeName||document.contains(t)||(t.style.display="none",this.canvas.insertAdjacentElement("afterend",t)),h.call(this,...arguments)},u.videoFullScreen=async()=>{L||(document.fullscreen?await(document.exitFullscreen()?.catch(Date)):u.videoPlayer?await(u.findVideoBox()?.requestFullscreen()?.catch(Date)):N&&N.postMessage({type:"fullscreen"},"*"))},u.findVideoBox=(e=u.videoPlayer)=>{if(!document.contains(e))return null;if(e._videoBox_?.contains(e)&&(document.fullscreen||e._checkHeight_===e.clientHeight))return e._videoBox_;let t=e.parentNode,i=getComputedStyle(e),o=getComputedStyle(t),n=0,a=0,r=0,s=0,d="";for(e.setAttribute("_videobox_",""),e._checkHeight_=e.clientHeight,e._videoBox_=t,e.offsetParent!==e.parentNode&&e.offsetParent?(n=Math.round(e.offsetWidth+(+i.left.slice(0,-2)||0)+ +i.marginLeft.slice(0,-2)+ +i.marginRight.slice(0,-2)+(+i.right.slice(0,-2)||0)),a=Math.round(e.offsetHeight+(+i.top.slice(0,-2)||0)+ +i.marginTop.slice(0,-2)+ +i.marginBottom.slice(0,-2)+(+i.bottom.slice(0,-2)||0)),r=Math.round(t.offsetWidth+(+o.left.slice(0,-2)||0)+ +o.marginLeft.slice(0,-2)+ +o.marginRight.slice(0,-2)+(+o.right.slice(0,-2)||0)),s=Math.round(t.offsetHeight+(+o.top.slice(0,-2)||0)+ +o.marginTop.slice(0,-2)+ +o.marginBottom.slice(0,-2)+(+o.bottom.slice(0,-2)||0))):(n=Math.round(e.offsetWidth+ +i.marginLeft.slice(0,-2)+ +i.marginRight.slice(0,-2)),a=Math.round(e.offsetHeight+ +i.marginTop.slice(0,-2)+ +i.marginBottom.slice(0,-2)),r=Math.round(t.offsetWidth+ +o.marginLeft.slice(0,-2)+ +o.marginRight.slice(0,-2)),s=Math.round(t.offsetHeight+ +o.marginTop.slice(0,-2)+ +o.marginBottom.slice(0,-2))),n=n>r?n:r,a=a>s?a:s;(n>=t.clientWidth||1.08*e.clientWidth>t.clientWidth)&&(n<1.15*t.clientWidth||!t.clientWidth)&&(a<1.15*t.clientHeight||!t.clientHeight)&&"BODY"!==t.nodeName;){if(a<t.clientHeight&&1.08*e.clientHeight<t.clientHeight){let o=1;for(let n of t.children)if(i=getComputedStyle(n),a=Math.round(n.offsetHeight+(+i.top.slice(0,-2)||0)+ +i.marginTop.slice(0,-2)+ +i.marginBottom.slice(0,-2)+(+i.bottom.slice(0,-2)||0)),a>=t.clientHeight&&1.15*e.clientHeight>t.clientHeight){o=0;break}if(o)break}t.clientHeight&&(e._videoBox_=t,t.setAttribute("_videobox_",""),d=t.style.cssText,/\s*!\s*important/.test(d)&&(t._cssText_=d,t._fullscreenCSS_=d.replace(/\s*!\s*important/g,""),t.setAttribute("_videobox_","!important")),o=getComputedStyle(t),t.offsetParent!==t.parentNode&&t.offsetParent?(r=Math.round(t.offsetWidth+(+o.left.slice(0,-2)||0)+ +o.marginLeft.slice(0,-2)+ +o.marginRight.slice(0,-2)+(+o.right.slice(0,-2)||0)),s=Math.round(t.offsetHeight+(+o.top.slice(0,-2)||0)+ +o.marginTop.slice(0,-2)+ +o.marginBottom.slice(0,-2)+(+o.bottom.slice(0,-2)||0))):(r=Math.round(t.offsetWidth+ +o.marginLeft.slice(0,-2)+ +o.marginRight.slice(0,-2)),s=Math.round(t.offsetHeight+ +o.marginTop.slice(0,-2)+ +o.marginBottom.slice(0,-2))),n=n>r?n:r,a=a>s?a:s),t=t.parentNode}return e._videoBox_.setAttribute("_videobox_",`${e._videoBox_.getAttribute("_videobox_")||""} outer`.trim()),e._videoBox_},u.settings["视频下载"]){const A=URL.createObjectURL,W=MediaSource.prototype.addSourceBuffer,H=SourceBuffer.prototype.appendBuffer,X=MediaSource.prototype.endOfStream;window._initDownload_=e=>{e._downloadTip_=document.createElement("div"),e._downloadTip_.style.cssText="position:absolute;right:0;top:20px;background:#3498db;border-radius:20px 0 0 20px;text-align:center;padding:20px;line-height:0px;color:#fff;min-width:60px;font-size:16px;font-family:system-ui;z-index:2147483647;",e._downloadTip_.target=e,e._downloadTip_.textContent="未加载",window._urlObjects_[e.src]?(e._downloadTip_.textContent="正在捕获",e._downloadTip_.buffers=window._urlObjects_[e.src].sourceBuffers,window._urlObjects_[e.src]._downloadTip_=e._downloadTip_,delete window._urlObjects_[e.src]):(!e.src&&e.children.length&&(e.src=e.firstChild.src),e.src.indexOf("blob:")&&e.src&&(e._downloadTip_.textContent="可下载")),e._downloadTip_.addEventListener("click",window._downloadVideo_,!0),e._videoBox_.insertAdjacentElement("beforeend",e._downloadTip_)},window._downloadVideo_=function(e){if("未加载"===this.textContent)return;e.target&&((e=this).src=this.target.src);let t=e.buffers;if(top!==self){let i=[];for(let e=0,o=t.length;e<o;++e)i.push({mime:t[e]._mime_,bufferList:t[e]._bufferList_});return void top.postMessage({type:"download",buffers:i,src:e.src},"*")}let i=document.createElement("a");if(i.download=document.title,i.style.display="none",document.body.insertAdjacentElement("beforeend",i),e.src.indexOf("blob:")&&e.src)i.href=e.src,i.click();else if(t.length)for(let e=0,o=t.length;e<o;++e)i.href=URL.createObjectURL(new Blob(t[e]._bufferList_,{type:t[e]._mime_})),i.click(),URL.revokeObjectURL(i.href);i.remove()},window._urlObjects_={},URL.createObjectURL=e=>{let t=A(e);return e.sourceBuffers&&(window._urlObjects_[t]=e),t},MediaSource.prototype.addSourceBuffer=function(e){let t=W.call(this,e);return t._bufferList_=[],t._mime_=e,t._mediaSource_=this,t},SourceBuffer.prototype.appendBuffer=function(e){this._bufferList_.push(e),this._mime_.indexOf("video")>-1&&this._mediaSource_._downloadTip_&&(this._mediaSource_._downloadTip_.textContent=`已捕获${this._bufferList_.length}个片段`),H.call(this,e)},MediaSource.prototype.endOfStream=function(){this._downloadTip_&&(this._downloadTip_.textContent="可下载"),X.call(this)}}if(u.settings["选词翻译"]){let j=0,F=null;function M(e){return/[\u4E00-\u9FFF\u3400-\u4DBF\u{20000}-\u{2EBEF}]/u.test(e)?"zh-CN":/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FFF]/.test(e)?"ja":/[\uAC00-\uD7AF]/.test(e)?"ko":/[\u0400-\u04FF]/.test(e)?"ru":/[\u0600-\u06FF]/.test(e)?"ar":"en"}function O(e){let t=M(e),i="zh-CN"===t?"en":"zh-CN";return fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(e)}&langpair=${t}|${i}`).then(e=>{if(!e.ok)throw new Error("网络请求失败！");return e.json()}).then(e=>200===e.responseStatus?e.responseData.translatedText:"糟糕X﹏X，翻译失败了！").catch(()=>"糟糕X﹏X，翻译失败了！")}function G(){clearTimeout(j),F||(F=document.createElement("div"),F.style.cssText="position:fixed;transform:translateX(-25%);max-width:80%;padding:15px 25px;background:#1e1e1e;border-radius:8px;font-size:16px;font-family:system-ui;color:#fff;z-index:2147483647;border:2px solid #eee;display:none;align-items:center;",document.body.insertAdjacentElement("beforeend",F),F.addEventListener("touchstart",function(){u.GM_setClipboard(this.textContent),alert("翻译复制成功！")},!0));let e=window.getSelection().toString().trim();e?j=setTimeout(async()=>{window.getSelection().toString().trim()?e===window.getSelection().toString().trim()?(F.textContent=await O(e),window.getSelection().toString().trim()?(F.style.left=u.touchEnd.clientX+"px",F.style.top=Math.min(u.touchEnd.clientY+.05*screen.width,window.innerHeight-.2*screen.width)+"px",u.touchEnd.clientX<.2*screen.width?F.style.transform="translateX(-10%)":u.touchEnd.clientX>window.innerWidth-.2*screen.width?(F.style.left=u.touchEnd.clientX-.2*screen.width+"px",F.style.transform="none"):F.style.transform="translateX(-25%)",F.style.display="flex"):F.style.display="none"):setTimeout(G):F.style.display="none"},1e3):F.style.display="none"}window.addEventListener("selectionchange",G,!0)}let Y=[],$=[],V=[],R=0;window.trustedTypes?.createPolicy("default",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e}),Element.prototype.attachShadow=function(){u.shadowList||(u.shadowList=[]);let e=g.call(this,...arguments);return u.shadowList.push(e),p.observe(e,{childList:!0,subtree:!0}),e},u.addStyle=e=>{let t=document.createElement("style");if(t.textContent=e,document.head)return document.head.insertAdjacentElement("beforeend",t),t;setTimeout(()=>{u.addStyle(e)})},u.openSet=()=>{function e(){if(d=this.parentNode.getAttribute("name"),["打开设置","视频全屏","手势穿透"].indexOf(d)>-1)return void alert("该手势脚本无法修改！");l=this.parentNode.getAttribute("path");let e=/^[TIV]/.test(l)?`_${l.slice(0,1)}_`:"_G_";document.getElementById(e).click(),document.getElementById("_gestureName_").value=d,document.getElementById("_gestureCode_").value=u.gesture[l].code,document.getElementById("_editGesture_").style.display="block"}function t(){d=this.parentNode.getAttribute("name"),l=this.parentNode.getAttribute("path"),g.textContent="",window.removeEventListener("touchmove",o,!0),window.removeEventListener("pointermove",o,!0),document.getElementById("_revisePath_").style.display="block"}function i(){d=this.parentNode.getAttribute("name"),["打开设置","视频全屏","手势穿透"].indexOf(d)>-1?alert("该手势无法删除！"):confirm(`确定删除"${d}"手势`)&&(l=this.parentNode.getAttribute("path"),delete u.gesture[l],u.GM_setValue("gesture",u.gesture),s())}function n(e){e.preventDefault(),E=2;let t=e.changedTouches[0].clientX-u.touchStart.clientX,i=+this.style.left.slice(0,-2)+t,o=this.offsetWidth/2,n=u.settings[this.id];i=i<-o?-o:i>(t=this.parentNode.offsetWidth-o)?t:i,this.style.left=i+"px",this.textContent=((i+o)/this.parentNode.offsetWidth*(n[2]-n[1])+n[1]).toFixed(n[3]),u.touchStart=e.changedTouches[0]}function a(){!P&&/^$|[●○▼▽]$/.test(g.textContent)||(P=0,v=u.touchEnd,g.textContent+="●")}function r(){/[○▼▽]$/.test(g.textContent)||(g.textContent+="◆")}function s(){let o=document.getElementById("_gestureUL_");o.textContent="";for(let n in u.gesture){let a=document.createElement("div"),r=document.createElement("p"),s=document.createElement("div"),d=document.createElement("div");a.className="_gestureLi_",a.setAttribute("name",u.gesture[n].name),a.setAttribute("path",n),r.textContent=u.gesture[n].name,r.addEventListener("click",e,!0),s.className="_gesturePath_",s.textContent=n,s.addEventListener("click",t,!0),d.className="_delGesture_",d.textContent="删除",d.addEventListener("click",i,!0),a.insertAdjacentElement("beforeend",r),a.insertAdjacentElement("beforeend",s),a.insertAdjacentElement("beforeend",d),o.insertAdjacentElement("beforeend",a)}}let d="",l="",c=document.createElement("div"),g=null,h=0;u.addStyle('*{overflow:hidden !important;}#_gestureBox_{background-color:#fff;width:100%;height:100%;position:fixed;padding:0;margin:0;inset:0;overflow-y:auto !important;z-index:2147483647;}#_gestureBox_ *{font-family:system-ui;margin:0;padding:0;text-align:center;font-size:5vmin;line-height:12vmin;user-select:none !important;transform:none;text-indent:0;}#_gestureBox_ ::placeholder{color:#999;font-size:2.5vmin;line-height:6vmin;}#_gestureBox_ h1{width:60%;height:12vmin;color:#0074d9;background-color:#dee6ef;margin:3vmin auto;border-radius:12vmin;box-shadow:0.9vmin 0.9vmin 3vmin #dfdfdf;}#_gestureBox_ #_addGesture_{width:14vmin;height:14vmin;margin:3vmin auto;line-height:14vmin;background-color:#dee6ef;color:#032e58;font-size:7.5vmin;border-radius:15vmin;box-shadow:0.3vmin 0.3vmin 1.5vmin #dfdfdf;}#_gestureBox_ ._gestureLi_{height:18vmin;width:100%;border-bottom:0.3vmin solid #dfdfdf;}#_gestureBox_ ._gestureLi_ p{margin:3vmin 0 0 1%;width:38%;height:12vmin;border-left:1.8vmin solid;color:#ffb400;background-color:#fff1cf;float:left;white-space:nowrap;text-overflow:ellipsis;text-shadow:0.3vmin 0.3vmin 3vmin #ffcb56;}#_gestureBox_ ._gestureLi_ ._gesturePath_{margin:3vmin 0 0 3%;float:left;width:38%;height:12vmin;background-color:#f3f3f3;color:#000;box-shadow:0.3vmin 0.3vmin 1.5vmin #ccc9c9;border-radius:3vmin;white-space:nowrap;text-overflow:ellipsis;}#_gestureBox_ ._gestureLi_ ._delGesture_{margin:3vmin 2% 0 0;width:15vmin;height:12vmin;float:right;color:#f00;text-decoration:line-through;}#_gestureBox_ #_revisePath_{background-color:rgba(0,0,0,0.7);width:100%;height:100%;position:fixed;inset:0;display:none;color:#000;}#_gestureBox_ #_revisePath_ span{width:15vmin;height:15vmin;font-size:12.5vmin;line-height:15vmin;position:absolute;}#_gestureBox_ #_revisePath_ div{color:#3339f9;position:absolute;width:30%;height:12vmin;font-size:10vmin;bottom:15%;}#_gestureBox_ #_revisePath_ p{color:#3ba5d8;position:absolute;top:15%;font-size:10vmin;height:12vmin;width:100%;}#_gestureBox_ #_revisePath_ #_path_{top:40%;color:#ffee03;height:100%;word-wrap:break-word;font-size:15vmin;line-height:18vmin;}#_gestureBox_ #_editGesture_{overflow-y:auto !important;background-color:#fff;width:100%;height:100%;position:fixed;inset:0;display:none;color:#000;}#_gestureBox_ #_editGesture_ p{color:#3339f9;font-size:7.5vmin;text-align:left;margin:6vmin 0 0 9vmin;width:100%;height:9vmin;line-height:9vmin;}#_gestureBox_ #_editGesture_ #_gestureName_{margin-top:6vmin;width:80%;height:12vmin;color:#000;border:0.3vmin solid #dadada;border-radius:3vmin;text-align:left;padding:0 3vmin;}#_gestureBox_ #_editGesture_ ._label_box_>label{display:inline-block;margin-top:6vmin;position:relative;}#_gestureBox_ #_editGesture_ ._label_box_>label>input{position:absolute;top:0;left:-6vmin;}#_gestureBox_ #_editGesture_ ._label_box_>label>div{width:20vw;border:#ddd solid 0.3vmin;height:12vmin;color:#666;position:relative;}#_gestureBox_ #_editGesture_ ._label_box_>label>input:checked + div{border:#d51917 solid 0.3vmin;color:#d51917;}#_gestureBox_ #_editGesture_ ._label_box_>label>input + div:after{top:auto;left:auto;bottom:-3vmin;right:0;transition:none;}#_gestureBox_ #_editGesture_ ._label_box_>label>input:checked + div:after{content:"";display:block;border:none;width:6vmin;height:6vmin;background-color:#d51917;transform:skewY(-45deg);position:absolute;}#_gestureBox_ #_editGesture_ ._label_box_>label>input:checked + div:before{content:"";display:block;width:0.9vmin;height:2.4vmin;border-right:#fff solid 0.6vmin;border-bottom:#fff solid 0.6vmin;transform:rotate(35deg);position:absolute;bottom:0.6vmin;right:1.2vmin;z-index:1;}#_gestureBox_ #_editGesture_ #_gestureCode_{overflow-y:auto !important;width:80%;margin-top:6vmin;height:40%;text-align:left;line-height:6vmin;padding:3vmin;border:0.3vmin solid #dadada;border-radius:3vmin;}#_gestureBox_ #_editGesture_ button{width:30vmin;height:15vmin;font-size:7.5vmin;line-height:15vmin;display:inline-block;color:#fff;background-color:#2866bd;margin:6vmin 3vmin 0 3vmin;border:none;}#_gestureBox_ #_settingsBox_{overflow-y:auto !important;background-color:#fff;width:100%;height:100%;position:fixed;inset:0;display:none;color:#000;}#_gestureBox_ #_settingsBox_ p{color:#3339f9;text-align:left;margin:9vmin 0 0 9vmin;float:left;height:6vmin;line-height:6vmin;clear:both;}#_gestureBox_ #_settingsBox_ ._slideRail_{overflow:initial !important;width:55%;background-color:#a8a8a8;float:left;margin:12vmin 0 0 3vmin;height:0.6vmin;position:relative;}#_gestureBox_ #_settingsBox_ ._slideRail_ ._slideButton_{line-height:9vmin;color:#fff;background-color:#2196f3;min-width:9vmin;height:9vmin;border-radius:9vmin;font-size:4vmin;position:absolute;top:-4.5vmin;box-shadow:0.3vmin 0.3vmin 1.8vmin #5e8aee;padding:0 1vmin;}#_gestureBox_ #_settingsBox_ ._switch_{position:relative;display:inline-block;width:18vmin;height:9vmin;float:left;margin:7.5vmin 42% 0 3vmin;}#_gestureBox_ #_settingsBox_ ._switch_ input{display:none;}#_gestureBox_ #_settingsBox_ ._slider_{border-radius:9vmin;position:absolute;cursor:pointer;inset:0;background-color:#ccc;transition:0.4s;}#_gestureBox_ #_settingsBox_ ._slider_:before{border-radius:50%;position:absolute;content:"";height:7.5vmin;width:7.5vmin;left:0.6vmin;bottom:0.6vmin;background-color:white;transition:0.4s;}#_gestureBox_ #_settingsBox_ input:checked + ._slider_{background-color:#2196F3;}#_gestureBox_ #_settingsBox_ input:checked + ._slider_:before{transform:translateX(9vmin);}#_gestureBox_ #_settingsBox_ #_saveSettings_{display:block;clear:both;width:30vmin;height:15vmin;font-size:7.5vmin;line-height:15vmin;color:#fff;background-color:#2866bd;border:none;margin:12vmin 0 0 calc(50% - 15vmin);float:left;}'),c.id="_gestureBox_",document.body.insertAdjacentElement("beforeend",c),c.innerHTML='<h1 id="_openSettings_">手势轨迹设置</h1><div id="_addGesture_">+</div><div id="_gestureUL_"></div><div id="_revisePath_"><span style="top:0;left:0;text-align:left;">┌</span><span style="top:0;right:0;text-align:right;">┐</span><span style="bottom:0;left:0;text-align:left;">└</span><span style="bottom:0;right:0;text-align:right;">┘</span><p>请滑动手指</p><p id="_path_"></p><div id="_clearPath_" style="left:10%;">清除</div><div id="_cancleRevise_" style="right:10%;">保存</div></div><div id="_editGesture_"><p>手势名称：</p><input type="text" id="_gestureName_" maxlength="12" placeholder="最大输入12个字符"><p>手势类型：</p><div class="_label_box_"><label><input type="radio" id="_G_" name="_gestureType_" value=""><div>一般</div></label><label><input type="radio" id="_T_" name="_gestureType_" value="T"><div>文字</div></label><label><input type="radio" id="_I_" name="_gestureType_" value="I"><div>图片</div></label><label><input type="radio" id="_V_" name="_gestureType_" value="V"><div>视频</div></label></div><p>手势执行脚本：</p><textarea id="_gestureCode_" placeholder="可用变量说明↓\n \tgestureData：手势数据常量,如果你需要在不同手势间传递变量,你可以赋值gestureData.变量名=变量值；\n\tgestureData.touchEle：手指触摸的源元素；\n\tgestureData.selectWords：选中的文字；\n\tgestureData.touchStart：触摸开始坐标对象；\n\tgestureData.touchEnd：触摸最新坐标对象；\n\tgestureData.path：滑动的路径；\n\tgestureData.videoPlayer：正在播放的视频元素。\n\n可用方法说明↓\n\tgestureData.addStyle(CSS样式)：将CSS样式添加到网页上；\n\tgestureData.runGesture()：以path为路径执行手势,你可以修改path后执行此方法；\n\tgestureData.GM_openInTab(链接)：打开链接；\n\tgestureData.GM_setClipboard(文本)：复制文本到剪切板；\n\tgestureData.GM_setValue(变量名,变量值)：在油猴中存储数据；\n\tgestureData.GM_getValue(变量名,默认值)：从油猴中取出数据,没有则使用默认值。\n\n可识别代码注释说明(仅对一般手势生效)↓\n\t默认情况：存在iframe时，所有手势只会在触发手势的页面对象执行！\n \t添加/*ONLY TOP*/：手势只在顶级页面对象执行；\n\t添加/*WITH TOP*/：手势同时在当前页面对象和顶级页面对象执行。"></textarea><div style="width:100%;height:0.3vmin;"></div><button id="_saveGesture_">保存</button><button id="_closeEdit_">关闭</button></div><div id="_settingsBox_"><h1>功能开关设置</h1><span id="_settingList_"></span><button id="_saveSettings_">保存</button></div>',g=document.getElementById("_path_"),s(),document.getElementById("_addGesture_").addEventListener("click",()=>{d=l="",document.getElementById("_G_").click(),document.getElementById("_gestureName_").value="",document.getElementById("_gestureCode_").value="",document.getElementById("_editGesture_").style.display="block"},!0),document.getElementById("_saveGesture_").addEventListener("click",()=>{let e=document.getElementById("_gestureName_").value;if(!e)return void alert("请输入手势名称！");if(document.querySelector(`#_gestureBox_ ._gestureLi_[name="${e}"]:not([path="${l}"])`))return void alert("存在同名手势！");let t=document.getElementsByName("_gestureType_");for(let i=0,o=t.length;i<o;++i)if(t[i].checked){let o=t[i].value+(d&&l.indexOf("[")<0?/^[TIV]/.test(l)?l.slice(1):l:`[${e}]`);if(o!==l){if(u.gesture[o]){let e=t[i].value+`[${u.gesture[o].name}]`;u.gesture[e]=u.gesture[o]}u.gesture[o]=u.gesture[l]||{},delete u.gesture[l]}u.gesture[o].name=e,u.gesture[o].code=document.getElementById("_gestureCode_").value;break}u.GM_setValue("gesture",u.gesture),s(),document.getElementById("_editGesture_").style.display="none"},!0),document.getElementById("_closeEdit_").addEventListener("click",()=>{document.getElementById("_editGesture_").style.display="none"},!0),document.getElementById("_revisePath_").addEventListener("touchstart",()=>{E>1||(clearTimeout(B),clearTimeout(h),B=setTimeout(a,300+w-b))},!0),document.getElementById("_revisePath_").addEventListener("touchmove",e=>{if(e.preventDefault(),clearTimeout(B),u.touchEnd=e.changedTouches[0],/[○▼▽]$/.test(g.textContent)||E>1)return;let t=(u.touchEnd.screenX-v.screenX)**2,i=(u.touchEnd.screenY-v.screenY)**2,o=t>i?u.touchEnd.screenX>v.screenX?"→":"←":u.touchEnd.screenY>v.screenY?"↓":"↑",n=Date.now(),r=t+i,s=g.textContent.slice(-1);r>m/100&&(w=n,P=0,s===o||r>m?(s!==o&&(g.textContent+=o,D=n+300),v=u.touchEnd,D&&n>D&&(D=0,g.textContent+="▼")):r>m/16&&(D=0)),B=setTimeout(a,300+w-n)},!0),document.getElementById("_revisePath_").addEventListener("touchend",()=>{if(P&&!(E>0))if(u.path.indexOf("◆◆")>-1)switch(u.path="",g.textContent.slice(-1)){case"●":g.textContent=g.textContent.slice(0,-1)+"○";break;case"○":g.textContent=g.textContent.slice(0,-1)+"●";break;case"▼":g.textContent=g.textContent.slice(0,-1)+"▽";break;case"▽":g.textContent=g.textContent.slice(0,-1)+"▼";break;default:g.textContent+="◆",setTimeout(r,100)}else h=setTimeout(r,200)}),document.getElementById("_clearPath_").addEventListener("touchend",e=>{e.stopPropagation(),!P||E>0||(u.path.indexOf("◆◆")>-1?(u.path="",g.textContent=""):g.textContent=g.textContent.slice(0,-1))}),document.getElementById("_cancleRevise_").addEventListener("touchend",e=>{if(e.preventDefault(),e.stopPropagation(),P&&!(E>0)){if(g.textContent){if("视频全屏"===d&&"◆"!==g.textContent.slice(-1))return void alert("视频全屏需要以◆结尾！");if("手势穿透"===u.gesture[g.textContent]?.name)return void alert('路径与"手势穿透"功能冲突！');if(/^[TIV]/.test(l)&&(g.textContent=l.slice(0,1)+g.textContent),u.gesture[g.textContent]){let e=(/^[TIV]/.test(l)?l.slice(0,1):"")+`[${u.gesture[g.textContent].name}]`;u.gesture[e]=u.gesture[g.textContent]}u.gesture[g.textContent]=u.gesture[l],delete u.gesture[l],u.GM_setValue("gesture",u.gesture),s()}window.addEventListener("touchmove",o,{capture:!0,passive:!0}),window.addEventListener("pointermove",o,{capture:!0,passive:!0}),document.getElementById("_revisePath_").style.display="none"}}),document.getElementById("_openSettings_").addEventListener("click",()=>{c.style.cssText="overflow-y:hidden !important",document.getElementById("_settingsBox_").style.display="block";let e=document.getElementById("_settingList_");e.textContent="";for(let t in u.settings)if(e.innerHTML+=`<p>${t}：</p>`,"boolean"==typeof u.settings[t])e.innerHTML+=`<label class="_switch_"><input type="checkbox" id="${t}" ${u.settings[t]?"checked":""}><div class="_slider_"></div></label>`;else if("object"==typeof u.settings[t]){e.innerHTML+=`<div class="_slideRail_"><div class="_slideButton_" id="${t}"></div></div>`;let i=document.getElementById(t),o=i.parentNode.offsetWidth*(u.settings[t][0]-u.settings[t][1])/(u.settings[t][2]-u.settings[t][1])-i.offsetWidth/2;i.style.left=o+"px",i.textContent=u.settings[t][0].toFixed(u.settings[t][3])}let t=document.getElementsByClassName("_slideButton_");for(let e=0,i=t.length;e<i;++e)t[e].addEventListener("touchmove",n,!0)},!0),document.getElementById("_saveSettings_").addEventListener("click",()=>{c.style.cssText="";for(let e in u.settings)"boolean"==typeof u.settings[e]?u.settings[e]=document.getElementById(e).checked:"object"==typeof u.settings[e]&&(u.settings[e][0]=+document.getElementById(e).textContent);u.GM_setValue("settings",u.settings),document.getElementById("_settingsBox_").style.display="none"},!0)},c(),R=setTimeout(d,500),p.observe(document,{childList:!0,subtree:!0});