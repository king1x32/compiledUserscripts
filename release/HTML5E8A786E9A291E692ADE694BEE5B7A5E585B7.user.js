// ==UserScript==
// @name       HTML5视频播放工具
// @name:en	   HTML5 Video Playing Tools
// @homepage https://bbs.kafan.cn/thread-2093014-1-1.html
// @match    https://*.qq.com/*
// @exclude  https://user.qzone.qq.com/*
// @match    https://www.weiyun.com/video_*
// @match    https://v.youku.com/v*
// @match    https://m.youku.com/*
// @match    https://vku.youku.com/live/*
// @match    https://video.tudou.com/v/*
// @match    https://www.iqiyi.com/*
// @match    https://live.bilibili.com/*
// @match    https://www.bilibili.com/*
// @match    https://www.ixigua.com/*
// @match    https://www.toutiao.com/video/*
// @match    https://www.acfun.cn/*
// @match    https://live.acfun.cn/live/*
// @match    http://v.pptv.com/show/*
// @match    https://v.pptv.com/show/*
// @match    https://www.miguvideo.com/*
// @match    https://tv.sohu.com/*
// @match    https://film.sohu.com/album/*
// @match    https://www.mgtv.com/*
// @match    https://movie.douban.com/subject/*
// @version    2.0.2
// @match    https://pan.baidu.com/*
// @match    https://yun.baidu.com/*
// @match    https://*.163.com/*
// @match    https://*.icourse163.org/*
// @match    http://video.sina.*/*
// @match    https://video.sina.*/*
// @match    http://k.sina.*/*
// @match    https://k.sina.*/*
// @match    https://weibo.com/*
// @match    https://*.weibo.com/*
// @match    https://pan.baidu.com/*
// @match    https://yun.baidu.com/*
// @match    http://v.ifeng.com/*
// @match    https://v.ifeng.com/*
// @match    http://news.mtime.com/*
// @match    http://video.mtime.com/*
// @GM_info
// @match    https://www.youtube.com/*
// @match    https://www.ted.com/talks/*
// @match    https://www.twitch.tv/*
// @inject-into content
// @match    https://www.yy.com/*
// @match    https://www.huya.com/*
// @match    https://v.douyu.com/*
// @match    https://www.douyu.com/*
// @match    https://live.douyin.com/*
// @match    https://www.douyin.com/*

// @match    https://www.longzhu.com/*
// @match    https://www.zhanqi.tv/*
// @match    https://lemonlive*/*
// @run-at     document-start
// @require    https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.min.js
// @require    https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js
// @grant      GM_addStyle
// @include    */play*
// @include    *play/*
// @exclude    https://www.dj92cc.net/dance/play/id/*
// @grant      window.onurlchange
// @grant      unsafeWindow
// @grant      GM_registerMenuCommand
// @grant      GM_setValue
// @grant      GM_getValue
// @namespace  https://greasyfork.org/users/7036
// @license    MIT
// @downloadURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/HTML5E8A786E9A291E692ADE694BEE5B7A5E585B7.user.js
// @updateURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/HTML5E8A786E9A291E692ADE694BEE5B7A5E585B7.meta.js
// ==/UserScript==
"use strict";var e,t,n;const i={zh:{console:"%c脚本[%s] 反馈：%s\n%s",cacheStoringError:"直接媒体类型（如MP4格式）缓存无效果！",cacheStoringConfirm:"缓冲模式二选一，确认则全部缓冲，取消则按默认缓冲区大小进行缓冲。视频缓存的有效性检测，再看已观看视频片段不产生网络流量则可缓存。缓冲时再按M键则取消缓冲！",cantOpenPIP:"无法进入画中画模式!错误:\n",cantExitPIP:"无法退出画中画模式!错误：\n",rememberRateMenuOption:"记忆播放速度",speedRate:"播放速度 ",ready:"准备就绪！ 待命中.",mainPageOnly:"只处理主页面",download:"下载: ",videoLag:"视频卡顿",fullScreen:"全屏",helpMenuOption:"脚本功能快捷键表",helpBody:"双击(控制栏)：切换（网页）全屏         鼠标中键：快进5秒\nP：视频截图    i：切换画中画   M：(停止)缓存视频\nchrome类浏览器加启动参数设置媒体缓存为840MB： --media-cache-size=880008000\n\n← →方向键：快退、快进5秒;   方向键 + shift: 20秒\n↑ ↓方向键：音量调节   ESC：退出（网页）全屏\n空格键：暂停/播放      N：播放下一集\n回车键：切换全屏;      回车键 + shift: 切换网页全屏\nC(抖音、youtube用V键)：加速0.1倍  X(抖音S)：减速0.1倍  Z(抖音A)：切换加速状态\nD：上一帧     F：下一帧(youtube.com用E键)"},en:{console:"%cScript[%s] Feedback：%s\n%s",cacheStoringError:"Trying to cache direct media types (such as MP4 format) has no effect!",cacheStoringConfirm:"Do you want all segments of the video to be cached? The detection method used is as follows: when the page is refreshed, the watched video clips will be cached so that no additional network traffic is generated. If you want all segments of the videos to be cached, select OK; or select Cancel to buffer a portion of the video based on the default buffer size (which is the default browser behavior). When buffering, press M key again to cancel buffering.",cantOpenPIP:"Unable to access picture-in-picture mode! Error：\n",cantExitPIP:"Unable to exit picture-in-picture mode! Error：\n",rememberRateMenuOption:"Remember video playback speed",speedRate:"Speed rate ",ready:" ready！ Waiting for you commands.",mainPageOnly:"Process the main page only",download:"Download: ",videoLag:"Video lag",fullScreen:"Full screen",helpMenuOption:"Hotkeys list:",helpBody:"Double-click: activate full screen.\nMiddle mouse button: fast forward 5 seconds\n\nP key： Take a screenshot\nI key： Enter/Exit picture-in-picture mode\nM key： Enable/disable caching of video\nChrome browsers add startup parameters to set the media cache to 840MB： --media-cache-size=880008000\n\nArrow keys ← and →： Fast forward or rewind by 5 seconds\nShift + Arrow keys ← and →： Fast forward or rewind 20 seconds\nArrow keys ↑ and ↓： Raise or lower the volume\n\nESC： Exit full screen (or exit video enlarged to window size)\nSpacebar： Stop/Play\nEnter： Enable/disable full screen video\nShift + Enter: Set/unset video enlarged to window size\n\nN key： Play the next video (if any)\nC key(YouTube:V key)： Speed up video playback by 0.1\nX key: Slow down video playback by 0.1\nZ key, Set video playback speed: 1.0 ←→ X\nD key: Previous frame\nF key: Next frame (except on YouTube)\nE key: Next frame (YouTube only)"},it:{console:"%cScript[%s] Feedback：%s\n%s",cacheStoringError:"Cercare di memorizzazione nella cache tipi di media diretti (come ad esempio il formato MP4) non ha alcuna efficacia!",cacheStoringConfirm:"Vuoi che tutti i segmenti del video siano memorizzati nella cache? Il metodo di rilevamento utilizzato è il seguente: all'aggiornamento della pagina, i video clip guardati saranno memorizzati nella cache in modo da non generare ulteriore traffico di rete. Se vuoi che tutti i segmenti dei video siano memorizzati nella cache, seleziona OK; seleziona invece Annulla per bufferizzare una parte del video in base alla dimensione predefinita del buffer (come da comportamento predefinito del browser).Durante il buffering, premere nuovamente il tasto M per annullare il buffering.",cantOpenPIP:"Impossibile accedere alla modalità picture-in-picture! Errore：\n",cantExitPIP:"Impossibile uscire dalla modalità picture-in-picture! Errore：\n",rememberRateMenuOption:"Memorizza la velocità di riproduzione dei video",speedRate:"Velocità di riproduzione ",ready:"Pronto！ In attesa dei comandi dell'utente.",mainPageOnly:"Elaborazione della sola pagina principale",download:"Scarica: ",videoLag:"Ritardo del video",fullScreen:"Schermo intero",helpMenuOption:"Elenco dei tasti di scelta rapida",helpBody:"Doppio clic: attiva lo schermo intero\nPulsante centrale del mouse: avanzamento rapido di 5 secondi\n\nTasto P: Esegui uno screenshot\nTasto I： Attiva modalità picture-in-picture\nTasto M： Attiva/disattiva memorizzazione del video nella cache\nI browser Chrome aggiungono parametri di avvio per impostare la cache multimediale a 840MB： --media-cache-size=880008000\n\nTasti freccia ← e →： Avanza o riavvolgi di 5 secondi\nShift + Tasti freccia ← e →: Avanza o riavvolgi di 20 secondi\nTasti freccia ↑ e ↓： Alza o abbassa il volume\nESC： Esci da schermo intero\nBarra spaziatrice: Ferma/Riproduci\nInvio： Attiva/disattiva ingrandimento del video a schermo intero\nShift + Invio: Attiva/disattiva ingrandimento del video a dimensione della finestra\n\nTasto N： Riproduzione del video successivo (se presente)\nTasto C(YouTube: Tasto V): Velocizza riproduzione video di 0,1\nTasto X: Rallenta riproduzione video di 0,1\nTasto Z, Impostare la velocità di riproduzione video: 1,0 ←→ X\nTasto D: Vai al frame precedente\nTasto F: Vai al frame successivo (escluso YouTube)\nTasto E: Vai al frame successivo (solo su YouTube)"}},a=i[navigator.language.slice(0,2)]||i.en,o=unsafeWindow||window,{host:l,pathname:s}=location,r=document,c=[].find;let d,p,u,h,m;const f={childList:!0,subtree:!0},g=function(){},b=e=>e&&e.offsetWidth>1,S=(e,t=r)=>t.querySelector(e),y=console.log.bind(console,a.console,"color:#c3c;font-size:1.2em",GM_info.script.name,GM_info.script.homepage),v=e=>new Promise(t=>{setTimeout(t,e)}),w=e=>{try{const t=Element.prototype.attachShadow;Element.prototype.attachShadow=function(n){n.mode="open";const i=t.call(this,n);return e(i),i}}catch(e){console.error("Hack attachShadow error",e)}},C=e=>{"string"==typeof e&&(e=S(e)),e&&(e.click?e.click():e.dispatchEvent(new MouseEvent("click")))},x=e=>{e.nextElementSibling&&"none"===((e,t)=>{if(e.style[t])return e.style[t];if(getComputedStyle){const n=getComputedStyle(e,"");return t=t.replace(/([A-Z])/g,"-$1").toLowerCase(),n&&n.getPropertyValue(t)}})(e,"display")?C(e.nextElementSibling):C(e)},P=(e,t,n=!0)=>{const i="string"==typeof t?S.bind(null,t):t,a=setInterval(()=>{i()&&(n&&clearInterval(a),e())},300);return a},E=(e=/Firefox\/(\d+)/,t=navigator.userAgent,e.test(t)&&RegExp.$1);/ Edge?\//.test(navigator.userAgent);const k=e=>{e+=p.playbackRate,p.playbackRate=e<.1?.1:e>16?16:+e.toFixed(2)},M=e=>{(e=>Math.max(0,e)==Math.min(e,1))(e+=p.volume)&&(p.volume=+e.toFixed(2))},L=(e=>{const t=e.split(".");let n=t.length-2;return/^(com?|cc|tv|net|org|gov|edu)$/.test(t[n])&&n--,t[n]})(l),F={isLive:!1,disableDBLClick:!1,isClickOnVideo:!1,multipleV:!1,isNumURL:!1},R=new Vue;void 0===window.onurlchange&&(history.pushState=(n=history.pushState,function(){const e=n.apply(this,arguments);return window.dispatchEvent(new Event("pushstate")),window.dispatchEvent(new Event("urlchange")),e}),history.replaceState=(e=>function(){const t=e.apply(this,arguments);return window.dispatchEvent(new Event("replacestate")),window.dispatchEvent(new Event("urlchange")),t})(history.replaceState),window.addEventListener("popstate",()=>{window.dispatchEvent(new Event("urlchange"))}));class T{constructor(e){let t=r.exitFullscreen||r.webkitExitFullscreen||r.mozCancelFullScreen||r.msExitFullscreen||g;this.exit=t.bind(r),t=e.requestFullscreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullScreen||g,this.enter=t.bind(e)}static isFull(){return!!(r.fullscreen||r.webkitIsFullScreen||r.mozFullScreen||r.fullscreenElement||r.webkitFullscreenElement||r.mozFullScreenElement)}toggle(){T.isFull()?this.exit():this.enter()}}class z{constructor(e){this._isFull=!1,this.container=e||z.getPlayerContainer(p),GM_addStyle(".gm-fp-body .gm-fp-zTop {\n\t\t\t\tposition: relative !important;\n\t\t\t\tz-index: 2147483646 !important;\n\t\t\t}\n\t\t\t.gm-fp-wrapper, .gm-fp-body{ overflow:hidden !important; }\n\t\t\t.gm-fp-wrapper .gm-fp-innerBox {\n\t\t\t\twidth: 100% !important;\n\t\t\t\theight: 100% !important;\n\t\t\t}\n\t\t\t.gm-fp-wrapper {\n\t\t\t\tdisplay: block !important;\n\t\t\t\tposition: fixed !important;\n\t\t\t\twidth: 100% !important;\n\t\t\t\theight: 100% !important;\n\t\t\t\tpadding: 0 !important;\n\t\t\t\tmargin: 0 !important;\n\t\t\t\ttop: 0 !important;\n\t\t\t\tleft: 0 !important;\n\t\t\t\tbackground: #000 !important;\n\t\t\t\tz-index: 2147483646 !important;\n\t\t\t}")}static getPlayerContainer(e){let t=e,n=t.parentNode;const{clientWidth:i,clientHeight:a}=t;do{t=n,n=t.parentNode}while(n&&n!==m&&n.clientWidth-i<5&&n.clientHeight-a<5);return t}static isFull(e){return o.innerWidth-e.clientWidth<5&&o.innerHeight-e.clientHeight<5}toggle(){this.container.contains(p)||(this.container=z.getPlayerContainer(p)),R.$emit("switchFP",!this._isFull),m.classList.toggle("gm-fp-body");let e=p;for(;e!=this.container;)e.classList.toggle("gm-fp-innerBox"),e=e.parentNode;for(e.classList.toggle("gm-fp-wrapper"),e=e.parentNode;e!=m;)e.classList.toggle("gm-fp-zTop"),e=e.parentNode;this._isFull=!this._isFull}}const V={check(){const e=p.buffered,t=e.length-1;return this.iEnd=e.end(t),this.mode?this.iEnd>p.duration-55:e.start(0)>=this.playPos||this.iEnd>p.duration-55},finish(){p.removeEventListener("canplaythrough",this.onChache),p.currentTime=this.playPos,this.cached=!1,setTimeout(()=>p.pause(),33),HTMLMediaElement.prototype.play=this.rawPlay},onChache(){this.cached&&(this.check()?this.finish():(p.currentTime=this.iEnd,p.pause()))},exec(){!F.isLive&&p&&(this.mode=confirm(a.cacheStoringConfirm),this.cached=!0,p.pause(),this.rawPlay=HTMLMediaElement.prototype.play,HTMLMediaElement.prototype.play=()=>new Promise(g),this.playPos=p.currentTime,p.addEventListener("canplaythrough",this.onChache),this.check(),p.currentTime=this.iEnd)}};V.onChache=V.onChache.bind(V);const _=new Map;_.set(90,()=>{1==p.playbackRate||0==p.playbackRate?p.playbackRate=+localStorage.mvPlayRate||1.3:p.playbackRate=1}).set(88,k.bind(null,-.1)).set(67,k.bind(null,.1)).set(40,M.bind(null,-.1)).set(38,M.bind(null,.1)).set(37,()=>{p.currentTime-=5}).set(1061,()=>{p.currentTime-=20}).set(39,()=>{p.currentTime+=5}).set(1063,()=>{p.currentTime+=20}).set(68,()=>{p.currentTime-=.03,p.pause()}).set(70,()=>{p.currentTime+=.03,p.pause()}).set(32,()=>{F.btnPlay?x(F.btnPlay):p.paused?p.play():p.pause()}).set(13,()=>{h?h.toggle():x(F.btnFS)}).set(1037,()=>{self!=top?top.postMessage({id:"gm-h5-toggle-iframeWebFull"},"*"):u?u.toggle():x(F.btnFP)}).set(1051,g).set(27,()=>{T.isFull()?h?h.exit():x(F.btnFS):self!=top?top.postMessage({id:"gm-h5-is-iframeWebFull"},"*"):z.isFull(p)&&(u?u.toggle():x(F.btnFP))}).set(73,()=>{r.pictureInPictureElement?r.exitPictureInPicture().catch(e=>{alert(a.cantExitPIP+e)}):p.requestPictureInPicture().catch(e=>{alert(a.cantOpenPIP+e)})}).set(80,()=>{const e=r.createElement("canvas");e.width=p.videoWidth,e.height=p.videoHeight,e.getContext("2d").drawImage(p,0,0,e.width,e.height),e.toBlob(async e=>{const t=URL.createObjectURL(e),n=r.createElement("a");n.onclick=e=>{e.stopPropagation()},n.href=t,n.download=Date.now().toString(36)+".png",n.style.display="none",r.body.appendChild(n),n.click(),n.remove(),await v(500),URL.revokeObjectURL(t)})}).set(77,()=>{V.cached?V.finish():V.exec()}).set(78,()=>{self!=top?top.postMessage({id:"gm-h5-play-next"},"*"):F.btnNext?C(F.btnNext):F.isNumURL&&(()=>{const e=location.pathname,t=e.match(/(\d+)(\D*)$/),n=+t[1]+1;location.assign(e.slice(0,t.index)+n+t[2])})()});const I={rawProps:new Map,shellEvent(){const e=F.isClickOnVideo?p:F.mvShell;e.addEventListener("mousedown",e=>{1==e.button&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),F.isLive||(_.has(39)?_.get(39)():p.currentTime+=5))}),!F.disableDBLClick&&e.addEventListener("dblclick",e=>{e.target.closest("svg,img,button")||(e.stopPropagation(),e.stopImmediatePropagation(),this.checkUI(),_.get(1037)())})},setShell(){const e=this.getDPlayer()||this.getArtplayer()||this.getVjsPlayer()||F.shellCSS&&S(F.shellCSS)||(top!=self?m:z.getPlayerContainer(p));e&&F.mvShell!==e&&(F.mvShell=e,this.shellEvent())},checkMV(){if(this.vList){const e=this.findMV();e&&e!=p&&(p=e,F.btnPlay=F.btnNext=F.btnFP=F.btnFS=h=u=null,!F.isLive&&GM_getValue("remberRate",!0)&&(p.playbackRate=+localStorage.mvPlayRate||1,p.addEventListener("ratechange",()=>{p.playbackRate&&1!=p.playbackRate&&(localStorage.mvPlayRate=p.playbackRate)})),this.setShell())}return b(F.mvShell)||(F.mvShell=null,this.setShell()),this.checkUI(),p},getArtplayer(){const e=p.parentNode;return!(!p.matches(".art-video")||!e.matches(".art-video-player"))&&(F.btnFP=S(".art-control-fullscreenWeb",e),F.btnFS=S(".art-control-fullscreen",e),e.closest("body > *")?.classList.add("gm-dp-zTop"),e)},getDPlayer(){if(!p.matches(".dplayer-video"))return!1;const e=p.closest(".dplayer");return e&&(F.btnFP=S(".dplayer-full-in-icon > span",e),F.btnFS=S(".dplayer-full-icon",e),e.closest("body > *").classList.add("gm-dp-zTop")),e},getVjsPlayer(){const e=p.closest(".video-js");return e&&(F.btnFS=S(".vjs-control-bar > button.vjs-button:nth-last-of-type(1)"),F.webfullCSS='.vjs-control-bar > button.vjs-button[title$="全屏"]:nth-last-of-type(2)'),e},hotKey(e){const t=e.target;if(e.ctrlKey||e.metaKey||e.altKey||"true"==t.contentEditable||/INPUT|TEXTAREA|SELECT/.test(t.nodeName))return;if(e.shiftKey&&![13,37,39].includes(e.keyCode))return;if(e.shiftKey&&27==e.keyCode)return;if(!this.checkMV())return;if(!e.shiftKey&&F.mvShell&&F.mvShell.contains(t)&&[32,37,39].includes(e.keyCode))return;const n=e.shiftKey?e.keyCode+1024:e.keyCode;_.has(n)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),_.get(n)(e),[67,88,90].includes(e.keyCode)&&(e=>{if(d?.get(0)?.offsetHeight||(d=$('<div style="max-width:455px;min-width:333px;background:#EEE;color:#111;height:22px;top:-30px;left:50%;transform:translate(-50%, 0); border-radius:8px;border:1px solid orange;text-align:center;font-size:15px;position:fixed;z-index:2147483647"></div>').appendTo(m)),!e?.length)return;const t=15*e.length;d.stop(!0,!0).text(e).css({width:`${t}px`}).animate({top:"190px"}).animate({top:"+=9px"},1900).animate({top:"-30px"})})(a.speedRate+p.playbackRate))},checkUI(){F.webfullCSS&&!b(F.btnFP)&&(F.btnFP=S(F.webfullCSS)),F.btnFP?u=null:u||self!=top||(u=new z(F.mvShell)),F.fullCSS&&!b(F.btnFS)&&(F.btnFS=S(F.fullCSS)),F.btnFS?h=null:h||(h=new T(p)),!F.nextCSS||b(F.btnNext)&&F.btnNext.matches(F.nextCSS)||(F.btnNext=S(F.nextCSS)),F.playCSS&&!b(F.btnPlay)&&(F.btnPlay=S(F.playCSS))},onGrowVList(){if(this.vList.length!=this.vCount){if(this.viewObserver)for(let e of this.vList)this.vSet.has(e)||this.viewObserver.observe(e);else{const e={rootMargin:"0px",threshold:.9};this.viewObserver=new IntersectionObserver(this.onIntersection.bind(this),e);for(let e of this.vList)this.viewObserver.observe(e)}this.vSet=new Set(this.vList),this.vCount=this.vList.length}},onIntersection(e){if(this.vList.length<2)return;const t=c.call(e,e=>e.isIntersecting);t&&p!=t.target&&(p=t.target,h=new T(p),u=new z(p),R.$on("switchFP",async e=>{v(200),e||p.scrollIntoView()}),R.$emit("switchMV"))},bindEvent(){clearInterval(this.timer);for(const[e,t]of this.rawProps)Reflect.defineProperty(HTMLVideoElement.prototype,e,t);this.rawProps.clear(),this.rawProps=void 0,m=r.body,p=p||this.findMV(),y("bind event\n",p),R.$emit("foundMV");const e=((e,t,n=!0)=>{const i=GM_getValue(t,n);return i&&(e="√  "+e),GM_registerMenuCommand(e,()=>{GM_setValue(t,!i),location.reload()}),i})(a.rememberRateMenuOption,"remberRate");window.addEventListener("urlchange",async()=>{await v(990),this.checkMV(),e&&(p.playbackRate=+localStorage.mvPlayRate||1),R.$emit("urlchange")}),top!=self&&(top.postMessage({id:"gm-h5-init-MVframe"},"*"),window.addEventListener("message",e=>{e.source&&e.data&&e.data.id&&"gm-h5-toggle-fullScreen"===e.data.id&&(h?h.toggle():x(F.btnFS))},!1)),$(p).one("canplay",()=>{if(F.isLive=F.isLive||p.duration==1/0,F.isLive)for(const e of[37,1061,39,1063,67,77,78,88,90])_.delete(e);else e&&(p.playbackRate=+localStorage.mvPlayRate||1),p.addEventListener("ratechange",()=>{e&&p.playbackRate&&1!=p.playbackRate&&(localStorage.mvPlayRate=p.playbackRate)});this.checkMV(),R.$emit("canplay")}),$(m).keydown(this.hotKey.bind(this)),F.mvShell?this.shellEvent():this.setShell(),this.checkUI(),F.multipleV&&(new MutationObserver(this.onGrowVList.bind(this)).observe(m,f),this.vCount=0,this.onGrowVList())},init(){const e=EventTarget.prototype.addEventListener;EventTarget.prototype.addEventListener=function(...t){if(!(this instanceof HTMLMediaElement&&"dblclick"==t[0]&&!t[1].toString().includes("actList.get(1037)")||"ratechange"==t[0]&&"baidu"==L&&!t[1].toString().includes("localStorage.mvPlayRate")))return e.apply(this,t)};for(const e of this.rawProps.keys())this.rawProps.set(e,Reflect.getOwnPropertyDescriptor(HTMLMediaElement.prototype,e));this.vList=r.getElementsByTagName("video");const t=e=>F.cssMV?e.matches(F.cssMV):e.offsetWidth>9;this.findMV=c.bind(this.vList,t),this.timer=P(e=>{p=e,this.bindEvent()},this.findMV),w(async e=>{R.$emit("addShadowRoot",e),await v(600),p||(p=S("video",e))&&(y("Found MV in ShadowRoot\n",p,e),F.shellCSS||(F.mvShell=e.host),this.bindEvent(),this.vList=e.getElementsByTagName("video"),this.findMV=c.bind(this.vList,t))})}},O={ted(){F.fullCSS="button[title=Fullscreen]"},youtube(){GM_addStyle(".gm-fp-body #player-container-inner{padding-top:0!important}\n\t\t\t.gm-fp-body #player-container-outer{\n\t\t\t\tmax-width:100%!important;\n\t\t\t\tmargin:0!important;\n\t\t\t}"),F.shellCSS="#player",F.playCSS="button.ytp-play-button",F.nextCSS="a.ytp-next-button",F.fullCSS="button.ytp-fullscreen-button",F.isClickOnVideo=!0,_.delete(32),_.set(69,_.get(70)).delete(70),_.set(86,_.get(67)).delete(67)},douyin(){F.isLive=l.startsWith("live."),F.fullCSS=".xgplayer-fullscreen",F.isLive||(GM_addStyle(".xgplayer-progress-cache{background-color:green!important}"),_.set(65,_.get(90)).delete(90),_.set(83,_.get(88)).delete(88),_.set(86,_.get(67)).delete(67))},qq(){if(self!=top&&("v.qq.com"==l||"video.qq.com"==l))throw a.mainPageOnly;_.delete(32),F.shellCSS="#player",F.nextCSS=".txp_btn_next_u",F.webfullCSS=".txp_btn_fake",F.fullCSS=".txp_btn_fullscreen",I.rawProps.set("playbackRate",1);for(let e=37;e<=40;e++)_.delete(e)},youku(){_.delete(37),_.delete(39),l.startsWith("vku.")?(R.$on("canplay",()=>{F.isLive=!S(".spv_progress")}),F.fullCSS=".live_icon_full"):(R.$on("foundMV",()=>{$(document).unbind("keyup")}),F.shellCSS="#ykPlayer",F.webfullCSS=".kui-webfullscreen-icon-0",F.fullCSS=".kui-fullscreen-icon-0",F.nextCSS=".kui-next-icon-0")},bilibili(){F.isLive=l.startsWith("live."),F.isLive||(_.delete(32),R.$on("addShadowRoot",e=>{"BWP-VIDEO"===e.host.nodeName&&(I.vList=r.getElementsByTagName("bwp-video"),I.findMV=c.bind(I.vList,e=>e.offsetWidth>9),p=e.host,I.bindEvent())}),F.shellCSS="#bilibili-player",F.nextCSS=".bpx-player-ctrl-next",F.webfullCSS=".bpx-player-ctrl-web",F.fullCSS=".bpx-player-ctrl-full")},iqiyi(){F.fullCSS=".iqp-btn-fullscreen:not(.fake__click)",F.nextCSS=".iqp-btn-next"},pptv(){F.fullCSS=".w-zoom-container > div",F.webfullCSS=".w-expand-container > div",F.nextCSS=".w-next"},mgtv(){F.fullCSS="mango-screen",F.webfullCSS="mango-webscreen > a",F.nextCSS="mango-control-playnext-btn"},ixigua(){F.fullCSS='div[aria-label="全屏"]',F.nextCSS=".xgplayer-control-item.control_playnext",GM_addStyle(".gm-fp-body .xgplayer{padding-top:0!important} .gm-fp-wrapper #player_default{max-height: 100%!important} h1.title~a, .videoTitle h1~a{ padding-left:12px; color:blue; }")},miguvideo(){F.nextCSS=".next-btn",F.fullCSS=".zoom-btn",F.shellCSS=".mod-player"},baidu(){I.rawProps.set("playbackRate",1)},weibo(){F.multipleV=s.startsWith("/u/")},acfun(){F.nextCSS=".btn-next-part .control-btn",F.webfullCSS=".fullscreen-web",F.fullCSS=".fullscreen-screen"},163:()=>(F.multipleV=l.startsWith("news."),GM_addStyle("div.video,video{max-height: 100% !important;}"),l.split(".").length>3),sohu(){F.nextCSS="li.on[data-vid]+li a",F.fullCSS=".x-fullscreen-btn",F.webfullCSS=".x-pagefs-btn"},fun(){F.nextCSS=".btn-item.btn-next"},le(){GM_addStyle(".gm-fp-body .le_head{display:none!important}"),F.cssMV="#video video",F.shellCSS="#video",F.nextCSS=".hv_ico_next";const e=()=>{p.offsetWidth||Object.values(p.attributes).reverse().some(e=>{if(""==p.getAttribute(e.name))return p.removeAttribute(e.name),!0})};R.$on("urlchange",e),R.$once("canplay",e)},nnyy(){GM_registerMenuCommand(a.videoLag,()=>{p.pause();const e=p.currentTime,t=p.buffered;p.currentTime=t.end(t.length-1)+1,$(p).one("progress",()=>{p.currentTime=e,p.play()})}),F.nextCSS=".playlist .on + li a"},douban(){F.nextCSS="a.next-series"},douyu(){F.isLive=!l.startsWith("v."),F.isLive?(F.cssMV=".layout-Player video",F.shellCSS="#js-player-video",F.webfullCSS=".wfs-2a8e83",F.fullCSS=".fs-781153",F.playCSS="div[class|=play]","/"!=s&&$(()=>{S(".u-specialStateInput").checked=!0})):R.$on("addShadowRoot",async function(e){e.host.matches("#demandcontroller-bar")&&(await v(600),F.shellCSS="div[fullscreen].video",F.btnFP=S(".ControllerBar-PageFull",e),F.btnFS=S(".ControllerBar-WindowFull",e))})},yy(){F.isLive=!s.startsWith("/x/"),F.isLive&&(F.fullCSS=".yc__fullscreen-btn",F.webfullCSS=".yc__cinema-mode-btn",F.playCSS=".yc__play-btn")},huya(){if(E&&E<57)return!0;F.disableDBLClick=!0,F.webfullCSS=".player-fullpage-btn",F.fullCSS=".player-fullscreen-btn",F.playCSS="#player-btn",P(C,".login-tips-close"),localStorage["sidebar/ads"]="{}",localStorage["sidebar/state"]=0},twitch(){F.isLive=!s.startsWith("/videos/"),F.fullCSS="button[data-a-target=player-fullscreen-button]",F.webfullCSS=".player-controls__right-control-group > div:nth-child(4) > button",F.playCSS="button[data-a-target=player-play-pause-button]"},longzhu(){F.fullCSS="a.ya-screen-btn"},deno(){F.webfullCSS=".i-mdi-fit-to-screen",F.fullCSS=".i-ri-fullscreen-fill"},zhanqi(){localStorage.lastPlayer="h5",F.fullCSS=".video-fullscreen"}};l.startsWith("lemonlive")&&!O[L]&&(O[L]=O.deno),Reflect.defineProperty(navigator,"plugins",{get:()=>({length:0})}),GM_registerMenuCommand(a.helpMenuOption,alert.bind(o,a.helpBody)),O[L]&&O[L]()||I.init(),O[L]||F.isNumURL||(F.isNumURL=/[_\W]\d+(\/|\.[a-z]{3,8})?$/.test(s));