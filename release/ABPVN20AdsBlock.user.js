// ==UserScript==
// @name        ABPVN AdsBlock
// @namespace   ABPVN
// @author      ABPVN
// @copyright   ABPVN
// @homepage    https://abpvn.com
// @supportURL  https://github.com/abpvn/abpvn/issues
// @icon        https://abpvn.com/icon.png
// @contributionURL https://abpvn.com/donate/
// @grant       GM_getValue
// @grant       GM_setValue
// @grant       GM_openInTab
// @grant       GM_registerMenuCommand
// @include     http://*
// @include     https://*
// @version     2.3.32
// @change-log  Update mediafire.com auto download
// @run-at      document-end
// @downloadURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/ABPVN20AdsBlock.user.js
// @updateURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/ABPVN20AdsBlock.meta.js
// ==/UserScript==
var t,e,n,o,i,r,a;String.prototype.startWith=function(t){return"function"==typeof this.indexOf&&0===this.indexOf(t)},String.prototype.ismatch=function(t){return"function"==typeof this.match&&null!==this.match(t)},t={hideLinkUnlock:function(){var t,e,n,o,i,r=document.querySelectorAll(".onp-sl-content,.onp-locker-call,[data-locker-id]");if(r.length){for(e in a.cTitle(),document.getElementById("abpvn_style")||((t=document.createElement("style")).id="abpvn_style",t.innerHTML=".onp-sl-content{display:block!important;}.onp-sl,.onp-sl-overlap-box{display:none!important;}.onp-sl-blur-area{filter: none!important;}",document.body.appendChild(t)),r)r[e].firstChild&&"Unlocked by ABPVN.COM"!=r[e].firstChild.innerText&&((n=document.createElement("div")).innerHTML='<a href="http://abpvn.com" target="_blank" style="color: #08BE54;font-weight: bold;">Unlocked by ABPVN.COM</a>',n.style.textAlign="right",r[e].insertBefore(n,r[e].firstChild)),r[e].style&&(r[e].style.display="block");for(i in o=document.querySelectorAll('.onp-sl,div[id^="content-locker"]'))o[i].style&&(o[i].style.display="none !important",o[i].setAttribute("hidden","hidden"))}},removeShortLink:function(){var t,n,o,i,r=document.querySelectorAll('a[href*="/full/?api="]'),c=0;if(r.length){for(a.cTitle(),t=0;t<r.length;t++)(o=(n=r[t]).getAttribute("href").match(/url=(.+?)&|$/))[1]&&(n.setAttribute("href",atob(o[1].replace(/=+$/,""))),i=n.getAttribute("title"),n.setAttribute("title",i?i+" ":"Short link by pass by ABPVN.COM"),c++);e.info("By pass "+c+" short link")}},showBodyLinkByPassAndRedirect:function(t){document.body.innerHTML="<style>html,body{background: #fff !important;}h1{color: #00dc58;}a{color: #015199}a h1{color: #015199;}</style><center><h1>ABPVN quick bypass đã hoạt động</h1><a href='https://abpvn.com/donate'><h1>Ủng hộ ABPVN</h1></a><br/>Không tự chuyển trang? <a href='"+t+"' title='Chuyển trang'>Click vào đây</a></center>",setTimeout(()=>location.href=t,500)},quickByPassLink:function(){var t,n,o,i,r,a,c,l=/share4you.pro|derow.win/;if(/123link\..*|phlame.pw|megaurl\.*|www.123l\.*|vinaurl\.*|share4you.pro|doxeaz10.site|derow.win|linkviet.net|ez4linkss.com|ckk.ai|link\.codevn\.net|linksht.com|beta.shortearn.eu|getlink\.tienichmaytinh\.net|download.baominh.tech|download3s.net/.test(location.hostname))try{t=function(t){return"disabled"===t.attributeName&&!t.target.disabled||"class"===t.attributeName&&!t.target.classList.contains("disabled")},o=new MutationObserver(e=>{e.forEach(e=>{t(e)&&e.target.click(),"href"===e.attributeName&&(n=e.target.getAttribute("href"),this.showBodyLinkByPassAndRedirect(n))})}),i={attributes:!0},(r=document.getElementById("invisibleCaptchaShortlink")||document.querySelector(".download_1"))?o.observe(r,i):document.querySelector("#originalLink")?(n=document.querySelector("#originalLink").getAttribute("href"),this.showBodyLinkByPassAndRedirect(n)):(a=document.querySelector(".get-link"),c=l.test(location.hostname)?6e3:100,a&&(o.observe(a,i),/megaurl\.*|vinaurl\.*|doxeaz10.site|linkviet.net|ez4linkss.com|ckk.ai|link\.codevn\.net|beta.shortearn.eu|getlink\.tienichmaytinh\.net|download.baominh.tech|download3s.net/.test(location.hostname)||setTimeout(function(){$("#go-link").addClass("go-link").trigger("submit.adLinkFly.counterSubmit").one("submit.adLinkFly.counterSubmit",function(t){t.preventDefault(),l.test(location.hostname)||location.reload()})},c)))}catch(t){e.error(t)}},wikiall_org:function(){var t,e;"wikiall.org"==location.hostname&&document.querySelector("#timer")&&(t=new MutationObserver(t=>{t.forEach(t=>{if("childList"==t.type){var e=t.target.querySelector("a");this.showBodyLinkByPassAndRedirect(e.getAttribute("href"))}})}),e=document.querySelector("#place"),t.observe(e,{childList:!0}))},link1s_com:function(){window.addEventListener("DOMContentLoaded",()=>{var t,n;let o=document.querySelector("a#link1s");if(o&&o.getAttribute("href").match(/http?s:\/\//)){e.info("Link1s.com step 1 match");let t=o.getAttribute("href");return void this.showBodyLinkByPassAndRedirect(t)}if(document.querySelector("#link1s-snp .btn-primary")){e.info("Link1s.com step 2 match"),e.info("Finding next url");let t=[...document.querySelectorAll("script")].map(t=>t.innerText).join("\n").match(/link1sLink\s=\s\'(.+)\';/);if(t&&t[1])return void this.showBodyLinkByPassAndRedirect(t[1])}t=new MutationObserver(t=>{t.forEach(t=>{"href"===t.attributeName&&(link=t.target.getAttribute("href"),this.showBodyLinkByPassAndRedirect(link))})}),n={attributes:!0,subtree:!0},"link1s.com"===location.hostname&&(document.querySelector(".get-link")||document.querySelector(".skip-ad"))&&(e.info("Link1s.com step 3 match"),t.observe(document.querySelector(".get-link")||document.querySelector(".skip-ad"),n))})},init:function(){r.getValue("unlock_content",!0)&&(window.addEventListener("DOMContentLoaded",this.hideLinkUnlock),window.addEventListener("load",this.hideLinkUnlock),this.hideLinkUnlock()),r.getValue("remove_short_link",!0)&&window.addEventListener("DOMContentLoaded",this.removeShortLink),r.getValue("quick_by_pass_link",!0)&&(this.quickByPassLink(),this.wikiall_org(),this.link1s_com())}},e={style:"color: #00DC58",info:function(t){console.info("%cABPVN.COM Info: ",this.style,t)},warn:function(t){console.warn("%cABPVN Warn: ",this.style,t)},error:function(t){console.error("%cABPVN Error: ",this.style,t)},log:function(t){console.log("%cABPVN Log: ",this.style,t)}},n={showBodyLinkDownloadAndRedirect:function(t,e){document.body.innerHTML="<style>html,body{background: #fff !important;}h1{color: #00dc58;}a{color: #015199}a h1{color: #015199;}</style><center><h1>ABPVN "+t+" download đã hoạt động</h1><a href='https://abpvn.com/donate'><h1>Ủng hộ ABPVN</h1></a><br/>Không tự tải xuống? <a href='"+e+"' title='Download'>Click vào đây</a></center>",location.href=e},mediafire_com:function(t){var e,n,o;if(this.url.startWith("http://www.mediafire.com/file/")||this.url.startWith("https://www.mediafire.com/file/")){if(t||(t=0),t>10)return;if(!(e=document.querySelector(".download_link a.input")))return setTimeout(()=>{this.mediafire_com(t++)},300);n=e.getAttribute("data-scrambled-url"),(o=atob(n)).startWith("http")&&this.showBodyLinkDownloadAndRedirect("MediaFire",o)}},init:function(){this.url=location.href,r.getValue("quick_download",!0)&&this.mediafire_com()}},o={elementExist:function(t){return null!=document.querySelector(t)},getAllText:function(t){var e,n="",o=document.querySelectorAll(t);if(o)for(e in o)o[e].innerText&&(n+=o[e].innerText);return n},getScript:function(t){var e=new XMLHttpRequest;e.open("GET",t),e.addEventListener("load",function(){var t=new Blob([e.responseText],{type:"text/javascript"}),n=URL.createObjectURL(t),o=document.createElement("script");o.src=n,o.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(o)}),e.send()},loadCss:function(t,e){var n=document.createElement("link");n.rel="stylesheet",n.id=e,n.href=t,document.getElementsByTagName("head")[0].appendChild(n)},antiAdblockRemover:function(){try{var t="By pass adBlock detect rồi nhé! Hahahahaha 😁😁😁";"function"==typeof adBlockDetected&&(adBlockDetected=function(){e.info(t)}),"function"==typeof showAdsBlock&&(showAdsBlock=function(){e.info(t)}),"function"==typeof nothingCanStopMeShowThisMessage&&(nothingCanStopMeShowThisMessage=function(){e.info(t)})}catch(t){e.error(t)}},ios_codevn_net:function(){if(this.url.match(/ios\.codevn\.net/)){const t=document.createElement("style");t.innerHTML='div[id*="ScriptRoot"]{height: 1px !important;}',document.head.appendChild(t),a.cTitle()}},linkneverdie:function(){if(this.url.match(/linkneverdie/)){const t=$.prototype.html;$.prototype.html=function(arguments){if("body"===this.selector&&(""===arguments||arguments.includes("huong-dan")))return a.cTitle(),void e.info("😁😁Anti Adblock à? Còn lâu nhé!");t.call(this,arguments)}}},redirect_dafontvn_com(){this.url.startWith("https://redirect.dafontvn.com")&&(a.cTitle(),window.addEventListener("load",()=>{var t=aesCrypto.decrypt(convertstr($.urlParam("o")),convertstr("root"));location.href=t}))},game24h_vn:function(){this.url.startWith("https://game24h.vn")&&"function"==typeof addGameIframe&&(a.cTitle(),document.querySelector("#playBtn").style.display="none",addGameIframe())},removeRedir:function(t){if(this.url.match(new RegExp(t.url,"g"))||this.url.startWith(t.url)){a.cTitle();var n=document.querySelectorAll(t.selector||'a[href^="'+t.replace+'"]');e.info("Remove Redirect for "+n.length+" links"),n.length&&n.forEach(function(e){for(var n=e.getAttribute("href").replace(t.replace,""),o=0;n.indexOf("%2")>-1&&o<5;)n=decodeURIComponent(n),o++;for(o=0;0===n.indexOf("aHR0c")&&o<5;)n=atob(n),o++;e.setAttribute("href",n),e.setAttribute("title","Link đã xóa chuyển hướng trung gian bởi abpvn.com")}.bind(this))}},removeRedirect(){[{url:"https://samsungvn.com",replace:"https://samsungvn.com/xfa-interstitial/redirect?url="},{url:"https://forum.vietdesigner.net",replace:"redirect/?url="},{url:"www.webtretho.com/forum/",replace:/http(s?):\/\/webtretho\.com\/forum\/links\.php\?url=/,selector:'a[href*="webtretho.com/forum/links.php?url="]'},{url:"https://tuong.me/",replace:"https://tuong.me/chuyen-huong/?url="},{url:"https://yhocdata.com/",replace:"https://yhocdata.com/redirect/?url="},{url:"https://vn-z.vn/",replace:"https://vn-z.vn/redirect?to="},{url:"https://romgoc.net",replace:"https://romgoc.net/redirect-to/?url="},{url:"https://tophanmem.com",replace:"https://tophanmem.com/redirect-to/?url="},{url:"https://anonyviet.com",replace:"https://anonyviet.com/tieptucdidentrangmoi/?url="},{url:"https://icongnghe.com",replace:"https://icongnghe.com/download/?url="},{url:"www.hdvietnam.",selector:'a[href*="/diendan/chuyenlink.php?url="]',replace:/http(s?):\/\/www.hdvietnam\.(com|me)\/diendan\/chuyenlink\.php\?url=/},{url:"anonyviet.com",replace:"https://anonyviet.com/tieptucdentrangmoi/?url="}].forEach(function(t){this.removeRedir(t)}.bind(this))},init:function(){this.url=location.href,r.getValue("remove_redirect",!0)&&this.removeRedirect(),this.antiAdblockRemover(),this.ios_codevn_net(),this.linkneverdie(),this.redirect_dafontvn_com(),this.game24h_vn()}},i={mgIdAdRemover:function(){var t,n;if(!/ios\.codevn\.net/.test(location.hostname)&&(t=document.querySelectorAll('[id*="ScriptRoot"]'))&&t.length)for(a.cTitle(),e.log("Removed mgIdAd placeholder"),n=0;n<t.length;n++)"megaup.net"!==location.hostname&&(t[n].id="ScriptRoot-removed-by-abpvn-"+Math.random()),t[n].innerHTML=""},noAdsModal:function(){if(location.hostname.match(/vebo|90phut|khomuc|xoilac|banhkhuc/)){const t=document.createElement("style");t.innerHTML="html,body{overflow: auto!important} .modal-backdrop,.modal{display: none!important}",document.head.appendChild(t),a.cTitle()}},init:function(){this.url=location.href,this.mgIdAdRemover(),this.noAdsModal()}},r={urls:{setting:"https://abpvn.com/script-setting.html",issue:"https://github.com/abpvn/abpvn/issues/new",fanpage:"https://www.facebook.com/abpvn.org"},openUrl:function(t){"function"==typeof GM_openInTab&&GM_openInTab(t)},getValue:function(t,e){var n;return"function"==typeof GM_getValue&&(n=GM_getValue(t)),void 0===n?e:n},setValue:function(t,e){if("function"==typeof GM_setValue)return GM_setValue(t,e)},setUpSetting:function(){var t,e;this.url===this.urls.setting&&(t=document.querySelector("#setting-container"))&&(t.classList.add("installed"),(e=t.querySelectorAll('input[type="checkbox"]'))&&e.forEach(t=>{t.checked=this.getValue(t.name,!0),t.addEventListener("change",t=>{var e=t.target.name;this.setValue(e,t.target.checked)})}))},init:function(){this.url=location.href,"function"==typeof GM_registerMenuCommand&&(GM_registerMenuCommand("ABPVN - Cài đặt",()=>{this.openUrl(this.urls.setting)}),GM_registerMenuCommand("ABPVN - Báo lỗi",()=>{this.openUrl(this.urls.issue)}),GM_registerMenuCommand("ABPVN - Fanpage",()=>{this.openUrl(this.urls.fanpage)})),this.setUpSetting()}},(a={cTitle:function(){-1===document.title.indexOf(" - Fixed by ABPVN.COM")&&(document.title=document.title+" - Fixed by ABPVN.COM")},init:function(){i.init(),n.init(),o.init(),t.init(),window===window.parent&&r.init()}}).init();