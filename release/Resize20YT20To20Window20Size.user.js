// ==UserScript==
// @name            Resize YT To Window Size
// @author          Chris H (Zren / Shade)
// @license         MIT
// @icon            https://s.ytimg.com/yts/img/favicon_32-vflOogEID.png
// @homepageURL     https://github.com/Zren/ResizeYoutubePlayerToWindowSize/
// @namespace       http://xshade.ca
// @version         139
// @include         http*://*.youtube.com/*
// @include         http*://youtube.com/*
// @include         http*://*.youtu.be/*
// @include         http*://youtu.be/*
// @grant           none
// @downloadURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/Resize20YT20To20Window20Size.user.js
// @updateURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/Resize20YT20To20Window20Size.meta.js
// ==/UserScript==
!function(e){"use strict";function t(e){return void 0===e}function a(e,t){var a,n={};for(a in e)n[e[a]]=t;return n}function n(e,t){var a=t.key===w;(t.target===document.body||"player-api"===t.target.id||"movie_player"===t.target.id||function(e,t){for(var a=e.parentNode;a;){if(a==t)return!0;a=a.parentNode}return!1}(t.target,document.querySelector("#movie_player")))&&a&&(t.preventDefault(),t.stopPropagation(),console.log("cancelIfToggleKey.validKeyCallback",e,"e",t),e&&e())}var i,o,r,l,p,d,s,y,c,u,h,m,g,f="100vh",w="w",b=e;b.ytwp||function(){try{return e.self!==e.top}catch(e){return!0}}()||((i=function(e){this.id=e,this.stylesheet=""}).prototype.buildRule=function(e,t){var a,n="";for(a in t)n+="\t"+a+": "+t[a]+";\n";return e+" {\n"+n+"}\n"},i.prototype.appendRule=function(e,a,n){var i,o;if(e instanceof Array&&(e=e.join(",\n")),t(a)||t(n)||"string"!=typeof a){if(t(a)||!t(n)||"object"!=typeof a)return void console.log("Illegal arguments",arguments);i=this.buildRule(e,a)}else(o={})[a]=n,i=this.buildRule(e,o);this.stylesheet+=i},i.injectIntoHeader=function(e,t){var a=document.getElementById(e);a||((a=document.createElement("style")).type="text/css",a.id=e,document.getElementsByTagName("head")[0].appendChild(a)),a.appendChild(document.createTextNode(t))},i.prototype.injectIntoHeader=function(){i.injectIntoHeader(this.id,this.stylesheet)},(o=function(){}).listeners=[],o.dispatch=function(e,t,a){var n,i,o=this.listeners;for(n=0,i=o.length;n<i;n++)o[n].call(this,e,t,a)},o.onPushState=function(t,a,n){return o.dispatch(t,a,n),o.origPushState.apply(e.history,arguments)},o.onReplaceState=function(t,a,n){return o.dispatch(t,a,n),o.origReplaceState.apply(e.history,arguments)},o.inject=function(){o.injected||(o.origPushState=e.history.pushState,o.origReplaceState=e.history.replaceState,e.history.pushState=o.onPushState,e.history.replaceState=o.onReplaceState,o.injected=!0)},o.timerId=0,o.onTick=function(){var t=e.location.pathname+e.location.search;o.lastPage!=t&&(o.dispatch({},document.title,e.location.href),o.lastPage=t)},o.startTimer=function(){o.lastPage=e.location.pathname+e.location.search,o.timerId=setInterval(o.onTick,500)},o.stopTimer=function(){clearInterval(o.timerId)},e.ytwpHistoryEvent=o,l=(r="ytwp")+"-style",d=r+"-viewing-video",s=r+"-scrolltop",c="body."+(p=r+"-window-player"),u=(y='html:not([fullscreen="true"])')+" "+(c+=":not(.enhancer-for-youtube-pinned-player)"),h=["transition","-ms-transition","-moz-transition","-webkit-transition","-o-transition"],m=["transform","-ms-transform","-moz-transform","-webkit-transform","-o-transform"],g=b.ytwp={scriptShortName:r,log_:function(e,t){return e.apply(console,["["+this.scriptShortName+"] "].concat(Array.prototype.slice.call(t))),1},log:function(){return this.log_(console.log,arguments)},error:function(){return this.log_(console.error,arguments)},initialized:!1,pageReady:!1,isWatchPage:!1},g.debugPage=function(){function e(e){var t=e.outerHTML;return t.substr(0,t.indexOf(">")+1)}for(var t,a,n,i={display:"block",position:"static",left:"auto",right:"auto",top:"auto",bottom:"auto","padding-left":"0px","padding-right":"0px","padding-top":"0px","padding-bottom":"0px","margin-left":"0px","margin-right":"0px","margin-top":"0px","margin-bottom":"0px",width:"auto","min-width":"auto","max-width":"auto",height:"auto","min-height":"auto","max-height":"auto"},o=Object.keys(i),r=document.querySelector("#movie_player video"),l="";r&&r.parentNode;){for(n of(a={},t=getComputedStyle(r)))o.includes(n)&&t[n]!=i[n]&&(a[n]=t[n]);l+=e(r)+" "+JSON.stringify(a)+"\n",r=r.parentNode}l=l.split("\n").reverse().join("\n"),g.log("debugPage",l)},g.hasYoutubeChanged=function(){var e,t,a,n,i=["html","body","ytd-app","#content.ytd-app","ytd-page-manager#page-manager.ytd-app","ytd-watch-flexy.ytd-page-manager","#full-bleed-container.ytd-watch-flexy","#player-full-bleed-container.ytd-watch-flexy","#player-container.ytd-watch-flexy","ytd-player#ytd-player.ytd-watch-flexy","#container.ytd-player",".html5-video-player",".html5-video-container","video.html5-main-video"];if(i=i.reverse(),!(e=document.querySelector(i[0])))return g.error("YT has changed!",i[0],"no longer exists!"),!0;for(t=1;t<i.length;t++)a=e.parentNode,n=i[t],a.matches(n)?e=a:g.error("YT has changed!",n,"no longer exists!");return!1},g.isWatchUrl=function(e){return e||(e=b.location.href),e.match(/https?:\/\/(www\.)?youtube.com\/(c|channel|user)\/[^\/]+\/live/)?!document.querySelector("ytd-browse"):e.match(/https?:\/\/(www\.)?youtube.com\/watch\?/)},g.setTheaterMode=function(e){var t,a=document.querySelector("ytd-watch:not([hidden])")||document.querySelector("ytd-watch-flexy:not([hidden])")||document.querySelector("ytd-watch-grid:not([hidden])");a?(e!=a.hasAttribute("theater")&&((t=document.querySelector(a.tagName+":not([hidden]) button.ytp-size-button"))||(t=document.querySelectorAll(a.tagName+":not([hidden]) button.ytp-screen-mode-settings-button")[1]),t&&t.click()),a.canFitTheater_=!0):(a=document.querySelector("#page.watch"))&&e!=a.classList.contains("watch-stage-mode")&&(t=a.querySelector("button.ytp-size-button"))&&t.click()},g.enterTheaterMode=function(){document.body.classList.contains(p)&&g.setTheaterMode(!0)},g.enterTheaterMode(),b.addEventListener("resize",g.enterTheaterMode),g.detectPlayerUnavailable=function(){document.querySelector("[player-unavailable]")&&g.event.removeBodyClass()},g.init=function(){g.log("init"),g.initialized||(g.isWatchPage=g.isWatchUrl(),g.isWatchPage&&(g.removeSearchAutofocus(),document.getElementById(l)||g.event.initStyle(),g.initScroller(),g.initialized=!0,g.pageReady=!1)),g.event.onWatchInit(),g.isWatchPage&&g.html5PlayerFix()},g.initScroller=function(){b.addEventListener("scroll",g.onScroll,!1),b.addEventListener("resize",g.onScroll,!1),g.onScroll()},g.onScroll=function(){var e=document.documentElement.clientHeight;g.isWatchPage&&0==b.scrollY?document.body.classList.add(s):document.body.classList.remove(s),g.isWatchPage&&b.scrollY<=e?document.body.classList.add(d):document.body.classList.remove(d)},g.event={initStyle:function(){g.log("initStyle"),g.style=new i(l),g.event.buildStylesheet(),b.spf&&(u=y+" "+(c='body[data-spf-name="watch"]'),g.event.buildStylesheet(),g.style.appendRule('body[data-spf-name="watch"]:not(.ytwp-window-player) #masthead-positioner',{position:"absolute",top:f+" !important"})),g.style.injectIntoHeader()},buildStylesheet:function(){var e;g.log("buildStylesheet"),g.style.appendRule(c+"::-webkit-scrollbar",{width:"0 !important",height:"0 !important"}),g.style.appendRule("html",{"scrollbar-width":"none"}),(e=a(h,"left 0s linear, padding-left 0s linear")).padding="0 !important",e.margin="0 !important",g.style.appendRule([c+" #player",c+".ytcenter-site-center.ytcenter-non-resize.ytcenter-guide-visible #player",c+".ltr.ytcenter-site-center.ytcenter-non-resize.ytcenter-guide-visible.guide-collapsed #player",c+".ltr.ytcenter-site-center.ytcenter-non-resize.ytcenter-guide-visible.guide-collapsed #player-legacy",c+".ltr.ytcenter-site-center.ytcenter-non-resize.ytcenter-guide-visible.guide-collapsed #watch7-main-container"],e),(e=a(h,"width 0s linear, left 0s linear")).float="initial",e.left=0,e["margin-left"]=0,g.style.appendRule(c+" #player-api",e),g.style.appendRule(c+" .watch-stage-mode #player .player-api",{left:"initial !important","margin-left":"initial !important"}),g.style.appendRule([u+" #player",u+" #player-wrap",u+" #player-api",y+":not(.floater):not(.iri-always-visible) "+c+" #movie_player",u+" #player-mole-container",y+":not(.floater):not(.iri-always-visible) "+c+" .html5-video-container",y+":not(.floater):not(.iri-always-visible) "+c+" .html5-main-video",u+" ytd-watch-flexy[theater] #player-theater-container.ytd-watch-flexy",u+" ytd-watch-flexy[flexy] #player-container-outer.ytd-watch-flexy",u+" ytd-watch-flexy[flexy] #player-container-inner.ytd-watch-flexy",u+" ytd-watch-flexy[flexy] #player-container.ytd-watch-flexy",u+" ytd-watch-grid[theater] #player-theater-container.ytd-watch-grid",u+" ytd-watch-grid[flexy] #player-container-outer.ytd-watch-grid",u+" ytd-watch-grid[flexy] #player-container-inner.ytd-watch-grid",u+" ytd-watch-grid[flexy] #player-container.ytd-watch-grid"],{width:"100% !important","min-width":"100% !important","max-width":"100% !important",height:f+" !important","min-height":f+" !important","max-height":f+" !important"}),g.style.appendRule([u+" #player",u+" .html5-main-video"],{top:"0 !important",right:"0 !important",bottom:"0 !important",left:"0 !important"}),g.style.appendRule(u+" #player .player-width","width","100% !important"),g.style.appendRule(u+" #player .player-height","height","100% !important"),g.style.appendRule([u+" .html5-video-player .ad-container-single-media-element-annotations",u+" .html5-video-player .ytp-upnext"],"top","0"),g.style.appendRule(u+" .ytp-fit-cover-video .html5-main-video","object-fit","contain !important"),g.style.appendRule(u+" .ytp-cued-thumbnail-overlay-image",{"background-size":"contain !important","-moz-background-size":"contain !important","-webkit-background-size":"contain !important"}),g.style.appendRule(u+" #movie_player","background-color","#000000"),g.style.appendRule(u+" #player",{position:"absolute"}),g.style.appendRule(u,{"margin-top":f}),g.style.appendRule(u+" button.ytp-button.ytp-cards-button","top","0"),(e=a(h,"margin-top 0s linear, padding-top 0s linear"))["margin-top"]="0 !important",e.top="0 !important",g.style.appendRule(u+" #watch7-sidebar",e),g.style.appendRule(u+".cardified-page #watch7-sidebar-contents","padding-top","0"),g.style.appendRule("#skip-navigation.ytd-masthead","top","-150vh"),e=a(h,"top 0s linear !important"),g.style.appendRule(u+".hide-header-transition #masthead-positioner",e),g.style.appendRule(u+"."+d+" #masthead-positioner",{position:"absolute",top:f+" !important"}),g.style.appendRule("html.floater "+c+"."+d+" #masthead-positioner",{"z-index":"5"}),g.style.appendRule(u+" .sbdd_a",{top:"56px"}),g.style.appendRule(u+"."+d+" .sbdd_a",{top:"calc(100vh + 56px) !important",position:"absolute !important"}),g.style.appendRule(u+"."+d+" #appbar-guide-menu",{display:"initial",position:"absolute",top:"100% !important"}),g.style.appendRule(u+"."+d+" #page.watch #guide",{display:"initial",margin:"0",position:"initial"}),g.style.appendRule(u+".lock-scrollbar",{top:"0 !important",position:"static !important"}),g.style.appendRule(u+" #miniplayer-bar #player",{position:"static"}),g.style.appendRule([u+" #miniplayer-bar #player",u+" #miniplayer-bar #player-api",y+":not(.floater):not(.iri-always-visible) "+c+" #miniplayer-bar #movie_player",u+" #player-mole-container",y+":not(.floater):not(.iri-always-visible) "+c+" #miniplayer-bar .html5-video-container",y+":not(.floater):not(.iri-always-visible) "+c+" #miniplayer-bar .html5-main-video"],{width:"252px !important","min-width":"252px !important","max-width":"252px !important",height:"142px !important","min-height":"142px !important","max-height":"142px !important"}),g.style.appendRule(".video-stream.html5-main-video",{top:"0 !important"}),g.style.appendRule(u+"."+s,"overflow-x","hidden"),g.style.appendRule(u+" #placeholder-player","display","none"),g.style.appendRule(u+" #watch-sidebar-spacer","display","none"),g.style.appendRule(u+" .skip-nav","display","none"),g.style.appendRule(u+" #page.watch","padding-top","0"),g.style.appendRule(u+" .player-branded-banner","height","0"),g.style.appendRule(u+" #body-container","position","static"),g.style.appendRule(y+".part_static_size:not(.content-snap-width-skinny-mode) "+c+" .watch-non-stage-mode #player-playlist","width","1066px"),g.style.appendRule([u+" #placeholder-playlist",u+" #player .player-height#watch-appbar-playlist"],{height:"540px !important","max-height":"540px !important"}),e=a(h,"transform 0s linear"),g.style.appendRule(u+" #watch-appbar-playlist",e),(e=a(m,"translateY(0px)"))["margin-left"]="0",e.top="calc(100vh + 60px)",g.style.appendRule(u+" #player .player-height#watch-appbar-playlist",e),g.style.appendRule(u+" .playlist-videos-list",{"max-height":"470px !important",height:"initial !important"}),g.style.appendRule(u+" #player .player-height#watch-appbar-playlist",{left:"calc((100vw - 1066px)/2 + 640px + 10px)",width:"416px"}),g.style.stylesheet+="@media screen and (min-height: 630px) and (min-width: 1294px) {\n",g.style.appendRule(u+" #player .player-height#watch-appbar-playlist",{left:"calc((100vw - 1280px)/2 + 854px + 10px)"}),g.style.stylesheet+="}\n @media screen and (min-width: 1720px) and (min-height:980px) {\n",g.style.appendRule(u+" #player .player-height#watch-appbar-playlist",{left:"calc((100vw - 1706px)/2 + 1280px + 10px)"}),g.style.stylesheet+="}\n",g.style.appendRule(u+".ytwp-scrolltop #extra-buttons","display","none !important"),g.style.appendRule("ytd-app","position","static !important"),g.style.appendRule("ytd-watch #top","margin-top","71px !important"),g.style.appendRule("ytd-watch #container","margin-top","0 !important"),g.style.appendRule("ytd-watch #content-separator","margin-top","0 !important"),g.style.appendRule([u+" ytd-watch-flexy[theater] #player-wide-container.ytd-watch-flexy",u+" ytd-watch-flexy[fullscreen] #player-wide-container.ytd-watch-flexy",u+" ytd-watch-flexy[full-bleed-player] #player-full-bleed-container.ytd-watch-flexy",u+" ytd-watch-flexy[full-bleed-player] #full-bleed-container.ytd-watch-flexy",u+" ytd-watch-grid[theater] #player-wide-container.ytd-watch-grid",u+" ytd-watch-grid[fullscreen] #player-wide-container.ytd-watch-grid",u+" ytd-watch-grid[full-bleed-player] #player-full-bleed-container.ytd-watch-grid",u+" ytd-watch-grid[full-bleed-player] #full-bleed-container.ytd-watch-grid"],{position:"static",height:0,"min-height":0}),g.style.appendRule(u+".ytwp-viewing-video ytd-app #masthead-container.ytd-app",{position:"absolute",top:f,"z-index":0}),g.style.appendRule(u+".ytwp-viewing-video ytd-watch #masthead-positioner",{top:f+" !important"}),g.style.appendRule(u+" .ytp-cued-thumbnail-overlay","z-index","10"),g.style.appendRule([u+" ytd-watch-flexy[theater] #player-theater-container.ytd-watch-flexy",u+" ytd-watch-grid[theater] #player-theater-container.ytd-watch-grid"],{position:"absolute",top:"0"}),g.style.appendRule("#page-manager.ytd-app","padding-top","var(--ytd-masthead-height,var(--ytd-toolbar-height))"),g.style.appendRule(u+" #error-screen","z-index","11")},onWatchInit:function(){g.log("onWatchInit"),g.initialized&&(g.pageReady||(g.event.addBodyClass(),g.hasYoutubeChanged()&&g.debugPage(),g.pageReady=!0))},onDispose:function(){g.log("onDispose"),g.initialized=!1,g.pageReady=!1,g.isWatchPage=!1},addBodyClass:function(){document.body.classList.add(p),g.log("Applied "+c)},removeBodyClass:function(){document.body.classList.remove(p),g.log("Removed "+c)}},g.html5PlayerFix=function(){g.log("html5PlayerFix")},g.fixMasthead=function(){g.log("fixMasthead");var e=document.querySelector("#masthead-positioner-height-offset");e&&g.fixMastheadElement(e)},g.fixMastheadElement=function(e){g.log("fixMastheadElement",e),e.style.height&&setTimeout(function(){e.style.height="",document.querySelector("#appbar-guide-menu").style.marginTop=""},0)},i.injectIntoHeader(l+"-focusfix","input#search[autofocus] { display: none; }"),g.removeSearchAutofocus=function(){var e=document.querySelector("input#search");e&&e.removeAttribute("autofocus")},g.registerMastheadFix=function(){var e,t,a,n;g.log("registerMastheadFix"),e={attributes:!0},t=function(e){if(console.log(e.type,e),"style"===e.attributeName){var t=e.target;t.style.height&&setTimeout(function(){t.style.height="",document.querySelector("#appbar-guide-menu").style.marginTop=""},0)}},a=new MutationObserver(function(e){e.forEach(function(e){t(e)})}),(n=document.querySelector("#masthead-positioner-height-offset"))&&a.observe(n,e)},g.materialPageTransition=function(){g.log("materialPageTransition"),g.init(),g.isWatchUrl()?(g.removeSearchAutofocus(),g.event.addBodyClass(),g.initialized||(g.log("materialPageTransition !ytwp.html5.app",g.html5.app),setTimeout(g.materialPageTransition,100))):(g.event.onDispose(),document.body.classList.remove(p)),g.onScroll(),g.fixMasthead(),g.attemptToUpdatePlayer()},g.registerListeners=function(){g.registerMaterialListeners(),g.registerMastheadFix()},g.registerMaterialListeners=function(){document.addEventListener("yt-page-data-fetched",g.materialPageTransition),document.addEventListener("yt-navigate-finish",g.materialPageTransition),document.addEventListener("yt-page-data-fetched",function(e){g.log("document.yt-page-data-fetched",e)}),document.addEventListener("yt-navigate-finish",function(e){g.log("document.yt-navigate-finish",e)})},g.main=function(){g.registerListeners(),g.init(),g.fixMasthead()},g.main(),g.updatePlayerAttempts=-1,g.updatePlayerMaxAttempts=150,g.attemptToUpdatePlayer=function(){0<=g.updatePlayerAttempts&&g.updatePlayerAttempts<g.updatePlayerMaxAttempts?g.updatePlayerAttempts=0:(g.updatePlayerAttempts=0,g.attemptToUpdatePlayerTick())},g.attemptToUpdatePlayerTick=function(){g.updatePlayerAttempts<g.updatePlayerMaxAttempts&&(g.updatePlayerAttempts+=1,g.updatePlayer(),requestAnimationFrame(g.attemptToUpdatePlayerTick))},g.updatePlayer=function(){g.removeSearchAutofocus(),g.enterTheaterMode(),g.detectPlayerUnavailable()},g.toggleExtension=function(){document.body.classList.toggle("ytwp-window-player"),g.setTheaterMode(document.body.classList.contains("ytwp-window-player"))},g.materialPageTransition(),setInterval(g.updatePlayer,2500),e.addEventListener("keydown",n.bind(null,g.toggleExtension),!0),e.addEventListener("keyup",n.bind(null,null),!0),e.addEventListener("keypress",n.bind(null,null),!0),"undefined"!=typeof browser&&browser.runtime.onMessage.addListener(e=>"toggle"==e.id?(g.toggleExtension(),Promise.resolve({enabled:document.body.classList.contains("ytwp-window-player")})):Promise.reject(new Error("Unreconized message.id"))))}(window);