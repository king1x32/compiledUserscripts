// ==UserScript==
// @name            ComicRead
// @namespace       ComicRead
// @version         12.3.5
// @author          hymbz
// @license         AGPL-3.0-or-later
// @noframes
// @match           *://*/*
// @connect         yamibo.com
// @connect         dmzj.com
// @connect         idmzj.com
// @connect         exhentai.org
// @connect         e-hentai.org
// @connect         hath.network
// @connect         nhentai.net
// @connect         gold-usergeneratedcontent.net
// @connect         hypergryph.com
// @connect         mangabz.com
// @connect         2025copy.com
// @connect         mangacopy.com
// @connect         copy20.com
// @connect         mangacopy.com
// @connect         xsskc.com
// @connect         schale.network
// @connect         touhou.ai
// @connect         jsdelivr.net
// @connect         npmmirror.com
// @connect         self
// @connect         127.0.0.1
// @connect         *
// @grant           GM_addElement
// @grant           GM_getResourceText
// @grant           GM_xmlhttpRequest
// @grant           GM.addValueChangeListener
// @grant           GM.removeValueChangeListener
// @grant           GM.getResourceText
// @grant           GM.getValue
// @grant           GM.setValue
// @grant           GM.listValues
// @grant           GM.deleteValue
// @grant           GM.registerMenuCommand
// @grant           GM.unregisterMenuCommand
// @grant           unsafeWindow
// @icon            data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAACBUExURUxpcWB9i2B9i2B9i2B9i2B9i2B9i2B9i2B9i2B9i2B9i2B9i2B9i2B9i2B9i////198il17idng49DY3PT297/K0MTP1M3X27rHzaCxupmstbTByK69xOfr7bfFy3WOmqi4wPz9/X+XomSBjqW1vZOmsN/l6GmFkomeqe7x8vn6+kv+1vUAAAAOdFJOUwDsAoYli9zV+lIqAZEDwV05SQAAAUZJREFUOMuFk+eWgjAUhGPBiLohjZACUqTp+z/gJkqJy4rzg3Nn+MjhwB0AANjv4BEtdITBHjhtQ4g+CIZbC4Qb9FGb0J4P0YrgCezQqgIA14EDGN8fYz+f3BGMASFkTJ+GDAYMUSONzrFL7SVvjNQIz4B9VERRmV0rbJWbrIwidnsd6ACMlEoip3uad3X2HJmqb3gCkkJELwk5DExRDxA6HnKaDEPSsBnAsZoANgJaoAkg12IJqBiPACImXQKF9IDULIHUkOk7kDpeAMykHqCEWACy8ACdSM7LGSg5F3HtAU1rrkaK9uGAshXS2lZ5QH/nVhmlD8rKlmbO3ZsZwLe8qnpdxJRnLaci1X1V5R32fjd5CndVkfYdGpy3D+htU952C/ypzPtdt3JflzZYBy7fi/O1euvl/XH1Pp+Cw3/1P1xOZwB+AWMcP/iw0AlKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC
// @resource        solid-js https://registry.npmmirror.com/solid-js/1.9.8/files/dist/solid.cjs
// @resource        fflate https://registry.npmmirror.com/fflate/0.8.2/files/umd/index.js
// @resource        jsqr https://registry.npmmirror.com/jsqr/1.4.0/files/dist/jsQR.js
// @resource        comlink https://registry.npmmirror.com/comlink/4.4.2/files/dist/umd/comlink.min.js
// @resource        solid-js|store https://registry.npmmirror.com/solid-js/1.9.8/files/store/dist/store.cjs
// @resource        solid-js|web https://registry.npmmirror.com/solid-js/1.9.8/files/web/dist/web.cjs
// @resource        _tensorflow|tfjs https://registry.npmmirror.com/@tensorflow/tfjs/4.22.0/files/dist/tf.min.js
// @resource        _tensorflow|tfjs-backend-webgpu https://registry.npmmirror.com/@tensorflow/tfjs-backend-webgpu/4.22.0/files/dist/tf-backend-webgpu.js
// @supportURL      https://github.com/hymbz/ComicReadScript/issues
// @downloadURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/ComicRead.user.js
// @updateURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/ComicRead.meta.js
// ==/UserScript==
let e="undefined"!=typeof Worker;const t={GM:"undefined"==typeof GM?void 0:GM,GM_addElement:"undefined"==typeof GM_addElement?void 0:GM_addElement,GM_getResourceText:"undefined"==typeof GM_getResourceText?void 0:GM_getResourceText,GM_xmlhttpRequest:"undefined"==typeof GM_xmlhttpRequest?void 0:GM_xmlhttpRequest,unsafeWindow:"undefined"==typeof unsafeWindow?window:unsafeWindow},n=Object.keys(t),o={process:{env:{NODE_ENV:"production"}},...t},a=Math.random().toString(36).slice(2),r=e=>{const n=t.GM_getResourceText?.(e.replaceAll("/","|").replaceAll("@","_"));if(!n)throw new Error(`å¤–éƒ¨æ¨¡å— ${e} æœªåœ¨ @Resource ä¸­å£°æ˜`);return"@tensorflow/tfjs-backend-webgpu"===e?n.replace("@tensorflow/tfjs-core","@tensorflow/tfjs"):n},s=e=>{if(e)return t.GM_addElement?GM_addElement("script",{textContent:e})?.remove():void eval.call(t.unsafeWindow,e)},i=i=>{let c;switch(i){case"helper/languages":c="\nconst langList = ['zh', 'en', 'ru'];\n/** åˆ¤æ–­ä¼ å…¥çš„å­—ç¬¦ä¸²æ˜¯å¦æ˜¯æ”¯æŒçš„è¯­è¨€ç±»å‹ä»£ç  */\nconst isLanguages = lang => Boolean(lang) && langList.includes(lang);\n\n/** è¿”å›æµè§ˆå™¨åå¥½è¯­è¨€ */\nconst getBrowserLang = () => {\n  for (const language of navigator.languages) {\n    const matchLang = langList.find(l => l === language.split('-')[0]);\n    if (matchLang) return matchLang;\n  }\n};\nconst getSaveLang = () => typeof GM === 'undefined' ? 'zh' : GM.getValue('@Languages');\nconst setSaveLang = val => typeof GM === 'undefined' || GM.setValue('@Languages', val);\nconst getInitLang = async () => {\n  const saveLang = await getSaveLang();\n  if (isLanguages(saveLang)) return saveLang;\n  const lang = getBrowserLang() ?? 'zh';\n  setSaveLang(lang);\n  return lang;\n};\n\nexports.getInitLang = getInitLang;\nexports.isLanguages = isLanguages;\nexports.langList = langList;\nexports.setSaveLang = setSaveLang;\n";break;case"helper":c='\nconst web = require(\'solid-js/web\');\nconst solidJs = require(\'solid-js\');\nconst languages = require(\'helper/languages\');\nconst store = require(\'solid-js/store\');\n\nconst getDom = id => {\n  let dom = document.getElementById(id);\n  if (dom) {\n    dom.innerHTML = \'\';\n    return dom;\n  }\n  dom = document.createElement(\'div\');\n  dom.id = id;\n  document.body.append(dom);\n  return dom;\n};\n\n/** æŒ‚è½½ solid-js ç»„ä»¶ */\nconst mountComponents = (id, fc) => {\n  const dom = getDom(id);\n  dom.style.setProperty(\'display\', \'unset\', \'important\');\n  const shadowDom = dom.attachShadow({\n    mode: \'closed\'\n  });\n  web.render(fc, shadowDom);\n  return dom;\n};\n\nclass FaviconProgress {\n  constructor(color = \'#607D8B\') {\n    this.color = color;\n    this.canvas = document.createElement(\'canvas\');\n    this.canvas.width = 32;\n    this.canvas.height = 32;\n    this.ctx = this.canvas.getContext(\'2d\');\n    const existingLink = document.querySelector("link[rel~=\'icon\']");\n    if (existingLink) this.link = existingLink;else {\n      const link = document.createElement(\'link\');\n      link.type = \'image/x-icon\';\n      link.rel = \'icon\';\n      document.head.append(link);\n      this.link = link;\n    }\n    this.initLink = this.link.href || \'/favicon.ico\';\n  }\n  update(progress) {\n    this.ctx.clearRect(0, 0, 32, 32);\n\n    // ç»˜åˆ¶èƒŒæ™¯\n    this.ctx.beginPath();\n    this.ctx.arc(16, 16, 16, 0, Math.PI * 2);\n    this.ctx.fillStyle = \'#FAFAFA\';\n    this.ctx.fill();\n\n    // ç»˜åˆ¶è¿›åº¦æ‰‡å½¢\n    const startAngle = -Math.PI / 2;\n    const endAngle = Math.PI * 2 * progress + startAngle;\n    this.ctx.beginPath();\n    this.ctx.moveTo(16, 16);\n    this.ctx.arc(16, 16, 16, startAngle, endAngle);\n    this.ctx.fillStyle = this.color;\n    this.ctx.fill();\n    this.updateFavicon();\n  }\n  updateFavicon() {\n    if (!this.link || !this.canvas) return;\n    this.link.href = this.canvas.toDataURL(\'image/png\');\n  }\n\n  /** æ¢å¤é»˜è®¤å›¾æ ‡ */\n  recover() {\n    if (!this.link || !this.initLink) return;\n    this.link.href = this.initLink;\n  }\n}\nconst useFaviconProgress = () => {\n  //\n};\n\nconst en = {alert:{comic_load_error:"Comic loading error",download_failed:"Download failed",fetch_comic_img_failed:"Failed to fetch comic images",img_load_failed:"Image loading failed",no_img_download:"No images available for download",repeat_load:"Loading image, please wait",retry_get_img_url:"Retrieve the URL of the image on page {{i}} again",server_connect_failed:"Unable to connect to the server"},button:{auto_scroll:"Auto scroll",close_current_page_translation:"Close translation of the current page",download_completed:"Download completed",download_completed_error:"Download complete, but {{errorNum}} images failed to download",downloading:"Downloading",fullscreen:"Fullscreen",fullscreen_exit:"Exit Fullscreen",grid_mode:"Grid mode",packaging:"Packaging",page_fill:"Page fill",page_mode_double:"Double page mode",page_mode_single:"Single page mode",scroll_mode:"Scroll mode",translate_current_page:"Translate current page",zoom_in:"Zoom in",zoom_out:"Zoom out"},description:"Add enhanced features to the comic site for optimized experience, including dual-page reading and translation.",eh_tag_lint:{combo:"[tag]: In most cases, Should coexist with [tag]",conflict:"[tag]: Should not coexist with [tag]",correct_tag:"Should be the correct tag",miss_female:"Missing male tag, might need",miss_parody:"Missing parody tag, might need",possible_conflict:"[tag]: In most cases, Should not coexist with [tag]",prerequisite:"[tag]: The prerequisite tag [tag] does not exist"},end_page:{next_button:"Next chapter",prev_button:"Prev chapter",tip:{end_jump:"Reached the last page, scrolling down will jump to the next chapter",exit:"Reached the last page, scrolling down will exit",start_jump:"Reached the first page, scrolling up will jump to the previous chapter"}},hotkeys:{enter_read_mode:"Enter reading mode",float_tag_list:"Floating tag list",jump_to_end:"Jump to the last page",jump_to_home:"Jump to the first page",page_down:"Turn the page to the down",page_up:"Turn the page to the up",repeat_tip:"This hotkey has been bound to \\"{{hotkey}}\\"",scroll_down:"Scroll down",scroll_left:"Scroll left",scroll_right:"Scroll right",scroll_up:"Scroll up",switch_auto_enlarge:"Switch auto image enlarge option",switch_dir:"Switch reading direction",switch_grid_mode:"Switch grid mode",switch_page_fill:"Switch page fill",switch_scroll_mode:"Switch scroll mode",switch_single_double_page_mode:"Switch single/double page mode"},img_status:{error:"Load Error",loading:"Loading",wait:"Waiting for load"},other:{auto:"Auto",custom:"Custom",disable:"Disable",distance:"distance",download:"Download",enabled:"Enabled",enter_comic_read_mode:"Enter comic reading mode",exit:"Exit",fab_hidden:"Hide floating button",fab_show:"Show floating button",fill_page:"Fill Page",hotkeys:"Hotkeys",img_loading:"Image loading",interval:"interval",loading_img:"Loading image",none:"None",or:"or",other:"Other",page_range:"Please enter the page range.:\\n (e.g., 1, 3-5, 9-)",read_mode:"Reading mode",setting:"Settings"},pwa:{alert:{img_data_error:"Image data error",img_not_found:"Image not found",img_not_found_files:"Please select an image file or a compressed file containing image files",img_not_found_folder:"No image files or compressed files containing image files in the folder",not_valid_url:"Not a valid URL",parse_error:"Parsing error",password_error:"Incorrect password",repeat_load:"Loading other filesâ€¦",userscript_not_installed:"ComicRead userscript not installed"},button:{enter_url:"Enter URL",install:"Install",no_more_prompt:"Do not prompt again",resume_read:"Restore reading",select_files:"Select File",select_folder:"Select folder"},install_md:"### Tired of opening this webpage every time?\\nIf you wish to:\\n1. Have an independent window, as if using local software\\n1. Add to the local compressed file opening method for easy direct opening\\n1. Use offline\\n### Welcome to install this page as a PWA app on your computerğŸ˜ƒğŸ‘",message:{enter_password:"Please enter your password",parsing:"Parsing"},tip_enter_url:"Please enter the URL of the compressed file",tip_md:"# ComicRead PWA\\nRead **local** comics using [ComicRead](https://github.com/hymbz/ComicReadScript) reading mode.\\n---\\n### Drag and drop image files, folders, or compressed files directly to start reading\\n*You can also choose to **paste directly** or **enter** the URL of the compressed file for downloading and reading*"},setting:{hotkeys:{add:"Add new hotkeys",restore:"Restore default hotkeys"},language:"Language",option:{abreast_duplicate:"Column duplicates ratio",abreast_mode:"Abreast scroll mode",adjust_to_width:"Adaptive Width",align_edge:"Align to edge when turning page",always_load_all_img:"Always load all images",autoFullscreen:"Auto fullscreen",autoHiddenMouse:"Auto hide mouse",auto_scale:"Auto Scale",auto_scroll_trigger_end:"Continue scrolling on the end page",auto_switch_page_mode:"Auto switch single/double page mode by aspect ratio",background_color:"Background Color",click_page_turn_area:"Touch area",click_page_turn_enabled:"Click to turn page",click_page_turn_swap_area:"Swap LR clickable areas",dark_mode:"Dark mode",dark_mode_auto:"Dark mode follow system",dir_ltr:"LTR (American comics)",dir_rtl:"RTL (Japanese manga)",disable_auto_enlarge:"Disable automatic image enlarge",first_page_fill:"Enable first page fill by default",full_width:"Viewport Width",img_recognition:"Image Recognition",img_recognition_background:"Recognition background color",img_recognition_pageFill:"Auto switch page fill",img_recognition_warn:"â— The current browser does not support Web Workers. Enabling this feature may cause page lag. It\'s recommended to upgrade or switch browsers.",img_recognition_warn_2:"â— The current website does not support Web Workers. Enabling this feature may cause page lag.",paragraph_appearance:"Appearance",paragraph_dir:"Reading direction",paragraph_display:"Display",paragraph_scrollbar:"Scrollbar",paragraph_translation:"Translation",preload_page_num:"Preload page number",scroll_end:"After reaching the End",scroll_end_auto:"First jump to previous/next chapter, else exit",scroll_mode_img_scale:"Scroll mode image zoom ratio",scroll_mode_img_spacing:"Scroll mode image spacing",scrollbar_auto_hidden:"Auto hide",scrollbar_easy_scroll:"Easy scroll",scrollbar_position:"position",scrollbar_position_bottom:"Bottom",scrollbar_position_hidden:"Hidden",scrollbar_position_right:"Right",scrollbar_position_top:"Top",scrollbar_show_img_status:"Show image loading status",show_clickable_area:"Show clickable areas",show_comments:"Show comments on the end page",shrink_menu:"Enable menu area",swap_page_turn_key:"Swap LR page-turning keys",zoom:"Image zoom ratio"},sync_options_other_site:"Sync read options to other sites",translation:{cotrans_tip:"<p>Using the interface provided by <a href=\\"https://cotrans.touhou.ai\\" target=\\"_blank\\">Cotrans</a> to translate images, which is maintained by its maintainer at their own expense.</p>\\n<p>When multiple people use it at the same time, they need to queue and wait. If the waiting queue reaches its limit, uploading new images will result in an error. Please try again after a while.</p>\\n<p>So please <b>mind the frequency of use</b>.</p>\\n<p>It is highly recommended to use your own locally deployed project, as it does not consume server resources and does not require queuing.</p>",options:{box_threshold:"Box threshold",detection_resolution:"Text detection resolution",direction:"Render text orientation",direction_auto:"Follow source",direction_horizontal:"Horizontal only",direction_vertical:"Vertical only",force_retry:"Force retry (ignore cache)",inpainter:"Inpainter",inpainting_size:"Inpainting size",local_url:"customize server URL",mask_dilation_offset:"Mask dilation offset",only_download_translated:"Download only the translated images",target_language:"Target language",text_detector:"Text detector",translator:"Translator",unclip_ratio:"Unclip ratio"},range:"Scope of Translation",server:"Translation server",server_selfhosted:"Selfhosted",translate_all:"Translate all images",translate_to_end:"Translate the current page to the end"}},site:{add_feature:{add_hotkeys_actions:"Add hotkeys actions",auto_adjust_option:"Auto adjust reading option",auto_page_turn:"Infinite scroll",auto_show:"Auto enter reading mode",block_totally:"Totally block comics",colorize_tag:"Colorize tags",cross_site_link:"Cross-site Link",detect_ad:"Detect advertise page",expand_tag_list:"Expand tag list",float_tag_list:"Floating tag list",load_original_image:"Load original image",lock_option:"Lock site option",open_link_new_page:"Open links in a new page",quick_favorite:"Quick favorite",quick_rating:"Quick rating",quick_tag_define:"Quick view tag define",remember_current_site:"Remember the current site",tag_lint:"Tag Lint"},changed_load_failed:"The website has undergone changes, unable to load comics",ehentai:{change_favorite_failed:"Failed to change the favorite",change_favorite_success:"Successfully changed the favorite",change_rating_failed:"Failed to change the rating",change_rating_success:"Successfully changed the rating",fetch_favorite_failed:"Failed to get favorite info",fetch_img_page_source_failed:"Failed to get the source code of the image page",fetch_img_page_url_failed:"Failed to get the image page address from the detail page",fetch_img_url_failed:"Failed to get the image address from the image page",hitomi_error:"hitomi matching error",html_changed_link_failed:"The page structure has changed, and the associated external site features are not functioning properly",ip_banned:"IP address is banned",nhentai_error:"nhentai matching error",nhentai_failed:"Matching failed, please refresh after confirming login to {{nhentai}}"},nhentai:{fetch_next_page_failed:"Failed to get next page of comic data",tag_blacklist_fetch_failed:"Failed to fetch tag blacklist"},show_settings_menu:"Show settings menu",simple:{auto_read_mode_message:"\\"Auto enter reading mode\\" is enabled by default",no_img:"No suitable comic images were found.\\nIf necessary, you can click here to close the simple reading mode.",simple_read_mode:"Enter simple reading mode"}},touch_area:{menu:"Menu",type:{edge:"Edge",l:"L",left_right:"Left Right",up_down:"Up Down"}},translation:{status:{colorizing:"Colorizing","default":"Unknown status",detection:"Detecting text",downscaling:"Downscaling",error:"Error during translation","error-lang":"The target language is not supported by the chosen translator","error-translating":"Did not get any text back from the text translation service","error-with-id":"Error during translation",finished:"Finishing",inpainting:"Inpainting","mask-generation":"Generating mask",ocr:"Scanning text",pending:"Pending","pending-pos":"Pending",preparing:"Waiting for idle window",rendering:"Rendering",saved:"Saved","skip-no-regions":"No text regions detected in the image","skip-no-text":"No text detected in the image",textline_merge:"Merging text lines",translating:"Translating",upscaling:"Upscaling"},tip:{check_img_status_failed:"Failed to check image status",download_img_failed:"Failed to download image",get_translator_list_error:"Error occurred while getting the list of available translation services",id_not_returned:"No id returned",img_downloading:"Downloading images",img_not_fully_loaded:"Image has not finished loading",pending:"Pending, {{pos}} in queue",resize_img_failed:"Failed to resize image",translating:"Translating image",translation_completed:"Translation completed",upload:"Uploading image",upload_error:"Image upload error",upload_return_error:"Error during server translation",wait_translation:"Waiting for translation"},translator:{baidu:"baidu",deepl:"DeepL",google:"Google","gpt3.5":"GPT-3.5",none:"Remove texts",offline:"offline translator",original:"Original",youdao:"youdao"}},upscale:{module_download_complete:"Image Upscaling Model Download Complete",module_download_failed:"Image Upscaling Model Download Failed",module_downloading:"Image Upscaling Model Downloading...",title:"Upscale Image",upscaled:"upscaled",upscaling:"upscaling",webgpu_tip:"Unable to upscale images using WebGPU, processing will be slower"}};\n\nconst ru = {alert:{comic_load_error:"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ĞºĞ¾Ğ¼Ğ¸ĞºÑĞ°",download_failed:"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸",fetch_comic_img_failed:"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ",img_load_failed:"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ",no_img_download:"ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½Ğ¾Ğº Ğ´Ğ»Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸",repeat_load:"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ° Ğ¿Ğ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚Ğµ",retry_get_img_url:"ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ°Ğ´Ñ€ĞµÑ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ½Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ {{i}}",server_connect_failed:"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ Ğº ÑĞµÑ€Ğ²ĞµÑ€Ñƒ"},button:{auto_scroll:"ĞĞ²Ñ‚Ğ¾Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºĞ°",close_current_page_translation:"Ğ¡ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹",download_completed:"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°",download_completed_error:"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°, Ğ½Ğ¾ {{errorNum}} Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ",downloading:"Ğ¡ĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ",fullscreen:"Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑĞºÑ€Ğ°Ğ½Ğ½Ñ‹Ğ¹",fullscreen_exit:"Ğ²Ñ‹Ğ¹Ñ‚Ğ¸ Ğ¸Ğ· Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑĞºÑ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°",grid_mode:"Ğ ĞµĞ¶Ğ¸Ğ¼ ÑĞµÑ‚ĞºĞ¸",packaging:"Ğ£Ğ¿Ğ°ĞºĞ¾Ğ²ĞºĞ°",page_fill:"Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ",page_mode_double:"Ğ”Ğ²ÑƒÑ…Ñ‡Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼",page_mode_single:"ĞĞ´Ğ½Ğ¾ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼",scroll_mode:"Ğ ĞµĞ¶Ğ¸Ğ¼ Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºĞ¸",translate_current_page:"ĞŸĞµÑ€ĞµĞ²ĞµÑÑ‚Ğ¸ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ",zoom_in:"ĞŸÑ€Ğ¸Ğ±Ğ»Ğ¸Ğ·Ğ¸Ñ‚ÑŒ",zoom_out:"Ğ£Ğ¼ĞµĞ½ÑŒÑˆĞ¸Ñ‚ÑŒ"},description:"Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ ÑƒĞ´Ğ¾Ğ±ÑÑ‚Ğ²Ğ° Ğ½Ğ° ÑĞ°Ğ¹Ñ‚, Ñ‚Ğ°ĞºĞ¸Ğµ ĞºĞ°Ğº Ğ´Ğ²ÑƒÑ…ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ¸ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´.",eh_tag_lint:{combo:"[Ñ‚ĞµĞ³]: Ğ’ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğ½ÑÑ‚Ğ²Ğµ ÑĞ»ÑƒÑ‡Ğ°ĞµĞ² Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ ÑĞ¾ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ [Ñ‚ĞµĞ³Ğ¾Ğ¼]",conflict:"[tag]: ĞĞµ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ ÑĞ¾ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ [tag]",correct_tag:"Ğ”Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚ĞµĞ³",miss_female:"ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ¼ÑƒĞ¶ÑĞºĞ¾Ğ¹ Ñ‚ĞµĞ³, Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ğ¿Ğ¾Ğ½Ğ°Ğ´Ğ¾Ğ±Ğ¸Ñ‚ÑÑ",miss_parody:"ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ñ‚ĞµĞ³ Ğ¿Ğ°Ñ€Ğ¾Ğ´Ğ¸Ğ¸, Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ğ¿Ğ¾Ğ½Ğ°Ğ´Ğ¾Ğ±Ğ¸Ñ‚ÑÑ",possible_conflict:"[tag]: Ğ’ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğ½ÑÑ‚Ğ²Ğµ ÑĞ»ÑƒÑ‡Ğ°ĞµĞ² Ğ½Ğµ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ ÑĞ¾ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ [tag]",prerequisite:"[tag]: ĞŸÑ€ĞµĞ´Ğ²Ğ°Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚ĞµĞ³ [tag] Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚"},end_page:{next_button:"Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ°Ñ Ğ³Ğ»Ğ°Ğ²Ğ°",prev_button:"ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ°Ñ Ğ³Ğ»Ğ°Ğ²Ğ°",tip:{end_jump:"ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ÑÑ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°, ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ°Ñ Ğ³Ğ»Ğ°Ğ²Ğ° Ğ½Ğ¸Ğ¶Ğµ",exit:"ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ÑÑ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°, Ğ½Ğ¸Ğ¶Ğµ ĞºĞ¾Ğ¼Ğ¸ĞºÑ Ğ±ÑƒĞ´ĞµÑ‚ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚",start_jump:"ĞŸĞµÑ€Ğ²Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°, Ğ²Ñ‹ÑˆĞµ Ğ±ÑƒĞ´ĞµÑ‚ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ° Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ°Ñ Ğ³Ğ»Ğ°Ğ²Ğ°"}},hotkeys:{enter_read_mode:"Ğ ĞµĞ¶Ğ¸Ğ¼ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ",float_tag_list:"ĞŸĞ»Ğ°Ğ²Ğ°ÑÑ‰Ğ¸Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ‚ĞµĞ³Ğ¾Ğ²",jump_to_end:"ĞŸĞµÑ€ĞµĞ¹Ñ‚Ğ¸ Ğº Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ",jump_to_home:"ĞŸĞµÑ€ĞµĞ¹Ñ‚Ğ¸ Ğº Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ",page_down:"ĞŸĞµÑ€ĞµĞ»Ğ¸ÑÑ‚Ğ½ÑƒÑ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ Ğ²Ğ½Ğ¸Ğ·",page_up:"ĞŸĞµÑ€ĞµĞ»Ğ¸ÑÑ‚Ğ½ÑƒÑ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ Ğ²Ğ²ĞµÑ€Ñ…",repeat_tip:"Ğ­Ñ‚Ğ° Ğ³Ğ¾Ñ€ÑÑ‡Ğ°Ñ ĞºĞ»Ğ°Ğ²Ğ¸ÑˆĞ° Ğ±Ñ‹Ğ»Ğ° Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ° Ğ½Ğ° \\"{{hotkey}}\\"",scroll_down:"ĞŸÑ€Ğ¾ĞºÑ€ÑƒÑ‚Ğ¸Ñ‚ÑŒ Ğ²Ğ½Ğ¸Ğ·",scroll_left:"ĞŸÑ€Ğ¾ĞºÑ€ÑƒÑ‚Ğ¸Ñ‚ÑŒ Ğ²Ğ»ĞµĞ²Ğ¾",scroll_right:"ĞŸÑ€Ğ¾ĞºÑ€ÑƒÑ‚Ğ¸Ñ‚Ğµ Ğ²Ğ¿Ñ€Ğ°Ğ²Ğ¾",scroll_up:"ĞŸÑ€Ğ¾ĞºÑ€ÑƒÑ‚Ğ¸Ñ‚Ğµ Ğ²Ğ²ĞµÑ€Ñ…",switch_auto_enlarge:"ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¿Ñ€Ğ¸Ğ±Ğ»Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ",switch_dir:"ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ",switch_grid_mode:"Ğ ĞµĞ¶Ğ¸Ğ¼ ÑĞµÑ‚ĞºĞ¸",switch_page_fill:"Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹",switch_scroll_mode:"Ğ ĞµĞ¶Ğ¸Ğ¼ Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºĞ¸",switch_single_double_page_mode:"ĞĞ´Ğ½Ğ¾ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ½Ñ‹Ğ¹/Ğ”Ğ²ÑƒÑ…ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼"},img_status:{error:"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸",loading:"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°",wait:"ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸"},other:{auto:"ĞĞ²Ñ‚Ğ¾",custom:"Custom",disable:"ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ",distance:"Ñ€Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ",download:"Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ",enabled:"Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾",enter_comic_read_mode:"Ğ ĞµĞ¶Ğ¸Ğ¼ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¸ĞºÑĞ¾Ğ²",exit:"Ğ’Ñ‹Ñ…Ğ¾Ğ´",fab_hidden:"Ğ¡ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¿Ğ»Ğ°Ğ²Ğ°ÑÑ‰ÑƒÑ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ",fab_show:"ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ»Ğ°Ğ²Ğ°ÑÑ‰ÑƒÑ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ",fill_page:"Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ",hotkeys:"Ğ“Ğ¾Ñ€ÑÑ‡Ğ¸Ğµ ĞºĞ»Ğ°Ğ²Ğ¸ÑˆĞ¸",img_loading:"Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ÑÑ",interval:"Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»",loading_img:"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ",none:"ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚",or:"Ğ¸Ğ»Ğ¸",other:"Ğ”Ñ€ÑƒĞ³Ğ¾Ğµ",page_range:"Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†.:\\n (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, 1, 3-5, 9-)",read_mode:"Ğ ĞµĞ¶Ğ¸Ğ¼ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ",setting:"ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸"},pwa:{alert:{img_data_error:"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ",img_not_found:"Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾",img_not_found_files:"ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ° Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ„Ğ°Ğ¹Ğ» Ğ¸Ğ»Ğ¸ Ğ°Ñ€Ñ…Ğ¸Ğ² Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸ÑĞ¼Ğ¸",img_not_found_folder:"Ğ’ Ğ¿Ğ°Ğ¿ĞºĞµ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ¸Ğ»Ğ¸ Ğ°Ñ€Ñ…Ğ¸Ğ²Ñ‹ Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸ÑĞ¼Ğ¸",not_valid_url:"ĞĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ URL",parse_error:"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°",password_error:"ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ",repeat_load:"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²â€¦",userscript_not_installed:"ComicRead Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½"},button:{enter_url:"Ğ’Ğ²ĞµÑÑ‚Ğ¸ URL",install:"Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ",no_more_prompt:"Ğ‘Ğ¾Ğ»ÑŒÑˆĞµ Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ",resume_read:"ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğµ",select_files:"Ğ’Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»",select_folder:"Ğ’Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ğ¿ĞºÑƒ"},install_md:"### Ğ£ÑÑ‚Ğ°Ğ»Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°Ñ‚ÑŒ ÑÑ‚Ñƒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ€Ğ°Ğ·?\\nĞ•ÑĞ»Ğ¸ Ğ²Ñ‹ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ:\\n1. Ğ˜Ğ¼ĞµÑ‚ÑŒ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾, ĞºĞ°Ğº ĞµÑĞ»Ğ¸ Ğ±Ñ‹ Ğ²Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ»Ğ¸ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾Ğµ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ½Ğ¾Ğµ Ğ¾Ğ±ĞµÑĞ¿ĞµÑ‡ĞµĞ½Ğ¸Ğµ\\n1. ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ°Ñ€Ñ…Ğ¸Ğ²Ñ‹ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ\\n1. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ¾Ñ„Ñ„Ğ»Ğ°Ğ¹Ğ½\\n### Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ ÑÑ‚Ñƒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ Ğ² ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğµ [PWA](https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%BE%D0%B3%D1%80%D0%B5%D1%81%D1%81%D0%B8%D0%B2%D0%BD%D0%BE%D0%B5_%D0%B2%D0%B5%D0%B1-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5) Ğ½Ğ° ÑĞ²Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ¿ÑŒÑÑ‚ĞµÑ€ ğŸºâ˜ï¸",message:{enter_password:"ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ° Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ",parsing:"Ğ Ğ°Ğ·Ğ±Ğ¾Ñ€"},tip_enter_url:"Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ URL Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ°",tip_md:"# ComicRead PWA\\nĞ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ [ComicRead](https://github.com/hymbz/ComicReadScript) Ğ´Ğ»Ñ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¸ĞºÑĞ¾Ğ² **Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾**.\\n---\\n### ĞŸĞµÑ€ĞµÑ‚Ğ°Ñ‰Ğ¸Ñ‚Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ, Ğ¿Ğ°Ğ¿ĞºĞ¸ Ğ¸Ğ»Ğ¸ Ğ°Ñ€Ñ…Ğ¸Ğ²Ñ‹ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ\\n*Ğ’Ñ‹ Ñ‚Ğ°Ğº Ğ¶Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ **Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ** Ğ¸Ğ»Ğ¸ **Ğ²ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ** URL Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ° Ğ½Ğ° Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ*"},setting:{hotkeys:{add:"Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ³Ğ¾Ñ€ÑÑ‡Ğ¸Ğµ ĞºĞ»Ğ°Ğ²Ğ¸ÑˆĞ¸",restore:"Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ³Ğ¾Ñ€ÑÑ‡Ğ¸Ğµ ĞºĞ»Ğ°Ğ²Ğ¸ÑˆĞ¸ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ"},language:"Ğ¯Ğ·Ñ‹Ğº",option:{abreast_duplicate:"ĞšĞ¾ÑÑ„Ñ„Ğ¸Ñ†Ğ¸ĞµĞ½Ñ‚ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑÑ‚Ğ¾Ğ»Ğ±Ñ†Ğ¾Ğ²",abreast_mode:"Ğ ĞµĞ¶Ğ¸Ğ¼ Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºĞ¸ Ğ² Ñ€ÑĞ´",adjust_to_width:"ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ°Ñ ÑˆĞ¸Ñ€Ğ¸Ğ½Ğ°",align_edge:"Ğ’Ñ‹Ñ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾ ĞºÑ€Ğ°Ñ Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€ĞµĞ»Ğ¸ÑÑ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğ¸ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹",always_load_all_img:"Ğ’ÑĞµĞ³Ğ´Ğ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°Ñ‚ÑŒ Ğ²ÑĞµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ",autoFullscreen:"ĞĞ²Ñ‚Ğ¾ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ ÑĞºÑ€Ğ°Ğ½",autoHiddenMouse:"ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞºÑ€Ñ‹Ğ²Ğ°Ñ‚ÑŒ ĞºÑƒÑ€ÑĞ¾Ñ€ Ğ¼Ñ‹ÑˆĞ¸",auto_scale:"ĞĞ²Ñ‚Ğ¾ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±",auto_scroll_trigger_end:"ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºÑƒ Ğ½Ğ° ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ",auto_switch_page_mode:"ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹/Ğ´Ğ²Ğ¾Ğ¹Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ ÑĞ¾Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½",background_color:"Ğ¦Ğ²ĞµÑ‚ Ñ„Ğ¾Ğ½Ğ°",click_page_turn_area:"ĞĞ±Ğ»Ğ°ÑÑ‚ÑŒ Ğ½Ğ°Ğ¶Ğ°Ñ‚Ğ¸Ñ",click_page_turn_enabled:"ĞŸĞµÑ€ĞµĞ»Ğ¸ÑÑ‚Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ ĞºĞ»Ğ¸ĞºÑƒ",click_page_turn_swap_area:"ĞŸĞ¾Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ğ¼ĞµÑÑ‚Ğ°Ğ¼Ğ¸ Ğ¿Ñ€Ğ°Ğ²ÑƒÑ Ğ¸ Ğ»ĞµĞ²ÑƒÑ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚Ğ¸ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†",dark_mode:"Ğ¢Ñ‘Ğ¼Ğ½Ğ°Ñ Ñ‚ĞµĞ¼Ğ°",dark_mode_auto:"Ğ¢Ñ‘Ğ¼Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼ ÑĞ»ĞµĞ´ÑƒĞµÑ‚ Ğ·Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¾Ğ¹",dir_ltr:"Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ ÑĞ»ĞµĞ²Ğ° Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ¾ (ĞĞ¼ĞµÑ€Ğ¸ĞºĞ°Ğ½ÑĞºĞ¸Ğµ ĞºĞ¾Ğ¼Ğ¸ĞºÑÑ‹)",dir_rtl:"Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ ÑĞ¿Ñ€Ğ°Ğ²Ğ° Ğ½Ğ°Ğ»ĞµĞ²Ğ¾ (Ğ¯Ğ¿Ğ¾Ğ½ÑĞºĞ°Ñ Ğ¼Ğ°Ğ½Ğ³Ğ°)",disable_auto_enlarge:"ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹",first_page_fill:"Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ",full_width:"Ğ¨Ğ¸Ñ€Ğ¸Ğ½Ğ° Ğ¾ĞºĞ½Ğ° Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ°",img_recognition:"Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹",img_recognition_background:"ĞĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ñ†Ğ²ĞµÑ‚ Ñ„Ğ¾Ğ½Ğ°",img_recognition_pageFill:"ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹",img_recognition_warn:"â— Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€ Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Web Workers. Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ¾Ğ¹ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ²Ñ‹Ğ·Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºÑƒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹. Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¸Ğ»Ğ¸ ÑĞ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€.",img_recognition_warn_2:"â— Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ²ĞµĞ±-ÑĞ°Ğ¹Ñ‚ Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Web Workers. Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ¾Ğ¹ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ²ĞµÑÑ‚Ğ¸ Ğº Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹.",paragraph_appearance:"Ğ’Ğ½ĞµÑˆĞ½Ğ¾ÑÑ‚ÑŒ",paragraph_dir:"ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ",paragraph_display:"ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ",paragraph_scrollbar:"ĞŸĞ¾Ğ»Ğ¾ÑĞ° Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºĞ¸",paragraph_translation:"ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´",preload_page_num:"ĞŸÑ€ĞµĞ´Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†",scroll_end:"ĞŸĞ¾ÑĞ»Ğµ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ½Ñ†Ğ°",scroll_end_auto:"Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğº Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¹/ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¹ Ğ³Ğ»Ğ°Ğ²Ğµ, Ğ¸Ğ½Ğ°Ñ‡Ğµ Ğ²Ñ‹Ñ…Ğ¾Ğ´",scroll_mode_img_scale:"ĞšĞ¾ÑÑ„Ñ„Ğ¸Ñ†Ğ¸ĞµĞ½Ñ‚ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ ÑĞºÑ€Ğ¾Ğ»Ğ»Ğ¸Ğ½Ğ³Ğ°",scroll_mode_img_spacing:"Ğ Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¼ĞµĞ¶Ğ´Ñƒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°Ğ¼Ğ¸ Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ ÑĞºÑ€Ğ¾Ğ»Ğ»Ğ¸Ğ½Ğ³Ğ°",scrollbar_auto_hidden:"ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞºÑ€Ñ‹Ğ²Ğ°Ñ‚ÑŒ",scrollbar_easy_scroll:"Ğ›Ñ‘Ğ³ĞºĞ°Ñ Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºĞ°",scrollbar_position:"ĞŸĞ¾Ğ·Ğ¸Ñ†Ğ¸Ñ",scrollbar_position_bottom:"Ğ¡Ğ½Ğ¸Ğ·Ñƒ",scrollbar_position_hidden:"Ğ¡Ğ¿Ñ€ÑÑ‚Ğ°Ğ½Ğ¾",scrollbar_position_right:"Ğ¡Ğ¿Ñ€Ğ°Ğ²Ğ°",scrollbar_position_top:"Ğ¡Ğ²ĞµÑ€Ñ…Ñƒ",scrollbar_show_img_status:"ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ",show_clickable_area:"ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ ĞºĞ»Ğ¸ĞºĞ°Ğ±ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚Ğ¸",show_comments:"ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸ Ğ½Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ",shrink_menu:"Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚ÑŒ Ğ¼ĞµĞ½Ñ",swap_page_turn_key:"ĞŸĞ¾Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ğ¼ĞµÑÑ‚Ğ°Ğ¼Ğ¸ ĞºĞ»Ğ°Ğ²Ğ¸ÑˆĞ¸ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†",zoom:"ĞšĞ¾ÑÑ„Ñ„Ğ¸Ñ†Ğ¸ĞµĞ½Ñ‚ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ"},sync_options_other_site:"Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼Ğ¸ ÑĞ°Ğ¹Ñ‚Ğ°Ğ¼Ğ¸",translation:{cotrans_tip:"<p>Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ° <a href=\\"https://cotrans.touhou.ai\\" target=\\"_blank\\">Cotrans API</a>, Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‰Ğ¸Ğ¹ Ğ¸ÑĞºĞ»ÑÑ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ·Ğ° ÑÑ‡Ñ‘Ñ‚ ÑĞ²Ğ¾ĞµĞ³Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ĞµĞ»Ñ.</p>\\n<p>Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ Ğ¿Ğ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ Ğ² Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞµ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾Ğ¹ Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸. ĞšĞ¾Ğ³Ğ´Ğ° Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞ°ĞµÑ‚ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ¿Ñ€Ğ¸Ğ²Ğ¾Ğ´Ğ¸Ñ‚ÑŒ Ğº Ğ¾ÑˆĞ¸Ğ±ĞºĞµ. Ğ•ÑĞ»Ğ¸ Ñ‚Ğ°ĞºĞ¾Ğµ ÑĞ»ÑƒÑ‡Ğ¸Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ·Ğ¶Ğµ.</p>\\n<p>Ğ¢Ğ°Ğº Ñ‡Ñ‚Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ° <b>ÑƒÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğµ</b></p>\\n<p>ĞĞ°ÑÑ‚Ğ¾ÑÑ‚ĞµĞ»ÑŒĞ½Ğ¾ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ñ€Ğ°Ğ·Ğ²Ñ‘Ñ€Ğ½ÑƒÑ‚Ñ‹Ğ¹ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾ Ñ‚.Ğº. ÑÑ‚Ğ¾ Ğ½Ğµ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ÑĞµÑ‚ ÑĞµÑ€Ğ²ĞµÑ€Ğ½Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹ Ğ¸ Ğ²Ñ‹ Ğ½Ğµ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ñ‹ Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒÑ.</p>",options:{box_threshold:"ĞŸĞ¾Ñ€Ğ¾Ğ³ ĞºĞ¾Ñ€Ğ¾Ğ±ĞºĞ¸",detection_resolution:"Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ñ Ñ‚ĞµĞºÑÑ‚Ğ°",direction:"ĞÑ€Ğ¸ĞµÑ‚Ğ½Ğ°Ñ†Ğ¸Ñ Ñ‚ĞµĞºÑÑ‚Ğ°",direction_auto:"Ğ¡Ğ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»Ñƒ",direction_horizontal:"Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾",direction_vertical:"Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾",force_retry:"ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€(Ğ˜Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºÑÑˆ)",inpainter:"Ğ˜Ğ½Ğ¿ĞµĞ¹Ğ½Ñ‚ĞµÑ€",inpainting_size:"Ğ˜Ğ½Ğ¿ĞµĞ¹Ğ½Ñ‚Ğ¸Ğ½Ğ³ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚Ğ¸",local_url:"ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ URL ÑĞµÑ€Ğ²ĞµÑ€Ğ°",mask_dilation_offset:"ĞœĞ°ÑĞºĞ¸Ñ€Ğ¾Ğ²Ğ¾Ñ‡Ğ½Ğ¾Ğµ ÑĞ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ Ğ´Ğ¸Ğ»Ğ°Ñ‚Ğ°Ñ†Ğ¸Ğ¸",only_download_translated:"Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿ĞµÑ€ĞµĞ²ĞµĞ´Ñ‘Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ",target_language:"Ğ¦ĞµĞ»ĞµĞ²Ğ¾Ğ¹ ÑĞ·Ñ‹Ğº",text_detector:"Ğ”ĞµÑ‚ĞµĞºÑ‚Ğ¾Ñ€ Ñ‚ĞµĞºÑÑ‚Ğ°",translator:"ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‡Ğ¸Ğº",unclip_ratio:"ĞĞµĞ¾Ğ±Ñ€ĞµĞ·Ğ°Ğ½Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğµ"},range:"ĞĞ±ÑŠĞµĞ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°",server:"Ğ¡ĞµÑ€Ğ²ĞµÑ€",server_selfhosted:"Ğ¡Ğ²Ğ¾Ğ¹",translate_all:"ĞŸĞµÑ€ĞµĞ²ĞµÑÑ‚Ğ¸ Ğ²ÑĞµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ",translate_to_end:"ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ Ğ´Ğ¾ ĞºĞ¾Ğ½Ñ†Ğ°"}},site:{add_feature:{add_hotkeys_actions:"Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ Ğ³Ğ¾Ñ€ÑÑ‡Ğ¸Ğ¼Ğ¸ ĞºĞ»Ğ°Ğ²Ğ¸ÑˆĞ°Ğ¼Ğ¸",auto_adjust_option:"ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ",auto_page_turn:"Ğ‘ĞµÑĞºĞ¾Ğ½ĞµÑ‡Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºĞ°",auto_show:"ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ‚ÑŒ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ",block_totally:"Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ¸ĞºÑÑ‹",colorize_tag:"Ğ¦Ğ²ĞµÑ‚Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ",cross_site_link:"ĞšÑ€Ğ¾ÑÑ-ÑĞ°Ğ¹Ñ‚Ğ¾Ğ²Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ°",detect_ad:"Detect advertise page",expand_tag_list:"Ğ Ğ°Ğ·Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ‚ĞµĞ³Ğ¾Ğ²",float_tag_list:"ĞŸĞ»Ğ°Ğ²Ğ°ÑÑ‰Ğ¸Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ‚ĞµĞ³Ğ¾Ğ²",load_original_image:"Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°Ñ‚ÑŒ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ",lock_option:"Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ¾Ğ¿Ñ†Ğ¸Ğ¸ ÑĞ°Ğ¹Ñ‚Ğ°",open_link_new_page:"ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°Ñ‚ÑŒ ÑÑÑ‹Ğ»ĞºĞ¸ Ğ² Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ğ²ĞºĞ»Ğ°Ğ´ĞºĞµ",quick_favorite:"Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ñ„Ğ°Ğ²Ğ¾Ñ€Ğ¸Ñ‚",quick_rating:"Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³",quick_tag_define:"ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞ³Ğ° Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ°",remember_current_site:"Ğ—Ğ°Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑĞ°Ğ¹Ñ‚",tag_lint:"Ğ¢ÑĞ³ Ğ›Ğ¸Ğ½Ñ‚"},changed_load_failed:"Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ°ÑÑŒ, Ğ½ĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ¸ĞºÑ",ehentai:{change_favorite_failed:"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ",change_favorite_success:"Ğ˜Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾",change_rating_failed:"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¾Ñ†ĞµĞ½ĞºÑƒ",change_rating_success:"Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½ Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³",fetch_favorite_failed:"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¼",fetch_img_page_source_failed:"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸ÑĞ¼Ğ¸",fetch_img_page_url_failed:"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ°Ğ´Ñ€ĞµÑ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ¸Ğ· Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹",fetch_img_url_failed:"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ°Ğ´Ñ€ĞµÑ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ",hitomi_error:"ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ¿Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ hitomi",html_changed_link_failed:"Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ°ÑÑŒ, Ğ¸ ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ²Ğ½ĞµÑˆĞ½ĞµĞ³Ğ¾ ÑĞ°Ğ¹Ñ‚Ğ° Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹Ğ¼ Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ¼",ip_banned:"IP Ğ°Ğ´Ñ€ĞµÑ Ğ·Ğ°Ğ±Ğ°Ğ½ĞµĞ½",nhentai_error:"ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ¿Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ nhentai",nhentai_failed:"ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ° Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ½Ğ° {{nhentai}}"},nhentai:{fetch_next_page_failed:"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ»ĞµĞ´ÑƒÑÑ‰ÑƒÑ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ",tag_blacklist_fetch_failed:"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ‚ĞµĞ³Ğ¸"},show_settings_menu:"ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¼ĞµĞ½Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº",simple:{auto_read_mode_message:"\\"ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ‚ÑŒ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ\\" Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ",no_img:"ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹. ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ñ‚ÑƒÑ‚ Ñ‡Ñ‚Ğ¾ Ğ±Ñ‹ Ğ²Ñ‹ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ³Ğ¾ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ.",simple_read_mode:"Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ"}},touch_area:{menu:"ĞœĞµĞ½Ñ",type:{edge:"Ğ“Ñ€Ğ°Ğ½ÑŒ",l:"L",left_right:"Ğ›ĞµĞ²Ğ¾ ĞŸÑ€Ğ°Ğ²Ğ¾",up_down:"Ğ’ĞµÑ€Ñ… ĞĞ¸Ğ·"}},translation:{status:{colorizing:"Ğ Ğ°ÑĞºÑ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ½Ğ¸Ğµ","default":"ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ",detection:"Ğ Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµĞºÑÑ‚Ğ°",downscaling:"Ğ£Ğ¼ĞµĞ½ÑŒÑˆĞµĞ½Ğ¸Ğµ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ°",error:"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°","error-lang":"Ğ¦ĞµĞ»ĞµĞ²Ğ¾Ğ¹ ÑĞ·Ñ‹Ğº Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¼ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‡Ğ¸ĞºĞ¾Ğ¼","error-translating":"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°(Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚)","error-with-id":"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°",finished:"Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ",inpainting:"ĞĞ°Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ","mask-generation":"Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ°ÑĞºĞ¸",ocr:"Ğ Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµĞºÑÑ‚Ğ°",pending:"ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ","pending-pos":"ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ",preparing:"ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¾ĞºĞ½Ğ° Ğ±ĞµĞ·Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ",rendering:"ĞÑ‚Ñ€Ğ¸ÑĞ¾Ğ²ĞºĞ°",saved:"Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾","skip-no-regions":"ĞĞ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¸ Ğ½Ğµ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¾ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ñ… Ğ¾Ğ±Ğ»Ğ°ÑÑ‚ĞµĞ¹.","skip-no-text":"Ğ¢ĞµĞºÑÑ‚ Ğ½Ğ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¸ Ğ½Ğµ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½",textline_merge:"ĞĞ±ÑŒĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞºÑÑ‚Ğ°",translating:"ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¸Ñ‚ÑÑ",upscaling:"Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ"},tip:{check_img_status_failed:"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ",download_img_failed:"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ",get_translator_list_error:"ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑĞ¿Ğ¸ÑĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‡Ğ¸ĞºĞ¾Ğ²",id_not_returned:"ID Ğ½Ğµ Ğ²ĞµÑ€Ğ½ÑƒĞ»Ğ¸(",img_downloading:"Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ",img_not_fully_loaded:"Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ²ÑÑ‘ ĞµÑ‰Ñ‘ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ÑÑ",pending:"ĞĞ¶Ğ¸Ğ´ĞµĞ½Ğ¸Ğµ, Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ Ğ² Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸ {{pos}}",resize_img_failed:"ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ",translating:"Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¸Ñ‚ÑÑ",translation_completed:"ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´ Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½",upload:"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ",upload_error:"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ",upload_return_error:"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ° Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ",wait_translation:"ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°"},translator:{baidu:"baidu",deepl:"DeepL",google:"Google","gpt3.5":"GPT-3.5",none:"Ğ£Ğ±Ñ€Ğ°Ñ‚ÑŒ Ñ‚ĞµĞºÑÑ‚",offline:"ĞÑ„Ñ„Ğ»Ğ°Ğ¹Ğ½ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‡Ğ¸Ğº",original:"ĞÑ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»",youdao:"youdao"}},upscale:{module_download_complete:"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ ÑƒĞ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°",module_download_failed:"Ğ¡Ğ±Ğ¾Ğ¹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ ÑƒĞ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹",module_downloading:"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ ÑƒĞ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹...",title:"Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ",upscaled:"Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ½Ñ‹Ğ¹",upscaling:"Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ",webgpu_tip:"ĞĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑƒĞ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ WebGPU, Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ±ÑƒĞ´ĞµÑ‚ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½ĞµĞµ"}};\n\nconst zh = {alert:{comic_load_error:"æ¼«ç”»åŠ è½½å‡ºé”™",download_failed:"ä¸‹è½½å¤±è´¥",fetch_comic_img_failed:"è·å–æ¼«ç”»å›¾ç‰‡å¤±è´¥",img_load_failed:"å›¾ç‰‡åŠ è½½å¤±è´¥",no_img_download:"æ²¡æœ‰èƒ½ä¸‹è½½çš„å›¾ç‰‡",repeat_load:"åŠ è½½å›¾ç‰‡ä¸­ï¼Œè¯·ç¨å€™",retry_get_img_url:"é‡æ–°è·å–ç¬¬ {{i}} é¡µå›¾ç‰‡çš„åœ°å€",server_connect_failed:"æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨"},button:{auto_scroll:"è‡ªåŠ¨æ»šåŠ¨",close_current_page_translation:"å…³é—­å½“å‰é¡µçš„ç¿»è¯‘",download_completed:"ä¸‹è½½å®Œæˆ",download_completed_error:"ä¸‹è½½å®Œæˆï¼Œä½†æœ‰ {{errorNum}} å¼ å›¾ç‰‡ä¸‹è½½å¤±è´¥",downloading:"ä¸‹è½½ä¸­",fullscreen:"å…¨å±",fullscreen_exit:"é€€å‡ºå…¨å±",grid_mode:"ç½‘æ ¼æ¨¡å¼",packaging:"æ‰“åŒ…ä¸­",page_fill:"é¡µé¢å¡«å……",page_mode_double:"åŒé¡µæ¨¡å¼",page_mode_single:"å•é¡µæ¨¡å¼",scroll_mode:"å·è½´æ¨¡å¼",translate_current_page:"ç¿»è¯‘å½“å‰é¡µ",zoom_in:"æ”¾å¤§",zoom_out:"ç¼©å°"},description:"ä¸ºæ¼«ç”»ç«™å¢åŠ åŒé¡µé˜…è¯»ã€ç¿»è¯‘ç­‰ä¼˜åŒ–ä½“éªŒçš„å¢å¼ºåŠŸèƒ½ã€‚",eh_tag_lint:{combo:"å­˜åœ¨ [tag] æ—¶ï¼Œä¸€èˆ¬ä¹Ÿå­˜åœ¨ [tag]",conflict:"å­˜åœ¨ [tag] æ—¶ï¼Œä¸åº”è¯¥å­˜åœ¨ [tag]",correct_tag:"åº”è¯¥æ˜¯æ­£ç¡®çš„æ ‡ç­¾",miss_female:"ç¼ºå°‘ç”·æ€§æ ‡ç­¾ï¼Œå¯èƒ½éœ€è¦",miss_parody:"ç¼ºå°‘åŸä½œæ ‡ç­¾ï¼Œå¯èƒ½éœ€è¦",possible_conflict:"å­˜åœ¨ [tag] æ—¶ï¼Œä¸€èˆ¬ä¸åº”è¯¥å­˜åœ¨ [tag]",prerequisite:"[tag] çš„å‰ç½®æ ‡ç­¾ [tag] ä¸å­˜åœ¨"},end_page:{next_button:"ä¸‹ä¸€è¯",prev_button:"ä¸Šä¸€è¯",tip:{end_jump:"å·²åˆ°ç»“å°¾ï¼Œç»§ç»­å‘ä¸‹ç¿»é¡µå°†è·³è‡³ä¸‹ä¸€è¯",exit:"å·²åˆ°ç»“å°¾ï¼Œç»§ç»­ç¿»é¡µå°†é€€å‡º",start_jump:"å·²åˆ°å¼€å¤´ï¼Œç»§ç»­å‘ä¸Šç¿»é¡µå°†è·³è‡³ä¸Šä¸€è¯"}},hotkeys:{enter_read_mode:"è¿›å…¥é˜…è¯»æ¨¡å¼",float_tag_list:"æ‚¬æµ®æ ‡ç­¾åˆ—è¡¨",jump_to_end:"è·³è‡³å°¾é¡µ",jump_to_home:"è·³è‡³é¦–é¡µ",page_down:"å‘ä¸‹ç¿»é¡µ",page_up:"å‘ä¸Šç¿»é¡µ",repeat_tip:"æ­¤å¿«æ·é”®å·²è¢«ç»‘å®šè‡³ã€Œ{{hotkey}}ã€",scroll_down:"å‘ä¸‹æ»šåŠ¨",scroll_left:"å‘å·¦æ»šåŠ¨",scroll_right:"å‘å³æ»šåŠ¨",scroll_up:"å‘ä¸Šæ»šåŠ¨",switch_auto_enlarge:"åˆ‡æ¢å›¾ç‰‡è‡ªåŠ¨æ”¾å¤§é€‰é¡¹",switch_dir:"åˆ‡æ¢é˜…è¯»æ–¹å‘",switch_grid_mode:"åˆ‡æ¢ç½‘æ ¼æ¨¡å¼",switch_page_fill:"åˆ‡æ¢é¡µé¢å¡«å……",switch_scroll_mode:"åˆ‡æ¢å·è½´æ¨¡å¼",switch_single_double_page_mode:"åˆ‡æ¢å•åŒé¡µæ¨¡å¼"},img_status:{error:"åŠ è½½å‡ºé”™",loading:"æ­£åœ¨åŠ è½½",wait:"ç­‰å¾…åŠ è½½"},other:{auto:"è‡ªåŠ¨",custom:"è‡ªå®šä¹‰",disable:"ç¦ç”¨",distance:"è·ç¦»",download:"ä¸‹è½½",enabled:"å¯ç”¨",enter_comic_read_mode:"è¿›å…¥æ¼«ç”»é˜…è¯»æ¨¡å¼",exit:"é€€å‡º",fab_hidden:"éšè—æ‚¬æµ®æŒ‰é’®",fab_show:"æ˜¾ç¤ºæ‚¬æµ®æŒ‰é’®",fill_page:"å¡«å……é¡µ",hotkeys:"å¿«æ·é”®",img_loading:"å›¾ç‰‡åŠ è½½ä¸­",interval:"é—´éš”",loading_img:"åŠ è½½å›¾ç‰‡ä¸­",none:"æ— ",or:"æˆ–",other:"å…¶ä»–",page_range:"è¯·è¾“å…¥é¡µç èŒƒå›´ï¼š\\nï¼ˆä¾‹å¦‚ï¼š1, 3-5, 9-)",read_mode:"é˜…è¯»æ¨¡å¼",setting:"è®¾ç½®"},pwa:{alert:{img_data_error:"å›¾ç‰‡æ•°æ®é”™è¯¯",img_not_found:"æ‰¾ä¸åˆ°å›¾ç‰‡",img_not_found_files:"è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶æˆ–å«æœ‰å›¾ç‰‡æ–‡ä»¶çš„å‹ç¼©åŒ…",img_not_found_folder:"æ–‡ä»¶å¤¹ä¸‹æ²¡æœ‰å›¾ç‰‡æ–‡ä»¶æˆ–å«æœ‰å›¾ç‰‡æ–‡ä»¶çš„å‹ç¼©åŒ…",not_valid_url:"ä¸æ˜¯æœ‰æ•ˆçš„ URL",parse_error:"è§£æå‡ºé”™",password_error:"å¯†ç é”™è¯¯",repeat_load:"æ­£åœ¨åŠ è½½å…¶ä»–æ–‡ä»¶ä¸­â€¦â€¦",userscript_not_installed:"æœªå®‰è£… ComicRead è„šæœ¬"},button:{enter_url:"è¾“å…¥ URL",install:"å®‰è£…",no_more_prompt:"ä¸å†æç¤º",resume_read:"æ¢å¤é˜…è¯»",select_files:"é€‰æ‹©æ–‡ä»¶",select_folder:"é€‰æ‹©æ–‡ä»¶å¤¹"},install_md:"### æ¯æ¬¡éƒ½è¦æ‰“å¼€è¿™ä¸ªç½‘é¡µå¾ˆéº»çƒ¦ï¼Ÿ\\nå¦‚æœä½ å¸Œæœ›\\n1. èƒ½æœ‰ç‹¬ç«‹çš„çª—å£ï¼Œåƒæ˜¯åœ¨ä½¿ç”¨æœ¬åœ°è½¯ä»¶ä¸€æ ·\\n1. åŠ å…¥æœ¬åœ°å‹ç¼©æ–‡ä»¶çš„æ‰“å¼€æ–¹å¼ä¹‹ä¸­ï¼Œæ–¹ä¾¿ç›´æ¥æ‰“å¼€\\n1. ç¦»çº¿ä½¿ç”¨~~ï¼ˆä¸»è¦æ˜¯æ‹…å¿ƒå›½å†…ç½‘ç»œæŠ½é£æ— æ³•è®¿é—®è¿™ä¸ªç½‘é¡µ~~\\n### æ¬¢è¿å°†æœ¬é¡µé¢ä½œä¸º PWA åº”ç”¨å®‰è£…åˆ°ç”µè„‘ä¸ŠğŸ˜ƒğŸ‘",message:{enter_password:"è¯·è¾“å…¥å¯†ç ",parsing:"è§£æä¸­"},tip_enter_url:"è¯·è¾“å…¥å‹ç¼©åŒ… URL",tip_md:"# ComicRead PWA\\nä½¿ç”¨ [ComicRead](https://github.com/hymbz/ComicReadScript) çš„é˜…è¯»æ¨¡å¼é˜…è¯»**æœ¬åœ°**æ¼«ç”»\\n---\\n### å°†å›¾ç‰‡æ–‡ä»¶ã€æ–‡ä»¶å¤¹ã€å‹ç¼©åŒ…ç›´æ¥æ‹–å…¥å³å¯å¼€å§‹é˜…è¯»\\n*ä¹Ÿå¯ä»¥é€‰æ‹©**ç›´æ¥ç²˜è´´**æˆ–**è¾“å…¥**å‹ç¼©åŒ… URL ä¸‹è½½é˜…è¯»*"},setting:{hotkeys:{add:"æ·»åŠ æ–°å¿«æ·é”®",restore:"æ¢å¤é»˜è®¤å¿«æ·é”®"},language:"è¯­è¨€",option:{abreast_duplicate:"æ¯åˆ—é‡å¤æ¯”ä¾‹",abreast_mode:"å¹¶æ’å·è½´æ¨¡å¼",adjust_to_width:"è‡ªé€‚åº”å®½åº¦",align_edge:"æ»šåŠ¨ç¿»é¡µæ—¶å¯¹é½è¾¹ç¼˜",always_load_all_img:"å§‹ç»ˆåŠ è½½æ‰€æœ‰å›¾ç‰‡",autoFullscreen:"è‡ªåŠ¨å…¨å±",autoHiddenMouse:"è‡ªåŠ¨éšè—é¼ æ ‡",auto_scale:"è‡ªåŠ¨ç¼©æ”¾",auto_scroll_trigger_end:"åœ¨ç»“æŸé¡µä¸Šç»§ç»­æ»šåŠ¨",auto_switch_page_mode:"æŒ‰å±å¹•æ¯”ä¾‹åˆ‡æ¢å•åŒé¡µ",background_color:"èƒŒæ™¯é¢œè‰²",click_page_turn_area:"ç‚¹å‡»åŒºåŸŸ",click_page_turn_enabled:"ç‚¹å‡»ç¿»é¡µ",click_page_turn_swap_area:"å·¦å³ç‚¹å‡»åŒºåŸŸäº¤æ¢",dark_mode:"é»‘æš—æ¨¡å¼",dark_mode_auto:"é»‘æš—æ¨¡å¼è·Ÿéšç³»ç»Ÿ",dir_ltr:"ä»å·¦åˆ°å³ï¼ˆç¾æ¼«ï¼‰",dir_rtl:"ä»å³åˆ°å·¦ï¼ˆæ—¥æ¼«ï¼‰",disable_auto_enlarge:"ç¦æ­¢å›¾ç‰‡è‡ªåŠ¨æ”¾å¤§",first_page_fill:"é»˜è®¤å¯ç”¨é¦–é¡µå¡«å……",full_width:"è§†çª—å®½åº¦",img_recognition:"å›¾åƒè¯†åˆ«",img_recognition_background:"è¯†åˆ«èƒŒæ™¯è‰²",img_recognition_pageFill:"è‡ªåŠ¨è°ƒæ•´é¡µé¢å¡«å……",img_recognition_warn:"â— å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ Web Workerï¼Œå¼€å¯æ­¤åŠŸèƒ½å¯èƒ½å¯¼è‡´é¡µé¢å¡é¡¿ï¼Œå»ºè®®å‡çº§æˆ–æ›´æ¢æµè§ˆå™¨ã€‚",img_recognition_warn_2:"â— å½“å‰ç½‘ç«™ä¸æ”¯æŒ Web Workerï¼Œå¼€å¯æ­¤åŠŸèƒ½å¯èƒ½å¯¼è‡´é¡µé¢å¡é¡¿ã€‚",paragraph_appearance:"å¤–è§‚",paragraph_dir:"é˜…è¯»æ–¹å‘",paragraph_display:"æ˜¾ç¤º",paragraph_scrollbar:"æ»šåŠ¨æ¡",paragraph_translation:"ç¿»è¯‘",preload_page_num:"é¢„åŠ è½½é¡µæ•°",scroll_end:"ç¿»é¡µè‡³å°½å¤´å",scroll_end_auto:"ä¼˜å…ˆè·³è‡³ä¸Š/ä¸‹ä¸€è¯ï¼Œå¦åˆ™é€€å‡º",scroll_mode_img_scale:"å·è½´å›¾ç‰‡ç¼©æ”¾",scroll_mode_img_spacing:"å·è½´å›¾ç‰‡é—´è·",scrollbar_auto_hidden:"è‡ªåŠ¨éšè—",scrollbar_easy_scroll:"å¿«æ·æ»šåŠ¨",scrollbar_position:"ä½ç½®",scrollbar_position_bottom:"åº•éƒ¨",scrollbar_position_hidden:"éšè—",scrollbar_position_right:"å³ä¾§",scrollbar_position_top:"é¡¶éƒ¨",scrollbar_show_img_status:"æ˜¾ç¤ºå›¾ç‰‡åŠ è½½çŠ¶æ€",show_clickable_area:"æ˜¾ç¤ºç‚¹å‡»åŒºåŸŸ",show_comments:"åœ¨ç»“æŸé¡µæ˜¾ç¤ºè¯„è®º",shrink_menu:"ç¼©å°èœå•åŒºåŸŸ",swap_page_turn_key:"å·¦å³ç¿»é¡µé”®äº¤æ¢",zoom:"å›¾ç‰‡ç¼©æ”¾"},sync_options_other_site:"åŒæ­¥é˜…è¯»é…ç½®è‡³å…¶ä»–ç«™ç‚¹",translation:{cotrans_tip:"<p>å°†ä½¿ç”¨ <a href=\\"https://cotrans.touhou.ai\\" target=\\"_blank\\">Cotrans</a> æä¾›çš„æ¥å£ç¿»è¯‘å›¾ç‰‡ï¼Œè¯¥æœåŠ¡å™¨ç”±å…¶ç»´æŠ¤è€…ç”¨çˆ±å‘ç”µè‡ªè´¹ç»´æŠ¤</p>\\n<p>å¤šäººåŒæ—¶ä½¿ç”¨æ—¶éœ€è¦æ’é˜Ÿç­‰å¾…ï¼Œç­‰å¾…é˜Ÿåˆ—è¾¾åˆ°ä¸Šé™åå†ä¸Šä¼ æ–°å›¾ç‰‡ä¼šæŠ¥é”™ï¼Œéœ€è¦è¿‡æ®µæ—¶é—´å†è¯•</p>\\n<p>æ‰€ä»¥è¿˜è¯· <b>æ³¨æ„ç”¨é‡</b></p>\\n<p>æ›´æ¨èä½¿ç”¨è‡ªå·±æœ¬åœ°éƒ¨ç½²çš„é¡¹ç›®ï¼Œæ—¢ä¸å ç”¨æœåŠ¡å™¨èµ„æºä¹Ÿä¸éœ€è¦æ’é˜Ÿ</p>",options:{box_threshold:"æ–‡æœ¬æ¡†é˜ˆå€¼",detection_resolution:"æ–‡æœ¬æ‰«ææ¸…æ™°åº¦",direction:"æ¸²æŸ“å­—ä½“æ–¹å‘",direction_auto:"åŸæ–‡ä¸€è‡´",direction_horizontal:"ä»…é™æ°´å¹³",direction_vertical:"ä»…é™å‚ç›´",force_retry:"å¿½ç•¥ç¼“å­˜å¼ºåˆ¶é‡è¯•",inpainter:"å›¾åƒä¿®å¤å™¨",inpainting_size:"å›¾åƒä¿®å¤å°ºå¯¸",local_url:"è‡ªå®šä¹‰æœåŠ¡å™¨ URL",mask_dilation_offset:"æ©ç è†¨èƒ€åç§»é‡",only_download_translated:"åªä¸‹è½½ç¿»è¯‘å®Œçš„å›¾ç‰‡",target_language:"ç›®æ ‡è¯­è¨€",text_detector:"æ–‡æœ¬æ‰«æå™¨",translator:"ç¿»è¯‘æœåŠ¡",unclip_ratio:"æ–‡æœ¬æ¡†è†¨èƒ€æ¯”ç‡"},range:"ç¿»è¯‘èŒƒå›´",server:"ç¿»è¯‘æœåŠ¡å™¨",server_selfhosted:"æœ¬åœ°éƒ¨ç½²",translate_all:"ç¿»è¯‘å…¨éƒ¨å›¾ç‰‡",translate_to_end:"ç¿»è¯‘å½“å‰é¡µè‡³ç»“å°¾"}},site:{add_feature:{add_hotkeys_actions:"å¢åŠ å¿«æ·é”®æ“ä½œ",auto_adjust_option:"è‡ªåŠ¨è°ƒæ•´é˜…è¯»é…ç½®",auto_page_turn:"æ— é™æ»šåŠ¨",auto_show:"è‡ªåŠ¨è¿›å…¥é˜…è¯»æ¨¡å¼",block_totally:"å½»åº•å±è”½æ¼«ç”»",colorize_tag:"æ ‡ç­¾æŸ“è‰²",cross_site_link:"å…³è”å¤–ç«™",detect_ad:"è¯†åˆ«å¹¿å‘Šé¡µ",expand_tag_list:"å±•å¼€æ ‡ç­¾åˆ—è¡¨",float_tag_list:"æ‚¬æµ®æ ‡ç­¾åˆ—è¡¨",load_original_image:"åŠ è½½åŸå›¾",lock_option:"é”å®šç«™ç‚¹é…ç½®",open_link_new_page:"åœ¨æ–°é¡µé¢ä¸­æ‰“å¼€é“¾æ¥",quick_favorite:"å¿«æ·æ”¶è—",quick_rating:"å¿«æ·è¯„åˆ†",quick_tag_define:"å¿«æ·æŸ¥çœ‹æ ‡ç­¾å®šä¹‰",remember_current_site:"è®°ä½å½“å‰ç«™ç‚¹",tag_lint:"æ ‡ç­¾æ£€æŸ¥"},changed_load_failed:"ç½‘ç«™å‘ç”Ÿå˜åŒ–ï¼Œæ— æ³•åŠ è½½æ¼«ç”»",ehentai:{change_favorite_failed:"æ”¶è—å¤¹ä¿®æ”¹å¤±è´¥",change_favorite_success:"æ”¶è—å¤¹ä¿®æ”¹æˆåŠŸ",change_rating_failed:"è¯„åˆ†ä¿®æ”¹å¤±è´¥",change_rating_success:"è¯„åˆ†ä¿®æ”¹æˆåŠŸ",fetch_favorite_failed:"è·å–æ”¶è—å¤¹ä¿¡æ¯å¤±è´¥",fetch_img_page_source_failed:"è·å–å›¾ç‰‡é¡µæºç å¤±è´¥",fetch_img_page_url_failed:"ä»è¯¦æƒ…é¡µè·å–å›¾ç‰‡é¡µåœ°å€å¤±è´¥",fetch_img_url_failed:"ä»å›¾ç‰‡é¡µè·å–å›¾ç‰‡åœ°å€å¤±è´¥",hitomi_error:"hitomi åŒ¹é…å‡ºé”™",html_changed_link_failed:"é¡µé¢ç»“æ„å‘ç”Ÿæ”¹å˜ï¼Œå…³è”å¤–ç«™åŠŸèƒ½æ— æ³•æ­£å¸¸ç”Ÿæ•ˆ",ip_banned:"IPåœ°å€è¢«ç¦",nhentai_error:"nhentai åŒ¹é…å‡ºé”™",nhentai_failed:"åŒ¹é…å¤±è´¥ï¼Œè¯·åœ¨ç¡®è®¤ç™»å½• {{nhentai}} ååˆ·æ–°"},nhentai:{fetch_next_page_failed:"è·å–ä¸‹ä¸€é¡µæ¼«ç”»æ•°æ®å¤±è´¥",tag_blacklist_fetch_failed:"æ ‡ç­¾é»‘åå•è·å–å¤±è´¥"},show_settings_menu:"æ˜¾ç¤ºè®¾ç½®èœå•",simple:{auto_read_mode_message:"å·²é»˜è®¤å¼€å¯ã€Œè‡ªåŠ¨è¿›å…¥é˜…è¯»æ¨¡å¼ã€",no_img:"æœªæ‰¾åˆ°åˆé€‚çš„æ¼«ç”»å›¾ç‰‡ï¼Œ\\nå¦‚æœ‰éœ€è¦å¯ç‚¹æ­¤å…³é—­ç®€æ˜“é˜…è¯»æ¨¡å¼",simple_read_mode:"ä½¿ç”¨ç®€æ˜“é˜…è¯»æ¨¡å¼"}},touch_area:{menu:"èœå•",type:{edge:"è¾¹ç¼˜",l:"L",left_right:"å·¦å³",up_down:"ä¸Šä¸‹"}},translation:{status:{colorizing:"æ­£åœ¨ä¸Šè‰²","default":"æœªçŸ¥çŠ¶æ€",detection:"æ­£åœ¨æ£€æµ‹æ–‡æœ¬",downscaling:"æ­£åœ¨ç¼©å°å›¾ç‰‡",error:"ç¿»è¯‘å‡ºé”™","error-lang":"ä½ é€‰æ‹©çš„ç¿»è¯‘æœåŠ¡ä¸æ”¯æŒä½ é€‰æ‹©çš„è¯­è¨€","error-translating":"ç¿»è¯‘æœåŠ¡æ²¡æœ‰è¿”å›ä»»ä½•æ–‡æœ¬","error-with-id":"ç¿»è¯‘å‡ºé”™",finished:"æ­£åœ¨æ•´ç†ç»“æœ",inpainting:"æ­£åœ¨ä¿®è¡¥å›¾ç‰‡","mask-generation":"æ­£åœ¨ç”Ÿæˆæ–‡æœ¬æ©ç ",ocr:"æ­£åœ¨è¯†åˆ«æ–‡æœ¬",pending:"æ­£åœ¨ç­‰å¾…","pending-pos":"æ­£åœ¨ç­‰å¾…",preparing:"ç­‰å¾…ç©ºé—²çª—å£",rendering:"æ­£åœ¨æ¸²æŸ“",saved:"ä¿å­˜ç»“æœ","skip-no-regions":"å›¾ç‰‡ä¸­æ²¡æœ‰æ£€æµ‹åˆ°æ–‡æœ¬åŒºåŸŸ","skip-no-text":"å›¾ç‰‡ä¸­æ²¡æœ‰æ£€æµ‹åˆ°æ–‡æœ¬",textline_merge:"æ­£åœ¨æ•´åˆæ–‡æœ¬",translating:"æ­£åœ¨ç¿»è¯‘æ–‡æœ¬",upscaling:"æ­£åœ¨æ”¾å¤§å›¾ç‰‡"},tip:{check_img_status_failed:"æ£€æŸ¥å›¾ç‰‡çŠ¶æ€å¤±è´¥",download_img_failed:"ä¸‹è½½å›¾ç‰‡å¤±è´¥",get_translator_list_error:"è·å–å¯ç”¨ç¿»è¯‘æœåŠ¡åˆ—è¡¨æ—¶å‡ºé”™",id_not_returned:"æœªè¿”å› id",img_downloading:"ä¸‹è½½å›¾ç‰‡ä¸­",img_not_fully_loaded:"å›¾ç‰‡æœªåŠ è½½å®Œæ¯•",pending:"æ­£åœ¨ç­‰å¾…ï¼Œåˆ—é˜Ÿè¿˜æœ‰ {{pos}} å¼ å›¾ç‰‡",resize_img_failed:"ç¼©æ”¾å›¾ç‰‡å¤±è´¥",translating:"ç¿»è¯‘å›¾ç‰‡ä¸­",translation_completed:"ç¿»è¯‘å®Œæˆ",upload:"ä¸Šä¼ å›¾ç‰‡ä¸­",upload_error:"ä¸Šä¼ å›¾ç‰‡å‡ºé”™",upload_return_error:"æœåŠ¡å™¨ç¿»è¯‘å‡ºé”™",wait_translation:"ç­‰å¾…ç¿»è¯‘"},translator:{baidu:"ç™¾åº¦",deepl:"DeepL",google:"è°·æ­Œ","gpt3.5":"GPT-3.5",none:"åˆ é™¤æ–‡æœ¬",offline:"ç¦»çº¿æ¨¡å‹",original:"åŸæ–‡",youdao:"æœ‰é“"}},upscale:{module_download_complete:"å›¾ç‰‡æ”¾å¤§æ¨¡å‹ä¸‹è½½å®Œæˆ",module_download_failed:"å›¾ç‰‡æ”¾å¤§æ¨¡å‹ä¸‹è½½å¤±è´¥",module_downloading:"å›¾ç‰‡æ”¾å¤§æ¨¡å‹ä¸‹è½½ä¸­...",title:"æ— æŸæ”¾å¤§å›¾ç‰‡",upscaled:"å·²æ”¾å¤§",upscaling:"æ”¾å¤§ä¸­",webgpu_tip:"æ— æ³•ä½¿ç”¨ WebGPU æ”¾å¤§å›¾ç‰‡ï¼Œå¤„ç†é€Ÿåº¦å°†å˜æ…¢"}};\n\n/**\n * Creates a callback that is debounced and cancellable. The debounced callback is called on **trailing** edge.\n *\n * The timeout will be automatically cleared on root dispose.\n *\n * @param callback The callback to debounce\n * @param wait The duration to debounce in milliseconds\n * @returns The debounced function\n *\n * @see https://github.com/solidjs-community/solid-primitives/tree/main/packages/scheduled#debounce\n *\n * @example\n * ```ts\n * const fn = debounce((message: string) => console.log(message), 250);\n * fn(\'Hello!\');\n * fn.clear() // clears a timeout in progress\n * ```\n */\nconst debounce$1 = (callback, wait) => {\n    if (web.isServer) {\n        return Object.assign(() => void 0, { clear: () => void 0 });\n    }\n    let timeoutId;\n    const clear = () => clearTimeout(timeoutId);\n    if (solidJs.getOwner())\n        solidJs.onCleanup(clear);\n    const debounced = (...args) => {\n        if (timeoutId !== undefined)\n            clear();\n        timeoutId = setTimeout(() => callback(...args), wait);\n    };\n    return Object.assign(debounced, { clear });\n};\n/**\n * Creates a callback that is throttled and cancellable. The throttled callback is called on **trailing** edge.\n *\n * The timeout will be automatically cleared on root dispose.\n *\n * @param callback The callback to throttle\n * @param wait The duration to throttle\n * @returns The throttled callback trigger\n *\n * @see https://github.com/solidjs-community/solid-primitives/tree/main/packages/scheduled#throttle\n *\n * @example\n * ```ts\n * const trigger = throttle((val: string) => console.log(val), 250);\n * trigger(\'my-new-value\');\n * trigger.clear() // clears a timeout in progress\n * ```\n */\nconst throttle$1 = (callback, wait) => {\n    if (web.isServer) {\n        return Object.assign(() => void 0, { clear: () => void 0 });\n    }\n    let isThrottled = false, timeoutId, lastArgs;\n    const throttled = (...args) => {\n        lastArgs = args;\n        if (isThrottled)\n            return;\n        isThrottled = true;\n        timeoutId = setTimeout(() => {\n            callback(...lastArgs);\n            isThrottled = false;\n        }, wait);\n    };\n    const clear = () => {\n        clearTimeout(timeoutId);\n        isThrottled = false;\n    };\n    if (solidJs.getOwner())\n        solidJs.onCleanup(clear);\n    return Object.assign(throttled, { clear });\n};\n/**\n * Creates a scheduled and cancellable callback that will be called on the **leading** edge for the first call, and **trailing** edge for other calls.\n *\n * The timeout will be automatically cleared on root dispose.\n *\n * @param schedule {@link debounce} or {@link throttle}\n * @param callback The callback to debounce/throttle\n * @param wait timeout duration\n * @returns The scheduled callback trigger\n *\n * @see https://github.com/solidjs-community/solid-primitives/tree/main/packages/scheduled#leadingAndTrailing\n *\n * @example\n * ```ts\n * const trigger = leadingAndTrailing(throttle, (val: string) => console.log(val), 250);\n * trigger(\'my-new-value\');\n * trigger.clear() // clears a timeout in progress\n * ```\n */\nfunction leadingAndTrailing(schedule, callback, wait) {\n    if (web.isServer) {\n        let called = false;\n        const scheduled = (...args) => {\n            if (called)\n                return;\n            called = true;\n            callback(...args);\n        };\n        return Object.assign(scheduled, { clear: () => void 0 });\n    }\n    let State;\n    (function (State) {\n        State[State["Ready"] = 0] = "Ready";\n        State[State["Leading"] = 1] = "Leading";\n        State[State["Trailing"] = 2] = "Trailing";\n    })(State || (State = {}));\n    let state = State.Ready;\n    const scheduled = schedule((args) => {\n        state === State.Trailing && callback(...args);\n        state = State.Ready;\n    }, wait);\n    const fn = (...args) => {\n        if (state !== State.Trailing) {\n            if (state === State.Ready)\n                callback(...args);\n            state += 1;\n        }\n        scheduled(args);\n    };\n    const clear = () => {\n        state = State.Ready;\n        scheduled.clear();\n    };\n    if (solidJs.getOwner())\n        solidJs.onCleanup(clear);\n    return Object.assign(fn, { clear });\n}\n/**\n * Creates a signal used for scheduling execution of solid computations by tracking.\n *\n * @param schedule Schedule the invalidate function (can be {@link debounce} or {@link throttle})\n * @returns A function used to track the signal. It returns `true` if the signal is dirty *(callback should be called)* and `false` otherwise.\n *\n * @see https://github.com/solidjs-community/solid-primitives/tree/main/packages/scheduled#createScheduled\n *\n * @example\n * ```ts\n * const debounced = createScheduled(fn => debounce(fn, 250));\n *\n * createEffect(() => {\n *   // track source signal\n *   const value = count();\n *   // track the debounced signal and check if it\'s dirty\n *   if (debounced()) {\n *     console.log(\'count\', value);\n *   }\n * });\n * ```\n */\n// Thanks to Fabio Spampinato (https://github.com/fabiospampinato) for the idea for the primitive\nfunction createScheduled(schedule) {\n    let listeners = 0;\n    let isDirty = false;\n    const [track, dirty] = solidJs.createSignal(void 0, { equals: false });\n    const call = schedule(() => {\n        isDirty = true;\n        dirty();\n    });\n    return () => {\n        if (!isDirty)\n            call(), track();\n        if (isDirty) {\n            isDirty = !!listeners;\n            return true;\n        }\n        if (solidJs.getListener()) {\n            listeners++;\n            solidJs.onCleanup(() => listeners--);\n        }\n        return false;\n    };\n}\n\nfunction getDefaultExportFromCjs (x) {\n\treturn x && x.__esModule && Object.prototype.hasOwnProperty.call(x, \'default\') ? x[\'default\'] : x;\n}\n\nvar es6 = function equal(a, b) {\n  if (a === b) return true;\n\n  if (a && b && typeof a == \'object\' && typeof b == \'object\') {\n    if (a.constructor !== b.constructor) return false;\n\n    var length, i, keys;\n    if (Array.isArray(a)) {\n      length = a.length;\n      if (length != b.length) return false;\n      for (i = length; i-- !== 0;)\n        if (!equal(a[i], b[i])) return false;\n      return true;\n    }\n\n\n    if ((a instanceof Map) && (b instanceof Map)) {\n      if (a.size !== b.size) return false;\n      for (i of a.entries())\n        if (!b.has(i[0])) return false;\n      for (i of a.entries())\n        if (!equal(i[1], b.get(i[0]))) return false;\n      return true;\n    }\n\n    if ((a instanceof Set) && (b instanceof Set)) {\n      if (a.size !== b.size) return false;\n      for (i of a.entries())\n        if (!b.has(i[0])) return false;\n      return true;\n    }\n\n    if (ArrayBuffer.isView(a) && ArrayBuffer.isView(b)) {\n      length = a.length;\n      if (length != b.length) return false;\n      for (i = length; i-- !== 0;)\n        if (a[i] !== b[i]) return false;\n      return true;\n    }\n\n\n    if (a.constructor === RegExp) return a.source === b.source && a.flags === b.flags;\n    if (a.valueOf !== Object.prototype.valueOf) return a.valueOf() === b.valueOf();\n    if (a.toString !== Object.prototype.toString) return a.toString() === b.toString();\n\n    keys = Object.keys(a);\n    length = keys.length;\n    if (length !== Object.keys(b).length) return false;\n\n    for (i = length; i-- !== 0;)\n      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\n\n    for (i = length; i-- !== 0;) {\n      var key = keys[i];\n\n      if (!equal(a[key], b[key])) return false;\n    }\n\n    return true;\n  }\n\n  // true if both NaN, false otherwise\n  return a!==a && b!==b;\n};\n\nconst isEqual = /*@__PURE__*/getDefaultExportFromCjs(es6);\n\n/** å›¾ç‰‡æ–‡ä»¶æ‰©å±•åç¼©å†™ */\nconst fileType = {\n  j: \'jpg\',\n  p: \'png\',\n  g: \'gif\',\n  w: \'webp\',\n  b: \'bmp\'\n};\nconst throttle = (fn, wait = 100) => leadingAndTrailing(throttle$1, fn, wait);\nconst debounce = (fn, wait = 100) => debounce$1(fn, wait);\nconst sleep = ms => new Promise(resolve => setTimeout(resolve, ms));\nconst clamp = (min, val, max) => Math.max(Math.min(max, val), min);\nconst inRange = (min, val, max) => val >= min && val <= max;\nconst getFileName = url => url.match(/.+\\/([^?]+)/)?.[1];\n\n/** åˆ¤æ–­ä¸¤ä¸ªæ•°æ˜¯å¦åœ¨æŒ‡å®šè¯¯å·®èŒƒå›´å†…ç›¸ç­‰ */\nconst approx = (val, target, range = 1) => Math.abs(target - val) <= range;\n\n/** åˆ›å»ºä¸€ä¸ªåªä¼šæ‰§è¡Œä¸€æ¬¡çš„å‡½æ•° */\nconst onec = fn => {\n  let hasRun = false;\n  return () => {\n    if (hasRun) return;\n    hasRun = true;\n    fn();\n  };\n};\n\n// oxlint-disable-next-line func-style\nfunction range(a, b, c) {\n  switch (typeof b) {\n    case \'undefined\':\n      return [...Array.from({\n        length: a\n      }).keys()];\n    case \'number\':\n      {\n        const list = [];\n        for (let i = a; i < b; i++) list.push(c ? c(i) : i);\n        return list;\n      }\n    case \'function\':\n      return Array.from({\n        length: a\n      }, (_, i) => b(i));\n    case \'string\':\n      return Array.from({\n        length: a\n      }, () => b);\n  }\n}\n\n/**\n * å¯¹ document.querySelector çš„å°è£…\n * å°†é»˜è®¤è¿”å›ç±»å‹æ”¹ä¸º HTMLElement\n */\nconst querySelector = selector => document.querySelector(selector);\n\n/**\n * å¯¹ document.querySelector çš„å°è£…\n * å°†é»˜è®¤è¿”å›ç±»å‹æ”¹ä¸º HTMLElement\n */\nconst querySelectorAll = selector => [...document.querySelectorAll(selector)];\n\n/** è¿”å› Dom çš„ç‚¹å‡»å‡½æ•° */\nconst querySelectorClick = (selector, textContent) => {\n  let getDom;\n  if (typeof selector === \'function\') getDom = selector;else if (textContent) {\n    getDom = () => querySelectorAll(selector).find(e => e.textContent?.includes(textContent));\n  } else getDom = () => querySelector(selector);\n  if (getDom()) return () => getDom()?.click();\n};\n\n/** æ‰¾å‡ºæ•°ç»„ä¸­å‡ºç°æœ€å¤šæ¬¡çš„å…ƒç´  */\nconst getMostItem = list => {\n  const counts = new Map();\n  for (const val of list) counts.set(val, (counts.get(val) ?? 0) + 1);\n  return [...counts.entries()].reduce((maxItem, item) => maxItem[1] > item[1] ? maxItem : item)[0];\n};\n\n/** åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸º URL */\nconst isUrl = text => {\n  // ç­‰æµè§ˆå™¨ç‰ˆæœ¬ä¸Šæ¥åå¯ä»¥ç›´æ¥ä½¿ç”¨ URL.canParse\n  try {\n    return Boolean(new URL(text));\n  } catch {\n    return false;\n  }\n};\n\n/** å°† blob æ•°æ®ä½œä¸ºæ–‡ä»¶ä¿å­˜è‡³æœ¬åœ° */\nconst saveAs = (blob, name = \'download\') => {\n  const a = document.createElementNS(\'http://www.w3.org/1999/xhtml\', \'a\');\n  a.download = name;\n  a.rel = \'noopener\';\n  a.href = URL.createObjectURL(blob);\n  setTimeout(() => a.dispatchEvent(new MouseEvent(\'click\')));\n};\n\n/** æ»šåŠ¨é¡µé¢åˆ°æŒ‡å®šå…ƒç´ çš„æ‰€åœ¨ä½ç½® */\nconst scrollIntoView = (selector, behavior = \'instant\') => querySelector(selector)?.scrollIntoView({\n  behavior\n});\n/** ç¡®ä¿å‡½æ•°åœ¨åŒä¸€æ—¶é—´ä¸‹åªæœ‰ä¸€ä¸ªåœ¨è¿è¡Œ */\nconst singleThreaded = (callback, initState) => {\n  const state = {\n    running: false,\n    argList: [],\n    continueRun: (...args) => state.argList.length > 0 || state.argList.push(args),\n    ...initState\n  };\n  const work = async () => {\n    if (state.argList.length === 0) return;\n    const args = state.argList.shift();\n    try {\n      state.running = true;\n      await callback(state, ...args);\n    } catch (error) {\n      await sleep(100);\n      if (state.argList.length === 0) throw error;\n    } finally {\n      if (state.abandon) state.argList.length = 0;\n      if (state.argList.length > 0) setTimeout(work, state.timeout);else state.running = false;\n    }\n  };\n  return (...args) => {\n    state.argList.push(args);\n    if (!state.running) return work();\n  };\n};\n\n/**\n * é™åˆ¶ Promise å¹¶å‘\n * @param fnList ä»»åŠ¡å‡½æ•°åˆ—è¡¨\n * @param callBack æˆåŠŸæ‰§è¡Œä¸€ä¸ª Promise åè°ƒç”¨ï¼Œä¸»è¦ç”¨äºæ˜¾ç¤ºè¿›åº¦\n * @param limit é™åˆ¶æ•°\n * @returns æ‰€æœ‰ Promise çš„è¿”å›å€¼\n */\nconst plimit = async (fnList, callBack = undefined, limit = 10) => {\n  let doneNum = 0;\n  const totalNum = fnList.length;\n  const resList = [];\n  const execPool = new Set();\n  const taskList = fnList.map((fn, i) => {\n    let p;\n    return () => {\n      p = (async () => {\n        resList[i] = await fn();\n        doneNum += 1;\n        execPool.delete(p);\n        callBack?.(doneNum, totalNum, resList, i);\n      })();\n      execPool.add(p);\n    };\n  });\n\n  // eslint-disable-next-line no-unmodified-loop-condition\n  while (doneNum !== totalNum) {\n    while (taskList.length > 0 && execPool.size < limit) taskList.shift()();\n    await Promise.race(execPool);\n  }\n  return resList;\n};\n\n/** Promise å¹¶å‘é˜Ÿåˆ— */\nclass PQueue {\n  wait = new Set();\n  running = new Set();\n  done = new Set();\n  constructor(handleTask, concurrency = 1) {\n    this.handleTask = handleTask;\n    this.concurrency = concurrency;\n  }\n  has = item => this.running.has(item) || this.done.has(item) || this.wait.has(item);\n  async processQueue() {\n    if (this.running.size >= this.concurrency || this.wait.size === 0) return;\n    const [item] = this.wait;\n    if (item === undefined) return;\n    this.wait.delete(item);\n    if (!this.running.has(item)) {\n      try {\n        this.running.add(item);\n        await this.handleTask(item);\n        this.done.add(item);\n      } catch (error) {\n        console.error(error);\n      } finally {\n        this.running.delete(item);\n      }\n    }\n    return this.processQueue();\n  }\n  add(item) {\n    if (this.has(item)) return;\n    this.wait.add(item);\n    this.processQueue();\n  }\n  set(...items) {\n    this.wait.clear();\n    this.wait = new Set(items.filter(item => !this.has(item)));\n    this.processQueue();\n  }\n  clear() {\n    this.wait.clear();\n    this.done.clear();\n  }\n}\n\n/**\n * åˆ¤æ–­ä½¿ç”¨å‚æ•°é¢œè‰²ä½œä¸ºé»˜è®¤å€¼æ—¶æ˜¯å¦éœ€è¦åˆ‡æ¢ä¸ºé»‘æš—æ¨¡å¼\n * @param hexColor åå…­è¿›åˆ¶é¢œè‰²ã€‚ä¾‹å¦‚ #112233\n */\nconst needDarkMode = hexColor => {\n  // by: https://24ways.org/2010/calculating-color-contrast\n  const r = Number.parseInt(hexColor.slice(1, 3), 16);\n  const g = Number.parseInt(hexColor.slice(3, 5), 16);\n  const b = Number.parseInt(hexColor.slice(5, 7), 16);\n  const yiq = (r * 299 + g * 587 + b * 114) / 1000;\n  return yiq < 128;\n};\n\n// oxlint-disable-next-line func-style\nasync function wait(fn, timeout = Number.POSITIVE_INFINITY, waitTime = 100) {\n  let res = await fn();\n  let _timeout = timeout;\n  while (_timeout > 0 && !res) {\n    await sleep(waitTime);\n    _timeout -= waitTime;\n    res = await fn();\n  }\n  return res;\n}\n\nasync function waitDom(selector, timeout) {\n  return wait(() => querySelector(selector), timeout);\n}\n\n/** ç­‰å¾…æŒ‡å®šçš„å›¾ç‰‡å…ƒç´ åŠ è½½å®Œæˆ */\nconst waitImgLoad = (target, timeout) => new Promise((resolve, reject) => {\n  const img = typeof target === \'string\' ? new Image() : target;\n  if (img.complete && img.naturalHeight) resolve(img);\n  const id = timeout ? window.setTimeout(() => reject(new Error(\'timeout\')), timeout) : undefined;\n  const handleError = e => {\n    window.clearTimeout(id);\n    reject(new Error(e.message));\n  };\n  const handleLoad = () => {\n    window.clearTimeout(id);\n    img.removeEventListener(\'error\', handleError);\n    resolve(img);\n  };\n  img.addEventListener(\'load\', handleLoad, {\n    once: true\n  });\n  img.addEventListener(\'error\', handleError, {\n    once: true\n  });\n  if (typeof target === \'string\') img.src = target;\n});\n\n/** å°†æŒ‡å®šçš„å¸ƒå°”å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²æˆ–æœªå®šä¹‰ */\nconst boolDataVal = val => val ? \'\' : undefined;\n\n/** æµ‹è¯•å›¾ç‰‡ url èƒ½å¦æ­£ç¡®åŠ è½½ */\nconst testImgUrl = url => new Promise(resolve => {\n  const img = new Image();\n  img.onload = () => resolve(true);\n  img.onerror = () => resolve(false);\n  img.src = url;\n});\nconst canvasToBlob = (canvas, type, quality = 1) => {\n  if (canvas instanceof OffscreenCanvas) return canvas.convertToBlob({\n    type,\n    quality\n  });\n  return new Promise((resolve, reject) => {\n    canvas.toBlob(blob => blob ? resolve(blob) : reject(new Error(\'Canvas toBlob failed\')), type, quality);\n  });\n};\n\n/**\n * æ±‚ a å’Œ b çš„å·®é›†ï¼Œç›¸å½“äºä» a ä¸­åˆ å»å’Œ b ç›¸åŒçš„å±æ€§\n *\n * ä¸ä¼šä¿®æ”¹å‚æ•°å¯¹è±¡ï¼Œè¿”å›çš„æ˜¯æ–°å¯¹è±¡\n */\nconst difference = (a, b) => {\n  const res = {};\n  const keys = Object.keys(a);\n  for (const key of keys) {\n    if (typeof a[key] === \'object\' && typeof b[key] === \'object\') {\n      const _res = difference(a[key], b[key]);\n      if (Object.keys(_res).length > 0) res[key] = _res;\n    } else if (a[key] !== b?.[key]) res[key] = a[key];\n  }\n  return res;\n};\nconst _assign = (a, b) => {\n  // oxlint-disable-next-line prefer-structured-clone\n  const res = JSON.parse(JSON.stringify(a));\n  const keys = Object.keys(b);\n  for (const key of keys) {\n    if (res[key] === undefined) res[key] = b[key];else if (typeof b[key] === \'object\') {\n      const _res = _assign(res[key], b[key]);\n      if (Object.keys(_res).length > 0) res[key] = _res;\n    } else if (res[key] !== b[key]) res[key] = b[key];\n  }\n  return res;\n};\n\n/**\n * Object.assign çš„æ·±æ‹·è´ç‰ˆï¼Œä¸ä¼šå¯¼è‡´å­å¯¹è±¡å±æ€§çš„ç¼ºå¤±\n *\n * ä¸ä¼šä¿®æ”¹å‚æ•°å¯¹è±¡ï¼Œè¿”å›çš„æ˜¯æ–°å¯¹è±¡\n */\nconst assign = (target, ...sources) => {\n  let res = target;\n  for (const source of sources) if (typeof source === \'object\') res = _assign(res, source);\n  return res;\n};\n\n/** æ ¹æ®è·¯å¾„è·å–å¯¹è±¡ä¸‹çš„æŒ‡å®šå€¼ */\nconst byPath = (obj, path, handleVal) => {\n  const keys = typeof path === \'string\' ? path.split(\'.\') : path;\n  let target = obj;\n  for (let i = 0; i < keys.length; i++) {\n    let key = keys[i];\n\n    // å…¼å®¹å«æœ‰ã€Œ.ã€çš„ key\n    while (!Reflect.has(target, key) && i < keys.length) {\n      i += 1;\n      if (keys[i] === undefined) break;\n      key += `.${keys[i]}`;\n    }\n    if (handleVal && i > keys.length - 2 && Reflect.has(target, key)) {\n      const res = handleVal(target, key);\n      while (i < keys.length - 1) {\n        target = target[key];\n        i += 1;\n        key = keys[i];\n      }\n      if (res !== undefined) target[key] = res;\n      break;\n    }\n    target = target[key];\n  }\n  if (target === obj) return null;\n  return target;\n};\nconst requestIdleCallback = (callback, timeout) => {\n  if (Reflect.has(window, \'requestIdleCallback\')) return window.requestIdleCallback(callback, {\n    timeout\n  });\n  return window.setTimeout(callback, 16);\n};\n\n/** è·å–é”®ç›˜äº‹ä»¶çš„ç¼–ç  */\nconst getKeyboardCode = e => {\n  let {\n    key\n  } = e;\n  switch (key) {\n    case \'Shift\':\n    case \'Control\':\n    case \'Alt\':\n      return key;\n  }\n  key = key.replaceAll(/\\b[A-Z]\\b/g, match => match.toLowerCase());\n  if (e.ctrlKey) key = `Ctrl + ${key}`;\n  if (e.altKey) key = `Alt + ${key}`;\n  if (e.shiftKey) key = `Shift + ${key}`;\n  return key;\n};\n\n/** å°†å¿«æ·é”®çš„ç¼–ç è½¬æ¢æˆæ›´æ˜“è¯»çš„å½¢å¼ */\nconst keyboardCodeToText = code => code.replace(\'Control\', \'Ctrl\').replace(\'ArrowUp\', \'â†‘\').replace(\'ArrowDown\', \'â†“\').replace(\'ArrowLeft\', \'â†\').replace(\'ArrowRight\', \'â†’\').replace(/^\\s$/, \'Space\');\n\n/** å°† HTML å­—ç¬¦ä¸²è½¬æ¢ä¸º DOM å¯¹è±¡ */\nconst domParse = html => new DOMParser().parseFromString(html, \'text/html\');\n\n/**\n * åŠ«æŒä¿®æ”¹åŸç½‘é¡µä¸Šçš„å‡½æ•°\n *\n * å¦‚æœä¼ å…¥å‡½æ•°çš„æ‰€éœ€å‚æ•°ä¸ºé›¶ï¼Œå°†åœ¨åŸå‡½æ•°æ‰§è¡Œå®Œåè‡ªåŠ¨è°ƒç”¨\n */\nconst hijackFn = (fnName, fn) => {\n  const rawFn = unsafeWindow[fnName];\n  unsafeWindow[fnName] = fn.length === 0 ? (...args) => {\n    const res = rawFn(...args);\n    fn();\n    return res;\n  } : (...args) => fn(rawFn, args);\n};\nconst getGmValue = async (name, setValueFn) => {\n  const value = await GM.getValue(name);\n  if (value !== undefined) return value;\n  await setValueFn();\n  return await GM.getValue(name);\n};\n\n/** æ ¹æ®èŒƒå›´æ–‡æœ¬æå–æŒ‡å®šèŒƒå›´çš„å…ƒç´ çš„ index */\nconst extractRange = (rangeText, length) => {\n  const list = new Set();\n  for (const text of rangeText.replaceAll(/[^\\d,-]/g, \'\').split(\',\')) {\n    if (/^\\d+$/.test(text)) list.add(Number(text) - 1);else if (/^\\d*-\\d*$/.test(text)) {\n      let [start, end] = text.split(\'-\').map(Number);\n      end ||= length;\n      for (start--, end--; start <= end; start++) list.add(start);\n    }\n  }\n  return list;\n};\n\n/** extractRange çš„é€†å‘ï¼ŒæŒ‰ç…§ç›¸åŒçš„è¯­æ³•è¡¨è¿°ä¸€ä¸ªç»“æœæ•°ç»„ */\nconst descRange = (list, length) => {\n  let text = \'\';\n  const nowRange = [];\n  const pushRange = newIndex => {\n    if (nowRange.length === 0) return;\n    if (text.length > 0) text += \', \';\n    if (nowRange.length === 1) text += nowRange[0] + 1;else {\n      const end = newIndex === undefined && nowRange[1] === length - 1 ? \'\' : nowRange[1] + 1;\n      text += `${nowRange[0] + 1}-${end}`;\n    }\n    nowRange.length = 0;\n    if (newIndex !== undefined) nowRange[0] = newIndex;\n  };\n  for (const i of list) {\n    switch (nowRange.length) {\n      case 0:\n        nowRange[0] = i;\n        break;\n      case 1:\n        if (i === nowRange[0] + 1) nowRange[1] = i;else pushRange(i);\n        break;\n      case 2:\n        if (i === nowRange[1] + 1) nowRange[1] = i;else pushRange(i);\n        break;\n    }\n  }\n  pushRange();\n  return text;\n};\n\n/** ç›‘å¬ url å˜åŒ– */\nconst onUrlChange = (fn, handleUrl = location => location.href) => {\n  let lastUrl = \'\';\n  const refresh = singleThreaded(async () => {\n    if (!(await wait(() => handleUrl(location) !== lastUrl, 5000))) return;\n    const nowUrl = handleUrl(location);\n    await fn(lastUrl, nowUrl);\n    lastUrl = nowUrl;\n  });\n  const controller = new AbortController();\n  for (const eventName of [\'click\', \'popstate\']) window.addEventListener(eventName, refresh, {\n    capture: true,\n    signal: controller.signal\n  });\n  refresh();\n  return () => controller.abort();\n};\n\n/** waitï¼Œä½†æ˜¯åªåœ¨ url å˜åŒ–æ—¶åˆ¤æ–­ */\nconst waitUrlChange = isValidUrl => new Promise(resolve => {\n  const abort = onUrlChange(() => {\n    if (!isValidUrl()) return;\n    resolve();\n    abort();\n  });\n});\n\n// TODO: ç”¨è¿™ä¸ªé‡æ„ç›¸å…³å®ç°\nclass AnimationFrame {\n  animationId = 0;\n  call = () => {\n    this.animationId = requestAnimationFrame(this.frame);\n  };\n  cancel = () => {\n    if (!this.animationId) return;\n    cancelAnimationFrame(this.animationId);\n    this.animationId = 0;\n  };\n}\n\n/** é”å®šå±å¹•ç¦æ­¢è‡ªåŠ¨ç†„å± */\nclass WakeLock {\n  isSupported = false;\n  lock = null;\n  constructor() {\n    if (!(\'wakeLock\' in navigator)) return;\n    this.isSupported = true;\n  }\n  on = async () => {\n    if (!this.isSupported) return null;\n    try {\n      this.lock = await navigator.wakeLock.request(\'screen\');\n      return this.lock.released;\n    } catch {\n      return false;\n    }\n  };\n  off = async () => {\n    if (!this.lock) return;\n    await this.lock.release();\n    this.lock = null;\n  };\n}\nconst getImageData = img => {\n  const {\n    naturalWidth: width,\n    naturalHeight: height\n  } = img;\n  const canvas = new OffscreenCanvas(width, height);\n  const ctx = canvas.getContext(\'2d\', {\n    willReadFrequently: true\n  });\n  ctx.drawImage(img, 0, 0);\n  return ctx.getImageData(0, 0, width, height);\n};\n\nconst [lang, setLang] = solidJs.createSignal(\'zh\');\nconst setInitLang = async () => setLang(await languages.getInitLang());\nconst t = solidJs.createRoot(() => {\n  solidJs.createEffect(solidJs.on(lang, () => languages.setSaveLang(lang()), {\n    defer: true\n  }));\n  const locales = solidJs.createMemo(() => {\n    switch (lang()) {\n      case \'en\':\n        return en;\n      case \'ru\':\n        return ru;\n      default:\n        return zh;\n    }\n  });\n  return (keys, variables) => {\n    let text = byPath(locales(), keys) ?? \'\';\n    if (variables) for (const [k, v] of Object.entries(variables)) text = text.replaceAll(`{{${k}}}`, `${String(v)}`);\n    return text;\n  };\n});\n\nconst prefix = [\'%cComicRead\', \'background-color: #607d8b; color: white; padding: 2px 4px; border-radius: 4px;\'];\n\n// oxlint-disable-next-line no-console\nconst log = (...args) => console.log(...prefix, ...args);\nlog.warn = (...args) => console.warn(...prefix, ...args);\nlog.error = (...args) => console.error(...prefix, ...args);\n\nlet publicOwner;\nsolidJs.createRoot(() => {\n  publicOwner = solidJs.getOwner();\n});\n\n/** ä¼šè‡ªåŠ¨è®¾ç½® equals çš„ createSignal */\nconst createEqualsSignal = (init, options) => solidJs.createSignal(init, {\n  equals: isEqual,\n  ...options\n});\n\n/** ä¼šè‡ªåŠ¨è®¾ç½® equals å’Œ createRoot çš„ createMemo */\nconst createRootMemo = (fn, init, options) => {\n  // å¦‚æœå‡½æ•°å·²ç»æ˜¯ createMemo åˆ›å»ºçš„ï¼Œå°±ç›´æ¥ä½¿ç”¨\n  if (fn.name === \'bound readSignal\') return fn;\n  const _init = init ?? fn(undefined);\n  // è‡ªåŠ¨ä¸ºå¯¹è±¡ç±»å‹è®¾ç½® equals\n  const _options = options?.equals === undefined && typeof _init === \'object\' ? {\n    ...options,\n    equals: isEqual\n  } : options;\n  return solidJs.getOwner() ? solidJs.createMemo(fn, _init, _options) : solidJs.runWithOwner(publicOwner, () => solidJs.createMemo(fn, _init, _options));\n};\n\n/** èŠ‚æµçš„ createMemo */\nconst createThrottleMemo = (fn, wait = 100, init = fn(undefined), options = undefined) => {\n  const scheduled = createScheduled(_fn => throttle(_fn, wait));\n  return createRootMemo(prev => scheduled() ? fn(prev) : prev, init, options);\n};\nconst createMemoMap = fnMap => {\n  const memoMap = Object.fromEntries(Object.entries(fnMap).map(([key, fn]) => [key, createRootMemo(fn)]));\n  const map = createRootMemo(() => {\n    const obj = {};\n    for (const key of Object.keys(memoMap)) Reflect.set(obj, key, memoMap[key]());\n    return obj;\n  });\n  return map;\n};\nconst createRootEffect = (fn, val, options) => solidJs.getOwner() ? solidJs.createEffect(fn, val, options) : solidJs.runWithOwner(publicOwner, () => solidJs.createEffect(fn, val, options));\nconst createEffectOn = (deps, fn, options) => createRootEffect(solidJs.on(deps, fn, options));\nconst onAutoMount = fn => {\n  const owner = solidJs.getOwner();\n  if (!owner) return fn(owner);\n  solidJs.onMount(() => {\n    const cleanFn = fn(owner);\n    if (cleanFn) solidJs.onCleanup(cleanFn);\n  });\n};\n\nconst promisifyRequest = request => new Promise((resolve, reject) => {\n  request.onsuccess = () => resolve(request.result);\n  request.onerror = () => reject(request.error);\n});\nconst openDb = (name, version, initSchema) => new Promise((resolve, reject) => {\n  const request = indexedDB.open(`ComicReadScript${name}`, version);\n  request.onupgradeneeded = () => initSchema(request.result);\n  request.onsuccess = () => resolve(request.result);\n  request.onerror = error => {\n    console.error(\'æ•°æ®åº“æ‰“å¼€å¤±è´¥\', error);\n    reject(new Error(\'æ•°æ®åº“æ‰“å¼€å¤±è´¥\'));\n  };\n});\nconst useCache = async (schema, name = \'\', version = 2) => {\n  const db = await openDb(name, version, typeof schema === \'function\' ? schema : db => {\n    for (const storeName of db.objectStoreNames) if (!Reflect.has(schema, storeName)) db.deleteObjectStore(storeName);\n    for (const storeName of Object.keys(schema)) {\n      if (!db.objectStoreNames.contains(storeName)) db.createObjectStore(storeName, {\n        keyPath: schema[storeName]\n      });\n    }\n  });\n  return {\n    set: (storeName, value) => promisifyRequest(db.transaction(storeName, \'readwrite\').objectStore(storeName).put(value)),\n    get: (storeName, query) => promisifyRequest(db.transaction(storeName, \'readonly\').objectStore(storeName).get(query)),\n    del: (storeName, query) => promisifyRequest(db.transaction(storeName, \'readwrite\').objectStore(storeName).delete(query)),\n    each(storeName, callback) {\n      const request = db.transaction(storeName, \'readwrite\').objectStore(storeName).openCursor();\n      request.onsuccess = async function onsuccess(event) {\n        const cursor = event.target.result;\n        if (!cursor) return;\n        await callback(cursor.value, cursor);\n        cursor.continue();\n      };\n    }\n  };\n};\n\nconst createPointerState = (e, type = \'down\') => {\n  const xy = [e.clientX, e.clientY];\n  return {\n    id: e.pointerId,\n    type,\n    xy,\n    initial: xy,\n    last: xy,\n    startTime: performance.now(),\n    target: e.target\n  };\n};\nconst useDrag = ({\n  ref,\n  handleDrag,\n  easyMode,\n  handleClick,\n  skip,\n  setCapture,\n  touches = new Map()\n}) => {\n  onAutoMount(() => {\n    const controller = new AbortController();\n    const options = {\n      capture: false,\n      passive: true,\n      signal: controller.signal\n    };\n    let allowClick = -1;\n    const handleDown = e => {\n      if (skip?.(e)) return;\n      e.stopPropagation();\n      if (!easyMode?.() && e.buttons !== 1) return;\n      if (setCapture) ref.setPointerCapture(e.pointerId);\n      const state = createPointerState(e);\n      touches.set(e.pointerId, state);\n      handleDrag(state, e);\n\n      // åœ¨æ—¶é™å†…æ¾æ‰‹æ‰è§¦å‘ click äº‹ä»¶\n      allowClick = window.setTimeout(() => {\n        allowClick = 0;\n      }, 300);\n    };\n    const handleMove = e => {\n      e.preventDefault();\n      if (!easyMode?.() && e.buttons !== 1) return;\n      const state = touches.get(e.pointerId);\n      if (!state) return;\n      state.type = \'move\';\n      state.xy = [e.clientX, e.clientY];\n      handleDrag(state, e);\n      state.last = state.xy;\n\n      // æ‹–æ‹½ä¸€æ®µè·ç¦»åå°±ä¸è§¦å‘ click äº†\n      if (allowClick > 0 && (Math.abs(e.clientX - state.initial[0]) > 5 || Math.abs(e.clientY - state.initial[1]) > 5)) {\n        window.clearTimeout(allowClick);\n        allowClick = -2;\n      }\n    };\n    const handleUp = e => {\n      e.stopPropagation();\n      ref.releasePointerCapture(e.pointerId);\n      const state = touches.get(e.pointerId);\n      if (!state) return;\n      touches.delete(e.pointerId);\n      state.type = \'up\';\n      state.xy = [e.clientX, e.clientY];\n\n      // åˆ¤æ–­å•å‡»\n      if (handleClick && allowClick && touches.size === 0 && approx(state.xy[0] - state.initial[0], 0, 5) && approx(state.xy[1] - state.initial[1], 0, 5)) handleClick(e, state.target);\n      window.clearTimeout(allowClick);\n      handleDrag(state, e);\n    };\n    const handleCancel = e => {\n      e.stopPropagation();\n      ref.releasePointerCapture(e.pointerId);\n      const state = touches.get(e.pointerId);\n      if (!state) return;\n      state.type = \'cancel\';\n      handleDrag(state, e);\n      touches.clear();\n    };\n    ref.addEventListener(\'pointerdown\', handleDown, options);\n    ref.addEventListener(\'pointermove\', handleMove, {\n      ...options,\n      passive: false\n    });\n    ref.addEventListener(\'pointerup\', handleUp, options);\n    ref.addEventListener(\'pointercancel\', handleCancel, options);\n    if (easyMode) {\n      ref.addEventListener(\'pointerover\', handleDown, options);\n      ref.addEventListener(\'pointerout\', handleUp, options);\n    }\n    ref.addEventListener(\'click\', e => {\n      if (allowClick > 0 && touches.size === 0 || skip?.(e)) return;\n      e.stopPropagation();\n      e.preventDefault();\n    }, {\n      capture: true\n    });\n    return () => controller.abort();\n  });\n};\n\nconst useStore = initState => {\n  const [store$1, _setState] = store.createStore(initState);\n  const setState = (...args) => {\n    if (args.length === 1 && typeof args[0] === \'function\') return _setState(store.produce(args[0]));\n    return _setState(...args);\n  };\n  return {\n    store: store$1,\n    setState\n  };\n};\n\nconst useStyleSheet = e => {\n  const styleSheet = new CSSStyleSheet();\n  onAutoMount(() => {\n    const root = e?.getRootNode() ?? document;\n    root.adoptedStyleSheets = [...root.adoptedStyleSheets, styleSheet];\n    return () => {\n      const index = root.adoptedStyleSheets.indexOf(styleSheet);\n      if (index !== -1) root.adoptedStyleSheets.splice(index, 1);\n    };\n  });\n  return styleSheet;\n};\nconst useStyle = (css, e) => {\n  const styleSheet = useStyleSheet(e);\n  if (typeof css === \'string\') styleSheet.replaceSync(css);else createEffectOn(createRootMemo(css), style => styleSheet.replaceSync(style));\n};\n/** ç”¨ CSSStyleSheet å®ç°å’Œä¿®æ”¹ style ä¸€æ ·çš„æ•ˆæœ */\nconst useStyleMemo = (selector, styleMapArg, e) => {\n  const styleSheet = useStyleSheet(e);\n  styleSheet.insertRule(`${selector} { }`);\n  const {\n    style\n  } = styleSheet.cssRules[0];\n  // ç­‰ç«ç‹å®ç°äº† CSS Typed OM åæ”¹ç”¨ styleMap æ€§èƒ½ä¼šæ›´å¥½ï¼Œä¹Ÿèƒ½ä½¿ç”¨ CSS Typed OM çš„ å•ä½\n\n  const setStyle = (key, val) => {\n    if (val === undefined || val === \'\') return style.removeProperty(key);\n    style.setProperty(key, typeof val === \'string\' ? val : `${val}`);\n  };\n  const styleMapList = Array.isArray(styleMapArg) ? styleMapArg : [styleMapArg];\n  for (const styleMap of styleMapList) {\n    if (typeof styleMap === \'object\') {\n      for (const [key, val] of Object.entries(styleMap)) {\n        const styleText = createRootMemo(val);\n        createEffectOn(styleText, newVal => setStyle(key, newVal));\n      }\n    } else {\n      const styleMemoMap = createRootMemo(styleMap);\n      createEffectOn(styleMemoMap, map => {\n        for (const [key, val] of Object.entries(map)) setStyle(key, val);\n      });\n    }\n  }\n};\n\nexports.AnimationFrame = AnimationFrame;\nexports.FaviconProgress = FaviconProgress;\nexports.PQueue = PQueue;\nexports.WakeLock = WakeLock;\nexports.approx = approx;\nexports.assign = assign;\nexports.boolDataVal = boolDataVal;\nexports.byPath = byPath;\nexports.canvasToBlob = canvasToBlob;\nexports.clamp = clamp;\nexports.createEffectOn = createEffectOn;\nexports.createEqualsSignal = createEqualsSignal;\nexports.createMemoMap = createMemoMap;\nexports.createRootEffect = createRootEffect;\nexports.createRootMemo = createRootMemo;\nexports.createScheduled = createScheduled;\nexports.createThrottleMemo = createThrottleMemo;\nexports.debounce = debounce;\nexports.descRange = descRange;\nexports.difference = difference;\nexports.domParse = domParse;\nexports.extractRange = extractRange;\nexports.fileType = fileType;\nexports.getFileName = getFileName;\nexports.getGmValue = getGmValue;\nexports.getImageData = getImageData;\nexports.getKeyboardCode = getKeyboardCode;\nexports.getMostItem = getMostItem;\nexports.hijackFn = hijackFn;\nexports.inRange = inRange;\nexports.isEqual = isEqual;\nexports.isUrl = isUrl;\nexports.keyboardCodeToText = keyboardCodeToText;\nexports.lang = lang;\nexports.log = log;\nexports.mountComponents = mountComponents;\nexports.needDarkMode = needDarkMode;\nexports.onAutoMount = onAutoMount;\nexports.onUrlChange = onUrlChange;\nexports.onec = onec;\nexports.plimit = plimit;\nexports.promisifyRequest = promisifyRequest;\nexports.querySelector = querySelector;\nexports.querySelectorAll = querySelectorAll;\nexports.querySelectorClick = querySelectorClick;\nexports.range = range;\nexports.requestIdleCallback = requestIdleCallback;\nexports.saveAs = saveAs;\nexports.scrollIntoView = scrollIntoView;\nexports.setInitLang = setInitLang;\nexports.setLang = setLang;\nexports.singleThreaded = singleThreaded;\nexports.sleep = sleep;\nexports.t = t;\nexports.testImgUrl = testImgUrl;\nexports.throttle = throttle;\nexports.useCache = useCache;\nexports.useDrag = useDrag;\nexports.useFaviconProgress = useFaviconProgress;\nexports.useStore = useStore;\nexports.useStyle = useStyle;\nexports.useStyleMemo = useStyleMemo;\nexports.wait = wait;\nexports.waitDom = waitDom;\nexports.waitImgLoad = waitImgLoad;\nexports.waitUrlChange = waitUrlChange;\n';break;case"request":c="\nconst Toast = require('components/Toast');\nconst helper = require('helper');\n\n// å°† xmlHttpRequest åŒ…è£…ä¸º Promise\nconst xmlHttpRequest = details => new Promise((resolve, reject) => {\n  const handleError = error => {\n    details.onerror?.(error);\n    console.error('GM_xmlhttpRequest Error', error);\n    reject(new Error(error?.responseText || 'GM_xmlhttpRequest Error'));\n  };\n  const abort = GM_xmlhttpRequest({\n    ...details,\n    onload(res) {\n      details.onload?.call(res, res);\n      resolve(res);\n    },\n    onerror: handleError,\n    ontimeout: handleError,\n    onabort: handleError\n  });\n  details.signal?.addEventListener('abort', abort.abort);\n});\n\n/** å‘èµ·è¯·æ±‚ */\nconst request = async (url, details = {}, retryNum = 0, errorNum = 0) => {\n  const headers = {\n    Referer: location.href\n  };\n  const errorText = `${details?.errorText ?? helper.t('alert.comic_load_error')}\\nurl: ${url}`;\n  details.fetch ??= url.startsWith('/') || url.startsWith(location.origin);\n  try {\n    // è™½ç„¶ GM_xmlhttpRequest æœ‰ fetch é€‰é¡¹ï¼Œä½†åœ¨ stay ä¸Šä¸å¤ªç¨³å®š\n    // ä¸ºäº†æ”¯æŒ ios ç«¯åªèƒ½è‡ªå·±å®ç°ä¸€ä¸‹äº†\n    if (details.fetch || typeof GM_xmlhttpRequest === 'undefined') {\n      const res = await fetch(url, {\n        method: 'GET',\n        headers,\n        signal: AbortSignal.timeout?.(details.timeout ?? 1000 * 10),\n        body: details.data,\n        ...details\n      });\n      if (!details.noCheckCode && res.status !== 200) {\n        helper.log.error(errorText, res);\n        throw new Error(errorText);\n      }\n      let response = null;\n      switch (details.responseType) {\n        case 'arraybuffer':\n          response = await res.arrayBuffer();\n          break;\n        case 'blob':\n          response = await res.blob();\n          break;\n        case 'json':\n          response = await res.json();\n          break;\n      }\n      const _res = {\n        status: res.status,\n        statusText: res.statusText,\n        response,\n        responseText: response ? '' : await res.text()\n      };\n      details.onload?.call(_res, _res);\n      return _res;\n    }\n    let targetUrl = url;\n    // https://github.com/hymbz/ComicReadScript/issues/195\n    // åœ¨æŸäº›æƒ…å†µä¸‹ Tampermonkey æ— æ³•æ­£ç¡®å¤„ç†ç›¸å¯¹åè®®çš„ url\n    // å®é™… finalUrl ä¼šå˜æˆ `///xxx.xxx` è«åå¤šäº†ä¸€ä¸ªæ–œæ \n    // ç„¶è€Œåœ¨ä¿®æ”¹ä»£ç å‘å‡ºæ­£ç¡®çš„è¯·æ±‚åï¼Œå°±å†ä¹Ÿæ— æ³•å¤ç°äº†\n    // ä¸è¿‡ä»¥é˜²ä¸‡ä¸€è¿˜æ˜¯åœ¨è¿™é‡Œæ‰‹åŠ¨å¤„ç†ä¸‹\n    if (url.startsWith('//')) targetUrl = `http:${url}`;\n    // stay æ²¡æ³•å¤„ç†ç›¸å¯¹è·¯å¾„ï¼Œä¹Ÿå¾—è½¬æ¢ä¸€ä¸‹\n    else if (url.startsWith('/')) targetUrl = `${location.origin}${url}`;\n    const res = await xmlHttpRequest({\n      method: 'GET',\n      url: targetUrl,\n      headers,\n      timeout: 1000 * 10,\n      ...details\n    });\n    if (!details.noCheckCode && res.status !== 200) {\n      helper.log.error(errorText, res);\n      throw new Error(errorText);\n    }\n\n    // stay å¥½åƒæ²¡æœ‰æ­£ç¡®å¤„ç† jsonï¼Œåªèƒ½å†å•ç‹¬åˆ¤æ–­å¤„ç†ä¸€ä¸‹\n    if (details.responseType === 'json' && res.responseText && (typeof res.response !== 'object' || Object.keys(res.response).length === 0)) {\n      try {\n        Reflect.set(res, 'response', JSON.parse(res.responseText));\n      } catch {}\n    }\n    return res;\n  } catch (error) {\n    if (details && details.retryFetch && retryNum === 0) {\n      console.warn('retryFetch', url);\n      details.fetch = !details.fetch;\n      return request(url, details, retryNum + 1, errorNum);\n    }\n    if (errorNum >= retryNum) {\n      (details.noTip ? console.error : Toast.toast.error)(`${errorText}\\nerror: ${error.message}`);\n      throw new Error(errorText, {\n        cause: error\n      });\n    }\n    helper.log.error(errorText, error);\n    await helper.sleep(1000);\n    return request(url, details, retryNum, errorNum + 1);\n  }\n};\n\n/** è½®æµå‘å¤šä¸ª api å‘èµ·è¯·æ±‚ */\nconst eachApi = async (url, baseUrlList, details) => {\n  for (const baseUrl of baseUrlList) {\n    try {\n      return await request(`${baseUrl}${url}`, {\n        ...details,\n        noTip: true\n      });\n    } catch {}\n  }\n  const errorText = details?.errorText ?? helper.t('alert.comic_load_error');\n  if (!details?.noTip) Toast.toast.error(errorText);\n  helper.log.error('æ‰€æœ‰ api è¯·æ±‚å‡å¤±è´¥', url, baseUrlList, details);\n  throw new Error(errorText);\n};\n\nexports.eachApi = eachApi;\nexports.request = request;\n";break;case"components/Manga":c="\nconst web = require('solid-js/web');\nconst solidJs = require('solid-js');\nconst helper = require('helper');\nconst request = require('request');\nconst Comlink = require('comlink');\nconst store$1 = require('solid-js/store');\nconst worker = require('worker/ImageRecognition');\nconst fflate = require('fflate');\nconst IconButton$1 = require('components/IconButton');\nconst Toast = require('components/Toast');\nconst worker$1 = require('worker/ImageUpscale');\n\nconst imgState = {\n  imgMap: {},\n  imgList: [],\n  pageList: [],\n  fillEffect: {\n    '-1': true\n  },\n  showRange: [0, 0],\n  renderRange: [0, 0],\n  loadingRange: [0, 0],\n  defaultImgType: ''\n};\n\nconst _defaultOption = {\n  dir: 'rtl',\n  scrollbar: {\n    position: 'auto',\n    autoHidden: false,\n    showImgStatus: true,\n    easyScroll: false\n  },\n  clickPageTurn: {\n    enabled: 'ontouchstart' in document.documentElement,\n    reverse: false,\n    area: 'left_right',\n    shrinkMenu: false\n  },\n  firstPageFill: true,\n  disableZoom: false,\n  darkMode: false,\n  autoDarkMode: false,\n  swapPageTurnKey: false,\n  scroolEnd: 'auto',\n  alwaysLoadAllImg: false,\n  showComment: true,\n  preloadPageNum: 20,\n  pageNum: 0,\n  autoSwitchPageMode: true,\n  autoHiddenMouse: true,\n  autoFullscreen: false,\n  zoom: {\n    ratio: 100,\n    offset: {\n      x: 0,\n      y: 0\n    }\n  },\n  scrollMode: {\n    enabled: false,\n    spacing: 0,\n    imgScale: 1,\n    adjustToWidth: 'disable',\n    abreastMode: false,\n    abreastDuplicate: 0.1,\n    doubleMode: false,\n    alignEdge: false\n  },\n  imgRecognition: {\n    enabled: false,\n    background: true,\n    pageFill: true,\n    upscale: false\n  },\n  translation: {\n    server: 'disable',\n    localUrl: undefined,\n    forceRetry: false,\n    // ä¸€äº›å‚æ•°æ²¡æœ‰ä½¿ç”¨é»˜è®¤å€¼ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨æ–‡æ¡£çš„æ¨èå€¼\n    // https://github.com/zyddnys/manga-image-translator?tab=readme-ov-file#recommended-modules\n    options: {\n      detector: {\n        detector: 'ctd',\n        detection_size: '1536',\n        box_threshold: 0.7,\n        unclip_ratio: 2.3\n      },\n      render: {\n        direction: 'auto'\n      },\n      translator: {\n        translator: 'gpt3.5',\n        target_lang: {\n          zh: 'CHS',\n          en: 'ENG',\n          ru: 'RUS'\n        }[helper.lang()] ?? 'CHS'\n      },\n      inpainter: {\n        inpainter: 'lama_large',\n        inpainting_size: '2048'\n      },\n      mask_dilation_offset: 30\n    },\n    onlyDownloadTranslated: false\n  },\n  autoScroll: {\n    enabled: false,\n    interval: 3000,\n    distance: 200,\n    triggerEnd: false\n  }\n};\nconst defaultOption = () => structuredClone(_defaultOption);\nconst optionState = {\n  defaultOption: defaultOption(),\n  option: defaultOption()\n};\n\nconst otherState = {\n  /** æ¼«ç”»æ ‡é¢˜ */\n  title: '',\n  /**\n   * ç”¨äºé˜²æ­¢æ»šè½®è¿ç»­æ»šåŠ¨å¯¼è‡´è¿‡å¿«è§¦å‘äº‹ä»¶çš„é”\n   *\n   * - åœ¨é¦–æ¬¡è§¦å‘ç»“æŸé¡µæ—¶å¼€å¯ï¼Œä¸€æ®µæ—¶é—´å…³é—­ã€‚å¼€å¯æ—¶ç¦æ­¢è§¦å‘ç»“æŸé¡µçš„ä¸Šä¸‹è¯åˆ‡æ¢åŠŸèƒ½ã€‚\n   */\n  scrollLock: false,\n  /** å½“å‰æ˜¯å¦å¤„äºå…¨å±çŠ¶æ€ */\n  fullscreen: false,\n  rootSize: {\n    width: 0,\n    height: 0\n  },\n  scrollbarSize: {\n    width: 0,\n    height: 0\n  },\n  /** å·è½´æ¨¡å¼ä¸‹çš„æ»šåŠ¨è·ç¦» */\n  scrollTop: 0,\n  autoScroll: {\n    play: false,\n    progress: 0\n  },\n  supportWorker: false,\n  supportUpscaleImage: true\n};\n\nconst propState = {\n  commentList: undefined,\n  hotkeys: {},\n  prop: {\n    onExit: undefined,\n    onPrev: undefined,\n    onNext: undefined,\n    onLoading: undefined,\n    onOptionChange: undefined,\n    onHotkeysChange: undefined,\n    editButtonList: list => list,\n    editSettingList: list => list\n  }\n};\n\nconst showState = {\n  isMobile: false,\n  isDragMode: false,\n  activePageIndex: 0,\n  gridMode: false,\n  show: {\n    toolbar: false,\n    scrollbar: false,\n    touchArea: false,\n    endPage: undefined\n  },\n  page: {\n    anima: '',\n    vertical: false,\n    offset: {\n      x: {\n        pct: 0,\n        px: 0\n      },\n      y: {\n        pct: 0,\n        px: 0\n      }\n    }\n  }\n};\n\nconst initStore = {\n  ...imgState,\n  ...showState,\n  ...propState,\n  ...optionState,\n  ...otherState\n};\nconst {\n  store,\n  setState\n} = helper.useStore({\n  ...initStore\n});\nconst refs = {\n  root: undefined,\n  mangaBox: undefined,\n  mangaFlow: undefined,\n  touchArea: undefined,\n  scrollbar: undefined,\n  settingPanel: undefined,\n  // ç»“æŸé¡µä¸Šçš„æŒ‰é’®\n  prev: undefined,\n  next: undefined,\n  exit: undefined\n};\n\n// 1. å› ä¸ºä¸åŒæ±‰åŒ–ç»„å¤„ç†æƒ…å†µä¸åŒä¸å¯èƒ½å…¨éƒ¨é€‚é…ï¼Œæ‰€ä»¥åªèƒ½æ˜¯å°½é‡é€‚é…*å‡ºç°é¢‘ç‡æ›´å¤š*çš„æƒ…å†µ\n/** åˆ¤æ–­å›¾ç‰‡æ˜¯å¦æ˜¯è·¨é¡µå›¾ */\nconst isWideImg = img => {\n  switch (img.type ?? store.defaultImgType) {\n    case 'long':\n    case 'wide':\n      return true;\n    default:\n      return false;\n  }\n};\n\n/** æ ¹æ®å¡«å……é¡µè®¾ç½®åŒé¡µæ’åˆ—å•é¡µå›¾ç‰‡ */\nconst arrangeImg = (pageList, fill) => {\n  if (pageList.length === 0) return [];\n  const newPageList = [];\n  let imgCache = fill ? [-1] : [];\n  for (const i of pageList) {\n    imgCache.push(i);\n    if (imgCache.length === 2) {\n      newPageList.push(imgCache);\n      imgCache = [];\n    }\n  }\n  if (imgCache.length === 1 && imgCache[0] !== -1) {\n    imgCache.push(-1);\n    newPageList.push(imgCache);\n  }\n  return newPageList;\n};\n\n/** è®¡ç®—æŒ‡å®šå›¾ç‰‡æµä¸­çš„å·¦å³é¡µä½ç½®æ­£ç¡®çš„é¡µæ•° */\nconst computeAccuracy = (imgList, pageList) => {\n  let accuracy = 0;\n  for (const [a, b] of pageList) {\n    if ((imgList[a]?.blankMargin?.left ?? 0) > 0.04) accuracy += 1;\n    if (b === undefined) break;\n    if ((imgList[b]?.blankMargin?.right ?? 0) > 0.04) accuracy += 1;\n  }\n  return accuracy;\n};\n\n/** è‡ªåŠ¨åˆ‡æ¢å¡«å……é¡µè®¾ç½®åˆ°å·¦å³é¡µæ­£ç¡®ç‡æ›´é«˜çš„æƒ…å†µ */\nconst arrangePage = (pageList, {\n  imgList,\n  fillEffect,\n  nowFillIndex,\n  switchFill\n}) => {\n  const fill = Boolean(fillEffect[nowFillIndex]);\n  const newPageList = arrangeImg(pageList, fill);\n  if (!switchFill || typeof fillEffect[nowFillIndex] === 'number') return newPageList;\n  const anotherPageList = arrangeImg(pageList, !fill);\n  const anotherAccuracy = computeAccuracy(imgList, anotherPageList);\n  if (anotherAccuracy === 0) return newPageList;\n  const nowAccuracy = computeAccuracy(imgList, newPageList);\n  if (anotherAccuracy <= nowAccuracy) return newPageList;\n  helper.log(`${nowFillIndex} è‡ªåŠ¨åˆ‡æ¢é¡µé¢å¡«å……`);\n  fillEffect[nowFillIndex] = !fill;\n  return anotherPageList;\n};\n\n/** æ ¹æ®å›¾ç‰‡æ¯”ä¾‹å’Œå¡«å……é¡µè®¾ç½®å¯¹æ¼«ç”»å›¾ç‰‡è¿›è¡Œæ’åˆ— */\nconst handleComicData = (imgList, fillEffect, switchFill) => {\n  const context = {\n    imgList,\n    fillEffect,\n    nowFillIndex: -1,\n    switchFill\n  };\n  const pageList = [];\n  const cacheList = [];\n  for (let i = 0; i < imgList.length; i += 1) {\n    const img = imgList[i];\n    if (!isWideImg(img)) {\n      cacheList.push(i);\n      if (Reflect.has(fillEffect, i)) Reflect.deleteProperty(fillEffect, i);\n      continue;\n    }\n\n    // åœ¨é™¤ç»“å°¾ï¼ˆå¯èƒ½æ˜¯æ±‰åŒ–ç»„å›¾ï¼‰å¤–çš„ä½ç½®å‡ºç°äº†è·¨é¡µå›¾çš„è¯ï¼Œé‚£å¼ è·¨é¡µå›¾å¤§æ¦‚ç‡æ˜¯é¡µåºçš„ã€Œæ­£ç¡®ç­”æ¡ˆã€\n    // å¦‚æœè¿™å¼ è·¨é¡µå¯¼è‡´äº†ä¸Šé¢ä¸€é¡µç¼ºé¡µï¼Œå°±è¯´æ˜åœ¨è¿™ä¹‹å‰çš„å¡«å……æœ‰è¯¯ï¼Œåº”è¯¥æ®æ­¤è°ƒæ•´ä¹‹å‰çš„å¡«å……\n    if (typeof fillEffect[context.nowFillIndex] === 'boolean' && i < imgList.length - 2 && (cacheList.length + (fillEffect[context.nowFillIndex] ? 1 : 0)) % 2 === 1) {\n      fillEffect[context.nowFillIndex] = !fillEffect[context.nowFillIndex];\n      return handleComicData(imgList, fillEffect, switchFill);\n    }\n    pageList.push(...arrangePage(cacheList, context), [i]);\n    cacheList.length = 0;\n    if (fillEffect[i] === undefined) fillEffect[i] = false;\n    context.nowFillIndex = i;\n  }\n  if (cacheList.length > 0) pageList.push(...arrangePage(cacheList, context));\n  return pageList;\n};\n\nconst getImg = (i, state = store) => state.imgMap[state.imgList[i]];\n\n/** æ‰¾åˆ°æŒ‡å®š url å›¾ç‰‡åœ¨ imgList é‡Œçš„ index */\nconst getImgIndexs = url => {\n  const indexList = [];\n  for (const [i, imgUrl] of store.imgList.entries()) if (imgUrl === url) indexList.push(i);\n  return indexList;\n};\n\n/** æ‰¾åˆ°æŒ‡å®š url å›¾ç‰‡çš„ dom */\nconst getImgEle = target => {\n  const index = typeof target === 'number' ? target : store.imgList.indexOf(target);\n  if (index === -1) return;\n  return refs.mangaFlow.querySelector(`#_${index}_0 img`);\n};\n\n/** æ‰¾åˆ°æŒ‡å®šé¡µé¢æ‰€å¤„çš„å›¾ç‰‡æµ */\nconst findFillIndex = (pageIndex, fillEffect) => {\n  let nowFillIndex = pageIndex;\n  while (!Reflect.has(fillEffect, nowFillIndex)) nowFillIndex -= 1;\n  return nowFillIndex;\n};\n\n/** è§¦å‘ onOptionChange */\nconst triggerOnOptionChange = helper.throttle(() => store.prop.onOptionChange?.(helper.difference(store.option, store.defaultOption)), 1000);\n\n/** åœ¨ option åæ‰‹åŠ¨è§¦å‘ onOptionChange */\nconst setOption = fn => {\n  setState(state => fn(state.option, state));\n  triggerOnOptionChange();\n};\n\n/** åˆ›å»ºç”¨äºå°† ref ç»‘å®šåˆ°å¯¹åº” state ä¸Šçš„å·¥å…·å‡½æ•° */\nconst bindRef = name => e => Reflect.set(refs, name, e);\nconst watchDomSize = (name, e) => {\n  const resizeObserver = new ResizeObserver(([{\n    contentRect\n  }]) => {\n    if (!contentRect.width || !contentRect.height) return;\n    setState(state => {\n      state[name] = {\n        width: contentRect.width,\n        height: contentRect.height\n      };\n    });\n  });\n  resizeObserver.disconnect();\n  resizeObserver.observe(e);\n  solidJs.onCleanup(() => resizeObserver.disconnect());\n};\n\n/** å°†ç•Œé¢æ¢å¤åˆ°æ­£å¸¸çŠ¶æ€ */\nconst resetUI = state => {\n  state.show.toolbar = false;\n  state.show.scrollbar = false;\n  state.show.touchArea = false;\n};\n\n// ç‰¹æ„ä½¿ç”¨ requestAnimationFrame å’Œ .click() æ˜¯ä¸ºäº†èƒ½å’Œ Vimium å…¼å®¹\n// ï¼ˆè™½ç„¶å› ä¸ºä½¿ç”¨äº† shadow dom çš„ç¼˜æ•…å®é™…è¿˜æ˜¯ä¸èƒ½å…¼å®¹ï¼Œä½†è¯´ä¸å®šä¹‹åå°±æ”¹äº†å‘¢\nconst focus = () => requestAnimationFrame(() => {\n  refs.mangaBox?.click();\n  refs.mangaBox?.focus();\n});\n\n/** å°†å‡½æ•°çš„ state å‚æ•°å˜ä¸ºå¯é€‰ */\nconst withOptionalState = fn => (...args) => {\n  // æ£€æŸ¥æ˜¯å¦ä¼ å…¥äº† state å‚æ•°ï¼Œæ²¡æœ‰çš„è¯è‡ªåŠ¨è°ƒç”¨ setState\n  if (args.length < fn.length) {\n    let result;\n    setState(state => {\n      result = fn(...[...args, state]);\n    });\n    return result;\n  }\n  // å¦‚æœä¼ å…¥äº† stateï¼Œç›´æ¥è°ƒç”¨åŸå‡½æ•°\n  return fn(...args);\n};\nconst closeScrollLock = helper.debounce(() => setState('scrollLock', false), 100);\n/** æ‰“å¼€æ»šåŠ¨é”ï¼Œå¹¶åœ¨ä¹‹åè‡ªåŠ¨å…³é—­ */\nconst openScrollLock = withOptionalState(state => {\n  state.scrollLock = true;\n  closeScrollLock();\n});\nconst bindOption$1 = (...path) => ({\n  value: helper.byPath(store.option, path),\n  onChange: val => setOption(draftOption => helper.byPath(draftOption, path, () => val))\n});\n\nconst [defaultHotkeys, setDefaultHotkeys] = solidJs.createSignal({\n  scroll_up: ['w', 'ArrowUp'],\n  scroll_down: ['s', 'ArrowDown'],\n  scroll_left: ['a', 'Shift + a', ',', 'ArrowLeft'],\n  scroll_right: ['d', 'Shift + d', '.', 'ArrowRight'],\n  page_up: ['PageUp', 'Shift + w'],\n  page_down: [' ', 'PageDown', 'Shift + s'],\n  jump_to_home: ['Home'],\n  jump_to_end: ['End'],\n  exit: ['Escape'],\n  switch_page_fill: ['/', 'm', 'z'],\n  switch_scroll_mode: [],\n  switch_grid_mode: [],\n  switch_single_double_page_mode: [],\n  switch_dir: [],\n  switch_auto_enlarge: [],\n  translate_current_page: [],\n  translate_all: [],\n  translate_to_end: [],\n  fullscreen: [],\n  auto_scroll: []\n});\n\n/** å¿«æ·é”®é…ç½® */\nconst hotkeysMap = helper.createRootMemo(() => Object.fromEntries(Object.entries(store.hotkeys).flatMap(([name, key]) => key.map(k => [k, name]))));\n\n/** ç›‘å¬å¿«æ·é”® */\nconst listenHotkey = (actions, capture) => {\n  window.addEventListener('keydown', e => {\n    // è·³è¿‡è¾“å…¥æ¡†çš„é”®ç›˜äº‹ä»¶\n    switch (e.target.tagName) {\n      case 'INPUT':\n      case 'TEXTAREA':\n        return;\n    }\n    if (e.target.isContentEditable) return;\n    if (Reflect.has(actions, e.key) && actions[e.key](e) !== 1) {\n      e.stopPropagation();\n      e.preventDefault();\n      e.stopImmediatePropagation();\n    }\n    const hotkeyName = hotkeysMap()[helper.getKeyboardCode(e)];\n    if (Reflect.has(actions, hotkeyName) && actions[hotkeyName](e) !== 1) {\n      e.stopPropagation();\n      e.preventDefault();\n      e.stopImmediatePropagation();\n    }\n  }, {\n    capture\n  });\n};\n\n/** å½“å‰æ˜¯å¦ä¸ºå¹¶æ’å·è½´æ¨¡å¼ */\nconst isAbreastMode = helper.createRootMemo(() => store.option.scrollMode.enabled && store.option.scrollMode.abreastMode);\n\n/** å½“å‰æ˜¯å¦ä¸ºåŒé¡µå·è½´æ¨¡å¼ */\nconst isDoubleMode = helper.createRootMemo(() => store.option.scrollMode.enabled && store.option.scrollMode.doubleMode && !store.option.scrollMode.abreastMode);\n\n/** å½“å‰æ˜¯å¦ä¸ºå•é¡µå·è½´æ¨¡å¼ */\nconst isSingleMode = helper.createRootMemo(() => store.option.scrollMode.enabled && !store.option.scrollMode.doubleMode && !store.option.scrollMode.abreastMode);\n\n/** å½“å‰æ˜¯å¦ä¸ºæ™®é€šå·è½´æ¨¡å¼ï¼ˆåŒ…å«äº†åŒé¡µå·è½´æ¨¡å¼ï¼‰ */\nconst isScrollMode = helper.createRootMemo(() => store.option.scrollMode.enabled && !store.option.scrollMode.abreastMode);\n\n/** å½“å‰æ˜¯å¦æ­£åœ¨å·è½´æ¨¡å¼ä¸‹ä½¿ç”¨è‡ªåŠ¨ç¼©æ”¾å€¼ */\nconst isUseAutoScale = helper.createRootMemo(() => isScrollMode() && typeof store.option.scrollMode.adjustToWidth === 'number');\n\n/** å½“å‰æ˜¯å¦å¼€å¯äº†è¯†åˆ«èƒŒæ™¯è‰² */\nconst isEnableBg = helper.createRootMemo(() => store.option.imgRecognition.enabled && store.option.imgRecognition.background);\n\n/** å½“å‰æ˜¯å¦å¼€å¯äº†å›¾åƒæ”¾å¤§ */\nconst isUpscale = helper.createRootMemo(() => !store.isMobile && store.option.imgRecognition.enabled && store.option.imgRecognition.upscale);\n\n/** æ ¹æ®è§†åŒºå®½é«˜åˆ¤æ–­å•åŒé¡µæ¨¡å¼ */\nconst autoPageNum = helper.createThrottleMemo(() => store.rootSize.width >= store.rootSize.height ? 2 : 1);\n\n/** å½“å‰ä½¿ç”¨çš„å•åŒé¡µæ¨¡å¼ */\nconst pageNum = helper.createRootMemo(() => store.option.pageNum || autoPageNum());\n\n/** æ˜¯å¦ä¸ºå•é¡µæ¨¡å¼ */\nconst isOnePageMode = helper.createRootMemo(() => {\n  if (store.isMobile || store.imgList.length <= 1) return true;\n  if (store.option.scrollMode.enabled) {\n    if (store.option.scrollMode.abreastMode) return true;\n    return !store.option.scrollMode.doubleMode;\n  }\n  return pageNum() === 1;\n});\n\n/** å¹¶æ’å·è½´æ¨¡å¼ä¸‹çš„å…¨å±€æ»šåŠ¨å¡«å…… */\nconst [abreastScrollFill, _setAbreastScrollFill] = solidJs.createSignal(0);\n/** å¹¶æ’å·è½´æ¨¡å¼ä¸‹çš„æ¯åˆ—å¸ƒå±€ */\nconst abreastArea = helper.createRootMemo(prev => {\n  if (!isAbreastMode()) return prev;\n  const columns = [[]];\n  const position = {};\n  let length = 0;\n  const rootHeight = store.rootSize.height;\n  if (!rootHeight || store.imgList.length === 0) return {\n    columns,\n    position,\n    length\n  };\n  const repeatHeight = rootHeight * store.option.scrollMode.abreastDuplicate;\n\n  /** å½“å‰å›¾ç‰‡åœ¨å½“å‰åˆ—çš„æ‰€åœ¨é«˜åº¦ */\n  let top = abreastScrollFill();\n  while (top > rootHeight) {\n    top -= rootHeight - repeatHeight;\n    columns.push([]);\n  }\n  for (let i = 0; i < store.imgList.length; i++) {\n    const img = getImg(i);\n    const imgPosition = [];\n    const imgHeight = img.size.height;\n    length += imgHeight;\n    let height = imgHeight;\n    while (height > 0) {\n      columns.at(-1).push(i);\n      imgPosition.push({\n        column: columns.length - 1,\n        top\n      });\n      if (top < 0 && imgPosition.length > 1) top = 0;\n      const availableHeight = rootHeight - top;\n      top += height;\n      height -= availableHeight;\n\n      // å¡«æ»¡ä¸€åˆ—åæ¢è¡Œ\n      if (top < rootHeight) continue;\n      columns.push([]);\n      top = height - imgHeight;\n\n      // å¤ç°ä¸Šåˆ—ç»“å°¾\n      if (!repeatHeight || columns.length === 1) continue;\n      top += repeatHeight;\n      height = Math.min(imgHeight, height + repeatHeight);\n\n      /** ä¸ºäº†å¤ç°è€Œå‡ºç°çš„ç©ºç™½éƒ¨åˆ†é«˜åº¦ */\n      let emptyTop = top;\n      let prevImgIndex = i;\n      while (prevImgIndex >= 1 && emptyTop > 0) {\n        prevImgIndex -= 1;\n        // æŠŠä¸Šä¸€å¼ å›¾ç‰‡åŠ è¿›æ¥å¡«è¡¥ç©ºç™½\n        columns.at(-1).push(prevImgIndex);\n        const prevImgHeight = getImg(prevImgIndex).size.height;\n        emptyTop -= prevImgHeight;\n        position[prevImgIndex].push({\n          column: columns.length - 1,\n          top: emptyTop\n        });\n      }\n    }\n    position[i] = imgPosition;\n  }\n  return {\n    columns,\n    position,\n    length\n  };\n}, {\n  columns: [],\n  position: {},\n  length: 0\n});\n\n/** å¤´å°¾æ»šåŠ¨çš„é™åˆ¶å€¼ */\nconst scrollFillLimit = helper.createRootMemo(() => abreastArea().length - store.rootSize.height);\nconst setAbreastScrollFill = val => _setAbreastScrollFill(helper.clamp(-scrollFillLimit(), val, scrollFillLimit()));\n\n/** å¹¶æ’å·è½´æ¨¡å¼ä¸‹çš„åˆ—å®½åº¦ */\nconst abreastColumnWidth = helper.createRootMemo(() => isAbreastMode() ? placeholderSize().width * store.option.scrollMode.imgScale : 0);\n\n/** å¹¶æ’å·è½´æ¨¡å¼ä¸‹å½“å‰è¦æ˜¾ç¤ºçš„åˆ— */\nconst abreastShowColumn = helper.createThrottleMemo(() => {\n  if (!isAbreastMode() || abreastArea().columns.length === 0) return {\n    start: 0,\n    end: 0\n  };\n  const columnWidth = abreastColumnWidth() + store.option.scrollMode.spacing * 7;\n  return {\n    start: helper.clamp(0, Math.floor(store.page.offset.x.px / columnWidth), abreastArea().columns.length - 1),\n    end: helper.clamp(0, Math.floor((store.page.offset.x.px + store.rootSize.width) / columnWidth), abreastArea().columns.length - 1)\n  };\n});\n\n/** å¹¶æ’å·è½´æ¨¡å¼ä¸‹çš„æ¼«ç”»æµå®½åº¦ */\nconst abreastContentWidth = helper.createRootMemo(() => abreastArea().columns.length * abreastColumnWidth() + (abreastArea().columns.length - 1) * store.option.scrollMode.spacing * 7);\n\n/** å¹¶æ’å·è½´æ¨¡å¼ä¸‹çš„æœ€å¤§æ»šåŠ¨è·ç¦» */\nconst abreastScrollWidth = helper.createRootMemo(() => abreastContentWidth() - store.rootSize.width);\n\n/** å¹¶æ’å·è½´æ¨¡å¼ä¸‹æ¯ä¸ªå›¾ç‰‡æ‰€åœ¨ä½ç½®çš„æ ·å¼ */\nconst imgAreaStyle = helper.createRootMemo(() => {\n  if (!isAbreastMode() || store.gridMode) return '';\n  let styleText = '';\n  for (const index of store.imgList.keys()) {\n    let imgNum = 0;\n    for (const {\n      column,\n      top\n    } of abreastArea().position[index] ?? []) {\n      const itemStyle = `grid-area: _${column} !important; transform: translateY(${top}px);`;\n      styleText += `#_${index}_${imgNum} { ${itemStyle} }\\n`;\n      imgNum += 1;\n    }\n  }\n  return styleText;\n});\n\nconst imgList = helper.createRootMemo(() => store.imgList.map(url => store.imgMap[url]));\n\n/** å½“å‰æ˜¾ç¤ºé¡µé¢ */\nconst activePage = helper.createRootMemo(() => store.pageList[store.activePageIndex] ?? []);\n\n/** å½“å‰æ˜¾ç¤ºçš„ç¬¬ä¸€å¼ å›¾ç‰‡çš„ index */\nconst activeImgIndex = helper.createRootMemo(() => activePage().find(i => i !== -1) ?? 0);\n\n/** å½“å‰æ‰€å¤„çš„å›¾ç‰‡æµ */\nconst nowFillIndex = helper.createRootMemo(() => findFillIndex(activeImgIndex(), store.fillEffect));\n\n/** é¢„åŠ è½½é¡µæ•° */\nconst preloadNum = helper.createRootMemo(() => ({\n  back: store.option.preloadPageNum,\n  front: Math.floor(store.option.preloadPageNum / 2)\n}));\n\n/** è·å–å›¾ç‰‡åˆ—è¡¨ä¸­æŒ‡å®šå±æ€§çš„ä¸­ä½æ•° */\nconst getImgMedian = sizeFn => {\n  const list = imgList().filter(img => img.loadType === 'loaded' && img.width).map(sizeFn).toSorted((a, b) => a - b);\n  // å› ä¸ºæ¶‰åŠåˆ°å›¾ç‰‡é»˜è®¤ç±»å‹çš„è®¡ç®—ï¼Œæ‰€ä»¥è‡³å°‘ç­‰åˆ°åŠ è½½å®Œä¸‰å¼ å›¾ç‰‡å†è®¡ç®—ï¼Œé¿å…è¢«é¦–é¡µå¤§å›¾å¹²æ‰°\n  if (list.length < 3) return null;\n  return list[Math.floor(list.length / 2)];\n};\n\n/** å›¾ç‰‡å ä½å°ºå¯¸ */\nconst placeholderSize = helper.createThrottleMemo(() => ({\n  width: getImgMedian(img => img.width) ?? 800,\n  height: getImgMedian(img => img.height) ?? 1200\n}), 500);\n\n/** å·è½´æ¨¡å¼ä¸‹çš„å›¾ç‰‡ç¼©æ”¾æ¯”ä¾‹ */\nconst scrollModeScale = helper.createRootMemo(() => {\n  if (!isUseAutoScale()) return store.option.scrollMode.imgScale;\n\n  // èƒ½è®©å¤§å¤šæ•°å›¾ç‰‡çš„å®½åº¦æ¥è¿‘æŒ‡å®šå€¼çš„å›¾ç‰‡ç¼©æ”¾æ¯”ä¾‹\n  return store.option.scrollMode.adjustToWidth / placeholderSize().width;\n});\n\n/** è®°å½•æ¯å¼ å›¾ç‰‡æ‰€åœ¨çš„é¡µé¢ */\nconst imgPageMap = helper.createRootMemo(() => {\n  const map = {};\n  for (let i = 0; i < store.pageList.length; i++) {\n    for (const imgIndex of store.pageList[i]) if (imgIndex !== -1) map[imgIndex] = i;\n  }\n  return map;\n});\n\n/** æ»šåŠ¨è·ç¦» */\nconst scrollTop = helper.createRootMemo(() => isAbreastMode() ? store.page.offset.x.px : store.scrollTop);\nconst bindScrollTop = dom => {\n  dom.addEventListener('scroll', () => {\n    // è·³è¿‡å°äº1åƒç´ çš„æ»šåŠ¨äº‹ä»¶ï¼Œé¿å…å› å°æ•°é—®é¢˜å¼•å‘çš„è¯¯å·®\n    if (helper.approx(dom.scrollTop, store.scrollTop)) return;\n    setState('scrollTop', dom.scrollTop);\n  }, {\n    passive: true\n  });\n};\n\n// è‡ªåŠ¨åˆ‡æ¢é»‘æš—æ¨¡å¼\nconst darkModeQuery = matchMedia('(prefers-color-scheme: dark)');\nconst autoSwitchDarkMode = query => {\n  if (!store.option.autoDarkMode) return;\n  if (query.matches === store.option.darkMode) return;\n  setState('option', 'darkMode', query.matches);\n};\ndarkModeQuery.addEventListener('change', autoSwitchDarkMode);\nautoSwitchDarkMode(darkModeQuery);\nhelper.createEffectOn(() => store.option.autoDarkMode, () => autoSwitchDarkMode(darkModeQuery));\n\n// çª—å£å®½åº¦å°äº800åƒç´ æ—¶ï¼Œæ ‡è®°ä¸ºç§»åŠ¨ç«¯\nhelper.createEffectOn(() => store.rootSize.width, width => {\n  const isMobile = helper.inRange(1, width, 800);\n  if (isMobile === store.isMobile) return;\n  setState(state => {\n    state.isMobile = isMobile;\n    resetImgState(state);\n    updatePageData(state);\n  });\n});\n\nfunction getDefaultExportFromCjs (x) {\n\treturn x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;\n}\n\nvar es6 = function equal(a, b) {\n  if (a === b) return true;\n\n  if (a && b && typeof a == 'object' && typeof b == 'object') {\n    if (a.constructor !== b.constructor) return false;\n\n    var length, i, keys;\n    if (Array.isArray(a)) {\n      length = a.length;\n      if (length != b.length) return false;\n      for (i = length; i-- !== 0;)\n        if (!equal(a[i], b[i])) return false;\n      return true;\n    }\n\n\n    if ((a instanceof Map) && (b instanceof Map)) {\n      if (a.size !== b.size) return false;\n      for (i of a.entries())\n        if (!b.has(i[0])) return false;\n      for (i of a.entries())\n        if (!equal(i[1], b.get(i[0]))) return false;\n      return true;\n    }\n\n    if ((a instanceof Set) && (b instanceof Set)) {\n      if (a.size !== b.size) return false;\n      for (i of a.entries())\n        if (!b.has(i[0])) return false;\n      return true;\n    }\n\n    if (ArrayBuffer.isView(a) && ArrayBuffer.isView(b)) {\n      length = a.length;\n      if (length != b.length) return false;\n      for (i = length; i-- !== 0;)\n        if (a[i] !== b[i]) return false;\n      return true;\n    }\n\n\n    if (a.constructor === RegExp) return a.source === b.source && a.flags === b.flags;\n    if (a.valueOf !== Object.prototype.valueOf) return a.valueOf() === b.valueOf();\n    if (a.toString !== Object.prototype.toString) return a.toString() === b.toString();\n\n    keys = Object.keys(a);\n    length = keys.length;\n    if (length !== Object.keys(b).length) return false;\n\n    for (i = length; i-- !== 0;)\n      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\n\n    for (i = length; i-- !== 0;) {\n      var key = keys[i];\n\n      if (!equal(a[key], b[key])) return false;\n    }\n\n    return true;\n  }\n\n  // true if both NaN, false otherwise\n  return a!==a && b!==b;\n};\n\nconst isEqual = /*@__PURE__*/getDefaultExportFromCjs(es6);\n\nlet publicOwner;\nsolidJs.createRoot(() => {\n  publicOwner = solidJs.getOwner();\n});\n\n/** ä¼šè‡ªåŠ¨è®¾ç½® equals å’Œ createRoot çš„ createMemo */\nconst createRootMemo = (fn, init, options) => {\n  // å¦‚æœå‡½æ•°å·²ç»æ˜¯ createMemo åˆ›å»ºçš„ï¼Œå°±ç›´æ¥ä½¿ç”¨\n  if (fn.name === 'bound readSignal') return fn;\n  const _init = fn(undefined);\n  // è‡ªåŠ¨ä¸ºå¯¹è±¡ç±»å‹è®¾ç½® equals\n  const _options = typeof _init === 'object' ? {\n    ...options,\n    equals: isEqual\n  } : options;\n  return solidJs.getOwner() ? solidJs.createMemo(fn, _init, _options) : solidJs.runWithOwner(publicOwner, () => solidJs.createMemo(fn, _init, _options));\n};\n\n/** å·è½´æ¨¡å¼ä¸‹çš„æ¯é¡µé«˜åº¦ */\nconst pageHeightList = createRootMemo(() => {\n  if (!isScrollMode()) return [];\n  if (!isDoubleMode()) return imgList().map(img => img.size.height ?? 0);\n  const doubleWidth = store.rootSize.width / 2;\n  return store.pageList.map(indexs => {\n    if (indexs.length === 1) return getImg(indexs[0]).size.height;\n\n    // é€‰æ‹©æ›´é«˜çš„é‚£å¼ å›¾ç‰‡ä½œä¸ºè¡Œé«˜åº¦ï¼Œå°½é‡æ”¾å¤§å›¾ç‰‡\n    let targetImg;\n    for (const i of indexs) {\n      if (i === -1) continue;\n      const img = getImg(i);\n      if (!targetImg || img.size.height > targetImg.size.height) targetImg = img;\n    }\n    if (!targetImg) throw new Error('æ‰¾ä¸åˆ°å›¾ç‰‡');\n    if (targetImg.size.width < doubleWidth && store.option.scrollMode.adjustToWidth === 'disable') return targetImg.size.height;\n    return targetImg.size.height * (doubleWidth / targetImg.size.width);\n  });\n});\n\n/** å·è½´æ¨¡å¼ä¸‹æ¯é¡µä½ç½® */\nconst pageTopList = createRootMemo(() => {\n  if (!isScrollMode()) return [];\n  const list = Array.from({\n    length: store.pageList.length\n  });\n  for (let top = 0, i = 0; i < store.pageList.length; i++) {\n    list[i] = top;\n    top += pageHeightList()[i] + store.option.scrollMode.spacing * 7;\n  }\n  return list;\n});\n\n/** å·è½´æ¨¡å¼ä¸‹æ¼«ç”»æµçš„æ€»é«˜åº¦ */\nconst contentHeight = createRootMemo(() => {\n  if (!isScrollMode()) return 0;\n  return (pageTopList().at(-1) ?? 0) + (pageHeightList().at(-1) ?? 0);\n});\n\n/** è·å–å·è½´æ¨¡å¼ä¸‹æŒ‡å®šé¡µçš„ä½ç½® */\nconst getPageTop = index => {\n  if (Reflect.has(pageTopList(), index)) return pageTopList()[index];\n  if (index < 0) return 0;\n  return contentHeight();\n};\n\n/** æ‰¾åˆ°å·è½´æ¨¡å¼ä¸‹æŒ‡å®šé«˜åº¦ä¸Šæ˜¾ç¤ºçš„é¡µé¢ */\nconst findTopPage = (top, initIndex = 0) => {\n  if (top > contentHeight()) return pageTopList().length - 1;\n  for (let i = initIndex; i < pageTopList().length; i++) if (pageTopList()[i] > top) return i === 0 ? 0 : i - 1;\n  return pageTopList().length - 1;\n};\n\n/** æ»šåŠ¨å†…å®¹çš„æ»šåŠ¨è¿›åº¦ */\nconst scrollProgress = createRootMemo(() => {\n  if (store.option.scrollMode.enabled) return scrollTop();\n  return store.activePageIndex;\n});\n\n/** æ»šåŠ¨å†…å®¹çš„æ€»é•¿åº¦ */\nconst scrollLength = createRootMemo(() => {\n  if (store.option.scrollMode.enabled) {\n    if (store.option.scrollMode.abreastMode) return abreastContentWidth();\n    return contentHeight();\n  }\n  return store.pageList.length;\n});\n\n/** æ»šåŠ¨å†…å®¹çš„æ»šåŠ¨è¿›åº¦ç™¾åˆ†æ¯” */\nconst scrollPercentage = createRootMemo(() => scrollProgress() / scrollLength());\n\n/** å½“å‰æ˜¯å¦å·²ç»æ»šåŠ¨åˆ°é¡¶éƒ¨ */\nconst isTop = createRootMemo(() => scrollPercentage() === 0);\n\n/** æ»šåŠ¨æ¡å…ƒç´ çš„é•¿åº¦ */\nconst scrollDomLength = createRootMemo(() => Math.max(store.scrollbarSize.width, store.scrollbarSize.height));\n\n/** æ»šåŠ¨æ¡æ»‘å—é•¿åº¦ */\nconst sliderHeight = createRootMemo(() => {\n  let itemLength = 1;\n  if (isScrollMode()) itemLength = store.rootSize.height;\n  if (isAbreastMode()) itemLength = store.rootSize.width;\n  return itemLength / scrollLength();\n});\n\n/** å½“å‰æ˜¯å¦å·²ç»æ»šåŠ¨åˆ°åº•éƒ¨ */\nconst isBottom = createRootMemo(() => scrollPercentage() + sliderHeight() >= 0.9999);\n\n/** æ»šåŠ¨æ¡æ»‘å—çš„ä¸­å¿ƒç‚¹é«˜åº¦ */\nconst sliderMidpoint = createRootMemo(() => scrollDomLength() * (scrollPercentage() + sliderHeight() / 2));\n\n/** æ»šåŠ¨æ¡æ»‘å—çš„ä½ç½® */\nconst sliderTop = createRootMemo(() => `${scrollPercentage() * scrollDomLength()}px`);\n\n/** æ»šåŠ¨æ¡ä½ç½® */\nconst scrollPosition = createRootMemo(() => {\n  if (store.option.scrollbar.position === 'auto') {\n    if (store.isMobile) return 'top';\n    if (isAbreastMode()) return 'bottom';\n    // å¤§éƒ¨åˆ†å›¾ç‰‡éƒ½æ˜¯å®½å›¾æ—¶ï¼Œå°†æ»šåŠ¨æ¡ç§»è‡³åº•éƒ¨\n    return store.defaultImgType === 'long' ? 'bottom' : 'right';\n  }\n  return store.option.scrollbar.position;\n});\n\n/** é‡æ–°è®¡ç®—å›¾ç‰‡æ’åˆ— */\nconst updatePageData = state => {\n  const lastActiveImgIndex = activeImgIndex();\n  let newPageList = [];\n  newPageList = isOnePageMode() ? state.imgList.map((_, i) => [i]) : handleComicData(state.imgList.map(url => state.imgMap[url]), state.fillEffect, state.option.imgRecognition.pageFill);\n  if (helper.isEqual(state.pageList, newPageList)) return;\n  state.pageList = newPageList;\n\n  // åœ¨å›¾ç‰‡æ’åˆ—æ”¹å˜åè‡ªåŠ¨è·³è½¬å›åŸå…ˆæ˜¾ç¤ºå›¾ç‰‡æ‰€åœ¨çš„é¡µæ•°\n  if (lastActiveImgIndex !== activeImgIndex()) {\n    const newActivePageIndex = state.pageList.findIndex(page => page.includes(lastActiveImgIndex));\n    if (newActivePageIndex !== -1) state.activePageIndex = newActivePageIndex;\n  }\n};\nupdatePageData.throttle = helper.throttle(() => setState(updatePageData), 100);\n\n/**\n * å°†å¤„ç†å›¾ç‰‡çš„ç›¸å…³å˜é‡æ¢å¤åˆ°åˆå§‹çŠ¶æ€\n *\n * å¿…é¡»æŒ‰ç…§ä»¥ä¸‹é¡ºåºè°ƒç”¨\n * 1. ä¿®æ”¹ imgList\n * 2. resetImgState\n * 3. updatePageData\n */\nconst resetImgState = state => {\n  if (state.imgList.length === 0) {\n    state.fillEffect = {\n      '-1': true\n    };\n    return;\n  }\n\n  // å¦‚æœç”¨æˆ·æ²¡æœ‰æ‰‹åŠ¨ä¿®æ”¹è¿‡é¦–é¡µå¡«å……ï¼Œæ‰å°†å…¶æ¢å¤åˆå§‹\n  if (typeof state.fillEffect['-1'] === 'boolean') state.fillEffect['-1'] = state.option.firstPageFill && state.imgList.length > 3;\n};\nhelper.createEffectOn([pageNum, isOnePageMode], () => setState(updatePageData));\n\n/** é˜»æ­¢äº‹ä»¶å†’æ³¡ */\nconst stopPropagation = e => {\n  e.stopPropagation();\n};\n\n/** ä»å¤´å¼€å§‹æ’­æ”¾å…ƒç´ çš„åŠ¨ç”» */\nconst playAnimation = e => {\n  if (!e) return;\n  for (const animation of e.getAnimations()) {\n    animation.cancel();\n    animation.play();\n  }\n};\nconst downloadImgHeaders = {\n  Accept: 'image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8',\n  'User-Agent': navigator.userAgent,\n  Referer: location.href\n};\nconst downloadImg = async (imgUrl, details) => {\n  const url = store.imgMap[imgUrl]?.blobUrl ?? imgUrl;\n  if (url.startsWith('blob:')) {\n    const res = await fetch(url);\n    return res.blob();\n  }\n  const res = await request.request(url, {\n    responseType: 'blob',\n    errorText: helper.t('translation.tip.download_img_failed'),\n    headers: downloadImgHeaders,\n    retryFetch: true,\n    ...details\n  });\n  if (Reflect.has(store.imgMap, imgUrl)) setState('imgMap', imgUrl, 'blobUrl', URL.createObjectURL(res.response));\n  return res.response;\n};\n\nconst handleImgRecognition = async (url, imgEle) => {\n  const img = store.imgMap[url];\n  const needRecognition = store.option.imgRecognition.background && img.background === undefined || store.option.imgRecognition.pageFill && img.blankMargin === undefined;\n  if (needRecognition) {\n    imgEle ??= await helper.wait(() => getImgEle(url), 1000);\n    if (!imgEle) return helper.log.warn('è·å–å›¾ç‰‡å…ƒç´ å¤±è´¥');\n    const {\n      data,\n      width,\n      height\n    } = helper.getImageData(imgEle);\n    initWorker$1();\n    return worker.recognitionImg(Comlink.transfer(data, [data.buffer]), width, height, url, store$1.unwrap(store.option.imgRecognition));\n  }\n};\nconst initWorker$1 = helper.onec(() => {\n  const mainFn = {\n    log: helper.log,\n    updatePageData: helper.throttle(() => setState(updatePageData), 1000),\n    setImg: (url, key, val) => Reflect.has(store.imgMap, url) && setState('imgMap', url, key, val)\n  };\n  worker.setMainFn(Comlink.proxy(mainFn), Object.keys(mainFn));\n});\n\nconst isWideType = type => type === 'wide' || type === 'long';\n\n// https://github.com/hymbz/ComicReadScript/issues/174#issuecomment-2252114640\n// ç”¨äºåˆ¤æ–­å›¾ç‰‡ç±»å‹çš„æ¯”ä¾‹\nconst å•é¡µæ¯”ä¾‹ = 1920 / 2 / 1080;\nconst æ¨ªå¹…æ¯”ä¾‹ = 1920 / 1080;\nconst æ¡æ¼«æ¯”ä¾‹ = 1920 / 2 / 1080 / 2;\n\n/** æ ¹æ®æ¯”ä¾‹åˆ¤æ–­å›¾ç‰‡ç±»å‹ */\nconst getImgType = img => {\n  const imgRatio = img.width / img.height;\n  if (imgRatio <= å•é¡µæ¯”ä¾‹) return imgRatio < æ¡æ¼«æ¯”ä¾‹ ? 'vertical' : '';\n  return imgRatio > æ¨ªå¹…æ¯”ä¾‹ ? 'long' : 'wide';\n};\n\n/** æ›´æ–°å›¾ç‰‡ç±»å‹ã€‚è¿”å›æ˜¯å¦ä¿®æ”¹äº†å›¾ç‰‡ç±»å‹ */\nconst updateImgType = (state, draftImg) => {\n  const {\n    type\n  } = draftImg;\n  if (!draftImg.width || !draftImg.height) return false;\n  draftImg.type = getImgType(draftImg);\n  if (isWideType(type) !== isWideType(draftImg.type)) updatePageData.throttle();\n  return (type ?? state.defaultImgType) !== draftImg.type;\n};\n\n/** æ˜¯å¦è‡ªåŠ¨å¼€å¯è¿‡å·è½´æ¨¡å¼ */\nlet autoScrollMode = false;\nhelper.createRootEffect(prevIsWide => {\n  if (store.rootSize.width === 0 || store.rootSize.height === 0) return;\n  const defaultImgType = getImgType(placeholderSize());\n  if (defaultImgType === store.defaultImgType) return prevIsWide;\n  const isWide = isWideType(defaultImgType);\n  setState(state => {\n    state.defaultImgType = defaultImgType;\n\n    // è¿ç»­å‡ºç°å¤šå¼ é•¿å›¾åï¼Œè‡ªåŠ¨å¼€å¯å·è½´æ¨¡å¼\n    if (defaultImgType === 'vertical' && !autoScrollMode && !state.option.scrollMode.enabled) {\n      state.option.scrollMode.enabled = true;\n      autoScrollMode = true;\n      return;\n    }\n    if (isWide !== prevIsWide) updatePageData(state);\n  });\n  return isWide;\n}, false);\n\n/** è·å–æŒ‡å®šå›¾ç‰‡çš„æ˜¾ç¤ºå°ºå¯¸ */\nconst getImgDisplaySize = (state, img) => {\n  let height = img.height ?? placeholderSize().height;\n  let width = img.width ?? placeholderSize().width;\n  if (!state.option.scrollMode.enabled) return {\n    height,\n    width\n  };\n  const setWidth = w => {\n    height *= w / width;\n    width = w;\n    return {\n      height,\n      width\n    };\n  };\n  if (isAbreastMode()) return setWidth(abreastColumnWidth());\n  if (state.option.scrollMode.adjustToWidth === 'full') return setWidth(state.rootSize.width);\n  height *= scrollModeScale();\n  width *= scrollModeScale();\n  if (width > state.rootSize.width) return setWidth(state.rootSize.width);\n  return {\n    height,\n    width\n  };\n};\n\n/** æ›´æ–°å›¾ç‰‡å°ºå¯¸ */\nconst updateImgSize = (url, width, height) => setState(state => {\n  const img = state.imgMap[url];\n  if (img.width === width && img.height === height) return;\n  img.width = width;\n  img.height = height;\n  img.size = getImgDisplaySize(state, img);\n  updateImgType(state, img);\n});\nhelper.createEffectOn([imgList, () => store.option.scrollMode.enabled, () => store.option.scrollMode.abreastMode, () => store.option.scrollMode.adjustToWidth, scrollModeScale, () => store.rootSize, placeholderSize], ([{\n  length\n}]) => {\n  if (length === 0) return;\n  setState(state => {\n    for (const url of state.imgList) state.imgMap[url].size = getImgDisplaySize(state, state.imgMap[url]);\n  });\n});\n\n/** è·å–å¹¶æ’å·è½´æ¨¡å¼ä¸‹æŒ‡å®šåˆ—çš„æŒ‡å®šå›¾ç‰‡ */\nconst getAbreastColumnImg = (column, img) => {\n  const {\n    columns\n  } = abreastArea();\n  return columns[helper.clamp(0, column, columns.length - 1)]?.at(img) ?? 0;\n};\n\n/** è®¡ç®—æ˜¾ç¤ºé¡µé¢ */\nconst updateShowRange = state => {\n  if (scrollLength() === 0) {\n    state.showRange = [0, 0];\n    state.renderRange = state.showRange;\n  } else if (!state.option.scrollMode.enabled) {\n    // ç¿»é¡µæ¨¡å¼\n    state.showRange = [state.activePageIndex, state.activePageIndex];\n    state.renderRange = [helper.clamp(0, state.activePageIndex - 1, state.pageList.length - 1), helper.clamp(0, state.activePageIndex + 1, state.pageList.length - 1)];\n  } else if (state.option.scrollMode.abreastMode) {\n    // å¹¶æ’å·è½´æ¨¡å¼\n    const {\n      start,\n      end\n    } = abreastShowColumn();\n    state.showRange = [getAbreastColumnImg(start, 0), getAbreastColumnImg(end, -1)];\n    state.renderRange = [getAbreastColumnImg(start - 2, 0), getAbreastColumnImg(end + 2, -1)];\n  } else {\n    // æ™®é€šå·è½´æ¨¡å¼\n    const top = scrollTop();\n    const bottom = scrollTop() + state.rootSize.height;\n    const renderTop = top - state.rootSize.height;\n    const rednerBottom = bottom + state.rootSize.height;\n    const renderTopImg = findTopPage(renderTop);\n    const topImg = findTopPage(top, renderTopImg);\n    const bottomImg = findTopPage(bottom, topImg);\n    const renderBottomImg = findTopPage(rednerBottom, bottomImg);\n    state.showRange = [topImg, bottomImg];\n    state.renderRange = [renderTopImg, renderBottomImg];\n  }\n};\nhelper.createEffectOn([scrollLength, () => store.gridMode, () => store.option.scrollMode.enabled, () => store.activePageIndex, () => store.option.scrollMode.abreastMode, () => store.rootSize, abreastShowColumn, scrollTop], helper.throttle(() => setState(updateShowRange))\n// ä¸¤ç§å·è½´æ¨¡å¼ä¸‹éƒ½å¯ä»¥é€šè¿‡åœ¨æ¯æ¬¡æ»šåŠ¨åè®°å½•\n// å½“å‰ `æ˜¾ç¤ºçš„ç¬¬ä¸€å¼ å›¾ç‰‡çš„ bottom` å’Œ `æœ€åä¸€å¼ å›¾ç‰‡çš„ top` ä½œä¸ºå¿½ç•¥èŒƒå›´ï¼Œ\n// åœ¨æ¯æ¬¡æ»šåŠ¨åæ£€æŸ¥æ˜¯å¦è¶…å‡ºäº†è¿™ä¸ªèŒƒå›´ï¼Œæ²¡è¶…å‡ºå°±è¯´æ˜æœ¬æ¬¡æ»šåŠ¨ä¸ä¼šæ˜¾ç¤ºæˆ–æ¶ˆå¤±ä»»ä½•å›¾ç‰‡\n// ä»¥æ­¤è¿›è¡Œæ€§èƒ½ä¼˜åŒ–\n// ä¸è¿‡ä¸¤ä¸ªå·è½´æ¨¡å¼éƒ½è¦è¿™ä¹ˆå¤„ç†æŒºéº»çƒ¦çš„ï¼Œå§‘ä¸”å…ˆç”¨ throttle é¡¶ä¸Šï¼Œåé¢æœ‰éœ€è¦å†ä¼˜åŒ–\n);\n\n/** è·å–æŒ‡å®šèŒƒå›´å†…é¡µé¢æ‰€åŒ…å«çš„å›¾ç‰‡ */\nconst getRangeImgList = range => {\n  let list;\n  if (range[0] === range[1]) list = new Set(store.pageList[range[0]]);else {\n    list = new Set();\n    for (const [a, b] of store.pageList.slice(range[0], range[1] + 1)) {\n      list.add(a);\n      if (b !== undefined) list.add(b);\n    }\n  }\n  list.delete(-1);\n  return list;\n};\nconst renderImgList = helper.createRootMemo(() => getRangeImgList(store.renderRange));\nconst showImgList = helper.createRootMemo(() => getRangeImgList(store.showRange));\n\n/**\n * å›¾ç‰‡æ˜¾ç¤ºçŠ¶æ€\n *\n * 0 - é¡µé¢ä¸­çš„ç¬¬ä¸€å¼ å›¾ç‰‡\n * 1 - é¡µé¢ä¸­çš„æœ€åä¸€å¼ å›¾ç‰‡\n * '' - é¡µé¢ä¸­çš„å”¯ä¸€ä¸€å¼ å›¾ç‰‡\n */\nconst imgShowState = helper.createRootMemo(() => {\n  if (store.pageList.length === 0) return new Map();\n  const showRange = store.gridMode ? [0, store.pageList.length - 1] : store.renderRange;\n  const stateList = new Map();\n  for (let [i] = showRange; i <= showRange[1]; i++) {\n    const page = store.pageList[i];\n    if (!page) continue;\n    const [a, b] = page;\n    if (b === undefined) {\n      stateList.set(a, '');\n    } else {\n      stateList.set(a, 0);\n      stateList.set(b, 1);\n    }\n  }\n  return stateList;\n});\n\n// å·è½´æ¨¡å¼ä¸‹ï¼Œå°†å½“å‰æ˜¾ç¤ºçš„ç¬¬ä¸€é¡µä½œä¸ºå½“å‰é¡µ\nhelper.createEffectOn(() => store.showRange, ([firstPage]) => {\n  if (!store.gridMode && store.option.scrollMode.enabled) setState('activePageIndex', firstPage ?? 0);\n});\n\n// å›¾ç‰‡å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘å›è°ƒ\nhelper.createEffectOn(showImgList, showImgs => {\n  if (showImgs.size === 0) return;\n  store.prop.onShowImgsChange?.(showImgs, imgList());\n}, {\n  defer: true\n});\n\nconst setMessage = (url, msg) => setState('imgMap', url, 'translationMessage', msg);\nconst sizeDict = {\n  '1024': 'S',\n  '1536': 'M',\n  '2048': 'L',\n  '2560': 'X'\n};\nconst createFormData = (imgBlob, type) => {\n  const formData = new FormData();\n  const {\n    options\n  } = store.option.translation;\n  const file = new File([imgBlob], `image.${imgBlob.type.split('/').at(-1)}`, {\n    type: imgBlob.type\n  });\n  if (type === 'selfhosted') {\n    formData.append('image', file);\n    formData.append('config', JSON.stringify(options));\n  } else {\n    formData.append('file', file);\n    formData.append('mime', file.type);\n    formData.append('size', sizeDict[options.detector.detection_size]);\n    formData.append('detector', options.detector.detector);\n    formData.append('direction', options.render.direction);\n    formData.append('translator', options.translator.translator);\n    formData.append(type === 'cotrans' ? 'target_language' : 'target_lang', options.translator.target_lang);\n    formData.append('retry', `${store.option.translation.forceRetry}`);\n  }\n  return formData;\n};\n\n/** å°†ç«™ç‚¹åˆ—è¡¨è½¬ä¸ºé€‰æ‹©å™¨ä¸­çš„é€‰é¡¹ */\nconst createOptions = list => list.map(name => [name, helper.t(`translation.translator.${name}`) || name]);\n\nconst handleMessage = (msg, url) => {\n  switch (msg.type) {\n    case 'result':\n      return msg.result.translation_mask;\n    case 'pending':\n      setMessage(url, helper.t('translation.tip.pending', {\n        pos: msg.pos\n      }));\n      break;\n    case 'status':\n      setMessage(url, helper.t(`translation.status.${msg.status}`) || msg.status);\n      break;\n    case 'error':\n      throw new Error(`${helper.t('translation.status.error')}ï¼šid ${msg.error_id}`);\n    case 'not_found':\n      throw new Error(`${helper.t('translation.status.error')}ï¼šNot Found`);\n  }\n};\nconst waitTranslationPolling = async (id, url) => {\n  let result;\n  while (result === undefined) {\n    const res = await request.request(`https://api.cotrans.touhou.ai/task/${id}/status/v1`, {\n      responseType: 'json'\n    });\n    result = handleMessage(res.response, url);\n    await helper.sleep(1000);\n  }\n  return result;\n};\n\n/** ç­‰å¾…ç¿»è¯‘å®Œæˆ */\nconst waitTranslation = async (id, url) => {\n  const ws = new WebSocket(`wss://api.cotrans.touhou.ai/task/${id}/event/v1`);\n\n  // å¦‚æœç½‘ç«™è®¾ç½®äº† CSP connect-src å°±åªèƒ½è½®è¯¢äº†\n  if (ws.readyState > 1) return waitTranslationPolling(id, url);\n  return new Promise((resolve, reject) => {\n    ws.onmessage = e => {\n      try {\n        const result = handleMessage(JSON.parse(e.data), url);\n        if (result) resolve(result);\n      } catch (error) {\n        reject(error);\n      }\n    };\n  });\n};\n\n/** å°†ç¿»è¯‘åçš„å†…å®¹è¦†ç›–åˆ°åŸå›¾ä¸Š */\nconst mergeImage = async (rawImage, maskUri) => {\n  const img = await helper.waitImgLoad(URL.createObjectURL(rawImage));\n  const canvas = new OffscreenCanvas(img.naturalWidth, img.naturalHeight);\n  const canvasCtx = canvas.getContext('2d');\n  canvasCtx.drawImage(img, 0, 0);\n  const img2 = new Image();\n  img2.src = URL.createObjectURL(await downloadImg(maskUri));\n  await helper.waitImgLoad(img2);\n  canvasCtx.drawImage(img2, 0, 0);\n  return URL.createObjectURL(await helper.canvasToBlob(canvas));\n};\n\n/** ç¼©å°è¿‡å¤§çš„å›¾ç‰‡ */\nconst resize = async (blob, w, h) => {\n  if (w <= 4096 && h <= 4096) return blob;\n  const scale = Math.min(4096 / w, 4096 / h);\n  const width = Math.floor(w * scale);\n  const height = Math.floor(h * scale);\n  const img = await helper.waitImgLoad(URL.createObjectURL(blob));\n  const canvas = new OffscreenCanvas(width, height);\n  const ctx = canvas.getContext('2d');\n  ctx.imageSmoothingQuality = 'high';\n  ctx.drawImage(img, 0, 0, width, height);\n  URL.revokeObjectURL(img.src);\n  return helper.canvasToBlob(canvas);\n};\n\n/** ä½¿ç”¨ cotrans ç¿»è¯‘æŒ‡å®šå›¾ç‰‡ */\nconst cotransTranslation = async url => {\n  const img = store.imgMap[url];\n  setMessage(url, helper.t('translation.tip.img_downloading'));\n  let imgBlob;\n  try {\n    imgBlob = await downloadImg(img.src);\n  } catch (error) {\n    helper.log.error(error);\n    store.prop.onImgError?.(url);\n    throw new Error(helper.t('translation.tip.download_img_failed'), {\n      cause: error\n    });\n  }\n  try {\n    imgBlob = await resize(imgBlob, img.width, img.height);\n  } catch (error) {\n    helper.log.error(error);\n    throw new Error(helper.t('translation.tip.resize_img_failed'), {\n      cause: error\n    });\n  }\n  setMessage(url, helper.t('translation.tip.upload'));\n  let res;\n  try {\n    res = await request.request('https://api.cotrans.touhou.ai/task/upload/v1', {\n      method: 'POST',\n      data: createFormData(imgBlob, 'cotrans'),\n      headers: {\n        Origin: 'https://cotrans.touhou.ai',\n        Referer: 'https://cotrans.touhou.ai/'\n      }\n    });\n  } catch (error) {\n    helper.log.error(error);\n    throw new Error(helper.t('translation.tip.upload_error'), {\n      cause: error\n    });\n  }\n  let resData;\n  try {\n    resData = JSON.parse(res.responseText);\n    helper.log(resData);\n  } catch (error) {\n    throw new Error(`${helper.t('translation.tip.upload_return_error')}ï¼š${res.responseText}`, {\n      cause: error\n    });\n  }\n  if ('error_id' in resData) throw new Error(`${helper.t('translation.tip.upload_return_error')}ï¼š${resData.error_id}`);\n  if (!resData.id) throw new Error(helper.t('translation.tip.id_not_returned'));\n  const translation_mask = resData.result?.translation_mask || (await waitTranslation(resData.id, url));\n  return mergeImage(imgBlob, translation_mask);\n};\nconst cotransTranslators = ['google', 'youdao', 'baidu', 'deepl', 'gpt3.5', 'offline', 'none'];\n\nconst apiUrl = () => store.option.translation.localUrl || 'http://127.0.0.1:5003';\n\n/** ä½¿ç”¨è‡ªéƒ¨ç½²æœåŠ¡å™¨ç¿»è¯‘æŒ‡å®šå›¾ç‰‡ */\nconst selfhostedTranslation = async url => {\n  const html = await request.request(apiUrl(), {\n    errorText: `${helper.t('setting.option.paragraph_translation')} - ${helper.t('alert.server_connect_failed')}`\n  });\n  setMessage(url, helper.t('translation.tip.img_downloading'));\n  let imgBlob;\n  try {\n    imgBlob = await downloadImg(url);\n  } catch (error) {\n    helper.log.error(error, url);\n    store.prop.onImgError?.(url);\n    throw new Error(helper.t('translation.tip.download_img_failed'), {\n      cause: error\n    });\n  }\n\n  // æ”¯æŒæ—§ç‰ˆ manga-image-translator\n  // https://sleazyfork.org/zh-CN/scripts/374903/discussions/273466\n  if (html.responseText.includes('value=\"S\">1024px</')) {\n    let task_id;\n    // ä¸Šä¼ å›¾ç‰‡å–å¾—ä»»åŠ¡ id\n    try {\n      const res = await request.request(`${apiUrl()}/submit`, {\n        method: 'POST',\n        responseType: 'json',\n        data: createFormData(imgBlob, 'selfhosted-old')\n      });\n      ({\n        task_id\n      } = res.response);\n    } catch (error) {\n      helper.log.error(error);\n      throw new Error(helper.t('translation.tip.upload_error'), {\n        cause: error\n      });\n    }\n    let errorNum = 0;\n    let taskState;\n    // ç­‰å¾…ç¿»è¯‘å®Œæˆ\n    while (!taskState?.finished) {\n      try {\n        await helper.sleep(200);\n        const res = await request.request(`${apiUrl()}/task-state?taskid=${task_id}`, {\n          responseType: 'json'\n        });\n        taskState = res.response;\n        setMessage(url, `${helper.t(`translation.status.${taskState.state}`) || taskState.state}`);\n      } catch (error) {\n        helper.log.error(error);\n        if (errorNum > 5) throw new Error(helper.t('translation.tip.check_img_status_failed'), {\n          cause: error\n        });\n        errorNum += 1;\n      }\n    }\n    return URL.createObjectURL(await downloadImg(`${apiUrl()}/result/${task_id}`));\n  }\n  try {\n    const res = await fetch(`${apiUrl()}/translate/with-form/image/stream`, {\n      method: 'POST',\n      body: createFormData(imgBlob, 'selfhosted')\n    });\n    if (res.status !== 200 || !res.body) throw new Error(helper.t('translation.status.error'));\n    const reader = res.body.getReader();\n    const decoder = new TextDecoder('utf8');\n    let buffer = new Uint8Array();\n    while (true) {\n      const {\n        done,\n        value\n      } = await reader.read();\n      if (done) break;\n      buffer = Uint8Array.from([...buffer, ...value]);\n      while (buffer.length >= 5) {\n        const dataSize = new DataView(buffer.buffer).getUint32(1, false);\n        const totalSize = 5 + dataSize;\n        if (buffer.length < totalSize) break;\n        const data = buffer.slice(5, totalSize);\n        switch (buffer[0]) {\n          case 0:\n            return URL.createObjectURL(new Blob([data], {\n              type: 'image/png'\n            }));\n          case 1:\n            setMessage(url, helper.t(`translation.status.${decoder.decode(data)}`));\n            break;\n          case 2:\n            throw new Error(`${helper.t('translation.status.error')}: ${decoder.decode(data)}`);\n          case 3:\n            {\n              const pos = decoder.decode(data);\n              if (pos !== '0') {\n                setMessage(url, helper.t('translation.tip.pending', {\n                  pos\n                }));\n                break;\n              }\n              // falls through\n            }\n          case 4:\n            setMessage(url, helper.t('translation.status.pending'));\n            break;\n        }\n        buffer = buffer.slice(totalSize);\n      }\n    }\n    throw new Error(helper.t('translation.status.error'));\n  } catch (error) {\n    // å¦‚æœå› ä¸º cors æ— æ³•ä½¿ç”¨ fetchï¼Œå°±åªèƒ½ä½¿ç”¨æ‹¿ä¸åˆ°ç¿»è¯‘çŠ¶æ€çš„éæµå¼æ¥å£äº†\n    if (error.message.includes('Failed to fetch')) {\n      setMessage(url, helper.t('translation.tip.translating'));\n      // åœ¨æ‹·è´æ¼«ç”»ä¸Šè«åæœ‰æ¦‚ç‡æŠ¥é”™\n      // è™½ç„¶çŒœæµ‹å¯èƒ½æ˜¯ cors connect-src å¯¼è‡´çš„ï¼Œä½†åœ¨ç±»ä¼¼çš„ fantia ä¸Šå´ä¹Ÿæ— æ³•å¤ç°\n      // ä¹Ÿæ‰¾ä¸åˆ°ç¬¬äºŒä¸ªåŒæ ·é—®é¢˜çš„ç½‘ç«™ï¼Œè€ƒè™‘åˆ°åº”è¯¥æ²¡äººä¼šåœ¨æ‹·è´ä¸Šç¿»è¯‘ï¼Œå°±æš‚ä¸”ä¸ç®¡äº†\n      const res = await request.request(`${apiUrl()}/translate/with-form/image`, {\n        method: 'POST',\n        responseType: 'blob',\n        fetch: false,\n        timeout: 1000 * 60 * 10,\n        data: createFormData(imgBlob, 'selfhosted'),\n        errorText: helper.t('translation.tip.upload_error')\n      });\n      return URL.createObjectURL(res.response);\n    }\n    throw error;\n  }\n};\nconst [selfhostedOptions, setSelfOptions] = helper.createEqualsSignal([]);\n\n/** æ›´æ–°éƒ¨ç½²æœåŠ¡çš„å¯ç”¨ç¿»è¯‘ */\nconst updateSelfhostedOptions = async (noTip = false) => {\n  if (store.option.translation.server !== 'selfhosted') return;\n  try {\n    const res = await request.request(`${apiUrl()}`, {\n      noTip,\n      errorText: `${helper.t('setting.option.paragraph_translation')} - ${helper.t('alert.server_connect_failed')}`\n    });\n    const translatorsText = /(?<=validTranslators: )\\[.+?\\](?=,)/s.exec(res.responseText)?.[0];\n    if (!translatorsText) return undefined;\n    const list = JSON.parse(translatorsText.replaceAll(/\\s|,\\s*(?=\\])/g, ``).replaceAll(`'`, `\"`));\n    setSelfOptions(createOptions(list));\n  } catch (error) {\n    helper.log.error(helper.t('translation.tip.get_translator_list_error'), error);\n    setSelfOptions([]);\n  }\n\n  // å¦‚æœæ›´æ–°ååŸå…ˆé€‰æ‹©çš„ç¿»è¯‘æœåŠ¡å¤±æ•ˆäº†ï¼Œå°±æ¢æˆç¬¬ä¸€ä¸ªç¿»è¯‘\n  if (!selfhostedOptions().some(([val]) => val === store.option.translation.options.translator.translator)) {\n    setOption(draftOption => {\n      draftOption.translation.options.translator.translator = selfhostedOptions()[0]?.[0];\n    });\n  }\n};\n\n// åœ¨åˆ‡æ¢ç¿»è¯‘æœåŠ¡å™¨çš„åŒæ—¶åˆ‡æ¢å¯ç”¨ç¿»è¯‘çš„é€‰é¡¹åˆ—è¡¨\nhelper.createEffectOn([() => store.option.translation.server, () => store.option.translation.localUrl, helper.lang], () => store.imgList.length > 0 && updateSelfhostedOptions(true), {\n  defer: true\n});\n\n/** ç¿»è¯‘æŒ‡å®šå›¾ç‰‡ */\nconst translationImage = async url => {\n  try {\n    if (!url) return;\n    const img = store.imgMap[url];\n    if (img.translationType !== 'wait') return;\n    if (img.translationUrl) return setState('imgMap', url, 'translationType', 'show');\n    if (img.loadType !== 'loaded') return setMessage(url, helper.t('translation.tip.img_not_fully_loaded'));\n    const translationUrl = await (store.option.translation.server === 'cotrans' ? cotransTranslation : selfhostedTranslation)(url);\n    setState('imgMap', url, {\n      translationUrl,\n      translationMessage: helper.t('translation.tip.translation_completed'),\n      translationType: 'show'\n    });\n  } catch (error) {\n    setState('imgMap', url, 'translationType', 'error');\n    if (error?.message) setState('imgMap', url, 'translationMessage', error.message);\n  }\n};\n\n/** é€ä¸ªç¿»è¯‘çŠ¶æ€ä¸ºç­‰å¾…ç¿»è¯‘çš„å›¾ç‰‡ */\nconst translationAll = helper.singleThreaded(async state => {\n  const targetImg = imgList().find(img => img.translationType === 'wait' && img.loadType === 'loaded');\n  if (!targetImg) return;\n  await translationImage(targetImg.src);\n  state.continueRun();\n});\n\n/** å¼€å¯æˆ–å…³é—­æŒ‡å®šå›¾ç‰‡çš„ç¿»è¯‘ */\nconst setImgTranslationEnbale = (list, enbale) => {\n  if (store.option.translation.server === 'disable' && enbale) return;\n  setState(state => {\n    for (const i of list) {\n      const img = state.imgMap[state.imgList[i]];\n      if (!img) continue;\n      const url = img.src;\n      if (enbale) {\n        if (state.option.translation.forceRetry) {\n          img.translationType = 'wait';\n          img.translationUrl = undefined;\n          setMessage(url, helper.t('translation.tip.wait_translation'));\n        } else {\n          switch (img.translationType) {\n            case 'hide':\n              {\n                img.translationType = 'show';\n                break;\n              }\n            case 'error':\n            case undefined:\n              {\n                img.translationType = 'wait';\n                setMessage(url, helper.t('translation.tip.wait_translation'));\n                break;\n              }\n          }\n        }\n      } else {\n        switch (img.translationType) {\n          case 'show':\n            {\n              img.translationType = 'hide';\n              break;\n            }\n          case 'error':\n          case 'wait':\n            {\n              img.translationType = undefined;\n              break;\n            }\n        }\n      }\n    }\n  });\n  return translationAll();\n};\nconst translatorOptions = helper.createRootMemo(() => store.option.translation.server === 'selfhosted' ? selfhostedOptions() : createOptions(cotransTranslators));\n\n/** ç¿»è¯‘èŒƒå›´çš„å›¾ç‰‡ */\nconst translationImgs = helper.createRootMemo(() => {\n  const list = new Set();\n  for (const [i, img] of imgList().entries()) {\n    switch (img.translationType) {\n      case 'error':\n      case 'show':\n      case 'wait':\n        list.add(i);\n    }\n  }\n  return list;\n});\n\n/** å½“å‰æ˜¾ç¤ºçš„å›¾ç‰‡æ˜¯å¦æ­£åœ¨ç¿»è¯‘ */\nconst isTranslatingImage = helper.createRootMemo(() => activePage().some(i => translationImgs().has(i)));\n\n/** ç¿»è¯‘å½“å‰é¡µ */\nconst translateCurrent = () => setImgTranslationEnbale(activePage(), !isTranslatingImage());\nconst createTranslateRange = imgs => {\n  const isTranslating = helper.createRootMemo(() => imgs().every(i => translationImgs().has(i)));\n  const translateRange = () => {\n    if (store.option.translation.server !== 'selfhosted') return;\n    setImgTranslationEnbale(imgs(), !isTranslating());\n  };\n  return [isTranslating, translateRange];\n};\n\n// ç¿»è¯‘å…¨éƒ¨å›¾ç‰‡\nconst [isTranslatingAll, translateAll] = createTranslateRange(helper.createRootMemo(() => helper.range(store.imgList.length)));\n\n// ç¿»è¯‘å½“å‰é¡µä»¥åçš„å…¨éƒ¨å›¾ç‰‡\nconst [isTranslatingToEnd, translateToEnd] = createTranslateRange(helper.createRootMemo(() => helper.range(activeImgIndex(), store.imgList.length)));\n\n/** å›¾ç‰‡ä¸Šæ¬¡åŠ è½½å‡ºé”™çš„æ—¶é—´ */\nconst imgErrorMap = new Map();\n\n/** é‡æ–°åŠ è½½é”™è¯¯å›¾ç‰‡ */\nconst reloadImg = url => {\n  if (store.imgMap[url]?.loadType !== 'error') return;\n  setState('imgMap', url, 'loadType', 'wait');\n  updateImgLoadType();\n};\n\n/** å›¾ç‰‡åŠ è½½å¤±è´¥åå®šæ—¶é‡æ–°åŠ è½½ */\nconst handleTimeReload = url => {\n  const count = imgErrorMap.get(url) || 0;\n  // æœ€å¤šé‡è¯• 8 æ¬¡\n  if (count > 8) return;\n  imgErrorMap.set(url, count + 1);\n  const time = (2 ** count + Math.random() * 2) * 1000;\n  setTimeout(reloadImg, time, url);\n};\n\n/** å›¾ç‰‡åŠ è½½å®Œæ¯•çš„å›è°ƒ */\nconst handleImgLoaded = (url, e) => {\n  // å†…è”å›¾ç‰‡å…ƒç´ è¢«åˆ›å»ºåç«‹åˆ»å°±ä¼šè§¦å‘ load äº‹ä»¶ï¼Œå¦‚æœåœ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°å‰ url å‘ç”Ÿæ”¹å˜\n  // å°±ä¼šå¯¼è‡´è¿™é‡Œè·å¾—çš„æ˜¯ä¸Šä¸ª url å›¾ç‰‡çš„å°ºå¯¸\n  if (e && !e.isConnected) return;\n  imgErrorMap.delete(url);\n  const img = store.imgMap[url];\n  if (img.translationType === 'show') return;\n  if (img.loadType !== 'loaded') {\n    setState('imgMap', url, 'loadType', 'loaded');\n    updateImgLoadType();\n    store.prop.onLoading?.(imgList(), store.imgMap[url]);\n  }\n  if (!e) return;\n  updateImgSize(url, e.naturalWidth, e.naturalHeight);\n  if (store.option.imgRecognition.enabled && e.src === img.blobUrl) setTimeout(handleImgRecognition, 0, url, e);\n  translationAll();\n};\n\n/** å›¾ç‰‡åŠ è½½å‡ºé”™çš„å›è°ƒ */\nconst handleImgError = (url, e) => {\n  if (e && !e.isConnected) return;\n  setState(state => {\n    const img = state.imgMap[url];\n    if (!img) return;\n    const imgIndexs = getImgIndexs(url);\n    helper.log.error(imgIndexs, helper.t('alert.img_load_failed'), e);\n    img.loadType = 'error';\n    img.type = undefined;\n  });\n  handleTimeReload(url);\n  store.prop.onLoading?.(imgList(), store.imgMap[url]);\n  store.prop.onImgError?.(url);\n  updateImgLoadType();\n};\n\n/** éœ€è¦åŠ è½½çš„å›¾ç‰‡ */\nconst needLoadImgList = helper.createRootMemo(() => {\n  const list = new Set();\n  for (const img of imgList()) if (img.loadType !== 'loaded' && img.src) list.add(img.src);\n  return list;\n});\nconst waitUrlImgNum = helper.createRootMemo(() => {\n  let num = 0;\n  for (const img of imgList()) if (!img.src) num += 1;\n  return num;\n});\n\n/** å½“å‰åŠ è½½çš„å›¾ç‰‡ */\nconst loadImgList = new Set();\n\n/** åŠ è½½èŒƒå›´ä¸­ç­‰å¾… url çš„å›¾ç‰‡ */\nconst waitUrlImgs = new Set();\n\n/** åŠ è½½æŒ‡å®šå›¾ç‰‡ã€‚è¿”å›æ˜¯å¦å·²åŠ è½½å®Œæˆ */\nconst loadImg = index => {\n  const img = getImg(index);\n  if (!img.src) {\n    waitUrlImgs.add(index);\n    return true;\n  }\n  if (!needLoadImgList().has(img.src)) return true;\n  if (img.loadType === 'error') return true;\n  loadImgList.add(img.src);\n  return false;\n};\n\n/** è·å–æŒ‡å®šé¡µæ•°ä¸‹çš„å¤´/å°¾å›¾ç‰‡ */\nconst getPageImg = (pageNum, imgType) => {\n  const page = store.pageList[pageNum].filter(i => i !== -1);\n  if (page.length === 1) return page[0];\n  return imgType === 'start' ? Math.min(...page) : Math.max(...page);\n};\n\n/**\n * ä»¥å½“å‰æ˜¾ç¤ºé¡µä¸ºåŸºå‡†ï¼Œé¢„åŠ è½½é™„è¿‘æŒ‡å®šé¡µæ•°çš„å›¾ç‰‡ï¼Œå¹¶å–æ¶ˆå…¶ä»–é¢„åŠ è½½çš„å›¾ç‰‡\n * @param target åŠ è½½ç›®æ ‡é¡µ\n * @param loadNum åŠ è½½å›¾ç‰‡æ•°é‡\n * @returns è¿”å›æŒ‡å®šèŒƒå›´å†…æ˜¯å¦è¿˜æœ‰æœªåŠ è½½çš„å›¾ç‰‡\n */\nconst loadRangeImg = (target = 0, loadNum = 2) => {\n  let start = getPageImg(store.showRange[0], 'start');\n  let end = getPageImg(store.showRange[1], 'end');\n  if (target !== 0) {\n    if (target < 0) {\n      end = start + target;\n      start -= 1;\n    } else {\n      start = end + 1;\n      end += target;\n    }\n    start = helper.clamp(0, start, store.imgList.length - 1);\n    end = helper.clamp(0, end, store.imgList.length - 1);\n  }\n\n  /** æ˜¯å¦è¿˜æœ‰æœªåŠ è½½çš„å›¾ç‰‡ */\n  let hasUnloadedImg = false;\n  let index = start;\n  const condition = start <= end ? () => index <= end : () => index >= end;\n  const step = start <= end ? 1 : -1;\n  while (condition()) {\n    if (!loadImg(index)) hasUnloadedImg = true;\n    if (loadImgList.size >= loadNum) return index !== end || hasUnloadedImg;\n    index += step;\n  }\n  return hasUnloadedImg;\n};\n\n/** åŠ è½½æœŸé—´å°½å¿«è·å–å›¾ç‰‡å°ºå¯¸ */\nconst checkImgSize = url => {\n  const imgDom = getImgEle(url);\n  if (!imgDom) return;\n  const timeoutId = setInterval(() => {\n    if (!imgDom?.isConnected || store.option.imgRecognition.enabled) return clearInterval(timeoutId);\n    const img = store.imgMap[url];\n    if (!img || img.loadType !== 'loading') return clearInterval(timeoutId);\n    if (imgDom.naturalWidth && imgDom.naturalHeight) {\n      updateImgSize(url, imgDom.naturalWidth, imgDom.naturalHeight);\n      return clearInterval(timeoutId);\n    }\n  }, 200);\n};\nconst updateImgLoadType = helper.singleThreaded(() => {\n  if (store.showRange[0] < 0 || needLoadImgList().size === 0 && waitUrlImgNum() === 0) return;\n  loadImgList.clear();\n  waitUrlImgs.clear();\n  if (store.imgList.length > 0) {\n    // oxlint-disable-next-line no-unused-expressions\n    loadRangeImg() ||\n    // ä¼˜å…ˆåŠ è½½å½“å‰æ˜¾ç¤ºçš„å›¾ç‰‡\n    loadRangeImg(preloadNum().back) ||\n    // å†åŠ è½½åé¢å‡ é¡µ\n    loadRangeImg(-preloadNum().front) ||\n    // å†åŠ è½½å‰é¢å‡ é¡µ\n    !store.option.alwaysLoadAllImg ||\n    // æ ¹æ®è®¾ç½®å†³å®šæ˜¯å¦è¦ç»§ç»­åŠ è½½å…¶ä½™å›¾ç‰‡\n    loadRangeImg(Number.POSITIVE_INFINITY, 5) ||\n    // åŠ è½½å½“å‰é¡µåé¢çš„å›¾ç‰‡\n    loadRangeImg(Number.NEGATIVE_INFINITY, 5); // åŠ è½½å½“å‰é¡µå‰é¢çš„å›¾ç‰‡\n  }\n  store.prop.onWaitUrlImgs?.(waitUrlImgs, imgList());\n  setState(state => {\n    for (const url of needLoadImgList()) {\n      const img = state.imgMap[url];\n      if (loadImgList.has(url)) {\n        if (img.loadType !== 'loading') {\n          img.loadType = 'loading';\n          if (!store.option.imgRecognition.enabled && img.width === undefined) setTimeout(checkImgSize, 0, img.src);\n        }\n      } else if (img.loadType === 'loading') img.loadType = 'wait';\n    }\n  });\n});\nhelper.createEffectOn([preloadNum, renderImgList, () => store.imgMap, () => store.option.alwaysLoadAllImg], updateImgLoadType);\n\n// å¦‚æœå½“å‰æ˜¾ç¤ºé¡µé¢æœ‰å‡ºé”™çš„å›¾ç‰‡ï¼Œå°±é‡æ–°åŠ è½½ä¸€æ¬¡\nhelper.createEffectOn(showImgList, helper.debounce(list => {\n  if (imgErrorMap.size === 0) return;\n  for (const i of list) reloadImg(getImg(i).src);\n}, 500), {\n  defer: true\n});\n\n/** åŠ è½½ä¸­çš„å›¾ç‰‡ */\nconst loadingImgList = helper.createRootMemo(() => {\n  const list = new Set();\n  for (const [url, img] of Object.entries(store.imgMap)) if (img.loadType === 'loading') list.add(url);\n  return list;\n});\nconst abortMap = new Map();\nconst timeoutAbort = url => {\n  if (!abortMap.has(url)) return;\n  abortMap.get(url).abort();\n  abortMap.delete(url);\n  handleImgError(url);\n};\nhelper.createEffectOn(loadingImgList, (downImgList, prevImgList) => {\n  if (!store.option.imgRecognition.enabled) return;\n  if (prevImgList) {\n    // ä¸­æ–­å–æ¶ˆä¸‹è½½çš„å›¾ç‰‡\n    for (const url of prevImgList) {\n      if (downImgList.has(url) || !abortMap.has(url)) continue;\n      abortMap.get(url)?.abort();\n      abortMap.delete(url);\n      helper.log(`ä¸­æ–­ä¸‹è½½ ${url}`);\n    }\n  }\n  for (const url of downImgList.values()) {\n    if (abortMap.has(url) || store.imgMap[url].blobUrl) continue;\n    const controller = new AbortController();\n    const handleTimeout = helper.debounce(() => timeoutAbort(url), 1000 * 3);\n    controller.signal.addEventListener('abort', handleTimeout.clear);\n    abortMap.set(url, controller);\n    handleTimeout();\n    request.request(url, {\n      responseType: 'blob',\n      retryFetch: true,\n      signal: controller.signal,\n      timeout: undefined,\n      noTip: true,\n      headers: downloadImgHeaders,\n      onerror: () => handleImgError(url),\n      onprogress({\n        loaded,\n        total\n      }) {\n        setState('imgMap', url, 'progress', loaded / total * 100);\n        // ä¸€æ®µæ—¶é—´å†…éƒ½æ²¡è¿›åº¦åè¶…æ—¶ä¸­æ–­\n        handleTimeout();\n      },\n      onload({\n        response\n      }) {\n        abortMap.delete(url);\n        setState('imgMap', url, {\n          blobUrl: URL.createObjectURL(response),\n          progress: undefined\n        });\n        handleImgLoaded(url);\n      }\n    });\n  }\n});\n\nconst upscaleImage = async (url, imgEle) => {\n  setState('imgMap', url, 'upscaleUrl', '');\n  const {\n    data,\n    width,\n    height\n  } = helper.getImageData(imgEle);\n  initWorker();\n  await worker$1.upscaleImage(Comlink.transfer(data, [data.buffer]), width, height, url);\n};\nlet upscaleing = false;\nconst findUpscaleImage = async (start, end) => {\n  for (let i = start; i < end; i++) {\n    const img = typeof i === 'number' ? getImg(i) : i;\n    if (img.upscaleUrl !== undefined) continue;\n    const imgEle = await helper.wait(() => getImgEle(i), 1000);\n    if (imgEle) return [img.src, imgEle];\n  }\n};\nconst handleUpscaleImage = async () => {\n  if (upscaleing || !isUpscale() || store.imgList.length === 0) return;\n  // ä¼˜å…ˆæ”¾å¤§ å½“å‰æ˜¾ç¤ºçš„å›¾ç‰‡ > åé¢çš„å›¾ç‰‡ > å‰é¢çš„å›¾ç‰‡\n  const targetImg = (await findUpscaleImage(activeImgIndex(), store.imgList.length)) ?? (await findUpscaleImage(0, activeImgIndex()));\n  if (!targetImg) return;\n  upscaleing = true;\n  await upscaleImage(...targetImg);\n  upscaleing = false;\n  return handleUpscaleImage();\n};\nhelper.createEffectOn([isUpscale, imgList], handleUpscaleImage);\nconst bufferToBase64 = buffer => {\n  let binary = '';\n  const bytes = new Uint8Array(buffer);\n  const len = bytes.byteLength;\n  for (let i = 0; i < len; i++) binary += String.fromCodePoint(bytes[i]);\n  return window.btoa(binary);\n};\nconst getModel = async () => {\n  try {\n    let base64;\n    let buffer;\n    if (typeof GM !== 'undefined') base64 = await GM.getValue('@model.bin');\n    if (!base64) {\n      Toast.toast(helper.t('upscale.module_downloading'), {\n        id: 'upscale',\n        duration: Number.POSITIVE_INFINITY\n      });\n      // TODO: ä¿®æ”¹ç½‘å€\n      const bin = await request.request('https://cdn.jsdelivr.net/npm/@hymbz/comic-read-script@11.12.1/public/realcugan/2x-conservative-128/group1-shard1of1.bin', {\n        responseType: 'arraybuffer',\n        noTip: true\n      });\n      Toast.toast(helper.t('upscale.module_download_complete'), {\n        id: 'upscale',\n        duration: 1000 * 3\n      });\n      buffer = bin.response;\n      base64 = bufferToBase64(buffer);\n      await GM.setValue('@model.bin', base64);\n    }\n    let json = await GM.getValue('@model.json');\n    if (!json) {\n      const jsonFile = await request.request('https://cdn.jsdelivr.net/npm/@hymbz/comic-read-script@11.12.1/public/realcugan/2x-conservative-128/model.json', {\n        noTip: true\n      });\n      json = jsonFile.responseText;\n      await GM.setValue('@model.json', json);\n    }\n    return {\n      base64,\n      json,\n      buffer\n    };\n  } catch (error) {\n    helper.log.error('è·å–å›¾ç‰‡æ”¾å¤§æ¨¡å‹å‡ºé”™', error);\n    Toast.toast.dismiss('upscale');\n    Toast.toast.error(helper.t('upscale.module_download_failed'), {\n      id: 'upscale',\n      duration: Number.POSITIVE_INFINITY\n    });\n    setState('supportUpscaleImage', false);\n    setState('option', 'imgRecognition', 'upscale', false);\n    throw error;\n  }\n};\nconst initWorker = helper.onec(() => {\n  const mainFn = {\n    log: helper.log,\n    toast: Toast.toast,\n    t: helper.t,\n    setImg: (url, key, val) => Reflect.has(store.imgMap, url) && setState('imgMap', url, key, val),\n    getModel\n  };\n  worker$1.setMainFn(Comlink.proxy(mainFn), Object.keys(mainFn));\n});\n\nvar css$1 = \".img____hash_base64_5_ img{display:block;height:100%;object-fit:contain;width:100%}.img____hash_base64_5_{align-content:center;content-visibility:hidden;display:none;height:100%;margin-left:auto;margin-right:auto;position:relative;width:100%}.img____hash_base64_5_[data-show]{content-visibility:visible;display:block}.img____hash_base64_5_>picture{display:block;height:auto;inset:0;margin-bottom:auto;margin-left:inherit;margin-right:inherit;margin-top:auto;max-height:100%;max-width:100%;position:absolute;width:auto}.img____hash_base64_5_>picture,.img____hash_base64_5_>picture:after{background-color:var(--hover-bg-color,#fff3);background-image:var(--md-photo);background-position:50%;background-repeat:no-repeat;background-size:30%}.img____hash_base64_5_[data-load-type=error]>picture:after{background-color:#eee;background-image:var(--md-image-not-supported);content:\\\"\\\";height:100%;pointer-events:none;position:absolute;right:0;top:0;width:100%}.img____hash_base64_5_[data-load-type=loading]>picture{background-image:var(--md-cloud-download)}:is(.img____hash_base64_5_[data-load-type=loading]>picture) img{animation:show____hash_base64_5_ .1s forwards}.img____hash_base64_5_[data-load-type=error]>picture{cursor:pointer}.mangaFlow____hash_base64_5_[dir=ltr] .img____hash_base64_5_[data-show=\\\"1\\\"],.mangaFlow____hash_base64_5_[dir=rtl] .img____hash_base64_5_[data-show=\\\"0\\\"]{margin-left:0;margin-right:auto}.mangaFlow____hash_base64_5_[dir=ltr] .img____hash_base64_5_[data-show=\\\"0\\\"],.mangaFlow____hash_base64_5_[dir=rtl] .img____hash_base64_5_[data-show=\\\"1\\\"]{margin-left:auto;margin-right:0}.mangaFlow____hash_base64_5_{backface-visibility:hidden;color:var(--text);contain:layout;display:grid;grid-auto-columns:100%;grid-auto-flow:column;grid-auto-rows:100%;height:100%;overflow:visible;place-items:center;position:absolute;row-gap:0;touch-action:none;transform-origin:0 0;-webkit-user-select:none;user-select:none;width:100%;will-change:left,top}.mangaFlow____hash_base64_5_[data-disable-zoom] .img____hash_base64_5_>picture{height:fit-content;width:fit-content}.mangaFlow____hash_base64_5_[data-hidden-mouse=true]{cursor:none}.mangaFlow____hash_base64_5_[data-vertical]{grid-auto-flow:row}.mangaBox____hash_base64_5_{contain:layout style;height:100%;transform-origin:0 0;transition-duration:0s;width:100%}.mangaBox____hash_base64_5_[data-animation=page] .mangaFlow____hash_base64_5_,.mangaBox____hash_base64_5_[data-animation=zoom]{transition-duration:.3s}.root____hash_base64_5_:not([data-grid-mode]) .mangaBox____hash_base64_5_{scrollbar-width:none}:is(.root____hash_base64_5_:not([data-grid-mode]) .mangaBox____hash_base64_5_)::-webkit-scrollbar{display:none}.root____hash_base64_5_[data-grid-mode] .mangaFlow____hash_base64_5_{align-items:end;box-sizing:border-box;grid-auto-columns:1fr;grid-auto-flow:row;grid-auto-rows:max-content;grid-template-rows:unset;overflow:auto;row-gap:1.5em}:is(.root____hash_base64_5_[data-grid-mode] .mangaFlow____hash_base64_5_) .img____hash_base64_5_{cursor:pointer;margin-left:auto;margin-right:auto}:is(:is(.root____hash_base64_5_[data-grid-mode] .mangaFlow____hash_base64_5_) .img____hash_base64_5_)>picture{position:relative}:is(:is(.root____hash_base64_5_[data-grid-mode] .mangaFlow____hash_base64_5_) .img____hash_base64_5_)>.gridModeTip____hash_base64_5_{bottom:-1.5em;cursor:auto;direction:ltr;line-height:1.5em;opacity:.5;overflow:hidden;position:absolute;text-align:center;text-overflow:ellipsis;white-space:nowrap;width:100%}[data-load-type=error]:is(:is(.root____hash_base64_5_[data-grid-mode] .mangaFlow____hash_base64_5_) .img____hash_base64_5_),[data-load-type=wait]:is(:is(.root____hash_base64_5_[data-grid-mode] .mangaFlow____hash_base64_5_) .img____hash_base64_5_),[src=\\\"\\\"]:is(:is(.root____hash_base64_5_[data-grid-mode] .mangaFlow____hash_base64_5_) .img____hash_base64_5_){height:100%}.root____hash_base64_5_[data-scroll-mode]:not([data-grid-mode]) .mangaBox____hash_base64_5_{overflow:auto}:is(.root____hash_base64_5_[data-scroll-mode]:not([data-grid-mode]) .mangaBox____hash_base64_5_) .mangaFlow____hash_base64_5_{height:fit-content;row-gap:calc(var(--scroll-mode-spacing)*7px);touch-action:pan-y}[data-abreast-scroll]:is(.root____hash_base64_5_[data-scroll-mode]:not([data-grid-mode]) .mangaBox____hash_base64_5_){overflow:hidden;touch-action:none}[data-abreast-scroll]:is(.root____hash_base64_5_[data-scroll-mode]:not([data-grid-mode]) .mangaBox____hash_base64_5_) .mangaFlow____hash_base64_5_{align-items:start;column-gap:calc(var(--scroll-mode-spacing)*7px);height:100%}:is([data-abreast-scroll]:is(.root____hash_base64_5_[data-scroll-mode]:not([data-grid-mode]) .mangaBox____hash_base64_5_) .mangaFlow____hash_base64_5_) .img____hash_base64_5_{height:auto;width:100%;will-change:transform}:is(:is([data-abreast-scroll]:is(.root____hash_base64_5_[data-scroll-mode]:not([data-grid-mode]) .mangaBox____hash_base64_5_) .mangaFlow____hash_base64_5_) .img____hash_base64_5_)>picture{position:relative}@keyframes show____hash_base64_5_{0%{opacity:0}90%{opacity:0}to{opacity:1}}.endPageBody____hash_base64_5_,.endPage____hash_base64_5_{align-items:center;display:flex;height:100%;justify-content:center;width:100%;z-index:10}.endPage____hash_base64_5_{background-color:#333d;color:#fff;left:0;opacity:0;pointer-events:none;position:absolute;top:0;transition:opacity .5s}.endPage____hash_base64_5_[data-show]{opacity:1;pointer-events:all}.endPage____hash_base64_5_[data-type=start] .tip____hash_base64_5_{transform:translateY(-10em)}.endPage____hash_base64_5_[data-type=end] .tip____hash_base64_5_{transform:translateY(10em)}.endPage____hash_base64_5_ .endPageBody____hash_base64_5_{transform:translateY(var(--drag-y,0));transition:transform .2s}:is(.endPage____hash_base64_5_ .endPageBody____hash_base64_5_) button{animation:jello____hash_base64_5_ .3s forwards;background-color:initial;color:inherit;cursor:pointer;font-size:1.2em;transform-origin:center}[data-is-end]:is(:is(.endPage____hash_base64_5_ .endPageBody____hash_base64_5_) button){font-size:3em;margin:2em}:is(.endPage____hash_base64_5_ .endPageBody____hash_base64_5_) .tip____hash_base64_5_{margin:auto;position:absolute}.endPage____hash_base64_5_[data-drag] .endPageBody____hash_base64_5_{transition:transform 0s}.root____hash_base64_5_[data-mobile] .endPage____hash_base64_5_>button{width:1em}.comments____hash_base64_5_{align-items:flex-end;display:flex;flex-direction:column;max-height:80%;opacity:.3;overflow:auto;padding-right:.5em;position:absolute;right:1em;width:20em}.comments____hash_base64_5_>p{background-color:#333b;border-radius:.5em;margin:.5em .1em;padding:.2em .5em}.comments____hash_base64_5_:hover{opacity:1}.root____hash_base64_5_[data-mobile] .comments____hash_base64_5_{bottom:0;max-height:15em;opacity:.8}@keyframes jello____hash_base64_5_{0%,11.1%,to{transform:translateZ(0)}22.2%{transform:skewX(-12.5deg) skewY(-12.5deg)}33.3%{transform:skewX(6.25deg) skewY(6.25deg)}44.4%{transform:skewX(-3.125deg) skewY(-3.125deg)}55.5%{transform:skewX(1.5625deg) skewY(1.5625deg)}66.6%{transform:skewX(-.7812deg) skewY(-.7812deg)}77.7%{transform:skewX(.3906deg) skewY(.3906deg)}88.8%{transform:skewX(-.1953deg) skewY(-.1953deg)}}.toolbar____hash_base64_5_{align-items:center;display:flex;height:100%;justify-content:flex-start;position:fixed;top:0;z-index:9}.toolbarPanel____hash_base64_5_{display:flex;flex-direction:column;padding:.5em;position:relative;transform:translateX(-100%);transition:transform .2s}.toolbarPanel____hash_base64_5_>hr{border:none;height:1em;margin:0;visibility:hidden}:is(.toolbar____hash_base64_5_[data-show],.toolbar____hash_base64_5_:hover) .toolbarPanel____hash_base64_5_{transform:none}.toolbar____hash_base64_5_[data-close] .toolbarPanel____hash_base64_5_{transform:translateX(-100%);visibility:hidden}.toolbarBg____hash_base64_5_{background-color:var(--page-bg);border-bottom-right-radius:1em;border-top-right-radius:1em;filter:opacity(.8);height:100%;position:absolute;right:0;top:0;width:100%}.root____hash_base64_5_[data-mobile] .toolbar____hash_base64_5_{font-size:1.3em}.root____hash_base64_5_[data-mobile] .toolbar____hash_base64_5_:not([data-show]){pointer-events:none}.root____hash_base64_5_[data-mobile] .toolbarBg____hash_base64_5_{filter:opacity(.8)}.SettingPanelPopper____hash_base64_5_{height:0!important;padding:0!important;pointer-events:unset!important;transform:none!important}.SettingPanel____hash_base64_5_{background-color:var(--page-bg);border-radius:.3em;bottom:0;box-shadow:0 3px 1px -2px #0003,0 2px 2px 0 #00000024,0 1px 5px 0 #0000001f;color:var(--text);font-size:1.2em;height:fit-content;margin:auto;max-height:95%;max-width:calc(100% - 5em);overflow:auto;position:fixed;top:0;-webkit-user-select:text;user-select:text;z-index:1}.SettingPanel____hash_base64_5_ hr{color:#fff;margin:.5em 0}.SettingPanel____hash_base64_5_>hr{margin:0}.SettingBlock____hash_base64_5_{display:grid;grid-template-rows:max-content 1fr;transition:grid-template-rows .2s ease-out}.SettingBlock____hash_base64_5_ .SettingBlockBody____hash_base64_5_{overflow:hidden;padding:0 .5em 1em;z-index:0}:is(.SettingBlock____hash_base64_5_ .SettingBlockBody____hash_base64_5_)>div+:is(.SettingBlock____hash_base64_5_ .SettingBlockBody____hash_base64_5_)>div{margin-top:1em}:is(.SettingBlock____hash_base64_5_ .SettingBlockBody____hash_base64_5_) input,:is(.SettingBlock____hash_base64_5_ .SettingBlockBody____hash_base64_5_) textarea{margin-top:.3em;width:97%}.SettingBlock____hash_base64_5_[data-show=false]{grid-template-rows:max-content 0fr;padding-bottom:unset}.SettingBlock____hash_base64_5_[data-show=false] .SettingBlockBody____hash_base64_5_{padding:unset}.SettingBlockSubtitle____hash_base64_5_{background-color:var(--page-bg);color:var(--text-secondary);cursor:pointer;font-size:.7em;height:3em;line-height:3em;margin-bottom:.1em;position:sticky;text-align:center;top:0;z-index:1}.SettingBlockBody____hash_base64_5_ .SettingBlockSubtitle____hash_base64_5_{height:1em;line-height:1em;position:unset}.SettingsItem____hash_base64_5_{align-items:center;display:flex;justify-content:space-between;position:relative}:is(.SettingsItem____hash_base64_5_,.SettingsShowItem____hash_base64_5_)+.SettingsItem____hash_base64_5_{margin-top:1em}.SettingsItem____hash_base64_5_[data-disabled]{opacity:.5}.SettingsItem____hash_base64_5_[data-disabled] button{cursor:not-allowed}.SettingsItemName____hash_base64_5_{font-size:.9em;max-width:calc(100% - 4em);overflow-wrap:anywhere;text-align:start;white-space:pre-wrap}.SettingsItemSwitch____hash_base64_5_{align-items:center;background-color:var(--switch-bg);border:0;border-radius:1em;cursor:pointer;display:inline-flex;height:.8em;margin:.3em;padding:0;width:2.3em}.SettingsItemSwitchRound____hash_base64_5_{background:var(--switch);border-radius:100%;box-shadow:0 2px 1px -1px #0003,0 1px 1px 0 #00000024,0 1px 3px 0 #0000001f;height:1.15em;transform:translateX(-10%);transition:transform .1s;width:1.15em}.SettingsItemSwitch____hash_base64_5_[data-checked=true]{background:var(--secondary-bg)}.SettingsItemSwitch____hash_base64_5_[data-checked=true] .SettingsItemSwitchRound____hash_base64_5_{background:var(--secondary);transform:translateX(110%)}.SettingsItemIconButton____hash_base64_5_{background-color:initial;border:none;color:var(--text);cursor:pointer;font-size:1.5em;height:1em;position:absolute;right:0}.SettingsItemSelect____hash_base64_5_{background-color:var(--hover-bg-color);border:none;border-radius:5px;cursor:pointer;font-size:.9em;margin:0;max-width:6.5em;outline:none;padding:.3em}.closeCover____hash_base64_5_{height:100%;left:0;position:fixed;top:0;width:100%}.SettingsShowItem____hash_base64_5_{display:grid;transition:grid-template-rows .2s ease-out}.SettingsShowItem____hash_base64_5_>.SettingsShowItemBody____hash_base64_5_{display:flex;flex-direction:column;overflow:hidden}:is(.SettingsShowItem____hash_base64_5_>.SettingsShowItemBody____hash_base64_5_)>.SettingsItem____hash_base64_5_{margin-top:1em}:is(.SettingsShowItem____hash_base64_5_>.SettingsShowItemBody____hash_base64_5_)>:is(textarea,input){line-height:1.2;margin:.4em .2em 0}[data-only-number]{padding:0 .2em}[data-only-number]+span{margin-left:-.1em}.hotkeys____hash_base64_5_{align-items:center;border-bottom:1px solid var(--secondary-bg);color:var(--text);display:flex;flex-grow:1;flex-wrap:wrap;font-size:.9em;padding:2em .2em .2em;position:relative;z-index:1}.hotkeys____hash_base64_5_+.hotkeys____hash_base64_5_{margin-top:.5em}.hotkeys____hash_base64_5_:last-child{border-bottom:none}.hotkeysItem____hash_base64_5_{align-items:center;border-radius:.3em;box-sizing:initial;cursor:pointer;display:flex;font-family:serif;height:1em;margin:.3em;outline:1px solid;outline-color:var(--secondary-bg);padding:.2em 1.2em}.hotkeysItem____hash_base64_5_>svg{background-color:var(--text);border-radius:1em;color:var(--page-bg);display:none;height:1em;margin-left:.4em;opacity:.5}:is(.hotkeysItem____hash_base64_5_>svg):hover{opacity:.9}.hotkeysItem____hash_base64_5_:hover{padding:.2em .5em}.hotkeysItem____hash_base64_5_:hover>svg{display:unset}.hotkeysItem____hash_base64_5_:focus,.hotkeysItem____hash_base64_5_:focus-visible{outline:var(--text) solid 2px}.hotkeysHeader____hash_base64_5_{align-items:center;box-sizing:border-box;display:flex;left:0;padding:0 .5em;position:absolute;top:0;width:100%}.hotkeysHeader____hash_base64_5_>p{background-color:var(--page-bg);line-height:1em;overflow-wrap:anywhere;text-align:start;white-space:pre-wrap}.hotkeysHeader____hash_base64_5_>div[title]{background-color:var(--page-bg);cursor:pointer;display:flex;transform:scale(0);transition:transform .1s}:is(.hotkeysHeader____hash_base64_5_>div[title])>svg{width:1.6em}.hotkeys____hash_base64_5_:hover div[title]{transform:scale(1)}.scrollbar____hash_base64_5_{--arrow-y:clamp(0.45em,calc(var(--slider-midpoint)),calc(var(--scroll-length) - 0.45em));border-left:max(6vw,1em) solid #0000;display:flex;flex-direction:column;height:98%;position:absolute;right:3px;top:1%;touch-action:none;-webkit-user-select:none;user-select:none;width:5px;z-index:9}.scrollbar____hash_base64_5_>div{align-items:center;display:flex;flex-direction:column;flex-grow:1;justify-content:center;pointer-events:none}.scrollbarPage____hash_base64_5_{background-color:var(--secondary);flex-grow:1;height:100%;transform:scaleY(1);transform-origin:bottom;transition:transform 1s;width:100%}.scrollbarPage____hash_base64_5_[data-type=loaded]{transform:scaleY(0)}.scrollbarPage____hash_base64_5_[data-upscale]{background-color:#b39ddb;transform:scaleY(1)}.scrollbarPage____hash_base64_5_[data-upscale=loading]{background-color:#d1c4e9}.scrollbarPage____hash_base64_5_[data-translation-type]{background-color:initial;transform:scaleY(1);transform-origin:top}.scrollbarPage____hash_base64_5_[data-translation-type=wait]{background-color:#81c784}.scrollbarPage____hash_base64_5_[data-translation-type=show]{background-color:#4caf50}.scrollbarPage____hash_base64_5_[data-translation-type=error]{background-color:#f005}.scrollbarPage____hash_base64_5_[data-type=wait]{opacity:.4}.scrollbarPage____hash_base64_5_[data-type=error]{background-color:#f005}.scrollbarSlider____hash_base64_5_{background-color:#fff5;border-radius:1em;height:var(--slider-height);justify-content:center;opacity:1;position:absolute;transform:translateY(var(--slider-top));transition:transform .15s,opacity .15s;width:100%;z-index:1}.scrollbarPoper____hash_base64_5_{--poper-top:clamp(0%,calc(var(--slider-midpoint) - 50%),calc(var(--scroll-length) - 100%));background-color:#303030;border-radius:.3em;color:#fff;font-size:.8em;line-height:1.5em;min-height:1.5em;min-width:1em;padding:.2em .5em;position:absolute;right:2em;text-align:center;transform:translateY(var(--poper-top));white-space:pre;width:fit-content}.scrollbar____hash_base64_5_:before{background-color:initial;border:.4em solid #0000;border-left:.5em solid #303030;content:\\\"\\\";position:absolute;right:2em;transform:translate(140%,calc(var(--arrow-y) - 50%))}.scrollbarPoper____hash_base64_5_,.scrollbar____hash_base64_5_:before{opacity:0;transition:opacity .15s,transform .15s}:is(.scrollbar____hash_base64_5_:hover,.scrollbar____hash_base64_5_[data-force-show]) .scrollbarPoper____hash_base64_5_,:is(.scrollbar____hash_base64_5_:hover,.scrollbar____hash_base64_5_[data-force-show]) .scrollbarSlider____hash_base64_5_,:is(.scrollbar____hash_base64_5_:hover,.scrollbar____hash_base64_5_[data-force-show]):before{opacity:1}.scrollbar____hash_base64_5_[data-drag] .scrollbarPoper____hash_base64_5_,.scrollbar____hash_base64_5_[data-drag] .scrollbarSlider____hash_base64_5_,.scrollbar____hash_base64_5_[data-drag]:before{transition:opacity .15s}.scrollbar____hash_base64_5_[data-auto-hidden]:not([data-force-show]) .scrollbarSlider____hash_base64_5_{opacity:0}.scrollbar____hash_base64_5_[data-auto-hidden]:not([data-force-show]):hover .scrollbarSlider____hash_base64_5_{opacity:1}.scrollbar____hash_base64_5_[data-position=hidden]{display:none}.scrollbar____hash_base64_5_[data-position=top]{border-bottom:max(6vh,1em) solid #0000;top:1px}.scrollbar____hash_base64_5_[data-position=top]:before{border-bottom:.5em solid #303030;right:0;top:1.2em;transform:translate(var(--arrow-x),-120%)}.scrollbar____hash_base64_5_[data-position=top] .scrollbarPoper____hash_base64_5_{top:1.2em}.scrollbar____hash_base64_5_[data-position=bottom]{border-top:max(6vh,1em) solid #0000;bottom:1px;top:unset}.scrollbar____hash_base64_5_[data-position=bottom]:before{border-top:.5em solid #303030;bottom:1.2em;right:0;transform:translate(var(--arrow-x),120%)}.scrollbar____hash_base64_5_[data-position=bottom] .scrollbarPoper____hash_base64_5_{bottom:1.2em}.scrollbar____hash_base64_5_[data-position=bottom],.scrollbar____hash_base64_5_[data-position=top]{--arrow-x:calc(var(--arrow-y)*-1 + 50%);border-left:none;flex-direction:row-reverse;height:5px;right:1%;width:98%}:is(.scrollbar____hash_base64_5_[data-position=top],.scrollbar____hash_base64_5_[data-position=bottom]):before{border-left:.4em solid #0000}:is(.scrollbar____hash_base64_5_[data-position=top],.scrollbar____hash_base64_5_[data-position=bottom]) .scrollbarSlider____hash_base64_5_{height:100%;transform:translateX(calc(var(--slider-top)*-1));width:var(--slider-height)}:is(.scrollbar____hash_base64_5_[data-position=top],.scrollbar____hash_base64_5_[data-position=bottom]) .scrollbarPoper____hash_base64_5_{padding:.1em .3em;right:unset;transform:translateX(calc(var(--poper-top)*-1))}[data-dir=ltr]:is(.scrollbar____hash_base64_5_[data-position=top],.scrollbar____hash_base64_5_[data-position=bottom]){--arrow-x:calc(var(--arrow-y) - 50%);flex-direction:row}[data-dir=ltr]:is(.scrollbar____hash_base64_5_[data-position=top],.scrollbar____hash_base64_5_[data-position=bottom]):before{left:0;right:unset}[data-dir=ltr]:is(.scrollbar____hash_base64_5_[data-position=top],.scrollbar____hash_base64_5_[data-position=bottom]) .scrollbarSlider____hash_base64_5_{transform:translateX(var(--top))}[data-dir=ltr]:is(.scrollbar____hash_base64_5_[data-position=top],.scrollbar____hash_base64_5_[data-position=bottom]) .scrollbarPoper____hash_base64_5_{transform:translateX(var(--poper-top))}:is(.scrollbar____hash_base64_5_[data-position=top],.scrollbar____hash_base64_5_[data-position=bottom]) .scrollbarPage____hash_base64_5_{transform:scaleX(1)}[data-type=loaded]:is(:is(.scrollbar____hash_base64_5_[data-position=top],.scrollbar____hash_base64_5_[data-position=bottom]) .scrollbarPage____hash_base64_5_){transform:scaleX(0)}[data-translation-type]:is(:is(.scrollbar____hash_base64_5_[data-position=top],.scrollbar____hash_base64_5_[data-position=bottom]) .scrollbarPage____hash_base64_5_){transform:scaleX(1)}.scrollbar____hash_base64_5_[data-is-abreast-mode] .scrollbarPoper____hash_base64_5_{line-height:1.5em;text-orientation:upright;writing-mode:vertical-rl}.scrollbar____hash_base64_5_[data-is-abreast-mode][data-dir=ltr] .scrollbarPoper____hash_base64_5_{writing-mode:vertical-lr}.root____hash_base64_5_[data-scroll-mode] .scrollbar____hash_base64_5_:before,.root____hash_base64_5_[data-scroll-mode] :is(.scrollbarSlider____hash_base64_5_,.scrollbarPoper____hash_base64_5_){transition:opacity .15s}:is(.root____hash_base64_5_[data-mobile] .scrollbar____hash_base64_5_:hover) .scrollbarPoper____hash_base64_5_,:is(.root____hash_base64_5_[data-mobile] .scrollbar____hash_base64_5_:hover):before{opacity:0}.touchAreaRoot____hash_base64_5_{color:#fff;display:grid;font-size:3em;grid-template-columns:1fr min(30%,10em) 1fr;grid-template-rows:1fr min(20%,10em) 1fr;height:100%;letter-spacing:.5em;opacity:0;pointer-events:none;position:absolute;top:0;transition:opacity .4s;-webkit-user-select:none;user-select:none;width:100%}.touchAreaRoot____hash_base64_5_[data-show]{opacity:1}.touchAreaRoot____hash_base64_5_ .touchArea____hash_base64_5_{align-items:center;display:flex;justify-content:center;text-align:center}[data-area=PREV]:is(.touchAreaRoot____hash_base64_5_ .touchArea____hash_base64_5_),[data-area=prev]:is(.touchAreaRoot____hash_base64_5_ .touchArea____hash_base64_5_){background-color:#95e1d3e6}[data-area=MENU]:is(.touchAreaRoot____hash_base64_5_ .touchArea____hash_base64_5_),[data-area=menu]:is(.touchAreaRoot____hash_base64_5_ .touchArea____hash_base64_5_){background-color:#fce38ae6}[data-area=NEXT]:is(.touchAreaRoot____hash_base64_5_ .touchArea____hash_base64_5_),[data-area=next]:is(.touchAreaRoot____hash_base64_5_ .touchArea____hash_base64_5_){background-color:#f38181e6}[data-area=PREV]:is(.touchAreaRoot____hash_base64_5_ .touchArea____hash_base64_5_):after{content:var(--i18n-touch-area-prev)}[data-area=MENU]:is(.touchAreaRoot____hash_base64_5_ .touchArea____hash_base64_5_):after{content:var(--i18n-touch-area-menu)}[data-area=NEXT]:is(.touchAreaRoot____hash_base64_5_ .touchArea____hash_base64_5_):after{content:var(--i18n-touch-area-next)}.touchAreaRoot____hash_base64_5_[data-vert=true]{flex-direction:column!important}.touchAreaRoot____hash_base64_5_:not([data-turn-page]) .touchArea____hash_base64_5_[data-area=NEXT],.touchAreaRoot____hash_base64_5_:not([data-turn-page]) .touchArea____hash_base64_5_[data-area=PREV],.touchAreaRoot____hash_base64_5_:not([data-turn-page]) .touchArea____hash_base64_5_[data-area=next],.touchAreaRoot____hash_base64_5_:not([data-turn-page]) .touchArea____hash_base64_5_[data-area=prev]{visibility:hidden}.touchAreaRoot____hash_base64_5_[data-shrink-menu]{grid-template-columns:1fr 2em 1fr}.touchAreaRoot____hash_base64_5_[data-shrink-menu] .touchArea____hash_base64_5_[data-area=MENU]{letter-spacing:0}.root____hash_base64_5_[data-mobile] .touchAreaRoot____hash_base64_5_{flex-direction:column!important;letter-spacing:0}.root____hash_base64_5_[data-mobile] [data-area]:after{font-size:.8em}.root____hash_base64_5_{background-color:var(--bg);font-size:1em;height:100%;outline:0;overflow:hidden;position:relative;width:100%}.root____hash_base64_5_ a{color:var(--text-secondary)}.root____hash_base64_5_[data-mobile]{font-size:.8em}.hidden____hash_base64_5_{display:none!important}.invisible____hash_base64_5_{visibility:hidden!important}.beautifyScrollbar____hash_base64_5_{scrollbar-color:var(--scrollbar-slider) #0000;scrollbar-width:thin}.beautifyScrollbar____hash_base64_5_::-webkit-scrollbar{height:10px;width:5px}.beautifyScrollbar____hash_base64_5_::-webkit-scrollbar-track{background:#0000}.beautifyScrollbar____hash_base64_5_::-webkit-scrollbar-thumb{background:var(--scrollbar-slider)}img,p{margin:0}:where(div,div:focus,div:focus-within,div:focus-visible,button){border:none;outline:none}blockquote{border-left:.25em solid var(--text-secondary,#607d8b);color:var(--text-secondary);font-size:.9em;font-style:italic;line-height:1.2em;margin:.5em 0;overflow-wrap:anywhere;padding:0 0 0 1em;text-align:start;white-space:pre-wrap}svg{width:1em}\";\nvar modules_c21c94f2$1 = {\"img\":\"img____hash_base64_5_\",\"mangaFlow\":\"mangaFlow____hash_base64_5_\",\"mangaBox\":\"mangaBox____hash_base64_5_\",\"root\":\"root____hash_base64_5_\",\"gridModeTip\":\"gridModeTip____hash_base64_5_\",\"endPage\":\"endPage____hash_base64_5_\",\"endPageBody\":\"endPageBody____hash_base64_5_\",\"tip\":\"tip____hash_base64_5_\",\"comments\":\"comments____hash_base64_5_\",\"toolbar\":\"toolbar____hash_base64_5_\",\"toolbarPanel\":\"toolbarPanel____hash_base64_5_\",\"toolbarBg\":\"toolbarBg____hash_base64_5_\",\"SettingPanelPopper\":\"SettingPanelPopper____hash_base64_5_\",\"SettingPanel\":\"SettingPanel____hash_base64_5_\",\"SettingBlock\":\"SettingBlock____hash_base64_5_\",\"SettingBlockBody\":\"SettingBlockBody____hash_base64_5_\",\"SettingBlockSubtitle\":\"SettingBlockSubtitle____hash_base64_5_\",\"SettingsItem\":\"SettingsItem____hash_base64_5_\",\"SettingsShowItem\":\"SettingsShowItem____hash_base64_5_\",\"SettingsItemName\":\"SettingsItemName____hash_base64_5_\",\"SettingsItemSwitch\":\"SettingsItemSwitch____hash_base64_5_\",\"SettingsItemSwitchRound\":\"SettingsItemSwitchRound____hash_base64_5_\",\"SettingsItemIconButton\":\"SettingsItemIconButton____hash_base64_5_\",\"SettingsItemSelect\":\"SettingsItemSelect____hash_base64_5_\",\"closeCover\":\"closeCover____hash_base64_5_\",\"SettingsShowItemBody\":\"SettingsShowItemBody____hash_base64_5_\",\"hotkeys\":\"hotkeys____hash_base64_5_\",\"hotkeysItem\":\"hotkeysItem____hash_base64_5_\",\"hotkeysHeader\":\"hotkeysHeader____hash_base64_5_\",\"scrollbar\":\"scrollbar____hash_base64_5_\",\"scrollbarPage\":\"scrollbarPage____hash_base64_5_\",\"scrollbarSlider\":\"scrollbarSlider____hash_base64_5_\",\"scrollbarPoper\":\"scrollbarPoper____hash_base64_5_\",\"touchAreaRoot\":\"touchAreaRoot____hash_base64_5_\",\"touchArea\":\"touchArea____hash_base64_5_\",\"hidden\":\"hidden____hash_base64_5_\",\"invisible\":\"invisible____hash_base64_5_\",\"beautifyScrollbar\":\"beautifyScrollbar____hash_base64_5_\"};\n\nlet clickTimeout = null;\nconst useDoubleClick = (click, doubleClick, timeout = 200) => event => {\n  // å¦‚æœç‚¹å‡»è§¦å‘æ—¶è¿˜æœ‰ä¸Šæ¬¡è®¡æ—¶å™¨çš„è®°å½•ï¼Œè¯´æ˜è¿™æ¬¡æ˜¯åŒå‡»\n  if (clickTimeout) {\n    clearTimeout(clickTimeout);\n    clickTimeout = null;\n    doubleClick?.(event);\n    return;\n  }\n\n  // å•å‡»äº‹ä»¶å»¶è¿Ÿè§¦å‘\n  clickTimeout = window.setTimeout(() => {\n    click(event);\n    clickTimeout = null;\n  }, timeout);\n};\n\nlet cache = undefined;\nconst initCache = async () => {\n  cache ||= await helper.useCache({\n    progress: 'id'\n  }, 'ReadProgress');\n};\nlet lastIndex = -1;\n/** ä¿å­˜é˜…è¯»è¿›åº¦ */\nconst saveReadProgress = helper.throttle(async () => {\n  await initCache();\n  const index = activeImgIndex();\n  if (index === lastIndex) return;\n  lastIndex = index;\n  if (\n  // åªä¿å­˜ 50 é¡µä»¥ä¸Šæ¼«ç”»çš„è¿›åº¦\n  store.imgList.length < 50 ||\n  // ç¿»åˆ°æœ€åå‡ é¡µæ—¶ä¸ä¿å­˜\n  index >= store.imgList.length - 5) return await cache.del('progress', location.pathname);\n  const imgSize = {};\n  for (const [i, img] of imgList().entries()) if (img.width && img.height) imgSize[i] = [img.width, img.height];\n  await cache.set('progress', {\n    id: location.pathname,\n    time: Date.now(),\n    index,\n    imgSize,\n    fillEffect: store$1.unwrap(store.fillEffect)\n  });\n}, 1000);\n\n/** æ¢å¤é˜…è¯»è¿›åº¦ */\nconst resumeReadProgress = async state => {\n  await initCache();\n  const progress = await cache.get('progress', location.pathname);\n  if (!progress) return;\n\n  // ç›®å‰å·è½´æ¨¡å¼ä¸‹æ— æ³•é¿å…å› å›¾ç‰‡åŠ è½½å¯¼è‡´çš„æŠ–åŠ¨ï¼Œ\n  // ä¸ºäº†é¿å…åœ¨æ¢å¤é˜…è¯»è¿›åº¦æ—¶å‡ºç°é—®é¢˜ï¼Œåªèƒ½å°†å›¾ç‰‡æ˜¾ç¤ºç›¸å…³çš„æ•°æ®ä¹Ÿå­˜ç€ç”¨äºæ¢å¤\n  let i = state.imgList.length;\n  while (i--) {\n    const imgSize = progress.imgSize[i];\n    if (imgSize) updateImgSize(state.imgList[i], ...imgSize);\n  }\n  state.fillEffect = progress.fillEffect;\n  updatePageData(state);\n  if (state.option.scrollMode.enabled) setTimeout(scrollViewImg, 500, progress.index);else jumpToImg(progress.index);\n\n  // æ¸…é™¤è¿‡æ—¶çš„è¿›åº¦\n  const nowTime = Date.now();\n  cache.each('progress', async (data, cursor) => {\n    if (nowTime - data.time < 1000 * 60 * 60 * 24 * 29) return;\n    await helper.promisifyRequest(cursor.delete());\n  });\n};\n\n/** å°†é¡µé¢ç§»å›åŸä½ */\nconst resetPage = (state, animation = false) => {\n  updateShowRange(state);\n  state.page.offset.x.pct = 0;\n  state.page.offset.y.pct = 0;\n  if (state.option.scrollMode.enabled) {\n    state.page.anima = '';\n    return;\n  }\n  let i = -1;\n  if (helper.inRange(state.renderRange[0], state.activePageIndex, state.renderRange[1])) i = state.activePageIndex - state.renderRange[0];\n  if (store.page.vertical) state.page.offset.y.pct = i === -1 ? 0 : -i;else state.page.offset.x.pct = i === -1 ? 0 : i;\n  state.page.anima = animation ? 'page' : '';\n};\n\n/** è·å–æŒ‡å®šå›¾ç‰‡çš„æç¤ºæ–‡æœ¬ */\nconst getImgTip = i => {\n  if (i === -1) return helper.t('other.fill_page');\n  const img = getImg(i);\n\n  // å¦‚æœå›¾ç‰‡æœªåŠ è½½å®Œæ¯•åˆ™åœ¨å…¶ index åå¢åŠ æ˜¾ç¤ºå½“å‰åŠ è½½çŠ¶æ€\n  if (img.loadType !== 'loaded') return `${i + 1} (${helper.t(`img_status.${img.loadType}`)})`;\n  if (img.translationType && img.translationType !== 'hide' && img.translationMessage) return `${i + 1}ï¼š${img.translationMessage}`;\n  if (isUpscale() && img.upscaleUrl !== undefined) return `${i + 1} (${img.upscaleUrl ? helper.t('upscale.upscaled') : helper.t('upscale.upscaling')})`;\n  return `${i + 1}`;\n};\n\n/** è·å–æŒ‡å®šé¡µé¢çš„æç¤ºæ–‡æœ¬ */\nconst getPageTip = pageIndex => {\n  const page = store.pageList[pageIndex];\n  if (!page) return 'null';\n  const pageIndexText = page.map(index => getImgTip(index));\n  if (pageIndexText.length === 1) return pageIndexText[0];\n  if (store.option.dir === 'rtl') pageIndexText.reverse();\n  return pageIndexText.join(' | ');\n};\nhelper.createEffectOn(() => store.activePageIndex, () => store.show.endPage && setState('show', 'endPage', undefined), {\n  defer: true\n});\nhelper.createEffectOn(activePage, helper.throttle(() => store.isDragMode || setState(resetPage)));\n\n// åœ¨å…³é—­å·¥å…·æ çš„åŒæ—¶å…³æ‰æ»šåŠ¨æ¡çš„å¼ºåˆ¶æ˜¾ç¤º\nhelper.createEffectOn(() => store.show.toolbar, () => store.show.scrollbar && !store.show.toolbar && setState('show', 'scrollbar', false), {\n  defer: true\n});\n\n// åœ¨åˆ‡æ¢ç½‘æ ¼æ¨¡å¼åå…³æ‰ æ»šåŠ¨æ¡å’Œå·¥å…·æ  çš„å¼ºåˆ¶æ˜¾ç¤º\nhelper.createEffectOn(() => store.gridMode, () => setState(resetUI), {\n  defer: true\n});\n\n/** å¤„ç†å°½å¤´ç¿»é¡µã€‚è¿”å›å½“å‰æ˜¯å¦å·²æŠµè¾¾å°½å¤´ */\nconst handleEndTurnPage = withOptionalState((dir, state) => {\n  if (dir === 'prev') {\n    switch (state.show.endPage) {\n      case 'start':\n        if (state.scrollLock || store.option.scroolEnd !== 'auto') return true;\n        state.prop.onPrev?.();\n        return true;\n      case 'end':\n        state.show.endPage = undefined;\n        return true;\n      default:\n        // å¼¹å‡ºå·é¦–ç»“æŸé¡µ\n        if (isTop()) {\n          if (state.scrollLock) return true;\n          if (!state.prop.onExit || !state.prop.onPrev || store.option.scroolEnd !== 'auto') return true;\n          state.show.endPage = 'start';\n          return true;\n        }\n    }\n  } else {\n    switch (state.show.endPage) {\n      case 'end':\n        if (state.scrollLock || store.option.scroolEnd === 'none') return true;\n        if (store.option.scroolEnd === 'auto' && state.prop.onNext) state.prop.onNext();else state.prop.onExit?.(true);\n        return true;\n      case 'start':\n        state.show.endPage = undefined;\n        return true;\n      default:\n        // å¼¹å‡ºå·å°¾ç»“æŸé¡µ\n        if (isBottom()) {\n          if (state.scrollLock) return true;\n          if (!state.prop.onExit) return true;\n          state.show.endPage = 'end';\n          return true;\n        }\n    }\n  }\n  return false;\n});\n\n/** ç¿»é¡µã€‚è¿”å›æ˜¯å¦æˆåŠŸæ”¹å˜äº†å½“å‰é¡µæ•° */\nconst turnPage = withOptionalState((dir, state) => {\n  if (state.gridMode || state.option.scrollMode.enabled) return false;\n  if (handleEndTurnPage(dir, state)) return false;\n  saveReadProgress();\n  state.activePageIndex += dir === 'next' ? 1 : -1;\n  return true;\n});\nconst turnPageAnimation = dir => {\n  setState(state => {\n    // æ— æ³•ç¿»é¡µå°±æ¢å¤åŸä½\n    if (!turnPage(dir, state)) {\n      state.page.offset.x.px = 0;\n      state.page.offset.y.px = 0;\n      resetPage(state, true);\n      state.isDragMode = false;\n      return;\n    }\n    state.isDragMode = true;\n    resetPage(state);\n    if (store.page.vertical) state.page.offset.y.pct += dir === 'next' ? 1 : -1;else state.page.offset.x.pct += dir === 'next' ? -1 : 1;\n    setTimeout(() => {\n      setState(draftState => {\n        resetPage(draftState, true);\n        draftState.page.offset.x.px = 0;\n        draftState.page.offset.y.px = 0;\n        draftState.isDragMode = false;\n      });\n    }, 16);\n  });\n};\n\n/** åˆ¤æ–­ç¿»é¡µæ–¹å‘ */\nconst getTurnPageDir = (move, total, startTime) => {\n  let dir;\n\n  // å¤„ç†æ— å…³é€Ÿåº¦ä¸è€ƒè™‘æ—¶é—´å•çº¯æ ¹æ®å½“å‰æ»šåŠ¨è·ç¦»æ¥åˆ¤æ–­çš„æƒ…å†µ\n  if (!startTime) {\n    if (Math.abs(move) > total / 2) dir = move > 0 ? 'next' : 'prev';\n    return dir;\n  }\n\n  // æ»‘åŠ¨è·ç¦»è¶…è¿‡æ€»é•¿åº¦ä¸‰åˆ†ä¹‹ä¸€åˆ¤å®šç¿»é¡µ\n  if (Math.abs(move) > total / 3) dir = move > 0 ? 'next' : 'prev';\n  if (dir) return dir;\n\n  // æ»‘åŠ¨é€Ÿåº¦è¶…è¿‡ 0.4 åˆ¤å®šç¿»é¡µ\n  const velocity = move / (performance.now() - startTime);\n  if (velocity < -0.4) dir = 'prev';\n  if (velocity > 0.4) dir = 'next';\n  return dir;\n};\n\nconst touches = new Map();\nconst bound = helper.createMemoMap({\n  x: () => -store.rootSize.width * (store.option.zoom.ratio / 100 - 1),\n  y: () => -store.rootSize.height * (store.option.zoom.ratio / 100 - 1)\n});\nconst checkBound = state => {\n  state.option.zoom.offset.x = helper.clamp(bound().x, state.option.zoom.offset.x, 0);\n  state.option.zoom.offset.y = helper.clamp(bound().y, state.option.zoom.offset.y, 0);\n};\nconst zoom = (val, focal, animation = false) => {\n  const newScale = helper.clamp(100, val, 300);\n  if (newScale === store.option.zoom.ratio) return;\n\n  // æ¶ˆé™¤æ”¾å¤§å¯¼è‡´çš„åç§»\n  const {\n    left,\n    top\n  } = refs.mangaBox.getBoundingClientRect();\n  const x = (focal?.x ?? store.rootSize.width / 2) - left;\n  const y = (focal?.y ?? store.rootSize.height / 2) - top;\n\n  // å½“å‰ç›´æ¥æ”¾å¤§åçš„åŸºå‡†ç‚¹åæ ‡\n  const newX = x / (store.option.zoom.ratio / 100) * (newScale / 100);\n  const newY = y / (store.option.zoom.ratio / 100) * (newScale / 100);\n\n  // æ”¾å¤§ååŸºå‡†ç‚¹çš„åç§»è·ç¦»\n  const dx = newX - x;\n  const dy = newY - y;\n  setOption((draftOption, state) => {\n    draftOption.zoom.ratio = newScale;\n    draftOption.zoom.offset.x -= dx;\n    draftOption.zoom.offset.y -= dy;\n    checkBound(state);\n    if (animation) state.page.anima = 'zoom';\n  });\n};\n\n//\n// æƒ¯æ€§æ»‘åŠ¨\n//\n\n/** æ‘©æ“¦ç³»æ•° */\nconst FRICTION_COEFF$1 = 0.91;\nconst mouse = {\n  x: 0,\n  y: 0\n};\nconst last = {\n  x: 0,\n  y: 0\n};\nconst velocity = {\n  x: 0,\n  y: 0\n};\nlet animationId$2 = null;\nconst cancelAnimation = () => {\n  if (!animationId$2) return;\n  cancelAnimationFrame(animationId$2);\n  animationId$2 = null;\n};\nlet lastTime$1 = 0;\n\n/** é€å¸§è®¡ç®—æƒ¯æ€§æ»‘åŠ¨ */\nconst handleSlideAnima = timestamp => {\n  // å½“é€Ÿç‡è¶³å¤Ÿå°æ—¶åœæ­¢è®¡ç®—åŠ¨ç”»\n  if (helper.approx(velocity.x, 0, 1) && helper.approx(velocity.y, 0, 1)) {\n    animationId$2 = null;\n    return;\n  }\n\n  // åœ¨æ‹–æ‹½åæ¨¡æ‹Ÿæƒ¯æ€§æ»‘åŠ¨\n  setOption((draftOption, state) => {\n    draftOption.zoom.offset.x += velocity.x;\n    draftOption.zoom.offset.y += velocity.y;\n    checkBound(state);\n\n    // ç¡®ä¿æ¯16æ¯«ç§’æ‰å‡å°‘ä¸€æ¬¡é€Ÿç‡ï¼Œé˜²æ­¢åœ¨é«˜åˆ·æ–°ç‡æ˜¾ç¤ºå™¨ä¸Šè¡°å‡è¿‡å¿«\n    if (timestamp - lastTime$1 > 16) {\n      velocity.x *= FRICTION_COEFF$1;\n      velocity.y *= FRICTION_COEFF$1;\n      lastTime$1 = timestamp;\n    }\n  });\n  animationId$2 = requestAnimationFrame(handleSlideAnima);\n};\n\n/** é€å¸§æ ¹æ®é¼ æ ‡åæ ‡ç§»åŠ¨å…ƒç´ ï¼Œå¹¶è®¡ç®—é€Ÿç‡ */\nconst handleDragAnima$1 = () => {\n  // å½“åœç€ä¸åŠ¨æ—¶é€€å‡ºå¾ªç¯\n  if (mouse.x === store.option.zoom.offset.x && mouse.y === store.option.zoom.offset.y) {\n    animationId$2 = null;\n    return;\n  }\n  setOption((draftOption, state) => {\n    last.x = draftOption.zoom.offset.x;\n    last.y = draftOption.zoom.offset.y;\n    draftOption.zoom.offset.x = mouse.x;\n    draftOption.zoom.offset.y = mouse.y;\n    checkBound(state);\n    velocity.x = draftOption.zoom.offset.x - last.x;\n    velocity.y = draftOption.zoom.offset.y - last.y;\n  });\n  animationId$2 = requestAnimationFrame(handleDragAnima$1);\n};\n\n/** ä¸€æ®µæ—¶é—´æ²¡æœ‰ç§»åŠ¨ååº”è¯¥å°†é€Ÿç‡å½’é›¶ */\nconst resetVelocity = helper.debounce(() => {\n  velocity.x = 0;\n  velocity.y = 0;\n}, 200);\n\n/** æ˜¯å¦æ­£åœ¨åŒæŒ‡æåˆç¼©æ”¾ä¸­ */\nlet pinchZoom = false;\n\n/** å¤„ç†æ”¾å¤§åçš„æ‹–æ‹½ç§»åŠ¨ */\nconst handleZoomDrag = ({\n  type,\n  xy: [x, y],\n  last: [lx, ly]\n}) => {\n  if (store.option.zoom.ratio === 100) return;\n  switch (type) {\n    case 'down':\n      {\n        mouse.x = store.option.zoom.offset.x;\n        mouse.y = store.option.zoom.offset.y;\n        if (animationId$2) cancelAnimation();\n        break;\n      }\n    case 'move':\n      {\n        if (animationId$2) cancelAnimation();\n        mouse.x += x - lx;\n        mouse.y += y - ly;\n        animationId$2 ??= requestAnimationFrame(handleDragAnima$1);\n        resetVelocity();\n        break;\n      }\n    case 'up':\n      {\n        resetVelocity.clear();\n\n        // å½“åŒæŒ‡æåˆç»“æŸï¼Œä¸€ä¸ªæ‰‹æŒ‡æŠ¬èµ·æ—¶ï¼Œå°†å‰©ä½™çš„æŒ‡é’ˆå½“ä½œåˆšç‚¹å‡»æ¥å¤„ç†\n        if (pinchZoom) {\n          pinchZoom = false;\n          mouse.x = store.option.zoom.offset.x;\n          mouse.y = store.option.zoom.offset.y;\n          return;\n        }\n        if (animationId$2) cancelAnimationFrame(animationId$2);\n        animationId$2 = requestAnimationFrame(handleSlideAnima);\n      }\n  }\n};\n\n//\n// åŒæŒ‡æåˆç¼©æ”¾\n//\n\n/** åˆå§‹åŒæŒ‡è·ç¦» */\nlet initDistance = 0;\n/** åˆå§‹ç¼©æ”¾æ¯”ä¾‹ */\nlet initScale = 100;\n\n/** è·å–ä¸¤ä¸ªæŒ‡é’ˆä¹‹é—´çš„è·ç¦» */\nconst getDistance = (a, b) => Math.hypot(b.xy[0] - a.xy[0], b.xy[1] - a.xy[1]);\n\n/** é€å¸§è®¡ç®—å½“å‰å±å¹•ä¸Šä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œå¹¶æ¢ç®—æˆç¼©æ”¾æ¯”ä¾‹ */\nconst handlePinchZoomAnima = () => {\n  if (touches.size < 2) {\n    animationId$2 = null;\n    return;\n  }\n  const [a, b] = [...touches.values()];\n  const distance = getDistance(a, b);\n  zoom(distance / initDistance * initScale, {\n    x: (a.xy[0] + b.xy[0]) / 2,\n    y: (a.xy[1] + b.xy[1]) / 2\n  });\n  animationId$2 = requestAnimationFrame(handlePinchZoomAnima);\n};\n\n/** å¤„ç†åŒæŒ‡æåˆç¼©æ”¾ */\nconst handlePinchZoom = ({\n  type\n}) => {\n  if (touches.size < 2) return;\n  switch (type) {\n    case 'down':\n      {\n        pinchZoom = true;\n        const [a, b] = [...touches.values()];\n        initDistance = getDistance(a, b);\n        initScale = store.option.zoom.ratio;\n        break;\n      }\n    case 'up':\n      {\n        const [a, b] = [...touches.values()];\n        initDistance = getDistance(a, b);\n        break;\n      }\n    case 'move':\n      {\n        animationId$2 ??= requestAnimationFrame(handlePinchZoomAnima);\n        break;\n      }\n    case 'cancel':\n      {\n        const [a, b] = [...touches.values()];\n        initDistance = getDistance(a, b);\n        break;\n      }\n  }\n};\n\nconst _scrollTo = top => {\n  const val = helper.clamp(0, top, contentHeight() - store.rootSize.height);\n  refs.mangaBox.scrollTo({\n    top: val,\n    behavior: 'instant'\n  });\n  setState(state => {\n    state.scrollTop = val;\n    openScrollLock(state);\n  });\n};\n/** åœ¨å·è½´æ¨¡å¼ä¸‹æ»šåŠ¨åˆ°æŒ‡å®šè¿›åº¦ */\nconst scrollTo = (x, smooth = false) => {\n  if (!store.option.scrollMode.enabled) return;\n  if (store.option.scrollMode.abreastMode) {\n    _scrollTo(0);\n    const val = helper.clamp(0, x, abreastScrollWidth());\n    return setState('page', 'offset', 'x', 'px', val);\n  }\n  if (!smooth) {\n    scrollStep.cancel();\n    return _scrollTo(x);\n  }\n  if (scrollStep.animationId) {\n    scrollStep.cancel();\n    _scrollTo(x);\n  }\n  scrollStep.start(x);\n};\n\n/** åœ¨å·è½´æ¨¡å¼ä¸‹æ»šåŠ¨æŒ‡å®šè¿›åº¦ */\nconst scrollBy = (offset, smooth = false) => {\n  if (!store.option.scrollMode.enabled) return;\n  if (handleEndTurnPage(offset > 0 ? 'next' : 'prev')) return;\n  return scrollTo(scrollTop() + offset, smooth);\n};\n\n/** å®ç°å·è½´æ¨¡å¼ä¸‹çš„å¹³æ»‘æ»šåŠ¨ */\nconst scrollStep = new class extends helper.AnimationFrame {\n  /** åŠ¨ç”»æ—¶é•¿ */\n  duration = 100;\n  /** è¦æ»šåŠ¨çš„è·ç¦» */\n  distance = 0;\n  /** æ»šåŠ¨å¼€å§‹æ—¶é—´ */\n  startTime = 0;\n  /** æ»šåŠ¨å¼€å§‹ä½ç½® */\n  startTop = 0;\n  scrollTo = top => {\n    if (helper.inRange(0, top, scrollLength())) scrollTo(top);else this.cancel();\n  };\n  frame = timestamp => {\n    this.cancel();\n    this.startTime ||= timestamp;\n    /** å·²æ»šåŠ¨æ—¶é—´ */\n    const elapsed = timestamp - this.startTime;\n    if (elapsed >= this.duration) return this.scrollTo(this.startTop + this.distance);\n    this.scrollTo(this.startTop + elapsed / this.duration * this.distance);\n    this.call();\n  };\n  start = x => {\n    this.startTime = 0;\n    this.startTop = scrollTop();\n    this.distance = x - this.startTop;\n    this.frame(0);\n  };\n}();\n\n/** å®ç°å·è½´æ¨¡å¼ä¸‹çš„åŒ€é€Ÿæ»šåŠ¨ */\nconst constantScroll = new class extends helper.AnimationFrame {\n  speed = 0;\n  lastTime = 0;\n  scrollTo = top => {\n    if (helper.inRange(0, top, scrollLength())) scrollTo(top);else this.cancel();\n  };\n  frame = timestamp => {\n    if (!this.animationId) return;\n    if (this.lastTime) {\n      const scrollDelta = this.speed * (timestamp - this.lastTime);\n      this.scrollTo(scrollTop() + scrollDelta);\n    }\n    this.lastTime = timestamp;\n    this.call();\n  };\n  start = speed => {\n    if (this.animationId && speed === this.speed) return;\n    this.cancel();\n    this.speed = speed;\n    this.lastTime = 0;\n    this.call();\n  };\n}();\n\n/** ä¿å­˜å½“å‰æ»šåŠ¨è¿›åº¦ï¼Œå¹¶åœ¨ä¹‹åæ¢å¤ */\nconst saveScrollProgress = () => {\n  const oldScrollPercentage = scrollPercentage();\n  return () => scrollTo(oldScrollPercentage * scrollLength());\n};\n\n/** åœ¨å·è½´æ¨¡å¼ä¸‹ï¼Œæ»šåŠ¨åˆ°èƒ½æ˜¾ç¤ºæŒ‡å®šå›¾ç‰‡çš„ä½ç½® */\nconst scrollViewImg = i => {\n  if (!store.option.scrollMode.enabled) return;\n  let top;\n  if (store.option.scrollMode.abreastMode) {\n    const columnNum = abreastArea().columns.findIndex(column => column.includes(i));\n    top = columnNum * abreastColumnWidth() + 1;\n  } else top = pageTopList()[i] + 1;\n  scrollTo(top);\n};\n\n/** è·³è½¬åˆ°æŒ‡å®šå›¾ç‰‡çš„æ˜¾ç¤ºä½ç½® */\nconst jumpToImg = index => {\n  zoom(100);\n  setState('gridMode', false);\n  if (store.option.scrollMode.enabled) return scrollViewImg(index);\n  const pageNum = imgPageMap()[index];\n  if (pageNum === undefined) return;\n  setState(state => {\n    state.activePageIndex = pageNum;\n    state.gridMode = false;\n  });\n};\n\n/** æ ¹æ®åæ ‡æ‰¾å‡ºè¢«ç‚¹å‡»åˆ°çš„å…ƒç´  */\nconst findClickEle = (eleList, {\n  x,\n  y\n}) => {\n  for (const e of eleList) {\n    const rect = e.getBoundingClientRect();\n    if (helper.inRange(rect.left, x, rect.right) && helper.inRange(rect.top, y, rect.bottom)) return e;\n  }\n};\n\n/** è§¦å‘ç‚¹å‡»åŒºåŸŸæ“ä½œ */\nconst handlePageClick = e => {\n  // ç‚¹å‡»å‡ºé”™çš„å›¾ç‰‡å¯ä»¥ç«‹åˆ»é‡æ–°åŠ è½½\n  for (const i of showImgList()) {\n    const img = getImg(i);\n    if (img.loadType !== 'error') continue;\n    const imgEle = getImgEle(i);\n    if (!imgEle || !findClickEle([imgEle], e)) continue;\n    return reloadImg(img.src);\n  }\n  const targetArea = findClickEle(refs.touchArea.children, e);\n  if (!targetArea || getComputedStyle(targetArea).visibility === 'hidden') return;\n  const areaName = targetArea.dataset.area;\n  if (!areaName) return;\n  if (areaName === 'menu' || areaName === 'MENU') return setState(state => {\n    state.show.scrollbar = !state.show.scrollbar;\n    state.show.toolbar = !state.show.toolbar;\n  });\n  setState(state => {\n    resetUI(state);\n    switch (areaName) {\n      case 'NEXT':\n      case 'next':\n        return handleHotkey('page_down');\n      case 'PREV':\n      case 'prev':\n        return handleHotkey('page_up');\n    }\n  });\n};\n\n/** ç½‘æ ¼æ¨¡å¼ä¸‹ç‚¹å‡»å›¾ç‰‡è·³åˆ°å¯¹åº”é¡µ */\nconst handleGridClick = e => {\n  const target = findClickEle(refs.root.getElementsByClassName(modules_c21c94f2$1.img), e);\n  if (target) jumpToImg(Number(/_(\\d+)_/.exec(target.id)?.[1]));\n};\n\n/** åŒå‡»æ”¾å¤§ */\nconst doubleClickZoom = e => !store.gridMode && zoom(store.option.zoom.ratio === 100 ? 350 : 100, e, true);\nconst handleClick = useDoubleClick(e => store.gridMode ? handleGridClick(e) : handlePageClick(e), doubleClickZoom);\nlet dx$1 = 0;\nlet dy$1 = 0;\nlet animationId$1 = null;\nconst handleDragAnima = () => {\n  // å½“åœç€ä¸åŠ¨æ—¶é€€å‡ºå¾ªç¯\n  if (dx$1 === store.page.offset.x.px && dy$1 === store.page.offset.y.px) {\n    animationId$1 = null;\n    return;\n  }\n  setState(state => {\n    if (state.page.vertical) state.page.offset.y.px = dy$1;else state.page.offset.x.px = dx$1;\n  });\n  animationId$1 = requestAnimationFrame(handleDragAnima);\n};\nconst handleDragEnd = startTime => {\n  dx$1 = 0;\n  dy$1 = 0;\n  if (animationId$1) {\n    cancelAnimationFrame(animationId$1);\n    animationId$1 = null;\n  }\n\n  // å°†æ‹–åŠ¨çš„é¡µé¢ç§»å›æ­£å¸¸ä½ç½®\n  const dir = store.page.vertical ? getTurnPageDir(-store.page.offset.y.px, store.rootSize.height, startTime) : getTurnPageDir(store.page.offset.x.px, store.rootSize.width, startTime);\n  if (dir) return turnPageAnimation(dir);\n  setState(state => {\n    state.page.offset.x.px = 0;\n    state.page.offset.y.px = 0;\n    state.page.anima = 'page';\n    state.isDragMode = false;\n  });\n};\nhandleDragEnd.debounce = helper.debounce(handleDragEnd, 200);\nconst handleMangaFlowDrag = ({\n  type,\n  xy: [x, y],\n  initial: [ix, iy],\n  startTime\n}) => {\n  switch (type) {\n    case 'move':\n      {\n        dx$1 = store.option.dir === 'rtl' ? x - ix : ix - x;\n        dy$1 = y - iy;\n        if (store.isDragMode) {\n          animationId$1 ||= requestAnimationFrame(handleDragAnima);\n          return;\n        }\n\n        // åˆ¤æ–­æ»‘åŠ¨æ–¹å‘\n        let slideDir;\n        const dxAbs = Math.abs(dx$1);\n        const dyAbs = Math.abs(dy$1);\n        if (dxAbs > 5 && dyAbs < 5) slideDir = 'horizontal';\n        if (dyAbs > 5 && dxAbs < 5) slideDir = 'vertical';\n        if (!slideDir) return;\n        setState(state => {\n          // æ ¹æ®æ»‘åŠ¨æ–¹å‘è‡ªåŠ¨åˆ‡æ¢æ’åˆ—æ¨¡å¼\n          state.page.vertical = slideDir === 'vertical';\n          state.isDragMode = true;\n          resetPage(state);\n        });\n        return;\n      }\n    case 'up':\n      return handleDragEnd(startTime);\n  }\n};\nlet lastDeltaY$1 = 0;\nlet retardStartTime = 0;\nconst handleTrackpadWheel = e => {\n  if (store.option.scrollMode.enabled) return;\n  openScrollLock();\n  let deltaY = Math.floor(-e.deltaY);\n  let absDeltaY = Math.abs(deltaY);\n\n  // åŠ é€Ÿåº¦å°äºæŒ‡å®šå€¼åé€æ¸ç¼©å°æ»šåŠ¨è·ç¦»ï¼Œå®ç°å‡é€Ÿæ•ˆæœ\n  if (Math.abs(absDeltaY - lastDeltaY$1) <= 6) {\n    retardStartTime ||= Date.now();\n    deltaY *= 1 - Math.min(1, (Date.now() - retardStartTime) / 10 * 0.002);\n    absDeltaY = Math.abs(deltaY);\n    if (absDeltaY < 2) return;\n  } else retardStartTime = 0;\n  lastDeltaY$1 = absDeltaY;\n  dy$1 += deltaY;\n  setState(state => {\n    // æ»šåŠ¨è¿‡ä¸€é¡µæ—¶\n    if (dy$1 <= -state.rootSize.height) {\n      if (turnPage('next', state)) dy$1 += state.rootSize.height;\n    } else if (dy$1 >= state.rootSize.height && turnPage('prev', state)) dy$1 -= state.rootSize.height;\n    state.page.vertical = true;\n    state.isDragMode = true;\n    resetPage(state);\n  });\n  animationId$1 ||= requestAnimationFrame(handleDragAnima);\n  handleDragEnd.debounce();\n};\n\n/** ä¿®æ”¹å·è½´æ¨¡å¼ä¸‹å›¾ç‰‡çš„ç›®æ ‡å®½åº¦ */\nconst setAdjustToWidth = val => {\n  if (typeof store.option.scrollMode.adjustToWidth !== 'number') return;\n  if (typeof val === 'function') val = val(store.option.scrollMode.adjustToWidth);\n  if (Number.isNaN(val)) return;\n  const jump = saveScrollProgress();\n  setOption(draftOption => {\n    const max = Math.ceil(store.rootSize.width);\n    draftOption.scrollMode.adjustToWidth = helper.clamp(200, val, max);\n  });\n  jump();\n};\nconst minImgWidth = helper.createRootMemo(() => {\n  let min = Number.POSITIVE_INFINITY;\n  for (const img of Object.values(store.imgMap)) if (img.width && img.width < min) min = img.width;\n  return min;\n});\n\n/** åœ¨å·è½´æ¨¡å¼ä¸‹è¿›è¡Œç¼©æ”¾ï¼Œå¹¶ä¸”ä¿æŒæ»šåŠ¨è¿›åº¦ä¸å˜ */\nconst setImgScale = val => {\n  if (typeof val === 'function') val = val(store.option.scrollMode.imgScale);\n  if (Number.isNaN(val)) return;\n  const jump = saveScrollProgress();\n  setOption(draftOption => {\n    val = helper.clamp(0.1, val, 3);\n\n    // å¦‚æœå½“å‰æœ€å°å›¾ç‰‡å®½åº¦å¤§äºè§†çª—å®½åº¦ï¼Œå¹¶ä¸”è¿™æ¬¡æ“ä½œæ˜¯åœ¨è°ƒå°ç¼©æ”¾å€¼\n    // é‚£å°±å°†è¿™æ¬¡æ“ä½œæ”¹ä¸ºï¼šå°†ç¼©æ”¾å€¼ä¿®æ”¹ä¸ºåªè¦ç¼©å°ä¸€ç‚¹å°±ä¼šç«‹åˆ»è®©å›¾ç‰‡å˜å°çš„æé™å€¼\n    // é¿å…ç”¨æˆ·éœ€è¦å¤šæ¬¡è°ƒå°ç¼©æ”¾å€¼æ‰èƒ½çœ‹åˆ°æ•ˆæœçš„æƒ…å†µ\n    // https://github.com/hymbz/ComicReadScript/issues/285\n    if (minImgWidth() > store.rootSize.width && val < draftOption.scrollMode.imgScale) {\n      const maxImgScale = store.rootSize.width / minImgWidth();\n      if (val > maxImgScale) val = maxImgScale;\n    }\n    draftOption.scrollMode.imgScale = helper.clamp(0.1, Number(val.toFixed(2)), 3);\n  });\n  jump();\n\n  // å¹¶æ’å·è½´æ¨¡å¼ä¸‹å¹¶æ²¡æœ‰ä¸€ä¸ªæ˜ç¡®ç›´è§‚çš„æ»šåŠ¨è¿›åº¦ï¼Œ\n  // ä¹Ÿæƒ³ä¸å‡ºæœ‰ä»€ä¹ˆå®ç°æ•ˆæœèƒ½å’Œæ™®é€šå·è½´æ¨¡å¼çš„æ•ˆæœä¸€è‡´,\n  // æ‰€ä»¥å°±æ‘†çƒ‚ä¸ç®¡äº†ï¼Œåæ­£ç°åœ¨è¿™æ ·ä¹Ÿå·²ç»èƒ½é¿å…ä¹±è·³äº†\n};\n\n/** å¤„ç†å·è½´æ¨¡å¼ä¸‹çš„æ”¾å¤§/ç¼©å°æ“ä½œ */\nconst handleScrollModeZoom = dir => {\n  if (!store.option.scrollMode.enabled) return;\n  if (store.option.scrollMode.adjustToWidth === 'full') return;\n  if (store.option.scrollMode.adjustToWidth === 'disable' || isAbreastMode()) setImgScale(val => val + 0.05 * (dir === 'add' ? 1 : -1));else setAdjustToWidth(val => val + 100 * (dir === 'add' ? 1 : -1));\n};\n\n/** åˆ‡æ¢é¡µé¢å¡«å…… */\nconst switchFillEffect = () => {\n  setState(state => {\n    // å¦‚æœå½“å‰é¡µä¸æ˜¯åŒé¡µæ˜¾ç¤ºçš„å°±è·³è¿‡ï¼Œé¿å…åœ¨æ˜¾ç¤ºè·¨é¡µå›¾çš„é¡µé¢åˆ‡æ¢å´æ²¡çœ‹åˆ°æ•ˆæœçš„ç–‘æƒ‘\n    if (state.pageList[state.activePageIndex].length !== 2) return;\n    state.fillEffect[nowFillIndex()] = Number(!state.fillEffect[nowFillIndex()]);\n    updatePageData(state);\n  });\n};\n\n/** åˆ‡æ¢å·è½´æ¨¡å¼ */\nconst switchScrollMode = () => {\n  const index = activeImgIndex();\n  zoom(100);\n  setOption((draftOption, state) => {\n    draftOption.scrollMode.enabled = !draftOption.scrollMode.enabled;\n    state.page.offset.x.px = 0;\n    state.page.offset.y.px = 0;\n  });\n  jumpToImg(index);\n};\n\n/** åˆ‡æ¢å•åŒé¡µæ¨¡å¼ */\nconst switchOnePageMode = () => {\n  const index = activeImgIndex();\n  setOption((draftOption, state) => {\n    if (draftOption.scrollMode.enabled) {\n      if (draftOption.scrollMode.abreastMode) {\n        draftOption.scrollMode.abreastMode = false;\n        draftOption.scrollMode.doubleMode = true;\n      } else draftOption.scrollMode.doubleMode = !draftOption.scrollMode.doubleMode;\n    } else {\n      const newPageNum = pageNum() === 1 ? 2 : 1;\n      draftOption.pageNum = state.option.autoSwitchPageMode && newPageNum === autoPageNum() ? 0 : newPageNum;\n    }\n  });\n  jumpToImg(index);\n};\n\n/** åˆ‡æ¢é˜…è¯»æ–¹å‘ */\nconst switchDir = () => {\n  setOption(draftOption => {\n    draftOption.dir = draftOption.dir === 'rtl' ? 'ltr' : 'rtl';\n  });\n};\n\n/** åˆ‡æ¢ç½‘æ ¼æ¨¡å¼ */\nconst switchGridMode = () => {\n  zoom(100);\n  setState(state => {\n    state.gridMode = !state.gridMode;\n    if (store.option.zoom.ratio !== 100) zoom(100);\n    state.page.anima = '';\n  });\n  // åˆ‡æ¢åˆ°ç½‘æ ¼æ¨¡å¼åè‡ªåŠ¨å®šä½åˆ°å½“å‰é¡µ\n  if (store.gridMode) requestAnimationFrame(() => {\n    refs.mangaFlow.children[activeImgIndex()]?.scrollIntoView({\n      block: 'center',\n      inline: 'center'\n    });\n  });\n};\n\n/** åˆ‡æ¢å…¨å± */\nconst switchFullscreen = () => {\n  if (document.fullscreenElement) document.exitFullscreen();else refs.root.requestFullscreen();\n};\n\n/** åˆ‡æ¢è‡ªåŠ¨æ»šåŠ¨ */\nconst switchAutoScroll = () => setState('autoScroll', 'play', val => !val);\n\n/** åˆ‡æ¢å›¾ç‰‡è¯†åˆ«ç›¸å…³åŠŸèƒ½ */\nconst switchImgRecognition = (...path) => setOption((draftOption, state) => {\n  const option = draftOption.imgRecognition;\n  if (path.length === 0) path.push('enabled');\n  for (const key of path) option[key] = !option[key];\n  if (!option.enabled) return;\n  for (const img of Object.values(state.imgMap)) {\n    if (!img.blobUrl) img.loadType = 'wait';\n    if (img.loadType !== 'loaded') continue;\n    handleImgRecognition(img.src);\n  }\n  if (path.includes('enabled')) updateImgLoadType();\n});\n\nconst handleMouseDown = e => {\n  if (e.button !== 1 || store.option.scrollMode.enabled) return;\n  e.stopPropagation();\n  e.preventDefault();\n  switchFillEffect();\n};\n\n/** å·è½´æ¨¡å¼ä¸‹æ»šåŠ¨è‡³æŒ‡å®šé¡µæ•° */\nconst scrollIntoView = (index, position = 'start') => scrollTo(position === 'start' ? getPageTop(index) : getPageTop(index + 1) - store.rootSize.height, true);\n\n/** åˆ¤æ–­æŒ‡å®šé¡µèƒ½å¦è¢«å®Œå…¨æ˜¾ç¤ºå‡ºæ¥ */\nconst isFullView = i => pageHeightList()[i] < store.rootSize.height;\n\n/** åœ¨å·è½´æ¨¡å¼ä¸‹ï¼Œæ™ºèƒ½æ»šåŠ¨è‡³å›¾ç‰‡çš„å¤´å°¾ */\nconst scrollViewTurnPage = offset => {\n  if (!store.option.scrollMode.enabled) return;\n  const dir = offset > 0 ? 'next' : 'prev';\n  if (handleEndTurnPage(dir)) return;\n  if (!store.option.scrollMode.alignEdge) return scrollBy(offset, true);\n  const viewBottom = scrollTop() + store.rootSize.height;\n  let viewBottomPage = findTopPage(viewBottom);\n  // å¦‚æœåº•é¡µåªéœ²å‡ºäº†ä¸€ç‚¹ç‚¹ï¼Œå°±å½“å®ƒæ²¡æ˜¾ç¤ºå‡ºæ¥ï¼Œé¿å…å°æ•°æ»šåŠ¨çš„è¯¯å·®\n  if (helper.approx(getPageTop(viewBottomPage), viewBottom)) viewBottomPage -= 1;\n  const viewTop = scrollTop();\n  let viewTopPage = findTopPage(viewTop);\n  // å¦‚æœé¡¶é¡µåªéœ²å‡ºäº†ä¸€ç‚¹ç‚¹ï¼Œå°±å½“å®ƒæ²¡æ˜¾ç¤ºå‡ºæ¥ï¼Œé¿å…å°æ•°æ»šåŠ¨çš„è¯¯å·®\n  if (helper.approx(getPageTop(viewTopPage + 1), viewTop)) viewTopPage += 1;\n  if (dir === 'next') {\n    const pageBottom = getPageTop(viewBottomPage + 1);\n\n    // å¦‚æœåº•é¡µæ²¡æ˜¾ç¤ºå‡ºç»“å°¾ï¼Œå°±è·³è½¬æ˜¾ç¤ºåº•é¡µ\n    if (!helper.approx(viewBottom, pageBottom)) {\n      // å¦‚æœå½“å‰æ˜¾ç¤ºçš„å›¾ç‰‡å æ»¡äº†å±å¹•\n      if (viewBottomPage === viewTopPage) {\n        // å¹¶ä¸”åœ¨æ»šåŠ¨äº†æŒ‡å®šè·ç¦»åæ˜¾ç¤ºçš„è¿˜æ˜¯è¿™ä¸ªå›¾ç‰‡ï¼Œå°±ç›´æ¥æ»šåŠ¨å®Œäº‹\n        if (viewBottom + offset <= pageBottom) return scrollBy(offset, true);\n        // å¦åˆ™è·³è‡³åº•é¡µç»“å°¾\n        return scrollIntoView(viewBottomPage, 'end');\n      }\n      return scrollIntoView(viewBottomPage, isFullView(viewBottomPage) ? 'end' : 'start');\n    }\n    // å¦åˆ™ä¸‹ä¸€é¡µ\n    const nextPage = viewBottomPage + 1;\n    scrollIntoView(nextPage, isFullView(nextPage) ? 'end' : 'start');\n  } else {\n    const pageTop = getPageTop(viewTopPage);\n\n    // å¦‚æœé¡¶é¡µæ²¡æ˜¾ç¤ºå‡ºå¼€å¤´ï¼Œå°±è·³è½¬æ˜¾ç¤ºé¡¶é¡µ\n    if (!helper.approx(viewTop, pageTop)) {\n      // å¦‚æœå½“å‰æ˜¾ç¤ºçš„å›¾ç‰‡å æ»¡äº†å±å¹•\n      if (viewBottomPage === viewTopPage) {\n        // å¹¶ä¸”åœ¨æ»šåŠ¨äº†æŒ‡å®šè·ç¦»åæ˜¾ç¤ºçš„è¿˜æ˜¯è¿™ä¸ªå›¾ç‰‡ï¼Œå°±ç›´æ¥æ»šåŠ¨å®Œäº‹\n        if (viewTop + offset >= pageTop) return scrollBy(offset, true);\n        // å¦åˆ™è·³è‡³é¡¶é¡µå¼€å¤´\n        return scrollIntoView(viewTopPage, 'start');\n      }\n      return scrollIntoView(viewTopPage, isFullView(viewTopPage) ? 'start' : 'end');\n    }\n    // å¦åˆ™ä¸Šä¸€é¡µ\n    const prevPage = viewTopPage - 1;\n    scrollIntoView(prevPage, isFullView(prevPage) ? 'start' : 'end');\n  }\n};\n\n/** æ ¹æ®æ˜¯å¦å¼€å¯äº† å·¦å³ç¿»é¡µé”®äº¤æ¢ æ¥åˆ‡æ¢ç¿»é¡µæ–¹å‘ */\nconst handleSwapPageTurnKey = nextPage => {\n  const next = store.option.swapPageTurnKey ? !nextPage : nextPage;\n  return next ? 'next' : 'prev';\n};\nconst handleHotkey = (hotkey, e) => {\n  // å¹¶æ’å·è½´æ¨¡å¼ä¸‹çš„å¿«æ·é”®\n  if (isAbreastMode()) {\n    switch (hotkey) {\n      case 'scroll_up':\n        return setAbreastScrollFill(abreastScrollFill() - 40);\n      case 'scroll_down':\n        return setAbreastScrollFill(abreastScrollFill() + 40);\n      case 'scroll_left':\n        if (e?.repeat) return constantScroll.start(store.option.dir === 'rtl' ? -1 : 1);\n        return scrollBy(store.option.dir === 'rtl' ? -40 : 40);\n      case 'scroll_right':\n        if (e?.repeat) return constantScroll.start(store.option.dir === 'rtl' ? 1 : -1);\n        return scrollBy(store.option.dir === 'rtl' ? 40 : -40);\n      case 'page_up':\n        return scrollBy(-store.rootSize.width * 0.8);\n      case 'page_down':\n        return scrollBy(store.rootSize.width * 0.8);\n      case 'jump_to_home':\n        return scrollTo(0);\n      case 'jump_to_end':\n        return scrollTo(scrollLength());\n    }\n  }\n\n  // æ™®é€šå·è½´æ¨¡å¼ä¸‹çš„å¿«æ·é”®\n  if (isScrollMode()) {\n    switch (hotkey) {\n      case 'page_up':\n        return scrollViewTurnPage(-store.rootSize.height * 0.8);\n      case 'page_down':\n        return scrollViewTurnPage(store.rootSize.height * 0.8);\n      case 'scroll_up':\n        if (e?.repeat) return constantScroll.start(-1);\n        return scrollBy(-40, true);\n      case 'scroll_down':\n        if (e?.repeat) return constantScroll.start(1);\n        return scrollBy(40, true);\n    }\n  }\n  switch (hotkey) {\n    case 'page_up':\n    case 'scroll_up':\n      return turnPage('prev');\n    case 'page_down':\n    case 'scroll_down':\n      return turnPage('next');\n    case 'scroll_left':\n      return turnPage(handleSwapPageTurnKey(store.option.dir === 'rtl'));\n    case 'scroll_right':\n      return turnPage(handleSwapPageTurnKey(store.option.dir !== 'rtl'));\n    case 'jump_to_home':\n      return setState('activePageIndex', 0);\n    case 'jump_to_end':\n      return setState('activePageIndex', Math.max(0, store.pageList.length - 1));\n    case 'switch_page_fill':\n      return switchFillEffect();\n    case 'switch_scroll_mode':\n      return switchScrollMode();\n    case 'switch_single_double_page_mode':\n      return switchOnePageMode();\n    case 'switch_dir':\n      return switchDir();\n    case 'switch_grid_mode':\n      return switchGridMode();\n    case 'translate_current_page':\n      return translateCurrent();\n    case 'translate_all':\n      return translateAll();\n    case 'translate_to_end':\n      return translateToEnd();\n    case 'auto_scroll':\n      return switchAutoScroll();\n    case 'fullscreen':\n      return switchFullscreen();\n    case 'switch_auto_enlarge':\n      return setOption(draftOption => {\n        draftOption.disableZoom = !draftOption.disableZoom;\n      });\n    case 'exit':\n      return store.prop.onExit?.();\n\n    // é˜…è¯»æ¨¡å¼ä»¥å¤–çš„å¿«æ·é”®è½¬å‘åˆ°ç½‘é¡µä¸Šå»å¤„ç†\n    default:\n      document.body.dispatchEvent(new KeyboardEvent('keydown', e));\n      document.body.dispatchEvent(new KeyboardEvent('keyup', e));\n  }\n};\nconst handleKeyDown = e => {\n  switch (e.target.tagName) {\n    case 'INPUT':\n    case 'TEXTAREA':\n      return;\n  }\n  if (e.target.className === modules_c21c94f2$1.hotkeysItem) return;\n  const code = helper.getKeyboardCode(e);\n\n  // esc åœ¨è§¦å‘é…ç½®æ“ä½œå‰ï¼Œå…ˆç”¨äºé€€å‡ºä¸€äº›ç•Œé¢\n  if (e.key === 'Escape') {\n    if (store.gridMode) {\n      e.stopPropagation();\n      e.preventDefault();\n      return setState('gridMode', false);\n    }\n    if (store.show.endPage) {\n      e.stopPropagation();\n      e.preventDefault();\n      return setState('show', 'endPage', undefined);\n    }\n  }\n\n  // å¤„ç†æ ‡æ³¨äº† data-only-number çš„å…ƒç´ \n  if (e.target.dataset.onlyNumber !== undefined) {\n    // æ‹¦æˆªèƒ½è¾“å…¥æ•°å­—å¤–çš„æŒ‰é”®\n    if (/^(?:Shift \\+ )?[a-zA-Z]$/.test(code)) {\n      e.stopPropagation();\n      e.preventDefault();\n    }\n    return;\n  }\n\n  // å·è½´ã€ç½‘æ ¼æ¨¡å¼ä¸‹è·³è¿‡ç”¨äºç§»åŠ¨çš„åŸç”ŸæŒ‰é”®\n  if ((isScrollMode() || store.gridMode) && !store.show.endPage) {\n    switch (e.key) {\n      case 'Home':\n      case 'End':\n      case 'ArrowRight':\n      case 'ArrowLeft':\n        return e.stopPropagation();\n      case 'ArrowUp':\n      case 'PageUp':\n        e.stopPropagation();\n        if (isScrollMode()) return handleEndTurnPage('prev');\n        return;\n      case 'ArrowDown':\n      case 'PageDown':\n      case ' ':\n        e.stopPropagation();\n        if (isScrollMode()) return handleEndTurnPage('next');\n        return;\n    }\n  }\n\n  // æ‹¦æˆªå·²æ³¨å†Œçš„å¿«æ·é”®\n  if (Reflect.has(hotkeysMap(), code)) {\n    e.stopPropagation();\n    e.preventDefault();\n  } else return;\n  handleHotkey(hotkeysMap()[code], e);\n};\nconst handleKeyUp = e => {\n  switch (hotkeysMap()[helper.getKeyboardCode(e)]) {\n    // åœæ­¢é•¿æŒ‰æ»šåŠ¨\n    case 'scroll_left':\n    case 'scroll_right':\n    case 'scroll_up':\n    case 'scroll_down':\n      return constantScroll.cancel();\n  }\n};\n\n/** åˆ¤æ–­ä¸¤ä¸ªæ•°å€¼æ˜¯å¦æ˜¯æ•´æ•°å€çš„å…³ç³» */\nconst isMultipleOf = (a, b) => {\n  const decimal = `${a < b ? b / a : a / b}`.split('.')?.[1];\n  return !decimal || decimal.startsWith('0000') || decimal.startsWith('9999');\n};\nlet lastDeltaY = -1;\nlet timeoutId = 0;\nlet lastPageNum = -1;\nlet wheelType;\nlet equalNum = 0;\nlet diffNum = 0;\nconst handleWheel = e => {\n  if (store.gridMode) return;\n  e.stopPropagation();\n  if (e.ctrlKey || e.altKey) e.preventDefault();\n  const isWheelDown = e.deltaY > 0;\n  const dir = isWheelDown ? 'next' : 'prev';\n  const absDeltaY = Math.abs(e.deltaY);\n\n  // é€šè¿‡`ä¸¤æ¬¡æ»šåŠ¨è·ç¦»æ˜¯å¦æˆå€æ•°`å’Œ`æ»šåŠ¨è·ç¦»æ˜¯å¦è¿‡å°`æ¥åˆ¤æ–­æ˜¯å¦æ˜¯è§¦æ‘¸æ¿\n  if (wheelType !== 'trackpad' && (absDeltaY < 5 || !Number.isInteger(lastDeltaY) && !Number.isInteger(absDeltaY) && !isMultipleOf(lastDeltaY, absDeltaY))) {\n    wheelType = 'trackpad';\n    if (timeoutId) clearTimeout(timeoutId);\n    // å¦‚æœæ˜¯è§¦æ‘¸æ¿æ»šåŠ¨ï¼Œä¸”ä¸Šæ¬¡æˆåŠŸè§¦å‘äº†ç¿»é¡µï¼Œå°±é‡æ–°ç¿»é¡µå›å»\n    if (lastPageNum !== -1) setState('activePageIndex', lastPageNum);\n  }\n  if (absDeltaY < 5) return;\n\n  // å·è½´æ¨¡å¼ä¸‹çš„å›¾ç‰‡ç¼©æ”¾\n  if ((e.ctrlKey || e.altKey) && store.option.scrollMode.enabled && store.option.zoom.ratio === 100) {\n    e.preventDefault();\n    return handleScrollModeZoom(isWheelDown ? 'sub' : 'add');\n  }\n  if (e.ctrlKey || e.altKey) {\n    e.preventDefault();\n    return zoom(store.option.zoom.ratio + (isWheelDown ? -25 : 25), e);\n  }\n  if (handleEndTurnPage(dir)) {\n    openScrollLock();\n    return e.preventDefault();\n  }\n\n  // å¹¶æ’å·è½´æ¨¡å¼ä¸‹\n  if (isAbreastMode() && store.option.zoom.ratio === 100) {\n    e.preventDefault();\n    scrollBy(e.deltaY, true);\n  }\n\n  // é˜²æ­¢æ»šåŠ¨åˆ°ç½‘é¡µ\n  if (!isScrollMode()) e.preventDefault();\n\n  // ä¸ºäº†é¿å…å› ä¸´æ—¶å¡é¡¿è€Œè¯¯åˆ¤ä¸ºè§¦æ‘¸æ¿\n  // åœ¨è¿ç»­å‡ æ¬¡æ»šåŠ¨é‡å‡ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå°† wheelType ç›¸å…³å˜é‡é‡ç½®å›åˆå§‹çŠ¶æ€\n  if (diffNum < 10) {\n    if (lastDeltaY === absDeltaY && absDeltaY > 5) equalNum += 1;else {\n      diffNum += 1;\n      equalNum = 0;\n    }\n    if (equalNum >= 3) {\n      wheelType = undefined;\n      lastPageNum = -1;\n    }\n  }\n  lastDeltaY = absDeltaY;\n  switch (wheelType) {\n    case undefined:\n      {\n        if (lastPageNum === -1) {\n          // ç¬¬ä¸€æ¬¡è§¦å‘æ»šåŠ¨æ²¡æ³•åˆ¤æ–­ç±»å‹ï¼Œå°±å½“ä½œæ»šè½®æ¥å¤„ç†\n          // ä½†ä¸ºäº†é¿å…è§¦æ‘¸æ¿å‰ä¸¤æ¬¡æ»šåŠ¨äº‹ä»¶é—´éš”å¤§äºå¸§ç”Ÿæˆæ—¶é—´å¯¼è‡´å¾—é‡æ–°ç¿»é¡µå›å»çš„é—ªçƒï¼ŒåŠ ä¸ªå»¶è¿Ÿç­‰å¾…ä¸‹\n          lastPageNum = store.activePageIndex;\n          timeoutId = window.setTimeout(turnPage, 16, dir);\n          return;\n        }\n        wheelType = 'mouse';\n      }\n    // falls through\n\n    case 'mouse':\n      return turnPage(dir);\n    case 'trackpad':\n      return handleTrackpadWheel(e);\n  }\n};\n\n/** åˆ¤æ–­ç‚¹å‡»ä½ç½®åœ¨æ»šåŠ¨æ¡ä¸Šçš„ä½ç½®æ¯”ç‡ */\nconst getClickTop = (x, y, e) => {\n  switch (scrollPosition()) {\n    case 'bottom':\n    case 'top':\n      return store.option.dir === 'rtl' ? 1 - x / e.offsetWidth : x / e.offsetWidth;\n    default:\n      return y / e.offsetHeight;\n  }\n};\n\n/** è®¡ç®—åœ¨æ»šåŠ¨æ¡ä¸Šçš„æ‹–åŠ¨è·ç¦» */\nconst getSliderDist = ([x, y], [ix, iy], e) => {\n  switch (scrollPosition()) {\n    case 'bottom':\n    case 'top':\n      return store.option.dir === 'rtl' ? (1 - (x - ix)) / e.offsetWidth : (x - ix) / e.offsetWidth;\n    default:\n      return (y - iy) / e.offsetHeight;\n  }\n};\nconst [isDrag, setIsDrag] = solidJs.createSignal(false);\nconst closeDrag = helper.debounce(() => setIsDrag(false), 200);\nlet lastType = 'up';\n\n/** å¼€å§‹æ‹–æ‹½æ—¶çš„ sliderTop å€¼ */\nlet startTop = 0;\nconst handleScrollbarSlider = ({\n  type,\n  xy,\n  initial\n}, e) => {\n  const [x, y] = xy;\n\n  // æ£€æµ‹æ˜¯å¦æ˜¯æ‹–åŠ¨æ“ä½œ\n  if (type === 'move' && lastType === type) {\n    setIsDrag(true);\n    closeDrag();\n  }\n  lastType = type;\n\n  // è·³è¿‡æ‹–æ‹½ç»“æŸäº‹ä»¶ï¼ˆå•å‡»æ—¶ä¼šåŒæ—¶è§¦å‘å¼€å§‹å’Œç»“æŸï¼Œå°±ç”¨å¼€å§‹äº‹ä»¶æ¥å®Œæˆå•å‡»çš„æ•ˆæœ\n  if (type === 'up') return saveReadProgress();\n  if (!refs.mangaFlow) return;\n  const scrollbarDom = e.target;\n\n  /** ç‚¹å‡»ä½ç½®åœ¨æ»šåŠ¨æ¡ä¸Šçš„ä½ç½®æ¯”ç‡ */\n  const clickTop = getClickTop(x, y, e.target);\n  if (store.option.scrollMode.enabled) {\n    if (type === 'move') {\n      const top = helper.clamp(0, startTop + getSliderDist(xy, initial, scrollbarDom), 1) * scrollLength();\n      scrollTo(top);\n    } else {\n      // ç¡®ä¿æ»šåŠ¨æ¡çš„ä¸­å¿ƒä¼šåœ¨ç‚¹å‡»ä½ç½®\n      startTop = clickTop - sliderHeight() / 2;\n      const top = startTop * scrollLength();\n      scrollTo(top, true);\n    }\n  } else {\n    let newPageIndex = Math.floor(clickTop * store.pageList.length);\n    // å¤„ç†è¶…å‡ºèŒƒå›´çš„æƒ…å†µ\n    if (newPageIndex < 0) newPageIndex = 0;else if (newPageIndex >= store.pageList.length) newPageIndex = store.pageList.length - 1;\n    if (newPageIndex !== store.activePageIndex) setState('activePageIndex', newPageIndex);\n  }\n};\n\n/** æ‘©æ“¦ç³»æ•° */\nconst FRICTION_COEFF = 0.96;\nlet lastTop = 0;\nlet dy = 0;\nlet lastLeft = 0;\nlet dx = 0;\nlet animationId = null;\nlet lastTime = 0;\n\n/** é€å¸§è®¡ç®—é€Ÿç‡ */\nconst calcVelocity = () => {\n  const nowTop = store.option.scrollMode.abreastMode ? abreastScrollFill() : scrollTop();\n  dy = nowTop - lastTop;\n  lastTop = nowTop;\n  dx = store.page.offset.x.px - lastLeft;\n  lastLeft = store.page.offset.x.px;\n  animationId = requestAnimationFrame(calcVelocity);\n};\n\n/** é€å¸§è®¡ç®—æƒ¯æ€§æ»‘åŠ¨ */\nconst handleSlide = timestamp => {\n  // å½“é€Ÿç‡è¶³å¤Ÿå°æ—¶åœæ­¢è®¡ç®—åŠ¨ç”»\n  if (Math.abs(dx) + Math.abs(dy) < 1) {\n    animationId = null;\n    return;\n  }\n\n  // ç¡®ä¿æ¯16æ¯«ç§’æ‰å‡å°‘ä¸€æ¬¡é€Ÿç‡ï¼Œé˜²æ­¢åœ¨é«˜åˆ·æ–°ç‡æ˜¾ç¤ºå™¨ä¸Šè¡°å‡è¿‡å¿«\n  if (timestamp - lastTime > 16) {\n    dy *= FRICTION_COEFF;\n    dx *= FRICTION_COEFF;\n    lastTime = timestamp;\n  }\n  if (store.option.scrollMode.abreastMode) {\n    scrollTo(scrollTop() + dx);\n    setAbreastScrollFill(abreastScrollFill() + dy);\n  } else scrollTo(scrollTop() + dy);\n  animationId = requestAnimationFrame(handleSlide);\n};\nlet initTop = 0;\nlet initLeft = 0;\nlet initAbreastScrollFill = 0;\nconst handleScrollModeDrag = ({\n  type,\n  xy: [x, y],\n  initial: [ix, iy],\n  startTime\n}, e) => {\n  if (!store.option.scrollMode.abreastMode && e.pointerType !== 'mouse') return;\n  switch (type) {\n    case 'down':\n      {\n        if (animationId) cancelAnimationFrame(animationId);\n        initTop = refs.mangaBox.scrollTop;\n        initLeft = store.page.offset.x.px * (store.option.dir === 'rtl' ? 1 : -1);\n        initAbreastScrollFill = abreastScrollFill();\n        requestAnimationFrame(calcVelocity);\n        return;\n      }\n    case 'move':\n      {\n        if (store.option.scrollMode.abreastMode) {\n          const _dx = x - ix;\n          const _dy = y - iy;\n          scrollTo((initLeft + _dx) * (store.option.dir === 'rtl' ? 1 : -1));\n          setAbreastScrollFill(initAbreastScrollFill + _dy);\n        } else scrollTo(initTop + iy - y);\n        return;\n      }\n    case 'up':\n      {\n        if (animationId) cancelAnimationFrame(animationId);\n        if (performance.now() - startTime < 50) return;\n        animationId = requestAnimationFrame(handleSlide);\n        saveReadProgress();\n      }\n  }\n};\n\n/** åœ¨é¼ æ ‡é™æ­¢ä¸€æ®µæ—¶é—´åè‡ªåŠ¨éšè— */\nconst useHiddenMouse = () => {\n  const [hiddenMouse, setHiddenMouse] = solidJs.createSignal(true);\n  const hidden = helper.debounce(() => setHiddenMouse(true), 1000);\n  return {\n    hiddenMouse,\n    /** é¼ æ ‡ç§»åŠ¨ */\n    onMouseMove() {\n      setHiddenMouse(false);\n      hidden();\n    }\n  };\n};\n\nconst useStyle = css => solidJs.onMount(() => helper.useStyle(css, refs.root));\nconst useStyleMemo = (selector, styleMapArg) => solidJs.onMount(() => helper.useStyleMemo(selector, styleMapArg, refs.root));\n\nconst ComicImg = img => {\n  const showState = () => imgShowState().get(img.index);\n  const src = () => {\n    if (img.loadType === 'wait') return '';\n    if (img.translationType === 'show') return img.translationUrl;\n    if (store.option.imgRecognition.enabled) {\n      if (store.option.imgRecognition.upscale && img.upscaleUrl) return img.upscaleUrl;\n      return img.blobUrl;\n    }\n    // æœ‰äº›æµè§ˆå™¨ä¸æ”¯æŒæ˜¾ç¤ºå¸¦æœ‰ hash æ ‡è¯†çš„å›¾ç‰‡ url\n    if (img.src.startsWith('blob:')) return img.src.replace(/#\\..+/, '');\n    return img.src;\n  };\n\n  /** å¹¶æ’å·è½´æ¨¡å¼ä¸‹éœ€è¦å¤åˆ¶çš„å›¾ç‰‡æ•°é‡ */\n  const cloneNum = solidJs.createMemo(() => {\n    if (!isAbreastMode()) return 0;\n    const imgPosition = abreastArea().position[img.index];\n    return imgPosition ? imgPosition.length - 1 : 0;\n  });\n\n  /** æ˜¯å¦è¦æ¸²æŸ“å¤åˆ¶å›¾ç‰‡ */\n  const renderClone = () => !store.gridMode && showState() !== undefined && cloneNum() > 0;\n  const selector = `.${modules_c21c94f2$1.img}[id^=\"_${img.index}_\"]`;\n  useStyleMemo(selector, {\n    'grid-area': () => isAbreastMode() && !store.gridMode ? 'none' : `_${img.index}`,\n    'background-color': () => isEnableBg() ? img.background : undefined\n  });\n  useStyleMemo(`${selector} > picture`, {\n    'aspect-ratio': () => `${img.size.width} / ${img.size.height}`,\n    background: () => img.progress && `linear-gradient(\n          to bottom,\n          var(--secondary-bg) ${img.progress}%,\n          var(--hover-bg-color,#fff3) ${img.progress}%\n        )`\n  });\n  const _ComicImg = props => (() => {\n    var _el$ = web.template(`<div><picture>`)(),\n      _el$2 = _el$.firstChild;\n    web.insert(_el$2, web.createComponent(solidJs.Show, {\n      get when() {\n        return web.memo(() => img.loadType !== 'wait')() && src();\n      },\n      get children() {\n        var _el$3 = web.template(`<img draggable=false decoding=sync>`)();\n        _el$3.addEventListener(\"error\", e => handleImgError(img.src, e.currentTarget));\n        _el$3.addEventListener(\"load\", e => handleImgLoaded(img.src, e.currentTarget));\n        web.effect(_p$ => {\n          var _v$ = src(),\n            _v$2 = `${img.index}`,\n            _v$3 = img.src;\n          _v$ !== _p$.e && web.setAttribute(_el$3, \"src\", _p$.e = _v$);\n          _v$2 !== _p$.t && web.setAttribute(_el$3, \"alt\", _p$.t = _v$2);\n          _v$3 !== _p$.a && web.setAttribute(_el$3, \"data-src\", _p$.a = _v$3);\n          return _p$;\n        }, {\n          e: undefined,\n          t: undefined,\n          a: undefined\n        });\n        return _el$3;\n      }\n    }));\n    web.insert(_el$, web.createComponent(solidJs.Show, {\n      get when() {\n        return store.gridMode;\n      },\n      get children() {\n        var _el$4 = web.template(`<div>`)();\n        web.insert(_el$4, (() => {\n          var _c$ = web.memo(() => !!store.gridMode);\n          return () => _c$() ? getImgTip(img.index) : '';\n        })());\n        web.effect(() => web.className(_el$4, modules_c21c94f2$1.gridModeTip));\n        return _el$4;\n      }\n    }), null);\n    web.effect(_p$ => {\n      var _v$4 = modules_c21c94f2$1.img,\n        _v$5 = `_${img.index}_${props.cloneIndex ?? 0}`,\n        _v$6 = showState(),\n        _v$7 = img.type ?? store.defaultImgType,\n        _v$8 = img.loadType === 'loaded' ? undefined : img.loadType;\n      _v$4 !== _p$.e && web.className(_el$, _p$.e = _v$4);\n      _v$5 !== _p$.t && web.setAttribute(_el$, \"id\", _p$.t = _v$5);\n      _v$6 !== _p$.a && web.setAttribute(_el$, \"data-show\", _p$.a = _v$6);\n      _v$7 !== _p$.o && web.setAttribute(_el$, \"data-type\", _p$.o = _v$7);\n      _v$8 !== _p$.i && web.setAttribute(_el$, \"data-load-type\", _p$.i = _v$8);\n      return _p$;\n    }, {\n      e: undefined,\n      t: undefined,\n      a: undefined,\n      o: undefined,\n      i: undefined\n    });\n    return _el$;\n  })();\n  return [web.createComponent(_ComicImg, {}), web.createComponent(solidJs.Show, {\n    get when() {\n      return renderClone();\n    },\n    get children() {\n      return web.createComponent(solidJs.For, {\n        get each() {\n          return Array.from({\n            length: cloneNum()\n          });\n        },\n        children: (_, i) => web.createComponent(_ComicImg, {\n          get cloneIndex() {\n            return i() + 1;\n          }\n        })\n      });\n    }\n  })];\n};\n\n// ç›®å‰å³ä½¿æ˜¯ä¸æ˜¾ç¤ºçš„å›¾ç‰‡ä¹Ÿå¿…é¡»æŒ‚è½½ä¸Šï¼Œå¦åˆ™è§£æå¥½çš„å›¾ç‰‡ä¼šè¢«æµè§ˆå™¨åƒåœ¾å›æ”¶æ‰ï¼Œ\n// å¯¼è‡´åœ¨ ehentai ä¸Šæ— æ³•æ­£å¸¸åŠ è½½å›¾ç‰‡ã€‚ä½†è¿™æ ·ä¼šåœ¨å›¾ç‰‡è¿‡å¤šæ—¶é€ æˆæ€§èƒ½é—®é¢˜ï¼Œ\n// è™½ç„¶ä¹Ÿå°è¯•äº†å°†è§£æå¥½çš„ Image å¯¹è±¡å­˜å‚¨èµ·æ¥æŒ‚ä¸Šå¼•ç”¨å’Œå¦å¤–æ”¾åˆ°ä¸€ä¸ªé¿å…æ¸²æŸ“çš„ dom ä¸‹ï¼Œ\n// ä½†ä¹Ÿéƒ½å¤±è´¥äº†ï¼Œåªèƒ½æš‚æ—¶å…ˆä¸ç®¡äº†ã€‚\n// ä¹‹åå°è¯•æ–°æ–¹æ¡ˆæ—¶å¿…é¡»ç»è¿‡å¦‚ä¸‹æµ‹è¯•ï¼šå¼€ä¸ªå‡ ç™¾é¡µçš„æ¼«ç”»åŠ è½½å®Œæ¯•åï¼Œå†æ‰“å¼€äºŒåä¸ªæ ‡ç­¾é¡µåˆ‡æ¢è¿‡å»ï¼Œ\nconst EmptyTip = () => {\n  let ref; // oxlint-disable-line no-unassigned-vars\n\n  helper.onAutoMount(() => {\n    let timeoutId = 0;\n    const observer = new IntersectionObserver(([{\n      isIntersecting\n    }]) => {\n      if (!isIntersecting) return;\n      timeoutId = window.setTimeout(() => {\n        ref?.style.removeProperty('opacity');\n        timeoutId = 0;\n      }, 2000);\n    }, {\n      threshold: 1\n    });\n    observer.observe(ref);\n    return () => {\n      observer.disconnect();\n      if (timeoutId) clearTimeout(timeoutId);\n    };\n  });\n  return (() => {\n    var _el$ = web.template(`<h1>`)();\n    var _ref$ = ref;\n    typeof _ref$ === \"function\" ? web.use(_ref$, _el$) : ref = _el$;\n    web.setStyleProperty(_el$, \"opacity\", \"0\");\n    _el$.textContent = \"NULL\";\n    return _el$;\n  })();\n};\n\nconst ComicImgFlow = () => {\n  const {\n    hiddenMouse,\n    onMouseMove\n  } = useHiddenMouse();\n  const handleDrag = (state, e) => {\n    if (store.gridMode) return;\n    if (touches.size > 1) return handlePinchZoom(state);\n    if (store.option.zoom.ratio !== 100) return handleZoomDrag(state);\n    if (store.option.scrollMode.enabled) return handleScrollModeDrag(state, e);\n    return handleMangaFlowDrag(state);\n  };\n  solidJs.onMount(() => {\n    helper.useDrag({\n      ref: refs.mangaBox,\n      handleDrag,\n      handleClick,\n      touches\n    });\n    bindScrollTop(refs.mangaBox);\n  });\n  const handleTransitionEnd = () => {\n    if (store.isDragMode) return;\n    setState(state => {\n      if (store.option.zoom.ratio === 100) resetPage(state, false);else state.page.anima = '';\n    });\n  };\n\n  /** åœ¨å½“å‰é¡µä¹‹å‰æœ‰å›¾ç‰‡è¢«åŠ è½½å‡ºæ¥ï¼Œå¯¼è‡´å†…å®¹é«˜åº¦å‘ç”Ÿå˜åŒ–åï¼Œé‡æ–°æ»šåŠ¨é¡µé¢ï¼Œç¡®ä¿å½“å‰æ˜¾ç¤ºä½ç½®ä¸å˜ */\n  helper.createEffectOn([() => store.showRange[0], () => pageTopList()[store.showRange[0]], pageTopList], ([showImg, height, topList], prev) => {\n    if (!prev || !height || !isScrollMode()) return;\n    const [prevShowImg, prevHeight, prevTopList] = prev;\n    if (showImg !== prevShowImg || prevTopList === topList || prevHeight === height) return;\n    scrollTo(scrollTop() + height - prevHeight);\n    // ç›®å‰è¿˜æ˜¯ä¼šæœ‰è½»å¾®åç§»ï¼Œä½†è€ƒè™‘åˆ°å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯é¡ºåºé˜…è¯»ï¼Œæœ¬èº«å‡ºç°æ¦‚ç‡å°±ä½ï¼Œå°±ä¸ç»§ç»­æ’æŸ¥ä¼˜åŒ–äº†\n  });\n  const pageToText = page => `${(page.length === 1 ? [page[0], page[0]] : page).map(i => i === -1 ? '.' : `_${i}`).join(' ')}`;\n  const gridAreas = solidJs.createMemo(() => {\n    if (store.pageList.length === 0) return undefined;\n    if (store.gridMode) {\n      let columnNum;\n      if (store.isMobile) columnNum = 2;else if (store.defaultImgType === 'vertical') columnNum = 6;else if (isOnePageMode()) columnNum = 4;else columnNum = 2;\n      const areaList = [[]];\n      for (const page of store.pageList) {\n        if (areaList.at(-1).length === columnNum) areaList.push([]);\n        areaList.at(-1).push(pageToText(page));\n      }\n      while (areaList.at(-1).length !== columnNum) areaList.at(-1).push('. .');\n      return areaList.map(line => `\"${line.join(' ')}\"`).join('\\n') || undefined;\n    }\n    if (store.option.scrollMode.enabled) {\n      if (store.option.scrollMode.abreastMode) return `\"${helper.range(abreastArea().columns.length, i => `_${i}`).join(' ')}\"`;\n      if (store.option.scrollMode.doubleMode) return store.pageList.map(page => `\"${pageToText(page)}\"`).join('\\n');\n      return helper.range(store.imgList.length, i => `\"_${i}\"`).join('\\n');\n    }\n    return store.page.vertical ? store.pageList.slice(store.renderRange[0], store.renderRange[1] + 1).map(page => `\"${pageToText(page)}\"`).join('\\n') : `\"${store.pageList.slice(store.renderRange[0], store.renderRange[1] + 1).map(pageToText).join(' ')}\"`;\n  });\n  useStyleMemo(`.${modules_c21c94f2$1.mangaBox}`, {\n    transform: () => `translate(${store.option.zoom.offset.x}px, ${store.option.zoom.offset.y}px)\n        scale(${store.option.zoom.ratio / 100})`\n  });\n  const pageX = solidJs.createMemo(() => {\n    if (store.gridMode || isScrollMode()) return 0;\n    let x = store.page.offset.x.pct * store.rootSize.width + store.page.offset.x.px;\n    if (store.option.dir !== 'rtl') x = -x;\n    return x;\n  });\n  useStyleMemo(`#${modules_c21c94f2$1.mangaFlow}`, {\n    // ä¸èƒ½ä½¿ç”¨ transform æ¥ç§»åŠ¨ï¼Œä¸ç„¶åœ¨ Safari æµè§ˆå™¨ä¸Šæ‚¬æµ®æ˜¾ç¤ºæ—¶\n    // æ¯æ¬¡æ»šåŠ¨åº•ä¸‹çš„ç½‘é¡µæ—¶ mangaFlow éƒ½ä¼šé—ªçƒä¸€ä¸‹ï¼Œåœ¨ç®€æ˜“æ¨¡å¼ä¸‹ä¼šé¢‘ç¹è§¦å‘\n    left: () => `${pageX()}px`,\n    top: () => `${store.page.offset.y.pct * store.rootSize.height + store.page.offset.y.px}px`,\n    'touch-action': function () {\n      if (store.gridMode) return 'auto';\n      if (store.option.zoom.ratio !== 100) {\n        if (!store.option.scrollMode.enabled) return 'none';\n        if (store.option.zoom.offset.y === 0) return 'pan-up';\n        if (store.option.zoom.offset.y === bound().y) return 'pan-down';\n      }\n    },\n    'grid-template-areas': gridAreas,\n    'grid-template-columns': function () {\n      if (store.imgList.length === 0 || store.gridMode) return undefined;\n      if (store.option.scrollMode.enabled) {\n        if (store.option.scrollMode.abreastMode) return `repeat(${abreastArea().columns.length}, ${abreastColumnWidth()}px)`;\n        if (store.option.scrollMode.doubleMode) return `50% 50%`;\n        return undefined;\n      }\n      if (store.page.vertical) return '50% 50%';\n      return `repeat(${gridAreas()?.split(' ').length ?? 0}, 50%)`;\n    },\n    'grid-template-rows': function () {\n      if (store.gridMode) return undefined;\n      if (isScrollMode()) return pageHeightList().map(num => `${num}px`).join(' ');\n    },\n    'background-color': () => isEnableBg() ? getImg(activeImgIndex())?.background : undefined\n  });\n  useStyle(imgAreaStyle);\n  return (() => {\n    var _el$ = web.template(`<div tabindex=-1><div tabindex=-1>`)(),\n      _el$2 = _el$.firstChild;\n    web.addEventListener(_el$, \"scrollend\", focus);\n    _el$.addEventListener(\"transitionend\", handleTransitionEnd);\n    var _ref$ = bindRef('mangaBox');\n    typeof _ref$ === \"function\" && web.use(_ref$, _el$);\n    _el$2.addEventListener(\"transitionend\", handleTransitionEnd);\n    web.addEventListener(_el$2, \"mousemove\", onMouseMove);\n    var _ref$2 = bindRef('mangaFlow');\n    typeof _ref$2 === \"function\" && web.use(_ref$2, _el$2);\n    web.insert(_el$2, web.createComponent(solidJs.Index, {\n      get each() {\n        return imgList();\n      },\n      get fallback() {\n        return web.createComponent(EmptyTip, {});\n      },\n      children: (img, i) => web.createComponent(ComicImg, web.mergeProps({\n        index: i\n      }, img))\n    }));\n    web.effect(_p$ => {\n      var _v$ = `${modules_c21c94f2$1.mangaBox} ${modules_c21c94f2$1.beautifyScrollbar}`,\n        _v$2 = store.page.anima,\n        _v$3 = helper.boolDataVal(store.option.scrollMode.abreastMode),\n        _v$4 = modules_c21c94f2$1.mangaFlow,\n        _v$5 = store.option.dir,\n        _v$6 = `${modules_c21c94f2$1.mangaFlow} ${modules_c21c94f2$1.beautifyScrollbar}`,\n        _v$7 = helper.boolDataVal(store.option.disableZoom && !store.option.scrollMode.enabled),\n        _v$8 = helper.boolDataVal(store.option.zoom.ratio !== 100),\n        _v$9 = helper.boolDataVal(store.page.vertical),\n        _v$0 = !store.gridMode && store.option.autoHiddenMouse && hiddenMouse();\n      _v$ !== _p$.e && web.className(_el$, _p$.e = _v$);\n      _v$2 !== _p$.t && web.setAttribute(_el$, \"data-animation\", _p$.t = _v$2);\n      _v$3 !== _p$.a && web.setAttribute(_el$, \"data-abreast-scroll\", _p$.a = _v$3);\n      _v$4 !== _p$.o && web.setAttribute(_el$2, \"id\", _p$.o = _v$4);\n      _v$5 !== _p$.i && web.setAttribute(_el$2, \"dir\", _p$.i = _v$5);\n      _v$6 !== _p$.n && web.className(_el$2, _p$.n = _v$6);\n      _v$7 !== _p$.s && web.setAttribute(_el$2, \"data-disable-zoom\", _p$.s = _v$7);\n      _v$8 !== _p$.h && web.setAttribute(_el$2, \"data-scale-mode\", _p$.h = _v$8);\n      _v$9 !== _p$.r && web.setAttribute(_el$2, \"data-vertical\", _p$.r = _v$9);\n      _v$0 !== _p$.d && web.setAttribute(_el$2, \"data-hidden-mouse\", _p$.d = _v$0);\n      return _p$;\n    }, {\n      e: undefined,\n      t: undefined,\n      a: undefined,\n      o: undefined,\n      i: undefined,\n      n: undefined,\n      s: undefined,\n      h: undefined,\n      r: undefined,\n      d: undefined\n    });\n    return _el$;\n  })();\n};\n\n\nconst areaArrayMap = {\n  left_right: [['prev', 'menu', 'next'], ['PREV', 'MENU', 'NEXT'], ['prev', 'menu', 'next']],\n  up_down: [['prev', 'PREV', 'prev'], ['menu', 'MENU', 'menu'], ['next', 'NEXT', 'next']],\n  edge: [['next', 'menu', 'next'], ['NEXT', 'MENU', 'NEXT'], ['next', 'PREV', 'next']],\n  l: [['PREV', 'prev', 'prev'], ['prev', 'MENU', 'next'], ['next', 'next', 'NEXT']]\n};\nconst areaType = helper.createRootMemo(() => Reflect.has(areaArrayMap, store.option.clickPageTurn.area) ? store.option.clickPageTurn.area : 'left_right');\nconst dir = helper.createRootMemo(() => {\n  if (!store.option.clickPageTurn.reverse) return store.option.dir;\n  return store.option.dir === 'rtl' ? 'ltr' : 'rtl';\n});\nconst TouchArea = () => (() => {\n  var _el$ = web.template(`<div>`)();\n  var _ref$ = bindRef('touchArea');\n  typeof _ref$ === \"function\" && web.use(_ref$, _el$);\n  web.insert(_el$, web.createComponent(solidJs.For, {\n    get each() {\n      return areaArrayMap[areaType()];\n    },\n    children: rows => web.createComponent(solidJs.For, {\n      each: rows,\n      children: area => (() => {\n        var _el$2 = web.template(`<div role=button tabindex=-1>`)();\n        web.setAttribute(_el$2, \"data-area\", area);\n        web.effect(() => web.className(_el$2, modules_c21c94f2$1.touchArea));\n        return _el$2;\n      })()\n    })\n  }));\n  web.effect(_p$ => {\n    var _v$ = modules_c21c94f2$1.touchAreaRoot,\n      _v$2 = dir(),\n      _v$3 = helper.boolDataVal(store.show.touchArea),\n      _v$4 = areaType(),\n      _v$5 = helper.boolDataVal(store.option.clickPageTurn.enabled),\n      _v$6 = helper.boolDataVal(store.option.clickPageTurn.shrinkMenu);\n    _v$ !== _p$.e && web.className(_el$, _p$.e = _v$);\n    _v$2 !== _p$.t && web.setAttribute(_el$, \"dir\", _p$.t = _v$2);\n    _v$3 !== _p$.a && web.setAttribute(_el$, \"data-show\", _p$.a = _v$3);\n    _v$4 !== _p$.o && web.setAttribute(_el$, \"data-area\", _p$.o = _v$4);\n    _v$5 !== _p$.i && web.setAttribute(_el$, \"data-turn-page\", _p$.i = _v$5);\n    _v$6 !== _p$.n && web.setAttribute(_el$, \"data-shrink-menu\", _p$.n = _v$6);\n    return _p$;\n  }, {\n    e: undefined,\n    t: undefined,\n    a: undefined,\n    o: undefined,\n    i: undefined,\n    n: undefined\n  });\n  return _el$;\n})();\n\nlet delayTypeTimer = 0;\nconst EndPage = () => {\n  const handleClick = e => {\n    e.stopPropagation();\n    if (e.target?.nodeName !== 'BUTTON') setState('show', 'endPage', undefined);\n    focus();\n  };\n  let ref; // oxlint-disable-line no-unassigned-vars\n\n  const [isDrag, setIsDrag] = solidJs.createSignal(false);\n  const [dragY, setDragY] = solidJs.createSignal(0);\n  const handleDrag = ({\n    type,\n    xy: [, y],\n    initial: [, iy],\n    startTime\n  }) => {\n    switch (type) {\n      case 'down':\n        return setIsDrag(true);\n      case 'move':\n        return setDragY(y - iy);\n    }\n    const pageDir = getTurnPageDir(-dragY(), store.rootSize.height / 2, startTime);\n    if (pageDir) handleEndTurnPage(pageDir);\n    setDragY(0);\n    setIsDrag(false);\n  };\n  solidJs.onMount(() => {\n    helper.useDrag({\n      ref,\n      handleDrag,\n      skip: e => e.target.matches(`.${modules_c21c94f2$1.comments}, .${modules_c21c94f2$1.comments} *`)\n    });\n  });\n\n  // state.show.endPage å˜é‡çš„å»¶æ—¶ç‰ˆæœ¬ï¼Œåœ¨éšè—çš„åŠ¨ç”»æ•ˆæœç»“æŸä¹‹åæ‰ä¼šçœŸæ­£æ”¹å˜\n  // é˜²æ­¢åœ¨åŠ¨ç”»æ•ˆæœç»“æŸå‰ tip å°±æ¶ˆå¤±æˆ–æ”¹å˜äº†ä½ç½®\n  const [delayType, setDelayType] = solidJs.createSignal();\n  solidJs.createEffect(() => {\n    if (store.show.endPage) {\n      window.clearTimeout(delayTypeTimer);\n      setDelayType(store.show.endPage);\n    } else {\n      delayTypeTimer = window.setTimeout(() => setDelayType(store.show.endPage), 500);\n    }\n  });\n  const tip = solidJs.createMemo(() => {\n    if (store.option.scroolEnd === 'none') return '';\n    switch (delayType()) {\n      case 'start':\n        if (!store.prop.onPrev || store.option.scroolEnd !== 'auto') break;\n        return helper.t('end_page.tip.start_jump');\n      case 'end':\n        if (store.prop.onNext && store.option.scroolEnd === 'auto') return helper.t('end_page.tip.end_jump');\n        if (store.prop.onExit) return helper.t('end_page.tip.exit');\n    }\n    return '';\n  });\n  return (() => {\n    var _el$ = web.template(`<div role=button tabindex=-1><div><p></p><button type=button></button><button type=button data-is-end></button><button type=button>`)(),\n      _el$2 = _el$.firstChild,\n      _el$3 = _el$2.firstChild,\n      _el$4 = _el$3.nextSibling,\n      _el$5 = _el$4.nextSibling,\n      _el$6 = _el$5.nextSibling;\n    web.addEventListener(_el$, \"click\", handleClick);\n    var _ref$ = ref;\n    typeof _ref$ === \"function\" ? web.use(_ref$, _el$) : ref = _el$;\n    web.insert(_el$3, tip);\n    web.addEventListener(_el$4, \"click\", () => store.prop.onPrev?.());\n    var _ref$2 = bindRef('prev');\n    typeof _ref$2 === \"function\" && web.use(_ref$2, _el$4);\n    web.insert(_el$4, () => helper.t('end_page.prev_button'));\n    web.addEventListener(_el$5, \"click\", () => store.prop.onExit?.(store.show.endPage === 'end'));\n    var _ref$3 = bindRef('exit');\n    typeof _ref$3 === \"function\" && web.use(_ref$3, _el$5);\n    web.insert(_el$5, () => helper.t('other.exit'));\n    web.addEventListener(_el$6, \"click\", () => store.prop.onNext?.());\n    var _ref$4 = bindRef('next');\n    typeof _ref$4 === \"function\" && web.use(_ref$4, _el$6);\n    web.insert(_el$6, () => helper.t('end_page.next_button'));\n    web.insert(_el$2, web.createComponent(solidJs.Show, {\n      get when() {\n        return web.memo(() => !!(store.option.showComment && delayType() === 'end'))() && store.commentList?.length;\n      },\n      get children() {\n        var _el$7 = web.template(`<div>`)();\n        web.addEventListener(_el$7, \"wheel\", stopPropagation);\n        web.insert(_el$7, web.createComponent(solidJs.For, {\n          get each() {\n            return store.commentList;\n          },\n          children: comment => (() => {\n            var _el$8 = web.template(`<p>`)();\n            web.insert(_el$8, comment);\n            return _el$8;\n          })()\n        }));\n        web.effect(() => web.className(_el$7, `${modules_c21c94f2$1.comments} ${modules_c21c94f2$1.beautifyScrollbar}`));\n        return _el$7;\n      }\n    }), null);\n    web.effect(_p$ => {\n      var _v$ = modules_c21c94f2$1.endPage,\n        _v$2 = store.show.endPage,\n        _v$3 = delayType(),\n        _v$4 = helper.boolDataVal(isDrag()),\n        _v$5 = dir() === 'rtl' ? 'row-reverse' : undefined,\n        _v$6 = modules_c21c94f2$1.endPageBody,\n        _v$7 = `${dragY()}px`,\n        _v$8 = modules_c21c94f2$1.tip,\n        _v$9 = {\n          [modules_c21c94f2$1.invisible]: !store.prop.onPrev\n        },\n        _v$0 = store.show.endPage ? 0 : -1,\n        _v$1 = store.show.endPage ? 0 : -1,\n        _v$10 = {\n          [modules_c21c94f2$1.invisible]: !store.prop.onNext\n        },\n        _v$11 = store.show.endPage ? 0 : -1;\n      _v$ !== _p$.e && web.className(_el$, _p$.e = _v$);\n      _v$2 !== _p$.t && web.setAttribute(_el$, \"data-show\", _p$.t = _v$2);\n      _v$3 !== _p$.a && web.setAttribute(_el$, \"data-type\", _p$.a = _v$3);\n      _v$4 !== _p$.o && web.setAttribute(_el$, \"data-drag\", _p$.o = _v$4);\n      _v$5 !== _p$.i && web.setStyleProperty(_el$, \"flex-direction\", _p$.i = _v$5);\n      _v$6 !== _p$.n && web.className(_el$2, _p$.n = _v$6);\n      _v$7 !== _p$.s && web.setStyleProperty(_el$2, \"--drag-y\", _p$.s = _v$7);\n      _v$8 !== _p$.h && web.className(_el$3, _p$.h = _v$8);\n      _p$.r = web.classList(_el$4, _v$9, _p$.r);\n      _v$0 !== _p$.d && web.setAttribute(_el$4, \"tabindex\", _p$.d = _v$0);\n      _v$1 !== _p$.l && web.setAttribute(_el$5, \"tabindex\", _p$.l = _v$1);\n      _p$.u = web.classList(_el$6, _v$10, _p$.u);\n      _v$11 !== _p$.c && web.setAttribute(_el$6, \"tabindex\", _p$.c = _v$11);\n      return _p$;\n    }, {\n      e: undefined,\n      t: undefined,\n      a: undefined,\n      o: undefined,\n      i: undefined,\n      n: undefined,\n      s: undefined,\n      h: undefined,\n      r: undefined,\n      d: undefined,\n      l: undefined,\n      u: undefined,\n      c: undefined\n    });\n    return _el$;\n  })();\n};\n\nconst getScrollbarPage = (img, i, double = false) => {\n  let num;\n  if (store.option.scrollMode.enabled) num = getImg(i).size.height;else num = double ? 2 : 1;\n  let upscale;\n  if (isUpscale() && img.upscaleUrl !== undefined) upscale = img.upscaleUrl === '' ? 'loading' : true;\n  return {\n    num,\n    loadType: img.loadType,\n    translationType: img.translationType,\n    upscale\n  };\n};\nconst ScrollbarPage = props => (() => {\n  var _el$ = web.template(`<div>`)();\n  web.effect(_p$ => {\n    var _v$ = modules_c21c94f2$1.scrollbarPage,\n      _v$2 = `${props.num / scrollLength() * 100}%`,\n      _v$3 = props.loadType,\n      _v$4 = props.translationType,\n      _v$5 = props.upscale;\n    _v$ !== _p$.e && web.className(_el$, _p$.e = _v$);\n    _v$2 !== _p$.t && web.setStyleProperty(_el$, \"flex-basis\", _p$.t = _v$2);\n    _v$3 !== _p$.a && web.setAttribute(_el$, \"data-type\", _p$.a = _v$3);\n    _v$4 !== _p$.o && web.setAttribute(_el$, \"data-translation-type\", _p$.o = _v$4);\n    _v$5 !== _p$.i && web.setAttribute(_el$, \"data-upscale\", _p$.i = _v$5);\n    return _p$;\n  }, {\n    e: undefined,\n    t: undefined,\n    a: undefined,\n    o: undefined,\n    i: undefined\n  });\n  return _el$;\n})();\nconst isSameItem = (a, b) => a.loadType === b.loadType && a.translationType === b.translationType && a.upscale === b.upscale;\n\n/** æ˜¾ç¤ºå¯¹åº”å›¾ç‰‡åŠ è½½æƒ…å†µçš„å…ƒç´  */\nconst ScrollbarPageStatus = () => {\n  // å°†ç›¸åŒç±»å‹çš„é¡µé¢åˆå¹¶æ˜¾ç¤º\n  const scrollbarPageList = helper.createThrottleMemo(() => {\n    if (store.pageList.length === 0) return [];\n    const list = [];\n    let item;\n    const handleImg = (i, double = false) => {\n      const img = getImg(i);\n      const imgItem = getScrollbarPage(img, i, double);\n      if (!item) {\n        item = imgItem;\n        return;\n      }\n      if (isSameItem(item, imgItem)) {\n        if (store.option.scrollMode.enabled) item.num += img.size.height;else item.num += double ? 2 : 1;\n      } else {\n        list.push(item);\n        item = getScrollbarPage(img, i, double);\n      }\n    };\n    for (const [a, b] of store.pageList) {\n      if (b === undefined) handleImg(a, !isOnePageMode());else if (a === -1) {\n        handleImg(b);\n        handleImg(b);\n      } else if (b === -1) {\n        handleImg(a);\n        handleImg(a);\n      } else {\n        handleImg(a);\n        handleImg(b);\n      }\n    }\n    if (item) list.push(item);\n    return list;\n  }, 200);\n  return web.createComponent(solidJs.For, {\n    get each() {\n      return scrollbarPageList();\n    },\n    children: page => web.createComponent(ScrollbarPage, page)\n  });\n};\n\n\n/** æ»šåŠ¨æ¡ */\nconst Scrollbar = () => {\n  solidJs.onMount(() => {\n    helper.useDrag({\n      ref: refs.scrollbar,\n      handleDrag: handleScrollbarSlider,\n      easyMode: () => isScrollMode() && store.option.scrollbar.easyScroll,\n      setCapture: true\n    });\n    watchDomSize('scrollbarSize', refs.scrollbar);\n  });\n\n  // åœ¨è¢«æ»šåŠ¨æ—¶ä½¿è‡ªèº«å¯ç©¿é€ï¼Œä»¥ä¾¿åœ¨å·è½´æ¨¡å¼ä¸‹è§¦å‘é¡µé¢çš„æ»šåŠ¨\n  const [penetrate, setPenetrate] = solidJs.createSignal(false);\n  const resetPenetrate = helper.debounce(() => setPenetrate(false));\n  const handleWheel = () => {\n    setPenetrate(true);\n    resetPenetrate();\n  };\n\n  /** æ˜¯å¦å¼ºåˆ¶æ˜¾ç¤ºæ»šåŠ¨æ¡ */\n  const showScrollbar = solidJs.createMemo(() => store.show.scrollbar || Boolean(penetrate()));\n\n  /** æ»šåŠ¨æ¡æç¤ºæ–‡æœ¬ */\n  const tipText = helper.createThrottleMemo(() => {\n    if (store.showRange[0] === store.showRange[1]) return getPageTip(store.showRange[0]);\n\n    /** å¹¶æ’å·è½´æ¨¡å¼ä¸‹çš„æ»šåŠ¨æ¡æç¤ºæ–‡æœ¬ */\n    if (isAbreastMode()) {\n      const columns = abreastArea().columns.slice(abreastShowColumn().start, abreastShowColumn().end + 1).map(column => column.map(getPageTip));\n      if (store.option.dir !== 'rtl') columns.reverse();\n      return columns.map(column => column.join(' ')).join('\\n');\n    }\n    const tipList = [];\n    for (let [i] = store.showRange; i <= store.showRange[1]; i++) tipList.push(getPageTip(i));\n    if (isOnePageMode() || isDoubleMode()) return tipList.join('\\n');\n    if (tipList.length === 1) return tipList[0];\n    if (store.option.dir === 'rtl') tipList.reverse();\n    return tipList.join('   ');\n  });\n  useStyleMemo(`.${modules_c21c94f2$1.scrollbar}`, {\n    'pointer-events': () => penetrate() || store.isDragMode || store.gridMode ? 'none' : 'auto',\n    '--scroll-length': () => `${scrollDomLength()}px`,\n    '--slider-midpoint': () => `${sliderMidpoint()}px`,\n    '--slider-height': () => `${sliderHeight() * scrollDomLength()}px`,\n    '--slider-top': sliderTop\n  });\n  const _Scrollbar = props => (() => {\n    var _el$ = web.template(`<div role=scrollbar tabindex=-1>`)();\n    _el$.addEventListener(\"wheel\", handleWheel);\n    var _ref$ = props.ref;\n    typeof _ref$ === \"function\" ? web.use(_ref$, _el$) : props.ref = _el$;\n    web.insert(_el$, () => props.children);\n    web.effect(_p$ => {\n      var _v$ = modules_c21c94f2$1.scrollbar,\n        _v$2 = modules_c21c94f2$1.mangaFlow,\n        _v$3 = store.activePageIndex || -1,\n        _v$4 = helper.boolDataVal(store.option.scrollbar.autoHidden),\n        _v$5 = helper.boolDataVal(showScrollbar()),\n        _v$6 = store.option.dir,\n        _v$7 = scrollPosition(),\n        _v$8 = helper.boolDataVal(isAbreastMode()),\n        _v$9 = helper.boolDataVal(isDrag()),\n        _v$0 = props.style;\n      _v$ !== _p$.e && web.className(_el$, _p$.e = _v$);\n      _v$2 !== _p$.t && web.setAttribute(_el$, \"aria-controls\", _p$.t = _v$2);\n      _v$3 !== _p$.a && web.setAttribute(_el$, \"aria-valuenow\", _p$.a = _v$3);\n      _v$4 !== _p$.o && web.setAttribute(_el$, \"data-auto-hidden\", _p$.o = _v$4);\n      _v$5 !== _p$.i && web.setAttribute(_el$, \"data-force-show\", _p$.i = _v$5);\n      _v$6 !== _p$.n && web.setAttribute(_el$, \"data-dir\", _p$.n = _v$6);\n      _v$7 !== _p$.s && web.setAttribute(_el$, \"data-position\", _p$.s = _v$7);\n      _v$8 !== _p$.h && web.setAttribute(_el$, \"data-is-abreast-mode\", _p$.h = _v$8);\n      _v$9 !== _p$.r && web.setAttribute(_el$, \"data-drag\", _p$.r = _v$9);\n      _p$.d = web.style(_el$, _v$0, _p$.d);\n      return _p$;\n    }, {\n      e: undefined,\n      t: undefined,\n      a: undefined,\n      o: undefined,\n      i: undefined,\n      n: undefined,\n      s: undefined,\n      h: undefined,\n      r: undefined,\n      d: undefined\n    });\n    return _el$;\n  })();\n  return [web.createComponent(_Scrollbar, {\n    ref(r$) {\n      var _ref$2 = bindRef('scrollbar');\n      typeof _ref$2 === \"function\" && _ref$2(r$);\n    },\n    get children() {\n      return [(() => {\n        var _el$2 = web.template(`<div>`)();\n        web.insert(_el$2, tipText);\n        web.effect(() => web.className(_el$2, modules_c21c94f2$1.scrollbarPoper));\n        return _el$2;\n      })(), web.createComponent(solidJs.Show, {\n        get when() {\n          return store.option.scrollbar.showImgStatus;\n        },\n        get children() {\n          return web.createComponent(ScrollbarPageStatus, {});\n        }\n      })];\n    }\n  }), web.createComponent(_Scrollbar, {\n    style: {\n      'mix-blend-mode': 'difference',\n      'pointer-events': 'none'\n    },\n    get children() {\n      var _el$3 = web.template(`<div>`)();\n      web.effect(_p$ => {\n        var _v$1 = modules_c21c94f2$1.scrollbarSlider,\n          _v$10 = {\n            [modules_c21c94f2$1.hidden]: store.gridMode\n          };\n        _v$1 !== _p$.e && web.className(_el$3, _p$.e = _v$1);\n        _p$.t = web.classList(_el$3, _v$10, _p$.t);\n        return _p$;\n      }, {\n        e: undefined,\n        t: undefined\n      });\n      return _el$3;\n    }\n  })];\n};\n\nconst MdClose = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59 7.11 5.7A.996.996 0 1 0 5.7 7.11L10.59 12 5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdFullscreenExit = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M6 16h2v2c0 .55.45 1 1 1s1-.45 1-1v-3c0-.55-.45-1-1-1H6c-.55 0-1 .45-1 1s.45 1 1 1m2-8H6c-.55 0-1 .45-1 1s.45 1 1 1h3c.55 0 1-.45 1-1V6c0-.55-.45-1-1-1s-1 .45-1 1zm7 11c.55 0 1-.45 1-1v-2h2c.55 0 1-.45 1-1s-.45-1-1-1h-3c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1m1-11V6c0-.55-.45-1-1-1s-1 .45-1 1v3c0 .55.45 1 1 1h3c.55 0 1-.45 1-1s-.45-1-1-1z\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdFullscreen = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M6 14c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1h3c.55 0 1-.45 1-1s-.45-1-1-1H7v-2c0-.55-.45-1-1-1m0-4c.55 0 1-.45 1-1V7h2c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1m11 7h-2c-.55 0-1 .45-1 1s.45 1 1 1h3c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1s-1 .45-1 1zM14 6c0 .55.45 1 1 1h2v2c0 .55.45 1 1 1s1-.45 1-1V6c0-.55-.45-1-1-1h-3c-.55 0-1 .45-1 1\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdGrid = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M22 6c0-.55-.45-1-1-1h-2V3c0-.55-.45-1-1-1s-1 .45-1 1v2h-4V3c0-.55-.45-1-1-1s-1 .45-1 1v2H7V3c0-.55-.45-1-1-1s-1 .45-1 1v2H3c-.55 0-1 .45-1 1s.45 1 1 1h2v4H3c-.55 0-1 .45-1 1s.45 1 1 1h2v4H3c-.55 0-1 .45-1 1s.45 1 1 1h2v2c0 .55.45 1 1 1s1-.45 1-1v-2h4v2c0 .55.45 1 1 1s1-.45 1-1v-2h4v2c0 .55.45 1 1 1s1-.45 1-1v-2h2c.55 0 1-.45 1-1s-.45-1-1-1h-2v-4h2c.55 0 1-.45 1-1s-.45-1-1-1h-2V7h2c.55 0 1-.45 1-1M7 7h4v4H7zm0 10v-4h4v4zm10 0h-4v-4h4zm0-6h-4V7h4z\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdLooksOne = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-6 14c-.55 0-1-.45-1-1V9h-1c-.55 0-1-.45-1-1s.45-1 1-1h2c.55 0 1 .45 1 1v8c0 .55-.45 1-1 1\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdLooksTwo = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-4 8c0 1.1-.9 2-2 2h-2v2h3c.55 0 1 .45 1 1s-.45 1-1 1h-4c-.55 0-1-.45-1-1v-3c0-1.1.9-2 2-2h2V9h-3c-.55 0-1-.45-1-1s.45-1 1-1h3c1.1 0 2 .9 2 2z\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdLowPriority = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M15 5h6c.55 0 1 .45 1 1s-.45 1-1 1h-6c-.55 0-1-.45-1-1s.45-1 1-1m0 5.5h6c.55 0 1 .45 1 1s-.45 1-1 1h-6c-.55 0-1-.45-1-1s.45-1 1-1m0 5.5h6c.55 0 1 .45 1 1s-.45 1-1 1h-6c-.55 0-1-.45-1-1s.45-1 1-1m-5.15 3.15 1.79-1.79c.2-.2.2-.51 0-.71l-1.79-1.79a.495.495 0 0 0-.85.35v3.59c0 .44.54.66.85.35M9 16h-.3c-2.35 0-4.45-1.71-4.68-4.05A4.51 4.51 0 0 1 8.5 7H11c.55 0 1-.45 1-1s-.45-1-1-1H8.5c-3.86 0-6.96 3.4-6.44 7.36C2.48 15.64 5.43 18 8.73 18H9\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdQueue = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M3 6c-.55 0-1 .45-1 1v13c0 1.1.9 2 2 2h13c.55 0 1-.45 1-1s-.45-1-1-1H5c-.55 0-1-.45-1-1V7c0-.55-.45-1-1-1m17-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-2 9h-3v3c0 .55-.45 1-1 1s-1-.45-1-1v-3h-3c-.55 0-1-.45-1-1s.45-1 1-1h3V6c0-.55.45-1 1-1s1 .45 1 1v3h3c.55 0 1 .45 1 1s-.45 1-1 1\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdSettings = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M19.5 12c0-.23-.01-.45-.03-.68l1.86-1.41c.4-.3.51-.86.26-1.3l-1.87-3.23a.987.987 0 0 0-1.25-.42l-2.15.91c-.37-.26-.76-.49-1.17-.68l-.29-2.31c-.06-.5-.49-.88-.99-.88h-3.73c-.51 0-.94.38-1 .88l-.29 2.31c-.41.19-.8.42-1.17.68l-2.15-.91c-.46-.2-1-.02-1.25.42L2.41 8.62c-.25.44-.14.99.26 1.3l1.86 1.41a7.3 7.3 0 0 0 0 1.35l-1.86 1.41c-.4.3-.51.86-.26 1.3l1.87 3.23c.25.44.79.62 1.25.42l2.15-.91c.37.26.76.49 1.17.68l.29 2.31c.06.5.49.88.99.88h3.73c.5 0 .93-.38.99-.88l.29-2.31c.41-.19.8-.42 1.17-.68l2.15.91c.46.2 1 .02 1.25-.42l1.87-3.23c.25-.44.14-.99-.26-1.3l-1.86-1.41c.03-.23.04-.45.04-.68m-7.46 3.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdTranslate = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M12.65 15.67c.14-.36.05-.77-.23-1.05l-2.09-2.06.03-.03A17.5 17.5 0 0 0 14.07 6h1.94c.54 0 .99-.45.99-.99v-.02c0-.54-.45-.99-.99-.99H10V3c0-.55-.45-1-1-1s-1 .45-1 1v1H1.99c-.54 0-.99.45-.99.99 0 .55.45.99.99.99h10.18A15.7 15.7 0 0 1 9 11.35c-.81-.89-1.49-1.86-2.06-2.88A.89.89 0 0 0 6.16 8c-.69 0-1.13.75-.79 1.35.63 1.13 1.4 2.21 2.3 3.21L3.3 16.87a.99.99 0 0 0 0 1.42c.39.39 1.02.39 1.42 0L9 14l2.02 2.02c.51.51 1.38.32 1.63-.35M17.5 10c-.6 0-1.14.37-1.35.94l-3.67 9.8c-.24.61.22 1.26.87 1.26.39 0 .74-.24.88-.61l.89-2.39h4.75l.9 2.39c.14.36.49.61.88.61.65 0 1.11-.65.88-1.26l-3.67-9.8c-.22-.57-.76-.94-1.36-.94m-1.62 7 1.62-4.33L19.12 17z\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdViewDay = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M3 21h17c.55 0 1-.45 1-1v-1c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v1c0 .55.45 1 1 1M20 8H3c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h17c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1M2 4v1c0 .55.45 1 1 1h17c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdZoomIn = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34-4.23-.52-7.78 3.04-7.27 7.27.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.26 4.25c.41.41 1.07.41 1.48 0l.01-.01c.41-.41.41-1.07 0-1.48zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14m0-7c-.28 0-.5.22-.5.5V9H7.5c-.28 0-.5.22-.5.5s.22.5.5.5H9v1.5c0 .28.22.5.5.5s.5-.22.5-.5V10h1.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5H10V7.5c0-.28-.22-.5-.5-.5\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdZoomOut = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.26 4.25c.41.41 1.07.41 1.48 0l.01-.01c.41-.41.41-1.07 0-1.48zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14m-2-5h4c.28 0 .5.22.5.5s-.22.5-.5.5h-4c-.28 0-.5-.22-.5-.5s.22-.5.5-.5\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nvar css = \".iconButtonItem____hash_base64_5_{align-items:center;display:flex;position:relative}.iconButton____hash_base64_5_{align-items:center;background-color:initial;border-radius:9999px;border-style:none;color:var(--text,#fff);cursor:pointer;display:flex;font-size:1.5em;height:1.5em;justify-content:center;margin:.1em;outline:none;padding:0;width:1.5em}.iconButton____hash_base64_5_:focus,.iconButton____hash_base64_5_:hover{background-color:var(--hover-bg-color,#fff3)}.iconButton____hash_base64_5_.enabled____hash_base64_5_:not(.disable____hash_base64_5_){background-color:var(--text,#fff);color:var(--text-bg,#121212)}.iconButton____hash_base64_5_.enabled____hash_base64_5_:not(.disable____hash_base64_5_):focus,.iconButton____hash_base64_5_.enabled____hash_base64_5_:not(.disable____hash_base64_5_):hover{background-color:var(--hover-bg-color-enable,#fffa)}.iconButton____hash_base64_5_.disable____hash_base64_5_{background-color:unset;cursor:not-allowed;opacity:.5}.iconButton____hash_base64_5_>svg{width:1em}.iconButtonPopper____hash_base64_5_{align-items:center;background-color:#303030;border-radius:.3em;color:#fff;display:flex;font-size:.8em;opacity:0;padding:.4em .5em;pointer-events:none;position:absolute;top:50%;transform:translateY(-50%);-webkit-user-select:none;user-select:none;white-space:nowrap}.iconButtonPopper____hash_base64_5_[data-placement=right]{left:calc(100% + 1.5em)}.iconButtonPopper____hash_base64_5_[data-placement=right]:before{border-right-color:var(--switch-bg,#6e6e6e);border-right-width:.5em;right:calc(100% + .5em)}.iconButtonPopper____hash_base64_5_[data-placement=left]{right:calc(100% + 1.5em)}.iconButtonPopper____hash_base64_5_[data-placement=left]:before{border-left-color:var(--switch-bg,#6e6e6e);border-left-width:.5em;left:calc(100% + .5em)}.iconButtonPopper____hash_base64_5_:before{background-color:initial;border:.4em solid #0000;content:\\\"\\\";pointer-events:none;position:absolute;transition:opacity .15s}.iconButtonItem____hash_base64_5_:is(:hover,:focus,[data-show=true]) .iconButtonPopper____hash_base64_5_{opacity:1}.hidden____hash_base64_5_{display:none}\";\nvar modules_c21c94f2 = {\"iconButtonItem\":\"iconButtonItem____hash_base64_5_\",\"iconButton\":\"iconButton____hash_base64_5_\",\"enabled\":\"enabled____hash_base64_5_\",\"disable\":\"disable____hash_base64_5_\",\"iconButtonPopper\":\"iconButtonPopper____hash_base64_5_\",\"hidden\":\"hidden____hash_base64_5_\"};\n\n/** å›¾æ ‡æŒ‰é’® */\nconst IconButton = _props => {\n  const props = solidJs.mergeProps({\n    placement: 'right'\n  }, _props);\n  let buttonRef; // oxlint-disable-line no-unassigned-vars\n  const handleClick = e => {\n    if (props.disable) return;\n    props.onClick?.(e);\n    // åœ¨æ¯æ¬¡ç‚¹å‡»åå–æ¶ˆç„¦ç‚¹\n    buttonRef?.blur();\n  };\n  return (() => {\n    var _el$ = web.template(`<div><button type=button tabindex=0>`)(),\n      _el$2 = _el$.firstChild;\n    web.use(ref => helper.useStyle(css, ref), _el$);\n    web.addEventListener(_el$2, \"click\", handleClick);\n    var _ref$ = buttonRef;\n    typeof _ref$ === \"function\" ? web.use(_ref$, _el$2) : buttonRef = _el$2;\n    web.insert(_el$2, () => props.children);\n    web.insert(_el$, (() => {\n      var _c$ = web.memo(() => !!(props.popper || props.tip));\n      return () => _c$() ? (() => {\n        var _el$3 = web.template(`<div>`)();\n        web.insert(_el$3, () => props.popper || props.tip);\n        web.effect(_p$ => {\n          var _v$7 = [modules_c21c94f2.iconButtonPopper, props.popperClassName].join(' '),\n            _v$8 = props.placement;\n          _v$7 !== _p$.e && web.className(_el$3, _p$.e = _v$7);\n          _v$8 !== _p$.t && web.setAttribute(_el$3, \"data-placement\", _p$.t = _v$8);\n          return _p$;\n        }, {\n          e: undefined,\n          t: undefined\n        });\n        return _el$3;\n      })() : null;\n    })(), null);\n    web.effect(_p$ => {\n      var _v$ = modules_c21c94f2.iconButtonItem,\n        _v$2 = props.showTip,\n        _v$3 = props.tip,\n        _v$4 = modules_c21c94f2.iconButton,\n        _v$5 = props.style,\n        _v$6 = {\n          [modules_c21c94f2.hidden]: props.hidden,\n          [modules_c21c94f2.enabled]: props.enabled,\n          [modules_c21c94f2.disable]: props.disable\n        };\n      _v$ !== _p$.e && web.className(_el$, _p$.e = _v$);\n      _v$2 !== _p$.t && web.setAttribute(_el$, \"data-show\", _p$.t = _v$2);\n      _v$3 !== _p$.a && web.setAttribute(_el$2, \"aria-label\", _p$.a = _v$3);\n      _v$4 !== _p$.o && web.className(_el$2, _p$.o = _v$4);\n      _p$.i = web.style(_el$2, _v$5, _p$.i);\n      _p$.n = web.classList(_el$2, _v$6, _p$.n);\n      return _p$;\n    }, {\n      e: undefined,\n      t: undefined,\n      a: undefined,\n      o: undefined,\n      i: undefined,\n      n: undefined\n    });\n    return _el$;\n  })();\n};\n\nconst MdPlayArrow = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M8 6.82v10.36c0 .79.87 1.27 1.54.84l8.14-5.18a1 1 0 0 0 0-1.69L9.54 5.98A.998.998 0 0 0 8 6.82\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdStop = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M8 6h8c1.1 0 2 .9 2 2v8c0 1.1-.9 2-2 2H8c-1.1 0-2-.9-2-2V8c0-1.1.9-2 2-2\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst autoScroll = new class extends helper.AnimationFrame {\n  /** ä¸Šæ¬¡æ»šåŠ¨çš„æ—¶é—´ */\n  lastTime = 0;\n  scroll = () => {\n    if (isBottom()) {\n      this.stop();\n      if (!store.prop.onExit) return;\n      setState('show', 'endPage', 'end');\n      if (store.option.autoScroll.triggerEnd) setTimeout(handleEndTurnPage, 500, 'next');\n      return;\n    }\n    handleHotkey('page_down');\n  };\n  frame = timestamp => {\n    const elapsed = timestamp - this.lastTime;\n    let progress;\n    if (elapsed >= store.option.autoScroll.interval) {\n      this.lastTime = timestamp;\n      this.scroll();\n      progress = 1;\n    }\n    if (!store.autoScroll.play) return;\n    progress ||= elapsed / store.option.autoScroll.interval;\n    setState('autoScroll', 'progress', progress);\n    this.call();\n  };\n  start = () => {\n    this.lastTime = 0;\n    this.call();\n  };\n  stop = () => {\n    this.cancel();\n    setState('autoScroll', 'play', false);\n  };\n}();\nhelper.createEffectOn(() => [...Object.values(store.option.autoScroll), store.autoScroll.play], () => {\n  autoScroll.cancel();\n  if (!store.option.autoScroll.enabled || !store.autoScroll.play) return;\n  autoScroll.start();\n});\n\n// ç‚¹å‡»å±å¹•ä¸­é—´åœæ­¢è‡ªåŠ¨æ»šåŠ¨\nhelper.createEffectOn(() => store.show.toolbar, show => show && autoScroll.stop());\nconst AutoScrollButton = () => {\n  const background = solidJs.createMemo(() => {\n    if (!store.autoScroll.play) return undefined;\n    const deg = store.autoScroll.progress * 360 % 360;\n    return `conic-gradient(var(--text-secondary) 0deg, var(--text-secondary) ${deg}deg, var(--text) ${deg}deg)`;\n  });\n  return web.createComponent(IconButton, {\n    get tip() {\n      return helper.t('button.auto_scroll');\n    },\n    get enabled() {\n      return store.autoScroll.play;\n    },\n    get style() {\n      return {\n        background: background()\n      };\n    },\n    onClick: switchAutoScroll,\n    get children() {\n      return web.memo(() => !!store.autoScroll.play)() ? web.createComponent(MdStop, {}) : web.createComponent(MdPlayArrow, {});\n    }\n  });\n};\n\nconst MdFileDownload = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M16.59 9H15V4c0-.55-.45-1-1-1h-4c-.55 0-1 .45-1 1v5H7.41c-.89 0-1.34 1.08-.71 1.71l4.59 4.59c.39.39 1.02.39 1.41 0l4.59-4.59c.63-.63.19-1.71-.7-1.71M5 19c0 .55.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1 .45-1 1\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst getExtName = mime => /.+\\/([^;]+)/.exec(mime)?.[1] ?? 'jpg';\n\n/** ä¸‹è½½æŒ‰é’® */\nconst DownloadButton = () => {\n  const {\n    store: state,\n    setState\n  } = helper.useStore({\n    length: 0,\n    /** undefined è¡¨ç¤ºæœªå¼€å§‹ä¸‹è½½ï¼Œç­‰äº length è¡¨ç¤ºæ­£åœ¨æ‰“åŒ…ï¼Œ-1 è¡¨ç¤ºä¸‹è½½å®Œæˆ */\n    completedNum: undefined,\n    errorNum: 0,\n    rawTitle: document.title,\n    showRawTitle: true\n  });\n  const progress = new helper.FaviconProgress();\n  const handleDownload = async () => {\n    const fileData = {};\n    setState({\n      errorNum: 0,\n      length: imgList().length\n    });\n    if (state.showRawTitle) setState('rawTitle', document.title);\n    const imgIndexNum = `${state.length}`.length;\n    for (let i = 0; i < state.length; i += 1) {\n      setState('completedNum', i);\n      const img = imgList()[i];\n      if (store.option.translation.onlyDownloadTranslated && img.translationType !== 'show') continue;\n      let url;\n      if (img.translationType === 'show') url = img.translationUrl;else if (img.upscaleUrl && isUpscale()) url = img.upscaleUrl;else url = img.src;\n      let data;\n      let fileName;\n      const index = `${i}`.padStart(imgIndexNum, '0');\n      try {\n        data = await downloadImg(url);\n        fileName = img.name || `${index}.${getExtName(data.type)}`;\n      } catch {\n        fileName = `${index} - ${helper.t('alert.download_failed')}`;\n        setState('errorNum', num => num + 1);\n      }\n      fileData[fileName] = new Uint8Array((await data?.arrayBuffer()) ?? []);\n    }\n    if (Object.keys(fileData).length === 0) {\n      Toast.toast.warn(helper.t('alert.no_img_download'));\n      setState('completedNum', undefined);\n      return;\n    }\n    setState('completedNum', state.length);\n    const zipped = fflate.zipSync(fileData, {\n      level: 0,\n      comment: location.href\n    });\n    helper.saveAs(new Blob([zipped]), `${store.title || state.rawTitle}.zip`);\n    setState('completedNum', -1);\n    Toast.toast(state.errorNum > 0 ? helper.t('button.download_completed_error', {\n      errorNum: state.errorNum\n    }) : helper.t('button.download_completed'), {\n      type: state.errorNum > 0 ? 'warn' : 'success',\n      onDismiss() {\n        document.title = state.rawTitle;\n        setState('showRawTitle', true);\n        progress.recover();\n      }\n    });\n  };\n  const tip = solidJs.createMemo(() => {\n    switch (state.completedNum) {\n      case undefined:\n        return helper.t('other.download');\n      case state.length:\n        return helper.t('button.packaging');\n      case -1:\n        return helper.t('button.download_completed');\n      default:\n        return `${helper.t('button.downloading')} - ${state.completedNum}/${state.length}`;\n    }\n  });\n\n  // æ ¹æ®ä¸‹è½½è¿›åº¦æ›´æ–°ç½‘é¡µæ ‡é¢˜\n  helper.createEffectOn(() => state.completedNum, num => {\n    let showTip = '';\n    switch (num) {\n      case undefined:\n        return;\n      case state.length:\n        showTip = 'ğŸ“¦';\n        break;\n      case -1:\n        showTip = state.errorNum > 0 ? `â—[${state.errorNum}]` : 'âœ…';\n        break;\n      default:\n        showTip = `${num}/${state.length}`;\n    }\n    document.title = `${showTip} - ${state.rawTitle}`;\n    setState('showRawTitle', false);\n  }, {\n    defer: true\n  });\n\n  // æ ¹æ®ä¸‹è½½è¿›åº¦æ›´æ–°ç½‘é¡µå›¾æ ‡\n  helper.createEffectOn(() => state.completedNum, num => num && num > 0 && progress.update(num / state.length), {\n    defer: true\n  });\n  return web.createComponent(IconButton$1.IconButton, {\n    get tip() {\n      return tip();\n    },\n    onClick: handleDownload,\n    get enabled() {\n      return state.completedNum !== undefined;\n    },\n    get children() {\n      return web.createComponent(MdFileDownload, {});\n    }\n  });\n};\n\nconst MdOutlineFormatTextdirectionLToR = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M9 10v4c0 .55.45 1 1 1s1-.45 1-1V4h2v10c0 .55.45 1 1 1s1-.45 1-1V4h1c.55 0 1-.45 1-1s-.45-1-1-1H9.17C7.08 2 5.22 3.53 5.02 5.61A4 4 0 0 0 9 10m11.65 7.65-2.79-2.79a.501.501 0 0 0-.86.35V17H6c-.55 0-1 .45-1 1s.45 1 1 1h11v1.79c0 .45.54.67.85.35l2.79-2.79c.2-.19.2-.51.01-.7\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdOutlineFormatTextdirectionRToL = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M10 10v4c0 .55.45 1 1 1s1-.45 1-1V4h2v10c0 .55.45 1 1 1s1-.45 1-1V4h1c.55 0 1-.45 1-1s-.45-1-1-1h-6.83C8.08 2 6.22 3.53 6.02 5.61A4 4 0 0 0 10 10m-2 7v-1.79c0-.45-.54-.67-.85-.35l-2.79 2.79c-.2.2-.2.51 0 .71l2.79 2.79a.5.5 0 0 0 .85-.36V19h11c.55 0 1-.45 1-1s-.45-1-1-1z\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdAdd = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M18 13h-5v5c0 .55-.45 1-1 1s-1-.45-1-1v-5H6c-.55 0-1-.45-1-1s.45-1 1-1h5V6c0-.55.45-1 1-1s1 .45 1 1v5h5c.55 0 1 .45 1 1s-.45 1-1 1\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdRefresh = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M17.65 6.35a7.95 7.95 0 0 0-6.48-2.31c-3.67.37-6.69 3.35-7.1 7.02C3.52 15.91 7.27 20 12 20a7.98 7.98 0 0 0 7.21-4.56c.32-.67-.16-1.44-.9-1.44-.37 0-.72.2-.88.53a5.994 5.994 0 0 1-6.8 3.31c-2.22-.49-4.01-2.3-4.48-4.52A6.002 6.002 0 0 1 12 6c1.66 0 3.14.69 4.22 1.78l-1.51 1.51c-.63.63-.19 1.71.7 1.71H19c.55 0 1-.45 1-1V6.41c0-.89-1.08-1.34-1.71-.71z\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst setHotkeys = (...args) => {\n  setState(...['hotkeys', ...args]);\n  store.prop.onHotkeysChange?.(Object.fromEntries(Object.entries(store.hotkeys).filter(([name, keys]) => !helper.isEqual(keys.filter(Boolean), defaultHotkeys()[name]))));\n};\nconst delHotkeys = code => {\n  for (const [name, keys] of Object.entries(store.hotkeys)) {\n    const i = keys.indexOf(code);\n    if (i === -1) continue;\n    const newKeys = [...store.hotkeys[name]];\n    newKeys.splice(i, 1);\n    setHotkeys(name, newKeys);\n  }\n};\nconst getHotkeyName = code => helper.t(`hotkeys.${code}`) || helper.t(`button.${code}`) || helper.t(`setting.translation.${code}`) || helper.t(`other.${code}`) || code;\nconst KeyItem = props => {\n  const code = () => store.hotkeys[props.operateName][props.i];\n  const del = () => delHotkeys(code());\n  const handleKeyDown = e => {\n    e.stopPropagation();\n    e.preventDefault();\n    switch (e.key) {\n      case 'Tab':\n      case 'Enter':\n      case 'Escape':\n        focus();\n        return;\n      case 'Backspace':\n        setHotkeys(props.operateName, props.i, '');\n        return;\n    }\n    const newCode = helper.getKeyboardCode(e);\n    if (Reflect.has(hotkeysMap(), newCode)) Toast.toast.error(helper.t('hotkeys.repeat_tip', {\n      hotkey: getHotkeyName(hotkeysMap()[newCode])\n    }));else setHotkeys(props.operateName, props.i, newCode);\n  };\n  return (() => {\n    var _el$ = web.template(`<div tabindex=0>`)();\n    _el$.addEventListener(\"blur\", () => code() || del());\n    web.use(ref => code() || setTimeout(() => ref.focus()), _el$);\n    web.addEventListener(_el$, \"keydown\", handleKeyDown);\n    web.insert(_el$, () => helper.keyboardCodeToText(code()), null);\n    web.insert(_el$, web.createComponent(MdClose, {\n      \"on:click\": del\n    }), null);\n    web.effect(() => web.className(_el$, modules_c21c94f2$1.hotkeysItem));\n    return _el$;\n  })();\n};\nconst SettingHotkeys = props => web.createComponent(solidJs.For, {\n  get each() {\n    return props.keys;\n  },\n  children: name => (() => {\n    var _el$2 = web.template(`<div><div><p></p><span style=flex-grow:1></span><div></div><div>`)(),\n      _el$3 = _el$2.firstChild,\n      _el$4 = _el$3.firstChild,\n      _el$5 = _el$4.nextSibling,\n      _el$6 = _el$5.nextSibling,\n      _el$7 = _el$6.nextSibling;\n    web.insert(_el$4, () => getHotkeyName(name));\n    web.addEventListener(_el$6, \"click\", () => setHotkeys(name, store.hotkeys[name].length, ''));\n    web.insert(_el$6, web.createComponent(MdAdd, {}));\n    web.addEventListener(_el$7, \"click\", () => {\n      const newKeys = defaultHotkeys()[name] ?? [];\n      for (const code of defaultHotkeys()[name]) delHotkeys(code);\n      setHotkeys(name, newKeys);\n    });\n    web.insert(_el$7, web.createComponent(MdRefresh, {}));\n    web.insert(_el$2, web.createComponent(solidJs.Index, {\n      get each() {\n        return store.hotkeys[name];\n      },\n      children: (_, i) => web.createComponent(KeyItem, {\n        operateName: name,\n        i: i\n      })\n    }), null);\n    web.effect(_p$ => {\n      var _v$ = modules_c21c94f2$1.hotkeys,\n        _v$2 = modules_c21c94f2$1.hotkeysHeader,\n        _v$3 = helper.t('setting.hotkeys.add'),\n        _v$4 = helper.t('setting.hotkeys.restore');\n      _v$ !== _p$.e && web.className(_el$2, _p$.e = _v$);\n      _v$2 !== _p$.t && web.className(_el$3, _p$.t = _v$2);\n      _v$3 !== _p$.a && web.setAttribute(_el$6, \"title\", _p$.a = _v$3);\n      _v$4 !== _p$.o && web.setAttribute(_el$7, \"title\", _p$.o = _v$4);\n      return _p$;\n    }, {\n      e: undefined,\n      t: undefined,\n      a: undefined,\n      o: undefined\n    });\n    return _el$2;\n  })()\n});\nconst OtherHotkeys = props => {\n  let ref; // oxlint-disable-line no-unassigned-vars\n\n  const handleChange = e => {\n    const name = e.target.value;\n    setHotkeys(name, store.hotkeys[name].length, '');\n    ref.value = '';\n  };\n  return (() => {\n    var _el$8 = web.template(`<div><select><option value disabled hidden selected> â€¦`)(),\n      _el$9 = _el$8.firstChild,\n      _el$0 = _el$9.firstChild,\n      _el$1 = _el$0.firstChild;\n    _el$9.addEventListener(\"change\", handleChange);\n    var _ref$ = ref;\n    typeof _ref$ === \"function\" ? web.use(_ref$, _el$9) : ref = _el$9;\n    web.setStyleProperty(_el$9, \"height\", \"100%\");\n    web.insert(_el$0, () => helper.t('other.other'), _el$1);\n    web.insert(_el$9, web.createComponent(solidJs.For, {\n      get each() {\n        return props.keys;\n      },\n      children: name => (() => {\n        var _el$10 = web.template(`<option>`)();\n        _el$10.value = name;\n        web.insert(_el$10, () => getHotkeyName(name));\n        return _el$10;\n      })()\n    }), null);\n    web.effect(_p$ => {\n      var _v$5 = modules_c21c94f2$1.hotkeys,\n        _v$6 = modules_c21c94f2$1.hotkeysHeader;\n      _v$5 !== _p$.e && web.className(_el$8, _p$.e = _v$5);\n      _v$6 !== _p$.t && web.className(_el$9, _p$.t = _v$6);\n      return _p$;\n    }, {\n      e: undefined,\n      t: undefined\n    });\n    return _el$8;\n  })();\n};\nconst SettingHotkeysBlock = () => {\n  const hotkeys = helper.createRootMemo(() => {\n    const show = [];\n    const other = [];\n    for (const [name, keys] of Object.entries(store.hotkeys)) (keys.length > 0 ? show : other).push(name);\n    return {\n      show,\n      other\n    };\n  });\n  return [web.createComponent(SettingHotkeys, {\n    get keys() {\n      return hotkeys().show;\n    }\n  }), web.createComponent(solidJs.Show, {\n    get when() {\n      return hotkeys().other.length;\n    },\n    get children() {\n      return web.createComponent(OtherHotkeys, {\n        get keys() {\n          return hotkeys().other;\n        }\n      });\n    }\n  })];\n};\n\n/** è®¾ç½®èœå•é¡¹ */\nconst SettingsItem = props => (() => {\n  var _el$ = web.template(`<div><div> <!> `)(),\n    _el$2 = _el$.firstChild,\n    _el$3 = _el$2.firstChild,\n    _el$5 = _el$3.nextSibling;\n  web.insert(_el$2, () => props.name, _el$5);\n  web.insert(_el$, () => props.children, null);\n  web.effect(_p$ => {\n    var _v$ = props.class ? `${modules_c21c94f2$1.SettingsItem} ${props.class}` : modules_c21c94f2$1.SettingsItem,\n      _v$2 = {\n        [props.class ?? '']: Boolean(props.class?.length),\n        ...props.classList\n      },\n      _v$3 = props.style,\n      _v$4 = helper.boolDataVal(props.disabled),\n      _v$5 = modules_c21c94f2$1.SettingsItemName;\n    _v$ !== _p$.e && web.className(_el$, _p$.e = _v$);\n    _p$.t = web.classList(_el$, _v$2, _p$.t);\n    _p$.a = web.style(_el$, _v$3, _p$.a);\n    _v$4 !== _p$.o && web.setAttribute(_el$, \"data-disabled\", _p$.o = _v$4);\n    _v$5 !== _p$.i && web.className(_el$2, _p$.i = _v$5);\n    return _p$;\n  }, {\n    e: undefined,\n    t: undefined,\n    a: undefined,\n    o: undefined,\n    i: undefined\n  });\n  return _el$;\n})();\n\n/** æŒ‰é’®å¼èœå•é¡¹ */\nconst SettingsItemButton = props => {\n  const [, others] = solidJs.splitProps(props, ['children', 'onClick']);\n  return web.createComponent(SettingsItem, web.mergeProps(others, {\n    get children() {\n      var _el$ = web.template(`<button type=button>`)();\n      web.addEventListener(_el$, \"click\", props.onClick);\n      web.insert(_el$, () => props.children);\n      web.effect(() => web.className(_el$, modules_c21c94f2$1.SettingsItemIconButton));\n      return _el$;\n    }\n  }));\n};\n\n/** æ•°å€¼è¾“å…¥æ¡† */\nconst NumberInput = props => {\n  const handleInput = e => {\n    const target = e.currentTarget;\n    if (props.maxLength === undefined || target.textContent.length <= props.maxLength) return;\n    target.textContent = target.textContent.slice(0, props.maxLength);\n    target.blur();\n  };\n  const handleKeyDown = e => {\n    switch (e.key) {\n      case 'ArrowUp':\n        return props.onChange((Number(e.target.textContent) * 1000 + (props.step ?? 1) * 1000) / 1000);\n      case 'ArrowDown':\n        return props.onChange((Number(e.target.textContent) * 1000 - (props.step ?? 1) * 1000) / 1000);\n      case 'Enter':\n        return e.target.blur();\n    }\n  };\n  return [(() => {\n    var _el$ = web.template(`<span contenteditable data-only-number>`)();\n    _el$.addEventListener(\"blur\", e => {\n      try {\n        props.onChange(Number(e.currentTarget.textContent) || 0);\n      } finally {\n        e.currentTarget.textContent = `${props.value}`;\n      }\n    });\n    web.addEventListener(_el$, \"keydown\", handleKeyDown);\n    web.addEventListener(_el$, \"input\", handleInput);\n    web.insert(_el$, () => `${props.value}`);\n    return _el$;\n  })(), web.createComponent(solidJs.Show, {\n    get when() {\n      return props.suffix;\n    },\n    get children() {\n      return props.suffix;\n    }\n  })];\n};\n\n\n/** æ•°å€¼è¾“å…¥æ¡†èœå•é¡¹ */\nconst SettingsItemNumber = props => web.createComponent(SettingsItem, {\n  get name() {\n    return props.name;\n  },\n  get [\"class\"]() {\n    return props.class;\n  },\n  get classList() {\n    return props.classList;\n  },\n  get children() {\n    var _el$ = web.template(`<div>`)();\n    web.insert(_el$, web.createComponent(NumberInput, props));\n    web.effect(_$p => web.setStyleProperty(_el$, \"margin-right\", props.suffix ? '.3em' : '.6em'));\n    return _el$;\n  }\n});\n\n/** é€‰æ‹©å™¨å¼èœå•é¡¹ */\nconst SettingsItemSelect = props => {\n  let ref; // oxlint-disable-line no-unassigned-vars\n\n  solidJs.createEffect(() => {\n    ref.value = props.options?.some(([val]) => val === props.value) ? props.value : '';\n  });\n  return web.createComponent(SettingsItem, {\n    get name() {\n      return props.name;\n    },\n    get [\"class\"]() {\n      return props.class;\n    },\n    get classList() {\n      return props.classList;\n    },\n    get children() {\n      var _el$ = web.template(`<select>`)();\n      web.addEventListener(_el$, \"click\", () => props.onClick?.());\n      _el$.addEventListener(\"change\", e => props.onChange(e.target.value));\n      var _ref$ = ref;\n      typeof _ref$ === \"function\" ? web.use(_ref$, _el$) : ref = _el$;\n      web.insert(_el$, web.createComponent(solidJs.For, {\n        get each() {\n          return props.options;\n        },\n        children: ([val, label]) => (() => {\n          var _el$2 = web.template(`<option>`)();\n          _el$2.value = val;\n          web.insert(_el$2, label ?? val);\n          return _el$2;\n        })()\n      }));\n      web.effect(() => web.className(_el$, modules_c21c94f2$1.SettingsItemSelect));\n      return _el$;\n    }\n  });\n};\n\n/** å¼€å…³å¼èœå•é¡¹ */\nconst SettingsItemSwitch = props => {\n  const handleClick = () => props.onChange(!props.value);\n  return web.createComponent(SettingsItem, {\n    get name() {\n      return props.name;\n    },\n    get [\"class\"]() {\n      return props.class;\n    },\n    get classList() {\n      return props.classList;\n    },\n    get disabled() {\n      return props.disabled;\n    },\n    get children() {\n      var _el$ = web.template(`<button type=button><div>`)(),\n        _el$2 = _el$.firstChild;\n      web.addEventListener(_el$, \"click\", handleClick);\n      web.effect(_p$ => {\n        var _v$ = modules_c21c94f2$1.SettingsItemSwitch,\n          _v$2 = props.value,\n          _v$3 = modules_c21c94f2$1.SettingsItemSwitchRound;\n        _v$ !== _p$.e && web.className(_el$, _p$.e = _v$);\n        _v$2 !== _p$.t && web.setAttribute(_el$, \"data-checked\", _p$.t = _v$2);\n        _v$3 !== _p$.a && web.className(_el$2, _p$.a = _v$3);\n        return _p$;\n      }, {\n        e: undefined,\n        t: undefined,\n        a: undefined\n      });\n      return _el$;\n    }\n  });\n};\n\n\n/** å¸¦æœ‰åŠ¨ç”»è¿‡æ¸¡çš„åˆ‡æ¢æ˜¾ç¤ºè®¾ç½®é¡¹ */\nconst SettingsShowItem = props => (() => {\n  var _el$ = web.template(`<div><div>`)(),\n    _el$2 = _el$.firstChild;\n  web.insert(_el$2, () => props.children);\n  web.effect(_p$ => {\n    var _v$ = modules_c21c94f2$1.SettingsShowItem,\n      _v$2 = props.when ? '1fr' : '0fr',\n      _v$3 = modules_c21c94f2$1.SettingsShowItemBody;\n    _v$ !== _p$.e && web.className(_el$, _p$.e = _v$);\n    _v$2 !== _p$.t && web.setStyleProperty(_el$, \"grid-template-rows\", _p$.t = _v$2);\n    _v$3 !== _p$.a && web.className(_el$2, _p$.a = _v$3);\n    return _p$;\n  }, {\n    e: undefined,\n    t: undefined,\n    a: undefined\n  });\n  return _el$;\n})();\n\n/** èŒƒå›´è¾“å…¥æ¡† */\nconst RangeInput = props => {\n  let ref; // oxlint-disable-line no-unassigned-vars\n\n  /** åœ¨ä¿æŒå…‰æ ‡ä½ç½®ä¸å˜çš„æƒ…å†µä¸‹ä¿®æ”¹æ–‡æœ¬ */\n  const editText = text => {\n    const offset = ref.selectionStart;\n    ref.value = text;\n    if (offset) requestAnimationFrame(() => {\n      ref.selectionStart = offset;\n      ref.selectionEnd = offset;\n    });\n  };\n\n  /** ä¿®æ”¹æ–‡æœ¬ä¸­çš„æ•°å­— */\n  const replaceTextNumer = (text, offset, fn) => {\n    const isNumber = num => /\\d/.test(text[num]);\n    let start = offset;\n    if (!isNumber(offset)) {\n      if (isNumber(start - 1)) start--;else if (isNumber(start + 1)) start++;else return text;\n    }\n    let end = start;\n    while (isNumber(start - 1)) start--;\n    while (isNumber(end + 1)) end++;\n    return text.slice(0, start) + fn(Number(text.slice(start, end + 1))) + text.slice(end + 1);\n  };\n  const handleKeyDown = e => {\n    switch (e.key) {\n      case 'ArrowUp':\n      case 'ArrowDown':\n        editText(replaceTextNumer(ref.value, ref.selectionStart, num => e.key === 'ArrowUp' ? num + 1 : num - 1));\n    }\n  };\n  return (() => {\n    var _el$ = web.template(`<textarea autocomplete=off rows=2>`)();\n    _el$.addEventListener(\"blur\", () => {\n      try {\n        props.onChange?.(ref.value);\n      } finally {\n        ref.value = props.value;\n      }\n    });\n    web.addEventListener(_el$, \"keydown\", handleKeyDown);\n    var _ref$ = ref;\n    typeof _ref$ === \"function\" ? web.use(_ref$, _el$) : ref = _el$;\n    web.effect(_p$ => {\n      var _v$ = props.style,\n        _v$2 = props.placeholder;\n      _p$.e = web.style(_el$, _v$, _p$.e);\n      _v$2 !== _p$.t && web.setAttribute(_el$, \"placeholder\", _p$.t = _v$2);\n      return _p$;\n    }, {\n      e: undefined,\n      t: undefined\n    });\n    web.effect(() => _el$.value = props.value);\n    return _el$;\n  })();\n};\n\nconst bindOption = (...args) => bindOption$1('translation', ...args);\nconst [rangeText, setRangeText] = solidJs.createSignal('');\n// å®æ—¶æ›´æ–°ç¿»è¯‘èŒƒå›´\nhelper.createEffectOn(translationImgs, imgs => setRangeText(helper.descRange(imgs, store.imgList.length)));\nconst TranslateRange = () => {\n  helper.createEffectOn(rangeText, () => {\n    const imgImgs = helper.extractRange(rangeText(), store.imgList.length);\n    const openImgs = [...imgImgs].filter(i => {\n      // è¿‡æ»¤æ‰ç¿»è¯‘å®Œæˆå’Œç­‰å¾…ç¿»è¯‘çš„å›¾ç‰‡ï¼Œé¿å…å› ä¸ºèŒƒå›´å˜åŒ–è€Œé‡æ–°å‘èµ·ç¿»è¯‘\n      switch (imgList()[i].translationType) {\n        case 'show':\n        case 'wait':\n          return false;\n        default:\n          return true;\n      }\n    });\n    if (openImgs.length > 0) setImgTranslationEnbale(openImgs, true);\n    const closeImgs = new Set();\n    for (let i = 0; i < store.imgList.length; i++) if (!imgImgs.has(i)) closeImgs.add(i);\n    if (closeImgs.size > 0) setImgTranslationEnbale(closeImgs, false);\n    setRangeText(helper.descRange(imgImgs, store.imgList.length));\n  });\n  return [web.createComponent(SettingsItem, {\n    get name() {\n      return helper.t('setting.translation.range');\n    }\n  }), web.createComponent(RangeInput, {\n    get [\"class\"]() {\n      return modules_c21c94f2$1.SettingsItem;\n    },\n    get placeholder() {\n      return helper.t('other.page_range');\n    },\n    get value() {\n      return rangeText();\n    },\n    onChange: setRangeText\n  })];\n};\nconst SettingTranslation = () => [web.createComponent(SettingsItemSelect, web.mergeProps({\n  get name() {\n    return helper.t('setting.translation.server');\n  },\n  get options() {\n    return [['disable', helper.t('other.disable')], ['selfhosted', helper.t('setting.translation.server_selfhosted')], ['cotrans']];\n  }\n}, () => bindOption('server'))), web.createComponent(solidJs.Show, {\n  get when() {\n    return store.option.translation.server === 'cotrans';\n  },\n  get children() {\n    var _el$ = web.template(`<blockquote>`)();\n    web.effect(() => _el$.innerHTML = helper.t('setting.translation.cotrans_tip'));\n    return _el$;\n  }\n}), web.createComponent(solidJs.Show, {\n  get when() {\n    return store.option.translation.server === 'selfhosted';\n  },\n  get children() {\n    return [web.createComponent(SettingsItemSwitch, {\n      get name() {\n        return helper.t('setting.translation.translate_all');\n      },\n      get value() {\n        return isTranslatingAll();\n      },\n      onChange: translateAll\n    }), web.createComponent(SettingsItemSwitch, {\n      get name() {\n        return helper.t('setting.translation.translate_to_end');\n      },\n      get value() {\n        return isTranslatingToEnd();\n      },\n      onChange: translateToEnd\n    }), web.createComponent(TranslateRange, {}), (() => {\n      var _el$2 = web.template(`<hr>`)();\n      web.setStyleProperty(_el$2, \"margin\", \"1em 0\");\n      return _el$2;\n    })()];\n  }\n}), web.createComponent(solidJs.Show, {\n  get when() {\n    return store.option.translation.server !== 'disable';\n  },\n  get children() {\n    return [web.createComponent(SettingsItemSelect, web.mergeProps({\n      get name() {\n        return helper.t('setting.translation.options.target_language');\n      },\n      options: [['CHS', 'ç®€ä½“ä¸­æ–‡'], ['CHT', 'ç¹é«”ä¸­æ–‡'], ['JPN', 'æ—¥æœ¬èª'], ['ENG', 'English'], ['KOR', 'í•œêµ­ì–´'], ['VIN', 'Tiáº¿ng Viá»‡t'], ['CSY', 'ÄeÅ¡tina'], ['NLD', 'Nederlands'], ['FRA', 'franÃ§ais'], ['DEU', 'Deutsch'], ['HUN', 'magyar nyelv'], ['ITA', 'italiano'], ['PLK', 'polski'], ['PTB', 'portuguÃªs'], ['ROM', 'limba romÃ¢nÄƒ'], ['RUS', 'Ñ€ÑƒÑÑĞºĞ¸Ğ¹ ÑĞ·Ñ‹Ğº'], ['ESP', 'espaÃ±ol'], ['TRK', 'TÃ¼rk dili'], ['IND', 'Indonesia']]\n    }, () => bindOption('options', 'translator', 'target_lang'))), web.createComponent(SettingsItemSelect, web.mergeProps({\n      get name() {\n        return helper.t('setting.translation.options.translator');\n      },\n      get options() {\n        return translatorOptions();\n      },\n      onClick: updateSelfhostedOptions\n    }, () => bindOption('options', 'translator', 'translator'))), web.createComponent(SettingsItemSelect, web.mergeProps({\n      get name() {\n        return helper.t('setting.translation.options.direction');\n      },\n      get options() {\n        return [['auto', helper.t('setting.translation.options.direction_auto')], ['horizontal', helper.t('setting.translation.options.direction_horizontal')], ['vertical', helper.t('setting.translation.options.direction_vertical')]];\n      }\n    }, () => bindOption('options', 'render', 'direction'))), web.createComponent(SettingsItemSelect, web.mergeProps({\n      get name() {\n        return helper.t('setting.translation.options.detection_resolution');\n      },\n      options: [['1024', '1024px'], ['1536', '1536px'], ['2048', '2048px'], ['2560', '2560px']]\n    }, () => bindOption('options', 'detector', 'detection_size'))), web.createComponent(SettingsItemSelect, web.mergeProps({\n      get name() {\n        return helper.t('setting.translation.options.text_detector');\n      },\n      options: [['default'], ['ctd', 'Comic Text Detector']]\n    }, () => bindOption('options', 'detector', 'detector'))), web.createComponent(solidJs.Show, {\n      get when() {\n        return store.option.translation.server === 'selfhosted';\n      },\n      get children() {\n        return [web.createComponent(SettingsItemSelect, web.mergeProps({\n          get name() {\n            return helper.t('setting.translation.options.inpainting_size');\n          },\n          options: [['516', '516px'], ['1024', '1024px'], ['2048', '2048px'], ['2560', '2560px']]\n        }, () => bindOption('options', 'inpainter', 'inpainting_size'))), web.createComponent(SettingsItemSelect, web.mergeProps({\n          get name() {\n            return helper.t('setting.translation.options.inpainter');\n          },\n          options: [['default', 'Default'], ['lama_large', 'Lama Large'], ['lama_mpe', 'Lama MPE'], ['sd', 'SD'], ['none', 'None'], ['original', 'Original']]\n        }, () => bindOption('options', 'inpainter', 'inpainter'))), web.createComponent(SettingsItemNumber, web.mergeProps({\n          get name() {\n            return helper.t('setting.translation.options.unclip_ratio');\n          },\n          step: 0.01\n        }, () => bindOption('options', 'detector', 'unclip_ratio'))), web.createComponent(SettingsItemNumber, web.mergeProps({\n          get name() {\n            return helper.t('setting.translation.options.box_threshold');\n          },\n          step: 0.01\n        }, () => bindOption('options', 'detector', 'box_threshold'))), web.createComponent(SettingsItemNumber, web.mergeProps({\n          get name() {\n            return helper.t('setting.translation.options.mask_dilation_offset');\n          }\n        }, () => bindOption('options', 'mask_dilation_offset')))];\n      }\n    })];\n  }\n}), web.createComponent(solidJs.Show, {\n  get when() {\n    return store.option.translation.server !== 'disable';\n  },\n  get children() {\n    return [(() => {\n      var _el$3 = web.template(`<hr>`)();\n      web.setStyleProperty(_el$3, \"margin\", \"1em 0\");\n      return _el$3;\n    })(), web.createComponent(SettingsItemSwitch, web.mergeProps({\n      get name() {\n        return helper.t('setting.translation.options.force_retry');\n      }\n    }, () => bindOption('forceRetry'))), web.createComponent(SettingsItemSwitch, web.mergeProps({\n      get name() {\n        return helper.t('setting.translation.options.only_download_translated');\n      }\n    }, () => bindOption('onlyDownloadTranslated'))), web.createComponent(solidJs.Show, {\n      get when() {\n        return store.option.translation.server === 'selfhosted';\n      },\n      get children() {\n        return [web.createComponent(SettingsItemSwitch, {\n          get name() {\n            return helper.t('setting.translation.options.local_url');\n          },\n          get value() {\n            return store.option.translation.localUrl !== undefined;\n          },\n          onChange: val => {\n            setOption(draftOption => {\n              draftOption.translation.localUrl = val ? '' : undefined;\n            });\n          }\n        }), web.createComponent(solidJs.Show, {\n          get when() {\n            return store.option.translation.localUrl !== undefined;\n          },\n          get children() {\n            var _el$4 = web.template(`<input type=url>`)();\n            _el$4.addEventListener(\"change\", e => {\n              setOption(draftOption => {\n                // åˆ æ‰æœ«å°¾çš„æ–œæ \n                const url = e.target.value.replace(/\\/$/, '');\n                draftOption.translation.localUrl = url;\n              });\n            });\n            web.effect(() => _el$4.value = store.option.translation.localUrl);\n            return _el$4;\n          }\n        })];\n      }\n    })];\n  }\n})];\n\n/** é»˜è®¤èœå•é¡¹ */\nconst defaultSettingList = () => [[helper.t('setting.option.paragraph_dir'), () => web.createComponent(SettingsItemButton, {\n  get name() {\n    return web.memo(() => store.option.dir === 'rtl')() ? helper.t('setting.option.dir_rtl') : helper.t('setting.option.dir_ltr');\n  },\n  onClick: switchDir,\n  get children() {\n    return web.memo(() => store.option.dir === 'rtl')() ? web.createComponent(MdOutlineFormatTextdirectionRToL, {}) : web.createComponent(MdOutlineFormatTextdirectionLToR, {});\n  }\n}), {\n  initShow: true\n}], [helper.t('setting.option.paragraph_display'), () => [web.createComponent(solidJs.Show, {\n  get when() {\n    return !store.option.scrollMode.enabled;\n  },\n  get children() {\n    return [web.createComponent(SettingsItemSwitch, web.mergeProps({\n      get name() {\n        return helper.t('setting.option.disable_auto_enlarge');\n      }\n    }, () => bindOption$1('disableZoom'))), web.createComponent(SettingsItemNumber, {\n      get name() {\n        return helper.t('setting.option.zoom');\n      },\n      maxLength: 3,\n      suffix: \"%\",\n      step: 5,\n      onChange: val => Number.isNaN(val) || zoom(val),\n      get value() {\n        return Math.round(store.option.zoom.ratio);\n      }\n    })];\n  }\n}), web.createComponent(solidJs.Show, {\n  get when() {\n    return store.option.scrollMode.enabled;\n  },\n  get children() {\n    return [web.createComponent(SettingsItemSwitch, {\n      get name() {\n        return helper.t('setting.option.abreast_mode');\n      },\n      get value() {\n        return store.option.scrollMode.abreastMode;\n      },\n      onChange: val => {\n        const jump = saveScrollProgress();\n        setOption(draftOption => {\n          draftOption.scrollMode.abreastMode = val;\n          draftOption.scrollMode.doubleMode = false;\n        });\n        jump();\n      }\n    }), web.createComponent(solidJs.Show, {\n      get when() {\n        return store.option.scrollMode.abreastMode;\n      },\n      get children() {\n        return web.createComponent(SettingsItemNumber, {\n          get name() {\n            return helper.t('setting.option.abreast_duplicate');\n          },\n          maxLength: 3,\n          suffix: \"%\",\n          step: 5,\n          onChange: val => {\n            if (Number.isNaN(val)) return;\n            setOption(draftOption => {\n              const newVal = helper.clamp(0, val / 100, 0.95);\n              draftOption.scrollMode.abreastDuplicate = newVal;\n            });\n          },\n          get value() {\n            return Math.round(store.option.scrollMode.abreastDuplicate * 100);\n          }\n        });\n      }\n    }), web.createComponent(solidJs.Show, {\n      get when() {\n        return !store.option.scrollMode.abreastMode;\n      },\n      get children() {\n        return [web.createComponent(SettingsItemSelect, {\n          get name() {\n            return helper.t('setting.option.adjust_to_width');\n          },\n          get options() {\n            return [['disable', helper.t('other.disable')], ['full', helper.t('setting.option.full_width')], ['custom', helper.t('other.custom')]];\n          },\n          get value() {\n            return web.memo(() => typeof store.option.scrollMode.adjustToWidth === 'number')() ? 'custom' : store.option.scrollMode.adjustToWidth;\n          },\n          onChange: val => {\n            const jump = saveScrollProgress();\n            setOption((draftOption, state) => {\n              if (val === 'custom') draftOption.scrollMode.adjustToWidth = state.isMobile ? state.rootSize.width : 1280;else draftOption.scrollMode.adjustToWidth = val;\n            });\n            jump();\n          }\n        }), web.createComponent(solidJs.Show, {\n          get when() {\n            return isUseAutoScale();\n          },\n          get children() {\n            return web.createComponent(SettingsItemNumber, {\n              get name() {\n                return helper.t('setting.option.adjust_to_width');\n              },\n              maxLength: 6,\n              step: 100,\n              onChange: setAdjustToWidth,\n              get value() {\n                return store.option.scrollMode.adjustToWidth;\n              }\n            });\n          }\n        })];\n      }\n    }), web.createComponent(solidJs.Show, {\n      get when() {\n        return store.option.scrollMode.adjustToWidth === 'disable';\n      },\n      get children() {\n        return web.createComponent(SettingsItemNumber, {\n          get name() {\n            return helper.t('setting.option.scroll_mode_img_scale');\n          },\n          maxLength: 3,\n          suffix: \"%\",\n          step: 5,\n          onChange: val => setImgScale(val / 100),\n          get value() {\n            return Math.round(store.option.scrollMode.imgScale * 100);\n          }\n        });\n      }\n    }), web.createComponent(SettingsItemNumber, {\n      get name() {\n        return helper.t('setting.option.scroll_mode_img_spacing');\n      },\n      maxLength: 5,\n      onChange: val => {\n        if (Number.isNaN(val)) return;\n        const newVal = helper.clamp(0, val, Number.POSITIVE_INFINITY);\n        setOption(draftOption => {\n          draftOption.scrollMode.spacing = newVal;\n        });\n      },\n      get value() {\n        return Math.round(store.option.scrollMode.spacing);\n      }\n    })];\n  }\n})], {\n  initShow: true\n}], [helper.t('button.scroll_mode'), () => [web.createComponent(SettingsItemSwitch, web.mergeProps({\n  get name() {\n    return helper.t('setting.option.align_edge');\n  }\n}, () => bindOption$1('scrollMode', 'alignEdge'))), web.createComponent(SettingsItemSwitch, web.mergeProps({\n  get name() {\n    return helper.t('setting.option.scrollbar_easy_scroll');\n  }\n}, () => bindOption$1('scrollbar', 'easyScroll')))], {\n  initShow: () => isScrollMode(),\n  hidden: () => !isScrollMode()\n}], [helper.t('setting.option.paragraph_appearance'), () => [web.createComponent(SettingsItemSwitch, web.mergeProps({\n  get name() {\n    return helper.t('setting.option.dark_mode');\n  }\n}, () => bindOption$1('darkMode'))), web.createComponent(SettingsItemSwitch, web.mergeProps({\n  get name() {\n    return helper.t('setting.option.dark_mode_auto');\n  }\n}, () => bindOption$1('autoDarkMode'))), web.createComponent(SettingsItemSwitch, web.mergeProps({\n  get name() {\n    return helper.t('setting.option.show_comments');\n  }\n}, () => bindOption$1('showComment'))), web.createComponent(SettingsItemSwitch, web.mergeProps({\n  get name() {\n    return helper.t('setting.option.autoHiddenMouse');\n  }\n}, () => bindOption$1('autoHiddenMouse'))), web.createComponent(SettingsItem, {\n  get name() {\n    return helper.t('setting.option.background_color');\n  },\n  get children() {\n    var _el$ = web.template(`<input type=color style=margin-right:.4em>`)();\n    web.addEventListener(_el$, \"input\", helper.throttle(e => {\n      if (!e.target.value) return;\n      setOption(draftOption => {\n        // åœ¨æ‹‰åˆ°çº¯é»‘æˆ–çº¯ç™½æ—¶æ”¹å›åˆå§‹å€¼\n        draftOption.customBackground = e.target.value === '#000000' || e.target.value === '#ffffff' ? undefined : e.target.value;\n        if (draftOption.customBackground) draftOption.darkMode = helper.needDarkMode(draftOption.customBackground);\n      });\n    }, 20));\n    web.setStyleProperty(_el$, \"width\", \"2em\");\n    web.effect(() => _el$.value = store.option.customBackground ?? (store.option.darkMode ? '#000000' : '#ffffff'));\n    return _el$;\n  }\n}), web.createComponent(SettingsItemSelect, {\n  get name() {\n    return helper.t('setting.language');\n  },\n  options: [['zh', 'ä¸­æ–‡'], ['en', 'English'], ['ru', 'Ğ ÑƒÑÑĞºĞ¸Ğ¹']],\n  get value() {\n    return helper.lang();\n  },\n  onChange: helper.setLang\n})]], [helper.t('setting.option.paragraph_scrollbar'), () => [web.createComponent(SettingsItemSelect, web.mergeProps({\n  get name() {\n    return helper.t('setting.option.scrollbar_position');\n  },\n  get options() {\n    return [['auto', helper.t('other.auto')], ['right', helper.t('setting.option.scrollbar_position_right')], ['top', helper.t('setting.option.scrollbar_position_top')], ['bottom', helper.t('setting.option.scrollbar_position_bottom')], ['hidden', helper.t('setting.option.scrollbar_position_hidden')]];\n  }\n}, () => bindOption$1('scrollbar', 'position'))), web.createComponent(SettingsShowItem, {\n  get when() {\n    return store.option.scrollbar.position !== 'hidden';\n  },\n  get children() {\n    return [web.createComponent(solidJs.Show, {\n      get when() {\n        return !store.isMobile;\n      },\n      get children() {\n        return web.createComponent(SettingsItemSwitch, web.mergeProps({\n          get name() {\n            return helper.t('setting.option.scrollbar_auto_hidden');\n          }\n        }, () => bindOption$1('scrollbar', 'autoHidden')));\n      }\n    }), web.createComponent(SettingsItemSwitch, web.mergeProps({\n      get name() {\n        return helper.t('setting.option.scrollbar_show_img_status');\n      }\n    }, () => bindOption$1('scrollbar', 'showImgStatus')))];\n  }\n})]], [helper.t('setting.option.click_page_turn_enabled'), () => [web.createComponent(SettingsItemSwitch, web.mergeProps({\n  get name() {\n    return helper.t('other.enabled');\n  }\n}, () => bindOption$1('clickPageTurn', 'enabled'))), web.createComponent(SettingsItemSwitch, {\n  get name() {\n    return helper.t('setting.option.show_clickable_area');\n  },\n  get value() {\n    return store.show.touchArea;\n  },\n  onChange: () => setState('show', 'touchArea', !store.show.touchArea)\n}), web.createComponent(SettingsItemSwitch, web.mergeProps({\n  get name() {\n    return helper.t('setting.option.shrink_menu');\n  }\n}, () => bindOption$1('clickPageTurn', 'shrinkMenu'))), web.createComponent(SettingsShowItem, {\n  get when() {\n    return store.option.clickPageTurn.enabled;\n  },\n  get children() {\n    return [web.createComponent(SettingsItemSelect, web.mergeProps({\n      get name() {\n        return helper.t('setting.option.click_page_turn_area');\n      },\n      get options() {\n        return Object.keys(areaArrayMap).map(key => [key, helper.t(`touch_area.type.${key}`)]);\n      }\n    }, () => bindOption$1('clickPageTurn', 'area'))), web.createComponent(SettingsItemSwitch, web.mergeProps({\n      get name() {\n        return helper.t('setting.option.click_page_turn_swap_area');\n      }\n    }, () => bindOption$1('clickPageTurn', 'reverse')))];\n  }\n})]], [helper.t('button.auto_scroll'), () => [web.createComponent(SettingsItemSwitch, web.mergeProps({\n  get name() {\n    return helper.t('other.enabled');\n  }\n}, () => bindOption$1('autoScroll', 'enabled'))), web.createComponent(SettingsItemNumber, {\n  get name() {\n    return helper.t('other.interval');\n  },\n  maxLength: 3,\n  suffix: \"s\",\n  step: 1,\n  onChange: val => {\n    if (!Number.isNaN(val)) setState('option', 'autoScroll', 'interval', val * 1000);\n  },\n  get value() {\n    return store.option.autoScroll.interval / 1000;\n  }\n}), web.createComponent(SettingsItemNumber, {\n  get name() {\n    return helper.t('other.distance');\n  },\n  maxLength: 3,\n  suffix: \"px\",\n  step: 20,\n  onChange: val => {\n    if (!Number.isNaN(val)) setState('option', 'autoScroll', 'distance', val);\n  },\n  get value() {\n    return store.option.autoScroll.distance;\n  }\n}), web.createComponent(SettingsItemSwitch, web.mergeProps({\n  get name() {\n    return helper.t('setting.option.auto_scroll_trigger_end');\n  }\n}, () => bindOption$1('autoScroll', 'triggerEnd')))]], [helper.t('setting.option.img_recognition'), () => [web.createComponent(SettingsItemSwitch, {\n  get name() {\n    return helper.t('other.enabled');\n  },\n  get value() {\n    return store.option.imgRecognition.enabled;\n  },\n  onChange: () => switchImgRecognition('enabled')\n}), web.createComponent(solidJs.Show, {\n  when: typeof Worker === 'undefined',\n  get children() {\n    var _el$2 = web.template(`<blockquote><p>`)(),\n      _el$3 = _el$2.firstChild;\n    web.effect(() => _el$3.innerHTML = helper.t('setting.option.img_recognition_warn'));\n    return _el$2;\n  }\n}), web.createComponent(solidJs.Show, {\n  get when() {\n    return !store.supportWorker;\n  },\n  get children() {\n    var _el$4 = web.template(`<blockquote><p>`)(),\n      _el$5 = _el$4.firstChild;\n    web.effect(() => _el$5.innerHTML = helper.t('setting.option.img_recognition_warn_2'));\n    return _el$4;\n  }\n}), web.createComponent(SettingsItemSwitch, {\n  get name() {\n    return helper.t('setting.option.img_recognition_background');\n  },\n  get disabled() {\n    return !store.option.imgRecognition.enabled;\n  },\n  get value() {\n    return store.option.imgRecognition.background;\n  },\n  onChange: () => switchImgRecognition('background')\n}), web.createComponent(SettingsItemSwitch, {\n  get name() {\n    return helper.t('setting.option.img_recognition_pageFill');\n  },\n  get disabled() {\n    return !store.option.imgRecognition.enabled;\n  },\n  get value() {\n    return store.option.imgRecognition.pageFill;\n  },\n  onChange: () => switchImgRecognition('pageFill')\n}), web.createComponent(solidJs.Show, {\n  get when() {\n    return !store.isMobile;\n  },\n  get children() {\n    return web.createComponent(SettingsItemSwitch, {\n      get name() {\n        return helper.t('upscale.title');\n      },\n      get disabled() {\n        return !store.option.imgRecognition.enabled || !store.supportUpscaleImage;\n      },\n      get value() {\n        return store.option.imgRecognition.upscale;\n      },\n      onChange: () => switchImgRecognition('upscale')\n    });\n  }\n})]], [helper.t('setting.option.paragraph_translation'), SettingTranslation, {\n  initShow: () => store.option.translation.server !== 'disable'\n}], [helper.t('other.hotkeys'), SettingHotkeysBlock], [helper.t('other.other'), () => [web.createComponent(SettingsItemSwitch, web.mergeProps({\n  get name() {\n    return helper.t('setting.option.first_page_fill');\n  }\n}, () => bindOption$1('firstPageFill'))), web.createComponent(SettingsItemSwitch, {\n  get name() {\n    return helper.t('setting.option.auto_switch_page_mode');\n  },\n  get value() {\n    return store.option.autoSwitchPageMode;\n  },\n  onChange: val => {\n    setOption((draftOption, state) => {\n      draftOption.autoSwitchPageMode = val;\n      state.option.pageNum = val ? 0 : autoPageNum();\n    });\n  }\n}), web.createComponent(SettingsItemSwitch, web.mergeProps({\n  get name() {\n    return helper.t('setting.option.swap_page_turn_key');\n  }\n}, () => bindOption$1('swapPageTurnKey'))), web.createComponent(SettingsItemSwitch, web.mergeProps({\n  get name() {\n    return helper.t('setting.option.autoFullscreen');\n  }\n}, () => bindOption$1('autoFullscreen'))), web.createComponent(SettingsItemSelect, web.mergeProps({\n  get name() {\n    return helper.t('setting.option.scroll_end');\n  },\n  get options() {\n    return [['none', helper.t('other.none')], ['exit', helper.t('other.exit')], ['auto', helper.t('setting.option.scroll_end_auto')]];\n  }\n}, () => bindOption$1('scroolEnd'))), web.createComponent(SettingsItemSwitch, web.mergeProps({\n  get name() {\n    return helper.t('setting.option.always_load_all_img');\n  }\n}, () => bindOption$1('alwaysLoadAllImg'))), web.createComponent(SettingsItemNumber, {\n  get name() {\n    return helper.t('setting.option.preload_page_num');\n  },\n  maxLength: 5,\n  onChange: val => {\n    if (Number.isNaN(val)) return;\n    setOption(draftOption => {\n      draftOption.preloadPageNum = helper.clamp(0, val, 99_999);\n    });\n  },\n  get value() {\n    return store.option.preloadPageNum;\n  }\n})]]];\n\nconst SettingBlockSubtitle = props => (() => {\n  var _el$ = web.template(`<div>`)();\n  web.addEventListener(_el$, \"click\", props.onClick);\n  web.insert(_el$, () => props.children);\n  web.effect(() => web.className(_el$, modules_c21c94f2$1.SettingBlockSubtitle));\n  return _el$;\n})();\n\n/** èœå•é¢æ¿ */\nconst SettingPanel = () => (() => {\n  var _el$2 = web.template(`<div>`)();\n  web.addEventListener(_el$2, \"click\", stopPropagation);\n  web.addEventListener(_el$2, \"scroll\", stopPropagation);\n  _el$2.addEventListener(\"wheel\", e => refs.settingPanel.scrollHeight > refs.settingPanel.clientHeight && e.stopPropagation());\n  var _ref$ = bindRef('settingPanel');\n  typeof _ref$ === \"function\" && web.use(_ref$, _el$2);\n  web.insert(_el$2, web.createComponent(solidJs.For, {\n    get each() {\n      return store.prop.editSettingList(defaultSettingList());\n    },\n    children: ([name, SettingItem, options], i) => {\n      const initShow = options?.initShow;\n      const [show, setShwo] = solidJs.createSignal(Boolean(initShow));\n      if (typeof initShow === 'function') helper.createEffectOn(initShow, val => setShwo(Boolean(val)));\n      return web.createComponent(solidJs.Show, {\n        get when() {\n          return web.memo(() => !!options?.hidden)() ? !options.hidden() : true;\n        },\n        get children() {\n          return [web.memo(() => web.memo(() => !!i())() ? web.template(`<hr>`)() : null), (() => {\n            var _el$3 = web.template(`<div><div>`)(),\n              _el$4 = _el$3.firstChild;\n            web.insert(_el$3, web.createComponent(SettingBlockSubtitle, {\n              onClick: () => setShwo(prev => !prev),\n              get children() {\n                return [name, web.memo(() => show() ? null : 'â€¦')];\n              }\n            }), _el$4);\n            web.insert(_el$4, web.createComponent(SettingItem, {}));\n            web.effect(_p$ => {\n              var _v$3 = modules_c21c94f2$1.SettingBlock,\n                _v$4 = show(),\n                _v$5 = modules_c21c94f2$1.SettingBlockBody;\n              _v$3 !== _p$.e && web.className(_el$3, _p$.e = _v$3);\n              _v$4 !== _p$.t && web.setAttribute(_el$3, \"data-show\", _p$.t = _v$4);\n              _v$5 !== _p$.a && web.className(_el$4, _p$.a = _v$5);\n              return _p$;\n            }, {\n              e: undefined,\n              t: undefined,\n              a: undefined\n            });\n            return _el$3;\n          })()];\n        }\n      });\n    }\n  }));\n  web.effect(_p$ => {\n    var _v$ = `${modules_c21c94f2$1.SettingPanel} ${modules_c21c94f2$1.beautifyScrollbar}`,\n      _v$2 = helper.lang() === 'zh' ? '15em' : '20em';\n    _v$ !== _p$.e && web.className(_el$2, _p$.e = _v$);\n    _v$2 !== _p$.t && web.setStyleProperty(_el$2, \"width\", _p$.t = _v$2);\n    return _p$;\n  }, {\n    e: undefined,\n    t: undefined\n  });\n  return _el$2;\n})();\n\nconst ZoomButton = () => web.createComponent(IconButton, {\n  get tip() {\n    return web.memo(() => store.option.zoom.ratio === 100)() ? helper.t('button.zoom_in') : helper.t('button.zoom_out');\n  },\n  get enabled() {\n    return store.option.zoom.ratio !== 100;\n  },\n  onClick: () => doubleClickZoom(),\n  get children() {\n    return web.createComponent(solidJs.Show, {\n      get when() {\n        return store.option.zoom.ratio === 100;\n      },\n      get fallback() {\n        return web.createComponent(MdZoomOut, {});\n      },\n      get children() {\n        return web.createComponent(MdZoomIn, {});\n      }\n    });\n  }\n});\n\n/** å·¥å…·æ çš„é»˜è®¤æŒ‰é’®åˆ—è¡¨ */\nconst defaultButtonList = [\n// å•åŒé¡µæ¨¡å¼\n() => web.createComponent(IconButton, {\n  get tip() {\n    return web.memo(() => !!isOnePageMode())() ? helper.t('button.page_mode_single') : helper.t('button.page_mode_double');\n  },\n  get hidden() {\n    return store.isMobile;\n  },\n  onClick: switchOnePageMode,\n  get children() {\n    return web.memo(() => !!isOnePageMode())() ? web.createComponent(MdLooksOne, {}) : web.createComponent(MdLooksTwo, {});\n  }\n}),\n// å·è½´æ¨¡å¼\n() => web.createComponent(IconButton, {\n  get tip() {\n    return helper.t('button.scroll_mode');\n  },\n  get enabled() {\n    return store.option.scrollMode.enabled;\n  },\n  onClick: switchScrollMode,\n  get children() {\n    return web.createComponent(MdViewDay, {});\n  }\n}),\n// é¡µé¢å¡«å……\n() => web.createComponent(IconButton, {\n  get tip() {\n    return helper.t('button.page_fill');\n  },\n  get enabled() {\n    return Boolean(store.fillEffect[nowFillIndex()]);\n  },\n  get hidden() {\n    return isOnePageMode();\n  },\n  onClick: switchFillEffect,\n  get children() {\n    return web.createComponent(MdQueue, {});\n  }\n}),\n// ç½‘æ ¼æ¨¡å¼\n() => web.createComponent(IconButton, {\n  get tip() {\n    return helper.t('button.grid_mode');\n  },\n  get enabled() {\n    return store.gridMode;\n  },\n  onClick: switchGridMode,\n  get children() {\n    return web.createComponent(MdGrid, {});\n  }\n}),\n// ç¿»è¯‘\n() => web.createComponent(solidJs.Show, {\n  get when() {\n    return store.option.translation.server !== 'disable';\n  },\n  get children() {\n    return [web.template(`<hr>`)(), web.createComponent(IconButton, {\n      get tip() {\n        return web.memo(() => !!isTranslatingImage())() ? helper.t('button.close_current_page_translation') : helper.t('button.translate_current_page');\n      },\n      get enabled() {\n        return isTranslatingImage();\n      },\n      onClick: translateCurrent,\n      get children() {\n        return web.createComponent(MdTranslate, {});\n      }\n    }), web.createComponent(IconButton, {\n      get tip() {\n        return helper.t('setting.translation.translate_to_end');\n      },\n      get enabled() {\n        return isTranslatingToEnd();\n      },\n      get hidden() {\n        return store.option.translation.server !== 'selfhosted';\n      },\n      onClick: translateToEnd,\n      get children() {\n        return web.createComponent(MdLowPriority, {});\n      }\n    })];\n  }\n}),\n// è‡ªåŠ¨æ»šåŠ¨\n() => web.createComponent(solidJs.Show, {\n  get when() {\n    return store.option.autoScroll.enabled;\n  },\n  get children() {\n    return [web.template(`<hr>`)(), web.createComponent(AutoScrollButton, {})];\n  }\n}), () => web.template(`<hr>`)(),\n// ç¼©æ”¾\n() => [web.createComponent(solidJs.Show, {\n  get when() {\n    return !store.option.scrollMode.enabled;\n  },\n  get children() {\n    return web.createComponent(ZoomButton, {});\n  }\n}), web.createComponent(solidJs.Show, {\n  get when() {\n    return web.memo(() => !!store.option.scrollMode.enabled)() && store.option.scrollMode.adjustToWidth !== 'full';\n  },\n  get children() {\n    return [web.createComponent(IconButton, {\n      get tip() {\n        return helper.t('button.zoom_in');\n      },\n      get enabled() {\n        return store.option.scrollMode.imgScale >= 3;\n      },\n      onClick: () => handleScrollModeZoom('add'),\n      get children() {\n        return web.createComponent(MdZoomIn, {});\n      }\n    }), web.createComponent(IconButton, {\n      get tip() {\n        return helper.t('button.zoom_out');\n      },\n      get enabled() {\n        return store.option.scrollMode.imgScale <= 0.1;\n      },\n      onClick: () => handleScrollModeZoom('sub'),\n      get children() {\n        return web.createComponent(MdZoomOut, {});\n      }\n    })];\n  }\n})],\n// å…¨å±\n() => web.createComponent(IconButton, {\n  get tip() {\n    return web.memo(() => !!store.fullscreen)() ? helper.t('button.fullscreen_exit') : helper.t('button.fullscreen');\n  },\n  get hidden() {\n    return !refs.root.requestFullscreen;\n  },\n  onClick: switchFullscreen,\n  get children() {\n    return web.memo(() => !!store.fullscreen)() ? web.createComponent(MdFullscreenExit, {}) : web.createComponent(MdFullscreen, {});\n  }\n}), DownloadButton,\n// è®¾ç½®\n() => {\n  const [showPanel, setShowPanel] = solidJs.createSignal(false);\n  const handleClick = () => {\n    const _showPanel = !showPanel();\n    setState('show', 'toolbar', _showPanel);\n    setShowPanel(_showPanel);\n  };\n  helper.createEffectOn(() => store.show.toolbar, showToolbar => showToolbar || setShowPanel(false));\n  const Popper = web.createComponent(solidJs.Show, {\n    get when() {\n      return showPanel();\n    },\n    get children() {\n      return [web.createComponent(SettingPanel, {}), (() => {\n        var _el$4 = web.template(`<div role=button tabindex=-1>`)();\n        _el$4.addEventListener(\"wheel\", e => {\n          if (isScrollMode()) refs.mangaBox.scrollBy({\n            top: e.deltaY\n          });\n        });\n        web.addEventListener(_el$4, \"click\", handleClick);\n        web.effect(() => web.className(_el$4, modules_c21c94f2$1.closeCover));\n        return _el$4;\n      })()];\n    }\n  });\n  return web.createComponent(IconButton, {\n    get tip() {\n      return helper.t('other.setting');\n    },\n    get enabled() {\n      return showPanel();\n    },\n    get showTip() {\n      return showPanel();\n    },\n    onClick: handleClick,\n    get popperClassName() {\n      return web.memo(() => !!showPanel())() && modules_c21c94f2$1.SettingPanelPopper;\n    },\n    get popper() {\n      return showPanel() && Popper;\n    },\n    get children() {\n      return web.createComponent(MdSettings, {});\n    }\n  });\n}, () => web.template(`<hr>`)(), () => web.createComponent(IconButton, {\n  get tip() {\n    return helper.t('other.exit');\n  },\n  onClick: () => store.prop.onExit?.(),\n  get children() {\n    return web.createComponent(MdClose, {});\n  }\n})];\n\n\n/** å·¦ä¾§å·¥å…·æ  */\nconst Toolbar = () => {\n  helper.createEffectOn(() => store.show.toolbar, show => show || focus());\n  return (() => {\n    var _el$ = web.template(`<div role=toolbar><div><div>`)(),\n      _el$2 = _el$.firstChild,\n      _el$3 = _el$2.firstChild;\n    web.addEventListener(_el$2, \"click\", focus);\n    web.insert(_el$2, web.createComponent(solidJs.For, {\n      get each() {\n        return store.prop.editButtonList(defaultButtonList);\n      },\n      children: ButtonItem => web.createComponent(ButtonItem, {})\n    }), null);\n    web.effect(_p$ => {\n      var _v$ = modules_c21c94f2$1.toolbar,\n        _v$2 = helper.boolDataVal(store.show.toolbar),\n        _v$3 = helper.boolDataVal(store.isMobile && store.gridMode),\n        _v$4 = store.isDragMode ? 'none' : undefined,\n        _v$5 = modules_c21c94f2$1.toolbarPanel,\n        _v$6 = modules_c21c94f2$1.toolbarBg;\n      _v$ !== _p$.e && web.className(_el$, _p$.e = _v$);\n      _v$2 !== _p$.t && web.setAttribute(_el$, \"data-show\", _p$.t = _v$2);\n      _v$3 !== _p$.a && web.setAttribute(_el$, \"data-close\", _p$.a = _v$3);\n      _v$4 !== _p$.o && web.setStyleProperty(_el$, \"pointer-events\", _p$.o = _v$4);\n      _v$5 !== _p$.i && web.className(_el$2, _p$.i = _v$5);\n      _v$6 !== _p$.n && web.className(_el$3, _p$.n = _v$6);\n      return _p$;\n    }, {\n      e: undefined,\n      t: undefined,\n      a: undefined,\n      o: undefined,\n      i: undefined,\n      n: undefined\n    });\n    return _el$;\n  })();\n};\n\n// TODO: ä½¿ç”¨ light-dark()\n// https://developer.mozilla.org/docs/Web/CSS/color_value/light-dark\n/** æ·±è‰²æ¨¡å¼ */\nconst darkStyle = {\n  '--hover-bg-color': '#FFF3',\n  '--hover-bg-color-enable': '#FFFa',\n  '--switch': '#BDBDBD',\n  '--switch-bg': '#6E6E6E',\n  '--page-bg': '#303030',\n  '--secondary': '#7A909A',\n  '--secondary-bg': '#556065',\n  '--text': 'white',\n  '--text-secondary': '#FFFC',\n  '--text-bg': '#121212',\n  'color-scheme': 'dark'\n};\n\n/** æµ…è‰²æ¨¡å¼ */\nconst lightStyle = {\n  '--hover-bg-color': '#0001',\n  '--hover-bg-color-enable': '#0009',\n  '--switch': '#FAFAFA',\n  '--switch-bg': '#9C9C9C',\n  '--page-bg': 'white',\n  '--secondary': '#7A909A',\n  '--secondary-bg': '#BAC5CA',\n  '--text': 'black',\n  '--text-secondary': '#0008',\n  '--text-bg': '#FAFAFA',\n  'color-scheme': 'light'\n};\nconst createSvgIcon = (fill, d) => `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='${fill}' viewBox='0 0 24 24'%3E%3Cpath d='${d}'/%3E%3C/svg%3E\")`;\nconst MdImageNotSupported = `m21.9 21.9-8.49-8.49-9.82-9.82L2.1 2.1.69 3.51 3 5.83V19c0 1.1.9 2 2 2h13.17l2.31 2.31 1.42-1.41zM5 18l3.5-4.5 2.5 3.01L12.17 15l3 3H5zm16 .17L5.83 3H19c1.1 0 2 .9 2 2v13.17z`;\nconst MdCloudDownload = `M19.35 10.04A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 0 0 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM17 13l-4.65 4.65c-.2.2-.51.2-.71 0L7 13h3V9h4v4h3z`;\nconst MdPhoto = `M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-4.86 8.86-3 3.87L9 13.14 6 17h12l-3.86-5.14z`;\nconst useCssVar = () => {\n  const svg = () => {\n    const fill = store.option.darkMode ? 'rgb(156,156,156)' : 'rgb(110,110,110)';\n    return {\n      '--md-image-not-supported': `${createSvgIcon(fill, MdImageNotSupported)}`,\n      '--md-cloud-download': `${createSvgIcon(fill, MdCloudDownload)}`,\n      '--md-photo': `${createSvgIcon(fill, MdPhoto)}`\n    };\n  };\n  const i18n = () => ({\n    '--i18n-touch-area-prev': `\"${helper.t('hotkeys.page_up')}\"`,\n    '--i18n-touch-area-next': `\"${helper.t('hotkeys.page_down')}\"`,\n    '--i18n-touch-area-menu': `\"${helper.t('touch_area.menu')}\"`\n  });\n  useStyleMemo(`.${modules_c21c94f2$1.root}`, [{\n    '--bg': () => `${store.option.customBackground ?? (store.option.darkMode ? '#000' : '#fff')}`,\n    '--scroll-mode-spacing': () => store.option.scrollMode.spacing\n  }, () => store.option.darkMode ? darkStyle : lightStyle, svg, i18n]);\n};\n\nconst useInit = props => {\n  watchDomSize('rootSize', refs.root);\n  const updateOption = state => {\n    state.defaultOption = helper.assign(defaultOption(), props.defaultOption ?? {});\n    state.option = helper.assign(state.defaultOption, props.option ?? {});\n  };\n  const bindProp = (key, defaultValue) => state => Reflect.set(state.prop, key, props[key] ?? defaultValue);\n  const bindDebounce = key => state => {\n    state.prop[key] = props[key] ? helper.debounce(props[key]) : undefined;\n  };\n  const watchProps = {\n    option: updateOption,\n    onLoading: bindDebounce('onLoading'),\n    onOptionChange: bindDebounce('onOptionChange'),\n    onHotkeysChange: bindDebounce('onHotkeysChange'),\n    onShowImgsChange: bindDebounce('onShowImgsChange'),\n    defaultOption(state) {\n      updateOption(state);\n    },\n    fillEffect(state) {\n      state.fillEffect = props.fillEffect ?? {\n        '-1': true\n      };\n      updatePageData(state);\n    },\n    onExit(state) {\n      state.prop.onExit = isEnd => {\n        playAnimation(refs.exit);\n        props.onExit?.(Boolean(isEnd));\n        setState(draftState => {\n          if (isEnd) draftState.activePageIndex = 0;\n          draftState.show.endPage = undefined;\n        });\n        if (document.fullscreenElement) document.exitFullscreen();\n      };\n    },\n    onPrev(state) {\n      state.prop.onPrev = props.onPrev ? helper.throttle(() => {\n        playAnimation(refs.prev);\n        props.onPrev?.();\n      }, 1000) : undefined;\n    },\n    onNext(state) {\n      state.prop.onNext = props.onNext ? helper.throttle(() => {\n        playAnimation(refs.next);\n        props.onNext?.();\n      }, 1000) : undefined;\n    },\n    onImgError: bindProp('onImgError'),\n    onWaitUrlImgs: bindProp('onWaitUrlImgs'),\n    editButtonList: bindProp('editButtonList', list => list),\n    editSettingList: bindProp('editSettingList', list => list),\n    commentList(state) {\n      state.commentList = props.commentList;\n    },\n    title(state) {\n      state.title = props.title ?? '';\n    }\n  };\n  for (const [key, fn] of Object.entries(watchProps)) {\n    solidJs.createEffect(solidJs.on(() => props[key], () => setState(fn)));\n  }\n  solidJs.createEffect(() => {\n    setState(state => {\n      state.hotkeys = {\n        ...structuredClone(defaultHotkeys()),\n        ...props.hotkeys\n      };\n    });\n  });\n  const handleImgList = () => {\n    setState(state => {\n      const newImgMap = {};\n      const newImgList = []; // å› ä¸ºä¼šæœ‰ç›¸åŒ url çš„å›¾ç‰‡ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨ Set\n      for (const img of store$1.unwrap(props.imgList)) {\n        // ä½¿ç”¨ç›¸å¯¹åè®®è·¯å¾„ï¼Œé˜²æ­¢ Mixed Content æŠ¥é”™\n        const url = (typeof img === 'object' ? img.src : img)?.replace(/^http:/, '') ?? '';\n        newImgList.push(url);\n        if (Reflect.has(newImgMap, url)) continue;\n        if (Reflect.has(state.imgMap, url)) {\n          newImgMap[url] = state.imgMap[url];\n          continue;\n        }\n        const imgItem = typeof img === 'string' ? {\n          src: url\n        } : img;\n        imgItem.loadType ??= 'wait';\n        if (imgItem.width && imgItem.height) {\n          imgItem.size = getImgDisplaySize(state, imgItem);\n          imgItem.type = getImgType(imgItem);\n        }\n        imgItem.size ??= placeholderSize();\n        if (!imgItem.blobUrl && url.startsWith('blob:')) imgItem.blobUrl = imgItem.src;\n        newImgMap[url] = imgItem;\n      }\n\n      /** ä¿®æ”¹å‰çš„å½“å‰æ˜¾ç¤ºå›¾ç‰‡ */\n      const oldActiveImg = state.pageList[state.activePageIndex]?.map(i => state.imgList?.[i]) ?? [];\n\n      /** æ˜¯å¦éœ€è¦é‡ç½®é¡µé¢å¡«å…… */\n      let needResetFillEffect = false;\n      const fillEffectList = Object.keys(state.fillEffect).map(Number);\n      for (const pageIndex of fillEffectList) {\n        if (pageIndex === -1) continue;\n        if (state.imgList[pageIndex] === newImgList[pageIndex]) continue;\n        needResetFillEffect = true;\n        break;\n      }\n      const oldImgList = new Set(state.imgList);\n      if (oldImgList.size === 0 && newImgList.length > 0) {\n        resumeReadProgress(state);\n        updateSelfhostedOptions(true);\n      }\n\n      /** è¢«åˆ é™¤çš„å›¾ç‰‡ */\n      const deleteList = [...oldImgList].filter(url => !newImgList.includes(url));\n      for (const url of deleteList) if (state.imgMap[url].blobUrl && state.imgMap[url].blobUrl !== url) URL.revokeObjectURL(state.imgMap[url].blobUrl);\n\n      /** åˆ é™¤å›¾ç‰‡æ•° */\n      const deleteNum = deleteList.length;\n\n      /** ä¼ å…¥çš„æ˜¯å¦æ˜¯æ–°æ¼«ç”» */\n      const isNew = deleteNum >= oldImgList.size * 0.8; // åˆ æ‰8æˆå›¾å°±ç®—æ˜¯æ–°æ¼«ç”»\n\n      /** æ˜¯å¦éœ€è¦æ›´æ–°é¡µé¢ */\n      const needUpdatePageData = needResetFillEffect || state.imgList.length !== newImgList.length || deleteNum > 0;\n      state.imgMap = newImgMap;\n      state.imgList = [...newImgList];\n      state.prop.onLoading?.(state.imgList.map(url => state.imgMap[url]));\n      if (isNew) state.show.endPage = undefined;\n      if (isNew || needResetFillEffect) state.fillEffect = props.fillEffect ?? {\n        '-1': true\n      };\n      if (isNew || needUpdatePageData) {\n        updatePageData(state);\n\n        // å½“å‰ä½äºæœ€åä¸€é¡µæ—¶æœ€åä¸€é¡µè¢«åˆ çš„å¤„ç†\n        if (state.activePageIndex >= state.pageList.length) state.activePageIndex = state.pageList.length - 1;\n        updateShowRange(state);\n      }\n      if (isNew || state.pageList.length === 0) {\n        resetImgState(state);\n        state.activePageIndex = 0;\n        scrollTo(0);\n        return;\n      }\n\n      // å°½é‡ä½¿å½“å‰æ˜¾ç¤ºçš„å›¾ç‰‡åœ¨ä¿®æ”¹åä¾ç„¶ä¸å˜\n      oldActiveImg.some(url => {\n        // è·³è¿‡å¡«å……é¡µå’Œå·²è¢«åˆ é™¤çš„å›¾ç‰‡\n        if (!url || newImgList.includes(url)) return false;\n        const newPageIndex = state.pageList.findIndex(page => page.some(index => state.imgList?.[index] === url));\n        if (newPageIndex === -1) return false;\n        state.activePageIndex = newPageIndex;\n        return true;\n      });\n\n      // å¦‚æœå·²ç»ç¿»åˆ°äº†æœ€åä¸€é¡µï¼Œä¸”æœ€åä¸€é¡µçš„å›¾ç‰‡è¢«åˆ æ‰äº†ï¼Œé‚£å°±ä¿æŒåœ¨æœ«é¡µæ˜¾ç¤º\n      if (state.activePageIndex > state.pageList.length - 1) state.activePageIndex = state.pageList.length - 1;\n    });\n  };\n\n  // å¤„ç† imgList å‚æ•°çš„åˆå§‹åŒ–å’Œä¿®æ”¹\n  helper.createEffectOn(helper.createRootMemo(() => props.imgList), helper.throttle(handleImgList, 500));\n\n  // é€šè¿‡æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ª Worker æ¥æ£€æµ‹æ˜¯å¦æ”¯æŒ Workerï¼Œé¿å…å› ä¸º CSP é™åˆ¶è€Œå‡ºé”™\n  setTimeout(() => {\n    const codeUrl = URL.createObjectURL(new Blob(['self.close();'], {\n      type: 'text/javascript'\n    }));\n    setTimeout(URL.revokeObjectURL, 0, codeUrl);\n    setState('supportWorker', Boolean(new Worker(codeUrl)));\n  }, 0);\n\n  // æ›´æ–° fullscreen å‚æ•°\n  refs.root.addEventListener('fullscreenchange', () => {\n    if (!document.fullscreenElement) return setState('fullscreen', false);\n    if (document.fullscreenElement.id === 'comicRead' || document.fullscreenElement.classList.contains(modules_c21c94f2$1.root)) setState('fullscreen', true);\n  });\n  for (const eventName of ['keypress', 'keyup', 'touchstart', 'touchmove', 'touchend']) refs.root.addEventListener(eventName, stopPropagation, {\n    capture: true\n  });\n  focus();\n};\n\nsolidJs.enableScheduling();\n/** æ¼«ç”»ç»„ä»¶ */\nconst Manga = props => {\n  useStyle(css$1);\n  useCssVar();\n  solidJs.onMount(() => useInit(props));\n  solidJs.createEffect(() => props.show && focus());\n  return (() => {\n    var _el$ = web.template(`<div>`)();\n    web.addEventListener(_el$, \"wheel\", handleWheel);\n    web.addEventListener(_el$, \"mousedown\", handleMouseDown);\n    web.addEventListener(_el$, \"click\", stopPropagation);\n    var _ref$ = bindRef('root');\n    typeof _ref$ === \"function\" && web.use(_ref$, _el$);\n    _el$.addEventListener(\"keydown\", handleKeyDown, true);\n    _el$.addEventListener(\"keyup\", handleKeyUp, true);\n    web.insert(_el$, web.createComponent(ComicImgFlow, {}), null);\n    web.insert(_el$, web.createComponent(TouchArea, {}), null);\n    web.insert(_el$, web.createComponent(Scrollbar, {}), null);\n    web.insert(_el$, web.createComponent(EndPage, {}), null);\n    web.insert(_el$, web.createComponent(Toolbar, {}), null);\n    web.effect(_p$ => {\n      var _v$ = modules_c21c94f2$1.root,\n        _v$2 = {\n          [modules_c21c94f2$1.hidden]: props.show === false,\n          [props.class ?? '']: Boolean(props.class),\n          ...props.classList\n        },\n        _v$3 = helper.boolDataVal(store.isMobile),\n        _v$4 = helper.boolDataVal(store.option.scrollMode.enabled),\n        _v$5 = helper.boolDataVal(store.gridMode);\n      _v$ !== _p$.e && web.className(_el$, _p$.e = _v$);\n      _p$.t = web.classList(_el$, _v$2, _p$.t);\n      _v$3 !== _p$.a && web.setAttribute(_el$, \"data-mobile\", _p$.a = _v$3);\n      _v$4 !== _p$.o && web.setAttribute(_el$, \"data-scroll-mode\", _p$.o = _v$4);\n      _v$5 !== _p$.i && web.setAttribute(_el$, \"data-grid-mode\", _p$.i = _v$5);\n      return _p$;\n    }, {\n      e: undefined,\n      t: undefined,\n      a: undefined,\n      o: undefined,\n      i: undefined\n    });\n    return _el$;\n  })();\n};\n\nexports.Manga = Manga;\nexports.SettingBlockSubtitle = SettingBlockSubtitle;\nexports.SettingHotkeys = SettingHotkeys;\nexports.SettingsItem = SettingsItem;\nexports.SettingsItemButton = SettingsItemButton;\nexports.SettingsItemNumber = SettingsItemNumber;\nexports.SettingsItemSwitch = SettingsItemSwitch;\nexports._setAbreastScrollFill = _setAbreastScrollFill;\nexports.abreastArea = abreastArea;\nexports.abreastColumnWidth = abreastColumnWidth;\nexports.abreastContentWidth = abreastContentWidth;\nexports.abreastScrollFill = abreastScrollFill;\nexports.abreastScrollWidth = abreastScrollWidth;\nexports.abreastShowColumn = abreastShowColumn;\nexports.activeImgIndex = activeImgIndex;\nexports.activePage = activePage;\nexports.autoPageNum = autoPageNum;\nexports.bindOption = bindOption$1;\nexports.bindRef = bindRef;\nexports.bindScrollTop = bindScrollTop;\nexports.bound = bound;\nexports.checkImgSize = checkImgSize;\nexports.constantScroll = constantScroll;\nexports.contentHeight = contentHeight;\nexports.defaultHotkeys = defaultHotkeys;\nexports.doubleClickZoom = doubleClickZoom;\nexports.downloadImg = downloadImg;\nexports.downloadImgHeaders = downloadImgHeaders;\nexports.findFillIndex = findFillIndex;\nexports.findTopPage = findTopPage;\nexports.focus = focus;\nexports.getImg = getImg;\nexports.getImgDisplaySize = getImgDisplaySize;\nexports.getImgEle = getImgEle;\nexports.getImgIndexs = getImgIndexs;\nexports.getImgTip = getImgTip;\nexports.getImgType = getImgType;\nexports.getPageTip = getPageTip;\nexports.getPageTop = getPageTop;\nexports.getTurnPageDir = getTurnPageDir;\nexports.handleClick = handleClick;\nexports.handleComicData = handleComicData;\nexports.handleEndTurnPage = handleEndTurnPage;\nexports.handleHotkey = handleHotkey;\nexports.handleImgError = handleImgError;\nexports.handleImgLoaded = handleImgLoaded;\nexports.handleKeyDown = handleKeyDown;\nexports.handleKeyUp = handleKeyUp;\nexports.handleMangaFlowDrag = handleMangaFlowDrag;\nexports.handleMouseDown = handleMouseDown;\nexports.handlePinchZoom = handlePinchZoom;\nexports.handleScrollModeDrag = handleScrollModeDrag;\nexports.handleScrollModeZoom = handleScrollModeZoom;\nexports.handleScrollbarSlider = handleScrollbarSlider;\nexports.handleTrackpadWheel = handleTrackpadWheel;\nexports.handleWheel = handleWheel;\nexports.handleZoomDrag = handleZoomDrag;\nexports.hotkeysMap = hotkeysMap;\nexports.imgAreaStyle = imgAreaStyle;\nexports.imgList = imgList;\nexports.imgPageMap = imgPageMap;\nexports.imgShowState = imgShowState;\nexports.isAbreastMode = isAbreastMode;\nexports.isBottom = isBottom;\nexports.isDoubleMode = isDoubleMode;\nexports.isDrag = isDrag;\nexports.isEnableBg = isEnableBg;\nexports.isOnePageMode = isOnePageMode;\nexports.isScrollMode = isScrollMode;\nexports.isSingleMode = isSingleMode;\nexports.isTop = isTop;\nexports.isTranslatingAll = isTranslatingAll;\nexports.isTranslatingImage = isTranslatingImage;\nexports.isTranslatingToEnd = isTranslatingToEnd;\nexports.isUpscale = isUpscale;\nexports.isUseAutoScale = isUseAutoScale;\nexports.jumpToImg = jumpToImg;\nexports.listenHotkey = listenHotkey;\nexports.loadingImgList = loadingImgList;\nexports.nowFillIndex = nowFillIndex;\nexports.openScrollLock = openScrollLock;\nexports.pageHeightList = pageHeightList;\nexports.pageNum = pageNum;\nexports.pageTopList = pageTopList;\nexports.placeholderSize = placeholderSize;\nexports.preloadNum = preloadNum;\nexports.refs = refs;\nexports.reloadImg = reloadImg;\nexports.renderImgList = renderImgList;\nexports.resetImgState = resetImgState;\nexports.resetPage = resetPage;\nexports.resetUI = resetUI;\nexports.resumeReadProgress = resumeReadProgress;\nexports.saveReadProgress = saveReadProgress;\nexports.saveScrollProgress = saveScrollProgress;\nexports.scrollBy = scrollBy;\nexports.scrollDomLength = scrollDomLength;\nexports.scrollLength = scrollLength;\nexports.scrollModeScale = scrollModeScale;\nexports.scrollPercentage = scrollPercentage;\nexports.scrollPosition = scrollPosition;\nexports.scrollProgress = scrollProgress;\nexports.scrollTo = scrollTo;\nexports.scrollTop = scrollTop;\nexports.scrollViewImg = scrollViewImg;\nexports.selfhostedOptions = selfhostedOptions;\nexports.selfhostedTranslation = selfhostedTranslation;\nexports.setAbreastScrollFill = setAbreastScrollFill;\nexports.setAdjustToWidth = setAdjustToWidth;\nexports.setDefaultHotkeys = setDefaultHotkeys;\nexports.setImgScale = setImgScale;\nexports.setImgTranslationEnbale = setImgTranslationEnbale;\nexports.setIsDrag = setIsDrag;\nexports.setOption = setOption;\nexports.setSelfOptions = setSelfOptions;\nexports.setState = setState;\nexports.showImgList = showImgList;\nexports.sliderHeight = sliderHeight;\nexports.sliderMidpoint = sliderMidpoint;\nexports.sliderTop = sliderTop;\nexports.store = store;\nexports.switchAutoScroll = switchAutoScroll;\nexports.switchDir = switchDir;\nexports.switchFillEffect = switchFillEffect;\nexports.switchFullscreen = switchFullscreen;\nexports.switchGridMode = switchGridMode;\nexports.switchImgRecognition = switchImgRecognition;\nexports.switchOnePageMode = switchOnePageMode;\nexports.switchScrollMode = switchScrollMode;\nexports.touches = touches;\nexports.translateAll = translateAll;\nexports.translateCurrent = translateCurrent;\nexports.translateToEnd = translateToEnd;\nexports.translationAll = translationAll;\nexports.translationImage = translationImage;\nexports.translationImgs = translationImgs;\nexports.translatorOptions = translatorOptions;\nexports.turnPage = turnPage;\nexports.turnPageAnimation = turnPageAnimation;\nexports.updateImgLoadType = updateImgLoadType;\nexports.updateImgSize = updateImgSize;\nexports.updateImgType = updateImgType;\nexports.updatePageData = updatePageData;\nexports.updateSelfhostedOptions = updateSelfhostedOptions;\nexports.updateShowRange = updateShowRange;\nexports.upscaleImage = upscaleImage;\nexports.watchDomSize = watchDomSize;\nexports.withOptionalState = withOptionalState;\nexports.zoom = zoom;\n";break;case"components/IconButton":c='\nconst web = require(\'solid-js/web\');\nconst solidJs = require(\'solid-js\');\nconst helper = require(\'helper\');\n\nvar css = ".iconButtonItem____hash_base64_5_{align-items:center;display:flex;position:relative}.iconButton____hash_base64_5_{align-items:center;background-color:initial;border-radius:9999px;border-style:none;color:var(--text,#fff);cursor:pointer;display:flex;font-size:1.5em;height:1.5em;justify-content:center;margin:.1em;outline:none;padding:0;width:1.5em}.iconButton____hash_base64_5_:focus,.iconButton____hash_base64_5_:hover{background-color:var(--hover-bg-color,#fff3)}.iconButton____hash_base64_5_.enabled____hash_base64_5_:not(.disable____hash_base64_5_){background-color:var(--text,#fff);color:var(--text-bg,#121212)}.iconButton____hash_base64_5_.enabled____hash_base64_5_:not(.disable____hash_base64_5_):focus,.iconButton____hash_base64_5_.enabled____hash_base64_5_:not(.disable____hash_base64_5_):hover{background-color:var(--hover-bg-color-enable,#fffa)}.iconButton____hash_base64_5_.disable____hash_base64_5_{background-color:unset;cursor:not-allowed;opacity:.5}.iconButton____hash_base64_5_>svg{width:1em}.iconButtonPopper____hash_base64_5_{align-items:center;background-color:#303030;border-radius:.3em;color:#fff;display:flex;font-size:.8em;opacity:0;padding:.4em .5em;pointer-events:none;position:absolute;top:50%;transform:translateY(-50%);-webkit-user-select:none;user-select:none;white-space:nowrap}.iconButtonPopper____hash_base64_5_[data-placement=right]{left:calc(100% + 1.5em)}.iconButtonPopper____hash_base64_5_[data-placement=right]:before{border-right-color:var(--switch-bg,#6e6e6e);border-right-width:.5em;right:calc(100% + .5em)}.iconButtonPopper____hash_base64_5_[data-placement=left]{right:calc(100% + 1.5em)}.iconButtonPopper____hash_base64_5_[data-placement=left]:before{border-left-color:var(--switch-bg,#6e6e6e);border-left-width:.5em;left:calc(100% + .5em)}.iconButtonPopper____hash_base64_5_:before{background-color:initial;border:.4em solid #0000;content:\\"\\";pointer-events:none;position:absolute;transition:opacity .15s}.iconButtonItem____hash_base64_5_:is(:hover,:focus,[data-show=true]) .iconButtonPopper____hash_base64_5_{opacity:1}.hidden____hash_base64_5_{display:none}";\nvar modules_c21c94f2 = {"iconButtonItem":"iconButtonItem____hash_base64_5_","iconButton":"iconButton____hash_base64_5_","enabled":"enabled____hash_base64_5_","disable":"disable____hash_base64_5_","iconButtonPopper":"iconButtonPopper____hash_base64_5_","hidden":"hidden____hash_base64_5_"};\n\n/** å›¾æ ‡æŒ‰é’® */\nconst IconButton = _props => {\n  const props = solidJs.mergeProps({\n    placement: \'right\'\n  }, _props);\n  let buttonRef; // oxlint-disable-line no-unassigned-vars\n  const handleClick = e => {\n    if (props.disable) return;\n    props.onClick?.(e);\n    // åœ¨æ¯æ¬¡ç‚¹å‡»åå–æ¶ˆç„¦ç‚¹\n    buttonRef?.blur();\n  };\n  return (() => {\n    var _el$ = web.template(`<div><button type=button tabindex=0>`)(),\n      _el$2 = _el$.firstChild;\n    web.use(ref => helper.useStyle(css, ref), _el$);\n    web.addEventListener(_el$2, "click", handleClick);\n    var _ref$ = buttonRef;\n    typeof _ref$ === "function" ? web.use(_ref$, _el$2) : buttonRef = _el$2;\n    web.insert(_el$2, () => props.children);\n    web.insert(_el$, (() => {\n      var _c$ = web.memo(() => !!(props.popper || props.tip));\n      return () => _c$() ? (() => {\n        var _el$3 = web.template(`<div>`)();\n        web.insert(_el$3, () => props.popper || props.tip);\n        web.effect(_p$ => {\n          var _v$7 = [modules_c21c94f2.iconButtonPopper, props.popperClassName].join(\' \'),\n            _v$8 = props.placement;\n          _v$7 !== _p$.e && web.className(_el$3, _p$.e = _v$7);\n          _v$8 !== _p$.t && web.setAttribute(_el$3, "data-placement", _p$.t = _v$8);\n          return _p$;\n        }, {\n          e: undefined,\n          t: undefined\n        });\n        return _el$3;\n      })() : null;\n    })(), null);\n    web.effect(_p$ => {\n      var _v$ = modules_c21c94f2.iconButtonItem,\n        _v$2 = props.showTip,\n        _v$3 = props.tip,\n        _v$4 = modules_c21c94f2.iconButton,\n        _v$5 = props.style,\n        _v$6 = {\n          [modules_c21c94f2.hidden]: props.hidden,\n          [modules_c21c94f2.enabled]: props.enabled,\n          [modules_c21c94f2.disable]: props.disable\n        };\n      _v$ !== _p$.e && web.className(_el$, _p$.e = _v$);\n      _v$2 !== _p$.t && web.setAttribute(_el$, "data-show", _p$.t = _v$2);\n      _v$3 !== _p$.a && web.setAttribute(_el$2, "aria-label", _p$.a = _v$3);\n      _v$4 !== _p$.o && web.className(_el$2, _p$.o = _v$4);\n      _p$.i = web.style(_el$2, _v$5, _p$.i);\n      _p$.n = web.classList(_el$2, _v$6, _p$.n);\n      return _p$;\n    }, {\n      e: undefined,\n      t: undefined,\n      a: undefined,\n      o: undefined,\n      i: undefined,\n      n: undefined\n    });\n    return _el$;\n  })();\n};\n\nexports.IconButton = IconButton;\n';break;case"components/Fab":c='\nconst web = require(\'solid-js/web\');\nconst solidJs = require(\'solid-js\');\nconst helper = require(\'helper\');\n\nconst MdMenuBook = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24"stroke=currentColor fill=currentColor stroke-width=0><path d="M17.5 4.5c-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5-1.45 0-2.99.22-4.28.79C1.49 5.62 1 6.33 1 7.14v11.28c0 1.3 1.22 2.26 2.48 1.94.98-.25 2.02-.36 3.02-.36 1.56 0 3.22.26 4.56.92.6.3 1.28.3 1.87 0 1.34-.67 3-.92 4.56-.92 1 0 2.04.11 3.02.36 1.26.33 2.48-.63 2.48-1.94V7.14c0-.81-.49-1.52-1.22-1.85-1.28-.57-2.82-.79-4.27-.79M21 17.23c0 .63-.58 1.09-1.2.98-.75-.14-1.53-.2-2.3-.2-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5.92 0 1.83.09 2.7.28.46.1.8.51.8.98z"></path><path d="M13.98 11.01c-.32 0-.61-.2-.71-.52-.13-.39.09-.82.48-.94 1.54-.5 3.53-.66 5.36-.45.41.05.71.42.66.83s-.42.71-.83.66c-1.62-.19-3.39-.04-4.73.39-.08.01-.16.03-.23.03m0 2.66c-.32 0-.61-.2-.71-.52-.13-.39.09-.82.48-.94 1.53-.5 3.53-.66 5.36-.45.41.05.71.42.66.83s-.42.71-.83.66c-1.62-.19-3.39-.04-4.73.39a1 1 0 0 1-.23.03m0 2.66c-.32 0-.61-.2-.71-.52-.13-.39.09-.82.48-.94 1.53-.5 3.53-.66 5.36-.45.41.05.71.42.66.83s-.42.7-.83.66c-1.62-.19-3.39-.04-4.73.39a1 1 0 0 1-.23.03">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nvar css = ".fabRoot____hash_base64_5_{font-size:1.1em;touch-action:none;transition:transform .2s}.fabRoot____hash_base64_5_[data-show=false]{pointer-events:none}.fabRoot____hash_base64_5_[data-show=false]>button{transform:scale(0)}.fabRoot____hash_base64_5_[data-trans=true]{opacity:.8}.fabRoot____hash_base64_5_[data-trans=true]:focus,.fabRoot____hash_base64_5_[data-trans=true]:focus-visible,.fabRoot____hash_base64_5_[data-trans=true]:hover{opacity:1}.fab____hash_base64_5_{align-items:center;background-color:var(--fab,#607d8b);border:none;border-radius:100%;box-shadow:0 3px 5px -1px #0003,0 6px 10px 0 #00000024,0 1px 18px 0 #0000001f;color:#fff;cursor:pointer;display:flex;font-size:1em;height:3.6em;justify-content:center;transform:scale(1);transition:transform .2s;width:3.6em}.fab____hash_base64_5_>svg{font-size:1.5em;width:1em}.fab____hash_base64_5_:focus,.fab____hash_base64_5_:focus-visible{box-shadow:0 3px 5px -1px #00000080,0 6px 10px 0 #00000057,0 1px 18px 0 #00000052;outline:none}.progress____hash_base64_5_{color:#b0bec5;display:inline-block;height:100%;position:absolute;transform:rotate(-90deg);transition:transform .3s cubic-bezier(.4,0,.2,1) 0s;width:100%}.progress____hash_base64_5_>svg{stroke:currentcolor;stroke-dasharray:290%;stroke-dashoffset:100%;stroke-linecap:round;transition:stroke-dashoffset .3s cubic-bezier(.4,0,.2,1) 0s}.progress____hash_base64_5_:hover{color:#cfd8dc}.progress____hash_base64_5_[aria-valuenow=\\"1\\"]{opacity:0;transition:opacity .2s .15s}.popper____hash_base64_5_{align-items:center;background-color:#303030;border-radius:.3em;color:#fff;display:flex;font-size:.8em;opacity:0;padding:.4em .5em;pointer-events:none;position:absolute;right:calc(100% + 1.5em);top:50%;transform:translateY(-50%) scale(0);transform-origin:right;transition:transform .23s,opacity .15s;transition-delay:var(--hide-delay);white-space:nowrap}.fabRoot____hash_base64_5_[data-placement=right] .popper____hash_base64_5_{left:calc(100% + 1.5em);right:unset;transform-origin:left}.fabRoot____hash_base64_5_:is(:hover,[data-focus=true]) .popper____hash_base64_5_{opacity:1;transform:translateY(-50%) scale(1);transition-delay:0s}.speedDial____hash_base64_5_{align-items:center;bottom:0;display:flex;flex-direction:column-reverse;font-size:1.1em;padding-bottom:120%;pointer-events:none;position:absolute;touch-action:none;width:100%;z-index:-1}.speedDial____hash_base64_5_[data-placement=bottom]{bottom:unset;flex-direction:column;padding-bottom:unset;padding-top:120%;top:0}.speedDialItem____hash_base64_5_{margin:.1em 0;opacity:0;transform:scale(0);transition-delay:var(--hide-delay);transition-duration:.23s;transition-property:transform,opacity}.fabRoot____hash_base64_5_:is(:hover:not([data-show=false]),[data-focus=true]) .speedDial____hash_base64_5_,.speedDial____hash_base64_5_:hover{pointer-events:all}:is(.fabRoot____hash_base64_5_:is(:hover:not([data-show=false]),[data-focus=true]) .speedDial____hash_base64_5_)>.speedDialItem____hash_base64_5_{opacity:unset;transform:unset;transition-delay:var(--show-delay)}.backdrop____hash_base64_5_{background:#000;height:100vh;left:0;opacity:0;pointer-events:none;position:fixed;top:0;transition:opacity .5s;width:100vw}.fabRoot____hash_base64_5_[data-focus=true] .backdrop____hash_base64_5_{pointer-events:unset}:is(.fabRoot____hash_base64_5_:hover:not([data-show=false]),.fabRoot____hash_base64_5_[data-focus=true],.speedDial____hash_base64_5_:hover) .backdrop____hash_base64_5_{opacity:.4}";\nvar modules_c21c94f2 = {"fabRoot":"fabRoot____hash_base64_5_","fab":"fab____hash_base64_5_","progress":"progress____hash_base64_5_","popper":"popper____hash_base64_5_","speedDial":"speedDial____hash_base64_5_","speedDialItem":"speedDialItem____hash_base64_5_","backdrop":"backdrop____hash_base64_5_"};\n\n/**\n * Fab æŒ‰é’®\n */\nconst Fab = _props => {\n  const props = solidJs.mergeProps({\n    progress: 0,\n    initialShow: true,\n    autoTrans: false\n  }, _props);\n\n  // ä¸Šæ¬¡æ»šåŠ¨ä½ç½®\n  let lastY = window.scrollY;\n  const [show, setShow] = solidJs.createSignal(props.initialShow);\n\n  // ç»‘å®šæ»šåŠ¨äº‹ä»¶\n  const handleScroll = helper.throttle(e => {\n    // è·³è¿‡éç”¨æˆ·æ“ä½œçš„æ»šåŠ¨\n    if (!e.isTrusted) return;\n    if (window.scrollY === lastY) return;\n    setShow(\n    // æ»šåŠ¨åˆ°åº•éƒ¨æ—¶æ˜¾ç¤º\n    window.scrollY + window.innerHeight >= document.body.scrollHeight ||\n    // å‘ä¸Šæ»šåŠ¨æ—¶æ˜¾ç¤ºï¼Œåä¹‹éšè—\n    window.scrollY - lastY < 0);\n    lastY = window.scrollY;\n  }, 200);\n  solidJs.onMount(() => window.addEventListener(\'scroll\', handleScroll));\n  solidJs.onCleanup(() => window.removeEventListener(\'scroll\', handleScroll));\n\n  // å°† forceShow çš„å˜åŒ–åŒæ­¥åˆ° show ä¸Š\n  solidJs.createEffect(() => props.show && setShow(props.show));\n  return (() => {\n    var _el$ = web.template(`<div><button type=button tabindex=-1><span role=progressbar><svg viewBox="22 22 44 44"><circle cx=44 cy=44 r=20.2 fill=none stroke-width=3.6>`)(),\n      _el$2 = _el$.firstChild,\n      _el$3 = _el$2.firstChild,\n      _el$4 = _el$3.firstChild;\n    web.use(ref => helper.useStyle(css, ref), _el$);\n    web.addEventListener(_el$2, "click", () => props.onClick?.());\n    web.use(ref => props.ref?.(ref), _el$2);\n    web.insert(_el$2, () => props.children ?? web.createComponent(MdMenuBook, {}), _el$3);\n    web.insert(_el$2, (() => {\n      var _c$ = web.memo(() => !!props.tip);\n      return () => _c$() ? (() => {\n        var _el$7 = web.template(`<div>`)();\n        web.insert(_el$7, () => props.tip);\n        web.effect(() => web.className(_el$7, modules_c21c94f2.popper));\n        return _el$7;\n      })() : null;\n    })(), null);\n    web.insert(_el$, web.createComponent(solidJs.Show, {\n      get when() {\n        return props.speedDial?.length;\n      },\n      get children() {\n        var _el$5 = web.template(`<div><div>`)(),\n          _el$6 = _el$5.firstChild;\n        web.addEventListener(_el$6, "click", () => props.onBackdropClick?.());\n        web.insert(_el$5, web.createComponent(solidJs.For, {\n          get each() {\n            return props.speedDial;\n          },\n          children: (SpeedDialItem, i) => (() => {\n            var _el$8 = web.template(`<div>`)();\n            web.insert(_el$8, web.createComponent(SpeedDialItem, {}));\n            web.effect(_p$ => {\n              var _v$12 = modules_c21c94f2.speedDialItem,\n                _v$13 = `${(i() + 1) * 30}ms`,\n                _v$14 = `${(props.speedDial.length - 1 - i()) * 50}ms`,\n                _v$15 = i() * 30;\n              _v$12 !== _p$.e && web.className(_el$8, _p$.e = _v$12);\n              _v$13 !== _p$.t && web.setStyleProperty(_el$8, "--show-delay", _p$.t = _v$13);\n              _v$14 !== _p$.a && web.setStyleProperty(_el$8, "--hide-delay", _p$.a = _v$14);\n              _v$15 !== _p$.o && web.setAttribute(_el$8, "data-i", _p$.o = _v$15);\n              return _p$;\n            }, {\n              e: undefined,\n              t: undefined,\n              a: undefined,\n              o: undefined\n            });\n            return _el$8;\n          })()\n        }), null);\n        web.effect(_p$ => {\n          var _v$ = modules_c21c94f2.speedDial,\n            _v$2 = props.speedDialPlacement,\n            _v$3 = modules_c21c94f2.backdrop;\n          _v$ !== _p$.e && web.className(_el$5, _p$.e = _v$);\n          _v$2 !== _p$.t && web.setAttribute(_el$5, "data-placement", _p$.t = _v$2);\n          _v$3 !== _p$.a && web.className(_el$6, _p$.a = _v$3);\n          return _p$;\n        }, {\n          e: undefined,\n          t: undefined,\n          a: undefined\n        });\n        return _el$5;\n      }\n    }), null);\n    web.effect(_p$ => {\n      var _v$4 = modules_c21c94f2.fabRoot,\n        _v$5 = props.show ?? show(),\n        _v$6 = props.autoTrans,\n        _v$7 = props.focus,\n        _v$8 = props.placement,\n        _v$9 = {\n          ...props.style,\n          \'--hide-delay\': `${(props.speedDial?.length ?? 0) * 50}ms`\n        },\n        _v$0 = modules_c21c94f2.fab,\n        _v$1 = modules_c21c94f2.progress,\n        _v$10 = props.progress,\n        _v$11 = `${(1 - props.progress) * 290}%`;\n      _v$4 !== _p$.e && web.className(_el$, _p$.e = _v$4);\n      _v$5 !== _p$.t && web.setAttribute(_el$, "data-show", _p$.t = _v$5);\n      _v$6 !== _p$.a && web.setAttribute(_el$, "data-trans", _p$.a = _v$6);\n      _v$7 !== _p$.o && web.setAttribute(_el$, "data-focus", _p$.o = _v$7);\n      _v$8 !== _p$.i && web.setAttribute(_el$, "data-placement", _p$.i = _v$8);\n      _p$.n = web.style(_el$, _v$9, _p$.n);\n      _v$0 !== _p$.s && web.className(_el$2, _p$.s = _v$0);\n      _v$1 !== _p$.h && web.className(_el$3, _p$.h = _v$1);\n      _v$10 !== _p$.r && web.setAttribute(_el$3, "aria-valuenow", _p$.r = _v$10);\n      _v$11 !== _p$.d && web.setStyleProperty(_el$4, "stroke-dashoffset", _p$.d = _v$11);\n      return _p$;\n    }, {\n      e: undefined,\n      t: undefined,\n      a: undefined,\n      o: undefined,\n      i: undefined,\n      n: undefined,\n      s: undefined,\n      h: undefined,\n      r: undefined,\n      d: undefined\n    });\n    return _el$;\n  })();\n};\n\nexports.Fab = Fab;\n';break;case"components/Toast":c="\nconst helper = require('helper');\nconst web = require('solid-js/web');\nconst solidJs = require('solid-js');\n\nconst {\n  store,\n  setState\n} = helper.useStore({\n  ref: null,\n  list: [],\n  map: {}\n});\nconst creatId = () => {\n  let id = `${Date.now()}`;\n  while (Reflect.has(store.map, id)) id += '_';\n  return id;\n};\nconst dismiss = id => Reflect.has(store.map, id) && setState('map', id, 'exit', true);\n\nvar css = \".root____hash_base64_5_{align-items:flex-end;bottom:0;display:flex;flex-direction:column;font-size:16px;pointer-events:none;position:fixed;right:0;z-index:2147483647}.item____hash_base64_5_{align-items:center;animation:bounceInRight____hash_base64_5_ .5s 1;background:#fff;border-radius:4px;box-shadow:0 1px 10px 0 #0000001a,0 2px 15px 0 #0000000d;color:#000;cursor:pointer;display:flex;margin:1em;max-width:min(30em,100vw);overflow:hidden;padding:.8em 1em;pointer-events:auto;position:relative;width:fit-content}.item____hash_base64_5_>svg{color:var(--theme);margin-right:.5em;width:1.5em}.item____hash_base64_5_[data-exit]{animation:bounceOutRight____hash_base64_5_ .5s 1}.schedule____hash_base64_5_{background-color:var(--theme);bottom:0;height:.2em;left:0;position:absolute;transform-origin:left;width:100%}.item____hash_base64_5_[data-schedule] .schedule____hash_base64_5_{transition:transform .1s}.item____hash_base64_5_:not([data-schedule]) .schedule____hash_base64_5_{animation:schedule____hash_base64_5_ linear 1 forwards}:is(.item____hash_base64_5_:hover,.item____hash_base64_5_[data-schedule],.root____hash_base64_5_[data-paused]) .schedule____hash_base64_5_{animation-play-state:paused}.msg____hash_base64_5_{line-height:1.4em;overflow-wrap:anywhere;text-align:start;white-space:break-spaces;width:fit-content}.msg____hash_base64_5_ h2{margin:0}.msg____hash_base64_5_ h3{margin:.7em 0}.msg____hash_base64_5_ ul{margin:0;text-align:left}.msg____hash_base64_5_ button{background-color:#eee;border:none;border-radius:.4em;cursor:pointer;font-size:inherit;margin:0 .5em;outline:none;padding:.2em .6em}:is(.msg____hash_base64_5_ button):hover{background:#e0e0e0}p{margin:0}@keyframes schedule____hash_base64_5_{0%{transform:scaleX(1)}to{transform:scaleX(0)}}@keyframes bounceInRight____hash_base64_5_{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0) scaleX(3)}60%{opacity:1;transform:translate3d(-25px,0,0) scaleX(1)}75%{transform:translate3d(10px,0,0) scaleX(.98)}90%{transform:translate3d(-5px,0,0) scaleX(.995)}to{transform:translateZ(0)}}@keyframes bounceOutRight____hash_base64_5_{20%{opacity:1;transform:translate3d(-20px,0,0) scaleX(.9)}to{opacity:0;transform:translate3d(2000px,0,0) scaleX(2)}}\";\nvar modules_c21c94f2 = {\"root\":\"root____hash_base64_5_\",\"item\":\"item____hash_base64_5_\",\"schedule\":\"schedule____hash_base64_5_\",\"msg\":\"msg____hash_base64_5_\"};\n\nconst MdCheckCircle = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M9.29 16.29 5.7 12.7a.996.996 0 1 1 1.41-1.41L10 14.17l6.88-6.88a.996.996 0 1 1 1.41 1.41l-7.59 7.59a.996.996 0 0 1-1.41 0\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdError = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 11c-.55 0-1-.45-1-1V8c0-.55.45-1 1-1s1 .45 1 1v4c0 .55-.45 1-1 1m1 4h-2v-2h2z\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdInfo = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 15c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1s1 .45 1 1v4c0 .55-.45 1-1 1m1-8h-2V7h2z\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdWarning = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M4.47 21h15.06c1.54 0 2.5-1.67 1.73-3L13.73 4.99c-.77-1.33-2.69-1.33-3.46 0L2.74 18c-.77 1.33.19 3 1.73 3M12 14c-.55 0-1-.45-1-1v-2c0-.55.45-1 1-1s1 .45 1 1v2c0 .55-.45 1-1 1m1 4h-2v-2h2z\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst iconMap = {\n  info: MdInfo,\n  success: MdCheckCircle,\n  warn: MdWarning,\n  error: MdError\n};\nconst colorMap = {\n  info: '#3a97d7',\n  success: '#23bb35',\n  warn: '#f0c53e',\n  error: '#e45042',\n  custom: '#1f2936'\n};\n\n/** åˆ é™¤ toast */\nconst dismissToast = id => setState(state => {\n  state.map[id]?.onDismiss?.({\n    ...state.map[id]\n  });\n  const i = state.list.indexOf(id);\n  if (i !== -1) state.list.splice(i, 1);\n  Reflect.deleteProperty(state.map, id);\n});\n\n/** é‡ç½® toast çš„ update å±æ€§ */\nconst resetToastUpdate = id => setState('map', id, 'update', undefined);\nconst ToastItem = props => {\n  /** æ˜¯å¦è¦æ˜¾ç¤ºè¿›åº¦ */\n  const showSchedule = solidJs.createMemo(() => props.duration === Number.POSITIVE_INFINITY && props.schedule ? true : undefined);\n  const _dismiss = e => {\n    e.stopPropagation();\n    if (showSchedule() && 'animationName' in e) return;\n    dismiss(props.id);\n  };\n\n  // åœ¨é€€å‡ºåŠ¨ç”»ç»“æŸåæ‰çœŸçš„åˆ é™¤\n  const handleAnimationEnd = () => {\n    if (!props.exit) return;\n    dismissToast(props.id);\n  };\n  let scheduleRef; // oxlint-disable-line no-unassigned-vars\n  solidJs.createEffect(() => {\n    if (!props.update) return;\n    resetToastUpdate(props.id);\n    if (!scheduleRef) return;\n    for (const animation of scheduleRef.getAnimations()) animation.currentTime = 0;\n  });\n  const handleClick = e => {\n    props.onClick?.();\n    _dismiss(e);\n  };\n  return (() => {\n    var _el$ = web.template(`<div><div>`)(),\n      _el$2 = _el$.firstChild;\n    _el$.addEventListener(\"animationend\", handleAnimationEnd);\n    web.addEventListener(_el$, \"click\", handleClick);\n    web.insert(_el$, web.createComponent(web.Dynamic, {\n      get component() {\n        return iconMap[props.type];\n      }\n    }), _el$2);\n    web.insert(_el$2, (() => {\n      var _c$ = web.memo(() => typeof props.msg === 'string');\n      return () => _c$() ? props.msg : web.createComponent(props.msg, {});\n    })());\n    web.insert(_el$, web.createComponent(solidJs.Show, {\n      get when() {\n        return props.duration !== Number.POSITIVE_INFINITY || props.schedule !== undefined;\n      },\n      get children() {\n        var _el$3 = web.template(`<div>`)();\n        _el$3.addEventListener(\"animationend\", _dismiss);\n        var _ref$ = scheduleRef;\n        typeof _ref$ === \"function\" ? web.use(_ref$, _el$3) : scheduleRef = _el$3;\n        web.effect(_p$ => {\n          var _v$ = modules_c21c94f2.schedule,\n            _v$2 = `${props.duration}ms`,\n            _v$3 = showSchedule() ? `scaleX(${props.schedule})` : undefined;\n          _v$ !== _p$.e && web.className(_el$3, _p$.e = _v$);\n          _v$2 !== _p$.t && web.setStyleProperty(_el$3, \"animation-duration\", _p$.t = _v$2);\n          _v$3 !== _p$.a && web.setStyleProperty(_el$3, \"transform\", _p$.a = _v$3);\n          return _p$;\n        }, {\n          e: undefined,\n          t: undefined,\n          a: undefined\n        });\n        return _el$3;\n      }\n    }), null);\n    web.effect(_p$ => {\n      var _v$4 = modules_c21c94f2.item,\n        _v$5 = colorMap[props.type],\n        _v$6 = showSchedule(),\n        _v$7 = props.exit,\n        _v$8 = modules_c21c94f2.msg;\n      _v$4 !== _p$.e && web.className(_el$, _p$.e = _v$4);\n      _v$5 !== _p$.t && web.setStyleProperty(_el$, \"--theme\", _p$.t = _v$5);\n      _v$6 !== _p$.a && web.setAttribute(_el$, \"data-schedule\", _p$.a = _v$6);\n      _v$7 !== _p$.o && web.setAttribute(_el$, \"data-exit\", _p$.o = _v$7);\n      _v$8 !== _p$.i && web.className(_el$2, _p$.i = _v$8);\n      return _p$;\n    }, {\n      e: undefined,\n      t: undefined,\n      a: undefined,\n      o: undefined,\n      i: undefined\n    });\n    return _el$;\n  })();\n};\n\nconst Toaster = () => {\n  const [visible, setVisible] = solidJs.createSignal(document.visibilityState === 'visible');\n  solidJs.onMount(() => {\n    helper.useStyle(css, store.ref);\n    const handleVisibilityChange = () => {\n      setVisible(document.visibilityState === 'visible');\n    };\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    solidJs.onCleanup(() => document.removeEventListener('visibilitychange', handleVisibilityChange));\n  });\n  return (() => {\n    var _el$ = web.template(`<div>`)();\n    web.use(ref => setState('ref', ref), _el$);\n    web.insert(_el$, web.createComponent(solidJs.For, {\n      get each() {\n        return store.list;\n      },\n      children: id => web.createComponent(ToastItem, web.mergeProps(() => store.map[id]))\n    }));\n    web.effect(_p$ => {\n      var _v$ = modules_c21c94f2.root,\n        _v$2 = visible() ? undefined : '';\n      _v$ !== _p$.e && web.className(_el$, _p$.e = _v$);\n      _v$2 !== _p$.t && web.setAttribute(_el$, \"data-paused\", _p$.t = _v$2);\n      return _p$;\n    }, {\n      e: undefined,\n      t: undefined\n    });\n    return _el$;\n  })();\n};\nlet dom;\nconst init = () => {\n  if (dom || store.ref) return;\n  dom = helper.mountComponents('toast', () => web.createComponent(Toaster, {}));\n  dom.style.setProperty('z-index', '2147483647', 'important');\n};\n\nconst toast = (msg, options) => {\n  if (!msg) return;\n  init();\n  const id = options?.id ?? (typeof msg === 'string' ? msg : creatId());\n  setState(state => {\n    if (Reflect.has(state.map, id)) {\n      Object.assign(state.map[id], {\n        msg,\n        ...options,\n        update: true\n      });\n      return;\n    }\n    state.map[id] = {\n      id,\n      type: 'info',\n      duration: 3000,\n      msg,\n      ...options\n    };\n    state.list.push(id);\n  });\n\n  /** å¼¹çª—åè®°å½•ä¸€ä¸‹ */\n  let fn = helper.log;\n  switch (options?.type) {\n    case 'warn':\n      fn = helper.log.warn;\n      break;\n    case 'error':\n      fn = helper.log.error;\n      break;\n  }\n  fn('Toast:', msg);\n  if (options?.throw && typeof msg === 'string') throw new Error(msg);\n};\ntoast.dismiss = dismiss;\ntoast.set = (id, options) => {\n  if (!Reflect.has(store.map, id)) return;\n  setState(state => Object.assign(state.map[id], options));\n};\ntoast.success = (msg, options) => toast(msg, {\n  ...options,\n  exit: undefined,\n  type: 'success'\n});\ntoast.warn = (msg, options) => toast(msg, {\n  ...options,\n  exit: undefined,\n  type: 'warn'\n});\ntoast.error = (msg, options) => toast(msg, {\n  ...options,\n  exit: undefined,\n  type: 'error'\n});\n\nexports.Toaster = Toaster;\nexports.toast = toast;\n";break;case"userscript/dmzjApi":c="\nconst solidJs = require('solid-js');\nconst store = require('solid-js/store');\nconst dmzjDecrypt = require('dmzjDecrypt');\nconst helper = require('helper');\nconst main = require('main');\n\n/** æ ¹æ®æ¼«ç”» id å’Œç« èŠ‚ id è·å–ç« èŠ‚æ•°æ® */\nconst getChapterInfo = async (comicId, chapterId) => {\n  const res = await main.request(`https://m.dmzj.com/chapinfo/${comicId}/${chapterId}.html`, {\n    responseType: 'json',\n    errorText: 'è·å–ç« èŠ‚æ•°æ®å¤±è´¥'\n  });\n  return res.response;\n};\n\n/** æ ¹æ®æ¼«ç”» id å’Œç« èŠ‚ id è·å–ç« èŠ‚è¯„è®º */\nconst getViewpoint = async (comicId, chapterId) => {\n  try {\n    const res = await main.request(`http://v3api.dmzj.com/viewPoint/0/${comicId}/${chapterId}.json`, {\n      responseType: 'json',\n      errorText: 'è·å–ç« èŠ‚è¯„è®ºå¤±è´¥'\n    });\n\n    // è¿˜æœ‰å¦ä¸€ä¸ª api\n    // https://manhua.dmzj.com/tpi/api/viewpoint/getViewpoint?type=0&type_id=${comicId}&chapter_id=${chapterId}&more=1\n\n    return res.response.map(({\n      content,\n      num\n    }) => `${content} [+${num}]`);\n  } catch {\n    return [];\n  }\n};\nconst getComicDetail_base = async comicId => {\n  const res = await main.request(`https://api.dmzj.com/dynamic/comicinfo/${comicId}.json`, {\n    responseType: 'json'\n  });\n  const {\n    info: {\n      last_updatetime,\n      title\n    },\n    list\n  } = res.response.data;\n  return {\n    title,\n    last_updatetime,\n    last_update_chapter_id: undefined,\n    chapters: [{\n      name: 'è¿è½½',\n      list: list.map(({\n        id,\n        chapter_name,\n        updatetime\n      }) => ({\n        id,\n        title: chapter_name,\n        updatetime\n      }))\n    }]\n  };\n};\nconst getComicDetail_v4Api = async comicId => {\n  const res = await main.request(`https://v4api.idmzj.com/comic/detail/${comicId}?uid=2665531&disable_level=1`);\n  const {\n    comicInfo: {\n      last_update_chapter_id,\n      last_updatetime,\n      chapters,\n      title\n    }\n  } = dmzjDecrypt(res.responseText);\n  for (const chapter of Object.values(chapters)) chapter.data.sort((a, b) => a.chapter_order - b.chapter_order);\n  return {\n    title,\n    last_updatetime,\n    last_update_chapter_id,\n    chapters: chapters.map(({\n      data,\n      title: name\n    }) => ({\n      name,\n      list: data.map(({\n        chapter_id,\n        chapter_title,\n        updatetime\n      }) => ({\n        id: chapter_id,\n        title: chapter_title,\n        updatetime\n      }))\n    }))\n  };\n};\nconst getComicDetail_traversal = async (comicId, draftData) => {\n  let nextId = draftData.last_update_chapter_id;\n  if (!nextId) {\n    helper.log.warn('last_update_chapter_id ä¸ºç©ºï¼Œæ— æ³•é€šè¿‡éå†è·å–ç« èŠ‚');\n    return;\n  }\n  draftData.chapters[0] = {\n    name: 'è¿è½½',\n    list: []\n  };\n  main.toast.warn('æ­£åœ¨é€šè¿‡éå†è·å–æ‰€æœ‰ç« èŠ‚ï¼Œè€—æ—¶å¯èƒ½è¾ƒé•¿', {\n    id: 'traversalTip',\n    duration: Number.POSITIVE_INFINITY\n  });\n  while (nextId) {\n    try {\n      const {\n        chapter_name,\n        updatetime,\n        prev_chap_id\n      } = await getChapterInfo(comicId, nextId);\n      draftData.chapters[0].list.push({\n        id: nextId,\n        title: chapter_name,\n        updatetime\n      });\n      nextId = prev_chap_id;\n    } catch {\n      nextId = undefined;\n    }\n  }\n  main.toast.dismiss('traversalTip');\n};\n\n/** è¿”å›å¯å˜ store ç±»å‹çš„æ¼«ç”»æ•°æ® */\nconst useComicDetail = comicId => {\n  const data = store.createMutable({});\n  const apiFn = [getComicDetail_v4Api, getComicDetail_base, getComicDetail_traversal];\n  solidJs.onMount(async () => {\n    for (const api of apiFn) {\n      try {\n        Object.assign(data, await api(comicId, data));\n        if (data.chapters?.some(chapter => chapter.list.length)) return;\n      } catch {}\n    }\n    main.toast.error('æ¼«ç”»æ•°æ®è·å–å¤±è´¥', {\n      duration: Number.POSITIVE_INFINITY\n    });\n  });\n  return data;\n};\n\n/** æ ¹æ®æ¼«ç”»æ‹¼éŸ³ç®€ç§°æ‰¾åˆ°å¯¹åº”çš„ id */\nconst getComicId = async py => {\n  const res = await main.request(`https://manhua.dmzj.com/api/v1/comic2/comic/detail?${new URLSearchParams({\n    channel: 'pc',\n    app_name: 'comic',\n    version: '1.0.0',\n    timestamp: `${Date.now()}`,\n    uid: '',\n    comic_py: py\n  }).toString()}`, {\n    responseType: 'json'\n  });\n  return res.response.data?.comicInfo?.id;\n};\n\nexports.getChapterInfo = getChapterInfo;\nexports.getComicId = getComicId;\nexports.getViewpoint = getViewpoint;\nexports.useComicDetail = useComicDetail;\n";break;case"userscript/copyApi":c="\nconst helper = require('helper');\nconst main = require('main');\nconst request = require('request');\n\nlet contentKey = '';\nlet key = '';\nconst getKeys = async url => {\n  if (contentKey && key) return [contentKey, key];\n\n  // çƒ­è¾£æ¼«ç”»æ”¾åœ¨ç½‘é¡µå…ƒç´ é‡Œ\n  if (helper.querySelector('.disData[contentkey]')) {\n    contentKey = helper.querySelector('.disData[contentkey]').getAttribute('contentkey');\n    key = helper.querySelector('.disPass[contentkey]').getAttribute('contentkey');\n    return [contentKey, key];\n  }\n\n  // æ‹·è´ PC ç«¯ç›´æ¥æ”¾åœ¨ç½‘é¡µå˜é‡é‡Œï¼Œä¸è¿‡å¦ä¸€ä¸ªå˜é‡çš„åå­—ä¼šå˜\n  if (unsafeWindow.contentKey && unsafeWindow.cct) {\n    contentKey = unsafeWindow.contentKey; // oxlint-disable-line prefer-destructuring\n    key = unsafeWindow.cct;\n    return [contentKey, key];\n  }\n\n  // å¦‚æœå¦ä¸€ä¸ªå˜é‡çš„åå­—å˜äº†ï¼Œæˆ–è€…æ˜¯åœ¨æ‹·è´çš„ç§»åŠ¨ç«¯ï¼Œå°±å¾—ä» PC ç«¯çš„ç½‘é¡µé‡Œè§£æè·å–äº†\n  if (url) {\n    const html = await request.request(url, {\n      fetch: false,\n      headers: {\n        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.79 Safari/537.36'\n      }\n    });\n    const [script] = html.responseText.match(/(?<=<script>\\s+)(var .+?contentKey =.+?)(?=<\\/script)/gs);\n    const res = {};\n    for (const [, key, value] of script.matchAll(/var (\\S+) = '(.+?)';\\n/g)) res[key] = value;\n    contentKey = res.contentKey; // oxlint-disable-line prefer-destructuring\n\n    const passKey = Object.keys(res).find(key => key !== 'contentKey');\n    if (!passKey) {\n      main.toast.error(helper.t('site.changed_load_failed'));\n      throw new Error(helper.t('site.changed_load_failed'));\n    }\n    key = res[passKey];\n    return [contentKey, key];\n  }\n  main.toast.error(helper.t('site.changed_load_failed'));\n  throw new Error(helper.t('site.changed_load_failed'));\n};\n\n// by: https://github.com/MapoMagpie/comic-looms/blob/7799f87fdd5a8ac73c878f338b7ae6aa5c0b2d18/src/platform/matchers/mangacopy.ts#L96-L125\nconst decryptData = async (raw, key) => {\n  key ||= (await getKeys())[1]; // oxlint-disable-line no-await-expression-member\n\n  const cipher = raw.slice(16);\n  const iv = raw.slice(0, 16);\n  const decryptedBuffer = await crypto.subtle.decrypt({\n    name: 'AES-CBC',\n    iv: new TextEncoder().encode(iv)\n  }, await crypto.subtle.importKey('raw', new TextEncoder().encode(key), {\n    name: 'AES-CBC'\n  }, false, ['decrypt']), new Uint8Array(cipher.match(/.{1,2}/g).map(byte => Number.parseInt(byte, 16))).buffer);\n  return JSON.parse(new TextDecoder().decode(decryptedBuffer));\n};\n\n/** é€šè¿‡è§£æç½‘é¡µå˜é‡è·å–å›¾ç‰‡åˆ—è¡¨ */\nconst getImglistByHtml = async url => {\n  const keys = await getKeys(url);\n  const res = await decryptData(...keys);\n  return res.map(({\n    url\n  }) => url.replace(/(?<=(\\/|\\.))c800x/, 'c1500x'));\n};\n\nexports.decryptData = decryptData;\nexports.getImglistByHtml = getImglistByHtml;\n";break;case"userscript/detectAd":c="\nconst Comlink = require('comlink');\nconst helper = require('helper');\nconst main = require('main');\nconst worker = require('worker/detectAd');\n\n/** ç”¨å¸¸è¯†é€»è¾‘è¿›è¡Œåˆ¤æ–­ï¼Œä»¥æœŸèƒ½åœ¨æ£€æµ‹å¤±è¯¯æ—¶å‡å°å½±å“èŒƒå›´å’Œé—æ¼ */\nconst getAdPage = async (list, isAdPage, adList) => {\n  let i = list.length - 1;\n  let normalNum = 0;\n  // åªæ£€æŸ¥æœ€ååå¼ \n  for (; i >= list.length - 10; i--) {\n    // å¼€å¤´è‚¯å®šä¸ä¼šæ˜¯å¹¿å‘Š\n    if (i <= 2) break;\n    if (adList.has(i)) continue;\n    const item = list[i];\n    if (!item) break;\n    if (await isAdPage(item)) adList.add(i);\n    // æ‰¾åˆ°è¿ç»­ä¸‰å¼ æ­£å¸¸æ¼«ç”»é¡µåä¸­æ–­\n    else if (normalNum >= 2) break;else normalNum += 1;\n  }\n  let adNum = 0;\n  for (i = Math.min(...adList); i < list.length; i++) {\n    if (adList.has(i)) {\n      adNum += 1;\n      continue;\n    }\n\n    // è¿ç»­ä¸¤å¼ å¹¿å‘Šåé¢çš„è‚¯å®šä¹Ÿéƒ½æ˜¯å¹¿å‘Š\n    if (adNum >= 2) adList.add(i);\n    // å¤¹åœ¨ä¸¤å¼ å¹¿å‘Šä¸­é—´çš„è‚¯å®šä¹Ÿæ˜¯å¹¿å‘Š\n    else if (adList.has(i - 1) && adList.has(i + 1)) adList.add(i);else adNum = 0;\n  }\n  return adList;\n};\nconst imgToCanvas = async img => {\n  if (typeof img !== 'string') {\n    await helper.waitImgLoad(img);\n    try {\n      const canvas = new OffscreenCanvas(img.width, img.height);\n      const ctx = canvas.getContext('2d');\n      ctx.drawImage(img, 0, 0);\n      // æ²¡è¢« CORS æ±¡æŸ“å°±ç›´æ¥ä½¿ç”¨\n      if (ctx.getImageData(0, 0, 1, 1)) {\n        const imgBitmap = canvas.transferToImageBitmap();\n        return Comlink.transfer(imgBitmap, [imgBitmap]);\n      }\n    } catch {}\n  }\n  const url = typeof img === 'string' ? img : img.src;\n  const res = await main.request(url, {\n    responseType: 'blob',\n    fetch: false\n  });\n  const imgBitmap = await createImageBitmap(res.response);\n  return Comlink.transfer(imgBitmap, [imgBitmap]);\n};\n\n/** é€šè¿‡æ–‡ä»¶ååˆ¤æ–­æ˜¯å¦æ˜¯å¹¿å‘Š */\nconst getAdPageByFileName = (fileNameList, adList) => getAdPage(fileNameList, fileName => /^z+/i.test(fileName), adList);\nconst isAdImg = imgBitmap => {\n  initWorker();\n  return worker.isAdImg(Comlink.transfer(imgBitmap, [imgBitmap]));\n};\n\n/** é€šè¿‡å›¾ç‰‡å†…å®¹åˆ¤æ–­æ˜¯å¦æ˜¯å¹¿å‘Š */\nconst getAdPageByContent = (imgList, adList) => getAdPage(imgList, async img => isAdImg(await imgToCanvas(img)), adList);\nconst initWorker = helper.onec(() => {\n  const mainFn = {\n    log: helper.log\n  };\n  worker.setMainFn(Comlink.proxy(mainFn), Object.keys(mainFn));\n});\n\nexports.getAdPageByContent = getAdPageByContent;\nexports.getAdPageByFileName = getAdPageByFileName;\nexports.isAdImg = isAdImg;\n";break;case"main":c="\nconst helper = require('helper');\nconst web = require('solid-js/web');\nconst Manga = require('components/Manga');\nconst Toast = require('components/Toast');\nconst solidJs = require('solid-js');\nconst Fab = require('components/Fab');\nconst IconButton = require('components/IconButton');\nconst request = require('request');\n\nconst MdSettings = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M19.5 12c0-.23-.01-.45-.03-.68l1.86-1.41c.4-.3.51-.86.26-1.3l-1.87-3.23a.987.987 0 0 0-1.25-.42l-2.15.91c-.37-.26-.76-.49-1.17-.68l-.29-2.31c-.06-.5-.49-.88-.99-.88h-3.73c-.51 0-.94.38-1 .88l-.29 2.31c-.41.19-.8.42-1.17.68l-2.15-.91c-.46-.2-1-.02-1.25.42L2.41 8.62c-.25.44-.14.99.26 1.3l1.86 1.41a7.3 7.3 0 0 0 0 1.35l-1.86 1.41c-.4.3-.51.86-.26 1.3l1.87 3.23c.25.44.79.62 1.25.42l2.15-.91c.37.26.76.49 1.17.68l.29 2.31c.06.5.49.88.99.88h3.73c.5 0 .93-.38.99-.88l.29-2.31c.41-.19.8-.42 1.17-.68l2.15.91c.46.2 1 .02 1.25-.42l1.87-3.23c.25-.44.14-.99-.26-1.3l-1.86-1.41c.03-.23.04-.45.04-.68m-7.46 3.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdCloudDownload = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M19.35 10.04A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 0 0 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M17 13l-4.65 4.65c-.2.2-.51.2-.71 0L7 13h3V9h4v4z\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdImageSearch = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M18 15v4c0 .55-.45 1-1 1H5c-.55 0-1-.45-1-1V7c0-.55.45-1 1-1h3.02c.55 0 1-.45 1-1s-.45-1-1-1H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-5c0-.55-.45-1-1-1s-1 .45-1 1m-2.5 3H6.52c-.42 0-.65-.48-.39-.81l1.74-2.23a.5.5 0 0 1 .78-.01l1.56 1.88 2.35-3.02c.2-.26.6-.26.79.01l2.55 3.39c.25.32.01.79-.4.79m3.8-9.11c.48-.77.75-1.67.69-2.66-.13-2.15-1.84-3.97-3.97-4.2A4.5 4.5 0 0 0 11 6.5c0 2.49 2.01 4.5 4.49 4.5.88 0 1.7-.26 2.39-.7l2.41 2.41c.39.39 1.03.39 1.42 0s.39-1.03 0-1.42zM15.5 9a2.5 2.5 0 0 1 0-5 2.5 2.5 0 0 1 0 5\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdImportContacts = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M17.5 4.5c-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5-1.45 0-2.99.22-4.28.79C1.49 5.62 1 6.33 1 7.14v11.28c0 1.3 1.22 2.26 2.48 1.94.98-.25 2.02-.36 3.02-.36 1.56 0 3.22.26 4.56.92.6.3 1.28.3 1.87 0 1.34-.67 3-.92 4.56-.92 1 0 2.04.11 3.02.36 1.26.33 2.48-.63 2.48-1.94V7.14c0-.81-.49-1.52-1.22-1.85-1.28-.57-2.82-.79-4.27-.79M21 17.23c0 .63-.58 1.09-1.2.98-.75-.14-1.53-.2-2.3-.2-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5.92 0 1.83.09 2.7.28.46.1.8.51.8.98z\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdMenuBook = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M17.5 4.5c-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5-1.45 0-2.99.22-4.28.79C1.49 5.62 1 6.33 1 7.14v11.28c0 1.3 1.22 2.26 2.48 1.94.98-.25 2.02-.36 3.02-.36 1.56 0 3.22.26 4.56.92.6.3 1.28.3 1.87 0 1.34-.67 3-.92 4.56-.92 1 0 2.04.11 3.02.36 1.26.33 2.48-.63 2.48-1.94V7.14c0-.81-.49-1.52-1.22-1.85-1.28-.57-2.82-.79-4.27-.79M21 17.23c0 .63-.58 1.09-1.2.98-.75-.14-1.53-.2-2.3-.2-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5.92 0 1.83.09 2.7.28.46.1.8.51.8.98z\"></path><path d=\"M13.98 11.01c-.32 0-.61-.2-.71-.52-.13-.39.09-.82.48-.94 1.54-.5 3.53-.66 5.36-.45.41.05.71.42.66.83s-.42.71-.83.66c-1.62-.19-3.39-.04-4.73.39-.08.01-.16.03-.23.03m0 2.66c-.32 0-.61-.2-.71-.52-.13-.39.09-.82.48-.94 1.53-.5 3.53-.66 5.36-.45.41.05.71.42.66.83s-.42.71-.83.66c-1.62-.19-3.39-.04-4.73.39a1 1 0 0 1-.23.03m0 2.66c-.32 0-.61-.2-.71-.52-.13-.39.09-.82.48-.94 1.53-.5 3.53-.66 5.36-.45.41.05.71.42.66.83s-.42.7-.83.66c-1.62-.19-3.39-.04-4.73.39a1 1 0 0 1-.23.03\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst useFab = mainContext => {\n  const {\n    store,\n    setState,\n    options,\n    setOptions\n  } = mainContext;\n  helper.useStyle(`\n    #fab {\n      --text-bg: transparent;\n\n      position: fixed;\n      right: calc(3vw - var(--left, 0px));\n      bottom: calc(6vh - var(--top, 0px));\n\n      font-size: clamp(12px, 1.5vw, 16px);\n    }\n  `);\n  helper.useStyleMemo('#fab', {\n    '--left': () => `${options.fabPosition.left}px`,\n    '--top': () => `${options.fabPosition.top}px`\n  });\n  const FabIcon = () => {\n    switch (store.fab.progress) {\n      case undefined:\n        return MdImportContacts;\n      // æ²¡æœ‰å†…å®¹çš„ä¹¦\n      case 1:\n      case 2:\n        return MdMenuBook;\n      // æœ‰å†…å®¹çš„ä¹¦\n      default:\n        return store.fab.progress > 1 ? MdCloudDownload : MdImageSearch;\n    }\n  };\n  const handleMount = ref => {\n    const handleDrag = ({\n      xy: [x, y],\n      last: [lx, ly]\n    }) => {\n      const left = options.fabPosition.left + x - lx;\n      const top = options.fabPosition.top + y - ly;\n      setOptions({\n        fabPosition: {\n          left,\n          top\n        }\n      });\n    };\n    helper.useDrag({\n      ref,\n      handleDrag,\n      setCapture: true\n    });\n\n    // è¶…å‡ºæ˜¾ç¤ºèŒƒå›´å°±æ¢å¤åŸä½\n    const observer = new IntersectionObserver(entries => {\n      if (entries.length !== 1 || entries[0].isIntersecting) return;\n      setOptions({\n        fabPosition: {\n          left: 0,\n          top: 0\n        }\n      });\n    }, {\n      threshold: 0.5\n    });\n    observer.observe(ref);\n  };\n  const dom = helper.mountComponents('fab', () => {\n    solidJs.createEffect(() => {\n      setState('fab', {\n        placement: -options.fabPosition.left < window.innerWidth / 2 ? 'left' : 'right',\n        speedDialPlacement: -options.fabPosition.top < window.innerHeight / 2 ? 'top' : 'bottom'\n      });\n    });\n    return web.createComponent(Fab.Fab, web.mergeProps({\n      ref: handleMount\n    }, () => store.fab, {\n      get children() {\n        return store.fab.children ?? web.createComponent(web.Dynamic, {\n          get component() {\n            return FabIcon();\n          }\n        });\n      }\n    }));\n  });\n  dom.style.setProperty('z-index', '2147483646', 'important');\n  useSpeedDial(mainContext);\n};\n\nconst MdAutoSync = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M12 4V2.21c0-.45-.54-.67-.85-.35l-2.8 2.79c-.2.2-.2.51 0 .71l2.79 2.79c.32.31.86.09.86-.36V6c3.31 0 6 2.69 6 6 0 .79-.15 1.56-.44 2.25-.15.36-.04.77.23 1.04.51.51 1.37.33 1.64-.34.37-.91.57-1.91.57-2.95 0-4.42-3.58-8-8-8m0 14c-3.31 0-6-2.69-6-6 0-.79.15-1.56.44-2.25.15-.36.04-.77-.23-1.04-.51-.51-1.37-.33-1.64.34C4.2 9.96 4 10.96 4 12c0 4.42 3.58 8 8 8v1.79c0 .45.54.67.85.35l2.79-2.79c.2-.2.2-.51 0-.71l-2.79-2.79a.5.5 0 0 0-.85.36z\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\n/** åˆ¤æ–­ç‰ˆæœ¬å·1æ˜¯å¦å°äºç‰ˆæœ¬å·2 */\nconst versionLt = (version1, version2) => {\n  const v1 = version1.split('.').map(Number);\n  const v2 = version2.split('.').map(Number);\n  for (let i = 0; i < 3; i++) {\n    const num1 = v1[i] ?? 0;\n    const num2 = v2[i] ?? 0;\n    if (num1 !== num2) return num1 < num2;\n  }\n  return false;\n};\nconst migrationOption = async (name, editFn) => {\n  try {\n    const option = await GM.getValue(name);\n    if (!option) throw new Error(`GM.getValue Error: not found ${name}`);\n    if (await editFn(option)) return;\n    GM.setValue(name, option);\n  } catch (error) {\n    helper.log.error(`migration ${name} option error:`, error);\n  }\n};\n\n/** é‡å‘½åé…ç½®é¡¹ */\nconst renameOption = (name, list) => migrationOption(name, option => {\n  for (const itemText of list) {\n    const [path, newName] = itemText.split(' => ');\n    helper.byPath(option, path, (parent, key) => {\n      helper.log('rename Option', itemText);\n      if (newName) Reflect.set(parent, newName, parent[key]);\n      Reflect.deleteProperty(parent, key);\n    });\n  }\n});\n\n/** æ—§ç‰ˆæœ¬é…ç½®è¿ç§» */\nconst migration = async version => {\n  // ä»»ä½•æ ·å¼ä¿®æ”¹éƒ½å¾—æ›´æ–° css æ‰è¡Œï¼Œå¹²è„†ç›´æ¥åˆ äº†\n  GM.deleteValue('ehTagColorizeCss');\n  GM.deleteValue('ehTagSortCss');\n  const values = await GM.listValues();\n\n  // 6 => 7\n  if (versionLt(version, '7')) for (const key of values) {\n    switch (key) {\n      case 'Version':\n      case 'Languages':\n        continue;\n      case 'HotKeys':\n        {\n          await renameOption(key, ['å‘ä¸Šç¿»é¡µ => turn_page_up', 'å‘ä¸‹ç¿»é¡µ => turn_page_down', 'å‘å³ç¿»é¡µ => turn_page_right', 'å‘å·¦ç¿»é¡µ => turn_page_left', 'è·³è‡³é¦–é¡µ => jump_to_home', 'è·³è‡³å°¾é¡µ => jump_to_end', 'é€€å‡º => exit', 'åˆ‡æ¢é¡µé¢å¡«å…… => switch_page_fill', 'åˆ‡æ¢å·è½´æ¨¡å¼ => switch_scroll_mode', 'åˆ‡æ¢å•åŒé¡µæ¨¡å¼ => switch_single_double_page_mode', 'åˆ‡æ¢é˜…è¯»æ–¹å‘ => switch_dir', 'è¿›å…¥é˜…è¯»æ¨¡å¼ => enter_read_mode']);\n          break;\n        }\n      default:\n        await renameOption(key, ['option.scrollbar.showProgress => showImgStatus', 'option.clickPage => clickPageTurn', 'option.clickPage.overturn => reverse', 'option.swapTurnPage => swapPageTurnKey', 'option.flipToNext => jumpToNext',\n        // ehentai\n        'åŒ¹é…nhentai => associate_nhentai', 'å¿«æ·é”®ç¿»é¡µ => hotkeys_page_turn',\n        // nhentai\n        'è‡ªåŠ¨ç¿»é¡µ => auto_page_turn', 'å½»åº•å±è”½æ¼«ç”» => block_totally', 'åœ¨æ–°é¡µé¢ä¸­æ‰“å¼€é“¾æ¥ => open_link_new_page',\n        // other\n        'è®°ä½å½“å‰ç«™ç‚¹ => remember_current_site']);\n    }\n  }\n\n  // 8 => 9\n  if (versionLt(version, '9')) for (const key of values) {\n    switch (key) {\n      case 'Version':\n      case 'Languages':\n        continue;\n      case 'Hotkeys':\n        {\n          await renameOption(key, [\n          // åŸæœ¬ä¸Šä¸‹å¿«æ·é”®æ˜¯æ··åœ¨ä¸€èµ·çš„ï¼Œç°åœ¨åˆ†å¼€åè¦è¿ç§»å¤ªéº»çƒ¦äº†ï¼Œåº”è¯¥ä¹Ÿæ²¡å¤šå°‘äººæ”¹ï¼Œå°±ç›´æ¥åˆ äº†\n          'turn_page_up => ', 'turn_page_down => ', 'turn_page_right => scroll_right', 'turn_page_left => scroll_left']);\n          break;\n        }\n      default:\n        await migrationOption(key, option => {\n          if (typeof option.option?.scrollMode !== 'boolean') return true;\n          option.option.scrollMode = {\n            enabled: option.option.scrollMode,\n            spacing: option.option.scrollModeSpacing,\n            imgScale: option.option.scrollModeImgScale,\n            fitToWidth: option.option.scrollModeFitToWidth\n          };\n        });\n    }\n  }\n\n  // 9.3 => 9.4\n  if (versionLt(version, '9.4')) await migrationOption('ehentai', option => {\n    if (!Reflect.has(option, 'hotkeys_page_turn')) return true;\n    option.hotkeys = option.hotkeys_page_turn;\n    Reflect.deleteProperty(option, 'hotkeys_page_turn');\n  });\n\n  // 11.4.2 => 11.5\n  if (versionLt(version, '11.5')) await migrationOption('Hotkeys', option => {\n    for (const [name, hotkeys] of Object.entries(option)) {\n      option[name] = hotkeys.map(key => key.replaceAll(/\\b[A-Z]\\b/g, match => match.toLowerCase()));\n    }\n  });\n  if (versionLt(version, '11.9.1')) for (const key of values) {\n    switch (key) {\n      case 'Version':\n      case 'Languages':\n      case 'Hotkeys':\n        continue;\n      default:\n        await renameOption(key, ['option.translation => ']);\n    }\n  }\n\n  // 11.11 => 11.12\n  if (versionLt(version, '11.12')) for (const key of values) {\n    switch (key) {\n      case 'Version':\n      case 'Languages':\n      case 'Hotkeys':\n        continue;\n      default:\n        await renameOption(key, ['associate_nhentai => cross_site_link']);\n    }\n  }\n  if (versionLt(version, '12')) for (const key of values) {\n    switch (key) {\n      case 'Version':\n      case 'Languages':\n      case 'Hotkeys':\n        {\n          await GM.setValue(`@${key}`, await GM.getValue(key));\n          await GM.deleteValue(key);\n          continue;\n        }\n      default:\n        await renameOption(key, ['hotkeys => add_hotkeys_actions']);\n    }\n  }\n};\n\nlet dom;\n\n/**\n * æ˜¾ç¤ºæ¼«ç”»é˜…è¯»çª—å£\n */\nconst useManga = ({\n  store,\n  setState,\n  options,\n  setOptions\n}) => {\n  helper.useStyle(`\n    #comicRead {\n      position: fixed;\n      top: 0;\n      left: 0;\n      transform: scale(0);\n\n      contain: strict;\n\n      width: 100%;\n      height: 100%;\n\n      writing-mode: initial;\n      font-size: 16px;\n\n      opacity: 0;\n\n      transition:\n        opacity 300ms,\n        transform 0s 300ms;\n    }\n\n    #comicRead[show] {\n      transform: scale(1);\n      opacity: 1;\n      transition: opacity 300ms, transform 100ms;\n    }\n\n    /* é˜²æ­¢å…¶ä»–æ‰©å±•çš„å…ƒç´ æ˜¾ç¤ºåˆ°æ¼«ç”»ä¸Šæ¥ */\n    #comicRead[show] ~ :not(#fab, #toast, .comicread-ignore) {\n      display: none !important;\n      pointer-events: none !important;\n      visibility: hidden !important;\n      opacity: 0 !important;\n      z-index: 1 !important;\n    }\n  `);\n  setState('manga', {\n    show: false,\n    option: options.option,\n    defaultOption: options.defaultOption,\n    onOptionChange: option => setOptions({\n      option\n    }),\n    hotkeys: store.hotkeys,\n    onHotkeysChange(newValue) {\n      GM.setValue('@Hotkeys', newValue);\n      setState('hotkeys', newValue);\n    }\n  });\n  dom = helper.mountComponents('comicRead', () => web.createComponent(Manga.Manga, web.mergeProps(() => store.manga)));\n  dom.style.setProperty('z-index', '2147483647', 'important');\n\n  // ç¡®ä¿ toast å¯ä»¥æ˜¾ç¤ºåœ¨æ¼«ç”»ä¹‹ä¸Š\n  const toastDom = helper.querySelector('#toast');\n  if (toastDom) dom.after(toastDom);\n  const htmlStyle = document.documentElement.style;\n  let lastOverflow = htmlStyle.overflow;\n  const wakeLock = new helper.WakeLock();\n  helper.createEffectOn(helper.createRootMemo(() => store.manga.show && store.manga.imgList.length > 0), show => {\n    if (show) {\n      dom.setAttribute('show', '');\n      lastOverflow = htmlStyle.overflow;\n      htmlStyle.setProperty('overflow', 'hidden', 'important');\n      htmlStyle.setProperty('scrollbar-width', 'none', 'important');\n      if (Manga.store.option.autoFullscreen) Manga.refs.root.requestFullscreen();\n      wakeLock.on();\n    } else {\n      dom.removeAttribute('show');\n      htmlStyle.overflow = lastOverflow;\n      htmlStyle.removeProperty('scrollbar-width');\n      wakeLock.off();\n    }\n  }, {\n    defer: true\n  });\n  setState('manga', {\n    onExit: () => setState('manga', 'show', false),\n    editSettingList(list) {\n      const SyncOptions = () => {\n        const sync = async () => {\n          const currentReadOption = helper.difference(Manga.store.option, Manga.store.defaultOption);\n          for (const key of await GM.listValues()) {\n            if (key.startsWith('@')) continue;\n            await migrationOption(key, option => {\n              option.option = currentReadOption;\n            });\n          }\n          Toast.toast.success(helper.t('setting.sync_options_other_site'));\n        };\n        return web.createComponent(Manga.SettingsItemButton, {\n          get name() {\n            return helper.t('setting.sync_options_other_site');\n          },\n          onClick: sync,\n          get children() {\n            return web.createComponent(MdAutoSync, {});\n          }\n        });\n      };\n\n      // åœ¨å…¶ä»–è®¾ç½®é‡Œå¢åŠ åŒæ­¥é…ç½®çš„æŒ‰é’®\n      const otherSetting = list.find(([title]) => title === helper.t('other.other'));\n      if (otherSetting) {\n        const [, FC] = otherSetting;\n        otherSetting[1] = () => [web.createComponent(FC, {}), web.createComponent(SyncOptions, {})];\n      }\n      return list;\n    }\n  });\n};\n\n\n/** å¤„ç†ç‰ˆæœ¬æ›´æ–°ç›¸å…³ */\nconst handleVersionUpdate = async () => {\n  const version = await GM.getValue('@Version');\n  if (!version) return GM.setValue('@Version', GM.info.script.version);\n  if (version === GM.info.script.version) return;\n  await migration(version); // æ¯æ¬¡ç‰ˆæœ¬æ›´æ–°éƒ½æ‰§è¡Œä¸€éè¿ç§»\n\n  // åªåœ¨è¯­è¨€ä¸ºä¸­æ–‡æ—¶å¼¹çª—æç¤ºæœ€æ–°æ›´æ–°å†…å®¹\n  if (helper.lang() === 'zh') {\n    Toast.toast(() => /* eslint-disable i18next/no-literal-string */[(() => {\n      var _el$ = web.template(`<h2>ğŸ¥³ ComicRead å·²æ›´æ–°åˆ° v`)();\n      web.insert(_el$, () => GM.info.script.version, null);\n      return _el$;\n    })(), web.template(`<h3>æ–°å¢`)(), web.template(`<ul><li>æ”¯æŒ IMHentai`)(), web.template(`<h3>ä¿®å¤`)(), web.template(`<ul><li><p>ä¿®å¤ komiic ä¸Š/ä¸‹è¯åˆ‡æ¢å¤±æ•ˆçš„ bug </p></li><li><p>ä¿®å¤å¼€å¯äº†å›¾åƒæ— æŸæ”¾å¤§ååªèƒ½ä¸‹è½½åˆ°åŸå›¾çš„ bug`)(), web.createComponent(solidJs.Show, {\n      get when() {\n        return versionLt(version, '12');\n      },\n      get children() {\n        return [web.template(`<h3>æ–°å¢`)(), web.template(`<ul><li>å®ç°å›¾ç‰‡æ”¾å¤§åŠŸèƒ½ï¼ˆéœ€è¦æ‰“å¼€ã€Œå›¾åƒè¯†åˆ«ã€åŠŸèƒ½ï¼‰</li><li>å¢åŠ  ehentai åœ¨ç¼©ç•¥å›¾åˆ—è¡¨é¡µé‡Œå±•å¼€æ ‡ç­¾åˆ—è¡¨åŠŸèƒ½`)()];\n      }\n    })] /* eslint-enable i18next/no-literal-string */, {\n      id: 'Version Tip',\n      type: 'custom',\n      duration: Number.POSITIVE_INFINITY,\n      // æ‰‹åŠ¨ç‚¹å‡»å…³æ‰é€šçŸ¥åæ‰ä¸ä¼šå†æ¬¡å¼¹å‡º\n      onDismiss: () => GM.setValue('@Version', GM.info.script.version)\n    });\n\n    // ç›‘å¬å‚¨å­˜çš„ç‰ˆæœ¬æ•°æ®çš„å˜åŠ¨ï¼Œå¦‚æœå’Œå½“å‰ç‰ˆæœ¬ä¸€è‡´å°±å…³æ‰å¼¹çª—\n    // é˜²æ­¢åœ¨æ›´æ–°ç‰ˆæœ¬åä¸€æ¬¡æ€§æ‰“å¼€å¤šä¸ªé¡µé¢ï¼Œä¸å¾—ä¸ä¸€ä¸ªä¸€ä¸ªå…³è¿‡å»\n    const listenerId = await GM.addValueChangeListener('@Version', async (_, __, newVersion) => {\n      if (newVersion !== GM.info.script.version) return;\n      Toast.toast.dismiss('Version Tip');\n      await GM.removeValueChangeListener(listenerId);\n    });\n  } else await GM.setValue('@Version', GM.info.script.version);\n};\n\n/** å¯¹åŸºç¡€çš„åˆå§‹åŒ–æ“ä½œçš„å°è£… */\nconst useInit = async (name, initSiteOptions = {}) => {\n  await helper.setInitLang();\n  await handleVersionUpdate();\n  const defaultOptions = {\n    option: undefined,\n    defaultOption: undefined,\n    autoShow: true,\n    lockOption: false,\n    hiddenFAB: false,\n    fabPosition: {\n      top: 0,\n      left: 0\n    },\n    ...initSiteOptions\n  };\n  const saveOptions = await GM.getValue(name);\n  // æ£€æŸ¥æ¸…ç†ä¸‹å·²ä¿å­˜é…ç½®çš„å¤šä½™é¡¹\n  if (saveOptions) {\n    for (const key of Object.keys(saveOptions)) {\n      if (Reflect.has(defaultOptions, key)) continue;\n      Reflect.deleteProperty(saveOptions, key);\n    }\n  } else await GM.setValue(name, {});\n  const {\n    store,\n    setState\n  } = helper.useStore({\n    fab: {\n      tip: helper.t('other.read_mode'),\n      show: false\n    },\n    manga: {\n      imgList: []\n    },\n    hotkeys: await GM.getValue('@Hotkeys', {}),\n    name,\n    options: {\n      ...structuredClone(defaultOptions),\n      ...saveOptions\n    },\n    comicMap: {\n      '': {\n        getImgList: function init() {\n          return [];\n        }\n      }\n    },\n    nowComic: '',\n    flag: {\n      isStored: saveOptions !== undefined,\n      needAutoShow: true\n    }\n  });\n  Manga.setDefaultHotkeys(_hotkeys => ({\n    ..._hotkeys,\n    enter_read_mode: ['v']\n  }));\n  const {\n    options\n  } = store;\n  const setOptions = function (newOptions) {\n    if (newOptions) setState(state => Object.assign(state.options, newOptions));\n    if (options.lockOption && newOptions?.lockOption !== false) return;\n    // åªä¿å­˜å’Œé»˜è®¤è®¾ç½®ä¸åŒçš„éƒ¨åˆ†\n    return GM.setValue(store.name, helper.difference(options, defaultOptions));\n  };\n  const loadComic = async (id = store.nowComic) => {\n    if (!Reflect.has(store.comicMap, id)) throw new Error('comic not found');\n    try {\n      setState('comicMap', id, 'imgList', []);\n      const newImgList = await store.comicMap[id].getImgList(main);\n      if (newImgList.length === 0) throw new Error(helper.t('alert.fetch_comic_img_failed'));\n      setState('comicMap', id, 'imgList', newImgList);\n    } catch (error) {\n      setState('comicMap', id, 'imgList', undefined);\n      helper.log.error(error);\n      throw error;\n    }\n  };\n  const showComic = async (id = store.nowComic) => {\n    if (!Reflect.has(store.comicMap, id)) throw new Error('comic not found');\n    if (id !== store.nowComic) setState('nowComic', id);\n    switch (store.comicMap[id].imgList?.length) {\n      case 0:\n        return Toast.toast.warn(helper.t('alert.repeat_load'), {\n          duration: 1500\n        });\n      case undefined:\n        {\n          try {\n            await loadComic(id);\n            setState('flag', 'needAutoShow', false);\n          } catch (error) {\n            return Toast.toast.error(error.message);\n          }\n        }\n    }\n    setState('manga', 'show', true);\n  };\n  let inited = false;\n  const init = () => {\n    if (inited) return;\n    inited = true;\n    setState('fab', {\n      onClick: showComic,\n      show: !options.hiddenFAB && undefined\n    });\n    if (store.flag.needAutoShow && options.autoShow) showComic();\n    (async () => {\n      await GM.registerMenuCommand(helper.t('other.enter_comic_read_mode'), () => store.fab.onClick?.());\n      await updateHideFabMenu();\n    })();\n    Manga.listenHotkey({\n      enter_read_mode: () => store.fab.onClick?.()\n    }, true);\n  };\n\n  // é¦–æ¬¡è®¾ç½®é»˜è®¤æ¼«ç”»çš„åŠ è½½å‡½æ•°æ—¶ï¼Œè¿›è¡Œåˆå§‹åŒ–\n  helper.createEffectOn(() => store.comicMap[''].getImgList, (_, prev) => !prev && init(), {\n    defer: true\n  });\n  const main = {\n    store,\n    setState,\n    options,\n    setOptions,\n    loadComic,\n    showComic,\n    init,\n    dynamicLoad: async (loadImgFn, length, id = '') => {\n      if (store.comicMap[id].imgList?.length) return store.comicMap[id].imgList;\n      const imgNum = typeof length === 'number' ? length : length();\n      setState('comicMap', id, 'imgList', helper.range(imgNum, ''));\n      // oxlint-disable-next-line no-async-promise-executor\n      await new Promise(async resolve => {\n        try {\n          await loadImgFn((i, img) => {\n            setState('comicMap', id, 'imgList', list => list.with(i, img));\n            resolve();\n          });\n        } catch (error) {\n          Toast.toast.error(error.message);\n        }\n      });\n      return store.comicMap[id].imgList;\n    },\n    dynamicLazyLoad: async ({\n      loadImg,\n      length,\n      id = '',\n      concurrency = 4,\n      onEnd\n    }) => {\n      if (store.comicMap[id].imgList?.length) return store.comicMap[id].imgList;\n      const imgNum = typeof length === 'number' ? length : length();\n      let loadNum = 0;\n\n      // oxlint-disable-next-line no-async-promise-executor\n      await new Promise(resolve => {\n        const queue = new helper.PQueue(async i => {\n          const img = await loadImg(i);\n          setState('comicMap', id, 'imgList', list => list.with(i, img));\n          resolve();\n          loadNum += 1;\n          if (loadNum === imgNum) onEnd?.();\n        }, concurrency);\n        setState(state => {\n          state.comicMap[id].imgList = helper.range(imgNum, '');\n          state.manga.onWaitUrlImgs = imgs => queue.set(...imgs);\n        });\n      });\n      return store.comicMap[id].imgList;\n    }\n  };\n  useFab(main);\n  useManga(main);\n  const nowImgList = helper.createRootMemo(() => {\n    const comic = store.comicMap[store.nowComic];\n    if (!comic?.imgList) return undefined;\n    if (!comic.adList?.size) return comic.imgList;\n    return comic.imgList.filter((_, i) => !comic.adList?.has(i));\n  });\n  helper.createEffectOn(nowImgList, list => list && setState('manga', 'imgList', list));\n\n  /** å½“å‰å·²å–å¾— url çš„å›¾ç‰‡æ•°é‡ */\n  const doneImgNum = helper.createRootMemo(() => nowImgList()?.filter(Boolean)?.length);\n\n  /** å·²åŠ è½½å®Œæ¯•çš„å›¾ç‰‡æ•°é‡ */\n  const loadedImgNum = helper.createRootMemo(() => {\n    let i = 0;\n    for (const img of Manga.imgList()) if (img.loadType === 'loaded') i += 1;\n    return i;\n  });\n\n  // è®¾ç½® Fab çš„æ˜¾ç¤ºè¿›åº¦\n  helper.createEffectOn([doneImgNum, loadedImgNum, () => nowImgList()?.length], ([doneNum, loadNum, totalNum]) => {\n    if (totalNum === undefined || doneNum === undefined) return setState('fab', 'progress', undefined);\n    if (totalNum === 0) return setState('fab', {\n      progress: 0,\n      tip: `${helper.t('other.loading_img')} - ${doneNum}/${totalNum}`\n    });\n\n    // åŠ è½½å›¾ç‰‡ url é˜¶æ®µçš„è¿›åº¦\n    if (doneNum < totalNum) return setState('fab', {\n      progress: doneNum / totalNum,\n      tip: `${helper.t('other.loading_img')} - ${doneNum}/${totalNum}`\n    });\n\n    // å›¾ç‰‡åŠ è½½é˜¶æ®µçš„è¿›åº¦\n    if (loadNum < totalNum) return setState('fab', {\n      progress: 1 + loadNum / totalNum,\n      tip: `${helper.t('other.img_loading')} - ${loadNum}/${totalNum}`\n    });\n    return setState('fab', {\n      progress: 1 + loadNum / totalNum,\n      tip: helper.t('other.read_mode'),\n      show: !options.hiddenFAB && undefined\n    });\n  });\n  let menuId;\n  /** æ›´æ–°æ˜¾ç¤º/éšè—æ‚¬æµ®æŒ‰é’®çš„èœå•é¡¹ */\n  const updateHideFabMenu = async () => {\n    await GM.unregisterMenuCommand(menuId);\n    menuId = await GM.registerMenuCommand(options.hiddenFAB ? helper.t('other.fab_show') : helper.t('other.fab_hidden'), async () => {\n      await setOptions({\n        hiddenFAB: !options.hiddenFAB\n      });\n      setState('fab', 'show', !options.hiddenFAB && undefined);\n      await updateHideFabMenu();\n    });\n  };\n  await GM.registerMenuCommand(helper.t('site.show_settings_menu'), () => setState('fab', {\n    show: true,\n    focus: true,\n    tip: helper.t('other.setting'),\n    children: web.createComponent(MdSettings, {}),\n    onBackdropClick: () => setState('fab', {\n      show: false,\n      focus: false\n    })\n  }));\n  return main;\n};\n\n/** å¯¹ç®€å•ç«™ç‚¹çš„é€šç”¨è§£ */\nconst universal = async ({\n  name,\n  wait: waitFn,\n  getImgList,\n  onPrev,\n  onNext,\n  onExit,\n  onShowImgsChange,\n  getCommentList,\n  initOptions,\n  SPA\n}) => {\n  if (SPA?.isMangaPage) await helper.waitUrlChange(SPA.isMangaPage);\n  if (waitFn) await helper.wait(waitFn);\n  const mainContext = await useInit(name, initOptions);\n  const {\n    store,\n    setState,\n    showComic\n  } = mainContext;\n  setState('comicMap', '', {\n    getImgList: () => getImgList(mainContext)\n  });\n  setState('manga', {\n    onShowImgsChange\n  });\n  if (onExit) setState('manga', {\n    onExit: isEnd => {\n      onExit?.(isEnd);\n      setState('manga', 'show', false);\n    }\n  });\n  if (!SPA) {\n    if (onNext ?? onPrev) setState('manga', {\n      onNext,\n      onPrev\n    });\n    if (getCommentList) setState('manga', 'commentList', await getCommentList());\n    return;\n  }\n  helper.onUrlChange(async () => {\n    if (SPA.isMangaPage && !(await SPA.isMangaPage())) return setState(state => {\n      state.fab.show = false;\n      state.manga.show = false;\n      state.comicMap[''].imgList = undefined;\n    });\n    if (waitFn) await helper.wait(waitFn);\n    setState(state => {\n      state.fab.show = undefined;\n      state.manga.onPrev = undefined;\n      state.manga.onNext = undefined;\n      state.flag.needAutoShow = state.options.autoShow;\n      state.comicMap[''].imgList = undefined;\n    });\n    if (store.options.autoShow) await showComic('');\n    await Promise.all([(async () => getCommentList && setState('manga', 'commentList', await getCommentList()))(), (async () => SPA.getOnPrev && setState('manga', {\n      onPrev: await helper.wait(SPA.getOnPrev, 5000)\n    }))(), (async () => SPA.getOnNext && setState('manga', {\n      onNext: await helper.wait(SPA.getOnNext, 5000)\n    }))()]);\n  }, SPA?.handleUrl);\n};\n\nconst MdAutoFixHigh = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"m20.45 6 .49-1.06L22 4.45a.5.5 0 0 0 0-.91l-1.06-.49L20.45 2a.5.5 0 0 0-.91 0l-.49 1.06-1.05.49a.5.5 0 0 0 0 .91l1.06.49.49 1.05c.17.39.73.39.9 0M8.95 6l.49-1.06 1.06-.49a.5.5 0 0 0 0-.91l-1.06-.48L8.95 2a.492.492 0 0 0-.9 0l-.49 1.06-1.06.49a.5.5 0 0 0 0 .91l1.06.49L8.05 6c.17.39.73.39.9 0m10.6 7.5-.49 1.06-1.06.49a.5.5 0 0 0 0 .91l1.06.49.49 1.06a.5.5 0 0 0 .91 0l.49-1.06 1.05-.5a.5.5 0 0 0 0-.91l-1.06-.49-.49-1.06c-.17-.38-.73-.38-.9.01m-1.84-4.38-2.83-2.83a.996.996 0 0 0-1.41 0L2.29 17.46a.996.996 0 0 0 0 1.41l2.83 2.83c.39.39 1.02.39 1.41 0L17.7 10.53c.4-.38.4-1.02.01-1.41m-3.5 2.09L12.8 9.8l1.38-1.38 1.41 1.41z\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdAutoFixOff = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"m22 3.55-1.06-.49L20.45 2a.5.5 0 0 0-.91 0l-.49 1.06-1.05.49a.5.5 0 0 0 0 .91l1.06.49.49 1.05a.5.5 0 0 0 .91 0l.49-1.06L22 4.45c.39-.17.39-.73 0-.9m-7.83 4.87 1.41 1.41-1.46 1.46 1.41 1.41 2.17-2.17a.996.996 0 0 0 0-1.41l-2.83-2.83a.996.996 0 0 0-1.41 0l-2.17 2.17 1.41 1.41zM2.1 4.93l6.36 6.36-6.17 6.17a.996.996 0 0 0 0 1.41l2.83 2.83c.39.39 1.02.39 1.41 0l6.17-6.17 6.36 6.36a.996.996 0 1 0 1.41-1.41L3.51 3.51a.996.996 0 0 0-1.41 0c-.39.4-.39 1.03 0 1.42\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdFlashOff = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M16.12 11.5a.995.995 0 0 0-.86-1.5h-1.87l2.28 2.28zm.16-8.05c.33-.67-.15-1.45-.9-1.45H8c-.55 0-1 .45-1 1v.61l6.13 6.13zm2.16 14.43L4.12 3.56a.996.996 0 1 0-1.41 1.41L7 9.27V12c0 .55.45 1 1 1h2v7.15c0 .51.67.69.93.25l2.65-4.55 3.44 3.44c.39.39 1.02.39 1.41 0 .4-.39.4-1.02.01-1.41\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdFlashOn = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M7 3v9c0 .55.45 1 1 1h2v7.15c0 .51.67.69.93.25l5.19-8.9a.995.995 0 0 0-.86-1.5H13l2.49-6.65A.994.994 0 0 0 14.56 2H8c-.55 0-1 .45-1 1\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdLockOpen = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M12 13c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6-5h-1V6c0-2.76-2.24-5-5-5-2.28 0-4.27 1.54-4.84 3.75-.14.54.18 1.08.72 1.22a1 1 0 0 0 1.22-.72A2.996 2.996 0 0 1 12 3c1.65 0 3 1.35 3 3v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m0 11c0 .55-.45 1-1 1H7c-.55 0-1-.45-1-1v-8c0-.55.45-1 1-1h10c.55 0 1 .45 1 1z\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst MdLock = (props = {}) => (() => {\n  var _el$ = web.template(`<svg xmlns=http://www.w3.org/2000/svg viewBox=\"0 0 24 24\"stroke=currentColor fill=currentColor stroke-width=0><path d=\"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2M9 8V6c0-1.66 1.34-3 3-3s3 1.34 3 3v2z\">`)();\n  web.spread(_el$, props, true, true);\n  return _el$;\n})();\n\nconst useSpeedDial = ({\n  store,\n  setState,\n  options,\n  setOptions\n}) => {\n  const DefaultButton = props => web.createComponent(IconButton.IconButton, {\n    get placement() {\n      return store.fab.placement;\n    },\n    showTip: true,\n    get tip() {\n      return props.showName ?? (helper.t(`site.add_feature.${props.optionName}`) || helper.t(`other.${props.optionName}`) || props.optionName);\n    },\n    onClick: () => setOptions({\n      [props.optionName]: !options[props.optionName]\n    }),\n    get children() {\n      return props.children ?? (options[props.optionName] ? web.createComponent(MdAutoFixHigh, {}) : web.createComponent(MdAutoFixOff, {}));\n    }\n  });\n  helper.createEffectOn(() => store.fab.otherSpeedDial, () => {\n    const list = [() => web.createComponent(DefaultButton, {\n      optionName: \"autoShow\",\n      get showName() {\n        return helper.t('site.add_feature.auto_show');\n      },\n      get children() {\n        return web.memo(() => !!options.autoShow)() ? web.createComponent(MdFlashOn, {}) : web.createComponent(MdFlashOff, {});\n      }\n    }), () => web.createComponent(DefaultButton, {\n      optionName: \"lockOption\",\n      get showName() {\n        return helper.t('site.add_feature.lock_option');\n      },\n      get children() {\n        return web.memo(() => !!options.lockOption)() ? web.createComponent(MdLock, {}) : web.createComponent(MdLockOpen, {});\n      }\n    })];\n    if (store.fab.otherSpeedDial) {\n      for (const optionName of store.fab.otherSpeedDial) list.push(() => web.createComponent(DefaultButton, {\n        optionName: optionName\n      }));\n    } else {\n      for (const optionName of Object.keys(options)) {\n        switch (optionName) {\n          case 'hiddenFAB':\n          case 'option':\n          case 'autoShow':\n          case 'lockOption':\n            continue;\n          default:\n            if (typeof options[optionName] === 'boolean') list.push(() => web.createComponent(DefaultButton, {\n              optionName: optionName\n            }));\n        }\n      }\n    }\n    setState('fab', 'speedDial', list);\n  });\n};\n\nconst triggerOptions = !web.isServer && solidJs.DEV ? { equals: false, name: \"trigger\" } : { equals: false };\nconst triggerCacheOptions = !web.isServer && solidJs.DEV ? { equals: false, internal: true } : triggerOptions;\nclass TriggerCache {\n    #map;\n    constructor(mapConstructor = Map) {\n        this.#map = new mapConstructor();\n    }\n    dirty(key) {\n        if (web.isServer)\n            return;\n        this.#map.get(key)?.$$();\n    }\n    dirtyAll() {\n        if (web.isServer)\n            return;\n        for (const trigger of this.#map.values())\n            trigger.$$();\n    }\n    track(key) {\n        if (!solidJs.getListener())\n            return;\n        let trigger = this.#map.get(key);\n        if (!trigger) {\n            const [$, $$] = solidJs.createSignal(undefined, triggerCacheOptions);\n            this.#map.set(key, (trigger = { $, $$, n: 1 }));\n        }\n        else\n            trigger.n++;\n        solidJs.onCleanup(() => {\n            // remove the trigger when no one is listening to it\n            if (--trigger.n === 0)\n                // microtask is to avoid removing the trigger used by a single listener\n                queueMicrotask(() => trigger.n === 0 && this.#map.delete(key));\n        });\n        trigger.$();\n    }\n}\n\nconst $KEYS = Symbol(\"track-keys\");\n/**\n * A reactive version of a Javascript built-in `Set` class.\n * @see https://github.com/solidjs-community/solid-primitives/tree/main/packages/set#ReactiveSet\n * @example\n * const set = new ReactiveSet([1,2,3]);\n * [...set] // reactive on any change\n * set.has(2) // reactive on change to the result\n * // apply changes\n * set.add(4)\n * set.delete(2)\n * set.clear()\n */\nclass ReactiveSet extends Set {\n    #triggers = new TriggerCache();\n    constructor(values) {\n        super();\n        if (values)\n            for (const value of values)\n                super.add(value);\n    }\n    [Symbol.iterator]() {\n        return this.values();\n    }\n    get size() {\n        this.#triggers.track($KEYS);\n        return super.size;\n    }\n    has(value) {\n        this.#triggers.track(value);\n        return super.has(value);\n    }\n    keys() {\n        return this.values();\n    }\n    *values() {\n        this.#triggers.track($KEYS);\n        for (const value of super.values()) {\n            yield value;\n        }\n    }\n    *entries() {\n        this.#triggers.track($KEYS);\n        for (const entry of super.entries()) {\n            yield entry;\n        }\n    }\n    forEach(callbackfn, thisArg) {\n        this.#triggers.track($KEYS);\n        super.forEach(callbackfn, thisArg);\n    }\n    add(value) {\n        if (!super.has(value)) {\n            super.add(value);\n            solidJs.batch(() => {\n                this.#triggers.dirty(value);\n                this.#triggers.dirty($KEYS);\n            });\n        }\n        return this;\n    }\n    delete(value) {\n        const result = super.delete(value);\n        if (result) {\n            solidJs.batch(() => {\n                this.#triggers.dirty(value);\n                this.#triggers.dirty($KEYS);\n            });\n        }\n        return result;\n    }\n    clear() {\n        if (!super.size)\n            return;\n        solidJs.batch(() => {\n            this.#triggers.dirty($KEYS);\n            for (const member of super.values()) {\n                this.#triggers.dirty(member);\n            }\n            super.clear();\n        });\n    }\n}\n\nexports.toast = Toast.toast;\nexports.request = request.request;\nexports.ReactiveSet = ReactiveSet;\nexports.handleVersionUpdate = handleVersionUpdate;\nexports.universal = universal;\nexports.useInit = useInit;\nexports.useSpeedDial = useSpeedDial;\n";break;case"worker/detectAd":c="\nconst jsQR = require('jsqr');\n\nconst mainFn = {};\nconst setMainFn = (helper, keys) => {\n  for (const name of keys) Reflect.set(mainFn, name, (...args) => Reflect.apply(helper[name], helper, args));\n};\n\n/** è®¡ç®— rgb çš„ç°åº¦ */\nconst toGray = (r, g, b) => Math.round(0.299 * r + 0.587 * g + 0.114 * b);\n\n// jsQR æœ€ä¸ºç®€æ´ï¼Œä½†ä¸æ”¯æŒåŒ…å«å¤šä¸ªäºŒç»´ç çš„å›¾ç‰‡\n// https://github.com/cozmo/jsQR/issues/24\n//\n// ZXing å¯ä»¥æ‰«æåŒ…å«å¤šä¸ªäºŒç»´ç çš„å›¾ç‰‡ï¼Œä½†å› ä¸ºåŒæ—¶æ”¯æŒå¤šç§ç¼–ç ï¼Œ\n// åŒ…å«äº†å¾ˆå¤šæ ¹æœ¬ä¸éœ€è¦çš„ä»£ç ï¼Œç”¨åœ¨è¿™é‡Œæ„Ÿè§‰å¤ªç‰›åˆ€æ€é¸¡äº†\n//\n// qr-scanner åŸºäºä¸Šè¿°ä¸¤ä¸ªåº“è¿›è¡Œå¼€å‘ï¼Œæ˜¯æœ€ä¼˜é€‰ã€‚ä½†ä¼šæ”¶åˆ° CSP é™åˆ¶è€Œæ— æ³•ä½¿ç”¨\n/** åˆ¤æ–­ä¸€å¼ å›¾æ˜¯å¦æ˜¯å½©å›¾ */\nconst isColorImg = data => {\n  for (let i = 0; i < data.length; i += 16) {\n    const r = data[i];\n    const g = data[i + 1];\n    const b = data[i + 2];\n    if (!(r === g && r === b)) return true;\n  }\n  return false;\n};\n\n/** äºŒç»´ç ç™½åå• */\nconst qrCodeWhiteList = [\n// fanbox\n/^https:\\/\\/[^.]+\\.fanbox\\.cc/,\n// twitter\n/^https:\\/\\/twitter\\.com/, /^https:\\/\\/x\\.com/,\n// fantia\n/^https:\\/\\/fantia\\.jp/,\n// æ£‰èŠ±ç³–\n/^https:\\/\\/marshmallow-qa\\.com/,\n// dlsite\n/^https:\\/\\/www\\.dlsite\\.com/,\n// hitomi\n/^https:\\/\\/hitomi\\.la/];\nconst options = {\n  inversionAttempts: 'attemptBoth'\n};\n\n/** è¯†åˆ«å›¾åƒä¸Šçš„äºŒç»´ç  */\nconst getQrCode = (img, width, height) => {\n  try {\n    const binaryData = jsQR(img, width, height, options)?.binaryData;\n    if (!binaryData) return false;\n    // å› ä¸º jsqr é»˜è®¤çš„è¾“å‡ºä¸æ”¯æŒç‰¹æ®Šç¬¦å·ï¼Œä¸ºä»¥é˜²ä¸‡ä¸€ï¼Œæ‰‹åŠ¨è¿›è¡Œè½¬æ¢\n    const text = new TextDecoder().decode(Uint8Array.from(binaryData));\n    mainFn.log(`æ£€æµ‹åˆ°äºŒç»´ç ï¼š ${text}`);\n    return text;\n  } catch (error) {\n    mainFn.log(error);\n    return undefined;\n  }\n};\n\n// zxing æ–¹æ¡ˆ\n//\n// import {\n//   MultiFormatReader,\n//   BarcodeFormat,\n//   DecodeHintType,\n//   RGBLuminanceSource,\n//   BinaryBitmap,\n//   HybridBinarizer,\n// } from '@zxing/library';\n//\n// const hints = new Map();\n// // åªè¯†åˆ«äºŒç»´ç \n// hints.set(DecodeHintType.POSSIBLE_FORMATS, [\n//   BarcodeFormat.QR_CODE,\n//   BarcodeFormat.DATA_MATRIX,\n// ]);\n// // èŠ±æ›´å¤šæ—¶é—´å°è¯•å¯»æ‰¾æ¡å½¢ç \n// hints.set(DecodeHintType.TRY_HARDER, true);\n//\n// /** è¯†åˆ«å›¾åƒä¸Šçš„äºŒç»´ç  */\n// const getQrCode = (\n//   data: Uint8ClampedArray,\n//   width: number,\n//   height: number,\n// ) => {\n//   try {\n//     const luminance = new Uint8ClampedArray(width * height);\n//     for (let i = 0; i < data.length; i += 4) {\n//       const r = data[i];\n//       const g = data[i + 1];\n//       const b = data[i + 2];\n//       luminance[i / 4] = (r + g + b) / 3;\n//     }\n//     const luminanceSource = new RGBLuminanceSource(luminance, width, height);\n//     const binaryBitmap = new BinaryBitmap(new HybridBinarizer(luminanceSource));\n//     const res = new MultiFormatReader().decode(binaryBitmap, hints);\n//     const text = res.getText();\n//     if (!text) return false;\n//     mainFn.log(`æ£€æµ‹åˆ°äºŒç»´ç ï¼š ${text}`);\n//     return text;\n//   } catch (error) {\n//     console.log(error);\n//     debugger;\n//     return false;\n//   }\nconst getImgData = img => {\n  const canvas = new OffscreenCanvas(img.width, img.height);\n  const ctx = canvas.getContext('2d');\n  ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n  return ctx.getImageData(0, 0, canvas.width, canvas.height);\n};\nconst scanImgBlock = (img, sx, sy, w, h) => {\n  if (w === img.width && h === img.height) return getQrCode(img.data, w, h);\n  const data = new Uint8ClampedArray(new ArrayBuffer(w * h * 4));\n  for (let y = 0, height = sy + h; y < height; y++) for (let x = 0, width = sx + w; x < width; x++) {\n    const i = (y * w + x) * 4;\n    const target = ((y + sy) * img.width + (x + sx)) * 4;\n    data[i] = img.data[target];\n    data[i + 1] = img.data[target + 1];\n    data[i + 2] = img.data[target + 2];\n    data[i + 3] = img.data[target + 3];\n  }\n  return getQrCode(data, w, h);\n};\nconst isAdImg = imgBitmap => {\n  const imgData = getImgData(imgBitmap);\n\n  // é»‘ç™½å›¾è‚¯å®šä¸æ˜¯å¹¿å‘Š\n  if (!isColorImg(imgData.data)) return false;\n\n  // ä»¥ 200 ç°åº¦ä¸ºé˜ˆå€¼ï¼Œå°†å›¾ç‰‡äºŒå€¼åŒ–ï¼Œä»¥ä¾¿è¯†åˆ«å½©è‰²äºŒç»´ç \n  for (let i = 0; i < imgData.data.length; i += 4) {\n    const gray = toGray(imgData.data[i], imgData.data[i + 1], imgData.data[i + 2]);\n    const val = gray < 200 ? 0 : 255;\n    imgData.data[i] = val;\n    imgData.data[i + 1] = val;\n    imgData.data[i + 2] = val;\n    imgData.data[i + 3] = 255;\n  }\n\n  // mainFn.showCanvas?.(imgData.data, imgBitmap.width, imgBitmap.height);\n\n  let text = getQrCode(imgData.data, imgData.width, imgData.height);\n\n  // åˆ†åŒºå—æ‰«æå›¾ç‰‡\n  if (!text) {\n    const w = Math.floor(imgData.width / 2);\n    const h = Math.floor(imgData.height / 2);\n    for (const args of [[w, h],\n    // â†˜\n    [0, h],\n    // â†™\n    [w, 0],\n    // â†—\n    [0, 0] // â†–\n    ]) {\n      text = scanImgBlock(imgData, ...args, w, h);\n      if (text) break;\n    }\n  }\n  if (text) return qrCodeWhiteList.every(reg => !reg.test(text));\n  return false;\n};\n\nexports.isAdImg = isAdImg;\nexports.setMainFn = setMainFn;\n";break;case"worker/ImageRecognition":c="\nconst mainFn = {};\nconst setMainFn = (helper, keys) => {\n  for (const name of keys) Reflect.set(mainFn, name, (...args) => Reflect.apply(helper[name], helper, args));\n};\nconst getEdgeScope = (width, height) => Math.min(Math.ceil((width + height) * 0.01), 10);\n\n/** å¯¹æŒ‡å®šæ•°å€¼å–æ•´ */\nconst round = (n, int) => {\n  const remainder = n % int;\n  return remainder < int / 2 ? n - remainder : n + (int - remainder);\n};\n\n/** è®¡ç®— rgb çš„ç°åº¦ */\nconst toGray = (r, g, b) => Math.round(0.299 * r + 0.587 * g + 0.114 * b);\n\n/** è·å–å›¾ç‰‡çš„ç°åº¦è¡¨ */\nconst toGrayList = (imgData, roundNum) => {\n  const grayList = new Uint8ClampedArray(new ArrayBuffer(imgData.length / 4));\n  for (let i = 0, gi = 0; i < imgData.length; i += 4, gi++) {\n    const r = imgData[i];\n    const g = imgData[i + 1];\n    const b = imgData[i + 2];\n    grayList[gi] = round(toGray(r, g, b), roundNum);\n  }\n  return grayList;\n};\n\n/** éå†å›¾ç‰‡çš„æŒ‡å®šè¡Œ */\nconst forEachRows = (width, y, fn, start = 0, end = width) => {\n  for (let i = start; i < end; i++) fn(width * y + i);\n};\n\n/** éå†å›¾ç‰‡çš„æŒ‡å®šåˆ— */\nconst forEachCols = (width, height, x, fn, start = 0, end = height) => {\n  for (let i = start; i < end; i++) fn(i * width + x);\n};\n\n/** éå†å›¾ç‰‡çš„è¾¹ç¼˜ */\nconst forEachEdge = (width, height, scope, fn) => {\n  for (let i = 0; i < scope; i++) {\n    forEachRows(width, i, fn);\n    forEachRows(width, height - i - 1, fn);\n    forEachCols(width, height, i, fn, scope, height - scope);\n    forEachCols(width, height, width - i - 1, fn, scope, height - scope);\n  }\n};\n\n/** ç¼©å°å›¾åƒ */\nconst resizeImg = (rawImgData, width, height) => {\n  // const scale = 1;\n  const scale = Math.min(200 / width, 200 / height);\n  const w = Math.floor(width * scale);\n  const h = Math.floor(height * scale);\n  const data = new Uint8ClampedArray(new ArrayBuffer(w * h * 4));\n  for (let y = 0; y < h; y++) {\n    for (let x = 0; x < w; x++) {\n      // ä½¿ç”¨æœ€ç®€å•çš„é‡‡æ ·æ–¹å¼ï¼Œé¿å…å‡ºç°åŸå›¾æ‰€æ²¡æœ‰çš„é¢œè‰²\n      const i = (y * w + x) * 4;\n      const tx = Math.floor(x / scale);\n      const ty = Math.floor(y / scale);\n      const target = (width * ty + tx) * 4;\n      data[i] = rawImgData[target];\n      data[i + 1] = rawImgData[target + 1];\n      data[i + 2] = rawImgData[target + 2];\n      data[i + 3] = 255;\n    }\n  }\n  return {\n    scale,\n    w,\n    h,\n    data\n  };\n};\n\n/** é€šè¿‡äº’ç›¸æ¯”è¾ƒæ•°ç»„é¡¹æ±‚å‡ºæœ€ç»ˆé¡¹ */\nconst boil = (array, compareFunc) => {\n  if (!array || (array.length ?? 0) === 0) return null;\n  return array.reduce(compareFunc);\n};\n\n/** è·å–é¢œè‰²åŒºåŸŸåœ¨è¾¹ç¼˜åŒºåŸŸä¸Šçš„å æ¯” */\nconst getAreaEdgeRatio = (pixelList, width, height) => {\n  let size = 0;\n  const edgeScope = getEdgeScope(width, height);\n  const add = i => pixelList.has(i) && size++;\n  forEachEdge(width, height, edgeScope, add);\n  return size / (width * edgeScope * 2 + (height - 2 * edgeScope) * edgeScope * 2);\n};\n\n/** æ ¹æ®ç°åº¦å€¼è·å–å›¾ç‰‡è¾¹ç¼˜ç›¸ä¼¼é¢œè‰²çš„åŒºåŸŸ */\nconst getEdgeArea = (grayList, width, height) => {\n  const maximum = width * height * 0.4;\n  const areaMap = new Map();\n\n  /** å¾…æ£€æŸ¥ç›¸é‚»åƒç´ çš„åƒç´  */\n  const seedPixel = new Set();\n  const addSeedPixel = index => {\n    const gray = grayList[index];\n    if (gray === undefined) return;\n    seedPixel.add(index);\n    if (!areaMap.has(gray)) areaMap.set(gray, new Set());\n    areaMap.get(gray).add(index);\n  };\n  const popSeedPixel = () => {\n    if (seedPixel.size === 0) return undefined;\n    const index = seedPixel.values().next().value;\n    seedPixel.delete(index);\n    return index;\n  };\n\n  // å°†è¾¹ç¼˜åŒºåŸŸçš„åƒç´ è®¾ä¸ºç§å­\n  const edgeScope = getEdgeScope(width, height);\n  forEachEdge(width, height, edgeScope, addSeedPixel);\n\n  /** è·å–ç›¸é‚»åƒç´  */\n  const getAdjacentPixel = i => {\n    const adjacentPixel = [];\n    const x = i % width;\n    const y = Math.floor(i / width);\n    const left = x !== 0;\n    const up = y >= 1;\n    const right = x < width - 1;\n    const down = y < height - 1;\n    if (left) adjacentPixel.push(i - 1); // â†\n    if (up) adjacentPixel.push(i - width); // â†‘\n    if (right) adjacentPixel.push(i + 1); // â†’\n    if (down) adjacentPixel.push(i + width); // â†“\n    if (left && up) adjacentPixel.push(i - width - 1); // â†–\n    if (left && down) adjacentPixel.push(i + width - 1); // â†™\n    if (right && up) adjacentPixel.push(i - width + 1); // â†—\n    if (right && down) adjacentPixel.push(i + width + 1); // â†˜\n\n    return adjacentPixel;\n  };\n\n  // ä»ç§å­åƒç´ å¼€å§‹ä¸æ–­åˆå¹¶ç›¸åŒç°åº¦çš„åƒç´ å½¢æˆåŒºåŸŸ\n  for (let i = popSeedPixel(); i !== undefined; i = popSeedPixel()) {\n    const gray = grayList[i];\n    const areaPixelList = areaMap.get(gray);\n    const adjacentPixelList = getAdjacentPixel(i);\n    for (const adjacentPixel of adjacentPixelList) {\n      if (areaPixelList.has(adjacentPixel)) continue;\n      const pixelGray = grayList[adjacentPixel];\n      if (pixelGray !== gray) continue;\n      addSeedPixel(adjacentPixel);\n    }\n\n    // å¦‚æœå½“å‰åŒºåŸŸåƒç´ æ•°é‡è¶…è¿‡é˜ˆå€¼ï¼Œå°±ç›´æ¥è®¤å®šå…¶ä¸ºèƒŒæ™¯\n    if (areaPixelList.size > maximum) return [areaPixelList];\n  }\n  const areaList = [];\n  for (const pixelList of areaMap.values()) {\n    if (pixelList.size < 100) continue;\n    areaList.push(pixelList);\n  }\n  return areaList;\n};\n\n/** è·å–å›¾åƒæŒ‡å®šåŒºåŸŸä¸­çš„ä¸»è‰² */\nconst getAreaColor = (imgData, pixelList) => {\n  const colorMap = new Map();\n  const maximum = pixelList.size * 0.5;\n  let maxColor = '';\n  let maxCount = 0;\n  for (const i of pixelList.values()) {\n    const index = i * 4;\n    const r = imgData[index];\n    const g = imgData[index + 1];\n    const b = imgData[index + 2];\n    const color = `rgb(${r}, ${g}, ${b})`;\n    if (!colorMap.has(color)) colorMap.set(color, 0);\n    const colorCount = colorMap.get(color) + 1;\n    colorMap.set(color, colorCount);\n    if (colorCount > maxCount) {\n      maxColor = color;\n      maxCount = colorCount;\n    }\n    if (colorCount > maximum) break;\n  }\n  return maxColor;\n};\n\n/** è·å–å›¾åƒæŒ‡å®šçŸ©å½¢åŒºåŸŸä¸­çš„ä¸»è‰² */\nconst getSquareAreaColor = (imgData, _topLeftX, _topLeftY, _bottomRightX, _bottomRightY) => {\n  const topLeftX = Math.floor(_topLeftX);\n  const topLeftY = Math.floor(_topLeftY);\n  const bottomRightX = Math.floor(_bottomRightX);\n  const bottomRightY = Math.floor(_bottomRightY);\n  const colorMap = new Map();\n  const maximum = (bottomRightX - topLeftX) * (bottomRightY - topLeftY) * 0.5;\n  let maxColor = '';\n  let maxCount = 0;\n  for (let x = topLeftX; x < bottomRightX; x++) {\n    for (let y = topLeftY; y < bottomRightY; y++) {\n      const index = (x + y * bottomRightX) * 4;\n      const r = imgData[index];\n      const g = imgData[index + 1];\n      const b = imgData[index + 2];\n      const color = `rgb(${r}, ${g}, ${b})`;\n      if (!colorMap.has(color)) colorMap.set(color, 0);\n      const colorCount = colorMap.get(color) + 1;\n      colorMap.set(color, colorCount);\n      if (colorCount > maxCount) {\n        maxColor = color;\n        maxCount = colorCount;\n      }\n      if (colorCount > maximum) break;\n    }\n  }\n  return maxColor;\n};\n\n/** æ ¹æ®è¾¹ç¼˜é¢œè‰²åŒºåŸŸè·å–èƒŒæ™¯é¢œè‰² */\nconst byEdgeArea = ({\n  data,\n  grayList,\n  width,\n  height\n}) => {\n  const areaList = getEdgeArea(grayList, width, height);\n  // if (false) mainFn.showColorArea?.(data, width, height, ...areaList);\n\n  if (areaList.length === 0) return undefined;\n  const minimum = width * height * 0.02;\n  let maxArea;\n  let maxRatio = 0.1;\n\n  // è¿‡æ»¤æ€»ä½“å æ¯”å’Œè¾¹ç¼˜å æ¯”è¿‡å°çš„åŒºåŸŸ\n  for (const pixelList of areaList) {\n    if (pixelList.size < minimum) continue;\n    const edgeRatio = getAreaEdgeRatio(pixelList, width, height);\n    if (edgeRatio < maxRatio) continue;\n    maxArea = pixelList;\n    maxRatio = edgeRatio;\n  }\n  if (!maxArea) return undefined;\n  return getAreaColor(data, maxArea);\n};\nconst getPosAreaColor = (pos, {\n  data,\n  blankMargin,\n  width: w,\n  height: h\n}) => {\n  switch (pos) {\n    case 'top':\n      return getSquareAreaColor(data, 0, 0, w, blankMargin.top * h);\n    case 'bottom':\n      return getSquareAreaColor(data, 0, h - blankMargin.bottom * h, w, h);\n    case 'left':\n      return getSquareAreaColor(data, 0, 0, blankMargin.left * w, h);\n    case 'right':\n      return getSquareAreaColor(data, w - blankMargin.right * w, 0, w, h);\n  }\n};\n\n/** ä»è¶³å¤Ÿå¤§çš„ç©ºç™½è¾¹ç¼˜ä¸­è·å–èƒŒæ™¯é¢œè‰² */\nconst byBlankMargin = context => {\n  const colorMap = {};\n  for (const pos of ['top', 'bottom', 'left', 'right']) {\n    if (!context.blankMargin[pos]) continue;\n    const color = getPosAreaColor(pos, context);\n    if (!color) continue;\n    colorMap[color] = (colorMap[color] || 0) + context.blankMargin[pos];\n  }\n\n  // è¿‡æ»¤å æ¯”è¿‡ä½çš„ç©ºç™½è¾¹ç¼˜\n  const colorList = Object.entries(colorMap).filter(([, v]) => v > 0.04);\n  if (colorList.length === 0) return undefined;\n  return boil(colorList, (a, b) => a[1] > b[1] ? a : b)?.[0];\n};\n\n/** åˆ¤æ–­å›¾åƒçš„èƒŒæ™¯è‰² */\nconst getBackground = context => 'blankMargin' in context && byBlankMargin(context) || byEdgeArea(context);\n\n/** è·å–å›¾ç‰‡ç©ºç™½è¾¹ç¼˜çš„é•¿åº¦ */\nconst getBlankMargin = ({\n  grayList,\n  width,\n  height\n}) => {\n  let blankColor;\n\n  // æ£€æŸ¥æŒ‡å®šè¡Œæˆ–åˆ—ä¸Šæ˜¯å¦å…¨æ˜¯ç›¸åŒé¢œè‰²\n  const isBlankLine = (x, y) => {\n    const colorMap = new Map();\n    const eachFn = i => {\n      const gray = grayList[i];\n      colorMap.set(gray, (colorMap.get(gray) || 0) + 1);\n      // grayList[i] = Math.abs(gray - 255);\n    };\n    if (x < 0) forEachRows(width, y, eachFn);else forEachCols(width, height, x, eachFn);\n    let maxColor;\n    // ä¸ºäº†èƒ½è·³è¿‡äº›å¾®è‰²å·®å’Œæ¼«ç”»æ°´å°ï¼Œé˜ˆå€¼å°±åªè®¾ä¸º 90%\n    let maxNum = height * 0.9;\n    for (const [gray, num] of colorMap.entries()) {\n      if (num < maxNum) continue;\n      maxColor = gray;\n      maxNum = num;\n    }\n    if (maxColor === undefined) return false;\n    blankColor ||= maxColor;\n    if (maxColor !== blankColor) return false;\n    return true;\n  };\n  let left = 0;\n  for (let x = 0, end = width * 0.4; x < end; x++, left++) if (!isBlankLine(x, -1)) break;\n  blankColor = undefined;\n  let right = 0;\n  for (let x = width - 1, end = width * 0.6; x >= end; x--, right++) if (!isBlankLine(x, -1)) break;\n  blankColor = undefined;\n  let top = 0;\n  for (let y = 0, end = height * 0.4; y < end; y++, top++) if (!isBlankLine(-1, y)) break;\n  blankColor = undefined;\n  let bottom = 0;\n  for (let y = height - 1, end = height * 0.6; y >= end; y--, bottom++) if (!isBlankLine(-1, y)) break;\n\n  // if (false) mainFn.showGrayList?.(grayList, width, height);\n\n  if (left || right || top || bottom) return {\n    left,\n    right,\n    top,\n    bottom\n  };\n  return undefined;\n};\n\nconst recognitionImg = async (imgData, width, height, url, option) => {\n  const startTime = Date.now();\n  const {\n    w,\n    h,\n    data\n  } = resizeImg(imgData, width, height);\n  // if (false) mainFn.showCanvas?.(data, w, h);\n\n  const grayList = toGrayList(data, 5);\n  // if (false) mainFn.showGrayList?.(grayList, w, h);\n\n  const context = {\n    data,\n    grayList,\n    width: w,\n    height: h\n  };\n  let blankMargin;\n  if (option.pageFill || option.background) {\n    blankMargin = getBlankMargin(context);\n    if (blankMargin) {\n      for (const key of ['top', 'bottom', 'left', 'right']) blankMargin[key] &&= blankMargin[key] / w;\n      mainFn.setImg(url, 'blankMargin', {\n        left: blankMargin.left,\n        right: blankMargin.right\n      });\n      mainFn.updatePageData();\n      context.blankMargin = blankMargin;\n    } else mainFn.setImg(url, 'blankMargin', null);\n  }\n  let bgColor;\n  if (option.background) {\n    // è™½ç„¶ä¹Ÿæƒ³æ”¯æŒæ¸å˜èƒŒæ™¯ï¼Œä½†æµè§ˆå™¨ä¸Šä¸åƒæ‰‹æœºç«¯é‚£æ ·åªéœ€è¦æ˜¾ç¤ºä¸Šä¸‹èƒŒæ™¯ï¼Œå¯ä»¥æ— è§†ä¸­é—´çš„æ¸å˜\n    // å¤§éƒ¨åˆ†æ—¶å€™éƒ½è¦æ˜¾ç¤ºå·¦å³åŒºåŸŸçš„èƒŒæ™¯ï¼Œä¸èƒ½å’Œå®é™…èƒŒæ™¯ä¸€è‡´çš„è¯å°±ä¼šå¾ˆçªå…€\n    // è¦æ˜¯å›¾ç‰‡èƒ½ä¸€ç›´å æ»¡å±å¹•çš„è¯ï¼Œé‚£è¿˜èƒ½é€šè¿‡å•ç‹¬æ˜¾ç¤ºä¸Šä¸‹æˆ–å·¦å³éƒ¨åˆ†çš„èƒŒæ™¯è‰²æ¥å®ç°\n    // ä½†åååˆæœ‰ã€Œç¦æ­¢å›¾ç‰‡è‡ªåŠ¨æ”¾å¤§ã€åŠŸèƒ½ï¼Œéœ€è¦æŠŠå›¾ç‰‡çš„å››è¾¹èƒŒæ™¯éƒ½æ˜¾ç¤ºå‡ºæ¥\n    bgColor = getBackground(context);\n    if (bgColor) mainFn.setImg(url, 'background', bgColor);\n  }\n  let logText = `${url}\\nè€—æ—¶ ${Date.now() - startTime}ms å¤„ç†å®Œæˆ`;\n  const resList = [];\n  if (blankMargin) resList.push(`ç©ºç™½è¾¹ç¼˜ï¼š${Object.entries(blankMargin).filter(([, v]) => v).map(([k, v]) => `${k}:${v && (v * 100).toFixed(2)}%`).join(' ')}`);\n  if (bgColor) resList.push(`èƒŒæ™¯è‰²: ${bgColor}`);\n  if (resList.length > 0) logText += `\\n${resList.join('\\n')}`;\n  mainFn.log?.(logText);\n};\n\nexports.recognitionImg = recognitionImg;\nexports.setMainFn = setMainFn;\n";break;case"worker/ImageUpscale":c="\nconst tf = require('@tensorflow/tfjs');\nconst tfjsBackendWebgpu = require('@tensorflow/tfjs-backend-webgpu');\nconst helper = require('helper');\n\nclass Img {\n  constructor(width, height, data = new Uint8Array(width * height * 4)) {\n    this.width = width;\n    this.height = height;\n    this.data = data;\n  }\n  getImageCrop(x, y, image, x1, y1, x2, y2) {\n    const width = x2 - x1;\n    for (let j = 0; j < y2 - y1; j++) {\n      const srcIndex = (y1 + j) * image.width * 4 + x1 * 4;\n      this.data.set(image.data.subarray(srcIndex, srcIndex + width * 4), (y + j) * this.width * 4 + x * 4);\n    }\n  }\n  padToTileSize(tileSize) {\n    let newWidth = this.width;\n    let newHeight = this.height;\n    if (this.width < tileSize) newWidth = tileSize;\n    if (this.height < tileSize) newHeight = tileSize;\n    if (newWidth === this.width && newHeight === this.height) return;\n    const newData = new Uint8Array(newWidth * newHeight * 4);\n    for (let y = 0; y < this.height; y++) {\n      const srcStart = y * this.width * 4;\n      newData.set(this.data.subarray(srcStart, srcStart + this.width * 4), y * newWidth * 4);\n    }\n    if (newWidth > this.width) {\n      const rightColumnIndex = (this.width - 1) * 4;\n      for (let y = 0; y < this.height; y++) {\n        const destRowStart = y * newWidth * 4;\n        const srcPixelIndex = y * this.width * 4 + rightColumnIndex;\n        const padPixel = this.data.subarray(srcPixelIndex, srcPixelIndex + 4);\n        for (let x = this.width; x < newWidth; x++) newData.set(padPixel, destRowStart + x * 4);\n      }\n    }\n    if (newHeight > this.height) {\n      const bottomRowStart = (this.height - 1) * newWidth * 4;\n      const bottomRow = newData.subarray(bottomRowStart, bottomRowStart + newWidth * 4);\n      for (let y = this.height; y < newHeight; y++) newData.set(bottomRow, y * newWidth * 4);\n    }\n    this.width = newWidth;\n    this.height = newHeight;\n    this.data = newData;\n  }\n  cropToOriginalSize(width, height) {\n    const newData = new Uint8Array(width * height * 4);\n    for (let y = 0; y < height; y++) {\n      const srcStart = y * this.width * 4;\n      newData.set(this.data.subarray(srcStart, srcStart + width * 4), y * width * 4);\n    }\n    this.width = width;\n    this.height = height;\n    this.data = newData;\n  }\n}\n\nconst mainFn = {};\nconst setMainFn = (helper, keys) => {\n  for (const name of keys) Reflect.set(mainFn, name, (...args) => Reflect.apply(helper[name], helper, args));\n};\nconst base64ToArrayBuffer = base64 => {\n  const binaryString = atob(base64);\n  const len = binaryString.length;\n  const bytes = new Uint8Array(len);\n  for (let i = 0; i < len; i++) bytes[i] = binaryString.codePointAt(i);\n  return bytes.buffer;\n};\n\n// å¼•ç”¨ä¸€ä¸‹ï¼Œé¿å…è¢« rullup treeshake æ‰\nconsole.debug(tfjsBackendWebgpu.webgpu_util); // oxlint-disable-line no-console\n\nlet model;\nlet loading = false;\nconst getModel = async () => {\n  if (model) return model;\n  if (loading) return helper.wait(() => model);\n  loading = true;\n  try {\n    await tf.setBackend('webgpu');\n  } catch (error) {\n    mainFn.toast.warn(mainFn.t('upscale.webgpu_tip'));\n    mainFn.log.error('åˆ‡æ¢ WebGPU å‡ºé”™', error);\n  }\n  const {\n    buffer,\n    base64,\n    json\n  } = await mainFn.getModel();\n  // ä¿®æ”¹ tfjs é‡Œçš„ fetch æ¥åŠ è½½æ¨¡å‹\n  Reflect.set(tf.env().platform, 'fetch', () => ({\n    ok: true,\n    json: () => JSON.parse(json),\n    arrayBuffer: () => buffer || base64ToArrayBuffer(base64)\n  }));\n  model = await tf.loadGraphModel('xxx');\n  return model;\n};\n\nconst upscaleImg = async image => {\n  const model = await getModel();\n  const result = tf.tidy(() => model.predict(img2tensor(image)));\n  const resultImage = await tensor2img(result);\n  tf.dispose(result);\n  return resultImage;\n};\nconst img2tensor = image => {\n  const imgdata = new ImageData(image.width, image.height);\n  imgdata.data.set(image.data);\n  return tf.browser.fromPixels(imgdata).div(255).toFloat().expandDims();\n};\nconst tensor2img = async tensor => {\n  const [, height, width] = tensor.shape;\n  const clipped = tf.tidy(() => tensor.reshape([height, width, 3]).mul(255).cast('int32').clipByValue(0, 255));\n  tensor.dispose();\n  const data = await tf.browser.toPixels(clipped);\n  clipped.dispose();\n  return new Img(width, height, data);\n};\n\n// ä¸ºäº†çœäº‹ï¼Œå°±ä¸æ”¯æŒè°ƒæ•´å‚æ•°äº†\n// ä¸ä¼šæ”¯æŒé€æ˜å›¾ç‰‡ï¼Œå¤„ç†èµ·æ¥å¤ªéº»çƒ¦äº†\n// ä»£ç å‡æŠ„è‡ª\n// https://github.com/xororz/web-realesrgan/blob/f81d2dd7935ee8df947674933fd41a446b90e911/src/worker.js\n// åªåˆ å»äº†å› å‚æ•°å›ºå®šè€Œå˜å¾—å†—ä½™çš„ä»£ç \n//\n// æ¨¡å‹æ–‡ä»¶åœ¨ Releases ä¸‹è½½\n//\n// https://cappuccino.moe/realcugan/2x-conservative-128/model.json\nconst factor = 2;\nconst input_size = 128;\nconst min_lap = 12;\nconst upscale = async (data, width, height) => {\n  const input = new Img(width, height, new Uint8Array(data));\n  input.padToTileSize(input_size);\n  const output = new Img(width * factor, height * factor);\n  let num_x = 1;\n  for (; (input_size * num_x - width) / (num_x - 1) < min_lap; num_x++);\n  let num_y = 1;\n  for (; (input_size * num_y - height) / (num_y - 1) < min_lap; num_y++);\n  const locs_x = Array.from({\n    length: num_x\n  });\n  const locs_y = Array.from({\n    length: num_y\n  });\n  const pad_left = Array.from({\n    length: num_x\n  });\n  const pad_top = Array.from({\n    length: num_y\n  });\n  const pad_right = Array.from({\n    length: num_x\n  });\n  const pad_bottom = Array.from({\n    length: num_y\n  });\n  const total_lap_x = input_size * num_x - width;\n  const total_lap_y = input_size * num_y - height;\n  const base_lap_x = Math.floor(total_lap_x / (num_x - 1));\n  const base_lap_y = Math.floor(total_lap_y / (num_y - 1));\n  const extra_lap_x = total_lap_x - base_lap_x * (num_x - 1);\n  const extra_lap_y = total_lap_y - base_lap_y * (num_y - 1);\n  locs_x[0] = 0;\n  for (let i = 1; i < num_x; i++) {\n    if (i <= extra_lap_x) locs_x[i] = locs_x[i - 1] + input_size - base_lap_x - 1;else locs_x[i] = locs_x[i - 1] + input_size - base_lap_x;\n  }\n  locs_y[0] = 0;\n  for (let i = 1; i < num_y; i++) {\n    if (i <= extra_lap_y) locs_y[i] = locs_y[i - 1] + input_size - base_lap_y - 1;else locs_y[i] = locs_y[i - 1] + input_size - base_lap_y;\n  }\n  pad_left[0] = 0;\n  pad_top[0] = 0;\n  pad_right[num_x - 1] = 0;\n  pad_bottom[num_y - 1] = 0;\n  for (let i = 1; i < num_x; i++) pad_left[i] = Math.floor((locs_x[i - 1] + input_size - locs_x[i]) / 2);\n  for (let i = 1; i < num_y; i++) pad_top[i] = Math.floor((locs_y[i - 1] + input_size - locs_y[i]) / 2);\n  for (let i = 0; i < num_x - 1; i++) pad_right[i] = locs_x[i] + input_size - locs_x[i + 1] - pad_left[i + 1];\n  for (let i = 0; i < num_y - 1; i++) pad_bottom[i] = locs_y[i] + input_size - locs_y[i + 1] - pad_top[i + 1];\n  for (let i = 0; i < num_x; i++) {\n    for (let j = 0; j < num_y; j++) {\n      const x1 = locs_x[i];\n      const y1 = locs_y[j];\n      const x2 = locs_x[i] + input_size;\n      const y2 = locs_y[j] + input_size;\n      const tile = new Img(input_size, input_size);\n      tile.getImageCrop(0, 0, input, x1, y1, x2, y2);\n      const scaled = await upscaleImg(tile);\n      output.getImageCrop((x1 + pad_left[i]) * factor, (y1 + pad_top[j]) * factor, scaled, pad_left[i] * factor, pad_top[j] * factor, scaled.width - pad_right[i] * factor, scaled.height - pad_bottom[j] * factor);\n    }\n  }\n  return output;\n};\nconst upscaleImage = async (data, width, height, url) => {\n  const startTime = Date.now();\n  const output = await upscale(data, width, height);\n  const canvas = new OffscreenCanvas(output.width, output.height);\n  const ctx = canvas.getContext('2d');\n  const imgData = ctx.createImageData(output.width, output.height);\n  for (let i = 0; i < imgData.data.length; i++) imgData.data[i] = output.data[i];\n  ctx.putImageData(imgData, 0, 0);\n  const blob = await canvas.convertToBlob({\n    type: 'image/png'\n  });\n  mainFn.setImg(url, 'upscaleUrl', URL.createObjectURL(blob));\n  mainFn.log?.(`${url}\\n${width}x${height}\\nè€—æ—¶ ${Date.now() - startTime}ms æ”¾å¤§å®Œæˆ`);\n};\n\nexports.setMainFn = setMainFn;\nexports.upscaleImage = upscaleImage;\n";break;case"userscript/otherSite":c="\nconst web = require('solid-js/web');\nconst helper = require('helper');\nconst main = require('main');\n\nconst prevRe = /^ä¸Šä¸€?(?:[ç« è©±è¯]|ç« èŠ‚)$|^(?:prev|previous)(?:\\s+chapter)?$|^å‰ã®ç« $/i;\nconst nextRe = /^ä¸‹ä¸€?(?:[ç« è©±è¯]|ç« èŠ‚)$|^next(?:\\s+chapter)?$|^æ¬¡ã®ç« $/i;\nconst getChapterSwitch = () => {\n  let onPrev;\n  let onNext;\n  const checkElement = e => {\n    const texts = [e.textContent, e.ariaLabel].filter(Boolean)\n    // åˆ é™¤å¯èƒ½æ··åœ¨å…¶ä¸­çš„ç‰¹æ®Šç¬¦å·\n    .map(text => text.replaceAll(/[<>()ã€Šã€‹ï¼ˆï¼‰ã€Œã€ã€ã€]/g, '').trim());\n    if (texts.length === 0) return;\n    for (const text of texts) {\n      if (!onPrev && prevRe.test(text)) {\n        onPrev = () => e.click();\n        break;\n      }\n      if (!onNext && nextRe.test(text)) {\n        onNext = () => e.click();\n        break;\n      }\n    }\n  };\n  for (const e of helper.querySelectorAll('a, button')) {\n    checkElement(e);\n    if (onPrev && onNext) break;\n    for (const element of e.querySelectorAll('div, span, p')) {\n      checkElement(element);\n      if (onPrev && onNext) break;\n    }\n  }\n  return {\n    onPrev,\n    onNext\n  };\n};\n\nconst getTagText = ele => {\n  let text = ele.nodeName;\n  if (ele.id && !/\\d/.test(ele.id)) text += `#${ele.id}`;\n  return text;\n};\n\n/** è·å–å…ƒç´ ä»…è®°å½•äº†å±‚çº§ç»“æ„å…³ç³»çš„é€‰æ‹©å™¨ */\nconst getEleSelector = ele => {\n  const parents = [ele.nodeName];\n  const root = ele.getRootNode();\n  let e = ele;\n  while (e.parentNode && e.parentNode !== root) {\n    e = e.parentNode;\n    parents.push(getTagText(e));\n  }\n  return parents.toReversed().join('>');\n};\n\n/** åˆ¤æ–­æŒ‡å®šå…ƒç´ æ˜¯å¦ç¬¦åˆé€‰æ‹©å™¨ */\nconst isEleSelector = (ele, selector) => {\n  const parents = selector.split('>').toReversed();\n  let e = ele;\n  for (let i = 0; e && i < parents.length; i++) {\n    if (getTagText(e) !== parents[i]) return false;\n    e = e.parentNode;\n  }\n  return e === e.getRootNode();\n};\n\n// ç›®å½•é¡µå’Œæ¼«ç”»é¡µçš„å›¾ç‰‡å±‚çº§ç›¸åŒ\n// https://www.biliplus.com/manga/\n// å›¾ç‰‡è·¯å¾„ä¸Šæœ‰ id å…ƒç´ å¹¶ä¸” id å«æœ‰æ¼«ç”» idï¼Œä¸åŒè¯æ•° id ä¹Ÿä¸åŒ\nconst createImgData = (oldSrc = '') => ({\n  triggedNum: 0,\n  observerTimeout: 0,\n  oldSrc\n});\n\n/** ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯å›¾ç‰‡ url çš„æ­£åˆ™ */\nconst isImgUrlRe = /^(?:(?:(?:https?|ftp|file):)?\\/)?\\/[-\\w+&@#/%?=~|!:,.;]+[-\\w+&@#%=~|]$/;\n\n/** æ‰¾å‡ºæ ¼å¼ä¸ºå›¾ç‰‡ url çš„å…ƒç´ å±æ€§ */\nconst getDatasetUrl = e => {\n  for (const key of e.getAttributeNames()) {\n    // è·³è¿‡ç™½åå•\n    switch (key) {\n      case 'src':\n      case 'alt':\n      case 'class':\n      case 'style':\n      case 'id':\n      case 'title':\n      case 'onload':\n      case 'onerror':\n        continue;\n    }\n    const val = e.getAttribute(key).trim();\n    if (!isImgUrlRe.test(val)) continue;\n    return val;\n  }\n};\n\n/**\n *\n * é€šè¿‡æ»šåŠ¨åˆ°æŒ‡å®šå›¾ç‰‡å…ƒç´ ä½ç½®å¹¶åœç•™ä¸€ä¼šæ¥è§¦å‘å›¾ç‰‡çš„æ‡’åŠ è½½ï¼Œè¿”å›å›¾ç‰‡ src æ˜¯å¦å‘ç”Ÿå˜åŒ–\n *\n * ä¼šåœ¨è§¦å‘åé‡æ–°æ»šå›åŸä½ï¼Œå½“ time ä¸º 0 æ—¶ï¼Œå› ä¸ºæ»šåŠ¨é€Ÿåº¦å¾ˆå¿«æ‰€ä»¥æ˜¯æ— æ„Ÿçš„\n */\nconst triggerEleLazyLoad = async (e, time, isLazyLoaded, runCondition) => {\n  const nowScroll = window.scrollY;\n  e.scrollIntoView({\n    behavior: 'instant'\n  });\n  e.dispatchEvent(new Event('scroll', {\n    bubbles: true\n  }));\n  try {\n    if (isLazyLoaded && time) return await helper.wait(isLazyLoaded, time);\n  } finally {\n    if (runCondition()) window.scroll({\n      top: nowScroll,\n      behavior: 'instant'\n    });\n  }\n};\nconst isImageElement = e => e.tagName === 'IMG';\n\n/** åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å·²ç»æˆåŠŸè§¦å‘å®Œæ‡’åŠ è½½ */\nconst isLazyLoaded = (e, oldSrc) => {\n  if (isImageElement(e)) {\n    if (!e.src) return false;\n    if (!e.offsetParent) return false;\n    // æœ‰äº›ç½‘ç«™ä¼šä½¿ç”¨ svg å ä½\n    if (e.src.startsWith('data:image/svg')) return false;\n    if (e.naturalWidth > 500 || e.naturalHeight > 500) return true;\n    if (oldSrc !== undefined && e.src !== oldSrc) return true;\n  } else {\n    const imgDomList = e.querySelectorAll('img');\n    for (const imgDom of imgDomList) if (isLazyLoaded(imgDom, oldSrc)) return true;\n  }\n  return false;\n};\nconst imgMap = new WeakMap();\nlet imgShowObserver;\nconst getImg = e => imgMap.get(e) ?? createImgData();\nconst MAX_TRIGGED_NUM = 5;\n\n/** åˆ¤æ–­å›¾ç‰‡å…ƒç´ æ˜¯å¦éœ€è¦è§¦å‘æ‡’åŠ è½½ */\nconst needTrigged = e => !isLazyLoaded(e, imgMap.get(e)?.oldSrc) && (imgMap.get(e)?.triggedNum ?? 0) < MAX_TRIGGED_NUM;\n\n/** å›¾ç‰‡æ‡’åŠ è½½è§¦å‘å®Œåè°ƒç”¨ */\nconst handleTrigged = e => {\n  const img = getImg(e);\n  img.observerTimeout = 0;\n  img.triggedNum += 1;\n  if (isLazyLoaded(e, img.oldSrc) && img.triggedNum < MAX_TRIGGED_NUM) img.triggedNum = MAX_TRIGGED_NUM;\n  imgMap.set(e, img);\n  if (!needTrigged(e)) imgShowObserver.unobserve(e);\n};\n\n/** ç›‘è§†å›¾ç‰‡æ˜¯å¦è¢«æ˜¾ç¤ºçš„ Observer */\nimgShowObserver = new IntersectionObserver(entries => {\n  for (const img of entries) {\n    const e = img.target;\n    if (img.isIntersecting) {\n      imgMap.set(e, {\n        ...getImg(e),\n        observerTimeout: window.setTimeout(handleTrigged, 290, e)\n      });\n    } else window.clearTimeout(imgMap.get(e)?.observerTimeout);\n  }\n});\nconst turnPageScheduled = helper.createScheduled(fn => helper.throttle(fn, 1000));\n/** è§¦å‘ç¿»é¡µ */\nconst triggerTurnPage = async (waitTime, runCondition) => {\n  if (!turnPageScheduled()) return;\n  const nowScroll = window.scrollY;\n  // æ»šåˆ°åº•éƒ¨å†æ»šå›æ¥ï¼Œè§¦å‘å¯èƒ½å­˜åœ¨çš„è‡ªåŠ¨ç¿»é¡µè„šæœ¬\n  window.scroll({\n    top: document.body.scrollHeight,\n    behavior: 'instant'\n  });\n  document.body.dispatchEvent(new Event('scroll', {\n    bubbles: true\n  }));\n  if (waitTime) await helper.sleep(waitTime);\n  if (runCondition()) window.scroll({\n    top: nowScroll,\n    behavior: 'instant'\n  });\n};\nconst waitTime = 300;\n\n/** è§¦å‘é¡µé¢ä¸Šå›¾ç‰‡å…ƒç´ çš„æ‡’åŠ è½½ */\nconst triggerLazyLoad = helper.singleThreaded(async (_, targetImgList, runCondition) => {\n  for (const e of targetImgList) {\n    imgShowObserver.observe(e);\n    if (!imgMap.has(e)) imgMap.set(e, createImgData(isImageElement(e) ? e.src : ''));\n  }\n  for (const e of targetImgList) {\n    await helper.wait(runCondition);\n    await triggerTurnPage(0, runCondition);\n    if (!needTrigged(e)) continue;\n    const datasetUrl = getDatasetUrl(e);\n    if (datasetUrl) e.setAttribute('src', datasetUrl);\n    if (await triggerEleLazyLoad(e, waitTime, () => isLazyLoaded(e, imgMap.get(e)?.oldSrc), runCondition)) handleTrigged(e);\n  }\n  await triggerTurnPage(waitTime, runCondition);\n});\n\n\n// æµ‹è¯•æ¡ˆä¾‹\n// https://www.177picyy.com/html/2023/03/5505307.html\n// éœ€è¦é…åˆå…¶ä»–ç¿»é¡µè„šæœ¬ä½¿ç”¨\n// https://www.colamanga.com/manga-za76213/1/5.html\n// ç›´æ¥è·³è½¬åˆ°å›¾ç‰‡å…ƒç´ ä¸ä¼šç«‹åˆ»è§¦å‘ï¼Œè¿˜éœ€è¦åœç•™20ms\n// https://www.colamanga.com/manga-kg45140/1/2.html\n/** æ‰§è¡Œè„šæœ¬æ“ä½œã€‚å¦‚æœä¸­é€”ä¸­æ–­ï¼Œå°†è¿”å› true */\nconst otherSite = async () => {\n  let laseScroll = window.scrollY;\n  const {\n    store,\n    setState,\n    options,\n    setOptions\n  } = await main.useInit(location.hostname, {\n    remember_current_site: true,\n    selector: ''\n  });\n\n  // ç‚¹å‡»æŒ‰é’®åç«‹åˆ»åˆ æ‰è®°ä½å½“å‰ç«™ç‚¹çš„é…ç½®\n  helper.createEffectOn(() => options.remember_current_site, async remember => {\n    if (remember) return;\n    await GM.deleteValue(location.hostname);\n    location.reload();\n  });\n  if (!store.flag.isStored) main.toast(() => (() => {\n    var _el$ = web.template(`<div><button>`)(),\n      _el$2 = _el$.firstChild;\n    web.insert(_el$, () => helper.t('site.simple.auto_read_mode_message'), _el$2);\n    web.addEventListener(_el$2, \"click\", () => setOptions({\n      autoShow: false\n    }));\n    web.insert(_el$2, () => helper.t('other.disable'));\n    return _el$;\n  })(), {\n    duration: 1000 * 7\n  });\n\n  // ä¸ºé¿å…å¡æ­»ï¼Œæä¾›ä¸€ä¸ªåˆ é™¤ selector çš„èœå•é¡¹\n  const menuId = await GM.registerMenuCommand(helper.t('site.simple.simple_read_mode'), () => setOptions({\n    selector: ''\n  }));\n\n  // ç­‰å¾… selector åŒ¹é…åˆ°ç›®æ ‡åå†ç»§ç»­æ‰§è¡Œï¼Œé¿å…åœ¨æ¼«ç”»é¡µå¤–çš„å…¶ä»–åœ°æ–¹è¿è¡Œ\n  await helper.wait(() => !options.selector || helper.querySelectorAll(options.selector).length >= 2);\n  await GM.unregisterMenuCommand(menuId);\n\n  /** è®°å½•ä¼ å…¥çš„å›¾ç‰‡å…ƒç´ ä¸­æœ€å¸¸è§çš„é‚£ä¸ª selector */\n  const saveImgEleSelector = imgEleList => {\n    if (imgEleList.length < 7) return;\n    const selector = helper.getMostItem(imgEleList.map(getEleSelector));\n    if (selector !== options.selector) setOptions({\n      selector\n    });\n  };\n  const blobUrlMap = new Map();\n  // å¤„ç†é‚£äº› URL.createObjectURL åé©¬ä¸Š URL.revokeObjectURL çš„å›¾ç‰‡\n  const handleBlobImg = async e => {\n    if (blobUrlMap.has(e.src)) return blobUrlMap.get(e.src);\n    if (!e.src.startsWith('blob:')) return e.src;\n    if (await helper.testImgUrl(e.src)) return e.src;\n    const canvas = new OffscreenCanvas(e.naturalWidth, e.naturalHeight);\n    const canvasCtx = canvas.getContext('2d');\n    canvasCtx.drawImage(e, 0, 0);\n    const url = URL.createObjectURL(await helper.canvasToBlob(canvas));\n    blobUrlMap.set(e.src, url);\n    return url;\n  };\n  const handleImgUrl = async e => {\n    const url = await handleBlobImg(e);\n    if (url.startsWith('http:') && location.protocol === 'https:') return url.replace('http:', 'https:');\n    return url;\n  };\n\n  /** é‡å¤çš„åŠ è½½å ä½å›¾ */\n  const placeholderImgList = new Set();\n  helper.createEffectOn(() => store.manga.imgList.filter(url => url && !placeholderImgList.has(url)), helper.throttle(imgList => {\n    if (!imgList?.length || imgList.length - new Set(imgList).size <= 4) return;\n    const repeatNumMap = new Map();\n    for (const url of imgList) {\n      const repeatNum = (repeatNumMap.get(url) ?? 0) + 1;\n      repeatNumMap.set(url, repeatNum);\n      if (repeatNum > 5) placeholderImgList.add(url);\n    }\n  }));\n\n  /** æ ¹æ®å…ƒç´ æ‰€åœ¨é«˜åº¦è¿›è¡Œæ’åº */\n  const eleSortFn = (a, b) => a === undefined || b === undefined ? 0 : a.getBoundingClientRect().y - b.getBoundingClientRect().y;\n  const imgBlackList = [\n  // ä¸œæ–¹æ°¸å¤œæœºçš„é¢„åŠ è½½å›¾ç‰‡\n  '#pagetual-preload',\n  // 177picyy ä¸Šä¼šåœ¨å›¾ç‰‡ä¸‹åŠ ä¸€ä¸ª noscript\n  // æœ¬æ¥åªæ˜¯å›¾ç‰‡å…ƒç´ çš„ html ä»£ç ï¼Œä½†ç»è¿‡ä¸œæ–¹æ°¸å¤œæœºåŠ è½½åå°±ä¼šå˜æˆçœŸçš„å›¾ç‰‡å…ƒç´ ï¼Œå¯¼è‡´é‡å¤\n  'noscript'];\n  const getAllImg = () => helper.querySelectorAll(`:not(${imgBlackList.join(',')}) > img`);\n\n  /** è·å–å¤§æ¦‚ç‡æ˜¯æ¼«ç”»å›¾ç‰‡çš„å›¾ç‰‡å…ƒç´  */\n  const getExpectImgList = () => helper.querySelectorAll(options.selector).filter(e => isLazyLoaded(e, imgMap.get(e)?.oldSrc) || !imgMap.has(e) || imgMap.get(e).triggedNum <= 5);\n\n  /** åˆ¤æ–­ä¸€ä¸ªå›¾ç‰‡å…ƒç´ æ˜¯å¦ç¬¦åˆæ ‡å‡† */\n  const isDisplayImg = e => e.offsetHeight > 100 && e.offsetWidth > 100 && (e.naturalHeight > 500 && e.naturalWidth > 500 || isEleSelector(e, options.selector));\n  let imgEleList;\n\n  /** æ£€æŸ¥ç­›é€‰ç¬¦åˆæ ‡å‡†çš„å›¾ç‰‡å…ƒç´ ç”¨äºæ›´æ–° imgList */\n  const updateImgList = helper.singleThreaded(async _state => {\n    imgEleList = await helper.wait(() => {\n      /** å¤§æ¦‚ç‡æ˜¯æ¼«ç”»å›¾ç‰‡çš„å›¾ç‰‡å…ƒç´  */\n      const expectImgs = options.selector ? new Set(getExpectImgList()) : undefined;\n      let imgNum = 0;\n      const newImgList = [];\n      for (const e of getAllImg()) {\n        if (isDisplayImg(e)) {\n          newImgList.push(e);\n          imgNum += 1;\n        } else if (expectImgs?.has(e) && needTrigged(e)) newImgList.push(undefined);\n      }\n      return imgNum >= 2 && newImgList.toSorted(eleSortFn);\n    });\n    if (imgEleList.length === 0) return setState(state => {\n      state.fab.show = false;\n      state.manga.show = false;\n    });\n\n    // éšç€å›¾ç‰‡çš„å¢åŠ ï¼Œéœ€è¦è¡¥ä¸Šç©ºç¼ºä½ç½®ï¼Œé¿å…å˜æˆç¨€ç–æ•°ç»„\n    if (store.manga.imgList.length < imgEleList.length) setState('comicMap', '', 'imgList', [...store.manga.imgList, ...Array.from({\n      length: imgEleList.length - store.manga.imgList.length\n    }, () => '')]);\n    // colamanga ä¼šåˆ›å»ºéšæœºä¸ªæ•°çš„å‡ img å…ƒç´ ï¼Œå¯¼è‡´åˆšå¼€å§‹æ—¶é«˜ä¼°é¡µæ•°ï¼Œéœ€è¦åˆ æ‰å¤šä½™çš„é¡µæ•°\n    else if (store.manga.imgList.length > imgEleList.length) setState('comicMap', '', 'imgList', store.manga.imgList.slice(0, imgEleList.length));\n    let isEdited = false;\n    await helper.plimit(imgEleList.map((e, i) => async () => {\n      let newUrl = '';\n      if (e) {\n        newUrl = await handleImgUrl(e);\n        if (placeholderImgList.has(newUrl)) newUrl = getDatasetUrl(e) ?? '';\n      }\n      if (newUrl === store.manga.imgList[i]) return;\n      isEdited ||= true;\n      setState('comicMap', '', 'imgList', list => list.with(i, newUrl));\n    }));\n    if (isEdited) saveImgEleSelector(imgEleList.filter(Boolean));\n    if (isEdited || imgEleList.some(e => !e || needTrigged(e))) {\n      await helper.sleep(1000);\n      _state.continueRun();\n    }\n  });\n  let timeout = false;\n\n  /** åªåœ¨`å¼€å¯äº†é˜…è¯»æ¨¡å¼`å’Œ`å½“å‰å¯æ˜¾ç¤ºå›¾ç‰‡æ•°é‡ä¸è¶³`æ—¶é€šè¿‡æ»šåŠ¨è§¦å‘æ‡’åŠ è½½ */\n  const runCondition = () => store.manga.show || !timeout && store.manga.imgList.length === 0;\n\n  /** è§¦å‘å¤§æ¦‚ç‡æ˜¯æ¼«ç”»å›¾ç‰‡çš„æ‡’åŠ è½½ */\n  const triggerExpectImg = (num, time) => helper.wait(async () => {\n    let expectImgList = getExpectImgList().filter(needTrigged);\n    if (num) expectImgList = expectImgList.slice(0, num);\n    await triggerLazyLoad(expectImgList, runCondition);\n    return expectImgList.every(e => !needTrigged(e));\n  }, time);\n  const triggerAllLazyLoad = helper.singleThreaded(async () => {\n    // ä¼˜å…ˆè§¦å‘å¤§æ¦‚ç‡æ˜¯æ¼«ç”»å›¾ç‰‡çš„æ‡’åŠ è½½\n    if (options.selector) {\n      await triggerExpectImg(3, 1000 * 5);\n      await triggerExpectImg();\n    }\n    await triggerLazyLoad(getAllImg().filter(needTrigged).toSorted(eleSortFn), runCondition);\n\n    // é’ˆå¯¹ä¸ä½¿ç”¨ img æ¥è§¦å‘æ‡’åŠ è½½çš„ç½‘ç«™ï¼Œè¦æ‰¾åˆ°å›¾ç‰‡å®¹å™¨å…ƒç´ å†å°è¯•è§¦å‘æ‡’åŠ è½½\n    // https://www.twmanga.com/comic/chapter/sanjiaoguanxirumen-founai/0_0.html\n    if (imgEleList.length > 3) {\n      let parent = imgEleList[0];\n      // ä»ç°æœ‰çš„å›¾ç‰‡å…ƒç´ å¼€å§‹å†’æ³¡æŸ¥æ‰¾ï¼Œæ£€æŸ¥æ¯ä¸ªå±‚çº§ä¸Šæ˜¯å¦æœ‰è¶…è¿‡5ä¸ªç›¸ä¼¼çš„å…„å¼Ÿå…ƒç´ \n      while (parent?.parentElement) {\n        const siblingList = parent.parentElement.children;\n        if (siblingList.length >= 5) {\n          const {\n            dataset\n          } = parent;\n          let sameNum = 0;\n          for (const siblingDom of siblingList) {\n            if (siblingDom === parent) continue;\n            if ('dataset' in siblingDom && helper.isEqual(siblingDom.dataset, dataset)) {\n              sameNum++;\n              if (sameNum >= 5) break;\n            }\n          }\n          if (sameNum >= 5) {\n            await triggerLazyLoad(helper.querySelectorAll(getEleSelector(parent)), runCondition);\n            break;\n          }\n        }\n        parent = parent.parentElement;\n      }\n    }\n  });\n  const handleMutation = () => {\n    updateImgList();\n    triggerAllLazyLoad();\n    setState('manga', getChapterSwitch());\n  };\n  /** ç›‘è§†é¡µé¢å…ƒç´ å‘ç”Ÿå˜åŒ–çš„ Observer */\n  const imgDomObserver = new MutationObserver(handleMutation);\n  setState('comicMap', '', {\n    async getImgList() {\n      if (!imgEleList) {\n        imgEleList = [];\n        imgDomObserver.observe(document.body, {\n          subtree: true,\n          childList: true,\n          attributes: true,\n          attributeFilter: ['src']\n        });\n        handleMutation();\n        setTimeout(() => {\n          timeout = true;\n          if (store.manga.imgList.length > 0) return;\n          main.toast.warn(helper.t('site.simple.no_img'), {\n            id: 'no_img',\n            duration: Number.POSITIVE_INFINITY,\n            async onClick() {\n              await setOptions({\n                remember_current_site: false\n              });\n              location.reload();\n            }\n          });\n        }, 3000);\n      }\n      await helper.wait(() => store.manga.imgList.length);\n      main.toast.dismiss('no_img');\n      return store.manga.imgList;\n    }\n  });\n\n  // åŒæ­¥æ»šåŠ¨æ˜¾ç¤ºç½‘é¡µä¸Šçš„å›¾ç‰‡ï¼Œç”¨äºä»¥é˜²ä¸‡ä¸€ä¿åº•è§¦å‘æ¼ç½‘ä¹‹é±¼\n  setState('manga', 'onShowImgsChange', helper.throttle(showImgs => {\n    if (!store.manga.show) return;\n    imgEleList[[...showImgs].at(-1)]?.scrollIntoView({\n      behavior: 'instant',\n      block: 'end'\n    });\n  }, 1000));\n\n  // åœ¨é€€å‡ºé˜…è¯»æ¨¡å¼æ—¶è·³å›ä¹‹å‰çš„æ»šåŠ¨ä½ç½®\n  helper.createEffectOn(() => store.manga.show, show => {\n    if (show) laseScroll = window.scrollY;else window.scroll({\n      top: laseScroll,\n      behavior: 'instant'\n    });\n  });\n\n  // é’ˆå¯¹ SPA ç½‘ç«™ï¼Œåœ¨ç½‘å€æ”¹å˜åæ¸…ç©ºå›¾ç‰‡\n  helper.onUrlChange((lastUrl, nowUrl) => {\n    if (!lastUrl || lastUrl.split('/').length === nowUrl.split('/').length) return;\n    setState('comicMap', '', 'imgList', undefined);\n  });\n};\n\nexports.otherSite = otherSite;\n";break;case"userscript/ehTagRules":c='\n// ä½¿ç”¨ i18n-ally æ‰©å±•æŸ¥çœ‹å¯¹åº”çš„ä¸­æ–‡ç¿»è¯‘\n\n// æ¦‚ç‡æ ‡ç­¾çš„æ ‡å‡†ï¼šæœ‰Aæ ‡ç­¾çš„æœ¬å­ä¸­ï¼Œåªæœ‰ 10% çš„æœ¬å­æ²¡æœ‰ B æ ‡ç­¾\n// ã€Œ`Aæ ‡ç­¾ -Bæ ‡ç­¾` çš„æœç´¢ç»“æœæ•°ã€<ã€Œ`Aæ ‡ç­¾` çš„æœç´¢ç»“æœæ•°ã€çš„ 10%\n// æœ‰æ²¡æœ‰å¿…è¦åŠ ä¸Šå¤æ‚è§„åˆ™å‘¢ï¼Ÿ\n// - ç»„åˆæ ‡ç­¾\n//   - å•æ‰¶å¥¹ + å•å¥³ä¸» = å¤§æ¦‚ç‡ã€Œæ‰¶ä¸Šå¥³ã€\n// - æ ¹æ®æ¡ä»¶å°†ã€Œå¤§æ¦‚ç‡ã€é™å®šä¸ºã€Œå¿…é¡»ã€\n//   - å•èè‰ + è´«ä¹³ + (å•å¥³ä¸») = è‚¯å®šæ— æ³•å…±å­˜\n// - æŠŠç”»å»Šç±»å‹ä¹ŸåŠ è¿›æ ‡ç­¾ï¼Œæ–¹ä¾¿è¿‡æ»¤ CG é›†ç­‰å›¾åº“\nconst rules = {"prerequisite":{"(x|f):incest":["f:cousin","f:aunt","f:daughter","f:mother","f:granddaughter","f:sister","f:grandmother","f:niece"],"(x|m):incest":["m:cousin"],"f:incest":["f:inseki","f:low_incest"],"m:incest":["m:inseki","m:low_incest"],"x:incest":["x:inseki","x:low_incest"],"f:group":["f:fff_threesome","f:ttt_threesome","f:fft_threesome","f:ttf_threesome"],"m:group":["m:mmm_threesome"],"x:group":["x:mmf_threesome","x:mmt_threesome","x:ttm_threesome","x:ffm_threesome","x:mtf_threesome","x:oyakodon","x:shimaidon","x:gang_rape"],"(x|f):group":["f:oyakodon","f:shimaidon","f:multiple_straddling","f:gang_rape","f:layer_cake","f:harem"],"(x|m):group":["m:oyakodon","m:shimaidon","m:multiple_straddling","m:gang_rape","m:layer_cake","m:harem"],"f:yuri":["f:fff_threesome"],"m:yaoi":["m:group","m:mmm_threesome"],"f:futanari":["f:ttt_threesome","f:fft_threesome","f:ttf_threesome","f:full-packaged_futanari","f:futanarization"],"f:shemale":["f:ball-less_shemale"],"f:lolicon":["f:kodomo_doushi","x:kodomo_doushi","f:oppai_loli","f:mesugaki","f:low_lolicon"],"m:shotacon":["m:kodomo_doushi","x:kodomo_doushi"],"f:blowjob":["f:multimouth_blowjob","f:blowjob_face","f:deepthroat","f:focus_blowjob"],"m:blowjob":["m:multimouth_blowjob","m:blowjob_face","m:deepthroat","m:focus_blowjob"],"f:handjob":["f:multiple_handjob"],"m:handjob":["m:multiple_handjob"],"f:assjob":["f:multiple_assjob"],"m:assjob":["m:multiple_assjob"],"f:footjob":["f:multiple_footjob"],"m:footjob":["m:multiple_footjob"],"f:paizuri":["f:focus_paizuri"],"m:paizuri":["m:focus_paizuri"],"f:rimjob":["f:focus_rimjob"],"m:rimjob":["m:focus_rimjob"],"f:cunnilingus":["f:focus_cunnilingus"],"f:anal":["f:focus_anal","f:anal_intercourse","f:tail_plug","f:butt_plug"],"m:anal":["m:focus_anal","m:anal_intercourse","m:tail_plug","m:butt_plug"],"f:rape":["f:gang_rape"],"m:rape":["m:gang_rape"],"(f|m):corpse":["f:necrophilia","m:necrophilia"],"(f|m):masturbation":["f:phone_sex","m:phone_sex"],"f:bondage":["f:fanny_packing","f:shibari","f:straitjacket"],"m:bondage":["m:fanny_packing","m:shibari","m:straitjacket"],"f:inflation":["f:cumflation"],"m:inflation":["m:cumflation"],"f:lactation":["f:milking"],"m:lactation":["m:milking"],"f:piercing":["f:nipple_piercing","f:genital_piercing"],"m:piercing":["m:nipple_piercing","m:genital_piercing"],"f:big_breasts":["f:huge_breasts","f:gigantic_breasts"],"f:huge_breasts":["f:gigantic_breasts"],"f:sex_toys":["f:tail_plug","f:butt_plug","f:unusual_insertions"],"m:sex_toys":["m:tail_plug","m:butt_plug","m:unusual_insertions"],"f:swimsuit":["f:bikini"],"m:swimsuit":["m:bikini"],"f:crossdressing":["f:schoolboy_uniform"],"f:bandages":["f:sarashi"],"f:monster_girl":["f:zombie","f:skeleton"],"f:tail":["f:multiple_tails"],"(f|m):robot":["f:dismantling","m:dismantling"]},"conflict":{"f:females_only":["f:futanari","f:bisexual","f:ttt_threesome","f:fft_threesome","f:ttf_threesome","x:mmf_threesome","x:mmt_threesome","x:ttm_threesome","x:mtf_threesome","x:group","m:*","x:*"],"f:sole_female":["f:ttt_threesome","f:fft_threesome","x:mmt_threesome","x:ttm_threesome","m:mmm_threesome"],"f:sole_dickgirl":["f:fff_threesome","f:ttt_threesome","f:ttf_threesome","x:mmf_threesome","x:ttm_threesome","m:mmm_threesome"]},"possibleConflict":{"f:dark_skin":["f:tanlines"],"m:dark_skin":["m:tanlines"],"f:lolicon":["f:small_breasts"],"f:breast_feeding":["f:nipple_stimulation"]},"combo":{"f:kemonomimi":["f:horse_girl","f:dog_girl","f:mouse_girl","f:bunny_girl","f:catgirl","f:cowgirl","c:amiya","c:rosmontis","c:suzuran","c:shamare","c:schwarz"],"f:tail":["f:horse_girl","c:suzuran","c:schwarz","c:yuko_yoshida"],"f:leotard":["f:bunny_girl"],"f:horns":["f:oni","c:yuko_yoshida"],"f:horse_girl":["p:uma_musume_pretty_derby"],"f:halo":["p:blue_archive","c:nagisa_kirifuji","c:mika_misono"],"f:zombie":["p:zombie_land_saga"],"f:hair_buns":["c:ayumu_uehara","c:yoshiko_tsushima","c:chisato_arashi","c:ceylon"],"f:twintails":["c:yu_takasaki","c:rurino_osawa","c:sayaka_murano","c:nico_yazawa","c:nozomi_tojo","c:ruby_kurosawa","c:ria_kazuno","c:arisa_ichigaya","c:himari_uehara","c:ako_udagawa","c:reona_nyubara","c:tsukushi_futaba","c:kotone_fujita"],"f:ponytail":["c:hime_anyoji","c:eli_ayase","c:honoka_kosaka","c:kanan_matsuura","c:seira_kazuno","c:ren_hazuki","c:saaya_yamabuki","c:nijika_ijichi","c:schwarz","c:mafuyu_asahina"],"f:very_long_hair":["c:hitori_gotou","c:nijika_ijichi","c:euphyllia_magenta","c:nagisa_kirifuji","c:mika_misono","c:kanade_yoisaki"],"f:lolicon":["c:suzuran","c:shamare"],"f:multiple_tails":["c:suzuran"],"f:wings":["c:remilia_scarlet","c:flandre_scarlet","c:koakuma","c:nagisa_kirifuji","c:mika_misono"],"f:vampire":["c:remilia_scarlet","c:flandre_scarlet"],"f:demon_girl":["c:koakuma","c:yuko_yoshida"],"f:thick_eyebrows":["c:suletta_mercury"],"f:glasses":["c:junna_hoshimi"],"f:beauty_mark":["c:misuzu_hataya"],"m:crossdressing":["c:mizuki_akiyama"],"f:angel":["c:nagisa_kirifuji","c:mika_misono"]}};\nconst getTagLintRules = () => {\n  const shortNamespace = new Map([[\'p\', \'parody\'], [\'c\', \'character\'], [\'g\', \'group\'], [\'a\', \'artist\'], [\'m\', \'male\'], [\'f\', \'female\'], [\'x\', \'mixed\'], [\'o\', \'other\']].map(([short, full]) => [new RegExp(`\\\\b${short}\\\\b(?=.*:)`), full]));\n  // å°†ç¼©å†™çš„å‘½åç©ºé—´è½¬å›å…¨æ‹¼\n  const getTagName = tag => {\n    let fullTag = tag;\n    for (const re of shortNamespace.keys()) if (re.test(fullTag)) {\n      fullTag = fullTag.replace(re, shortNamespace.get(re));\n    }\n    return fullTag;\n  };\n  const createRuleMap = (map, reverse = false) => {\n    const ruleMap = new Map();\n    if (reverse) for (let [targetTag, tags] of Object.entries(map)) {\n      targetTag = getTagName(targetTag);\n      for (let tag of tags) {\n        tag = getTagName(tag);\n        if (ruleMap.has(tag)) ruleMap.get(tag).add(targetTag);else ruleMap.set(tag, new Set([targetTag]));\n      }\n    } else for (const [tag, targetTag] of Object.entries(map)) ruleMap.set(getTagName(tag), new Set(targetTag.map(getTagName)));\n    return ruleMap;\n  };\n  return {\n    prerequisite: createRuleMap(rules.prerequisite, true),\n    conflict: createRuleMap(rules.conflict),\n    possibleConflict: createRuleMap(rules.possibleConflict),\n    // å†™çš„æ—¶å€™ä¸ºäº†å¯ä»¥æ ¹æ®ä¸åŒä½œå“åˆ†ç±»è€Œæ²¡æœ‰åè½¬\n    // ä½†ä¸ºäº†å‡å°‘ä»£ç ï¼Œåœ¨æ‰“åŒ…æ—¶åè½¬äº†ä¸‹ï¼Œæ‰€ä»¥åœ¨ç”¨æ—¶å¾—å†åè½¬å›å»\n    combo: createRuleMap(rules.combo, true)\n  };\n};\n\n/** æ‹†åˆ†å¤šä¸ªå‘½åç©ºé—´çš„æ ‡ç­¾ */\nconst splitTagNamespace = tag => {\n  if (!tag.startsWith(\'(\')) return [tag];\n  const [, namespaces, tagName] = /\\((.+?)\\)(.+)/.exec(tag);\n  return namespaces.split(\'|\').map(namespace => `${namespace}${tagName}`);\n};\n\n/** åˆ¤æ–­æ˜¯å¦ç¼ºå°‘æŒ‡å®šå‘½åç©ºé—´ä¸‹çš„æ ‡ç­¾ */\nconst isMissingNamespace = (tagList, ...namespaces) => {\n  for (const namespace of namespaces) for (const tag of tagList) if (tag.startsWith(namespace)) return false;\n  return true;\n};\n\n/** æ£€æŸ¥æ ‡ç­¾æ˜¯å¦å­˜åœ¨ */\nconst hasTag = (tagList, tagName) => {\n  if (tagName.startsWith(\'(\')) for (const tag of splitTagNamespace(tagName)) if (tagList.has(tag)) return true;\n  if (tagName.endsWith(\':*\')) return !isMissingNamespace(tagList, tagName.split(\':*\')[0]);\n  return tagList.has(tagName);\n};\n\n/** åˆ¤æ–­æ˜¯å¦ç¼ºå°‘æŒ‡å®šæ ‡ç­¾ */\nconst isMissingTags = (tagList, ...tags) => {\n  for (const tag of tags) if (tagList.has(tag)) return false;\n  return true;\n};\n\nexports.getTagLintRules = getTagLintRules;\nexports.hasTag = hasTag;\nexports.isMissingNamespace = isMissingNamespace;\nexports.isMissingTags = isMissingTags;\nexports.splitTagNamespace = splitTagNamespace;\n';break;default:c=r(i)}if(i.startsWith("worker/")&&e)try{const e=new Map;e.set("Comlink",r("comlink"));const t=n=>n.replaceAll(/require\('(.+?)'\)/g,(n,o)=>(e.has(o)||e.set(o,t(r(o))),`moduleMap['${o}']`)),n=t(c);let a="const moduleMap = {};\n";for(const[t,n]of e)a+=`\nmoduleMap['${t}'] = {};\n(function (exports, module) { ${n} }) (\n  moduleMap['${t}'],\n  {\n    set exports(value) { moduleMap['${t}'] = value; },\n    get exports() { return moduleMap['${t}']; }\n  },\n);\n`;a+=`\nconst exports = {};\n${n}\nmoduleMap['Comlink'].expose(exports);`;const s=URL.createObjectURL(new Blob([a],{type:"text/javascript"}));setTimeout(URL.revokeObjectURL,0,s);const d=new Worker(s);return void(o[i]=l("comlink").wrap(d))}catch{e=!1}let d=`\n    (function (process, require, exports, module, ${n.join(", ")}) {\n      ${c}\n    })(\n      window['${a}'].process,\n      window['${a}'].require,\n      window['${a}']['${i}'],\n      ((module) => ({\n        set exports(value) { module['${i}'] = value; },\n        get exports() { return module['${i}']; },\n      }))(window['${a}']),\n      ${n.map(e=>`window['${a}'].${e}`).join(", ")}\n    );\n  `;t.unsafeWindow[a]=o,t.unsafeWindow[a][i]={},s(d),Reflect.deleteProperty(t.unsafeWindow,a)},l=e=>{const t={value:!0},n=()=>{};n.default={};const a=new Proxy(n,{get:(n,r)=>"__esModule"===r?t:"default"===r?a:(o[e]||i(e),Reflect.has(o[e],"default")&&Reflect.has(o[e].default,r)?o[e].default[r]:o[e][r]),apply(t,n,a){o[e]||i(e);const r=o[e];return("function"==typeof r.default?r.default:r)(...a)},construct(t,n){o[e]||i(e);const a=o[e];return new("function"==typeof a.default?a.default:a)(...n)},ownKeys:()=>(o[e]||i(e),Reflect.ownKeys(o[e])),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0})});return a};o.require=l;const c=l("components/Manga"),d=l("helper"),p=l("helper/languages"),g=l("main"),m=l("userscript/copyApi"),u=l("userscript/otherSite");let h;try{switch(location.hostname){case"bbs.yamibo.com":{const e=l("solid-js/web"),t=l("solid-js"),n=l("helper"),o=l("main");(async()=>{const{setState:a,options:r,showComic:s,loadComic:i}=await o.useInit("yamibo",{"è®°å½•é˜…è¯»è¿›åº¦":!0,"å…³é—­å¿«æ·å¯¼èˆªçš„è·³è½¬":!0,"ä¿®æ­£ç‚¹å‡»é¡µæ•°æ—¶çš„è·³è½¬åˆ¤å®š":!0,"å›ºå®šå¯¼èˆªæ¡":!0,"è‡ªåŠ¨ç­¾åˆ°":!0,"ç§»åŠ¨ç«¯æ˜¾ç¤ºå¸–å­æƒé™":!0});if(n.useStyle(`#fab { --fab: #6E2B19; }\n\n    ${r.å›ºå®šå¯¼èˆªæ¡?".header-stackup { position: fixed !important }":""}\n\n    .historyTag {\n      white-space: nowrap;\n\n      border: 2px solid #6e2b19;\n    }\n\n    a.historyTag {\n      font-weight: bold;\n\n      margin-left: 1em;\n      padding: 1px 4px;\n\n      color: #6e2b19;\n      border-radius: 4px 0 0 4px;\n    }\n    a.historyTag:last-child {\n      border-radius: 4px;\n    }\n\n    div.historyTag {\n      display: initial;\n\n      margin-left: -.4em;\n      padding: 1px;\n\n      color: RGB(255, 237, 187);\n      border-radius: 0 4px 4px 0;\n      background-color: #6e2b19;\n    }\n\n    #threadlisttableid tbody:nth-child(2n) div.historyTag {\n      color: RGB(255, 246, 215);\n    }\n\n    /* å°†ã€Œå›å¤/æŸ¥çœ‹ã€åˆ—åŠ å®½ä¸€ç‚¹ */\n    .tl .num {\n      width: 80px !important;\n    }\n    `),unsafeWindow.discuz_uid&&"0"!==unsafeWindow.discuz_uid&&r.è‡ªåŠ¨ç­¾åˆ°&&(async()=>{const e=(new Date).toLocaleDateString("zh-CN");if(e===localStorage.getItem("signDate"))return;const t=n.querySelector('#scbar_form > input[name="formhash"]')?.value;if(t)try{const n=await fetch(`plugin.php?id=zqlj_sign&sign=${t}`),a=await n.text();if(!/æˆåŠŸï¼|æ‰“è¿‡å¡/.test(a))throw new Error("è‡ªåŠ¨ç­¾åˆ°å¤±è´¥");o.toast.success("è‡ªåŠ¨ç­¾åˆ°æˆåŠŸ"),localStorage.setItem("signDate",e)}catch{o.toast.error("è‡ªåŠ¨ç­¾åˆ°å¤±è´¥")}})(),r.å…³é—­å¿«æ·å¯¼èˆªçš„è·³è½¬&&n.querySelector("#qmenu a")?.setAttribute("href","javascript:;"),/thread(?:-\d+){3}|mod=viewthread/.test(document.URL)){for(const e of n.querySelectorAll('img[file*="sinaimg.cn"]'))e.setAttribute("referrerpolicy","no-referrer");const e=()=>{!n.querySelector(".pg > .prev")||a("flag","needAutoShow",!1);let e=n.querySelectorAll(":is(.t_fsz, .message) img");const t=()=>{let t=e.length;for(;t--;){const n=e[t],o=n.getAttribute("file");o&&n.src!==o&&(n.setAttribute("src",o),n.setAttribute("lazyloaded","true")),(n.src.includes("static/image")||n.complete&&n.naturalHeight&&n.naturalWidth&&n.naturalHeight<500&&n.naturalWidth<500)&&e.splice(t,1)}return e.map(e=>e.src)};a("comicMap","",{getImgList:t}),a("manga",{onLoading(e,t){if(t&&t.width<500&&t.height<500)return i()},onExit(e){e&&n.scrollIntoView(".psth, .rate, #postlist > div:nth-of-type(2)"),a("manga","show",!1)}}),n.querySelector("div.pti > div.authi")&&(n.querySelector("div.pti > div.authi").insertAdjacentHTML("beforeend",'<span class="pipe show">|</span><a id="comicReadMode" class="show" href="javascript:;">æ¼«ç”»é˜…è¯»</a>'),document.getElementById("comicReadMode")?.addEventListener("click",()=>s())),n.querySelector("#threadindex")&&n.hijackFn("ajaxinnerhtml",()=>{e=n.querySelectorAll(".t_fsz img"),0!==e.length&&0!==t().length&&r.autoShow&&s()});const l=n.querySelector(".ptg.mbm.mtn > a");if(l){const[,e]=l.href.split("id="),t=/(?<=<th>\s<a href="thread-)\d+(?=-)/g;let n=[];const r=async(s=1)=>{const i=[...(await o.request(`/misc.php?mod=tag&id=${e}&type=thread&page=${s}`)).responseText.matchAll(t)].map(([e])=>Number(e));n=[...n,...i];const l=n.indexOf(unsafeWindow.tid);return i.length>0&&(-1===l||!n[l+1])?r(s+1):a("manga",{onPrev:n[l-1]?()=>location.assign(`thread-${n[l-1]}-1-1.html`):void 0,onNext:n[l+1]?()=>location.assign(`thread-${n[l+1]}-1-1.html`):void 0})};setTimeout(r)}},t=unsafeWindow.fid??Number(new URLSearchParams(n.querySelector("h2 > a")?.href).get("fid")??"-1");if(30===t||37===t)e();else{n.querySelector("div.pti > div.authi").insertAdjacentHTML("beforeend",'<span class="pipe show">|</span><a id="comicReadMode" class="show" href="javascript:;">æ¼«ç”»é˜…è¯»</a>');const t=document.getElementById("comicReadMode");t?.addEventListener("click",()=>{t.previousElementSibling?.remove(),t.remove(),e(),s()})}if(r.è®°å½•é˜…è¯»è¿›åº¦){const e=unsafeWindow.tid??new URLSearchParams(location.search).get("tid")??/\/thread-(\d+)-\d+-\d+.html/.exec(location.pathname)?.[1];if(!e)return;let t;try{const n=await o.request(`/api/mobile/index.php?module=viewthread&tid=${e}`,{responseType:"json",errorText:"è·å–å¸–å­å›å¤æ•°æ—¶å‡ºé”™",noTip:!0});t=Number.parseInt(n.response?.Variables?.thread?.allreplies,10)}catch{}const a=Number.parseInt(n.querySelector("#pgt strong")?.textContent??n.querySelector("#dumppage")?.value??"1",10),r=await n.useCache({history:"tid"}),s=await r.get("history",`${e}`);if(s&&a<s.lastPageNum)return;const i=n.querySelectorAll(s?.lastAnchor&&a===s.lastPageNum?`#${s.lastAnchor} ~ div`:"#postlist > div, .plc.cl");if(0===i.length)return;let l=0;const c=e=>{l&&window.clearTimeout(l),l=window.setTimeout(async()=>{l=0,await r.set("history",e)},200)},d=new IntersectionObserver(n=>{const o=n.find(e=>e.isIntersecting);if(!o)return;const r=i.indexOf(o.target);if(-1!==r){for(const e of i.splice(0,r+1))d.unobserve(e);c({tid:`${e}`,lastPageNum:a,lastReplies:t||s?.lastReplies||0,lastAnchor:o.target.id})}},{rootMargin:"-160px"});for(const e of i)d.observe(e)}return}if(/forum(?:-\d+){2}|mod=forumdisplay/.test(document.URL)){if(r.ä¿®æ­£ç‚¹å‡»é¡µæ•°æ—¶çš„è·³è½¬åˆ¤å®š){const e=n.querySelectorAll(".tps>a");let t=e.length;for(;t--;)e[t].setAttribute("onClick","atarget(this)")}if(r.è®°å½•é˜…è¯»è¿›åº¦){const o=await n.useCache({history:"tid"}),a=!document.querySelector("#flk"),[r,s]=t.createSignal(!1),i=()=>s(e=>!e);let l="tbody[id^=normalthread]",c=e=>e.id.split("_")[1],d=(e,t)=>`thread-${t}-${e.lastPageNum}-1.html#${e.lastAnchor}`;a&&(l=".threadlist li.list",c=e=>new URLSearchParams(e.children[1].getAttribute("href")).get("tid"),d=(e,t)=>`forum.php?mod=viewthread&tid=${t}&extra=page%3D1&mobile=2&page=${e.lastPageNum}#${e.lastAnchor}`);for(const s of n.querySelectorAll(l)){const i=c(s);e.render(()=>{const[l,c]=t.createSignal();n.createEffectOn(r,()=>o.get("history",i).then(c));const p=t.createMemo(()=>l()?d(l(),i):""),g=t.createMemo(()=>!a&&l()?Number(s.querySelector(".num a").innerHTML)-l().lastReplies:0);return e.createComponent(t.Show,{get when(){return Boolean(l())},get children(){return e.createComponent(t.Show,{when:a,get children(){return t=e.template("<li><a>å›ç¬¬<!>é¡µ")(),o=(n=t.firstChild).firstChild.nextSibling,e.addEventListener(n,"click",unsafeWindow.atarget,!0),e.setStyleProperty(n,"color","unset"),e.insert(n,()=>l()?.lastPageNum,o),e.effect(()=>e.setAttribute(n,"href",p())),t;var t,n,o},get fallback(){return[(n=e.template("<a class=historyTag>å›ç¬¬<!>é¡µ ")(),o=n.firstChild.nextSibling,e.addEventListener(n,"click",unsafeWindow.atarget,!0),e.insert(n,()=>l()?.lastPageNum,o),e.effect(()=>e.setAttribute(n,"href",p())),n),e.createComponent(t.Show,{get when(){return g()>0},get children(){var t=e.template("<div class=historyTag>+")();return e.insert(t,g,null),t}})];var n,o}})}})},a?s.children[3]:s.getElementsByTagName("th")[0])}document.addEventListener("visibilitychange",i),n.querySelector("#autopbn")?.addEventListener("click",i)}if(r.ç§»åŠ¨ç«¯æ˜¾ç¤ºå¸–å­æƒé™&&/mod=forumdisplay/.test(document.URL)){const e=new URL(location.href);e.pathname="/api/mobile/index.php",e.searchParams.set("module",e.searchParams.get("mod")),e.searchParams.delete("mod");const t=await o.request(`${e}`,{responseType:"json",errorText:"è·å–å¸–å­æƒé™æ—¶å‡ºé”™"}),a=new Map;for(const{tid:e,readperm:n}of t.response.Variables.forum_threadlist)"0"!==n&&a.set(Number(e),Number(n));for(const e of n.querySelectorAll(".threadlist li.list")){const t=e.querySelector('a[href*="&tid="]'),n=Number(new URLSearchParams(t.href).get("tid"));a.has(n)&&e.querySelector(".threadlist_foot li.mr").insertAdjacentHTML("beforeend",`<span style="margin-right: .5em; color: #EE1B2E">#æƒé™${a.get(n)}</span>`)}}}})().catch(e=>n.log.error(e)),e.delegateEvents(["click"]);break}case"www.yamibo.com":{if(!location.pathname.includes("/manga/view-chapter"))break;const e=new URLSearchParams(location.search).get("id");if(!e)break;const t=Number(d.querySelector("section div:first-of-type div:last-of-type").innerHTML.split("ï¼š")[1]);if(Number.isNaN(t))throw new Error(d.t("site.changed_load_failed"));const n=async t=>{const n=await g.request(`https://www.yamibo.com/manga/view-chapter?id=${e}&page=${t}`);return/(?<=<img id=['"]imgPic['"].+?src=['"]).+?(?=['"])/.exec(n.responseText)[0].replaceAll("&amp;","&").replaceAll("http://","https://")};h={name:"newYamibo",getImgList:({dynamicLazyLoad:e})=>e({loadImg:n,length:t}),onNext:d.querySelectorClick("#btnNext"),onPrev:d.querySelectorClick("#btnPrev"),onExit:e=>e&&d.scrollIntoView("#w1")};break}case"comic.idmzj.com":case"comic.dmzj.com":case"manhua.idmzj.com":case"manhua.dmzj.com":{const e=l("solid-js/web"),t=l("solid-js"),n=l("helper"),o=l("main"),a=l("userscript/dmzjApi");(async()=>{const r=async()=>{const[,e,t]=location.pathname.split(/\/|\./);return e||o.toast.error("æ¼«ç”»æ•°æ®è·å–å¤±è´¥",{duration:Number.POSITIVE_INFINITY,throw:new Error("è·å–æ¼«ç”»æ‹¼éŸ³ç®€ç§°å¤±è´¥")}),{comicId:await a.getComicId(e),chapterId:t}},s=e=>{const t=n.querySelector(e);if(t?.textContent)return()=>t.click()};await o.universal({name:"dmzj",getImgList:async()=>(await(async()=>{await n.waitDom("#qiehuan_txt"),await n.wait(()=>{const e=n.querySelector("#qiehuan_txt");if(e)return"åˆ‡æ¢åˆ°ä¸Šä¸‹æ»šåŠ¨é˜…è¯»"!==e.textContent||void e.click()})})(),await n.waitDom(".comic_wraCon img"),n.querySelectorAll(".comic_wraCon img").map(e=>e.src)),onExit:e=>e&&n.scrollIntoView("#hd"),async getCommentList(){const{comicId:e,chapterId:t}=await r();return a.getViewpoint(e,t)},SPA:{isMangaPage:()=>/^\/[^/]*\/?$/.test(location.pathname)?(async()=>{if(await n.waitDom(".commentBox"),!n.querySelector(".cartoon_online_border > img"))return!1;n.querySelector(".cartoon_online_border").innerHTML="è·å–æ¼«ç”»æ•°æ®ä¸­";for(const e of n.querySelectorAll(".odd_anim_title ~ *"))e.remove();const{comicId:o}=await r();return e.render(()=>{const n=a.useComicDetail(o);return e.createComponent(t.For,{get each(){return n.chapters},children:({name:a,list:r})=>{return[(l=e.template('<div class=photo_part><div class=h2_title2><span class="h2_icon h2_icon22"></span><h2> ')(),c=l.firstChild.firstChild.nextSibling,d=c.firstChild,e.insert(c,()=>n.title,d),e.insert(c,"è¿è½½"===a?"åœ¨çº¿æ¼«ç”»å…¨é›†":`æ¼«ç”»å…¶å®ƒç‰ˆæœ¬ï¼š${a}`,null),l),(s=e.template("<div class=cartoon_online_border_other style=margin-top:-8px><ul></ul><div class=clearfix>")(),i=s.firstChild,e.insert(i,e.createComponent(t.For,{each:r,children:({title:t,id:a,updatetime:r})=>{return s=e.template("<li><a target=_blank>")(),i=s.firstChild,e.setAttribute(i,"title",t),e.setAttribute(i,"href",`https://m.dmzj.com/view/${o}/${a}.html`),e.insert(i,t),e.effect(()=>i.classList.toggle("color_red",!(r!==n.last_updatetime))),s;var s,i}})),s)];var s,i,l,c,d}})},n.querySelector(".middleright_mr")),!1})():/^\/.*?\/\d+\.shtml$/.test(location.pathname),getOnPrev:()=>s(".display_left #prev_chapter"),getOnNext:()=>s(".display_right #next_chapter")}})})().catch(e=>n.log.error(e));break}case"m.idmzj.com":case"m.dmzj.com":{const e=l("dmzjDecrypt"),t=l("helper"),n=l("main"),o=l("userscript/dmzjApi");(async()=>{switch(location.pathname.split("/")[1]){case"info":{if(Reflect.has(unsafeWindow,"obj_id"))return;const o=Number.parseInt(location.pathname.split("/")[2],10);if(Number.isNaN(o))return document.body.innerHTML="",document.body.insertAdjacentHTML("beforeend",'\n            è¯·æ‰‹åŠ¨è¾“å…¥æ¼«ç”»åè¿›è¡Œæœç´¢ <br />\n            <input type="search"> <button>æœç´¢</button> <br />\n            <div id="list" />\n          '),void t.querySelector("button").addEventListener("click",async()=>{const e=t.querySelector("input")?.value;if(!e)return;const o=await n.request(`https://s.acg.dmzj.com/comicsum/search.php?s=${e}`,{errorText:"æœç´¢æ¼«ç”»æ—¶å‡ºé”™"}),a=JSON.parse(o.responseText.slice(20,-1));t.querySelector("#list").innerHTML=a.map(({id:e,comic_name:t,comic_author:n,comic_url:o})=>`\n                <b>ã€Š${t}ã€‹<b/>â€”â€”${n}\n                <a href="${o}">Webç«¯</a>\n                <a href="https://m.dmzj.com/info/${e}.html">ç§»åŠ¨ç«¯</a>\n              `).join("<br />")});const a=await n.request(`https://v4api.idmzj.com/comic/detail/${o}?uid=2665531&disable_level=1`,{errorText:"è·å–æ¼«ç”»æ•°æ®å¤±è´¥"}),{comicInfo:{last_updatetime:r,title:s,chapters:i}}=e(a.responseText);document.title=s,document.body.insertAdjacentHTML("beforeend",`<h1>${s}</h1>`);for(const e of Object.values(i)){let t=`<h2>${e.title}</h2>`,n=e.data.length;for(;n--;)t+=`<a target="_blank" title="${e.data[n].chapter_title}" href="https://m.dmzj.com/view/${o}/${e.data[n].chapter_id}.html" ${e.data[n].updatetime===r?'style="color:red"':""}>${e.data[n].chapter_title}</a>`;document.body.insertAdjacentHTML("beforeend",t)}document.body.childNodes[0].remove(),t.useStyle("\n          h1 { margin: 0 -20vw; }\n          h1, h2 { text-align: center; }\n          body { padding: 0 20vw; }\n          a {\n            display: inline-block;\n\n            min-width: 4em;\n            margin: 0 1em;\n\n            line-height: 2em;\n            white-space: nowrap;\n          }\n        ");break}case"view":{if(unsafeWindow.comic_id)return t.useStyle(".subHeader{display:none !important}"),void await n.universal({name:"dmzj",getImgList:()=>t.querySelectorAll("#commicBox img").map(e=>e.dataset.original).filter(Boolean),getCommentList:()=>o.getViewpoint(unsafeWindow.subId,unsafeWindow.chapterId),onNext:t.querySelectorClick("#loadNextChapter"),onPrev:t.querySelectorClick("#loadPrevChapter")});const e=document.createElement("p");let a,r,s;e.textContent="æ­£åœ¨åŠ è½½ä¸­ï¼Œè¯·åå’Œæ”¾å®½ï¼Œè‹¥é•¿æ—¶é—´æ— ååº”è¯·åˆ·æ–°é¡µé¢",document.body.append(e);try{[,r,s]=/(\d+)\/(\d+)/.exec(location.pathname),a=await o.getChapterInfo(r,s)}catch(t){throw n.toast.error("è·å–æ¼«ç”»æ•°æ®å¤±è´¥",{duration:Number.POSITIVE_INFINITY}),e.textContent=t.message,t}e.textContent="åŠ è½½å®Œæˆï¼Œå³å°†è¿›å…¥é˜…è¯»æ¨¡å¼";const{folder:i,chapter_name:l,next_chap_id:c,prev_chap_id:d,comic_id:p,page_url:g}=a;document.title=`${l} ${i.split("/").at(1)}`;const{setState:m}=await n.useInit("dmzj");m(t=>{t.manga.onExit=void 0,t.manga.onNext=c?()=>{location.href=`https://m.dmzj.com/view/${p}/${c}.html`}:void 0,t.manga.onPrev=d?()=>{location.href=`https://m.dmzj.com/view/${p}/${d}.html`}:void 0,t.manga.editButtonList=e=>e,t.comicMap[""].getImgList=()=>g.length>0?g:(e.innerHTML='æ— æ³•è·å¾—æ¼«ç”»æ•°æ®ï¼Œè¯·é€šè¿‡ <a href="https://github.com/hymbz/ComicReadScript/issues" target="_blank">Github</a> æˆ– <a href="https://sleazyfork.org/zh-CN/scripts/374903-comicread/feedback#post-discussion" target="_blank">Greasy Fork</a> è¿›è¡Œåé¦ˆ',[])}),m("manga","commentList",await o.getViewpoint(r,s));break}}})().catch(e=>t.log.error(e));break}case"www.idmzj.com":case"www.dmzj.com":{const e=l("helper"),t=l("main"),n=l("userscript/dmzjApi"),o=e=>{if(e)return()=>{window.open(location.href.replace(/(?<=\/)\d+(?=\.html)/,`${e}`),"_self")}};(async()=>{await e.waitDom(".head_wz");const a=e.querySelector(".head_wz [id]")?.id,r=/(?<=\/)\d+(?=\.html)/.exec(location.pathname)?.[0];if(!a||!r)return;const{setState:s}=await t.useInit("dmzj");try{const{next_chap_id:e,prev_chap_id:t,page_url:i}=await n.getChapterInfo(a,r);s(n=>{n.comicMap[""].getImgList=()=>i,n.manga.onNext=o(e),n.manga.onPrev=o(t)})}catch{t.toast.error("è·å–æ¼«ç”»æ•°æ®å¤±è´¥",{duration:Number.POSITIVE_INFINITY})}})().catch(t=>e.log.error(t));break}case"exhentai.org":case"e-hentai.org":{const e=l("solid-js/web"),t=l("solid-js"),n=l("components/Manga"),o=l("helper"),a=l("main"),r=l("solid-js/store"),s=l("userscript/detectAd"),i=l("request"),c=l("userscript/ehTagRules"),d=async e=>{const t=e?`/mytags?tagset=${e}`:"/mytags",n=await a.request(t,{fetch:!0});return o.domParse(n.responseText)},p=(e,t=[])=>{const n=e.querySelector("#tagcolor").value.slice(1)||"0",[,...o]=[...e.getElementById("usertags_outer").children];for(const e of o){const o=Number(e.id.split("usertag_")[1]),a=e.querySelector(`#tagpreview_${o}`),{color:r,borderColor:s}=a.style;let[i,l]=a.title.split(":");switch(i){case"female":case"male":case"mixed":i="gender"}const c=Number.parseInt(e.querySelector(`#tagcolor_${o}`).value.slice(1)||n,16);t.push({e:e,id:o,title:a.title,color:c,fontColor:r,borderColor:s,group:i,name:l,weight:Number(e.querySelector("input[id^=tagweight_]").value),watch:e.querySelector(`#tagwatch_${o}`).checked,hidden:e.querySelector(`#taghide_${o}`).checked,order:-1})}return t},g=e=>{const t=new Intl.Collator,n=(e,n)=>e.color!==n.color?n.color-e.color:e.group!==n.group?t.compare(e.group,n.group):e.hidden!==n.hidden?e.hidden?1:-1:e.watch!==n.watch?e.watch?-1:1:e.weight!==n.weight?n.weight-e.weight:t.compare(e.name,n.name);let o=-e.length;for(const t of e.sort(n))t.order=o++;return e},m=async()=>{const e=[],t=await d();await Promise.all([...t.querySelectorAll("#tagset_outer select option")].map(async n=>{const o=n.selected?t:await d(n.value);o.querySelector("#tagset_enable")?.checked&&e.push(o)}));const n=[];for(const t of e)p(t,n);return g(n)},u=new Set,h=async()=>{const e=await m();for(const t of u)await t(e)},_=(e,t)=>`\n${[...e].map(e=>`${t}${CSS.escape(e)}`).join(",\n")}\n`,f=async e=>{const t={},n={},o={};for(const a of e){const{color:e,borderColor:r,fontColor:s}=a,i=a.title.replaceAll(" ","_");(t[e]||=new Set).add(i),(n[r]||=new Set).add(i),(o[s]||=new Set).add(i)}let a="";for(const[e,n]of Object.entries(t))a+=`:is(${_(n,"#td_")})`,a+=`{ background: #${Number(e).toString(16).padStart(6,"0")}; }\n\n`;for(const[e,t]of Object.entries(n))a+=`:is(${_(t,"#td_")}).gt`,a+=`{ border-color: ${e}; }\n\n`;for(const[e,t]of Object.entries(o))a+=`:is(${_(t,"#td_")}):not(.gt)`,a+=`{ border-color: ${e}; }\n\n`,a+=`#taglist a:is(${_(t,"#ta_")})`,a+=`{ color: ${e} !important; position: relative; }\n\n`;return a+='\n    /* ç¦ç”¨ eh çš„å˜è‰²æ•ˆæœï¼Œå¿…é¡»ä½¿ç”¨ !important */\n    #taglist a[id] { color: var(--tag) !important; position: relative; }\n    #taglist a[id]:hover { color: var(--tag-hover) !important; }\n\n    #taglist a[id]::after {\n      content: "";\n      background: var(--color);\n      width: 100%;\n      position: absolute;\n      left: 0;\n      height: 2px;\n      bottom: -7px;\n    }\n    .tup { --color: var(--tup) }\n    .tdn { --color: var(--tdn) }\n    #taglist a[id][style="color: blue;"] { --color: blue; }\n\n    /* é¿å…è¢«ä¸Šä¸€è¡Œçš„ä¸‹åˆ’çº¿ç¢°åˆ° */\n    #taglist div:is(.gt, .gtl, .gtw) { margin-top: 1px; }\n  ',await GM.setValue("ehTagColorizeCss",a),a},b=async e=>{switch(u.add(f),e){case"gallery":{let e="https://exhentai.org"===location.origin?"--tag: #DDDDDD; --tag-hover: #EEEEEE; --tup: #00E639; --tdn: #FF3333;":"--tag: #5C0D11; --tag-hover: #8F4701; --tup: green; --tdn: red;";return e=`#taglist { ${e} }\n\n`,e+=await o.getGmValue("ehTagColorizeCss",h),o.useStyle(e)}case"mytags":h(),o.hijackFn("usertag_callback",o.debounce(h))}},w={cross_site_link:!0,add_hotkeys_actions:!0,detect_ad:!0,quick_favorite:!0,colorize_tag:!1,quick_rating:!0,quick_tag_define:!0,float_tag_list:!1,auto_adjust_option:!1,tag_lint:!1,expand_tag_list:!0,autoShow:!1},y=async()=>{let n;if(n=Reflect.has(unsafeWindow,"display_comment_field")?"gallery":"/mytags"===location.pathname?"mytags":Reflect.has(unsafeWindow,"mpvkey")?"mpv":o.querySelector('option[value="t"]')?.parentElement?.value,!n)return;const r=await a.useInit("ehentai",w);if("gallery"!==n)return{type:n,...r};let s=0;if(s=Number(o.querySelector(".gtb .gpc")?.textContent?.replaceAll(",","").match(/\d+/g)?.at(-1)),Number.isNaN(s)){const{responseText:e}=await a.request(location.href);s=Number(/(?<=class="gdt2">)\d+(?= pages<\/td>)/.exec(e)?.[0])}const i=o.querySelector("#newtagfield");return i?.addEventListener("keydown",e=>"Escape"===e.key&&i.blur()),{type:"gallery",...r,galleryId:Number(location.pathname.split("/")[2]),galleryTitle:o.querySelector("#gn")?.textContent||void 0,japanTitle:o.querySelector("#gj")?.textContent||void 0,imgNum:s,imgList:o.range(s,""),pageList:[],fileNameList:[],LoadButton(n){const o=t.createMemo(()=>{const e=r.store.comicMap[n.id]?.imgList;if(0===e?.length)return` loading - 0/${s}`;const t=e?.filter(Boolean).length;switch(e?.length){case void 0:return" Load comic";case t:return" Read";default:return` loading - ${t}/${s}`}});return(a=e.template("<a href=javascript:;>")()).$$click=async e=>{await(n.onClick?.(e)),r.showComic(n.id)},e.insert(a,o),a;var a},dom:{newTagField:i}}};e.delegateEvents(["click"]);const v=new Map(["å…³é—­æ˜¾ç¤ºæ ‡ç­¾å®šä¹‰","å–æ¶ˆé€‰ä¸­å½“å‰æ ‡ç­¾","å…³é—­æµ®åŠ¨æ ‡ç­¾æ "].map(e=>[e,()=>!0])),x=()=>{const e=new Set,t=new Set;for(const n of o.querySelectorAll("#taglist table [id^=td_]")){const[o]=n.getElementsByTagName("a");o.classList.contains("tdn")||(o.classList.contains("tup")||n.classList.contains("gt")?e.add(n.id.slice(3)):n.classList.contains("gtl")&&t.add(n.id.slice(3)))}return[e,t]},$=e=>{const[t,n]=e.trim().split(":");return n?[t,n.replaceAll(/[^a-z-_ ]/gi,"")]:["",""]},S=[["artist","a"],["character","c","char"],["cosplayer","c","os"],["female","f"],["group","g","circle"],["language","l","lang"],["male","m"],["mixed","x"],["other","o"],["parody","p","series"],["reclass","r"]],k=e=>{const[t,n]=$(e);for(const e of S)if(e.includes(t))return`${e[0]}:${n}`;return e},I={Western:"ta",Misc:"t1",Doujinshi:"t2",Manga:"t3","Artist CG":"t4","Game CG":"t5","Image Set":"t6",Cosplay:"t7","Asian Porn":"t8","Non-H":"t9"},M=(...e)=>Boolean(o.querySelector(`#gdc > .cs:is(${e.map(e=>`.c${I[e]}`).join(", ")})`)),C=(e,t,n)=>{const o=new URL(e.pageList[t]);o.searchParams.set("nl",n),e.pageList[t]=o.href},L=async({setState:e,galleryTitle:t})=>{const{response:{result:n}}=await a.request(`https://nhentai.net/api/galleries/search?query=${t}`,{responseType:"json",errorText:o.t("site.ehentai.nhentai_error"),noTip:!0,headers:{"User-Agent":navigator.userAgent},fetch:!1});return n.map(({id:t,title:n,images:r,num_pages:s,media_id:i})=>{const l=`@nh:${t}`;return e("comicMap",l,{getImgList:({dynamicLazyLoad:e})=>e({loadImg:e=>(async(e,t,n)=>{const r=await a.request(`https://i.nhentai.net/galleries/${t}/${e+1}.${o.fileType[n]}`,{headers:{Referer:`https://nhentai.net/g/${t}`},responseType:"blob",fetch:!1});return URL.createObjectURL(r.response)})(e,i,r.pages[e].t),length:s,id:l})}),{id:l,showText:`${t}`,title:n.english||n.japanese,href:`https://nhentai.net/g/${t}`,class:"gtl"}})};L.errorTip=e=>o.t("site.ehentai.nhentai_failed",{nhentai:`<a href='https://nhentai.net/search/?q=${e.galleryTitle}' target="_blank"> <u> nhentai </u> </a>`});const T=async({setState:e,galleryId:t})=>{const n="gold-usergeneratedcontent.net",r=async e=>{const n=await a.request(e,{headers:{Referer:`https://hitomi.la/reader/${t}.html`},responseType:"blob",fetch:!1});return URL.createObjectURL(n.response)},s=await a.request(`https://ltn.${n}/galleries/${t}.js`,{errorText:o.t("site.ehentai.hitomi_error"),noTip:!0,noCheckCode:!0});switch(s.status){case 404:return[];case 200:break;default:throw new Error(o.t("site.ehentai.hitomi_error"))}const i=JSON.parse(s.responseText.slice(18)),l=`@hitomi:${i.id}`;return e("comicMap",l,{getImgList:async({dynamicLazyLoad:e})=>{const{responseText:t}=await a.request(`https://ltn.${n}/gg.js?_=${Date.now()}`,{errorText:o.t("site.ehentai.hitomi_error"),noTip:!0});let s={};return eval(t),e({loadImg:async e=>{const{hash:t,name:o}=i.files[e],a=s.s(t),l=/[\da-f]{61}([\da-f]{2})([\da-f])/.exec(t),c=Number.parseInt(l[2]+l[1],16),d=`https://w${s.m(c)+1}.${n}/${s.b}${a}/${t}.webp`;return{src:await r(d),name:o}},length:i.files.length,id:l,concurrency:1})}}),[{id:l,showText:i.id,title:i.title,href:`https://hitomi.la/galleries/${i.id}`,class:"gt"}]};T.errorTip=()=>o.t("site.ehentai.hitomi_error");const P=async n=>{if(!n.galleryTitle)return a.toast.error(o.t("site.ehentai.html_changed_link_failed"));const s=[];if(M("Doujinshi","Manga","Artist CG","Game CG","Image Set")&&s.push(T),M("Doujinshi","Manga")&&s.push(L),0===s.length)return;const[i,l]=r.createStore({}),c=t=>{return n=e.template("<div><a>")(),o=n.firstChild,e.setStyleProperty(n,"opacity","1.0"),e.effect(a=>{var r=`td_${t.id}`,s=t.class,i=t.title,l=t.id,c=t.href,d=`return toggle_tagmenu(1, '${t.id}',this)`,p=t.title,g=t.showText;return r!==a.e&&e.setAttribute(n,"id",a.e=r),s!==a.t&&e.className(n,a.t=s),i!==a.a&&e.setAttribute(n,"title",a.a=i),l!==a.o&&e.setAttribute(o,"id",a.o=l),c!==a.i&&e.setAttribute(o,"href",a.i=c),d!==a.n&&e.setAttribute(o,"onclick",a.n=d),p!==a.s&&e.setAttribute(o,"title",a.s=p),g!==a.h&&(o.innerText=a.h=g),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),n;var n,o},d=()=>e.render(()=>e.createComponent(t.For,{get each(){return Object.entries(i)},children:([n,o])=>{return s=(r=(a=e.template("<tr><td class=tc>:")()).firstChild).firstChild,e.setAttribute(a,"id",`${n}_tagline`),e.insert(r,n,s),e.insert(a,e.createComponent(t.Show,{when:"string"!=typeof o,get fallback(){return(t=e.template("<td class=tc style=text-align:left>")()).innerHTML=o,t;var t},get children(){var n=e.template("<td>")();return e.insert(n,e.createComponent(t.For,{each:o,children:c})),n}}),null),a;var a,r,s}}),o.querySelector("#taglist tbody"));d(),o.hijackFn("tag_update_vote",()=>{for(const e of o.querySelectorAll("#nh_tagline"))e.remove();d()});const p=n=>e.createComponent(t.For,{get each(){return n.children},children:t=>[e.template('<img src=https://ehgt.org/g/mr.gif class=mr alt=">">')(),t]}),g=document.getElementById("tagmenu_act");let m;o.hijackFn("_refresh_tagmenu_act",(t,[o])=>{if(m?.(),!o.id.startsWith("@"))return t(o);g.children.length>0&&(g.innerHTML=""),m=e.render(()=>e.createComponent(p,{get children(){return[(t=e.template("<a target=_blank>")(),t.innerText=" Jump",e.effect(()=>e.setAttribute(t,"href",o.href)),t),e.createComponent(n.LoadButton,{get id(){return o.id}})];var t}}),g)});for(const e of s){l(e.name,"searching...");try{const t=await e(n);t.length>0?l(e.name,t):l(e.name,"null")}catch(t){const o=e.errorTip(n);console.error(o,t),l(e.name,o)}}const{adList:u}=n.store.comicMap[""];if(u)for(const e of Object.values(i))"string"!=typeof e&&1===e.length&&n.setState("comicMap",e[0].id,{adList:u})},A=({store:{comicMap:e},setState:t,options:n,imgList:r,pageList:i,fileNameList:l})=>{if(!n.detect_ad||!document.getElementById("ta_other:extraneous_ads"))return;t("comicMap","","adList",new a.ReactiveSet);const c=[];for(const e of o.querySelectorAll("#gdt > a")){const t=Number(/.+-(\d+)/.exec(e.href)?.[1])-1;if(Number.isNaN(t))continue;i[t]=e.href;const n=e.querySelector("[title]");[,l[t]]=n.title.split(/ï¼š|: /),c[t]="IMG"===n.tagName?n:/url\("(.+)"\)/.exec(n.style.backgroundImage)[1]}return(async()=>{await s.getAdPageByFileName(l,e[""].adList),0===e[""].adList.size&&await s.getAdPageByContent(c,e[""].adList),o.useStyle(o.createRootMemo(()=>e[""]?.adList?.size?[...e[""].adList].map(e=>`a[href="${i[e]}"] [title]:not(:hover) {\n              filter: blur(8px);\n              clip-path: border-box;\n              backdrop-filter: blur(8px);\n            }`).join("\n"):""))})(),{checkFileName:()=>s.getAdPageByFileName(l,e[""].adList),checkContent:()=>s.getAdPageByContent(r,e[""].adList)}},E=e=>{if("t"!==e.type)return;o.useStyle(`\n    #taglist {\n      height: auto;\n      max-height: 230px;\n      padding: 0 3px;\n\n      --scrollbar-slider: ${getComputedStyle(o.querySelector(".ido")).backgroundColor};\n      scrollbar-color: var(--scrollbar-slider) transparent;\n      scrollbar-width: thin;\n      &::-webkit-scrollbar { width: 5px; height: 10px; }\n      &::-webkit-scrollbar-track { background: transparent; }\n      &::-webkit-scrollbar-thumb { background: var(--scrollbar-slider); }\n    }\n    .gl1t[data-tag-list-loading], .gl1t[data-tag-list-loading] * { cursor: progress; }\n    .gl1t[data-show-tag-list] .gl6t { display: none; }\n    .gl1t:not([data-show-tag-list]) #taglist { display: none; }\n\n    /* é•¿æ ‡ç­¾æ¢è¡Œ */\n    #taglist [id^=td_] a[id^=ta_] {\n      text-wrap: balance;\n      word-break: keep-all;\n      overflow-wrap: anywhere;\n    }\n  `);const r=new Map,s=async e=>{if("progress"!==e.style.cursor){if(!r.has(e)){let t,n=null;try{e.dataset.tagListLoading="";const r=await a.request(e.querySelector("a").href,{noTip:!0,errorText:"Fetch tag list error",noCheckCode:!0});if(t=o.domParse(r.responseText),n=t.querySelector("#taglist"),!n)throw new Error("Fetch tag list error");const[,s]=t.querySelector("#gdt div[title][style]").style.background.split('"');(new Image).src=s;for(const e of n.querySelectorAll("a"))e.target="_blank"}catch{n=document.createElement("div"),n.id="taglist",n.textContent=t?.querySelector(".d p")?.textContent||"Fetch tag list error"}e.querySelector(".gl3t").after(n),r.set(e,n),Reflect.deleteProperty(e.dataset,"tagListLoading")}Reflect.has(e.dataset,"showTagList")?Reflect.deleteProperty(e.dataset,"showTagList"):e.dataset.showTagList=""}};for(const e of o.querySelectorAll(".gl1t"))e.addEventListener("click",t=>t.target.matches(":not(a):is(.gl1t, .gl6t, .gl6t *, #taglist, #taglist *)")&&s(e));n.setDefaultHotkeys(e=>({...e,float_tag_list:["q"]}));const[i,l]=t.createSignal([0,0]);document.addEventListener("pointermove",e=>l([e.clientX,e.clientY])),n.listenHotkey({float_tag_list:()=>{for(const e of document.elementsFromPoint(...i()))if(e.matches(".gl1t"))return s(e)}}),b("gallery")},N='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" fill="currentColor" stroke-width="0"><path d="M18 7h-6c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V8c0-.55-.45-1-1-1m3-4H3c-1.1 0-2 .9-2 2v14c0 1.1.9 1.98 2 1.98h18c1.1 0 2-.88 2-1.98V5c0-1.1-.9-2-2-2m-1 16.01H4c-.55 0-1-.45-1-1V5.98c0-.55.45-1 1-1h16c.55 0 1 .45 1 1v12.03c0 .55-.45 1-1 1"/></svg>',R=e=>{const t=e.getBoundingClientRect(),n=getComputedStyle(e),o=Number.parseFloat(n.borderLeftWidth),a=Number.parseFloat(n.paddingLeft),r=Number.parseFloat(n.paddingTop),s=Number.parseFloat(n.borderTopWidth);return{left:t.left+o+a,top:t.top+s+r,width:n.width,height:n.height}},D=({store:{manga:e},dom:{newTagField:t}})=>{const a=o.querySelector("#gd4"),r=getComputedStyle(a);let s="rgba(0, 0, 0, 0)",i=a;for(;"rgba(0, 0, 0, 0)"===s;)s=getComputedStyle(i).backgroundColor,i=i.parentElement;const{borderColor:l}=getComputedStyle(o.querySelector("#gdt")),c=`1px solid ${l}`;o.useStyle(`\n      #comicread-tag-box {\n        position: fixed;\n        z-index: 2147483647;\n\n        font-size: 12px;\n        text-align: justify;\n\n        background: ${s};\n        box-shadow: 0 0 15px -3px #0004;\n      }\n\n      #comicread-tag-box > #gd4 {\n        margin: 0;\n        padding: 0;\n        border: none;\n      }\n\n      #comicread-tag-box > #ehs-introduce-box {\n        position: relative;\n        width: 161px;\n        height: 100%;\n        border-left: ${c};\n      }\n\n      /* ç¡®ä¿å§‹ç»ˆæ˜¾ç¤ºåœ¨æœ€ä¸Šå±‚ï¼Œé˜²æ­¢å’Œå…¶ä»–è„šæœ¬å†²çª */\n      #ehs-introduce-box { z-index: 1; }\n\n      #comicread-tag-box-placeholder {\n        cursor: pointer;\n\n        float: left;\n        display: flex;\n        grid-area: gd4;\n        justify-content: center;\n\n        margin: 0 0 0 10px;\n        padding: 0 0 0 5px;\n\n        border-right: 1px solid ${l};\n        border-left: 1px solid ${l};\n      }\n\n      #comicread-tag-box-placeholder svg {\n        width: 17em;\n        opacity: 0.5;\n      }\n\n      /* é˜²æ­¢åœ¨çª—å£å˜å°æ—¶ç¡®è®¤æŒ‰é’®è¢«æŒ¤å‡ºèŒƒå›´ */\n      #tagmenu_new {\n        width: fit-content;\n      }\n    `);const{store:d,setState:p}=o.useStore({open:!1,top:0,left:0,opacity:1,mouse:{x:0,y:0},bound:{width:0,height:0}}),g=(e,t,n)=>{e.top=o.clamp(.75*-a.clientHeight,t,e.bound.height),e.left=o.clamp(.75*-a.clientWidth,n,e.bound.width)},m=e=>p("opacity",o.clamp(.5,e,1));m(Number(localStorage.getItem("floatTagListOpacity"))||1),document.addEventListener("pointermove",e=>{p(t=>{t.mouse.x=e.clientX,t.mouse.y=e.clientY})});const u=()=>{p(e=>{e.bound.width=window.innerWidth-a.clientWidth/4,e.bound.height=window.innerHeight-a.clientHeight/4,g(e,e.top,e.left)})};window.addEventListener("resize",u),u(),o.useStyleMemo("#comicread-tag-box",{display:()=>d.open?void 0:"none",top:()=>`${d.top}px`,left:()=>`${d.left}px`,opacity:()=>d.opacity});const h=a.cloneNode();h.id="comicread-tag-box-placeholder",h.style.display="none",h.addEventListener("click",()=>p("open",!1)),h.innerHTML=N,a.before(h);const _=document.createElement("div");_.id="comicread-tag-box",_.classList.add("comicread-ignore"),document.body.append(_),_.addEventListener("wheel",e=>{e.shiftKey&&(e.stopPropagation(),e.preventDefault(),m(d.opacity+(e.deltaY>0?-.05:.05)),localStorage.setItem("floatTagListOpacity",`${d.opacity}`))},{passive:!1});const f={top:0,left:0};let b,w;o.useDrag({ref:a,handleDrag({type:t,xy:[n,r],initial:[s,i]}){switch(t){case"down":if(!d.open){const e=R(a);p(t=>{t.top=e.top,t.left=e.left})}f.top=d.top,f.left=d.left;break;case"up":p(t=>{if(e.show)return;const n=h.getBoundingClientRect();o.approx(t.top,n.top,50)&&o.approx(t.left,n.left,50)&&(t.open=!1)});break;case"move":p(e=>{g(e,f.top+r-i,f.left+n-s),e.open=!0})}},handleClick:(e,t)=>t.click(),skip:e=>!e.target.matches("#gd4, #taglist, #gwrd, td+td, [id^=comidread] *:not(a)")}),o.createEffectOn(()=>d.open,e=>{if((()=>{if(b)return;if(b=o.querySelector("#ehs-introduce-box"),!b)return;w=b.parentElement;const e=o.querySelector(".eh-syringe-lite-auto-complete-list");e&&(e.classList.add("comicread-ignore"),e.style.zIndex="2147483647",document.body.append(e)),o.hijackFn("toggle_tagmenu",()=>unsafeWindow.selected_tagname||o.querySelector("#ehs-introduce-box .ehs-close")?.click())})(),e){const{height:e,width:t}=r;h.style.cssText=`height: ${e}; width: ${t};`,_.style.height=e,a.style.width=t,_.append(a),b&&_.append(b),document.activeElement.blur()}else h.style.cssText="display: none;",a.style.width="",h.after(a),b&&w.append(b),n.focus()},{defer:!0}),n.setDefaultHotkeys(e=>({...e,float_tag_list:["q"]})),v.set("å…³é—­æµ®åŠ¨æ ‡ç­¾æ ",()=>!d.open||p("open",!1)),n.listenHotkey({float_tag_list:()=>{p(e=>{e.open=!e.open,e.open&&g(e,e.mouse.y-a.clientHeight/2,e.mouse.x-a.clientWidth/2)})}}),o.hijackFn("tag_from_field",(e,t)=>(d.open&&document.activeElement.blur(),e(...t))),t.addEventListener("pointerenter",()=>d.open&&t.focus());const y=e=>{const n=(e=>{const t=o.querySelector(`a[href=${CSS.escape(e)}]`);if(t)return t.title||t.id.slice(3).replaceAll("_"," ")})(e.dataTransfer.getData("text"));n&&(e.preventDefault(),t.value.includes(n)||(t.value+=`${n}, `),t.dispatchEvent(new Event("input")))};t.addEventListener("drop",y);const x=o.querySelector("#taglist");x.addEventListener("dragover",e=>e.preventDefault()),x.addEventListener("dragenter",e=>e.preventDefault()),x.addEventListener("drop",y)},O=async(e,t)=>{const n=await i.request("/api.php",{fetch:!1,method:"POST",responseType:"json",cookie:document.cookie,data:JSON.stringify(e),...t});if(n.response.error)throw o.log.error(n.response.error),new Error(n.response.error);return n.response},z=async(e,t,n)=>{const o=e.pageList[t],[,a,r,s,i]=/\/s\/(\S+)\/(\d+)-(\d+)(?=$|\?nl=(\d+))/.exec(o),l={gid:r,page:s,imgkey:a};if(i&&(l.nl=i),e.mpvkey){const o=await O({method:"imagedispatch",...l,mpvkey:e.mpvkey},{noTip:!0});return n&&C(e,t,o.s),o.i}const c=await O({method:"showpage",...l,showkey:e.showkey},{noTip:!0});return n&&C(e,t,/nl\('(\d+-\d+)'\)/.exec(c.i3)[1]),/src="(\S+)"/.exec(c.i3)[1]},q=async(e,t)=>{if(e.showkey)return;const n=await i.request(t,{fetch:!0},10),[,o]=/showkey="(\S+)"/.exec(n.responseText);e.showkey=o},B=async e=>{if(e.mpvkey)return;const t=`${location.origin}${location.pathname}`.replace("/g/","/mpv/");if(!o.querySelector(`.g2 a[href="${t}"]`))return;const n=await i.request(t,{fetch:!0}),a=/mpvkey = "(\S+)"/.exec(n.responseText);if(!a)return;const[,r]=a;e.mpvkey=r},j=e=>{e.options.add_hotkeys_actions&&("gallery"===e.type?(v.set("å–æ¶ˆé€‰ä¸­å½“å‰æ ‡ç­¾",()=>!unsafeWindow.selected_tagname||unsafeWindow.toggle_tagmenu()),n.listenHotkey({ArrowUp:()=>unsafeWindow.selected_tagid&&unsafeWindow?.tag_vote_up(),ArrowDown:()=>unsafeWindow.selected_tagid&&unsafeWindow?.tag_vote_down(),scroll_right:()=>o.querySelector(".ptt td:last-child:not(.ptdd)")?.click(),scroll_left:()=>o.querySelector(".ptt td:first-child:not(.ptdd)")?.click()})):n.listenHotkey({scroll_right:()=>o.querySelector("#unext")?.click(),scroll_left:()=>o.querySelector("#uprev")?.click()}))},F='\n  .comidread-favorites {\n    position: absolute;\n    z-index: 75;\n    left: 0;\n\n    overflow: auto;\n    align-content: center;\n\n    box-sizing: border-box;\n    width: 100%;\n    padding-left: 0.6em;\n\n    border: none;\n    border-radius: 0;\n  }\n\n  .comidread-favorites-item {\n    cursor: pointer;\n\n    display: flex;\n    align-items: center;\n\n    width: 100%;\n    margin: 1em 0;\n\n    text-align: left;\n    overflow-wrap: anywhere;\n  }\n\n  .comidread-favorites-item > input {\n    pointer-events: none;\n    margin: 0 0.5em 0 0;\n  }\n\n  .comidread-favorites-item > div {\n    flex-shrink: 0;\n\n    width: 15px;\n    height: 15px;\n    margin: 0 0.5em 0 0;\n\n    background-image: url("https://ehgt.org/g/fav.png");\n    background-repeat: no-repeat;\n  }\n\n  .gl1t > .comidread-favorites {\n    padding: 1em 1.5em;\n  }\n',U=(n,r,s,i,l=0)=>{r.style.position="relative";const[c,d]=t.createSignal(!1),[p,g]=t.createSignal([]),[m,u]=t.createSignal(""),h=async()=>{try{const e=await a.request(s,{errorText:o.t("site.ehentai.fetch_favorite_failed")}),t=o.domParse(e.responseText),n=[...t.querySelectorAll(".nosel > div")];10===n.length&&(n[0].querySelector("input").checked=!1),u(t.querySelector('#galpop textarea[name="favnote"]')?.value??""),g(n)}catch{a.toast.error(o.t("site.ehentai.fetch_favorite_failed")),g([])}};let _=!1;const f=()=>{if(_)return;_=!0;const n=(n,r)=>{const{checked:i}=n.querySelector("input"),l=async()=>{if(i)return;d(!1);const e=new FormData;e.append("favcat",10===r()?"favdel":`${r()}`),e.append("apply","Apply Changes"),e.append("favnote",m()),e.append("update","1");const t=await a.request(s,{method:"POST",data:e,errorText:o.t("site.ehentai.change_favorite_failed")});a.toast.success(o.t("site.ehentai.change_favorite_success"));const n=/\nif\(window.opener.document.+\n/.exec(t.responseText)?.[0]?.replaceAll("window.opener.document","window.document");n&&eval(n),await h()};return c=e.template("<div class=comidread-favorites-item><input type=radio>")(),p=c.firstChild,c.$$click=l,p.checked=i,e.insert(c,e.createComponent(t.Show,{get when(){return r()<=9},get children(){var t=e.template("<div>")();return e.effect(()=>e.setStyleProperty(t,"background-position",`0px -${2+19*r()}px`)),t}}),null),e.insert(c,()=>n.textContent?.trim(),null),c;var c,p};let g="rgba(0, 0, 0, 0)",u=r;for(;"rgba(0, 0, 0, 0)"===g;)g=getComputedStyle(u).backgroundColor,u=u.parentElement;e.render(()=>e.createComponent(t.Show,{get when(){return c()},get children(){var o=e.template("<span class=comidread-favorites>")();return e.setStyleProperty(o,"background",g),e.setStyleProperty(o,"height",`${i}px`),e.setStyleProperty(o,"top",`${l}px`),e.insert(o,e.createComponent(t.For,{get each(){return p()},children:n,get fallback(){return e.template("<h3>loading...")()}})),o}}),r)},b=n.onclick;n.onclick=null,n.addEventListener("mousedown",async e=>{if(1===e.buttons||4===e.buttons){if(e.stopPropagation(),e.preventDefault(),e.shiftKey||e.ctrlKey||e.altKey||e.metaKey||4===e.buttons)return b.call(n,e);f(),d(e=>!e),c()&&await h()}})},W=e=>{switch(e.type){case"gallery":{o.useStyle(F);const e=o.querySelector("#gdf"),t=o.querySelector("#gd3"),n=e.firstElementChild.offsetTop;U(e,t,`${unsafeWindow.popbase}addfav`,n);break}case"t":o.useStyle(F);for(const e of o.querySelectorAll(".gl1t")){const t=e.querySelector("[id^=posted_]"),n=e.firstElementChild.getBoundingClientRect().bottom-e.getBoundingClientRect().top,o=e.lastElementChild.getBoundingClientRect().top-e.getBoundingClientRect().top,[a]=/http.+?(?=')/.exec(t.getAttribute("onclick"));U(t,e,a,o-n,n)}break;case"e":o.useStyle(F);for(const e of o.querySelectorAll(".gl1e")){const t=e.nextElementSibling.querySelector("[id^=posted_]"),n=Number.parseInt(getComputedStyle(e).height,10),[o]=/http.+?(?=')/.exec(t.getAttribute("onclick"));U(t,e,o,n)}}};e.delegateEvents(["click"]);const H=n=>{let r;switch(n.type){case"e":r=o.querySelectorAll("#favform > table > tbody > tr");break;case"m":case"p":case"l":r=o.querySelectorAll("#favform > table > tbody > tr").slice(1);break;case"t":r=o.querySelectorAll(".gl1t");break;default:return}o.useStyle("\n    .comidread-quick-rating {\n      position: absolute;\n      width: 100%;\n      height: 100%;\n      pointer-events: click;\n    }\n  ");const s=["0,0,7,16","8,0,15,16","16,0,23,16","24,0,31,16","32,0,39,16","40,0,47,16","48,0,55,16","56,0,63,16","64,0,71,16","72,0,79,16"],i=(e,t)=>{let n=Math.round(t+1);const o=16*Math.ceil(n/2)-80;n=n%2==1?-21:-1,e.style.backgroundPosition=`${o}px ${n}px`},l=(n,r,l)=>{let c=r.style.backgroundPosition;e.render(()=>{return g=(p=(d=e.template("<span class=comidread-quick-rating><img src=https://ehgt.org/g/blank.gif><map>")()).firstChild).nextSibling,d.$$mouseout=()=>{r.style.backgroundPosition=c},e.setAttribute(d,"data-index",l),e.setAttribute(p,"usemap",`#rating-${l}`),e.setAttribute(g,"name",`rating-${l}`),e.insert(g,e.createComponent(t.For,{each:s,children:(t,s)=>{return(l=e.template("<area shape=rect>")()).$$click=async()=>{const e=await(async(e,t)=>{try{const n=await a.request(e,{errorText:o.t("site.ehentai.change_rating_failed"),noTip:!0}),r=/api_url = "(.+?)";.+?gid = (\d+);.+?token = "(.+?)";.+?apiuid = (\d+);.+?apikey = "(.+?)"/s.exec(n.responseText);if(!r)throw new Error(o.t("site.ehentai.change_rating_failed"));const[,s,i,l,c,d]=r,p=await a.request(s,{method:"POST",responseType:"json",data:JSON.stringify({method:"rategallery",rating:`${t}`,apikey:d,apiuid:c,gid:i,token:l}),fetch:!0,noTip:!0});return a.toast.success(`${o.t("site.ehentai.change_rating_success")}: ${p.response.rating_usr}`),p.response}catch{throw a.toast.error(o.t("site.ehentai.change_rating_failed")),new Error(o.t("site.ehentai.change_rating_failed"))}})(n.querySelector("a").href,s()+1);r.className=e.rating_cls,i(r,2*e.rating_usr-1),c=r.style.backgroundPosition},l.$$mouseover=()=>i(r,s()),e.setAttribute(l,"coords",t),l;var l}})),d;var d,p,g},r)};for(const[e,t]of r.entries()){const n=[...t.querySelectorAll(".ir")].at(-1);n&&n.addEventListener("mouseenter",()=>l(t,n,e),{once:!0})}};e.delegateEvents(["mouseout","mouseover","click"]);const V=(t={})=>{return n=e.template('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24"stroke=currentColor fill=currentColor stroke-width=0><path d="M18 19H6c-.55 0-1-.45-1-1V6c0-.55.45-1 1-1h5c.55 0 1-.45 1-1s-.45-1-1-1H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6c0-.55-.45-1-1-1s-1 .45-1 1v5c0 .55-.45 1-1 1M14 4c0 .55.45 1 1 1h2.59l-9.13 9.13a.996.996 0 1 0 1.41 1.41L19 6.41V9c0 .55.45 1 1 1s1-.45 1-1V3h-6c-.55 0-1 .45-1 1">')(),e.spread(n,t,!0,!0),n;var n},J=()=>{const n=r.createMutable({});o.useStyle("\n    #comidread-tag-define {\n      position: absolute;\n      z-index: 1;\n      top: 0;\n      left: 0;\n      width: 100%;\n      text-align: start;\n      padding: 0 1em;\n      box-sizing: border-box;\n    }\n\n    #taglist {\n      position: relative;\n    }\n\n    #comidread-tag-define h1 {\n      border-bottom: 1px solid #a2a9b1;\n      margin: 0.4em 0;\n    }\n\n    #comidread-tag-define h1 svg {\n      height: 0.7em;\n      margin-left: 0.2em;\n    }\n\n    #comidread-tag-define ul {\n      margin: 0.3em 0 0 1.6em;\n      padding: 0;\n    }\n\n    #comidread-tag-define li {\n      margin-bottom: 0.2em;\n    }\n\n    #comidread-tag-define div a {\n      text-decoration: underline;\n    }\n\n    #comidread-tag-define dd {\n      margin-left: 1.6em;\n    }\n\n    #comidread-tag-define dl {\n      margin-top: 0.2em;\n      margin-bottom: 0.5em;\n    }\n  ");const[s,i]=t.createSignal(!1),l=o.querySelector("#taglist");let c="rgba(0, 0, 0, 0)",d=l;for(;"rgba(0, 0, 0, 0)"===c;)c=getComputedStyle(d).backgroundColor,d=d.parentElement;e.render(()=>e.createComponent(t.Show,{get when(){return s()},get children(){var t=e.template("<span id=comidread-tag-define>")();return e.setStyleProperty(t,"background",c),e.insert(t,()=>n[unsafeWindow.selected_tagname]??e.template("<h3>loading...")()),e.effect(()=>e.setStyleProperty(t,"height",`${l.scrollHeight}px`)),t}}),l),unsafeWindow.tag_define=async()=>{if(unsafeWindow.selected_tagname){if(s())return i(!1);i(!0);try{await(async t=>{var r,s,i;if(Reflect.has(n,t))return;const l=`https://ehwiki.org/wiki/${t.replaceAll(/[a-z]+:\s?/gi,"")}`,c=await a.request(l,{noCheckCode:!0});if(200!==c.status)return void(n[t]=(r=e.template("<h3>")(),e.insert(r,()=>`${c.status} - ${c.statusText}`),r));const d=o.domParse(c.responseText).querySelector("#mw-content-text");for(const e of d.querySelectorAll('img[src^="/"]'))e.setAttribute("src",`https://ehwiki.org${e.getAttribute("src")}`);for(const e of d.getElementsByTagName("a")){const t=e.getAttribute("href")??"";t.startsWith("/")&&e.setAttribute("href",`https://ehwiki.org${t}`),e.target="_blank"}for(const e of d.querySelectorAll(".thumb"))e.remove();n[t]=[(s=e.template("<h1><a target=_blank>")(),i=s.firstChild,e.setAttribute(i,"href",l),e.insert(i,t,null),e.insert(i,e.createComponent(V,{}),null),s),d]})(unsafeWindow.selected_tagname)}catch(e){console.error(e),i(!1)}}},o.hijackFn("toggle_tagmenu",()=>i(!1)),v.set("å…³é—­æ˜¾ç¤ºæ ‡ç­¾å®šä¹‰",()=>!s()||i(!1))},G=e=>{let t="tr a :is(.gltm, .glink + div:not([class])) { display: flex; }";for(const{title:n,order:o}of e)t+=`\n.gt[title="${n}"] { order: ${o}; }`;return GM.setValue("ehTagSortCss",t)},Y=async e=>{switch(u.add(G),e.type){case"p":case"l":case"t":return o.useStyle(await o.getGmValue("ehTagSortCss",h));case"mytags":{let e;const t=t=>{let n=`\n          #usertags_outer { display: flex; flex-direction: column; }\n          #usertags_outer > div { margin: unset; }\n          #usertag_0 { order: -${t.length}; }`;for(const{order:e,id:o}of t)n+=`\n#usertag_${o} { view-transition-name: _${o}; order: ${e}; }`;e||=GM_addElement("style",{textContent:n}),e.textContent=n};u.add(e=>{if(!document.startViewTransition)return t(e);document.startViewTransition(()=>t(e))})}}},K=({dom:{newTagField:n}})=>{const a=M("Doujinshi","Manga","Non-H"),r=c.getTagLintRules(),[s,i]=t.createSignal({});o.useStyle("\n    #comidread-tag-lint [id^=td_] {\n      display: inline-block;\n      float: none;\n    }\n  ");const l=t=>{return n=e.template("<div><a>")(),(o=n.firstChild).$$click=e=>e.preventDefault(),e.insert(o,()=>t.name),e.effect(a=>{var r,s,i=`td_${t.name}`,l=(r=t.name,void 0===(s=t.weak)?document.getElementById(`td_${r}`)?.className:s?"gtl":"gt"),c=`ta_${t.name}`,d=`https://exhentai.org/tag/${t.name.replaceAll("_","+")}`;return i!==a.e&&e.setAttribute(n,"id",a.e=i),l!==a.t&&e.className(n,a.t=l),c!==a.a&&e.setAttribute(o,"id",a.a=c),d!==a.o&&e.setAttribute(o,"href",a.o=d),a},{e:void 0,t:void 0,a:void 0,o:void 0}),n;var n,o},d=n=>{const a=c.splitTagNamespace(n.name);return e.createComponent(t.Show,{get when(){return a.length>1},get fallback(){return l(n)},get children(){var r=e.template("<span>ã€Œ<!> ã€")(),s=r.firstChild.nextSibling;return e.insert(r,e.createComponent(t.For,{each:a,children:(t,a)=>[e.memo(()=>e.memo(()=>!!a())()?` ${o.t("other.or")} `:""),e.createComponent(l,{name:t,get weak(){return n.weak}})]}),s),r}})},p=n=>{const[o,a,r]=n.text.split("[tag]");return e.createComponent(t.Show,{get when(){return n.warnList?.size},get children(){return e.createComponent(t.For,{get each(){return[...n.warnList.entries()]},children:([s,i])=>{return l=e.template("<li>")(),e.insert(l,o,null),e.insert(l,e.createComponent(d,{name:s}),null),e.insert(l,a,null),e.insert(l,e.createComponent(t.For,{each:i,children:t=>e.createComponent(d,{name:t,get weak(){return n.weak}})}),null),e.insert(l,r,null),l;var l}})}})};let g,m;const u=o.singleThreaded(()=>{const n={},[l,u]=x(),h=new Set([...l,...u]),_=(e,t,o=!1)=>{const a=r[t];if(a.has(e))for(const r of a.get(e)){if(c.hasTag(o?l:h,r)===o)continue;n[t]??=new Map([[e,[]]]);const a=n[t];a.has(e)||a.set(e,[]),a.get(e).push(r)}};for(const e of h)_(e,"prerequisite",!0),_(e,"conflict"),a&&_(e,"possibleConflict"),_(e,"combo",!0);const f=(e,t)=>{n.other??=[],n.other.push([e,t])},b=[];for(const e of u)if(/^(?:artist|group):/.test(e)){const t=o.querySelector("#gd2").textContent.toLowerCase();if(t.includes(e.replaceAll(/^(artist|group):|_/g," ").trim()))b.push(e);else{const n=document.getElementById(`ta_${e}`)?.textContent;n&&t.includes(n)&&b.push(e)}}b.length>0&&f(o.t("eh_tag_lint.correct_tag"),b),M("Doujinshi")&&c.isMissingNamespace(h,"parody")&&f(o.t("eh_tag_lint.miss_parody"),["parody:original"]),a&&c.isMissingTags(l,"female:females_only","female:futanari","female:shemale")&&c.isMissingNamespace(h,"male","mixed")&&f(o.t("eh_tag_lint.miss_female"),["female:females_only"]),i(n),g?.isConnected||(g=document.createElement("div"),g.id="comidread-tag-lint",o.querySelector("#taglist").append(g)),m?.(),m=e.render(()=>e.createComponent(t.Show,{get when(){return Object.keys(s()).length},get children(){return[e.template("<hr>")(),(n=e.template("<ul>")(),e.insert(n,e.createComponent(t.For,{get each(){return s().other},children:([n,o])=>{return a=e.template("<li>")(),e.insert(a,n,null),e.insert(a,e.createComponent(t.For,{each:o,children:t=>e.createComponent(d,{name:t,weak:!0})}),null),a;var a}}),null),e.insert(n,e.createComponent(p,{get warnList(){return s().prerequisite},get text(){return o.t("eh_tag_lint.prerequisite")},weak:!1}),null),e.insert(n,e.createComponent(p,{get warnList(){return s().conflict},get text(){return o.t("eh_tag_lint.conflict")}}),null),e.insert(n,e.createComponent(p,{get warnList(){return s().possibleConflict},get text(){return o.t("eh_tag_lint.possible_conflict")}}),null),e.insert(n,e.createComponent(p,{get warnList(){return s().combo},get text(){return o.t("eh_tag_lint.combo")},weak:!0}),null),n)];var n}}),g)});u(),o.hijackFn("tag_update_vote",u);const[h,_]=o.createEqualsSignal([]);o.useStyle(o.createRootMemo(()=>h().map(e=>`#td_${CSS.escape(e.replaceAll(" ","_"))} { box-shadow: 0px 0px 4px var(--tag); }`).join("\n")));const f=()=>_(n.value.split(",").map(e=>k(e.trim())).filter(Boolean));n.addEventListener("input",f),n.addEventListener("keydown",f),o.hijackFn("tag_update_vote",f)};e.delegateEvents(["click"]),(async()=>{const r=await y();if(!r)return;const{setState:s,options:i,setOptions:l,showComic:c}=r,d=()=>[e.createComponent(t.For,{each:["colorize_tag","float_tag_list","expand_tag_list","tag_lint","","quick_favorite","quick_rating","quick_tag_define","","cross_site_link","detect_ad","add_hotkeys_actions","auto_adjust_option"],children:a=>e.createComponent(t.Show,{when:a,get fallback(){return e.template("<hr>")()},get children(){return e.createComponent(n.SettingsItemSwitch,{get name(){return o.t(`site.add_feature.${a}`)},get value(){return i[a]},onChange:e=>l({[a]:e})})}})}),e.template("<hr>")(),e.createComponent(n.SettingBlockSubtitle,{get children(){return o.t("other.hotkeys")}}),e.createComponent(n.SettingHotkeys,{keys:["float_tag_list"]})];if(s(e=>{e.manga.editSettingList=e=>[...e,["E-Hentai",d]],e.fab.otherSpeedDial=["tag_lint","colorize_tag","cross_site_link","detect_ad"]}),"mpv"===r.type)return s("comicMap","",{getImgList({dynamicLazyLoad:e}){const t=unsafeWindow.imagelist;return e({loadImg:async e=>{const n=()=>t[e].i;for(;!n();)Reflect.has(t[e],"xhr")||(unsafeWindow.load_image(e+1),unsafeWindow.next_possible_request=0),await o.wait(n);return n()},length:t.length})}});if(n.listenHotkey({Escape:e=>{for(const t of v.values())if(!0!==t())return e.stopImmediatePropagation()}}),i.colorize_tag&&(b(r.type),Y(r)),-1!==unsafeWindow.apiuid&&i.quick_favorite&&o.requestIdleCallback(()=>W(r)),i.quick_rating&&o.requestIdleCallback(()=>H(r),1e3),i.expand_tag_list&&o.requestIdleCallback(()=>E(r),1e3),"gallery"!==r.type)return j(r);if(i.auto_adjust_option&&!M("Doujinshi","Manga","Non-H")){let e={pageNum:1,imgRecognition:{enabled:!1}};i.option&&(e=o.assign(i.option,e)),s("manga","option",e)}i.float_tag_list&&o.requestIdleCallback(()=>D(r)),i.quick_tag_define&&o.requestIdleCallback(()=>J(),1e3),i.tag_lint&&o.requestIdleCallback(()=>K(r),1e3);const p=document.getElementById("gd5");if(new ResizeObserver(()=>{Reflect.deleteProperty(p.dataset,"long");const e=o.querySelector("#gd5 p:last-of-type");e.offsetTop+e.offsetHeight>352&&(p.dataset.long="")}).observe(p),o.useStyle(`\n    #gd5[data-long] {\n      --scrollbar-slider: ${getComputedStyle(o.querySelector(".gm")).borderColor};\n      scrollbar-color: var(--scrollbar-slider) transparent;\n      scrollbar-width: thin;\n      overflow: auto;\n      max-height: 352px;\n      &::-webkit-scrollbar { width: 5px; height: 10px; }\n      &::-webkit-scrollbar-track { background: transparent; }\n      &::-webkit-scrollbar-thumb { background: var(--scrollbar-slider); }\n    }\n    /* åœ¨æ˜¾ç¤º ehs æ—¶éšè— gd5 ä¸Šçš„æ»šåŠ¨æ¡ï¼Œé¿å…åŒæ—¶æ˜¾ç¤ºä¸¤ä¸ªæ»šåŠ¨æ¡ */\n    #gd5[data-long]:has(#ehs-introduce-box .ehs-content) { overflow: hidden; }\n    #gmid #ehs-introduce-box { width: 100%; }\n\n\n    /*\n      æ¶ˆé™¤ ehs é’ˆå¯¹æŒ‰é’®å¤ªå¤šæ—¶çš„è§£å†³åŠæ³•ï¼Œç”¨è„šæœ¬çš„å¤„ç†æ–¹å¼å°±å¥½äº†ï¼Œé¿å…åœ¨æµ®åŠ¨æ ‡ç­¾æ æ—¶å¯¼è‡´æ»šåŠ¨\n      https://github.com/EhTagTranslation/EhSyringe/commit/009054cc34ee818972d2a042990bf89bdff1895a\n     */\n    body #gmid #gd5 { --ehs-gap: 1; justify-content: unset; }\n  `),i.cross_site_link&&o.requestIdleCallback(()=>P(r),1e3),Number.isNaN(r.imgNum))return a.toast.error(o.t("site.changed_load_failed"));const g=await A(r),m=e=>e.includes("IP address has been temporarily banned")&&a.toast.error(o.t("site.ehentai.ip_banned"),{throw:!0,duration:Number.POSITIVE_INFINITY}),u=async e=>{try{return await z(r,e)}catch(e){o.log.warn("getImgUrlByApi failed",e)}const t=await a.request(r.pageList[e],{fetch:!0,errorText:o.t("site.ehentai.fetch_img_page_source_failed")},10);m(t.responseText);try{return/id="img" src="(.+?)"/.exec(t.responseText)[1]}catch{throw new Error(o.t("site.ehentai.fetch_img_url_failed"))}},[h,_]=t.createSignal(`1-${r.imgNum}`),f=o.createRootMemo(()=>[...o.extractRange(h(),r.imgList.length||r.imgNum)]),w=Number(o.querySelector(".ptt td:nth-last-child(2)").textContent);s("comicMap","",{getImgList:async({dynamicLazyLoad:e})=>{if(r.pageList.length!==w){const e=await o.plimit(o.range(w,e=>()=>(async(e=0)=>{const t=await a.request(`${location.pathname}${e?`?p=${e}`:""}`,{fetch:!0,errorText:o.t("site.ehentai.fetch_img_page_url_failed")});m(t.responseText);const n=[...t.responseText.matchAll(/<a href="(.{20,50})"><(img alt=.+?|div><div |div )title=".+?: (.+?)"/g)].map(([,e,,t])=>[e,t]);if(0===n.length)throw new Error(o.t("site.ehentai.fetch_img_page_url_failed"));return n})(e)));r.pageList.length=0,r.fileNameList.length=0;for(const t of e)for(const[e,n]of t)r.pageList.push(e),r.fileNameList.push(n);g?.checkFileName()}try{await B(r),await q(r,r.pageList[0])}catch(e){o.log.warn("checkKey failed",e)}return e({loadImg:async e=>{const t=f()[e];return r.imgList[t]||=await u(t),{src:r.imgList[t],name:r.fileNameList[t]}},length:()=>f().length,onEnd:g?.checkContent})}});const x=await o.useCache({pageRange:"id"});e.render(()=>{const t=p.children[6]?.classList.contains("gsp");return n=e.template('<p class="g2 gsp"style=padding-bottom:0><img src=https://ehgt.org/g/mr.gif>')(),e.setStyleProperty(n,"padding-top",t?0:void 0),n.addEventListener("click",async e=>{if(!e.shiftKey)return;e.stopPropagation();const t=await x.get("pageRange",unsafeWindow.gid),n=prompt(o.t("other.page_range"),t?.range);n&&(await x.set("pageRange",{id:unsafeWindow.gid??r.galleryId,range:n}),_(n??`1-${r.imgNum}`),s("comicMap","","imgList",void 0),c())},!0),e.insert(n,e.createComponent(r.LoadButton,{id:""}),null),n;var n},p),j(r);const $=o.singleThreaded(async(e,t)=>{const i=r.imgList.indexOf(t);if(-1!==i){if(r.imgList[i]=await u(i),!await o.testImgUrl(r.imgList[i])&&(await(async e=>{try{return await z(r,e,!0)}catch{}const t=await a.request(r.pageList[e],{errorText:o.t("site.ehentai.fetch_img_page_source_failed")});m(t.responseText);const n=/nl\('(.+?)'\)/.exec(t.responseText)?.[1];if(!n)throw new Error(o.t("site.ehentai.fetch_img_url_failed"));C(r,e,n)})(i),r.imgList[i]=await u(i),a.toast.warn(o.t("alert.retry_get_img_url",{i:i})),!await o.testImgUrl(r.imgList[i])))return await o.sleep(500),$(t);s("comicMap","","imgList",[...r.imgList]);for(const e of n.imgList())if("error"===e.loadType)return $(e.src)}});s(e=>{e.manga.title=r.japanTitle||r.galleryTitle,e.manga.onExit=e=>{e&&o.scrollIntoView("#cdiv"),s("manga","show",!1)},e.manga.onImgError=$,e.fab.initialShow=i.autoShow})})().catch(e=>o.log.error(e));break}case"nhentai.net":{const e=l("solid-js/web"),t=l("helper"),n=l("main"),o=l("userscript/detectAd");(async()=>{const{store:a,options:r,setState:s,showComic:i}=await n.useInit("nhentai",{auto_page_turn:!0,block_totally:!0,open_link_new_page:!0,detect_ad:!0});if(Reflect.has(unsafeWindow,"gallery")){s("manga",{onExit(e){e&&t.scrollIntoView("#comment-container"),s("manga","show",!1)}});const c=unsafeWindow._n_app.options.image_cdn_urls;s("comicMap","",{getImgList:()=>_gallery.images.pages.map(({t:e,w:n,h:o},a)=>({src:`https://${c[a%c.length]}/galleries/${_gallery.media_id}/${a+1}.${t.fileType[e]}`,width:n,height:o}))}),s("fab","initialShow",r.autoShow);const d=((l=e.template('<a href=javascript:; id=comicReadMode class="btn btn-secondary"><i class="fa fa-book"></i> Read')()).$$click=()=>i(),l);return document.getElementById("download").after(d),void(r.detect_ad&&t.querySelector("#tags .tag.tag-144644")&&(s("comicMap","","adList",new n.ReactiveSet),await o.getAdPageByContent(t.querySelectorAll(".thumb-container img").map(e=>e.dataset.src),a.comicMap[""].adList),t.createEffectOn(()=>a.comicMap[""].imgList,e=>e?.length&&o.getAdPageByContent(e.map(e=>"string"==typeof e?e:e.src),a.comicMap[""].adList)),t.useStyle(()=>a.comicMap[""]?.adList?.size?[...a.comicMap[""].adList].map(e=>`\n            .thumb-container:nth-of-type(${e+1}):not(:hover) {\n              filter: blur(8px);\n              clip-path: border-box;\n            }`).join("\n"):"")))}var l;if(document.getElementsByClassName("gallery").length>0){if(r.open_link_new_page)for(const e of t.querySelectorAll('a:not([href^="javascript:"])'))e.setAttribute("target","_blank");const e=(unsafeWindow?._n_app??unsafeWindow?.n)?.options?.blacklisted_tags;if(void 0===e&&n.toast.error(t.t("site.nhentai.tag_blacklist_fetch_failed")),r.block_totally&&e?.length&&t.useStyle(".blacklisted.gallery { display: none; }"),r.auto_page_turn){let o=t.querySelector("a.next")?.href;if(!o)return;t.useStyle("\n        hr { bottom: 1px; box-sizing: border-box; margin: -1em auto 2em; }\n        hr:last-child { position: relative; animation: load .8s linear alternate infinite; }\n        hr:not(:last-child) { display: none; }\n        @keyframes load { 0% { width: 100%; } 100% { width: 0; } }\n      ");const a=new Set(e),r=document.getElementById("content"),s=()=>r.querySelector(":is(.index-container, #favcontainer):last-of-type"),i=t.singleThreaded(async()=>{if(!o)return;const e=await n.request(o,{fetch:!0,errorText:t.t("site.nhentai.fetch_next_page_failed")}),i=t.domParse(e.responseText);history.replaceState(null,"",o);const c=i.querySelector(".index-container, #favcontainer");for(const e of c.querySelectorAll(".gallery")){for(const t of e.getElementsByTagName("img"))t.setAttribute("src",t.dataset.src);e.dataset.tags.split(" ").map(Number).some(e=>a.has(e))&&e.classList.add("blacklisted")}const d=i.querySelector(".pagination");o=d.querySelector("a.next")?.href,r.append(c,d);const p=document.createElement("hr");r.append(p),l.disconnect(),l.observe(s()),o||(p.style.animationPlayState="paused")},{abandon:!0});i();const l=new IntersectionObserver(e=>e[0].isIntersecting&&i());l.observe(s()),t.querySelector("section.pagination")&&r.append(document.createElement("hr"))}}})().catch(e=>t.log.error(e)),e.delegateEvents(["click"]);break}case"yuri.website":{const e=l("helper"),t=l("main");(async()=>{const{store:n,setState:o,showComic:a,init:r}=await t.useInit("yurifans",{"è‡ªåŠ¨ç­¾åˆ°":!0});if(n.options.è‡ªåŠ¨ç­¾åˆ°&&(async()=>{if(!globalThis.b2token)return;const e=(new Date).toLocaleDateString("zh-CN");if(e!==localStorage.getItem("signDate"))try{const n=await t.request("/wp-json/b2/v1/userMission",{method:"POST",noTip:!0,headers:{Authorization:`Bearer ${b2token}`}}),o=JSON.parse(n.responseText);if(!o?.mission?.date&&Number.isNaN(Number(o)))throw new Error("ç­¾åˆ°å¤±è´¥");t.toast("è‡ªåŠ¨ç­¾åˆ°æˆåŠŸ"),localStorage.setItem("signDate",e)}catch{t.toast.error("è‡ªåŠ¨ç­¾åˆ°å¤±è´¥")}})(),await e.waitDom('a.post-list-cat-item[title="åœ¨çº¿åŒº-æ¼«ç”»"]')){if(e.querySelector(".content-hidden")){const t=e.querySelector(".content-hidden").getElementsByTagName("img");return void(await e.wait(()=>t.length,1e3)&&o("comicMap","",{getImgList:()=>[...t].map(e=>e.src)}))}if(e.querySelector(".xControl")){o("flag","needAutoShow",!1);const t=e=>{a(e),o("manga",{onPrev:Reflect.has(n.comicMap,e-1)?()=>t(e-1):void 0,onNext:Reflect.has(n.comicMap,e+1)?()=>t(e+1):void 0})};for(const[n,a]of e.querySelectorAll(".xControl > a").entries()){const e=a.parentElement.nextElementSibling;o("comicMap",n,{getImgList:()=>[...e.querySelectorAll("img")].map(e=>e.dataset.src??e.src)}),a.addEventListener("click",()=>e.style.display&&t(n))}return void r()}await e.wait(()=>e.querySelectorAll(".entry-content img").length),o("comicMap","",{getImgList:()=>e.querySelectorAll(".entry-content img").map(e=>e.dataset.src||e.src)})}})();break}case"2025copy.com":case"www.2025copy.com":case"copy20.com":case"www.copy20.com":case"mangacopy.com":case"www.mangacopy.com":{const e=l("solid-js/web"),t=l("solid-js"),n=l("helper"),o=l("main"),a=l("userscript/copyApi"),r=new class{headers={webp:"1",region:"1","User-Agent":"COPY/3.0.0",version:"2025.08.15",source:"copyApp",referer:"com.copymanga.app-3.0.0"};get=(e,t,...n)=>o.request(e,{responseType:"json",headers:this.headers,...t},...n)},s=new class{headers={"User-Agent":navigator.userAgent,referer:location.href};get=(e,t,...n)=>o.request(`https://mapi.copy20.com${e}`,{responseType:"json",headers:this.headers,fetch:!1,...t},...n)},i=e=>{let t;const o=new CSSStyleSheet;document.adoptedStyleSheets.push(o);const a=async()=>{t||(async()=>{t=document.createElement("a");const e=await n.wait(()=>n.querySelector(".table-default-right"));t.target="_blank",e.firstElementChild?.before(t);const o=document.createElement("span");o.textContent="æœ€å¾Œé–±è®€ï¼š",e.firstElementChild?.before(o)})(),t.textContent="ç²å–ä¸­",t.removeAttribute("href");const a=await s.get(`/api/v3/comic2/${e}/query?platform=3`),r=a.response?.results?.browse;if(!r)return void(t.textContent=null===r?"ç„¡":"æœªè¿”å›æ•¸æ“š");const i=r.chapter_id;i?(await o.replace(`ul a[href*="${i}"] {\n        color: #fff !important;\n        background: #1790E6;\n      }`),t.href=`${location.pathname}/chapter/${i}`,t.textContent=r.chapter_name):t.textContent="æ¥å£ç•°å¸¸"};setTimeout(a),document.addEventListener("visibilitychange",a)},c=async(o,s)=>{const{response:{results:i}}=await r.get(`/comicdetail/${o}/chapters`,{errorText:"åŠ è¼‰æ¼«ç•«ç›®éŒ„å¤±æ•—"}),l=await a.decryptData(i);n.log(l);const{build:{type:c},groups:d}=l,p=a=>{const r=Object.fromEntries(c.map(({id:e})=>[e,[]]));for(const e of a.chapters)r[e.type].push(e);switch(s){case"mobile":for(const e of n.querySelectorAll(".van-divider"))e.remove();return h=e.template('<div class="detailsTextContentTabs van-tabs van-tabs--line">')(),e.insert(h,e.createComponent(t.For,{each:c,children:({id:n,name:s})=>e.createComponent(t.Show,{get when(){return r[n].length},get children(){return[(c=e.template('<div class=van-tabs__wrap><div role=tablist class="van-tabs__nav van-tabs__nav--line"><div role=tab class="van-tab van-tab--active"><span class="van-tab__text van-tab__text--ellipsis"><span></span></span></div><div class=van-tabs__line style=transition-duration:0.3s>')(),d=c.firstChild,p=d.firstChild,g=p.firstChild.firstChild,m=p.nextSibling,e.setStyleProperty(d,"background","transparent"),e.insert(g,s),e.setStyleProperty(m,"width","0.24rem"),e.setStyleProperty(m,"transform","translateX(187.5px) translateX(-50%)"),c),(i=e.template('<div class=van-tab__pane><div class="chapterList van-grid"style=padding-left:0.24rem>')(),l=i.firstChild,e.insert(l,e.createComponent(t.For,{get each(){return r[n]},children:t=>{return n=e.template('<div class="chapterItem oneLines van-grid-item"style=flex-basis:25%;padding-right:0.24rem;margin-top:0.24rem><a class="van-grid-item__content van-grid-item__content--center"><span class=van-grid-item__text>')(),s=(r=n.firstChild).firstChild,e.insert(s,()=>t.name),e.effect(s=>{var i=!(a.last_chapter.uuid!==t.id),l=`/comic/${o}/chapter/${t.id}`;return i!==s.e&&n.classList.toggle("red",s.e=i),l!==s.t&&e.setAttribute(r,"href",s.t=l),s},{e:void 0,t:void 0}),n;var n,r,s}})),i)];var i,l,c,d,p,g,m}})})),h;case"web":return[(u=e.template("<span>")(),e.insert(u,()=>a.name),u),(i=e.template('<div class=table-default><div class=table-default-title><ul class="nav nav-tabs"role=tablist></ul><div class=table-default-right><span>æ›´æ–°å…§å®¹ï¼š</span><a target=_blank></a><span>æ›´æ–°æ™‚é–“ï¼š</span><span></span></div></div><div class=table-default-box><div class=tab-content>')(),l=i.firstChild,d=l.firstChild,p=d.nextSibling.firstChild.nextSibling,g=p.nextSibling.nextSibling,m=l.nextSibling.firstChild,e.insert(d,e.createComponent(t.For,{each:c,children:({id:t,name:n})=>{return o=e.template("<li class=nav-item><a class=nav-link data-toggle=tab role=tab aria-selected=false>")(),s=o.firstChild,e.insert(s,n),e.effect(o=>{var i=!(0!==r[t].length),l=`#${a.path_word}${n}`;return i!==o.e&&s.classList.toggle("disabled",o.e=i),l!==o.t&&e.setAttribute(s,"href",o.t=l),o},{e:void 0,t:void 0}),o;var o,s}})),e.insert(p,()=>a.last_chapter.name),e.insert(g,()=>a.last_chapter.datetime_created),e.insert(m,e.createComponent(t.For,{each:c,children:({id:n,name:s})=>{return l=(i=e.template('<div role=tabpanel class="tab-pane fade"><ul>')()).firstChild,e.insert(l,e.createComponent(t.For,{get each(){return r[n]},children:t=>{return a=(n=e.template("<a target=_blank><li>")()).firstChild,e.setStyleProperty(n,"display","block"),e.insert(a,()=>t.name),e.effect(a=>{var r=`/comic/${o}/chapter/${t.id}`,s=t.name;return r!==a.e&&e.setAttribute(n,"href",a.e=r),s!==a.t&&e.setAttribute(n,"title",a.t=s),a},{e:void 0,t:void 0}),n;var n,a}})),e.effect(()=>e.setAttribute(i,"id",`${a.path_word}${s}`)),i;var i,l}})),e.effect(()=>e.setAttribute(p,"href",`/comic/${o}/chapter/${a.last_chapter.comic_id}`)),i)];default:return e.createComponent(t.For,{each:c,children:({id:n,name:s})=>e.createComponent(t.Show,{get when(){return r[n].length},get children(){var i=e.template("<div class=card style=max-width:100em><div class=card-body><h2 class=card-title></h2><ul>")(),l=i.firstChild.firstChild,c=l.nextSibling;return e.setStyleProperty(i,"margin","1em auto"),e.insert(l,s),e.insert(c,e.createComponent(t.For,{get each(){return r[n]},children:t=>{return n=e.template('<a class="btn btn-outline-primary">')(),e.insert(n,()=>t.name),e.effect(r=>{var s=!(a.last_chapter.uuid!==t.id),i=`/comic/${o}/chapter/${t.id}`;return s!==r.e&&n.classList.toggle("active",r.e=s),i!==r.t&&e.setAttribute(n,"href",r.t=i),r},{e:void 0,t:void 0}),n;var n}})),i}})})}var i,l,d,p,g,m,u,h};let g;switch(s){case"mobile":g=n.querySelector(".detailsTextContent");for(const e of n.querySelectorAll("button.van-dialog__confirm"))e.click();break;case"web":g=n.querySelector(".upLoop");break;default:g=n.querySelector("main"),g.textContent="",n.useStyle("ul .btn { height: fit-content; width: fit-content; margin: 1em; }")}e.render(()=>e.createComponent(t.For,{get each(){return Object.values(d)},children:p}),g);for(const e of n.querySelectorAll(".upLoop .table-default-title"))e.querySelector(".nav-link:not(.disabled)")?.click()};(async()=>{const e=document.cookie.split("; ").find(e=>e.startsWith("token="))?.replace("token=","");e&&(Reflect.set(r.headers,"Authorization",`Token ${e}`),Reflect.set(s.headers,"Authorization",`Token ${e}`));let t="",l="";if(location.href.includes("/chapter/")?[,,t,,l]=location.pathname.split("/"):location.href.includes("/comicContent/")&&([,,,t,l]=location.pathname.split("/")),t&&l){const{setState:e}=await o.useInit("copymanga"),r=n.querySelector("main .img+.title");r&&(r.textContent="ComicRead æç¤ºæ‚¨ï¼šä½ è¨ªå•çš„å…§å®¹æš«ä¸å­˜åœ¨ï¼Œè«‹é»é¸å³ä¸‹è§’æŒ‰éˆ•å˜—è©¦åŠ è¼‰æ¼«ç•«");const i=async()=>{const o=await s.get(`/api/v3/comic/${t}/chapter2/${l}?platform=3`,{noCheckCode:!0});if(200!==o.status){const e=`æ¼«ç•«åŠ è¼‰å¤±æ•—ï¼š${o.response.message||o.status}`;throw r&&(r.textContent=e),new Error(e)}if(r){r.textContent="æ¼«ç•«åŠ è¼‰æˆåŠŸğŸ¥³";const{chapter:{name:e},comic:{name:t}}=o.response.results;document.title=`${t} - ${e} - æ‹·è²æ¼«ç•« æ‹·è´æ¼«ç”»`}if(r??!n.querySelector(".comicContent-next")){const{chapter:{next:n,prev:a}}=o.response.results;e("manga",{onNext:n?()=>location.assign(`/comic/${t}/chapter/${n}`):void 0,onPrev:a?()=>location.assign(`/comic/${t}/chapter/${a}`):void 0})}const a=[],{words:i,contents:c}=o.response.results.chapter;for(let e=0;e<c.length;e++)a[i[e]]=c[e].url.replace(/(?<=(\/|\.))c800x/,"c1500x");return a};e("comicMap","",{async getImgList(){if(n.querySelector(".comicContent-next")&&e("manga",{onNext:n.querySelectorClick(".comicContent-next a:not(.prev-null)"),onPrev:n.querySelectorClick(".comicContent-prev:not(.index,.list) a:not(.prev-null)")}),r)return i();try{const e=await a.getImglistByHtml(`${location.origin}/comic/${t}/chapter/${l}`);if(0===e.length)throw new Error("è§£æç½‘é¡µå˜é‡å¤±è´¥");return e}catch(e){return n.log.error(e),i()}}});const c=async(e=[])=>{const t=location.pathname.split("/").at(-1),n=await s.get(`/api/v3/roasts?chapter_id=${t}&limit=100&offset=${e.length}&_update=true`,{errorText:"è·å–æ¼«ç”»è¯„è®ºå¤±è´¥",responseType:"blob"}),{list:o,total:a}=JSON.parse(await n.response.text()).results;for(const{comment:t}of o)e.push(t);return e.length<a?c(e):e};return void e("manga","commentList",await c())}if(!l&&location.href.includes("/comic/")){if([,t]=location.href.split("/comic/"),!t)return;let a;const r=location.href.includes("/h5/");if("404 - æ‹·è²æ¼«ç•«"===document.title?a=r?"mobile":"404":r?(await n.wait(()=>"none"===n.querySelector(".van-toast__text")?.parentElement?.style.display),a=await n.wait(()=>{if(n.querySelector(".isBan")?.textContent?.includes("ä¸æä¾›é–±è¦½"))return"mobile";const e=n.querySelector(".van-dialog__message");if(e?.textContent?.includes("æ¼«ç•«æœªæ‰¾åˆ°")){e.textContent="æ¼«ç•«æœªæ‰¾åˆ°!\nè«‹åå’Œæ”¾å¯¬ï¼Œç­‰å¾…ç›®éŒ„ç”Ÿæˆ";for(const e of n.querySelectorAll(".detailsTextContentTabs"))e.remove();return"mobile"}},1e3)):!Boolean(n.querySelector(".wargin")?.textContent?.includes("ä¸æä¾›é–±è¦½"))&&await n.wait(()=>n.querySelector(".upLoop .table-default-title"),1e3)||(a=n.querySelector(".comicParticulars-title")?"web":"404"),a){const e=n.querySelector(".isBan, .wargin");e&&(e.style.textDecoration="line-through");const r=n.querySelector("main .img+.title");r&&(r.textContent="ComicRead æç¤ºæ‚¨ï¼šä½ è¨ªå•çš„å…§å®¹æš«ä¸å­˜åœ¨ï¼Œè«‹åå’Œæ”¾å¯¬ï¼Œç­‰å¾…ç›®éŒ„ç”Ÿæˆ");try{await c(t,a)}catch(e){n.log.error(e),r&&(r.textContent="ComicRead æç¤ºæ‚¨ï¼šç›®éŒ„ç”Ÿæˆå¤±æ•—ğŸ˜¢"),o.toast.error("ç›®éŒ„ç”Ÿæˆå¤±æ•—ğŸ˜¢",{duration:Number.POSITIVE_INFINITY})}}!r&&e&&i(t)}})();break}case"www.pixiv.net":{let e=[];h={name:"pixiv",getImgList:()=>e,SPA:{async isMangaPage(){const t=Number(location.pathname.split("/")[2]);if(!t||!location.pathname.startsWith("/artworks/"))return e.length=0,!1;const n=await g.request(`/ajax/illust/${t}/pages`,{responseType:"json"});return e=n.response.body.map(e=>e.urls.original),e.length>1}},initOptions:{autoShow:!1,defaultOption:{pageNum:1}}};break}case"www.zaimanhua.com":case"manhua.zaimanhua.com":{const e=()=>unsafeWindow.__NUXT__.data.getChapters?.data?.chapterInfo?.page_url;h={name:"zaiManHua",wait:()=>Boolean(d.querySelector(".scrollbar-demo-item")),getImgList:e,SPA:{isMangaPage:()=>location.pathname.startsWith("/view/"),getOnNext:()=>d.querySelectorClick("#next_chapter"),getOnPrev:()=>d.querySelectorClick("#prev_chapter")}};break}case"m.zaimanhua.com":{const e=async(e,t)=>{const n=await g.request(`https://v4api.zaimanhua.com/app/v1/comic/chapter/${e}/${t}?_v=15`,{responseType:"json"});return n.response.errno&&g.toast.error(`${d.t("alert.comic_load_error")}: ${n.response.errmsg}`,{throw:!0}),n.response.data.data},t=async e=>{const t=await g.request(`https://v4api.zaimanhua.com/app/v1/comic/detail/${e}?_v=15`,{responseType:"json"});return t.response.errno&&g.toast.error(`${d.t("alert.comic_load_error")}: ${t.response.errmsg}`,{throw:!0}),t.response.data.data};h={name:"zaiManHua",async getImgList({setState:n}){const o=new URLSearchParams(location.search),a=Number(o.get("comic_id")),r=Number(o.get("chapter_id"));if(!a||!r)throw new Error(d.t("site.changed_load_failed"));const s=await t(a),i=(1===s.chapters.length?s.chapters[0]:s.chapters.find(e=>e.data.find(e=>e.chapter_id===r))).data;i.sort((e,t)=>e.chapter_order-t.chapter_order);const l=i.findIndex(e=>e.chapter_id===r);return n("manga",{onPrev:l>0?()=>location.assign(`/pages/comic/page?comic_id=${a}&chapter_id=${i[l-1].chapter_id}`):void 0,onNext:l+1<i.length?()=>location.assign(`/pages/comic/page?comic_id=${a}&chapter_id=${i[l+1].chapter_id}`):void 0}),(await e(a,r)).page_url_hd},SPA:{isMangaPage:()=>"/pages/comic/page"===location.pathname}};break}case"terra-historicus.hypergryph.com":{const e=()=>`https://terra-historicus.hypergryph.com/api${location.pathname}`,t=t=>async()=>{const n=await g.request(`${e()}/page?pageNum=${t+1}`);return JSON.parse(n.responseText).data.url};h={name:"terraHistoricus",wait:()=>Boolean(d.querySelector(".HG_COMIC_READER_main")),async getImgList(){const n=(await g.request(e(),{responseType:"json"})).response.data.pageInfos;if(0===n.length&&location.pathname.includes("episode"))throw new Error("è·å–å›¾ç‰‡åˆ—è¡¨æ—¶å‡ºé”™");return d.plimit(d.range(n.length,t))},SPA:{isMangaPage:()=>location.href.includes("episode"),getOnPrev:()=>d.querySelectorClick("footer .HG_COMIC_READER_prev a"),getOnNext:()=>d.querySelectorClick("footer .HG_COMIC_READER_prev+.HG_COMIC_READER_buttonEp a")}};break}case"18comic.ink":case"jmcomic-zzz.one":case"jmcomic-zzz.org":case"18comic.org":case"18comic.vip":{const e=l("helper"),t=l("main");(async()=>{if(!location.pathname.includes("/photo/"))return;const{setState:n}=await t.useInit("jm");for(;!unsafeWindow?.onImageLoaded;){if("complete"===document.readyState)return void t.toast.error("æ— æ³•è·å–å›¾ç‰‡",{duration:Number.POSITIVE_INFINITY});await e.sleep(100)}n("manga",{onPrev:e.querySelectorClick(()=>e.querySelector(".menu-bolock-ul .fa-angle-double-left")?.parentElement),onNext:e.querySelectorClick(()=>e.querySelector(".menu-bolock-ul .fa-angle-double-right")?.parentElement)});const o=e.querySelectorAll(".scramble-page:not(.thewayhome) > img");if(unsafeWindow.aid<unsafeWindow.scramble_id||"1"===unsafeWindow.speed)return n("comicMap","",{getImgList:()=>o.map(e=>e.dataset.original??"")});const a=async n=>{const a=o[n],r=a.dataset.original,s=e.getFileName(r);if(a.dataset.imgUrl)return{name:s,src:a.dataset.imgUrl};const i=await(async e=>{try{return await t.request(e,{responseType:"blob",fetch:!0,noTip:!0},3)}catch{return await t.request(e,{responseType:"blob",revalidate:!0,fetch:!1},3)}})(a.dataset.original);if(0===i.response.size)return t.toast.warn(`ä¸‹è½½åŸå›¾æ—¶å‡ºé”™: ${a.dataset.page}`),"";a.src=`${URL.createObjectURL(i.response)}#${a.src}`;try{await e.waitImgLoad(a,1e4)}catch{return URL.revokeObjectURL(a.src),a.src=r,t.toast.warn(`åŠ è½½åŸå›¾æ—¶å‡ºé”™: ${a.dataset.page}`),""}try{"CANVAS"===a.nextElementSibling?.tagName&&a.nextElementSibling.remove(),unsafeWindow.onImageLoaded(a);const t=await e.canvasToBlob(a.nextElementSibling,"image/webp",1);if(URL.revokeObjectURL(a.src),!t)throw new Error("è½¬æ¢å›¾ç‰‡æ—¶å‡ºé”™");const n=URL.createObjectURL(t);return a.dataset.imgUrl=n,{name:s,src:n}}catch(e){return a.src=r,t.toast.warn(`è½¬æ¢å›¾ç‰‡æ—¶å‡ºé”™: ${a.dataset.page}, ${e.message}`),""}};await e.wait(()=>{const t=e.querySelectorAll(".lazy-loaded").length;return t>0&&e.querySelectorAll("canvas").length-t<=1}),n("comicMap","",{getImgList:({dynamicLazyLoad:e})=>e({loadImg:a,length:o.length})})})().catch(t=>e.log.error(t));break}case"tw.manhuagui.com":case"m.manhuagui.com":case"www.mhgui.com":case"www.manhuagui.com":{if(!/\/comic\/\d+\/\d+\.html/.test(location.pathname))break;let e;try{const t=d.querySelectorAll("body > script:not([src])").find(e=>e.innerHTML.startsWith("window["));if(!t)throw new Error(d.t("site.changed_load_failed"));e=JSON.parse(eval(t.innerHTML.slice(26)).match(/(?<=\()\{.+\}/)[0])}catch{g.toast.error(d.t("site.changed_load_failed"));break}d.useStyle("#smh-msg-box { z-index: 2147483647 !important }");const t=e=>{if(0===e)return;const t=location.pathname.replace(/(?<=\/)\d+(?=\.html)/,`${e}`);return()=>location.assign(t)};h={name:"manhuagui",getImgList(){const t=Object.entries(e.sl).map(e=>`${e[0]}=${e[1]}`).join("&");if(e.files)return e.files.map(e=>`${unsafeWindow.pVars.manga.filePath}${e}?${t}`);if(e.images){const{origin:n}=new URL(d.querySelector("#manga img").src);return e.images.map(e=>`${n}${e}?${t}`)}return g.toast.error(d.t("site.changed_load_failed"),{throw:!0}),[]},onNext:t(e.nextId),onPrev:t(e.prevId)};break}case"www.manhuaren.com":case"m.1kkk.com":case"www.1kkk.com":case"tel.dm5.com":case"en.dm5.com":case"cnc.dm5.com":case"www.dm5.cn":case"www.dm5.com":{if(!Reflect.has(unsafeWindow,"DM5_CID"))break;const e=unsafeWindow.DM5_IMAGE_COUNT??unsafeWindow.imgsLen;if(!(Number.isSafeInteger(e)&&e>0)){g.toast.error(d.t("site.changed_load_failed"));break}const t=async e=>{const t=await unsafeWindow.$.ajax({type:"GET",url:"chapterfun.ashx",data:{cid:unsafeWindow.DM5_CID,page:e,key:unsafeWindow.$("#dm5_key").length>0?unsafeWindow.$("#dm5_key").val():"",language:1,gtk:6,_cid:unsafeWindow.DM5_CID,_mid:unsafeWindow.DM5_MID,_dt:unsafeWindow.DM5_VIEWSIGN_DT,_sign:unsafeWindow.DM5_VIEWSIGN}});return eval(t)},n=(e,t)=>d.querySelectorClick(()=>d.querySelector(e)??d.querySelectorAll(".view-bottom-bar a").find(e=>e.textContent?.includes(t)));h={name:"dm5",getImgList:({dynamicLoad:n})=>Array.isArray(unsafeWindow.newImgs)&&unsafeWindow.newImgs.every(d.isUrl)?unsafeWindow.newImgs:n(async n=>{const o=new Set;for(;o.size<e;)for(const e of await t(o.size+1))o.has(e)||(o.add(e),n(o.size-1,e))},e),onPrev:n(".logo_1","ä¸Šä¸€ç« "),onNext:n(".logo_2","ä¸‹ä¸€ç« "),onExit:e=>e&&d.scrollIntoView(".postlist")};break}case"www.wn04.ru":case"www.wnacg05.cc":case"www.wnacg03.cc":case"www.wnacg.com":case"wnacg.com":{const e=d.querySelector("#bodywrap a.btn");if(e&&(e.style.setProperty("background-color","#607d8b"),e.style.setProperty("background-image","none")),!Reflect.has(unsafeWindow,"imglist"))break;h={name:"wnacg",getImgList:()=>unsafeWindow.imglist.filter(({caption:e})=>"å–œæ­¡ç´³å£«æ¼«ç•«çš„åŒå­¸è«‹åŠ å…¥æ”¶è—å“¦ï¼"!==e).map(({url:e})=>new URL(e,location.origin).href)};break}case"www.mangabz.com":case"mangabz.com":{if(!Reflect.has(unsafeWindow,"MANGABZ_CID"))break;const e=unsafeWindow.MANGABZ_IMAGE_COUNT??unsafeWindow.imgsLen;if(!(Number.isSafeInteger(e)&&e>0)){g.toast.error(d.t("site.changed_load_failed"));break}const t=async e=>{const t=await unsafeWindow.$.ajax({type:"GET",url:"chapterimage.ashx",data:{cid:unsafeWindow.MANGABZ_CID,page:e,key:"",_cid:unsafeWindow.MANGABZ_CID,_mid:unsafeWindow.MANGABZ_MID,_dt:unsafeWindow.MANGABZ_VIEWSIGN_DT,_sign:unsafeWindow.MANGABZ_VIEWSIGN}});return eval(t)},n=(e,t)=>d.querySelectorClick(()=>d.querySelector(e)??d.querySelectorAll(".bottom-bar-tool a").find(e=>e.textContent?.includes(t)));h={name:"mangabz",getImgList:({dynamicLoad:n})=>n(async n=>{const o=new Set;for(;o.size<e;)for(const e of await t(o.size+1))o.has(e)||(o.add(e),n(o.size-1,e))},e),onNext:n('body > .container a[href^="/"]:last-child',"ä¸‹ä¸€"),onPrev:n('body > .container a[href^="/"]:first-child',"ä¸Šä¸€")};break}case"komiic.com":{const e="\n        query imagesByChapterId($chapterId: ID!) {\n          imagesByChapterId(chapterId: $chapterId) {\n            id\n            kid\n            height\n            width\n            __typename\n          }\n        }",t=async()=>{const t=/chapter\/(\d+)/.exec(location.pathname)?.[1];if(!t)throw new Error(d.t("site.changed_load_failed"));return(await g.request("/api/query",{method:"POST",responseType:"json",headers:{"content-type":"application/json"},data:JSON.stringify({operationName:"imagesByChapterId",variables:{chapterId:`${t}`},query:e})})).response.data.imagesByChapterId.map(({kid:e})=>`https://komiic.com/api/image/${e}`)},n=e=>async()=>(await d.waitDom(".v-bottom-navigation__content"),d.querySelectorClick(".v-bottom-navigation__content button:not([disabled])",e));h={name:"komiic",getImgList:t,SPA:{isMangaPage:()=>/comic\/\d+\/chapter\/\d+\/images\//.test(location.href),getOnPrev:n("ä¸Šä¸€"),getOnNext:n("ä¸‹ä¸€"),handleUrl:e=>e.pathname}};break}case"mangadex.org":h={name:"mangadex",async getImgList(){const e=location.pathname.split("/").at(2),{response:{baseUrl:t,chapter:{data:n,hash:o}}}=await g.request(`https://api.mangadex.org/at-home/server/${e}?forcePort443=false`,{responseType:"json"});return n.map(e=>`${t}/data/${o}/${e}`)},SPA:{isMangaPage:()=>/^\/chapter\/.+/.test(location.pathname),getOnPrev:()=>d.querySelectorClick('#chapter-selector > a[href^="/chapter/"]:nth-of-type(1)'),getOnNext:()=>d.querySelectorClick('#chapter-selector > a[href^="/chapter/"]:nth-of-type(2)'),handleUrl:e=>e.href.replace(/(?<=\/chapter\/.+?)\/.*/,"")}};break;case"noy1.top":h={name:"NoyAcg",async getImgList(){const[,,e]=location.hash.split("/"),t=await d.wait(()=>d.querySelector(".lazy-load-image-background img")),[n]=t.src.split(e),o=await d.wait(()=>d.querySelectorAll(".lazy-load-image-background").length);return d.range(o,t=>`${n}${e}/${t+1}.webp`)},SPA:{isMangaPage:()=>location.hash.startsWith("#/read/")}};break;case"8.twobili.com":case"a.twobili.com":case"articles.onemoreplace.tw":case"www.8comic.com":{if(!/^\/(?:online|ReadComic|comic)\//.test(location.pathname))break;c.downloadImgHeaders.Referer="https://www.8comic.com/";const e=()=>[...unsafeWindow.xx.matchAll(/(?<= s=").+?(?=")/g)].map(([e])=>decodeURIComponent(e));h={name:"8comic",getImgList:e,onNext:d.querySelectorClick("#nextvol"),onPrev:d.querySelectorClick("#prevvol")};break}case"www.relamanhua.org":case"www.manga2024.com":case"www.2024manga.com":if(!location.pathname.includes("/chapter/"))break;if(!document.querySelector(".disData[contentkey]")){g.toast.error(d.t("site.changed_load_failed"));break}h={name:"relamanhua",getImgList:()=>m.getImglistByHtml(),onNext:d.querySelectorClick(".comicContent-next a:not(.prev-null)"),onPrev:d.querySelectorClick(".comicContent-prev:not(.index,.list) a:not(.prev-null)")};break;case"hitomi.la":h={name:"hitomi",wait:()=>unsafeWindow.galleryinfo&&Reflect.has(unsafeWindow.galleryinfo,"files")&&"anime"!==unsafeWindow.galleryinfo.type,getImgList:()=>unsafeWindow.galleryinfo.files.map(e=>unsafeWindow.url_from_url_from_hash(unsafeWindow.galleryinfo.id,e,"webp"))};break;case"shupogaki.moe":case"hoshino.one":case"niyaniya.moe":{const e=e=>new Promise(t=>{const n=new XMLHttpRequest;n.responseType="blob",n.open("GET",e),n.onload=()=>{t(URL.createObjectURL(n.response))},n.send()}),t=()=>location.href.includes("/g/"),n=localStorage.getItem("clearance");h={name:"schale",async getImgList({dynamicLazyLoad:t}){const[,,o,a]=location.pathname.split("/"),r=await g.request(`https://api.schale.network/books/detail/${o}/${a}?crt=${n}`,{fetch:!0,responseType:"json",method:"POST"}),[[s,{id:i,key:l}]]=Object.entries(r.response.data).filter(([,e])=>e.id&&e.key).toSorted(([,e],[,t])=>t.size-e.size),c=await g.request(`https://api.schale.network/books/data/${o}/${a}/${i}/${l}/${s}?crt=${n}`,{fetch:!0,responseType:"json"}),{base:p,entries:m}=c.response,{length:u}=m;return t({loadImg:async t=>{const{path:n,dimensions:o}=m[t],a=performance.now(),r=await e(`${p}${n}?w=${o[0]}`);return await d.sleep(500-(performance.now()-a)),r},length:u,concurrency:1})},SPA:{isMangaPage:t}};break}case"nude-moon.org":{const e=l("components/Manga"),t=l("helper"),n=l("main");(async()=>{const o=async()=>{const e=new URL(location.href),n=e.pathname.split("-");n.splice(1,0,"online"),e.pathname=n.join("-");const o=await fetch(e).then(e=>e.text()),a=[...t.domParse(o).querySelectorAll("script")].find(e=>e.textContent.includes("/manga/"));return a?Array.from(a.textContent.matchAll(/\/manga\/[^']+/g),e=>`https://nude-moon.org${e[0]}`):[]},{setState:a}=await n.useInit("nude-moon",{autoShow:!1,defaultOption:{pageNum:1}});a(e=>{null!==location.pathname.match(/^\/\d+-/)&&(e.comicMap[""].getImgList=o)}),e.listenHotkey({scroll_right:()=>unsafeWindow.nextImg(),scroll_left:()=>unsafeWindow.backImg()})})();break}case"kemono.cr":case"kemono.su":case"kemono.party":{const e=l("helper"),t=l("main");(async()=>{const n=()=>location.pathname.includes("/post/");await e.waitUrlChange(n);const{store:o,setState:a,showComic:r,init:s}=await t.useInit("kemono",{autoShow:!1,defaultOption:{pageNum:1},load_original_image:!0});e.createEffectOn(()=>o.options.load_original_image,(e,t)=>{a("nowComic",e?"original":"thumbnail"),t&&r()}),await e.waitDom(".post__thumbnail");const i=()=>e.querySelectorAll(".post__thumbnail a").map(e=>e.href),l=()=>e.querySelectorAll(".post__thumbnail img").map(e=>e.src);a(t=>{t.comicMap.original={getImgList:i,imgList:i()},t.comicMap.thumbnail={getImgList:l,imgList:l()},t.manga.onNext=e.querySelectorClick(".post__nav-link.next"),t.manga.onPrev=e.querySelectorClick(".post__nav-link.prev")}),s();const c=new Set(["zip","rar","7z","cbz","cbr","cb7"]);for(const t of e.querySelectorAll(".post__attachment a")){if(!c.has(t.href.split(".").pop()))continue;const e=document.createElement("a");e.href=`https://comic-read.pages.dev/?url=${encodeURIComponent(t.href)}`,e.textContent=t.textContent.replace("Download ","ComicReadPWA - "),e.className=t.className,e.style.opacity=".6",t.parentNode.insertBefore(e,t.nextElementSibling)}e.onUrlChange(async t=>{if(t){if(!n())return a(e=>{e.fab.show=!1,e.manga.show=!1});a(e=>{e.fab.show=void 0,e.manga.show=!1}),await e.wait(()=>l()[0]!==o.comicMap.thumbnail.imgList?.[0]),a(e=>{e.comicMap.original.imgList=i(),e.comicMap.thumbnail.imgList=l()}),o.options.autoShow&&await r()}})})();break}case"nekohouse.su":if(!location.pathname.includes("/post/"))break;h={name:"nekohouse",getImgList:()=>d.querySelectorAll(".fileThumb").map(e=>e.getAttribute("href")),initOptions:{autoShow:!1,defaultOption:{pageNum:1}}};break;case"nicomanga.com":case"weloma.art":case"welovemanga.one":{if(!d.querySelector("#listImgs, .chapter-content"))break;const e=async()=>{const t=d.querySelectorAll("img.chapter-img:not(.ls-is-cached)").map(e=>(e.dataset.src||e.dataset.srcset||e.dataset.original||e.src).trim()).filter(Boolean);return t.length>0&&t.every(e=>!/loading.*\.gif/.test(e))?t:(await d.sleep(500),e())};h={name:"welovemanga",getImgList:e,onNext:d.querySelectorClick(".rd_top-right.next:not(.disabled)"),onPrev:d.querySelectorClick(".rd_top-left.prev:not(.disabled)")};break}case"hentaizap.com":if(!location.pathname.startsWith("/g/"))break;h={name:"hentaizap",getImgList(){const e=Number(d.querySelector("#pages").value),t=d.querySelector("#fimg"),n=(t.dataset.src||t.src).split("/").slice(0,-1).join("/");return d.range(e,e=>`${n}/${e+1}.${d.fileType[unsafeWindow.g_th[e+1].slice(0,1)]}`)}};break;case"imhentai.xxx":if(!location.pathname.startsWith("/gallery/"))break;h={name:"IMHentai",getImgList(){const[e]=d.querySelector("#append_thumbs a img").dataset.src.match(/.+\//),t=[];for(const[n,o]of Object.entries(unsafeWindow.g_th)){const[a,r,s]=o.split(",");t[Number(n)-1]={src:`${e}${n}.${d.fileType[a]}`,width:Number(r),height:Number(s)}}return t}};break;case"sai-zen-sen.jp":switch(h={name:"sai-zen-sen",getImgList:()=>[]},location.pathname.match(/\/[^/]+\/[^/]+\//)?.[0]){case"/special/4pages-comics/":case"/works/comics/":h.getImgList=()=>Object.values(unsafeWindow.B.Package.Manifest.items).map(({href:e})=>e).filter(Boolean).map(e=>`${unsafeWindow.B.Path}/${e}`),h.onPrev=d.querySelectorClick("ul.volumes > li:nth-child(2) > a[href]"),h.onNext=d.querySelectorClick("ul.volumes > li:nth-child(3) > a[href]");break;case"/comics/twi4/":h.getImgList=()=>unsafeWindow.t4.Meta.Items.map(({ImageFileName:e})=>`${unsafeWindow.t4.GA.Gate.x_directory}works/${e}`);break;default:h=void 0}break;case"comic-read.pages.dev":unsafeWindow.GM_xmlhttpRequest=GM_xmlhttpRequest,unsafeWindow.toast=g.toast;break;default:{const e=l("components/Manga"),t=l("helper"),n=l("request");if(document.querySelector('head > meta[content="A manga reader that runs tachiyomi\'s extensions"]')){const e=(e,t)=>{location.pathname=`/manga/${e}/chapter/${t}`},o=async(e,a)=>{const r=await n.request("/api/graphql",{method:"POST",data:JSON.stringify({operationName:"GET_CHAPTERS",query:"query GET_CHAPTERS($mangaId: Int!, $chapterId: Int!) {\n                chapters(condition: {\n                  mangaId: $mangaId, sourceOrder: $chapterId}\n                ) { nodes { pageCount } }\n                manga(id: $mangaId) { chapters { totalCount } }\n              }",variables:{mangaId:e,chapterId:a}}),responseType:"json"});return r.response.data.chapters.nodes[0].pageCount<=0?(await t.sleep(200),o(e,a)):r.response.data};h={name:"Tachidesk",SPA:{isMangaPage:()=>/\/manga\/\d+\/chapter\/\d+/.test(location.pathname)},async getImgList({setState:n}){const[,,a,,r]=location.pathname.split("/").map(Number),s=await o(a,r),[{pageCount:i}]=s.chapters.nodes,l=s.manga.chapters.totalCount;return n("manga",{onPrev:r>0?()=>e(a,r-1):void 0,onNext:r<l?()=>e(a,r+1):void 0}),t.range(i,e=>`/api/v1/manga/${a}/chapter/${r}/page/${e}`)},onShowImgsChange:t.debounce((e,n)=>{const o=n[[...e].at(-1)].src;t.querySelector(`img[src$="${o}"]`)?.scrollIntoView({behavior:"instant",block:"end"})},500)}}if("/reader"===location.pathname&&"LANraragi."===document.querySelector('.ip > a[href="https://github.com/Difegue/LANraragi"]')?.textContent.trim()){let n=!0;h={name:"LANraragi",getImgList:()=>t.wait(()=>Reader?.pages),onShowImgsChange:t.debounce((o,a)=>{Reader&&(a.length>0&&n&&(n=!1,e.setState(e=>{e.activePageIndex=e.pageList.findIndex(e=>e.includes(Reader.currentPage))})),Reader.currentPage=t.clamp(0,[...o].at(-1),Reader.maxPage),Reader.updateProgress())},200)}}h||(async()=>{if(void 0!==await GM.getValue(location.hostname))return t.requestIdleCallback(u.otherSite);await GM.registerMenuCommand((e=>{switch(e){case"en":return"Enter simple reading mode";case"ru":return"Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ";default:return"ä½¿ç”¨ç®€æ˜“é˜…è¯»æ¨¡å¼"}})(await p.getInitLang()),()=>u.otherSite())})()}}h&&g.universal(h)}catch(e){d.log.error(e)}