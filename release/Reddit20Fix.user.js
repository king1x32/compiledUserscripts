// ==UserScript==
// @name         Reddit Fix
// @namespace    http://tampermonkey.net/
// @version      1.9.8
// @author       Bum
// @require      http://code.jquery.com/jquery-3.4.1.min.js
// @match        https://www.reddit.com/*
// @match        https://new.reddit.com/*
// @grant        GM_addStyle
// @downloadURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/Reddit20Fix.user.js
// @updateURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/Reddit20Fix.meta.js
// ==/UserScript==
var t,n,o="false",i="false",a="false",r="",d=!1,c=!1,l="open",s=!0;(new Date).getTime(),null!=localStorage.getItem("removeBorderRadius")&&(d=localStorage.getItem("removeBorderRadius")),null!=localStorage.getItem("holdTopicsInMemory")&&(o=localStorage.getItem("holdTopicsInMemory")),null!=localStorage.getItem("commentEffects")&&(i=localStorage.getItem("commentEffects")),null!=localStorage.getItem("originalBehavior")&&(a=localStorage.getItem("originalBehavior")),null!=localStorage.getItem("subsToHide")&&(r=localStorage.getItem("subsToHide")),null!=localStorage.getItem("hidePromotedlinks")&&(s=localStorage.getItem("hidePromotedlinks")),null!=localStorage.getItem("hideRecentSection")&&(c=localStorage.getItem("hideRecentSection")),null!=localStorage.getItem("customFeedState")&&(l=localStorage.getItem("customFeedState")),t=[],n=0,function(){"use strict";function GM_addStyle(e){const t=(document.getElementById("GM_addStyle")||function(){const e=document.createElement("style");return e.type="text/css",e.id="GM_addStyle",document.head.appendChild(e),e}()).sheet;t.insertRule(e,(t.rules||t.cssRules||[]).length)}function p(e){const t=(document.getElementById("GM_addStyle")||function(){const e=document.createElement("style");return e.type="text/css",e.id="GM_addStyle",document.head.appendChild(e),e}()).sheet;for(var n=0;n<t.cssRules.length;n++)t.cssRules[n].selectorText==e&&t.deleteRule(n)}function u(e,t){return'<a class="M2Hk_S2yvXpsNPfZMBMur customRedditFixMenu" id = "'+e+'" ><div class="_1lwNBHmCQJObvqs1fXKSYR" style="margin-right: 0px;">'+t+"</div></a>"}function m(e,t,n){return"true"==e||1==e?'  <span style="width: 100%;"><input type="checkbox" checked id="'+t+'" name="'+n+'" /> '+n+"</span>":'<span style="width: 100%;"><input type="checkbox" id="'+t+'" name="'+n+'" /> '+n+"</span>"}function h(){var e=$("._2pUO1Sfe7WlIHvq6goN3Pz");e.find(".customRedditFixMenu").length>0||(e.append(u("redditFixReloadAll","Reload All")),$("#redditFixReloadAll").click(function(){var e,o;for(e=t.length-1;e>=0;--e)o=t.pop(e),$(".rpBJOHq2PR60pnwJlUyP0").prepend(o);n=$(document).height()}),e.append(u("redditFixReload25","Reload 25")),$("#redditFixReload25").click(function(){var e,o,i=t.length;for(i>25&&(i=25),e=0;e<25;++e)o=t.pop(e),$(".rpBJOHq2PR60pnwJlUyP0").prepend(o);n=$(document).height()}))}function g(){var e,t;$(".subgrid-container").length>0&&1!=$(".observerIsAttached").length?(k(),$(".subgrid-container").addClass("observerIsAttached"),e={attributes:!1,childList:!0,subtree:!0},t=$(".subgrid-container").first().get(0),new MutationObserver(function(e){for(var t of e)t.addedNodes.forEach(function(e){$(e).find("article.w-full")&&k()})}).observe(t,e)):setTimeout(g,300)}function f(){$(".fixmodal").fadeOut("fast"),document.removeEventListener("click",f)}function x(e){"true"==e||1==e?GM_addStyle(".promotedlink{display: none !important;}"):p(".promotedlink")}function b(e){"true"==e||1==e?GM_addStyle("reddit-recent-pages{display: none !important;}"):p("reddit-recent-pages")}function v(e){"true"==e||1==e?GM_addStyle("*:not(.shreddit-subreddit-icon__icon){border-radius: 0 !important;}"):p(":not(.shreddit-subreddit-icon__icon)")}function k(){var e=r.split(";");let t=0;for(;t<e.length;){let n=$("a[href*='"+e[t]+"']").closest("article");$(n).closest("hr").remove(),$(n).remove(),t++}}var y,w,S,I,R,_,B,C;v(d),b(c),x(s),k(),"false"==i&&(GM_addStyle('img[src*="flame"]{display:none;}'),GM_addStyle('div[aria-role="presentation"]{box-shadow:none !important;background : transparent !important;}')),GM_addStyle(".wwHbgRV0ZXGp5CHHlpo5u{display:block !important;}"),GM_addStyle("._1Q2mF3u7v9hBVu_4bkC7R4{display:block !important;}"),GM_addStyle("._3hUbl08LBz2mbXjy0iYhOS,._3b8u2OJXaSDdBWoRB7zUoK {height: 50px !important;width: 100% !important; bottom: 0 !important;}"),GM_addStyle("._3UEq__yL-82zX4EyuluREz,.gUpEQXQu8G8UvISmBIPsj,._1RZSSlyqzokrcxh0ESwE2e{display:none !important;}"),GM_addStyle(".vLH0XV-l8Y4mNGUvw4HHy{display:none !important;}"),GM_addStyle(".eI6Ep6BNFA5DZjPWNVb4,._2XQ3ZY6qCbEm9_WtvLLFru{display:none !important;}"),GM_addStyle(".fixmodal {position:fixed;background-color:rgba(0, 0, 0, 0.5);height:100%;width:100%;top:0;left:0;display:none; z-index: 1000;}"),GM_addStyle("#fixPopup {padding:5px;text-align:center;}"),GM_addStyle(".fixmodalWrap {margin: 50px auto; position:relative;width: fit-content;} "),GM_addStyle("#fixPopup img {max-height:"+(y=window.screen.height-200)+"px;}"),GM_addStyle("._2f5uYHvlfzs2DngQsiCdvB {height: 50px !important;width: 100% !important; position: relative !important; bottom: 50px !important;}"),GM_addStyle('.videoFixIcon {margin: 50px auto; background: url("https://www.pngall.com/white-play-png")} '),GM_addStyle(".expandDivCaption {padding: 5px!important; white-space: pre-wrap !important;max-height: max-content !important; display: inline-block !important; overflow-wrap: break-word !important;} "),GM_addStyle(".expandSpanCaption{height: auto !important; position: absolute !important; bottom: 0;} "),GM_addStyle(".expandDisableClick{pointer-events: none; } "),GM_addStyle(".expandEnableClick{pointer-events: auto; !important; } "),GM_addStyle(".expandGarbageRedditCaptions{position:relative !important; } "),window.addEventListener("scroll",(B=function(){"true"!=a&&("true"==o&&h(),$(document).scrollTop()>n&&(n=0))},C=Date.now(),function(){C+300-Date.now()<0&&(B(),C=Date.now())}));let T=location.href;setInterval(()=>{location.href!==T&&(T=location.href,g())},500),$(document).on("mousedown","._15nNdGlBIgryHV04IfAfpA",function(e){return $(this).parent().toggleClass("expandSpanCaption"),$(this).toggleClass("expandDivCaption"),$(".DraftEditor-root").length>0&&$(this).parent().toggleClass("expandGarbageRedditCaptions"),e.stopPropagation(),e.preventDefault(),e.cancelBubble=!0,e.stopImmediatePropagation(),!1}),w=!1,$("img").on("keyup keydown",function(e){w=e.ctrlKey}),$("img").on("click",function(){if(w)return e.stopPropagation(),e.preventDefault(),e.cancelBubble=!0,e.stopImmediatePropagation(),!1}),$(document).on("mousedown","._3b8u2OJXaSDdBWoRB7zUoK,._3hUbl08LBz2mbXjy0iYhOS,._2f5uYHvlfzs2DngQsiCdvB",function(e){var t,n,o;return $(".fixmodal").fadeIn("fast"),$("#fixPopup img").remove(),$("#fixPopup iframe").remove(),(t=$(this).parent().find("iframe")).length>0?((n=t.clone()).appendTo("#fixPopup"),n.css({width:"800px","max-height":y+"px"})):(o=$(this).parent().find("img").attr("src"),$('<img src="'+o+'" alt="image3" />').appendTo("#fixPopup")),setTimeout(()=>{document.addEventListener("click",f)},100),e.stopPropagation(),e.preventDefault(),e.cancelBubble=!0,e.stopImmediatePropagation(),!1}),g(),function e(){if(!($('[aria-controls="multireddits_section"]').length>0))return void setTimeout(e,300);let t=$('[aria-controls="multireddits_section"]').closest("faceplate-expandable-section-helper");t.bind("click",function(){$(this).is("[open]")?(l="open",localStorage.setItem("customFeedState","open")):(localStorage.setItem("customFeedState",""),l="")}),""==l&&t.removeAttr("open")}(),$("body").append('<div class="fixmodal"> <div class="fixmodalWrap"><div id="fixPopup"></div> </div></div>'),GM_addStyle("\n.container__menu {\n                /* Absolute position */\n                position: absolute;\n\n                /* Reset */\n                list-style: none;\n                margin: 0;\n                padding: 0;\n                display: none;\n\n                /* Misc */\n                border: 1px solid #cbd5e0;\n                border-radius: 0.25rem;\n                background-color: #f7fafc;\n            }\n"),GM_addStyle("\n    .open {\n    display: block;\n    z-index: 9999;\n}\n"),GM_addStyle("\n.container__item {\n                padding: 0.5rem 1rem;\n                white-space: nowrap;\n                cursor: pointer;\n    color: black;\n            }\n"),GM_addStyle("\n .container__item:hover {\n                background-color: #bee3f8;\n            }\n"),GM_addStyle("\n.container__divider {\n                border-bottom: 1px solid #cbd5e0;\n                height: 1px;\n            }\n"),$("body").append('\n    <ul id="redditfixShowImage" class="container__menu">\n                    <li class="container__item">Show Image</li>\n                </ul>\n                '),S=$("#redditfixShowImage"),_=null,$(document).mousemove(function(e){I=e.pageX,R=e.pageY}),$(document).on("mousedown",function(){if($(event.target).is("img")){function e(e){if(S.hasClass("open")&&S.removeClass("open"),$(e.target).attr("src").toUpperCase().indexOf("BLUR=")>=0)return S.css({top:R,left:I}).addClass("open"),e.preventDefault(),void(_=e.target)}$(this).on("contextmenu",e),S.click(function(e){e.stopPropagation()}),$(document).click(function(){S.hasClass("open")&&S.removeClass("open")}),$(".container__item").click(function(){var e,t=$(_).attr("src"),n=/^.*\/(.*)\.?(.*)?\?/g.exec(t);t.toUpperCase().indexOf("EXTERNAL")>=0?(e=$(_).parents(".STit0dLageRsa2yR4te_b").parent().find(".styled-outbound-link"),$(_).attr("src",e.attr("href"))):$(_).attr("src","https://i.redd.it/"+n[1]),$(_).attr("style","filter:none; width: auto; height: 100%;"),S.removeClass("open")})}}),$("body").append('\n    <div class="enhancecontainer" style="display:none;">\n\n    </div>\n    '),$(".enhancecontainer").append('<div class="tw-border-t tw-mg-t-1 tw-mg-x-05 tw-pd-b-1 customEnhanceMenu"" ></div><div class="tw-mg-y-05 tw-pd-x-05" style="width: 100%;"><p class="tw-c-text-alt-2 tw-font-size-6 tw-strong tw-upcase" style="color: var(--color-text-alt-2)!important;    font-size: var(--font-size-6)!important;    font-weight: 600!important;    text-transform: uppercase!important;">Reddit enhance</p></div>'),$(".enhancecontainer").append(m(i,"redditFixCheckBoxBackground","Remove comment effects")),$("#redditFixCheckBoxBackground").click(function(){var e=$(this);e.prop("checked")?(e.removeClass("_1L5kUnhRYhUJ4TkMbOTKkI"),localStorage.setItem("commentEffects",!1),i="false"):(e.addClass("_1L5kUnhRYhUJ4TkMbOTKkI"),localStorage.setItem("commentEffects",!0),i="true")}),$(".enhancecontainer").append(m(o,"fixRedditKeepTopicsInMemory","Save topics in ram")),$("#fixRedditKeepTopicsInMemory").click(function(){$(this).prop("checked")?(localStorage.setItem("holdTopicsInMemory",!0),o="true",h()):(localStorage.setItem("holdTopicsInMemory",!1),o="false",$("#redditFixReloadAll").remove(),$("#redditFixReload25").remove())}),$(".enhancecontainer").append(m(a,"fixRedditoriginalBehavior","Original behavior")),$("#fixRedditoriginalBehavior").click(function(){var e=$(this);e.prop("checked")?(localStorage.setItem("originalBehavior",!0),a="true"):(e.addClass("_1L5kUnhRYhUJ4TkMbOTKkI"),localStorage.setItem("originalBehavior",!1),a="false")}),$(".enhancecontainer").append(m(s,"fixhidePromotedlinks","Hide promoted links")),$("#fixhidePromotedlinks").click(function(){var e=$(this);e.prop("checked")?(localStorage.setItem("hidePromotedlinks",!0),x(!0),s="true"):(e.addClass("_1L5kUnhRYhUJ4TkMbOTKkI"),localStorage.setItem("hidePromotedlinks",!1),x(!1),s="false")}),$(".enhancecontainer").append(m(d,"fixremoveBorderRadius","Remove border radius")),$("#fixremoveBorderRadius").click(function(){var e=$(this);e.prop("checked")?(localStorage.setItem("removeBorderRadius",!0),v(!0),d="true"):(e.addClass("_1L5kUnhRYhUJ4TkMbOTKkI"),localStorage.setItem("removeBorderRadius",!1),v(!1),d="false")}),$(".enhancecontainer").append(m(c,"fixHideRecentSection","Hide recent section")),$("#fixHideRecentSection").click(function(){$(this).prop("checked")?(localStorage.setItem("hideRecentSection",!0),b(!0)):(localStorage.setItem("hideRecentSection",!1),b(!1))}),$(".enhancecontainer").append('<span style="margin-top: 10px;">Hide subreddit from appearing in feed. If you remove subs you have to restart. If you add just click save, no need to restart.</span>'),$(".enhancecontainer").append('\n        <textarea id="fixHideSubreddits" name="fixHideSubreddits" rows="3" cols="40" style = "flex:1">'+r+"</textarea>\n        "),$(".enhancecontainer").append(" <button type='button' id='fixSaveSubredditsHidden' style = 'background:darkgreen; flex: 2'>Save</button> "),$(".enhancecontainer").append('<div class="tw-border-t tw-mg-t-1 tw-mg-x-05 tw-pd-b-1 customEnhanceMenu"" ></div><div class="tw-mg-y-05 tw-pd-x-05" style="width: 100%;"><p class="tw-c-text-alt-2 tw-font-size-6 tw-strong tw-upcase"\n\nstyle="color: var(--color-text-alt-2)!important;\n    font-size: smaller;line-height: 1.4;\n    margin-top: 6px;">Any subreddit containing this word will be hidden from your feed. This is Case Sensitive. Write the exact subreddit name if you only target that subreddit. Use ; to separate keywords. Example: funny;tiktok;celebrity</p></div>'),$("body").append('\n    <div class="Layout-sc-nxg1ff-0 jA-dUUY"><div class="Layout-sc-nxg1ff-0 dDnLci">\n    <div class="Layout-sc-nxg1ff-0 bYXYej">\n    <div class="InjectLayout-sc-588ddc-0 iETGeJ">\n    <button class="ScCoreButton-sc-1qn4ixc-0 enhanceButton jGqsfG ScButtonIcon-sc-o7ndmn-0 fNzXyu"  style="\n    background: url(https://i.imgur.com/kWu713g.png);\n    background-size: 22px;\n    z-index:999;\n    background-repeat: no-repeat;\n    background-position: center; width: 25px;\n    height: 25px; top: 60px; right: 60px; position:fixed;" ></button>\n  </div>\n  </div>\n  <div aria-label="Whispers" role="button" data-click-out-id="threads-box" data-a-target="threads-box-closed" class="Layout-sc-nxg1ff-0 emWtQg InjectLayout-sc-588ddc-0 kgrtoC whispers-threads-box__container"></div></div></div>\n\n    '),$(".enhanceButton").click(function(){$(".enhancecontainer").toggle()}),$("#fixSaveSubredditsHidden").click(function(){r=$("#fixHideSubreddits").val(),localStorage.setItem("subsToHide",r),k()}),GM_addStyle(".enhanceButton:hover{    background-color:var(--color-background-button-text-hover) !important;}"),GM_addStyle("\n    .enhancecontainer {\ndisplay: flex;\n    flex-wrap: wrap;\n    justify-content: center;\n    background: #393939;\n    padding: 10px;\n    width: 200px;\n    position: fixed;\n    right: 100px;\n    z-index: 100;\n    margin-top: 66px;\n    width: 500px;\n    height: auto;\n    top: 0;\n}\n    "),GM_addStyle("\n    input.enhancCheck[type=checkbox] + label {\n  display: block;\n    cursor: pointer;\n    height: fit-content;\n    flex: 1 0 35%;\n    margin-top: 5px;\n}\n"),GM_addStyle("\n    input.enhancCheck[type=checkbox] {\n  display: none;\n}"),GM_addStyle("\n    ._1L5kUnhRYhUJ4TkMbOTKkI{\n    background: green !important;\n    }\n\n    "),GM_addStyle("\n    #redditFixCheckBoxBackground,#fixRedditKeepTopicsInMemory,#fixRedditoriginalBehavior{\n    background: red;\n    }\n\n    "),GM_addStyle(' input.enhancCheck[type=checkbox] + label:before {\n  content: "\\2714";\n  border: 0.1em solid #fff;\n  border-radius: 0.2em;\n  display: inline-block;\n  width: 1em;\n  height: 1em;\n  padding-left: 0.2em;\n  padding-bottom: 0.3em;\n  margin-right: 0.2em;\n  vertical-align: bottom;\n  color: transparent;\n}'),GM_addStyle("input.enhancCheck[type=checkbox]:checked + label:before {\n  background-color: #ED820A;\n  border-color:white;\n  color: #fff;\n}")}();