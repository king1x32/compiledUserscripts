// ==UserScript==
// @name                Disable YouTube Music AutoPause
// @name:en             Disable YouTube Music AutoPause
// @namespace           http://tampermonkey.net/
// @version             2025.07.07.002
// @license             MIT License
// @author              CY Fung
// @match               https://music.youtube.com/*
// @exclude             /^https?://\S+\.(txt|png|jpg|jpeg|gif|xml|svg|manifest|log|ini)[^\/]*$/
// @icon                https://raw.githubusercontent.com/cyfung1031/userscript-supports/main/icons/disable-youtube-autopause.svg
// @supportURL          https://github.com/cyfung1031/userscript-supports
// @run-at              document-start
// @grant               none
// @unwrap
// @allFrames           true
// @inject-into         page
// @downloadURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/Disable20YouTube20Music20AutoPause.user.js
// @updateURL https://raw.githubusercontent.com/king1x32/compiledUserscripts/release/release/Disable20YouTube20Music20AutoPause.meta.js
// ==/UserScript==
!function(){"use strict";function e(...e){Date.now()<p||(p=Date.now()+280,console.log(...e))}function t(e,t,o,n,a,s,c){Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:()=>(r.resolve(new Date).then(a).catch(console.warn),2===o?`${n}`:n),set(e){let t=c.get(this);return r.resolve([t,e,new Date]).then(s).catch(console.warn),c.set(this,e),!0}})}function o(o){if(!o||c.has(o))return;const n=o.playbackPauseDelayMs,a=o.promptDelaySec,s=o.lactThresholdMs,r=Math.floor(.1*Number.MAX_SAFE_INTEGER),p=Math.floor(r/1e3);if("playbackPauseDelayMs"in o&&n>=0&&n<4*r){c.set(o,n);const a="string"==typeof n?2:+("number"==typeof n);a>=1&&t(o,"playbackPauseDelayMs",a,5*r,t=>{e(`${y} is trying to pause video...`,t.toLocaleTimeString())},e=>{const[t,o,n]=e;console.log(`${y} is trying to change value 'playbackPauseDelayMs' from ${t} to ${o} ...`,n.toLocaleTimeString())},c),"number"!=typeof(o.showPausedActions||0).length||o.tvTyh||(o.tvTyh=[],function(e){Object.defineProperty(e,"showPausedActions",{enumerable:!0,configurable:!0,get(){const e=this.tvTyh;return(e||0).length>=1&&(e.length=0),e},set:()=>!0})}(o))}if("promptDelaySec"in o&&a>=0&&a<4*p){l.set(o,a);const n="string"==typeof a?2:+("number"==typeof a);n>=1&&t(o,"promptDelaySec",n,5*p,t=>{e(`${y} is trying to pause video...`,t.toLocaleTimeString())},e=>{const[t,o,n]=e;console.log(`${y} is trying to change value 'promptDelaySec' from ${t} to ${o} ...`,n.toLocaleTimeString())},l)}if("lactThresholdMs"in o&&s>=0&&s<4*r){i.set(o,s);const e="string"==typeof s?2:+("number"==typeof s);e>=1&&t(o,"lactThresholdMs",e,5*r,()=>{},e=>{const[t,o,n]=e;console.log(`${y} is trying to change value 'lactThresholdMs' from ${t} to ${o} ...`,n.toLocaleTimeString())},i)}}function n(e){if(1==e||3==e){const e=g=1+(1073741823&g);requestAnimationFrame(()=>{e===g&&a()})}}function a(){const e=new Set,t=document.querySelector("#player")||0;try{const o=t&&(u(t).__data||t.__data||0),n=o.playerResponse_||o.playerResponse;n&&e.add(n.messages)}catch(e){}const n=t&&(u(t).playerApi_||t.playerApi_||u(t).playerApi||t.playerApi||0);if(n&&"function"==typeof n.getPlayerResponse)try{const t=n.getPlayerResponse();t&&e.add(t.messages)}catch(e){}const a=document.querySelector("#movie_player")||0,s=a&&(u(a).getPlayerResponse?u(a):a);if(s&&"function"==typeof s.getPlayerResponse)try{const t=s.getPlayerResponse();t&&e.add(t.messages)}catch(e){}const r=new Set;for(const t of e)if(t&&t.length>0)for(const e of t)if(e.youThereRenderer){h||(h=!0,console.log("Detected message.youThereRenderer"));let t=null;try{t=e.youThereRenderer.configData.youThereData}catch(e){}t&&r.add(t),t=null;break}if(r.size>0){d||(d=!0,console.log("Detected youThereData"));for(const e of r)o(e);r.clear()}}function s(){a();const e=document.querySelector("#player")||0,t=u(e).playerApi_||e.playerApi_||u(e).playerApi||e.playerApi||0;"object"==typeof t&&(void 0===t[f]&&"function"==typeof t.getPlayerState&&(t[f]=t.getPlayerState,t.getPlayerState=function(){let e=this[f](...arguments);if(1==e||3==e)try{a()}catch(e){}return e}),"removeEventListener"in t&&"addEventListener"in t&&(t.removeEventListener("onStateChange",n,!1),t.addEventListener("onStateChange",n,!1)))}const r=(async()=>{})().constructor,c=new WeakMap,l=new WeakMap,i=new WeakMap,y="YouTube Music";let p=0;const u=e=>e?e.polymerController||e.inst||e||0:e||0;let f=Symbol(),g=0,h=!1,d=!1,m=0;document.addEventListener("canplay",function(e){"VIDEO"==e.target.nodeName&&e.target.closest("#player")&&async function(){p=Date.now()+3400;const e=m=1+(1073741823&m);await r.resolve(0),e===m&&(s(),await new r(e=>setTimeout(e,3200)),e===m&&(s(),await new r(e=>setTimeout(e,5400)),e===m&&s()))}()},!0)}();